1
00:00:00,030 --> 00:00:03,389

and yeah so how did we do the whole

2
00:00:03,389 --> 00:00:05,190
thing because now we know what we use

3
00:00:05,190 --> 00:00:06,990
but we don't really know how to attack a

4
00:00:06,990 --> 00:00:09,929
coffee machine so neither me nor my

5
00:00:09,929 --> 00:00:11,910
flatmate are electrical engineers I did

6
00:00:11,910 --> 00:00:13,920
like two semesters in university but

7
00:00:13,920 --> 00:00:15,900
like most of the people here probably if

8
00:00:15,900 --> 00:00:18,660
you didn't do a topic for years you tend

9
00:00:18,660 --> 00:00:21,300
to forget everything or most of it as

10
00:00:21,300 --> 00:00:23,369
you will see throughout the process that

11
00:00:23,369 --> 00:00:26,970
I clearly forgot a lot and so we did

12
00:00:26,970 --> 00:00:28,980
what most people would do when they when

13
00:00:28,980 --> 00:00:30,689
they figure something out that they have

14
00:00:30,689 --> 00:00:32,430
no clue about we just opened this thing

15
00:00:32,430 --> 00:00:34,559
so we took out all the screws that were

16
00:00:34,559 --> 00:00:36,950
there literally all the screws initially

17
00:00:36,950 --> 00:00:39,300
that were like from the casing so we

18
00:00:39,300 --> 00:00:40,829
took all sides out even though we were

19
00:00:40,829 --> 00:00:43,140
only interested on this side and there

20
00:00:43,140 --> 00:00:44,940
were a couple of things here that were

21
00:00:44,940 --> 00:00:47,370
of interest for us and they were all in

22
00:00:47,370 --> 00:00:50,010
that corner um so the whole machine can

23
00:00:50,010 --> 00:00:51,870
be controlled it has a major power

24
00:00:51,870 --> 00:00:53,699
switch on the back but all the other

25
00:00:53,699 --> 00:00:56,129
controls are on the right side of the

26
00:00:56,129 --> 00:00:59,699
coffee machine and our buttons so we

27
00:00:59,699 --> 00:01:01,350
have the buttons here and then we have a

28
00:01:01,350 --> 00:01:02,699
micro controller that does the actual

29
00:01:02,699 --> 00:01:05,180
work and we have this interesting cable

30
00:01:05,180 --> 00:01:07,619
that connects the two and it was

31
00:01:07,619 --> 00:01:10,439
interesting because it was an actual

32
00:01:10,439 --> 00:01:12,780
cable they weren't soldered together or

33
00:01:12,780 --> 00:01:15,270
something was like a pretty big cable

34
00:01:15,270 --> 00:01:16,979
that we could just unplug so we did that

35
00:01:16,979 --> 00:01:20,150
and we just took out the whole thing and

36
00:01:20,150 --> 00:01:22,740
this is what we ended up with so this is

37
00:01:22,740 --> 00:01:24,689
the actual control panel of the button

38
00:01:24,689 --> 00:01:30,420
and it allows you to basically have

39
00:01:30,420 --> 00:01:32,189
eight pins down there that's where the

40
00:01:32,189 --> 00:01:33,750
cable plugged in and then you have seven

41
00:01:33,750 --> 00:01:35,790
LEDs that are on the one hand used to

42
00:01:35,790 --> 00:01:38,460
show state but they also use for error

43
00:01:38,460 --> 00:01:40,829
messages etc and then you have those six

44
00:01:40,829 --> 00:01:42,720
buttons so the bottom right one is the

45
00:01:42,720 --> 00:01:43,920
important one that's power

46
00:01:43,920 --> 00:01:46,560
the top one top right one is espresso

47
00:01:46,560 --> 00:01:49,140
and the top and the right one in the

48
00:01:49,140 --> 00:01:52,680
middle is is a normal coffee the left

49
00:01:52,680 --> 00:01:55,740
ones are for for milk coffees etc also

50
00:01:55,740 --> 00:01:57,329
we didn't we didn't focus on them

51
00:01:57,329 --> 00:02:00,540
initially and this is the interesting

52
00:02:00,540 --> 00:02:02,390
table unfortunately didn't have a

53
00:02:02,390 --> 00:02:04,649
picture of the original setup so this

54
00:02:04,649 --> 00:02:05,790
would be actually the picture of the

55
00:02:05,790 --> 00:02:08,190
final setup that's where that's why we

56
00:02:08,190 --> 00:02:09,929
have nice tape around it but basically

57
00:02:09,929 --> 00:02:11,459
what we did is we took one side of the

58
00:02:11,459 --> 00:02:11,819
cable

59
00:02:11,819 --> 00:02:13,170
we just jammed in a bunch of jumper

60
00:02:13,170 --> 00:02:15,629
wires so we could connect that to to the

61
00:02:15,629 --> 00:02:18,510
temple or later into the into a

62
00:02:18,510 --> 00:02:23,129
breadboard and then we we sat down and

63
00:02:23,129 --> 00:02:25,109
thought about what do we actually know

64
00:02:25,109 --> 00:02:26,879
about this board so we have eight cables

65
00:02:26,879 --> 00:02:29,280
or eight pins that we want to control we

66
00:02:29,280 --> 00:02:30,989
have six switches and we have seven LEDs

67
00:02:30,989 --> 00:02:33,870
now the idea that we had was well we

68
00:02:33,870 --> 00:02:35,639
have a cable so we can connect this to

69
00:02:35,639 --> 00:02:37,230
the tehsil and we can figure out what

70
00:02:37,230 --> 00:02:40,019
protocol is being spoken between this

71
00:02:40,019 --> 00:02:42,840
control plate and the microprocessor we

72
00:02:42,840 --> 00:02:44,849
can spoof this and then just let the

73
00:02:44,849 --> 00:02:48,030
tehsil sent this protocol so basically

74
00:02:48,030 --> 00:02:51,959
what our idea was is that we have power

75
00:02:51,959 --> 00:02:57,090
going in from one pin and then we have

76
00:02:57,090 --> 00:02:59,609
at least three pins that must represent

77
00:02:59,609 --> 00:03:02,010
the buttons because say we have six pins

78
00:03:02,010 --> 00:03:04,980
or six buttons we could use like a

79
00:03:04,980 --> 00:03:07,379
binary flag and just represented with

80
00:03:07,379 --> 00:03:09,569
three pins and then we have three pins

81
00:03:09,569 --> 00:03:11,790
to control the LEDs but what is the

82
00:03:11,790 --> 00:03:13,709
eighth cable for because our math

83
00:03:13,709 --> 00:03:15,150
doesn't really add up here

84
00:03:15,150 --> 00:03:17,310
but we figured let's let's go for the

85
00:03:17,310 --> 00:03:19,500
assumptions and try naive approach so

86
00:03:19,500 --> 00:03:23,159
this is the script to control the castle

87
00:03:23,159 --> 00:03:25,079
using johnny-five

88
00:03:25,079 --> 00:03:27,720
so we import the johnny-five library and

89
00:03:27,720 --> 00:03:31,199
then we are import the tesla Isle plugin

90
00:03:31,199 --> 00:03:34,139
so that allows us to communicate with

91
00:03:34,139 --> 00:03:36,060
the johnny-five library and the tehsil

92
00:03:36,060 --> 00:03:38,669
and then once the board is ready we just

93
00:03:38,669 --> 00:03:42,090
create seven pins we admit omitted the

94
00:03:42,090 --> 00:03:44,159
one that we connected to five poles

95
00:03:44,159 --> 00:03:46,799
because 3.3 volts didn't lit up the LEDs

96
00:03:46,799 --> 00:03:48,689
5 volts did so you can see how

97
00:03:48,689 --> 00:03:50,220
scientifically we approach this whole

98
00:03:50,220 --> 00:03:54,509
thing and then we set them to analog

99
00:03:54,509 --> 00:03:56,750
mode so the idea was can we figure out

100
00:03:56,750 --> 00:03:59,969
if the analog mode measures the voltage

101
00:03:59,969 --> 00:04:02,310
on the pin so we could see if there is a

102
00:04:02,310 --> 00:04:04,229
voltage difference when we press a

103
00:04:04,229 --> 00:04:07,709
button for example and then we injected

104
00:04:07,709 --> 00:04:09,239
them in the repple because journey 5 has

105
00:04:09,239 --> 00:04:10,739
a nice rattle so when we start off the

106
00:04:10,739 --> 00:04:13,500
script we can interact with that so we

107
00:04:13,500 --> 00:04:14,939
just measured the values and

108
00:04:14,939 --> 00:04:18,000
unfortunately analog pins are very good

109
00:04:18,000 --> 00:04:20,400
and fluctuating so we couldn't get a

110
00:04:20,400 --> 00:04:22,320
proper value out of this so we had to

111
00:04:22,320 --> 00:04:24,510
you tweak this slightly and take out

112
00:04:24,510 --> 00:04:26,790
this analog mode and turn it into a

113
00:04:26,790 --> 00:04:28,800
digital pin so the difference is you can

114
00:04:28,800 --> 00:04:31,410
only set a digital pin to high or low

115
00:04:31,410 --> 00:04:33,360
and you can only read high or low so

116
00:04:33,360 --> 00:04:37,770
it's 1 or 0 and we did that and we

117
00:04:37,770 --> 00:04:39,510
figure it out so when we just plug in

118
00:04:39,510 --> 00:04:42,270
power we have the three of the right

119
00:04:42,270 --> 00:04:46,560
LEDs glowing up so that's good that part

120
00:04:46,560 --> 00:04:49,260
seems to be power and if we turn off

121
00:04:49,260 --> 00:04:51,480
three of the pins we can actually turn

122
00:04:51,480 --> 00:04:53,940
off these three LEDs all the other ones

123
00:04:53,940 --> 00:04:56,010
didn't work we we literally wrote a

124
00:04:56,010 --> 00:04:57,330
binary flag that went through all

125
00:04:57,330 --> 00:05:00,020
combinations but we couldn't get them on

126
00:05:00,020 --> 00:05:03,300
but we knew that when you four pins now

127
00:05:03,300 --> 00:05:05,010
we knew one is power and three can

128
00:05:05,010 --> 00:05:06,720
control the LEDs so we're getting close

129
00:05:06,720 --> 00:05:11,070
to our our initial assumption so what we

130
00:05:11,070 --> 00:05:12,690
did with the other four pins was we

131
00:05:12,690 --> 00:05:14,280
declared them as button so johnny-five

132
00:05:14,280 --> 00:05:17,580
has a has a button clasp in it that

133
00:05:17,580 --> 00:05:19,380
allows us to really use the power of

134
00:05:19,380 --> 00:05:22,530
JavaScript by having our event listeners

135
00:05:22,530 --> 00:05:24,600
on press and release so this is where

136
00:05:24,600 --> 00:05:26,340
javascript is really cool for hardware

137
00:05:26,340 --> 00:05:29,120
hacking because we can say listen for

138
00:05:29,120 --> 00:05:31,620
whenever a button is pressed or when

139
00:05:31,620 --> 00:05:34,800
it's released and it's just way easier

140
00:05:34,800 --> 00:05:36,780
than writing a loop and figuring out of

141
00:05:36,780 --> 00:05:40,290
the value changed and we did this and it

142
00:05:40,290 --> 00:05:43,440
was some notes that we took in the

143
00:05:43,440 --> 00:05:45,780
meantime and I could go through them but

144
00:05:45,780 --> 00:05:47,970
they all don't mean anything but we were

145
00:05:47,970 --> 00:05:49,710
onto something because we knew that pin

146
00:05:49,710 --> 00:05:53,040
one was power 4 2 5 and 7 the LEDs were

147
00:05:53,040 --> 00:05:55,080
able we were able to control through

148
00:05:55,080 --> 00:05:58,830
pins 4 to 6 but the weird part was 7 & 8

149
00:05:58,830 --> 00:06:00,650
were the only ones reacting on buttons

150
00:06:00,650 --> 00:06:04,650
so whenever we press the bottom right

151
00:06:04,650 --> 00:06:05,130
one

152
00:06:05,130 --> 00:06:07,680
they were triggering 7 & 8 respectively

153
00:06:07,680 --> 00:06:10,640
when we press the top two ones they

154
00:06:10,640 --> 00:06:13,650
progressive and eight and if we set if

155
00:06:13,650 --> 00:06:19,260
it helped set one bit to high we would

156
00:06:19,260 --> 00:06:20,850
be able to trigger the other two as well

157
00:06:20,850 --> 00:06:24,090
so we could use pin 2 & 3 to turn off

158
00:06:24,090 --> 00:06:25,950
the buttons left and right but that's

159
00:06:25,950 --> 00:06:27,540
not what we wanted right we want to be

160
00:06:27,540 --> 00:06:30,689
able to figure out if that button was

161
00:06:30,689 --> 00:06:32,399
but we could just figure out if one of

162
00:06:32,399 --> 00:06:35,249
three of if one of three buttons has

163
00:06:35,249 --> 00:06:39,629
been pressed which meant that that was

164
00:06:39,629 --> 00:06:41,610
pretty useless so we had to go back to

165
00:06:41,610 --> 00:06:43,919
the drawing board quite literally so we

166
00:06:43,919 --> 00:06:46,739
took a picture of this for the first

167
00:06:46,739 --> 00:06:48,239
time because I mean the plate is like

168
00:06:48,239 --> 00:06:49,229
this big

169
00:06:49,229 --> 00:06:51,360
and we're like looking at it like this

170
00:06:51,360 --> 00:06:53,789
the whole time so we figured maybe

171
00:06:53,789 --> 00:06:55,649
taking a picture is a bit more

172
00:06:55,649 --> 00:06:57,899
productive so we took a picture zoomed

173
00:06:57,899 --> 00:06:59,849
into it and then use the software called

174
00:06:59,849 --> 00:07:02,129
Fritzing that you can use to create

175
00:07:02,129 --> 00:07:05,399
diagrams and we turned this into this

176
00:07:05,399 --> 00:07:09,479
beautiful diagram and it looks like a

177
00:07:09,479 --> 00:07:11,219
mess and it is a mess because what we

178
00:07:11,219 --> 00:07:14,819
did is we assumed into the picture and I

179
00:07:14,819 --> 00:07:17,009
went to said okay I'm going to go from

180
00:07:17,009 --> 00:07:20,519
this pin to this pin because they might

181
00:07:20,519 --> 00:07:23,579
be connected and then my flatmates used

182
00:07:23,579 --> 00:07:26,249
a multimeter to measure the resistance

183
00:07:26,249 --> 00:07:28,529
between these two parts and if the

184
00:07:28,529 --> 00:07:30,059
resistance is zero that means the two

185
00:07:30,059 --> 00:07:33,629
pins are connected our approach meant

186
00:07:33,629 --> 00:07:35,309
that we had to go from resistor to

187
00:07:35,309 --> 00:07:37,619
resistor as well so that's what we left

188
00:07:37,619 --> 00:07:39,779
out all the resistors on this thing or

189
00:07:39,779 --> 00:07:43,709
what we deemed were resistors and while

190
00:07:43,709 --> 00:07:45,300
this looks like a mess this was way more

191
00:07:45,300 --> 00:07:46,919
useful for us because we could finally

192
00:07:46,919 --> 00:07:50,579
figure out that not only pour a pin one

193
00:07:50,579 --> 00:07:52,439
was power but pin two and three were

194
00:07:52,439 --> 00:07:54,300
power as well and that was the reason

195
00:07:54,300 --> 00:07:56,339
why the other LEDs never laid on because

196
00:07:56,339 --> 00:07:59,009
we had to put five volts on this pin in

197
00:07:59,009 --> 00:08:01,860
order to actually see that this that

198
00:08:01,860 --> 00:08:04,709
these LEDs light up and the process of

199
00:08:04,709 --> 00:08:06,749
figuring this out we'd burn two of the

200
00:08:06,749 --> 00:08:11,189
LEDs though so by figuring out hey what

201
00:08:11,189 --> 00:08:12,959
if we connect five volts directly to

202
00:08:12,959 --> 00:08:17,459
this LED we that was I'd like 4 a.m. so

203
00:08:17,459 --> 00:08:21,229
we were slightly slightly tired so we

204
00:08:21,229 --> 00:08:23,789
broke two but in the end all of them

205
00:08:23,789 --> 00:08:26,339
that were still working lit up so that

206
00:08:26,339 --> 00:08:29,459
was a good approach but the switches

207
00:08:29,459 --> 00:08:32,159
still showed the same problem we knew

208
00:08:32,159 --> 00:08:35,009
that 1 2 3 R power 4 to 6 or LEDs so we

209
00:08:35,009 --> 00:08:36,389
were able to finally flick on the

210
00:08:36,389 --> 00:08:39,209
different LEDs but 7 to 8 we're still

211
00:08:39,209 --> 00:08:41,390
the only ones that react to buttons

212
00:08:41,390 --> 00:08:43,640
and we can't figure out which button was

213
00:08:43,640 --> 00:08:47,720
pressed by just having two bit and so we

214
00:08:47,720 --> 00:08:49,580
realized that three of these things

215
00:08:49,580 --> 00:08:52,700
aren't LEDs does anyone have an idea

216
00:08:52,700 --> 00:08:53,600
what this is

217
00:08:53,600 --> 00:08:55,580
I mean it's written there but does

218
00:08:55,580 --> 00:08:58,280
anyone know what it diet is alright one

219
00:08:58,280 --> 00:09:01,460
person so diets are a few people so

220
00:09:01,460 --> 00:09:03,620
diets are similar to LEDs they have one

221
00:09:03,620 --> 00:09:06,980
property which is the current can only

222
00:09:06,980 --> 00:09:09,950
flow into one direction to be and the

223
00:09:09,950 --> 00:09:12,260
other directions blocked so an LED does

224
00:09:12,260 --> 00:09:16,790
that and light up light up but diet will

225
00:09:16,790 --> 00:09:19,370
just control the current going only in

226
00:09:19,370 --> 00:09:22,550
one direction so we drop the LEDs from

227
00:09:22,550 --> 00:09:24,650
the diagram and we added the three diets

228
00:09:24,650 --> 00:09:26,450
and suddenly stuff made more sense we

229
00:09:26,450 --> 00:09:28,760
could because we could follow the power

230
00:09:28,760 --> 00:09:32,570
and we could see where it went and this

231
00:09:32,570 --> 00:09:34,040
was super useful because we finally

232
00:09:34,040 --> 00:09:36,620
figured out that there was a mapping and

233
00:09:36,620 --> 00:09:38,330
the mapping was ATS which one was

234
00:09:38,330 --> 00:09:40,970
connected between P 3 and P 7 switch to

235
00:09:40,970 --> 00:09:43,760
was P 3 to P 8 and you see that all of

236
00:09:43,760 --> 00:09:45,470
them are connected ultimately to seven

237
00:09:45,470 --> 00:09:48,080
or eight so that that finally explained

238
00:09:48,080 --> 00:09:50,720
why we you could only listen to the two

239
00:09:50,720 --> 00:09:52,970
it gave us the same gave up a problem

240
00:09:52,970 --> 00:09:54,800
though that all of these switches were

241
00:09:54,800 --> 00:09:58,880
dependent on the input as well and that

242
00:09:58,880 --> 00:10:00,770
meant we can fake the protocol we can

243
00:10:00,770 --> 00:10:03,710
just send in high low high low to tell

244
00:10:03,710 --> 00:10:06,560
it what button was pressed but we had a

245
00:10:06,560 --> 00:10:08,990
useful thing at home that we've bought

246
00:10:08,990 --> 00:10:12,470
kind of in luckily right before the

247
00:10:12,470 --> 00:10:14,150
attack and those were relays

248
00:10:14,150 --> 00:10:16,790
so relays are digital switches like

249
00:10:16,790 --> 00:10:20,270
electronic switches that you can use for

250
00:10:20,270 --> 00:10:21,920
example microcontroller like the tehsil

251
00:10:21,920 --> 00:10:24,560
to flick them rather than having to

252
00:10:24,560 --> 00:10:26,810
press them so what we did is we wired

253
00:10:26,810 --> 00:10:29,180
the cable from the coffee machine into a

254
00:10:29,180 --> 00:10:31,880
breadboard and then from there we

255
00:10:31,880 --> 00:10:34,700
reconstructed the same setup that we had

256
00:10:34,700 --> 00:10:38,450
here on just with the relays instead so

257
00:10:38,450 --> 00:10:40,580
we only had four relate so we decided to

258
00:10:40,580 --> 00:10:42,500
map only the three right buttons and

259
00:10:42,500 --> 00:10:47,150
left out the left left three and we also

260
00:10:47,150 --> 00:10:49,730
wired up these LEDs to these three LEDs

261
00:10:49,730 --> 00:10:52,550
to show up which status it is in so that

262
00:10:52,550 --> 00:10:53,990
we know whether the coffee machine is

263
00:10:53,990 --> 00:10:54,980
heating right now

264
00:10:54,980 --> 00:11:00,110
etc so this was the initial wire up we

265
00:11:00,110 --> 00:11:02,240
had to be very careful to not touch the

266
00:11:02,240 --> 00:11:05,959
hot coffee machine while testing it even

267
00:11:05,959 --> 00:11:07,160
though my flatmate I think brewing

268
00:11:07,160 --> 00:11:11,269
himself twice and then we scripted a

269
00:11:11,269 --> 00:11:13,420
small manual script to control this and

270
00:11:13,420 --> 00:11:15,709
basically what we did is we leveraged

271
00:11:15,709 --> 00:11:17,589
the fact that there's also a relay class

272
00:11:17,589 --> 00:11:20,240
we connected it we said on which port

273
00:11:20,240 --> 00:11:23,420
where were connected to so we connected

274
00:11:23,420 --> 00:11:25,160
to normally open which means by default

275
00:11:25,160 --> 00:11:29,180
the switch is open and then we just

276
00:11:29,180 --> 00:11:31,339
close them immediately and injected the

277
00:11:31,339 --> 00:11:33,980
whole thing into the repple so that we

278
00:11:33,980 --> 00:11:36,410
can control it and I hope the video

279
00:11:36,410 --> 00:11:40,130
works so we ran grande open at like 5

280
00:11:40,130 --> 00:11:43,160
a.m. we started editing at 8 p.m. and it

281
00:11:43,160 --> 00:11:44,720
started running water it's a bit hard to

282
00:11:44,720 --> 00:11:46,579
see we didn't put coffee in it because

283
00:11:46,579 --> 00:11:48,380
we weren't sure yet if it works and we

284
00:11:48,380 --> 00:11:50,290
didn't want to waste coffee and once it

285
00:11:50,290 --> 00:11:52,760
once your trigger grinder closed it's

286
00:11:52,760 --> 00:11:54,940
going to it's going to close again

287
00:11:54,940 --> 00:11:58,970
alright um cool so once we were done

288
00:11:58,970 --> 00:12:00,529
with that we just locked up the whole

289
00:12:00,529 --> 00:12:03,230
thing um closed it again properly put

290
00:12:03,230 --> 00:12:05,149
the sides back on and use the fact that

291
00:12:05,149 --> 00:12:07,130
now that we remove the buttons we had

292
00:12:07,130 --> 00:12:09,649
some holes there so we just wired the

293
00:12:09,649 --> 00:12:11,630
cable through it put a button on it

294
00:12:11,630 --> 00:12:15,620
that's the Johnny Five logo and then

295
00:12:15,620 --> 00:12:17,899
wires the whole stuff on top so that in

296
00:12:17,899 --> 00:12:21,050
theory we could even unplug the cables

297
00:12:21,050 --> 00:12:23,060
here now and plug back in the control

298
00:12:23,060 --> 00:12:24,589
plate and we could use the coffee

299
00:12:24,589 --> 00:12:26,269
machine as intended without having

300
00:12:26,269 --> 00:12:28,610
broken it because we didn't solder

301
00:12:28,610 --> 00:12:31,550
anything but we still don't have an i/o

302
00:12:31,550 --> 00:12:33,290
tea coffee machine wrap we were able to

303
00:12:33,290 --> 00:12:35,209
control this with JavaScript but we

304
00:12:35,209 --> 00:12:39,139
aren't able to have something that's

305
00:12:39,139 --> 00:12:41,930
connected to the internet yet and this

306
00:12:41,930 --> 00:12:43,850
is where my favourite status code comes

307
00:12:43,850 --> 00:12:47,149
in for 18 I'm a teapot I don't know if

308
00:12:47,149 --> 00:12:49,630
you've heard of this before this is a

309
00:12:49,630 --> 00:12:52,430
suggested HTTP status code it's not an

310
00:12:52,430 --> 00:12:54,769
official one but some people use it so

311
00:12:54,769 --> 00:12:56,449
if you go to google.com slash

312
00:12:56,449 --> 00:12:58,730
teapot it actually returns that HTTP

313
00:12:58,730 --> 00:13:03,500
status code um and it was suggested in

314
00:13:03,500 --> 00:13:07,790
the IETF RFC to 3 to 4 which is the HTC

315
00:13:07,790 --> 00:13:10,490
CP or in other words the hypertext

316
00:13:10,490 --> 00:13:13,850
coffeepot control protocol which was

317
00:13:13,850 --> 00:13:17,300
suggested on April 1st 1998 and this

318
00:13:17,300 --> 00:13:19,160
gives you an idea why we actually hacked

319
00:13:19,160 --> 00:13:20,780
our coffee machine last weekend because

320
00:13:20,780 --> 00:13:23,300
we're approaching April 1st and we

321
00:13:23,300 --> 00:13:25,460
figure it is a good point to to

322
00:13:25,460 --> 00:13:28,100
implement this protocol so we took this

323
00:13:28,100 --> 00:13:29,930
protocol actually and implemented it or

324
00:13:29,930 --> 00:13:31,940
parts of it but I first want to give you

325
00:13:31,940 --> 00:13:34,880
an overview of it so it's it's based on

326
00:13:34,880 --> 00:13:37,220
top of HTTP so you can use gaps and post

327
00:13:37,220 --> 00:13:39,290
like there used to you can also use the

328
00:13:39,290 --> 00:13:41,750
new method brew it's not limited to

329
00:13:41,750 --> 00:13:43,790
copper to the coffee protocol though

330
00:13:43,790 --> 00:13:46,960
either just in case you want to derive a

331
00:13:46,960 --> 00:13:50,090
beer brewing protocol the RFC suggests

332
00:13:50,090 --> 00:13:53,210
you could use the same method it suggest

333
00:13:53,210 --> 00:13:55,430
you use a safe header to recommend

334
00:13:55,430 --> 00:13:57,710
whether you can do the same operation

335
00:13:57,710 --> 00:13:59,120
again so you can use this with

336
00:13:59,120 --> 00:14:01,040
conditionals as well like if user is

337
00:14:01,040 --> 00:14:03,070
awake you can't through another coffee

338
00:14:03,070 --> 00:14:06,350
and it adds a new except additions

339
00:14:06,350 --> 00:14:09,310
headers so you can add milk or serve or

340
00:14:09,310 --> 00:14:11,530
alcohol to your coffee

341
00:14:11,530 --> 00:14:15,410
it suggests the HTTP status code for 18

342
00:14:15,410 --> 00:14:18,020
in case you try to talk to a copy to a

343
00:14:18,020 --> 00:14:20,270
teapot rather than a coffee pot with

344
00:14:20,270 --> 00:14:23,300
your instructions and obviously we need

345
00:14:23,300 --> 00:14:26,240
to be able to address them so it defines

346
00:14:26,240 --> 00:14:29,780
a URI scheme as well and many more

347
00:14:29,780 --> 00:14:31,340
things this is actually the definition

348
00:14:31,340 --> 00:14:33,890
of the except additions header fields so

349
00:14:33,890 --> 00:14:35,810
with milk type syrup type sweetener type

350
00:14:35,810 --> 00:14:38,750
spice type and alcohol type on sweetener

351
00:14:38,750 --> 00:14:42,050
and spice type are not defined as what

352
00:14:42,050 --> 00:14:44,030
is limited to that's probably great for

353
00:14:44,030 --> 00:14:46,400
Starbucks so they can still use this if

354
00:14:46,400 --> 00:14:49,210
they want to do pumpkin spice lattes um

355
00:14:49,210 --> 00:14:51,620
but yeah that's basically what they

356
00:14:51,620 --> 00:14:52,190
recommend

357
00:14:52,190 --> 00:14:54,230
this is a coffee your eye scheme and I'm

358
00:14:54,230 --> 00:14:56,240
happy that the screen is so big because

359
00:14:56,240 --> 00:14:58,340
my favorite part is this so that's the

360
00:14:58,340 --> 00:14:59,990
German one and you can see it starts

361
00:14:59,990 --> 00:15:03,080
with like in person for be the reason I

362
00:15:03,080 --> 00:15:05,030
cut it actually out is written below is

363
00:15:05,030 --> 00:15:08,990
that they're internationalized and it

364
00:15:08,990 --> 00:15:11,330
insists on that you use a capital K for

365
00:15:11,330 --> 00:15:13,340
coffee if you're using the German

366
00:15:13,340 --> 00:15:16,490
protocol so you need to escape that by

367
00:15:16,490 --> 00:15:19,520
using person for B and then we have a

368
00:15:19,520 --> 00:15:20,710
pod integer

369
00:15:20,710 --> 00:15:23,140
you can add additions to it the great

370
00:15:23,140 --> 00:15:25,149
thing is it's a life we actually have

371
00:15:25,149 --> 00:15:28,810
something working and I'm going to do a

372
00:15:28,810 --> 00:15:30,460
demo so I'm going to switch to my lovely

373
00:15:30,460 --> 00:15:34,000
coffee machine here I couldn't bring my

374
00:15:34,000 --> 00:15:35,740
actual coffee machine because my flat

375
00:15:35,740 --> 00:15:37,680
net would have been really mad

376
00:15:37,680 --> 00:15:39,399
especially if I wouldn't have gotten

377
00:15:39,399 --> 00:15:41,740
this talking so I brought this coffee

378
00:15:41,740 --> 00:15:43,839
machine here it's a fake coffee machine

379
00:15:43,839 --> 00:15:46,709
it's basically a bunch of LEDs that

380
00:15:46,709 --> 00:15:49,899
somebody will simulate the three buttons

381
00:15:49,899 --> 00:15:51,910
that we would press so you can see that

382
00:15:51,910 --> 00:15:53,440
the button of the fake buttons are

383
00:15:53,440 --> 00:15:56,890
pressed and then we have the script here

384
00:15:56,890 --> 00:15:59,620
and we have the script running or any is

385
00:15:59,620 --> 00:16:02,470
basically an HTTP server so there's

386
00:16:02,470 --> 00:16:04,330
nothing Hardware specific in this script

387
00:16:04,330 --> 00:16:06,940
I'm using local tunnel to create an

388
00:16:06,940 --> 00:16:10,709
address that we can externally at access

389
00:16:10,709 --> 00:16:14,950
and basically once we have that all set

390
00:16:14,950 --> 00:16:16,450
up we set up the coffee machine and when

391
00:16:16,450 --> 00:16:18,790
that is ready we can use it and then we

392
00:16:18,790 --> 00:16:20,260
just handle the request so what you can

393
00:16:20,260 --> 00:16:21,970
see we check if the coffee machine is

394
00:16:21,970 --> 00:16:23,529
actually a teapot just in case

395
00:16:23,529 --> 00:16:27,130
we've get methods that respond with the

396
00:16:27,130 --> 00:16:29,050
appropriate coffee message coffee pot

397
00:16:29,050 --> 00:16:30,970
content type which is one that is

398
00:16:30,970 --> 00:16:34,000
suggested in the protocol we also have

399
00:16:34,000 --> 00:16:36,550
post and brew I don't think the HTTP

400
00:16:36,550 --> 00:16:38,709
from node supports grew but I didn't try

401
00:16:38,709 --> 00:16:42,310
that yet we set the headers armed and

402
00:16:42,310 --> 00:16:44,800
yeah we check for all this stuff like

403
00:16:44,800 --> 00:16:46,420
the correct content type we check for

404
00:16:46,420 --> 00:16:48,100
the accept additions unfortunately our

405
00:16:48,100 --> 00:16:49,510
coffee machine doesn't support any

406
00:16:49,510 --> 00:16:54,370
additions yet but it will come and yeah

407
00:16:54,370 --> 00:16:56,709
so let's do a quick demo I'm going to

408
00:16:56,709 --> 00:16:58,390
make this a bit bigger so I have my

409
00:16:58,390 --> 00:17:00,160
authorization here it talks about

410
00:17:00,160 --> 00:17:02,140
security in the RFC but I wasn't really

411
00:17:02,140 --> 00:17:03,880
sure what they weren't really specific

412
00:17:03,880 --> 00:17:05,860
what's the best authorization is so I

413
00:17:05,860 --> 00:17:07,800
just have like I created my own header

414
00:17:07,800 --> 00:17:11,860
and then we specify the content type so

415
00:17:11,860 --> 00:17:14,620
I'm going to do a get actually to pot 0

416
00:17:14,620 --> 00:17:18,610
so that should tell us if the internet

417
00:17:18,610 --> 00:17:22,150
isn't too slow like local tunnel is

418
00:17:22,150 --> 00:17:23,920
sometimes a bit slow there we go

419
00:17:23,920 --> 00:17:25,390
currently the coffee machine is on

420
00:17:25,390 --> 00:17:28,480
that's great now I had to improvise with

421
00:17:28,480 --> 00:17:30,850
the URI scheme a bit because it doesn't

422
00:17:30,850 --> 00:17:33,530
suggest like it's a copy pod

423
00:17:33,530 --> 00:17:35,570
supports multiple versions or copies

424
00:17:35,570 --> 00:17:37,880
which at not in 1998 wasn't really

425
00:17:37,880 --> 00:17:41,660
common so I extended the thing a bit so

426
00:17:41,660 --> 00:17:43,250
we can order an espresso and now you

427
00:17:43,250 --> 00:17:46,190
should look at the LEDs so I'm going to

428
00:17:46,190 --> 00:17:49,580
do a post request to the LEDs I'm going

429
00:17:49,580 --> 00:17:55,610
to specify start and there we go the LED

430
00:17:55,610 --> 00:17:59,180
lit up and the same port run there we

431
00:17:59,180 --> 00:18:00,680
have the problem that right now we

432
00:18:00,680 --> 00:18:03,730
aren't able to measure whether the

433
00:18:03,730 --> 00:18:06,500
status is the right one like whether

434
00:18:06,500 --> 00:18:08,180
it's currently brewing a coffee or not

435
00:18:08,180 --> 00:18:11,480
we could figure this out by checking

436
00:18:11,480 --> 00:18:14,090
what the value on the LEDs are on the

437
00:18:14,090 --> 00:18:15,530
respective ones that we have on the

438
00:18:15,530 --> 00:18:17,780
original board but the problem there is

439
00:18:17,780 --> 00:18:20,630
that we would literally like the current

440
00:18:20,630 --> 00:18:21,860
solution that we could only come up with

441
00:18:21,860 --> 00:18:24,020
is having a photo sensor measure whether

442
00:18:24,020 --> 00:18:27,320
literally the LED is on because we don't

443
00:18:27,320 --> 00:18:29,150
share a common ground between the tehsil

444
00:18:29,150 --> 00:18:31,460
and coffee machine so we can't measure

445
00:18:31,460 --> 00:18:33,440
the values if you want to know more

446
00:18:33,440 --> 00:18:34,820
about that we can talk about that later

447
00:18:34,820 --> 00:18:39,740
over coffee and yeah so we can also turn

448
00:18:39,740 --> 00:18:42,530
this whole thing off so that should

449
00:18:42,530 --> 00:18:45,920
trigger the other one boom so that all

450
00:18:45,920 --> 00:18:48,350
worked let's quickly look at the actual

451
00:18:48,350 --> 00:18:52,190
coffee code so what we do is we similar

452
00:18:52,190 --> 00:18:55,190
to the manual script we just initialize

453
00:18:55,190 --> 00:18:57,230
the different relays that we're

454
00:18:57,230 --> 00:18:59,390
connected to and then we have a press

455
00:18:59,390 --> 00:19:00,950
power method which just checks if it's

456
00:19:00,950 --> 00:19:02,660
on which currently is just a fake

457
00:19:02,660 --> 00:19:04,370
because I know it's like it takes 20

458
00:19:04,370 --> 00:19:06,290
seconds roughly to heat up so I'm

459
00:19:06,290 --> 00:19:09,980
waiting for 21 seconds until it's on and

460
00:19:09,980 --> 00:19:11,750
then we have a switch method and all of

461
00:19:11,750 --> 00:19:13,850
them call this press baton method which

462
00:19:13,850 --> 00:19:16,940
in order to simulate a button press we

463
00:19:16,940 --> 00:19:19,850
just open the relay wait for 500

464
00:19:19,850 --> 00:19:22,130
milliseconds and then close it again the

465
00:19:22,130 --> 00:19:23,810
reason for that is if we would just keep

466
00:19:23,810 --> 00:19:25,970
it open it would just continue running

467
00:19:25,970 --> 00:19:27,860
until we close it again but if we only

468
00:19:27,860 --> 00:19:30,170
present shortly starts brewing only the

469
00:19:30,170 --> 00:19:31,610
amount that we need so for a Nespresso

470
00:19:31,610 --> 00:19:33,560
would only brew that much rather than

471
00:19:33,560 --> 00:19:35,990
having to figure out how many seconds it

472
00:19:35,990 --> 00:19:39,140
takes to brew a copy we let that be done

473
00:19:39,140 --> 00:19:41,450
by the coffee machine itself and that's

474
00:19:41,450 --> 00:19:43,520
all like that's literally all the code

475
00:19:43,520 --> 00:19:46,200
that we need

476
00:19:46,210 --> 00:19:49,630
so let me switch back to my slides all

477
00:19:49,630 --> 00:19:51,250
right so what did what what did we

478
00:19:51,250 --> 00:19:53,710
actually learn during this during this

479
00:19:53,710 --> 00:19:56,320
hack um first of all reverse engineering

480
00:19:56,320 --> 00:19:58,960
is a lot of fun trying to figure this

481
00:19:58,960 --> 00:20:01,270
out it's it's way too addicting I think

482
00:20:01,270 --> 00:20:04,540
we started at 7 or 8 p.m. on on Friday

483
00:20:04,540 --> 00:20:07,300
and we stayed up until 6 a.m. or

484
00:20:07,300 --> 00:20:09,840
something until we finally had coffee

485
00:20:09,840 --> 00:20:12,520
which was useful at that time because

486
00:20:12,520 --> 00:20:13,810
like we totally didn't want to go to

487
00:20:13,810 --> 00:20:18,340
sleep but it was real really a lot of

488
00:20:18,340 --> 00:20:20,290
fun because reverse engineering an API

489
00:20:20,290 --> 00:20:22,720
or something is already interesting but

490
00:20:22,720 --> 00:20:24,040
reverse engineering something where you

491
00:20:24,040 --> 00:20:26,740
have even less of a clue that's even

492
00:20:26,740 --> 00:20:27,160
better

493
00:20:27,160 --> 00:20:29,350
it can be very very frustrating though

494
00:20:29,350 --> 00:20:34,090
because you can't just like it's harder

495
00:20:34,090 --> 00:20:37,240
to reverse engineer hardware than it is

496
00:20:37,240 --> 00:20:41,320
to reverse engineer software especially

497
00:20:41,320 --> 00:20:43,090
because it's easier to break things and

498
00:20:43,090 --> 00:20:44,320
if you're doing this in the middle of

499
00:20:44,320 --> 00:20:45,970
the night and you're burning something

500
00:20:45,970 --> 00:20:48,250
you might not be able to get replacement

501
00:20:48,250 --> 00:20:51,580
parts JavaScript and hardware work great

502
00:20:51,580 --> 00:20:53,020
so this was the first time I actually

503
00:20:53,020 --> 00:20:56,650
did a hack with any hope like the

504
00:20:56,650 --> 00:20:58,540
different options that we had there I

505
00:20:58,540 --> 00:21:00,460
have them lying around but I never had a

506
00:21:00,460 --> 00:21:02,500
good news case for it and I think this

507
00:21:02,500 --> 00:21:05,890
was a really good use days the tehsil 2

508
00:21:05,890 --> 00:21:07,690
is great like it's so much fun to work

509
00:21:07,690 --> 00:21:11,260
with it it has a great CLI on that you

510
00:21:11,260 --> 00:21:14,320
can spin a you can easily configure the

511
00:21:14,320 --> 00:21:16,630
Tesla you can run scripts on it you can

512
00:21:16,630 --> 00:21:18,730
port them on it it works really well and

513
00:21:18,730 --> 00:21:21,100
johnny-five is super useful because it

514
00:21:21,100 --> 00:21:23,170
allows you to do this cross cross

515
00:21:23,170 --> 00:21:25,330
hardware compatibility so that you can

516
00:21:25,330 --> 00:21:27,310
move this over to a different platform

517
00:21:27,310 --> 00:21:29,230
later if you want to use a different

518
00:21:29,230 --> 00:21:32,530
microcontroller so what's next

519
00:21:32,530 --> 00:21:34,900
we need to programmatically determine

520
00:21:34,900 --> 00:21:37,840
the state of the coffee machine which as

521
00:21:37,840 --> 00:21:40,390
I mentioned before is a bit tricky right

522
00:21:40,390 --> 00:21:42,700
now and we need to add more relate so we

523
00:21:42,700 --> 00:21:47,380
can finally like add milk to our coffee

524
00:21:47,380 --> 00:21:49,660
we need an Alexa integration so we have

525
00:21:49,660 --> 00:21:51,730
the API now but I figured that I've

526
00:21:51,730 --> 00:21:54,400
finished that on Wednesday or something

527
00:21:54,400 --> 00:21:54,890
I didn't have

528
00:21:54,890 --> 00:21:57,610
to finish up the the rest of the

529
00:21:57,610 --> 00:21:59,450
integration so we need an Alexa

530
00:21:59,450 --> 00:22:01,310
integration or at least an if this then

531
00:22:01,310 --> 00:22:03,350
that Handler and probably a Twilio

532
00:22:03,350 --> 00:22:04,730
integration so I can text when I'm

533
00:22:04,730 --> 00:22:08,170
walking home to brew your coffee and

534
00:22:08,170 --> 00:22:10,520
then if you have any suggestions I'm

535
00:22:10,520 --> 00:22:12,260
more than open to to hear any of your

536
00:22:12,260 --> 00:22:17,210
suggestions give any real cool idea like

537
00:22:17,210 --> 00:22:17,810
we need

538
00:22:17,810 --> 00:22:19,370
we definitely need an Irish coffee

539
00:22:19,370 --> 00:22:21,440
option so we need to figure out some way

540
00:22:21,440 --> 00:22:23,960
how we can pour whiskey into it since

541
00:22:23,960 --> 00:22:26,120
the accept additions headers of suggest

542
00:22:26,120 --> 00:22:27,950
already that with whiskey as an option

543
00:22:27,950 --> 00:22:32,210
and yeah with that thanks everyone my

544
00:22:32,210 --> 00:22:35,090
name is Dominic if I not hack coffee

545
00:22:35,090 --> 00:22:36,080
machines at work as a developer

546
00:22:36,080 --> 00:22:37,940
evangelist for Twilio and if you have

547
00:22:37,940 --> 00:22:39,410
any questions you can grab me later for

548
00:22:39,410 --> 00:22:52,210
a coffee beer or shoot me a message

549
00:22:52,220 --> 00:22:55,789
I think we have like a minute left or

550
00:22:55,789 --> 00:23:01,490
something there's a question yet yes so

551
00:23:01,490 --> 00:23:06,559
right that's exactly that's that's like

552
00:23:06,559 --> 00:23:10,309
v4 we first need to be able to brew all

553
00:23:10,309 --> 00:23:12,770
this stuff right now the the agreement

554
00:23:12,770 --> 00:23:14,570
that we have is whoever takes the coffee

555
00:23:14,570 --> 00:23:16,460
puts a new cup underneath it and puts a

556
00:23:16,460 --> 00:23:18,049
new because it's an espresso so you need

557
00:23:18,049 --> 00:23:20,390
to put this thing in it so you need to

558
00:23:20,390 --> 00:23:22,280
put that in and put the cup back onto it

559
00:23:22,280 --> 00:23:24,110
but you can do that in the evening or

560
00:23:24,110 --> 00:23:25,789
whenever you took the last coffee and

561
00:23:25,789 --> 00:23:28,220
it's ready so that when you wake up or

562
00:23:28,220 --> 00:23:29,870
when you really feel like your coffee

563
00:23:29,870 --> 00:23:31,190
but you don't feel like making your

564
00:23:31,190 --> 00:23:33,710
coffee you you don't have to worry about

565
00:23:33,710 --> 00:23:34,690
that anymore

566
00:23:34,690 --> 00:23:39,140
any other questions all right thanks for

567
00:23:39,140 --> 00:23:45,330
your attention

568
00:23:45,340 --> 00:23:47,380
also if you want to see the hardware you

569
00:23:47,380 --> 00:23:49,300
can drop by now or later or something I

