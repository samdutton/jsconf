1
00:00:00,000 --> 00:00:09,539

you

2
00:00:09,549 --> 00:00:12,799
I'm Robert Kieffer I'm a facebook

3
00:00:12,799 --> 00:00:16,520
engineer on the chat team and if you

4
00:00:16,520 --> 00:00:18,590
need to contact me at any point I'm rufa

5
00:00:18,590 --> 00:00:21,380
pretty much everywhere skype IRC Twitter

6
00:00:21,380 --> 00:00:24,860
etc and I just want to thank you guys

7
00:00:24,860 --> 00:00:26,599
for coming here I know we've got got

8
00:00:26,599 --> 00:00:29,570
Isaac next door doing the NPM talk and I

9
00:00:29,570 --> 00:00:32,780
actually really like mtm a lot and kind

10
00:00:32,780 --> 00:00:34,129
of wish i was there as well to check

11
00:00:34,129 --> 00:00:36,399
that out so I appreciate your time here

12
00:00:36,399 --> 00:00:40,730
so let me start by giving a little

13
00:00:40,730 --> 00:00:42,559
background on who I am since I don't

14
00:00:42,559 --> 00:00:44,179
know how many of you I actually heard of

15
00:00:44,179 --> 00:00:47,390
me I've been developing web apps for

16
00:00:47,390 --> 00:00:49,989
actually quite a while I started writing

17
00:00:49,989 --> 00:00:54,679
rich like MVC JavaScript applications in

18
00:00:54,679 --> 00:01:00,140
the client back in 1998 1999 and I've

19
00:01:00,140 --> 00:01:02,600
been doing that for pretty much the my

20
00:01:02,600 --> 00:01:04,489
whole career since then I've at

21
00:01:04,489 --> 00:01:07,190
companies like AOL Google most recently

22
00:01:07,190 --> 00:01:09,200
Facebook and with a couple of startups

23
00:01:09,200 --> 00:01:11,660
in between so I like to think I've got a

24
00:01:11,660 --> 00:01:13,040
pretty good perspective on this whole

25
00:01:13,040 --> 00:01:19,190
hold javascript thing um as far as my my

26
00:01:19,190 --> 00:01:22,220
street cred with node goes I've got my

27
00:01:22,220 --> 00:01:23,810
fingers on a couple of little things I

28
00:01:23,810 --> 00:01:25,460
would say like modules that are more

29
00:01:25,460 --> 00:01:26,900
micro libraries than anything else

30
00:01:26,900 --> 00:01:30,350
things like node mine which i guess is

31
00:01:30,350 --> 00:01:32,720
used and expressed and and connect these

32
00:01:32,720 --> 00:01:36,830
days if you want to do RFC compliant

33
00:01:36,830 --> 00:01:39,380
uuid generation my node uuid library is

34
00:01:39,380 --> 00:01:43,160
the way to go jayus litmus is a ad hoc

35
00:01:43,160 --> 00:01:46,580
benchmarking library I did that was the

36
00:01:46,580 --> 00:01:48,920
basis of jas perf calm and then

37
00:01:48,920 --> 00:01:51,439
a little library for doing n64

38
00:01:51,439 --> 00:01:55,670
manipulation in a node thrift which

39
00:01:55,670 --> 00:01:57,950
way'd winsome as has been putting

40
00:01:57,950 --> 00:02:02,869
together and then within Facebook I seem

41
00:02:02,869 --> 00:02:04,580
to have fallen into the role of internal

42
00:02:04,580 --> 00:02:08,479
node evangelist so Adam wolf and I run

43
00:02:08,479 --> 00:02:11,120
the the node group that's internal to

44
00:02:11,120 --> 00:02:13,130
Facebook and I'll talk a little talk a

45
00:02:13,130 --> 00:02:14,360
little bit more about what exactly that

46
00:02:14,360 --> 00:02:18,440
means to evangelize within a company so

47
00:02:18,440 --> 00:02:19,760
let me set the background for this a

48
00:02:19,760 --> 00:02:22,220
little bit just to give you guys some

49
00:02:22,220 --> 00:02:24,410
context and maybe to give those of you

50
00:02:24,410 --> 00:02:26,030
who are here thinking I'm going to be

51
00:02:26,030 --> 00:02:28,190
talking about us deploying thousands of

52
00:02:28,190 --> 00:02:30,650
servers in production and all the hard

53
00:02:30,650 --> 00:02:33,310
data and stuff that we learned from that

54
00:02:33,310 --> 00:02:35,630
opportunity to go head over to Isaac's

55
00:02:35,630 --> 00:02:38,239
talk because the reality is Facebook

56
00:02:38,239 --> 00:02:40,209
isn't doing enough with node right now

57
00:02:40,209 --> 00:02:44,239
we're actually just getting started but

58
00:02:44,239 --> 00:02:46,010
I think what we are doing is pretty

59
00:02:46,010 --> 00:02:47,870
interesting and more importantly what I

60
00:02:47,870 --> 00:02:51,230
really want to talk about today is it's

61
00:02:51,230 --> 00:02:53,209
sort of the note in the context of a

62
00:02:53,209 --> 00:02:55,100
large company like Facebook where you

63
00:02:55,100 --> 00:02:57,260
have to you have to deal with things at

64
00:02:57,260 --> 00:03:00,799
a scale that really aren't being done at

65
00:03:00,799 --> 00:03:02,750
very many other places around the well

66
00:03:02,750 --> 00:03:08,959
around the country around the world so

67
00:03:08,959 --> 00:03:10,459
what I'm going to talk about today is

68
00:03:10,459 --> 00:03:11,989
like I said isn't really going to be

69
00:03:11,989 --> 00:03:13,609
nuts and bolts details on how you deploy

70
00:03:13,609 --> 00:03:15,590
thousands of nodes servers it's going to

71
00:03:15,590 --> 00:03:18,470
be more about why I think facebook needs

72
00:03:18,470 --> 00:03:22,130
node why we're not embracing it yet why

73
00:03:22,130 --> 00:03:23,829
we're not that far along the curve and

74
00:03:23,829 --> 00:03:26,090
what I and some of the other folks

75
00:03:26,090 --> 00:03:27,500
within the company are doing to change

76
00:03:27,500 --> 00:03:30,170
that and to what extent we're failing or

77
00:03:30,170 --> 00:03:37,819
succeeding in that so why does why does

78
00:03:37,819 --> 00:03:39,980
it company like Facebook need node I

79
00:03:39,980 --> 00:03:42,049
mean one of the things that that we run

80
00:03:42,049 --> 00:03:43,670
into or that I run into when I talk to

81
00:03:43,670 --> 00:03:45,530
people within our company who aren't

82
00:03:45,530 --> 00:03:49,069
note enthusiasts by nature is sort of

83
00:03:49,069 --> 00:03:51,049
this well they're not impressed reaction

84
00:03:51,049 --> 00:03:53,180
and a large part of that is I think that

85
00:03:53,180 --> 00:03:54,920
the things that get JavaScript people

86
00:03:54,920 --> 00:03:56,810
excited coming from sort of the client

87
00:03:56,810 --> 00:03:57,880
JavaScript Amy

88
00:03:57,880 --> 00:04:00,100
and having access to server side

89
00:04:00,100 --> 00:04:01,990
JavaScript and you know in the form of

90
00:04:01,990 --> 00:04:04,830
you know the single threaded event loop

91
00:04:04,830 --> 00:04:07,150
just don't really turn them on there's

92
00:04:07,150 --> 00:04:08,170
all these it there's all these

93
00:04:08,170 --> 00:04:10,270
alternatives out there like lie bv live

94
00:04:10,270 --> 00:04:13,900
event tornado event machine those

95
00:04:13,900 --> 00:04:15,550
technical problems have been solved in

96
00:04:15,550 --> 00:04:16,840
other languages you can solve them in

97
00:04:16,840 --> 00:04:20,650
other languages and especially at

98
00:04:20,650 --> 00:04:23,290
facebook where we already have you know

99
00:04:23,290 --> 00:04:26,020
hundreds of millions of users and that

100
00:04:26,020 --> 00:04:28,420
are being supported on servers by by

101
00:04:28,420 --> 00:04:30,850
thousands of servers when you talk to

102
00:04:30,850 --> 00:04:31,870
the people who put that there to put

103
00:04:31,870 --> 00:04:34,600
that system in place it's really hard to

104
00:04:34,600 --> 00:04:39,280
argue with success so there is a there

105
00:04:39,280 --> 00:04:40,930
is a significant amount of I think well

106
00:04:40,930 --> 00:04:44,470
justified resistance there so it does

107
00:04:44,470 --> 00:04:46,990
beg this question of like well where is

108
00:04:46,990 --> 00:04:49,060
the value to a really large company that

109
00:04:49,060 --> 00:04:51,460
has established itself with technologies

110
00:04:51,460 --> 00:04:56,110
that they're working and I guess the

111
00:04:56,110 --> 00:04:57,070
answer to that I've actually been

112
00:04:57,070 --> 00:04:58,450
thinking about this fair bit lately and

113
00:04:58,450 --> 00:04:59,770
the answer that I guess I'll have to

114
00:04:59,770 --> 00:05:02,470
sort of give you an anecdote from the

115
00:05:02,470 --> 00:05:04,300
dark days of the internet when when I

116
00:05:04,300 --> 00:05:07,570
first started doing JavaScript and this

117
00:05:07,570 --> 00:05:10,770
was a small start-up I did back in

118
00:05:10,770 --> 00:05:13,870
1999-2000 that was started by I and

119
00:05:13,870 --> 00:05:17,560
three of my friends and of course one of

120
00:05:17,560 --> 00:05:19,360
those was his CEO who's off doing CEO

121
00:05:19,360 --> 00:05:22,690
things and the three of us were that

122
00:05:22,690 --> 00:05:23,980
left three of us to do the end to be

123
00:05:23,980 --> 00:05:25,240
through the engineering side of the

124
00:05:25,240 --> 00:05:27,220
company and what we were doing was

125
00:05:27,220 --> 00:05:30,340
building a well the goal the company was

126
00:05:30,340 --> 00:05:32,800
to build microsoft office for the web so

127
00:05:32,800 --> 00:05:36,280
Google Docs but done with JavaScript d

128
00:05:36,280 --> 00:05:38,890
HTML and our first product was going to

129
00:05:38,890 --> 00:05:40,870
be a productivity application

130
00:05:40,870 --> 00:05:45,430
application so when we sat down the

131
00:05:45,430 --> 00:05:46,420
three of us sort of looked at each other

132
00:05:46,420 --> 00:05:47,560
and like well we know we're going to be

133
00:05:47,560 --> 00:05:51,840
using javascript and HTML on the client

134
00:05:51,840 --> 00:05:54,910
apache and java java servlets on the

135
00:05:54,910 --> 00:05:57,310
middle layer and my suit my sequel in

136
00:05:57,310 --> 00:05:59,650
SQL and a back-end and we had this

137
00:05:59,650 --> 00:06:01,240
discussion of like okay well who's gonna

138
00:06:01,240 --> 00:06:02,800
who's going to do what what are the

139
00:06:02,800 --> 00:06:05,860
roles were going to assign and i ended

140
00:06:05,860 --> 00:06:07,870
up drawing the short straw

141
00:06:07,870 --> 00:06:12,940
found myself doing JavaScript so you

142
00:06:12,940 --> 00:06:14,830
know that's what I ended up doing for

143
00:06:14,830 --> 00:06:17,140
the next 12 years and sort of the irony

144
00:06:17,140 --> 00:06:18,940
at the time was I never thought I was

145
00:06:18,940 --> 00:06:20,290
going to put that on my resume because I

146
00:06:20,290 --> 00:06:21,670
was sure this whole javascript thing was

147
00:06:21,670 --> 00:06:25,360
just a passing fad so it fortunately

148
00:06:25,360 --> 00:06:30,310
hasn't turned out that way the point of

149
00:06:30,310 --> 00:06:33,280
this is that in that on that project and

150
00:06:33,280 --> 00:06:34,960
pretty much every project I've been on

151
00:06:34,960 --> 00:06:39,460
every web based application effort I've

152
00:06:39,460 --> 00:06:41,290
under I've undergone has had this very

153
00:06:41,290 --> 00:06:43,660
early conversation where engineers have

154
00:06:43,660 --> 00:06:46,510
been cubby hold into one of those slots

155
00:06:46,510 --> 00:06:48,880
are you a front-end engineer middle you

156
00:06:48,880 --> 00:06:50,200
know middle where are you a back-end

157
00:06:50,200 --> 00:06:56,020
database guy and um well that can be a

158
00:06:56,020 --> 00:06:58,570
good thing I mean after all it does lead

159
00:06:58,570 --> 00:06:59,830
to these conversations between people

160
00:06:59,830 --> 00:07:03,190
that about well okay you've got you've

161
00:07:03,190 --> 00:07:05,080
got Fred on the front end who needs

162
00:07:05,080 --> 00:07:06,730
Maria doing who's doing the middleware

163
00:07:06,730 --> 00:07:09,190
stuff to implement some point

164
00:07:09,190 --> 00:07:11,830
functionality for and that enables this

165
00:07:11,830 --> 00:07:13,180
conversation about well how should with

166
00:07:13,180 --> 00:07:15,340
that what should that API look like to

167
00:07:15,340 --> 00:07:18,910
what extent do do we need logic in that

168
00:07:18,910 --> 00:07:22,540
middle layer versus on the client and it

169
00:07:22,540 --> 00:07:24,040
creates these very well-thought-out

170
00:07:24,040 --> 00:07:26,590
api's these very nice and modular and

171
00:07:26,590 --> 00:07:29,500
structured interfaces at the end of the

172
00:07:29,500 --> 00:07:31,480
day it really slows you down you have to

173
00:07:31,480 --> 00:07:36,460
have this conversation and more

174
00:07:36,460 --> 00:07:39,040
importantly it doesn't it doesn't allow

175
00:07:39,040 --> 00:07:40,840
you to really distribute your resources

176
00:07:40,840 --> 00:07:43,570
and one of the things that from that you

177
00:07:43,570 --> 00:07:45,730
know from that company that really stuck

178
00:07:45,730 --> 00:07:49,480
with me at the time was was a period

179
00:07:49,480 --> 00:07:51,820
when we were actually in talks with AOL

180
00:07:51,820 --> 00:07:55,210
to get acquired and they became to us on

181
00:07:55,210 --> 00:07:57,370
a Monday and said hey you know we really

182
00:07:57,370 --> 00:07:59,440
like this technology developed and this

183
00:07:59,440 --> 00:08:01,060
team and you know you're selling us on

184
00:08:01,060 --> 00:08:03,700
this whole stack of JavaScript d you

185
00:08:03,700 --> 00:08:05,590
know really interactive applications but

186
00:08:05,590 --> 00:08:07,930
we'd like you to prove that and what

187
00:08:07,930 --> 00:08:09,370
we'd like you to do is build us a web

188
00:08:09,370 --> 00:08:11,670
calendar a prototype because they had a

189
00:08:11,670 --> 00:08:13,990
traditional static calendar application

190
00:08:13,990 --> 00:08:16,240
and it was really for the slow and laggy

191
00:08:16,240 --> 00:08:18,540
all these page turns

192
00:08:18,540 --> 00:08:22,140
and so um they said yeah you know come

193
00:08:22,140 --> 00:08:23,910
back a week from now and show us what

194
00:08:23,910 --> 00:08:25,320
you've done with this you know give us a

195
00:08:25,320 --> 00:08:27,600
prototype and of course our CEO being a

196
00:08:27,600 --> 00:08:29,280
CEO immediately turned to us and said

197
00:08:29,280 --> 00:08:31,110
hey I don't want to give them a

198
00:08:31,110 --> 00:08:32,100
prototype I want to give them a

199
00:08:32,100 --> 00:08:35,070
full-blown application and they're in

200
00:08:35,070 --> 00:08:36,990
soo this conversation where we sort of

201
00:08:36,990 --> 00:08:39,270
all turn to rob davis who was on our

202
00:08:39,270 --> 00:08:40,950
back end and said hey what do we need to

203
00:08:40,950 --> 00:08:43,050
do this and he said well give me a half

204
00:08:43,050 --> 00:08:44,400
an hour and i'll implement the schema

205
00:08:44,400 --> 00:08:45,930
you need for calendar events in our

206
00:08:45,930 --> 00:08:47,970
database and so you know half an hour

207
00:08:47,970 --> 00:08:50,880
later he came back and then we turn and

208
00:08:50,880 --> 00:08:52,080
then we turn to Keith in the middle

209
00:08:52,080 --> 00:08:53,190
layer and was like well what do we need

210
00:08:53,190 --> 00:08:54,990
to transport this data back and forth

211
00:08:54,990 --> 00:08:57,260
between the server in the front end and

212
00:08:57,260 --> 00:08:59,400
keith is like well i really need to do

213
00:08:59,400 --> 00:09:00,720
is whitelist the data types that were

214
00:09:00,720 --> 00:09:03,240
sending and then they all looked at me

215
00:09:03,240 --> 00:09:05,400
and like okay we need a calendar app and

216
00:09:05,400 --> 00:09:07,470
you've got a week and i ended up

217
00:09:07,470 --> 00:09:10,200
spending something like 120 hours over

218
00:09:10,200 --> 00:09:11,670
the next week writing all this

219
00:09:11,670 --> 00:09:13,980
javascript for a full-blown calendar

220
00:09:13,980 --> 00:09:15,780
application it was incredibly rewarding

221
00:09:15,780 --> 00:09:18,380
i mean it was an intense period of time

222
00:09:18,380 --> 00:09:21,300
and it worked out really well AOL loved

223
00:09:21,300 --> 00:09:23,190
it and my you know my wife went to take

224
00:09:23,190 --> 00:09:25,320
me to dinner afterwards on the you know

225
00:09:25,320 --> 00:09:26,940
after we'd given the presentation is

226
00:09:26,940 --> 00:09:28,910
sort of a little celebratory thing and

227
00:09:28,910 --> 00:09:31,440
about halfway through dinner i literally

228
00:09:31,440 --> 00:09:34,440
just started shaking chills and you know

229
00:09:34,440 --> 00:09:35,970
just completely exhausted and I was like

230
00:09:35,970 --> 00:09:39,060
you know honey we gotta go home and the

231
00:09:39,060 --> 00:09:40,710
reason I the reason why I'm going down

232
00:09:40,710 --> 00:09:43,590
this path is that had we been using node

233
00:09:43,590 --> 00:09:46,140
had we had JavaScript throughout our

234
00:09:46,140 --> 00:09:48,270
whole technology stack instead of

235
00:09:48,270 --> 00:09:50,070
everybody turning to me as the front end

236
00:09:50,070 --> 00:09:51,780
guy and saying hey you've got to

237
00:09:51,780 --> 00:09:53,040
implement this you're the only one

238
00:09:53,040 --> 00:09:55,320
that's got this experience we could have

239
00:09:55,320 --> 00:09:56,520
turned to the whole team and said hey

240
00:09:56,520 --> 00:09:57,840
you know I know you guys have been doing

241
00:09:57,840 --> 00:09:59,340
JavaScript in the middle layer and back

242
00:09:59,340 --> 00:10:01,350
in but it's the same line which is the

243
00:10:01,350 --> 00:10:03,510
same basic patterns and you can bring

244
00:10:03,510 --> 00:10:05,040
all of that to the front you know to the

245
00:10:05,040 --> 00:10:06,600
front-end development and really make

246
00:10:06,600 --> 00:10:08,160
that work for us and instead of me doing

247
00:10:08,160 --> 00:10:10,110
120 hours it would have been you know

248
00:10:10,110 --> 00:10:11,400
three of us putting in a normal work

249
00:10:11,400 --> 00:10:13,950
week um which would work that would have

250
00:10:13,950 --> 00:10:15,120
worked out a lot better and probably

251
00:10:15,120 --> 00:10:18,810
produced a better product in the end so

252
00:10:18,810 --> 00:10:22,290
the point being for me the real value in

253
00:10:22,290 --> 00:10:25,290
is not in not so much the technology

254
00:10:25,290 --> 00:10:26,820
side of things but it's the

255
00:10:26,820 --> 00:10:28,560
organizational and the cultural

256
00:10:28,560 --> 00:10:30,690
differences in options that it enables

257
00:10:30,690 --> 00:10:34,620
and I think that's often overlooked and

258
00:10:34,620 --> 00:10:36,540
a small start-up you tend to get a lot

259
00:10:36,540 --> 00:10:39,990
of cross discipline expertise anyways

260
00:10:39,990 --> 00:10:41,550
but when you get into larger companies

261
00:10:41,550 --> 00:10:44,610
like Facebook that's definitely less the

262
00:10:44,610 --> 00:10:46,740
case and I think pretty much any project

263
00:10:46,740 --> 00:10:48,000
that's got more than three people on it

264
00:10:48,000 --> 00:10:50,160
has this degree of specialization to

265
00:10:50,160 --> 00:10:57,690
some extent um so if there's this

266
00:10:57,690 --> 00:11:00,360
benefit like why why isn't Facebook

267
00:11:00,360 --> 00:11:02,880
going down this garden path you know why

268
00:11:02,880 --> 00:11:04,319
aren't we why aren't we jumping all over

269
00:11:04,319 --> 00:11:06,029
node and you know I think there's a lot

270
00:11:06,029 --> 00:11:07,769
of reasons for that but the one that

271
00:11:07,769 --> 00:11:11,160
really came to mind for me was basically

272
00:11:11,160 --> 00:11:12,839
you know that that's saying about a

273
00:11:12,839 --> 00:11:14,069
million monkeys at a million typewriters

274
00:11:14,069 --> 00:11:16,529
eventually producing the collected works

275
00:11:16,529 --> 00:11:21,300
of Shakespeare at Facebook we've got 600

276
00:11:21,300 --> 00:11:25,560
million and not to say our users are

277
00:11:25,560 --> 00:11:26,970
monkeys so please don't tweet that

278
00:11:26,970 --> 00:11:28,589
because my boss is in the audience and

279
00:11:28,589 --> 00:11:33,899
I'll get a call from HR but what we do

280
00:11:33,899 --> 00:11:36,029
what we do have is just millions of

281
00:11:36,029 --> 00:11:38,220
users that do all sorts of inexplicable

282
00:11:38,220 --> 00:11:40,589
things and if you put a new technology

283
00:11:40,589 --> 00:11:43,019
in production without thoroughly vetting

284
00:11:43,019 --> 00:11:45,779
it they will discover every bug every

285
00:11:45,779 --> 00:11:48,120
design flaw every performance weakness

286
00:11:48,120 --> 00:11:51,480
that that technology has and the the

287
00:11:51,480 --> 00:11:54,750
results of that are these guys they go

288
00:11:54,750 --> 00:11:56,959
from being you know 600 million users to

289
00:11:56,959 --> 00:12:00,930
these guys 600 million monkeys angry

290
00:12:00,930 --> 00:12:03,240
monkeys and I have these all lined up

291
00:12:03,240 --> 00:12:04,440
for a reason because they're organized

292
00:12:04,440 --> 00:12:06,750
and you get things like the whole beacon

293
00:12:06,750 --> 00:12:10,260
fiasco and you know all this this hubbub

294
00:12:10,260 --> 00:12:12,209
over privacy issues not to dismiss that

295
00:12:12,209 --> 00:12:15,420
because that's very important but it's

296
00:12:15,420 --> 00:12:19,040
just no fun and so

297
00:12:19,040 --> 00:12:21,570
that's where a lot of the the resistance

298
00:12:21,570 --> 00:12:23,040
to note comes from in large

299
00:12:23,040 --> 00:12:26,700
organizations but that's also very hand

300
00:12:26,700 --> 00:12:29,460
wavy so let me go into a little bit more

301
00:12:29,460 --> 00:12:33,860
detail on what that means at Facebook

302
00:12:33,860 --> 00:12:37,200
performance is a top to your priority in

303
00:12:37,200 --> 00:12:39,600
ways that are really surprising to me

304
00:12:39,600 --> 00:12:40,530
I've actually only been at the company

305
00:12:40,530 --> 00:12:43,320
since July which by the way it makes me

306
00:12:43,320 --> 00:12:45,180
more senior than like forty four percent

307
00:12:45,180 --> 00:12:50,460
of the company it's bizarre uh-huh so

308
00:12:50,460 --> 00:12:51,810
one of the things that you find when you

309
00:12:51,810 --> 00:12:55,110
join facebook is there is a an intense

310
00:12:55,110 --> 00:12:57,840
focus on performance and cpu usage in

311
00:12:57,840 --> 00:13:00,810
particular if if you can come in and you

312
00:13:00,810 --> 00:13:03,210
can reduce average cpu usage on our web

313
00:13:03,210 --> 00:13:06,030
to your machines by 1% you will be a

314
00:13:06,030 --> 00:13:08,580
frickin rock star at the next

315
00:13:08,580 --> 00:13:10,260
engineering All Hands our vp of

316
00:13:10,260 --> 00:13:11,670
engineering will literally point you out

317
00:13:11,670 --> 00:13:14,190
in the audience ask you to stand up put

318
00:13:14,190 --> 00:13:15,990
your put your picture up on the screen

319
00:13:15,990 --> 00:13:17,880
and say this person is saving us

320
00:13:17,880 --> 00:13:21,950
millions of dollars it's that noteworthy

321
00:13:21,950 --> 00:13:25,980
1% we've also developed our own

322
00:13:25,980 --> 00:13:27,750
proprietary mama / re thats actually

323
00:13:27,750 --> 00:13:29,820
open source web server called hip-hop

324
00:13:29,820 --> 00:13:34,850
which is compiles PHP into native code

325
00:13:34,850 --> 00:13:38,070
because of this issue similarly

326
00:13:38,070 --> 00:13:40,380
reliability you know you need a system

327
00:13:40,380 --> 00:13:42,390
that's gonna going to be bomb-proof day

328
00:13:42,390 --> 00:13:44,730
in and day out or at least have well

329
00:13:44,730 --> 00:13:48,390
understood failure characteristics and

330
00:13:48,390 --> 00:13:50,580
both of these things i think the reality

331
00:13:50,580 --> 00:13:52,770
with node is right now is that for a

332
00:13:52,770 --> 00:13:54,830
company like Facebook or Google or Yahoo

333
00:13:54,830 --> 00:13:57,120
there's really nobody up for us to look

334
00:13:57,120 --> 00:13:58,860
around at and say oh those guys have

335
00:13:58,860 --> 00:14:03,020
done it these issues are understood and

336
00:14:03,020 --> 00:14:07,290
that's really scary and so the you know

337
00:14:07,290 --> 00:14:10,230
this issue is it's certainly foremost in

338
00:14:10,230 --> 00:14:11,940
the conversations I have with people and

339
00:14:11,940 --> 00:14:14,160
then there's some other secondary issues

340
00:14:14,160 --> 00:14:16,020
not related directly to the production

341
00:14:16,020 --> 00:14:18,620
performance things like code inertia

342
00:14:18,620 --> 00:14:21,620
Facebook has eight million lines of PHP

343
00:14:21,620 --> 00:14:24,420
and that ruin that represents an

344
00:14:24,420 --> 00:14:25,770
incredible investment of intellectual

345
00:14:25,770 --> 00:14:29,220
capital and just as an aside we have

346
00:14:29,220 --> 00:14:30,360
about three hundred thousand lines of

347
00:14:30,360 --> 00:14:31,420
JavaScript

348
00:14:31,420 --> 00:14:33,010
and the chat team has about twelve

349
00:14:33,010 --> 00:14:34,780
thousand lines of airline that the chat

350
00:14:34,780 --> 00:14:39,160
system runs so for people who care about

351
00:14:39,160 --> 00:14:43,100
that sort of things that sort of thing

352
00:14:43,110 --> 00:14:45,280
there's also things like deployment

353
00:14:45,280 --> 00:14:48,370
processes and tools at a company like

354
00:14:48,370 --> 00:14:50,290
Facebook where you have you know

355
00:14:50,290 --> 00:14:51,970
thousands of web servers and production

356
00:14:51,970 --> 00:14:53,620
rolling these things out is a

357
00:14:53,620 --> 00:14:56,290
non-trivial task and you need a lot of

358
00:14:56,290 --> 00:14:58,300
tools to help you do that and a lot of

359
00:14:58,300 --> 00:14:59,860
people put a lot of effort into that and

360
00:14:59,860 --> 00:15:03,270
of course any new technology makes that

361
00:15:03,270 --> 00:15:05,650
sort of rocks the boat in that regard

362
00:15:05,650 --> 00:15:09,550
and so your ops team your weekly push

363
00:15:09,550 --> 00:15:11,080
team that's responsible for these things

364
00:15:11,080 --> 00:15:12,010
they're going to look at you with a

365
00:15:12,010 --> 00:15:15,370
really wary eye and then finally in we

366
00:15:15,370 --> 00:15:17,050
have devtools so actually Facebook just

367
00:15:17,050 --> 00:15:18,130
open source the product called

368
00:15:18,130 --> 00:15:20,950
fabricator which is the internal tool be

369
00:15:20,950 --> 00:15:23,110
used for browsing our source repository

370
00:15:23,110 --> 00:15:27,250
and doing code reviews you may may want

371
00:15:27,250 --> 00:15:28,330
to check that out it's actually pretty

372
00:15:28,330 --> 00:15:30,490
cool I'm pretty impressed by how well

373
00:15:30,490 --> 00:15:35,140
that works so I think that's sort of the

374
00:15:35,140 --> 00:15:37,600
the litany of issues at the at the

375
00:15:37,600 --> 00:15:39,310
cultural level that we run into when

376
00:15:39,310 --> 00:15:41,530
talking about node with with people

377
00:15:41,530 --> 00:15:46,180
inside the company so how do we get

378
00:15:46,180 --> 00:15:47,980
across this chasm how do we actually get

379
00:15:47,980 --> 00:15:50,230
people inside the company to embrace

380
00:15:50,230 --> 00:15:52,480
this new technology that's got a lot of

381
00:15:52,480 --> 00:15:53,590
sort of unknown performance

382
00:15:53,590 --> 00:15:58,630
characteristics at Facebook scale so

383
00:15:58,630 --> 00:16:00,820
what would I and the other folks are

384
00:16:00,820 --> 00:16:02,860
within the company who are familiar with

385
00:16:02,860 --> 00:16:04,960
node and enthusiastic about it are doing

386
00:16:04,960 --> 00:16:06,580
is we started out with an internal

387
00:16:06,580 --> 00:16:07,930
internal group which you know is

388
00:16:07,930 --> 00:16:09,250
basically a mailing list there's nothing

389
00:16:09,250 --> 00:16:12,970
to revolutionary about that and that

390
00:16:12,970 --> 00:16:14,590
gives you some obvious benefits like it

391
00:16:14,590 --> 00:16:16,600
allows you to coordinate the people who

392
00:16:16,600 --> 00:16:18,130
are passionate about note all ready for

393
00:16:18,130 --> 00:16:21,550
whatever reason we have about 60 people

394
00:16:21,550 --> 00:16:22,900
in the group we share links to new

395
00:16:22,900 --> 00:16:25,600
updates new modules various information

396
00:16:25,600 --> 00:16:28,300
that that is pertinent to the sort of

397
00:16:28,300 --> 00:16:33,520
things we're doing it also lets you

398
00:16:33,520 --> 00:16:34,660
educate people who haven't heard about

399
00:16:34,660 --> 00:16:37,120
note or just curious about it they have

400
00:16:37,120 --> 00:16:38,770
a record of the discussion that's gone

401
00:16:38,770 --> 00:16:41,410
on before they found out about it gives

402
00:16:41,410 --> 00:16:43,600
them a way to discover events so we

403
00:16:43,600 --> 00:16:44,740
actually bring

404
00:16:44,740 --> 00:16:46,330
people to talk about it we've had Ryan

405
00:16:46,330 --> 00:16:48,880
and Matt Raney talk and that's been

406
00:16:48,880 --> 00:16:50,649
really well received and I think it's

407
00:16:50,649 --> 00:16:52,390
done a lot to really raise the awareness

408
00:16:52,390 --> 00:16:55,930
and then the really surprising benefit

409
00:16:55,930 --> 00:16:57,810
for me came in to lunch conversation

410
00:16:57,810 --> 00:16:59,980
that I was having with some folks that

411
00:16:59,980 --> 00:17:02,080
were in the node group and we were

412
00:17:02,080 --> 00:17:03,730
talking about node and sort of how we

413
00:17:03,730 --> 00:17:05,709
could get things you know moving inside

414
00:17:05,709 --> 00:17:08,530
Facebook and a guy named Ben Mauer who's

415
00:17:08,530 --> 00:17:12,579
the one of the founders of recaptcha the

416
00:17:12,579 --> 00:17:13,839
captcha technology that you see around

417
00:17:13,839 --> 00:17:17,350
the web alot kept pushing back and in

418
00:17:17,350 --> 00:17:20,020
ways that i found kind of negative and

419
00:17:20,020 --> 00:17:21,760
it was very disconcerting and i

420
00:17:21,760 --> 00:17:22,990
eventually called him out on it i was

421
00:17:22,990 --> 00:17:25,689
like dude why you know if you're this

422
00:17:25,689 --> 00:17:27,459
down on node like why are you down on it

423
00:17:27,459 --> 00:17:28,809
in the first place and further why are

424
00:17:28,809 --> 00:17:32,710
you even in this group and his response

425
00:17:32,710 --> 00:17:34,420
was essentially well I want to make sure

426
00:17:34,420 --> 00:17:37,000
you guys don't do anything stupid and I

427
00:17:37,000 --> 00:17:38,230
really don't think it's a good idea for

428
00:17:38,230 --> 00:17:40,000
facebook to embree be embracing more

429
00:17:40,000 --> 00:17:41,380
technologies and fat as a matter of fact

430
00:17:41,380 --> 00:17:43,660
we should be using less and so he came

431
00:17:43,660 --> 00:17:46,620
from the camp of simplicity being a

432
00:17:46,620 --> 00:17:49,450
really important priority and a really

433
00:17:49,450 --> 00:17:52,150
good way of minimizing the the overhead

434
00:17:52,150 --> 00:17:53,980
involved in running all the systems that

435
00:17:53,980 --> 00:17:56,950
Facebook runs and it took me a while to

436
00:17:56,950 --> 00:17:58,240
come around to this point of view I

437
00:17:58,240 --> 00:18:00,130
actually agree with him you know in

438
00:18:00,130 --> 00:18:02,200
general you do want to have as few

439
00:18:02,200 --> 00:18:04,290
technologies as possible at a company I

440
00:18:04,290 --> 00:18:06,280
just happen to think node should be one

441
00:18:06,280 --> 00:18:10,480
of those so um after thinking about this

442
00:18:10,480 --> 00:18:12,040
for a while I realized that he's

443
00:18:12,040 --> 00:18:13,390
actually doing an incredibly valuable

444
00:18:13,390 --> 00:18:15,940
service for us and that he is keeping an

445
00:18:15,940 --> 00:18:17,830
eye on us and making sure we don't screw

446
00:18:17,830 --> 00:18:19,900
up pretty much early and really alien

447
00:18:19,900 --> 00:18:21,790
alienate ourselves by doing something

448
00:18:21,790 --> 00:18:24,220
that's going to permanently get people

449
00:18:24,220 --> 00:18:28,120
resistant to the idea of node so you

450
00:18:28,120 --> 00:18:29,620
know embrace your critics they're your

451
00:18:29,620 --> 00:18:35,800
best friends and then in actual

452
00:18:35,800 --> 00:18:37,270
practical terms in terms of what we're

453
00:18:37,270 --> 00:18:40,120
doing with node we're trying to use it

454
00:18:40,120 --> 00:18:41,980
everywhere we can that doesn't doesn't

455
00:18:41,980 --> 00:18:44,410
put us in critical spots right now so

456
00:18:44,410 --> 00:18:46,450
and ideally we're doing that in places

457
00:18:46,450 --> 00:18:47,800
that allow us to touch the critical

458
00:18:47,800 --> 00:18:49,330
systems so let me talk a little bit

459
00:18:49,330 --> 00:18:53,220
about what that means in practical terms

460
00:18:53,220 --> 00:18:56,140
this is sort of the menu of what we're

461
00:18:56,140 --> 00:18:56,999
doing right now

462
00:18:56,999 --> 00:18:58,709
and one of the advantages of having that

463
00:18:58,709 --> 00:19:02,099
that node group is it lets us get a

464
00:19:02,099 --> 00:19:03,449
pretty good idea of who's doing a lot

465
00:19:03,449 --> 00:19:05,189
with a note inside Facebook and and so

466
00:19:05,189 --> 00:19:08,189
here's the menu to start off with I

467
00:19:08,189 --> 00:19:09,449
don't know how many people have heard of

468
00:19:09,449 --> 00:19:10,979
j s game bench actually if you could

469
00:19:10,979 --> 00:19:12,449
raise your hands like it knows what Jays

470
00:19:12,449 --> 00:19:16,499
game inches okay so James game bench is

471
00:19:16,499 --> 00:19:19,949
a JavaScript benchmarking suite for

472
00:19:19,949 --> 00:19:22,619
html5 technologies related to game

473
00:19:22,619 --> 00:19:24,599
development it's put together by a guy

474
00:19:24,599 --> 00:19:28,799
named cauri and rekha and Bruce Adam do

475
00:19:28,799 --> 00:19:33,019
you remember Bruce's a Bruce Rogers and

476
00:19:33,019 --> 00:19:35,249
it's actually pretty cool because what

477
00:19:35,249 --> 00:19:36,719
they're doing is bringing in much the

478
00:19:36,719 --> 00:19:38,489
way like son by sunspider tests of

479
00:19:38,489 --> 00:19:40,229
brought attention to javascript

480
00:19:40,229 --> 00:19:42,029
performance they're bringing attention

481
00:19:42,029 --> 00:19:46,709
to WebGL performance CSS animations and

482
00:19:46,709 --> 00:19:48,689
various other technologies that game

483
00:19:48,689 --> 00:19:51,659
developers are likely to use that's open

484
00:19:51,659 --> 00:19:53,279
source and it comes with a node server

485
00:19:53,279 --> 00:19:55,169
that you can use to run the tests and

486
00:19:55,169 --> 00:19:58,019
the benchmarks we have a mobile

487
00:19:58,019 --> 00:19:59,549
JavaScript framework under development

488
00:19:59,549 --> 00:20:02,459
that will be announcing I don't actually

489
00:20:02,459 --> 00:20:04,079
know one will be announcing it but the

490
00:20:04,079 --> 00:20:07,709
intent is to open source that that uses

491
00:20:07,709 --> 00:20:10,499
node for both a test server and also as

492
00:20:10,499 --> 00:20:14,459
a build tool so in those cases I would

493
00:20:14,459 --> 00:20:16,289
say there there's nothing too

494
00:20:16,289 --> 00:20:17,669
extraordinary about those they are

495
00:20:17,669 --> 00:20:20,579
fairly small projects the bulk of our

496
00:20:20,579 --> 00:20:21,989
node work is actually being done on the

497
00:20:21,989 --> 00:20:24,989
chat team and I think that's something

498
00:20:24,989 --> 00:20:27,989
that it was really and it's something

499
00:20:27,989 --> 00:20:29,369
that we sort of brought to the table as

500
00:20:29,369 --> 00:20:32,129
mostly just because it gave us an

501
00:20:32,129 --> 00:20:33,689
opportunity to explore the performance

502
00:20:33,689 --> 00:20:37,949
characteristics of node so what we're

503
00:20:37,949 --> 00:20:40,979
using it for is doing traffic analysis

504
00:20:40,979 --> 00:20:44,099
of our production chat system so we

505
00:20:44,099 --> 00:20:45,779
actually set up port replication and

506
00:20:45,779 --> 00:20:48,959
we'll pull TCP traffic pull out a TCP

507
00:20:48,959 --> 00:20:50,429
dump that over the course of an hour or

508
00:20:50,429 --> 00:20:53,159
so and run that data through through

509
00:20:53,159 --> 00:20:55,379
node and use the node pcap library to

510
00:20:55,379 --> 00:20:59,369
analyze and get a get a performance or

511
00:20:59,369 --> 00:21:01,469
rather a traffic profile of the HTTP and

512
00:21:01,469 --> 00:21:03,869
thrift traffic and then we actually use

513
00:21:03,869 --> 00:21:05,399
that and feed that information into our

514
00:21:05,399 --> 00:21:07,360
load testing system that we use to

515
00:21:07,360 --> 00:21:08,920
to actually test these production

516
00:21:08,920 --> 00:21:13,270
systems and the cool thing about this is

517
00:21:13,270 --> 00:21:15,370
that because we're using node alongside

518
00:21:15,370 --> 00:21:17,860
this production data it actually gives

519
00:21:17,860 --> 00:21:20,500
us a pretty good data point for how the

520
00:21:20,500 --> 00:21:24,450
how node will perform in production and

521
00:21:24,450 --> 00:21:26,559
unfortunately I don't really have hard

522
00:21:26,559 --> 00:21:27,929
numbers i can give you folks because

523
00:21:27,929 --> 00:21:30,010
we've been pretty heads down i'm just

524
00:21:30,010 --> 00:21:31,720
trying to get this stuff working and i

525
00:21:31,720 --> 00:21:34,150
don't know that we have a good enough

526
00:21:34,150 --> 00:21:35,470
feel for what these performance

527
00:21:35,470 --> 00:21:36,910
characteristics really are yet to go

528
00:21:36,910 --> 00:21:38,740
public with those but that certainly

529
00:21:38,740 --> 00:21:42,040
would be would be our intent I can I can

530
00:21:42,040 --> 00:21:44,049
hand wave around things like for example

531
00:21:44,049 --> 00:21:46,960
that that hours worth of traffic data we

532
00:21:46,960 --> 00:21:48,370
run that through note in about ten

533
00:21:48,370 --> 00:21:51,340
minutes a single node process so for

534
00:21:51,340 --> 00:21:53,410
example we do know that if we put note

535
00:21:53,410 --> 00:21:55,750
in production as a monitoring and

536
00:21:55,750 --> 00:21:58,510
analysis system it we shouldn't have any

537
00:21:58,510 --> 00:22:00,490
problem there performance wise it should

538
00:22:00,490 --> 00:22:02,020
be able to handle handle the traffic we

539
00:22:02,020 --> 00:22:05,260
throw at it as far as bandwidth and cpu

540
00:22:05,260 --> 00:22:08,470
required there and then the last thing

541
00:22:08,470 --> 00:22:09,760
that we're doing on that chat team and

542
00:22:09,760 --> 00:22:11,650
this is more just my own efforts is

543
00:22:11,650 --> 00:22:12,880
we're using it for what I call

544
00:22:12,880 --> 00:22:16,090
production hacking so I've actually

545
00:22:16,090 --> 00:22:18,309
found it to be really useful to set up a

546
00:22:18,309 --> 00:22:20,890
node proxy server that alters the

547
00:22:20,890 --> 00:22:22,630
behavior of our production system in a

548
00:22:22,630 --> 00:22:24,220
way that I can still use the test with

549
00:22:24,220 --> 00:22:26,380
the front end client so for example I

550
00:22:26,380 --> 00:22:28,750
wanted to I'm in the process of adding

551
00:22:28,750 --> 00:22:31,450
support for xhr and cores which require

552
00:22:31,450 --> 00:22:34,480
various origin related headers in the

553
00:22:34,480 --> 00:22:38,620
HTT HTT P packet and rather than going

554
00:22:38,620 --> 00:22:40,179
in and mucking around in the airline

555
00:22:40,179 --> 00:22:42,220
system and setting up my own tier of

556
00:22:42,220 --> 00:22:44,559
back-end chat servers and then figure

557
00:22:44,559 --> 00:22:45,700
out figure out how to reconfigure

558
00:22:45,700 --> 00:22:47,200
everything so that my account the points

559
00:22:47,200 --> 00:22:50,500
to that I instead just set up a you know

560
00:22:50,500 --> 00:22:52,330
tell Firefox that point in my little

561
00:22:52,330 --> 00:22:54,700
node proxy which I which I've set up to

562
00:22:54,700 --> 00:22:56,260
actually modify those headers on the fly

563
00:22:56,260 --> 00:22:57,730
in both directions and I can actually

564
00:22:57,730 --> 00:23:00,549
add xhr core support to our production

565
00:23:00,549 --> 00:23:04,330
system on my local box it's pretty cool

566
00:23:04,330 --> 00:23:06,400
trick I highly recommend it I've done it

567
00:23:06,400 --> 00:23:07,570
I've done stuff like that in a couple

568
00:23:07,570 --> 00:23:10,450
cases and then the last thing we've done

569
00:23:10,450 --> 00:23:13,299
is just enhance our internal tool chain

570
00:23:13,299 --> 00:23:15,730
for deploying systems to actually

571
00:23:15,730 --> 00:23:23,050
support node and NPM so um that's pretty

572
00:23:23,050 --> 00:23:24,520
much the presentation there's a saying

573
00:23:24,520 --> 00:23:28,330
at face book that we're one percent done

574
00:23:28,330 --> 00:23:30,100
and you see little stickers all over the

575
00:23:30,100 --> 00:23:31,690
place you know this chair is one percent

576
00:23:31,690 --> 00:23:33,700
done this food is one percent done this

577
00:23:33,700 --> 00:23:35,650
toilets one perfect one percent flushed

578
00:23:35,650 --> 00:23:38,260
it's very cheesy but I actually think

579
00:23:38,260 --> 00:23:41,590
it's what it gets a ton yet what are you

580
00:23:41,590 --> 00:23:44,559
with that underlying with what that gets

581
00:23:44,559 --> 00:23:46,600
at in the underlying statement is really

582
00:23:46,600 --> 00:23:48,970
that it's a journey and in this case

583
00:23:48,970 --> 00:23:51,160
we're not doing as much with notice i

584
00:23:51,160 --> 00:23:53,260
think we'd like to be doing you know

585
00:23:53,260 --> 00:23:55,330
we're one percent of the way but I'm

586
00:23:55,330 --> 00:23:57,130
hopeful that in a year's time when we

587
00:23:57,130 --> 00:24:00,220
come back that I'll have I'll have hard

588
00:24:00,220 --> 00:24:02,050
data on what our performance is that

589
00:24:02,050 --> 00:24:03,160
I'll be able to tell you guys yet

590
00:24:03,160 --> 00:24:05,080
Facebook is running a thousand node

591
00:24:05,080 --> 00:24:07,720
servers in production and it's saved us

592
00:24:07,720 --> 00:24:10,660
this much CPU and you know and our

593
00:24:10,660 --> 00:24:12,400
bandwidth our costs are down by X number

594
00:24:12,400 --> 00:24:15,340
of dollars but I'll also still finish

595
00:24:15,340 --> 00:24:17,260
with this slide that says we're one

596
00:24:17,260 --> 00:24:18,790
percent done because I'm sure at that

597
00:24:18,790 --> 00:24:21,940
time look the capabilities of node and

598
00:24:21,940 --> 00:24:23,950
the landscape of the node community will

599
00:24:23,950 --> 00:24:26,950
be that much larger so that's it if you

600
00:24:26,950 --> 00:24:29,620
have any questions the question is what

601
00:24:29,620 --> 00:24:35,060
are the airline guys think of node I

602
00:24:35,070 --> 00:24:37,120
actually love it that's actually good

603
00:24:37,120 --> 00:24:39,280
question because the short answer is

604
00:24:39,280 --> 00:24:41,440
they actually like the airline system

605
00:24:41,440 --> 00:24:44,230
they think it's it's perfectly capable

606
00:24:44,230 --> 00:24:46,240
of handling the traffic of what we have

607
00:24:46,240 --> 00:24:49,870
today and I'm inclined you know and it

608
00:24:49,870 --> 00:24:53,679
seems to be working the flip side of

609
00:24:53,679 --> 00:24:55,750
that is the airline guys that originally

610
00:24:55,750 --> 00:24:58,290
wrote note I wrote the chat system are

611
00:24:58,290 --> 00:25:00,549
pretty burned down on it and have gone

612
00:25:00,549 --> 00:25:04,150
on to other projects and have left us in

613
00:25:04,150 --> 00:25:06,250
some way you know I won't say this to

614
00:25:06,250 --> 00:25:09,820
you know with too much resentment but

615
00:25:09,820 --> 00:25:11,409
we've been kind of left holding the bag

616
00:25:11,409 --> 00:25:13,600
and trying to find good airline

617
00:25:13,600 --> 00:25:15,610
developers is a real challenge and I

618
00:25:15,610 --> 00:25:17,230
think it gets back to it that point I

619
00:25:17,230 --> 00:25:20,470
made about having us having a single

620
00:25:20,470 --> 00:25:22,360
technology throughout your up and up and

621
00:25:22,360 --> 00:25:23,800
down your staff actually gives you a lot

622
00:25:23,800 --> 00:25:28,000
more options so um but yeah I mean

623
00:25:28,000 --> 00:25:29,380
there's it's really interesting

624
00:25:29,380 --> 00:25:31,179
conversation to get into the details of

625
00:25:31,179 --> 00:25:35,830
how airline and no to compare anything

