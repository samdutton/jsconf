1
00:00:34,570 --> 00:00:37,450

or just exciting thing about gaming it

2
00:00:37,450 --> 00:00:39,010
was really fun so we're going to keep

3
00:00:39,010 --> 00:00:40,870
the fun rolling with an in-depth look at

4
00:00:40,870 --> 00:00:41,920
part of the web application

5
00:00:41,920 --> 00:00:44,500
specification so I'm just going to dive

6
00:00:44,500 --> 00:00:47,680
straight into that so back in the days

7
00:00:47,680 --> 00:00:49,780
of dial-up we were at peace with the

8
00:00:49,780 --> 00:00:50,949
internet being this temporary thing

9
00:00:50,949 --> 00:00:53,559
right we would log in we would check our

10
00:00:53,559 --> 00:00:55,390
email and we would log out and we were

11
00:00:55,390 --> 00:00:57,160
cool with that but now we're almost

12
00:00:57,160 --> 00:00:59,980
always online we carry devices with us

13
00:00:59,980 --> 00:01:01,629
that I've always have an internet

14
00:01:01,629 --> 00:01:03,850
connection and because of that that that

15
00:01:03,850 --> 00:01:05,379
means being with outer connection

16
00:01:05,379 --> 00:01:07,270
becomes a much more of a deal in it than

17
00:01:07,270 --> 00:01:09,070
it used to be our speaking to a few

18
00:01:09,070 --> 00:01:10,630
people who are not from the states and

19
00:01:10,630 --> 00:01:12,759
they don't have mobile data here an L

20
00:01:12,759 --> 00:01:14,860
know what I'm all about when I'm data

21
00:01:14,860 --> 00:01:17,380
roaming I feel like a like a gambling

22
00:01:17,380 --> 00:01:19,780
addict I know every time I connect that

23
00:01:19,780 --> 00:01:22,420
I'm hemorrhaging money but I can't help

24
00:01:22,420 --> 00:01:24,190
myself I'm kind of worrying what the

25
00:01:24,190 --> 00:01:25,420
Internet's doing behind my back like

26
00:01:25,420 --> 00:01:27,100
it's some kind of untrustworthy partner

27
00:01:27,100 --> 00:01:30,220
or a party that I'm not invited to I but

28
00:01:30,220 --> 00:01:31,869
my phone makes this little beeping sound

29
00:01:31,869 --> 00:01:33,429
when I date a room is a kind of warning

30
00:01:33,429 --> 00:01:35,080
but I almost don't need it because I can

31
00:01:35,080 --> 00:01:36,789
almost hear the champagne corks popping

32
00:01:36,789 --> 00:01:38,440
in the tmobile offices with every

33
00:01:38,440 --> 00:01:40,509
megabyte I eat like I connect to the

34
00:01:40,509 --> 00:01:42,759
internet they go out and buy a car I'm

35
00:01:42,759 --> 00:01:45,130
I'm disgusted by my own dependency on

36
00:01:45,130 --> 00:01:47,740
data where I a place i used to work this

37
00:01:47,740 --> 00:01:50,380
happened about six months ago I needed

38
00:01:50,380 --> 00:01:52,750
to go to the toilet for a dump which is

39
00:01:52,750 --> 00:01:54,700
a thing I do now there were five

40
00:01:54,700 --> 00:01:56,710
cubicles to choose from and that this

41
00:01:56,710 --> 00:01:59,140
one instance the first four were

42
00:01:59,140 --> 00:02:02,200
occupied that's usually okay because I

43
00:02:02,200 --> 00:02:04,090
tend to only use one toilet at a time in

44
00:02:04,090 --> 00:02:06,729
this as an extreme circumstances by knew

45
00:02:06,729 --> 00:02:08,920
from personal experience that the office

46
00:02:08,920 --> 00:02:11,260
Wi-Fi only stretched to the first floor

47
00:02:11,260 --> 00:02:12,940
cubicles

48
00:02:12,940 --> 00:02:15,250
and there's no mobile data there either

49
00:02:15,250 --> 00:02:17,790
and I fought for a moment in the sport

50
00:02:17,790 --> 00:02:21,460
no not good enough I find this totally

51
00:02:21,460 --> 00:02:23,050
unacceptable and I turned around and I

52
00:02:23,050 --> 00:02:24,310
went back to my desk and I sat down and

53
00:02:24,310 --> 00:02:26,170
I waited until later and that's when it

54
00:02:26,170 --> 00:02:28,000
dawned on me that I have now become a

55
00:02:28,000 --> 00:02:30,040
human being that requires an internet

56
00:02:30,040 --> 00:02:34,720
connection to go to the toilet what can

57
00:02:34,720 --> 00:02:35,860
we do to fix this well obviously we

58
00:02:35,860 --> 00:02:37,330
can't create data out of nowhere but we

59
00:02:37,330 --> 00:02:39,760
can't make our sites work offline and

60
00:02:39,760 --> 00:02:41,050
let users use pre downloaded a

61
00:02:41,050 --> 00:02:45,070
downloaded data in new ways browsers

62
00:02:45,070 --> 00:02:47,680
have historically required an internet

63
00:02:47,680 --> 00:02:49,210
connection to work they've had a cache

64
00:02:49,210 --> 00:02:51,400
they've had a cash for like forever but

65
00:02:51,400 --> 00:02:53,410
maybe the user or the developer has

66
00:02:53,410 --> 00:02:55,120
enough control over that cash to create

67
00:02:55,120 --> 00:02:57,070
a reliable offline experience Google

68
00:02:57,070 --> 00:02:58,240
weren't happy with this and they created

69
00:02:58,240 --> 00:02:59,800
local server as part of the gears API

70
00:02:59,800 --> 00:03:02,260
that let you create stores of data heat

71
00:03:02,260 --> 00:03:03,640
against URLs and that would be available

72
00:03:03,640 --> 00:03:06,130
offline as you can see that's no longer

73
00:03:06,130 --> 00:03:07,750
available Google gears is no longer

74
00:03:07,750 --> 00:03:08,950
active that's because most of the ideas

75
00:03:08,950 --> 00:03:10,720
were taken on by the web applications

76
00:03:10,720 --> 00:03:12,460
group the offline stuff was reimagined

77
00:03:12,460 --> 00:03:15,190
as offline web applications and therein

78
00:03:15,190 --> 00:03:16,780
lies the application cache and that's

79
00:03:16,780 --> 00:03:18,610
going to be a sort of anti hero of this

80
00:03:18,610 --> 00:03:21,489
talk now the application cache is like a

81
00:03:21,489 --> 00:03:24,010
candidate from The Apprentice now I

82
00:03:24,010 --> 00:03:25,300
don't know if you guys get the UK

83
00:03:25,300 --> 00:03:26,830
version here if not you're probably

84
00:03:26,830 --> 00:03:27,820
wondering why I've shown you a picture

85
00:03:27,820 --> 00:03:30,580
of a shaved head hog who looks like he's

86
00:03:30,580 --> 00:03:32,140
suffering from ingrowing spines this is

87
00:03:32,140 --> 00:03:33,760
this is Sir Alan Sugar he's a boss in

88
00:03:33,760 --> 00:03:36,040
the UK version of The Apprentice the US

89
00:03:36,040 --> 00:03:38,350
tends to do TV better than UK but I

90
00:03:38,350 --> 00:03:39,760
promise you that this this man is much

91
00:03:39,760 --> 00:03:41,769
more bearable than the u.s. equivalent

92
00:03:41,769 --> 00:03:44,980
Donald Trump whose hair along just looks

93
00:03:44,980 --> 00:03:46,810
like a cloud of piss that's lodged

94
00:03:46,810 --> 00:03:49,120
itself the top of a ragged sex doll you

95
00:03:49,120 --> 00:03:52,300
know but the application cache is more

96
00:03:52,300 --> 00:03:54,910
like one of the candidates of the

97
00:03:54,910 --> 00:03:56,290
apprentice you know that when they're

98
00:03:56,290 --> 00:03:57,459
interviewed they are incredibly

99
00:03:57,459 --> 00:03:59,140
confident they're really good at selling

100
00:03:59,140 --> 00:04:00,970
themselves they'll turn to the camera

101
00:04:00,970 --> 00:04:02,500
look at directly in the lens and they'll

102
00:04:02,500 --> 00:04:04,150
say I'm going to turn your offline

103
00:04:04,150 --> 00:04:07,209
experience from sucks ass to success and

104
00:04:07,209 --> 00:04:09,820
and when they're given the task they'll

105
00:04:09,820 --> 00:04:11,290
definitely try and take over the

106
00:04:11,290 --> 00:04:12,940
operation trampling over everything else

107
00:04:12,940 --> 00:04:14,739
just to try and get noticed they'll get

108
00:04:14,739 --> 00:04:17,049
the job done in a manner of speaking but

109
00:04:17,049 --> 00:04:19,269
you're left with this loud horrible

110
00:04:19,269 --> 00:04:21,400
business douchebag at the sensor at all

111
00:04:21,400 --> 00:04:23,470
and we have to be very careful as

112
00:04:23,470 --> 00:04:24,729
developers to hide all of that

113
00:04:24,729 --> 00:04:26,320
douchebaggery from the end-user I'm

114
00:04:26,320 --> 00:04:26,720
going to

115
00:04:26,720 --> 00:04:30,050
how you go about doing that when you

116
00:04:30,050 --> 00:04:31,250
make a site work offline with

117
00:04:31,250 --> 00:04:33,290
application cache how you do it depends

118
00:04:33,290 --> 00:04:35,300
on the kind of site it is and the two

119
00:04:35,300 --> 00:04:36,230
extremes we're going to look at our

120
00:04:36,230 --> 00:04:38,240
sites that tend towards doing stuff with

121
00:04:38,240 --> 00:04:39,920
content insights that tend towards

122
00:04:39,920 --> 00:04:43,220
getting content in terms of get stuff

123
00:04:43,220 --> 00:04:45,590
sites things like Wikipedia travel site

124
00:04:45,590 --> 00:04:48,680
YouTube Twitter these are sites with a

125
00:04:48,680 --> 00:04:50,690
lot of content and as the user you'll go

126
00:04:50,690 --> 00:04:53,030
and find a bit of content and look at it

127
00:04:53,030 --> 00:04:54,770
the heavy lifting tends to be done on

128
00:04:54,770 --> 00:04:57,230
the server and they should have lots of

129
00:04:57,230 --> 00:05:00,020
hopefully meaningful URLs not all of

130
00:05:00,020 --> 00:05:02,660
these do alternatively do stuff sites

131
00:05:02,660 --> 00:05:05,150
things like Google Docs linters and

132
00:05:05,150 --> 00:05:08,480
validators games online IDs these sites

133
00:05:08,480 --> 00:05:10,220
offer a relatively small amount of

134
00:05:10,220 --> 00:05:11,570
content themselves but you can do a lot

135
00:05:11,570 --> 00:05:13,160
with that content or you can use them to

136
00:05:13,160 --> 00:05:14,780
create your own content the heavy

137
00:05:14,780 --> 00:05:16,670
lifting in these cases tends to be done

138
00:05:16,670 --> 00:05:17,930
on the clients or could be done on the

139
00:05:17,930 --> 00:05:20,180
client and they tend to have fewer URLs

140
00:05:20,180 --> 00:05:22,160
this is the case that app cache was

141
00:05:22,160 --> 00:05:24,560
designed for but as well see the app

142
00:05:24,560 --> 00:05:26,090
cache specification is like an onion

143
00:05:26,090 --> 00:05:28,130
peeling through it can reduce a grown

144
00:05:28,130 --> 00:05:29,870
developer to tears or at least that's

145
00:05:29,870 --> 00:05:32,000
what happened to me we're going to look

146
00:05:32,000 --> 00:05:34,340
at off lining a do stuff sites like to

147
00:05:34,340 --> 00:05:36,530
start with now I realize I've just taken

148
00:05:36,530 --> 00:05:40,250
the word offline and verb ified it in in

149
00:05:40,250 --> 00:05:41,690
fact I just took the word verb and verba

150
00:05:41,690 --> 00:05:44,030
find it and the problem here is it's not

151
00:05:44,030 --> 00:05:45,860
really a good verb for making a site

152
00:05:45,860 --> 00:05:47,540
work offline so I've taken some verbal

153
00:05:47,540 --> 00:05:49,220
shortcut but I'm told that it's good to

154
00:05:49,220 --> 00:05:50,870
try and explain something using your own

155
00:05:50,870 --> 00:05:52,820
words and these ones aren't even in the

156
00:05:52,820 --> 00:05:54,140
dictionary so I should get bonus points

157
00:05:54,140 --> 00:05:56,210
I think so with that in mind we're gonna

158
00:05:56,210 --> 00:05:58,660
look at offline arising sprite Cal com

159
00:05:58,660 --> 00:06:02,390
which is a sprite cows the only useful

160
00:06:02,390 --> 00:06:04,250
thing I ever built I'm not like Remy and

161
00:06:04,250 --> 00:06:05,540
check out a new thing every couple of

162
00:06:05,540 --> 00:06:08,750
months what you do is you give it a CSS

163
00:06:08,750 --> 00:06:10,940
sprite sheet you load that in this it's

164
00:06:10,940 --> 00:06:12,740
just a test image you click a bit of it

165
00:06:12,740 --> 00:06:15,320
it gives you the CSS for that that part

166
00:06:15,320 --> 00:06:17,810
of the image it's one HTML page all the

167
00:06:17,810 --> 00:06:19,340
processing is done client-side all the

168
00:06:19,340 --> 00:06:21,200
server does this serve the assets this

169
00:06:21,200 --> 00:06:23,300
is a live demo running inside Chrome so

170
00:06:23,300 --> 00:06:26,050
if I were to cut the connection and

171
00:06:26,050 --> 00:06:29,660
refresh the page it doesn't work we get

172
00:06:29,660 --> 00:06:31,010
some of the files and not all of them

173
00:06:31,010 --> 00:06:32,330
and that's because they we can't rely on

174
00:06:32,330 --> 00:06:33,860
the cash that's a shame cuz it'd be nice

175
00:06:33,860 --> 00:06:35,120
to be able to use sprite cow on the

176
00:06:35,120 --> 00:06:37,190
plane on the train I I shouldn't need an

177
00:06:37,190 --> 00:06:38,510
interconnect internet connection to make

178
00:06:38,510 --> 00:06:39,919
it work so let's let's go about fixing

179
00:06:39,919 --> 00:06:40,990
that

180
00:06:40,990 --> 00:06:43,580
to make this site work offline we take

181
00:06:43,580 --> 00:06:45,319
the HTML element to the page and we

182
00:06:45,319 --> 00:06:46,880
point out a manifest using this this

183
00:06:46,880 --> 00:06:49,130
manifest attribute now fortunately this

184
00:06:49,130 --> 00:06:51,319
is at the manifest file it's not XML

185
00:06:51,319 --> 00:06:52,729
we've managed to get over that whole

186
00:06:52,729 --> 00:06:55,220
thing unfortunately it's a custom baked

187
00:06:55,220 --> 00:06:58,009
format it starts off with cache manifest

188
00:06:58,009 --> 00:07:00,110
in huge capital letters which is kind of

189
00:07:00,110 --> 00:07:01,699
warning sign because that's the you're

190
00:07:01,699 --> 00:07:03,229
quite a douchebag thing to do to shout

191
00:07:03,229 --> 00:07:06,110
your own name in capital letters but but

192
00:07:06,110 --> 00:07:07,789
but after that just list the files that

193
00:07:07,789 --> 00:07:09,440
you want that form part of your site

194
00:07:09,440 --> 00:07:12,139
your co CSS your JavaScript any of your

195
00:07:12,139 --> 00:07:13,910
assets images fonts favicon on all of

196
00:07:13,910 --> 00:07:16,160
those things all these URLs are relative

197
00:07:16,160 --> 00:07:18,020
to the manifest itself but you can also

198
00:07:18,020 --> 00:07:20,539
include absolute URLs make that the rule

199
00:07:20,539 --> 00:07:22,370
is you can't cross the schemes if your

200
00:07:22,370 --> 00:07:25,160
page is https you can only include HTTPS

201
00:07:25,160 --> 00:07:27,530
URLs you'll notice like the HTML page

202
00:07:27,530 --> 00:07:29,419
itself isn't listed here that's because

203
00:07:29,419 --> 00:07:31,220
any page that points out and manifest

204
00:07:31,220 --> 00:07:33,500
implicitly becomes part of that cash and

205
00:07:33,500 --> 00:07:35,180
you need to make sure you serve the

206
00:07:35,180 --> 00:07:37,159
manifest with the content-type text /

207
00:07:37,159 --> 00:07:39,229
cache manifest that's that is going to

208
00:07:39,229 --> 00:07:40,370
be dropped from the specification that

209
00:07:40,370 --> 00:07:42,470
decided that shouldn't really matter but

210
00:07:42,470 --> 00:07:44,030
the current implementations require it

211
00:07:44,030 --> 00:07:46,789
so you need that for the moment and with

212
00:07:46,789 --> 00:07:49,310
that small little change I can now go

213
00:07:49,310 --> 00:07:51,830
and cut the connection and refresh

214
00:07:51,830 --> 00:07:53,840
refresh the patient but it still works

215
00:07:53,840 --> 00:07:55,340
so that now works without without a

216
00:07:55,340 --> 00:07:58,360
connection and that was relatively easy

217
00:07:58,360 --> 00:08:00,530
the browser support for that is really

218
00:08:00,530 --> 00:08:02,570
good as well so the desktop browsers

219
00:08:02,570 --> 00:08:04,039
they've supported it for a while all

220
00:08:04,039 --> 00:08:05,750
that transitions not working Paul Irish

221
00:08:05,750 --> 00:08:07,070
needs to fix chrome wherever he is

222
00:08:07,070 --> 00:08:09,710
anyway the mobile device we were hearing

223
00:08:09,710 --> 00:08:10,789
before that it doesn't work on some

224
00:08:10,789 --> 00:08:12,050
mobile devices that's not being my

225
00:08:12,050 --> 00:08:14,180
experience it's the be support for quite

226
00:08:14,180 --> 00:08:16,669
a while ironing out the bugs the the bug

227
00:08:16,669 --> 00:08:18,949
that you heard about there with airplane

228
00:08:18,949 --> 00:08:21,259
mode I've seen that but oddly enough it

229
00:08:21,259 --> 00:08:22,909
seems to only exist in airplane mode a

230
00:08:22,909 --> 00:08:24,530
lot of these things will work offline

231
00:08:24,530 --> 00:08:25,699
when the phone just doesn't have a

232
00:08:25,699 --> 00:08:27,289
connection or sometimes after a couple

233
00:08:27,289 --> 00:08:28,820
of refreshes they'll pick it up tend to

234
00:08:28,820 --> 00:08:30,229
see that on all the blackberries I am

235
00:08:30,229 --> 00:08:32,270
Android my android phone it works fine

236
00:08:32,270 --> 00:08:33,919
on the Android ahead before it works

237
00:08:33,919 --> 00:08:36,409
fine unfortunately there's no support in

238
00:08:36,409 --> 00:08:38,810
internet explorer and that means no

239
00:08:38,810 --> 00:08:40,610
support windows mobile either although

240
00:08:40,610 --> 00:08:43,520
it does work in IE 10 platform preview

241
00:08:43,520 --> 00:08:45,620
whatever it was so there's a good chance

242
00:08:45,620 --> 00:08:46,459
that it's going to be there when it

243
00:08:46,459 --> 00:08:48,980
fully launches all these browsers let

244
00:08:48,980 --> 00:08:50,600
you use the application cache

245
00:08:50,600 --> 00:08:51,800
transparently if the exception of

246
00:08:51,800 --> 00:08:53,449
Firefox which will put a message up and

247
00:08:53,449 --> 00:08:53,960
user has

248
00:08:53,960 --> 00:08:57,290
click allow to make it work it can seem

249
00:08:57,290 --> 00:08:59,570
at first like this was a small piece of

250
00:08:59,570 --> 00:09:01,730
progressive enhancement but watch this

251
00:09:01,730 --> 00:09:04,130
time he'll go to an editor and I'm going

252
00:09:04,130 --> 00:09:05,480
to change just that the title of the

253
00:09:05,480 --> 00:09:10,220
page there from sprite cow to yay j/s

254
00:09:10,220 --> 00:09:13,970
conf and say that out so now back in the

255
00:09:13,970 --> 00:09:16,400
page I'm going to refresh refresh

256
00:09:16,400 --> 00:09:21,410
refresh no change oh wow hello the

257
00:09:21,410 --> 00:09:23,180
behavior of the site has significantly

258
00:09:23,180 --> 00:09:25,640
changed to what we would expect and this

259
00:09:25,640 --> 00:09:26,870
is the first piece of douchebaggery are

260
00:09:26,870 --> 00:09:28,700
going to look at the application cache

261
00:09:28,700 --> 00:09:31,060
completely takes over the operation

262
00:09:31,060 --> 00:09:33,260
let's try some of what's happening here

263
00:09:33,260 --> 00:09:34,940
the first time you load a page it's

264
00:09:34,940 --> 00:09:36,950
requested normally and if we get an HTML

265
00:09:36,950 --> 00:09:39,410
page and that points at a manifest file

266
00:09:39,410 --> 00:09:41,870
the manifest file is downloaded and then

267
00:09:41,870 --> 00:09:42,650
the browser will go through that

268
00:09:42,650 --> 00:09:44,210
manifest file and download all the files

269
00:09:44,210 --> 00:09:46,220
inside it and if they all download fine

270
00:09:46,220 --> 00:09:49,490
they form a cash if any file that you

271
00:09:49,490 --> 00:09:52,160
list for all fours 500 anything like

272
00:09:52,160 --> 00:09:53,810
that the whole caching process fails

273
00:09:53,810 --> 00:09:56,330
I've seen this described as a gotcha but

274
00:09:56,330 --> 00:09:57,440
no this is actually a really good thing

275
00:09:57,440 --> 00:09:59,120
because it gives us two states who can

276
00:09:59,120 --> 00:10:00,650
rely upon can I've rely upon the cash

277
00:10:00,650 --> 00:10:03,140
being entirely there or not there at all

278
00:10:03,140 --> 00:10:04,640
and that's what makes it better than the

279
00:10:04,640 --> 00:10:06,920
current browser cache where some files

280
00:10:06,920 --> 00:10:09,190
will disappear another ones will stay

281
00:10:09,190 --> 00:10:11,090
subsequent requests will go differently

282
00:10:11,090 --> 00:10:14,750
if a file is in the application cache it

283
00:10:14,750 --> 00:10:16,280
will be served from the application

284
00:10:16,280 --> 00:10:18,170
cache otherwise things will carry on

285
00:10:18,170 --> 00:10:20,630
down the same path we saw before a lot

286
00:10:20,630 --> 00:10:21,920
of blog posts and speakers on the

287
00:10:21,920 --> 00:10:23,150
subject they make the assumption that

288
00:10:23,150 --> 00:10:25,010
the cached version is only used if

289
00:10:25,010 --> 00:10:26,780
you're offline and that's not true

290
00:10:26,780 --> 00:10:28,490
connectivity doesn't factor into it at

291
00:10:28,490 --> 00:10:30,470
all the version will be served from the

292
00:10:30,470 --> 00:10:33,530
cash if it's there always the plus the

293
00:10:33,530 --> 00:10:35,510
reason they do this is because what is

294
00:10:35,510 --> 00:10:37,400
offline what does offline mean offline

295
00:10:37,400 --> 00:10:40,070
could mean you don't have anything a

296
00:10:40,070 --> 00:10:42,290
wire plugged into your machine it could

297
00:10:42,290 --> 00:10:43,400
mean that the roofie you are connected

298
00:10:43,400 --> 00:10:44,330
to doesn't have an internet connection

299
00:10:44,330 --> 00:10:46,220
it could mean that you you know have a

300
00:10:46,220 --> 00:10:48,350
dns problem a proxy problem the site is

301
00:10:48,350 --> 00:10:50,420
down there's no fast way to detect any

302
00:10:50,420 --> 00:10:52,070
of this so it makes it come straight

303
00:10:52,070 --> 00:10:53,600
from the cash straight away and that

304
00:10:53,600 --> 00:10:57,470
means you get the site quickly but it

305
00:10:57,470 --> 00:10:58,760
still checks the manifest in the

306
00:10:58,760 --> 00:11:00,020
background when it comes on the cash to

307
00:11:00,020 --> 00:11:01,760
look for updates but if it's looking for

308
00:11:01,760 --> 00:11:03,380
updates then then why are we not getting

309
00:11:03,380 --> 00:11:05,120
the heading not changing why is it still

310
00:11:05,120 --> 00:11:07,040
so sprite cow unfortunately this is

311
00:11:07,040 --> 00:11:07,699
another piece of

312
00:11:07,699 --> 00:11:10,579
magarri there's another layer of cash

313
00:11:10,579 --> 00:11:13,879
validation it has its own system see the

314
00:11:13,879 --> 00:11:16,220
application cache it won't update unless

315
00:11:16,220 --> 00:11:18,709
the manifest file has changed in some

316
00:11:18,709 --> 00:11:21,739
way and I mean that in any way at all so

317
00:11:21,739 --> 00:11:23,179
anything that makes it not bite

318
00:11:23,179 --> 00:11:25,040
identical so here's a list of files we

319
00:11:25,040 --> 00:11:26,600
had before you'll notice that a lot of

320
00:11:26,600 --> 00:11:27,889
files have version numbers that's

321
00:11:27,889 --> 00:11:30,109
because they're all far future cached so

322
00:11:30,109 --> 00:11:32,569
changing them involves changing URL like

323
00:11:32,569 --> 00:11:34,669
that version 2 and that's also changing

324
00:11:34,669 --> 00:11:35,899
the manifest everything just kind of

325
00:11:35,899 --> 00:11:38,749
works and that's fine for the CSS and

326
00:11:38,749 --> 00:11:40,459
JavaScript but we changed the HTML and

327
00:11:40,459 --> 00:11:42,079
that's not listed here and even if it

328
00:11:42,079 --> 00:11:45,679
was it's not going to change URL so a

329
00:11:45,679 --> 00:11:47,239
common way to get round that is to add a

330
00:11:47,239 --> 00:11:48,679
comment into the manifest file something

331
00:11:48,679 --> 00:11:50,839
like this comment start with a hash

332
00:11:50,839 --> 00:11:52,790
symbol and although it's a comment that

333
00:11:52,790 --> 00:11:54,529
still counts as a change to the manifest

334
00:11:54,529 --> 00:11:56,359
and that will trigger an update here

335
00:11:56,359 --> 00:11:58,160
I've just used a single digit you could

336
00:11:58,160 --> 00:12:00,079
use some kind of build system to combine

337
00:12:00,079 --> 00:12:01,639
things like e tags or something like

338
00:12:01,639 --> 00:12:03,410
that this is the biggest ball ache when

339
00:12:03,410 --> 00:12:05,749
developing an app cache site every time

340
00:12:05,749 --> 00:12:08,179
you change any of a file you have to

341
00:12:08,179 --> 00:12:09,619
change the manifest as well and you

342
00:12:09,619 --> 00:12:11,059
can't just use some kind of random

343
00:12:11,059 --> 00:12:12,829
number generator because when when the

344
00:12:12,829 --> 00:12:14,660
application cache updates the manifest

345
00:12:14,660 --> 00:12:16,399
it downloads the manifest at the start

346
00:12:16,399 --> 00:12:18,470
of an update and at the end and if the

347
00:12:18,470 --> 00:12:20,269
manifest has changed during the update

348
00:12:20,269 --> 00:12:22,549
the caching process will fail because it

349
00:12:22,549 --> 00:12:23,689
will assume right I've downloaded these

350
00:12:23,689 --> 00:12:25,519
five files but the manifest changed at

351
00:12:25,519 --> 00:12:27,559
some point during that these files could

352
00:12:27,559 --> 00:12:29,480
be from two different versions so it

353
00:12:29,480 --> 00:12:33,589
fails it the cache won't settle this is

354
00:12:33,589 --> 00:12:35,059
something that catches a lot of people

355
00:12:35,059 --> 00:12:35,989
aren't going to start playing with

356
00:12:35,989 --> 00:12:39,199
appcache the byte for byte identical

357
00:12:39,199 --> 00:12:40,970
check thing this is additional to the

358
00:12:40,970 --> 00:12:42,949
normal browser caching app caches is

359
00:12:42,949 --> 00:12:44,629
separate to the normal caching layer it

360
00:12:44,629 --> 00:12:46,879
doesn't replace it it sits on top of it

361
00:12:46,879 --> 00:12:48,679
and it shouldn't be used as a

362
00:12:48,679 --> 00:12:49,910
replacement that might seem obvious but

363
00:12:49,910 --> 00:12:51,289
this is what catches people out because

364
00:12:51,289 --> 00:12:52,669
they'll update a file will update the

365
00:12:52,669 --> 00:12:54,199
manifest and they still won't get

366
00:12:54,199 --> 00:12:56,660
changes to the file and this is because

367
00:12:56,660 --> 00:12:57,589
they're playing around on the local

368
00:12:57,589 --> 00:12:59,209
apache server and they're not using

369
00:12:59,209 --> 00:13:02,959
caching headers so basically he's got

370
00:13:02,959 --> 00:13:04,220
the first I'll cash instructions right

371
00:13:04,220 --> 00:13:06,379
we can say don't cache this or check

372
00:13:06,379 --> 00:13:07,970
back for the server or assume this file

373
00:13:07,970 --> 00:13:10,129
is good for you that's fine but without

374
00:13:10,129 --> 00:13:11,899
one of these the application cache takes

375
00:13:11,899 --> 00:13:13,309
a file to the networking layer and says

376
00:13:13,309 --> 00:13:15,799
update this file and the networking rate

377
00:13:15,799 --> 00:13:17,959
goes no but this doesn't have any

378
00:13:17,959 --> 00:13:20,149
caching instructions how should I update

379
00:13:20,149 --> 00:13:21,120
it

380
00:13:21,120 --> 00:13:24,540
oh yeah however I want and browsers try

381
00:13:24,540 --> 00:13:25,680
and be as fast as possible and that

382
00:13:25,680 --> 00:13:27,510
involves doing as little as possible so

383
00:13:27,510 --> 00:13:30,180
quite often the caching layer will just

384
00:13:30,180 --> 00:13:32,580
send the file back and say it's probably

385
00:13:32,580 --> 00:13:34,620
okay the application cache will

386
00:13:34,620 --> 00:13:37,080
unwittingly update itself with a stale

387
00:13:37,080 --> 00:13:38,610
version from the standard browser cache

388
00:13:38,610 --> 00:13:40,740
if you don't tell it otherwise and that

389
00:13:40,740 --> 00:13:42,060
kind of copying can be really good when

390
00:13:42,060 --> 00:13:43,260
it's under your control when you're

391
00:13:43,260 --> 00:13:44,100
controlling it with cache headers

392
00:13:44,100 --> 00:13:45,900
because you can save HTTP requests with

393
00:13:45,900 --> 00:13:48,810
far future caching but out of control

394
00:13:48,810 --> 00:13:51,270
caching has awful results out of control

395
00:13:51,270 --> 00:13:53,490
copying that that took street fighter

396
00:13:53,490 --> 00:13:54,779
and turned into street fight of the

397
00:13:54,779 --> 00:13:58,170
movie and turned it into street fight at

398
00:13:58,170 --> 00:14:00,870
the movie the game this this is a thing

399
00:14:00,870 --> 00:14:05,310
that actually happened I assume at this

400
00:14:05,310 --> 00:14:06,839
point someone had to step in and reboot

401
00:14:06,839 --> 00:14:08,250
Hollywood in the games industry before

402
00:14:08,250 --> 00:14:11,520
it just got itself in a complete loop so

403
00:14:11,520 --> 00:14:13,110
in terms of your manifest you'll you

404
00:14:13,110 --> 00:14:15,300
know far future cash things that change

405
00:14:15,300 --> 00:14:18,240
not on every request and then make sure

406
00:14:18,240 --> 00:14:19,800
they change your own when they do so if

407
00:14:19,800 --> 00:14:21,839
it can change your world and do it for

408
00:14:21,839 --> 00:14:23,430
content that can't change URL but

409
00:14:23,430 --> 00:14:26,490
updates relatively frequently use a no

410
00:14:26,490 --> 00:14:28,650
cash header or must-revalidate but make

411
00:14:28,650 --> 00:14:30,029
sure you change a comment in the file as

412
00:14:30,029 --> 00:14:33,690
well now following that advice you might

413
00:14:33,690 --> 00:14:35,490
think I'll hang on I could do the same

414
00:14:35,490 --> 00:14:37,589
to the manifest file itself I can put a

415
00:14:37,589 --> 00:14:39,570
version number in there offline v1 and

416
00:14:39,570 --> 00:14:42,209
far future cash it and save on that HTTP

417
00:14:42,209 --> 00:14:43,350
request that's going to happen on every

418
00:14:43,350 --> 00:14:44,610
page and then when you want to make a

419
00:14:44,610 --> 00:14:46,680
change change the url same as you do if

420
00:14:46,680 --> 00:14:49,440
the javascript and CSS you must never

421
00:14:49,440 --> 00:14:52,440
ever do this the specification will

422
00:14:52,440 --> 00:14:55,709
punish you for doing this what actually

423
00:14:55,709 --> 00:14:57,570
happens here is where does the browser

424
00:14:57,570 --> 00:15:01,230
find out about the updated manifest well

425
00:15:01,230 --> 00:15:03,720
it finds out from the new HTML file but

426
00:15:03,720 --> 00:15:04,800
where does it find out about the new

427
00:15:04,800 --> 00:15:09,810
HTML file from the new manifest I did

428
00:15:09,810 --> 00:15:11,760
this with sprite cow and I did it my

429
00:15:11,760 --> 00:15:13,529
deploy decided it was about 20 minutes

430
00:15:13,529 --> 00:15:14,940
before I just a little for entered my

431
00:15:14,940 --> 00:15:17,370
head and I oh oh gods and I went back

432
00:15:17,370 --> 00:15:18,839
and changed it looking at Google

433
00:15:18,839 --> 00:15:20,760
Analytics 30 people visit the site in

434
00:15:20,760 --> 00:15:23,010
that window those 20 users will never

435
00:15:23,010 --> 00:15:26,209
get an update to the site ever again and

436
00:15:26,209 --> 00:15:28,709
unless they clear their browser cache or

437
00:15:28,709 --> 00:15:31,560
you know get a new browser that they now

438
00:15:31,560 --> 00:15:33,150
live the life of blackberry customers

439
00:15:33,150 --> 00:15:33,980
everyone's

440
00:15:33,980 --> 00:15:35,660
shiny new stuff but they're getting the

441
00:15:35,660 --> 00:15:37,550
same whole thing again and again and

442
00:15:37,550 --> 00:15:42,950
again so before we move on why do we

443
00:15:42,950 --> 00:15:44,630
have this extra level of cash validation

444
00:15:44,630 --> 00:15:45,860
why do we have to change the manifest

445
00:15:45,860 --> 00:15:47,990
file I think it's really stupid but this

446
00:15:47,990 --> 00:15:49,490
is the reason imagine how to manifest

447
00:15:49,490 --> 00:15:51,740
like this you know 50 HTML files date

448
00:15:51,740 --> 00:15:53,990
URLs don't change updating this manifest

449
00:15:53,990 --> 00:15:56,930
is 50 HTTP requests 52 if you count the

450
00:15:56,930 --> 00:15:59,270
manifest on either side the text

451
00:15:59,270 --> 00:16:01,130
changing trick is to avoid that

452
00:16:01,130 --> 00:16:03,140
happening on every page load it really

453
00:16:03,140 --> 00:16:04,790
just puts the problem back in your hands

454
00:16:04,790 --> 00:16:06,290
as a developer you have to decide when

455
00:16:06,290 --> 00:16:07,790
it happens and it is just a

456
00:16:07,790 --> 00:16:09,650
specification just clearing itself of

457
00:16:09,650 --> 00:16:11,990
any blame in my opinion but let's prove

458
00:16:11,990 --> 00:16:13,580
a point let's get this heading change so

459
00:16:13,580 --> 00:16:17,030
I'm going to go into my manifest file

460
00:16:17,030 --> 00:16:21,230
and add just version to something like

461
00:16:21,230 --> 00:16:24,170
that okay so now i'm going to refresh

462
00:16:24,170 --> 00:16:26,930
the page no change refresh the page

463
00:16:26,930 --> 00:16:30,080
again and yay ok so the contents changed

464
00:16:30,080 --> 00:16:31,670
but we saw something important there end

465
00:16:31,670 --> 00:16:33,860
of a piece of douchebaggery it took us

466
00:16:33,860 --> 00:16:35,750
to refreshes to actually get the content

467
00:16:35,750 --> 00:16:37,580
and that's that's kind of a side effect

468
00:16:37,580 --> 00:16:40,040
of the flow of the application cache we

469
00:16:40,040 --> 00:16:41,630
saw before that the the version comes

470
00:16:41,630 --> 00:16:43,180
from the cash if it's in the cache and

471
00:16:43,180 --> 00:16:46,130
then the manifest is updated afterwards

472
00:16:46,130 --> 00:16:47,990
but by that point the users still

473
00:16:47,990 --> 00:16:49,250
looking at the old version so even if

474
00:16:49,250 --> 00:16:50,810
they get a new version they're not going

475
00:16:50,810 --> 00:16:52,160
to see it until the next time they load

476
00:16:52,160 --> 00:16:54,980
the page there's a JavaScript event at

477
00:16:54,980 --> 00:16:57,290
this point that you can use to do

478
00:16:57,290 --> 00:16:59,120
something and that's an update ready

479
00:16:59,120 --> 00:17:01,370
that happens when the this browser

480
00:17:01,370 --> 00:17:02,930
downloads a manifest there's a change

481
00:17:02,930 --> 00:17:04,910
and it downloads all the files within

482
00:17:04,910 --> 00:17:06,110
and all those files download

483
00:17:06,110 --> 00:17:08,510
successfully in form of cash at this

484
00:17:08,510 --> 00:17:10,340
point you can call swap cash and what

485
00:17:10,340 --> 00:17:11,810
that does that starts using the new cash

486
00:17:11,810 --> 00:17:14,630
immediately for subsequent requests but

487
00:17:14,630 --> 00:17:15,710
by that point the horse is already

488
00:17:15,710 --> 00:17:17,390
bolted you know the users already

489
00:17:17,390 --> 00:17:20,450
downloaded the page swap cash is

490
00:17:20,450 --> 00:17:21,560
actually pretty useless I don't

491
00:17:21,560 --> 00:17:22,880
understand why it made it into the

492
00:17:22,880 --> 00:17:25,760
specification over a load of glaring

493
00:17:25,760 --> 00:17:27,860
omissions there's very few use cases for

494
00:17:27,860 --> 00:17:29,840
swap cash you could just force a reload

495
00:17:29,840 --> 00:17:32,120
of the page and that we on the user will

496
00:17:32,120 --> 00:17:34,700
get a new version but this is a bad user

497
00:17:34,700 --> 00:17:35,750
experience because these are might have

498
00:17:35,750 --> 00:17:36,980
already started interacting if the page

499
00:17:36,980 --> 00:17:38,210
imagine you'll be using Gmail you

500
00:17:38,210 --> 00:17:39,620
started composing an email and it just

501
00:17:39,620 --> 00:17:40,790
refreshed on you because there's an

502
00:17:40,790 --> 00:17:43,490
update that's not great as a compromise

503
00:17:43,490 --> 00:17:45,440
just within your app show some kind of

504
00:17:45,440 --> 00:17:47,630
message saying hey there's an update

505
00:17:47,630 --> 00:17:48,770
refresh at your leisure and you'll see

506
00:17:48,770 --> 00:17:51,560
this on various Google Sites another

507
00:17:51,560 --> 00:17:53,330
compromise it just to not care and

508
00:17:53,330 --> 00:17:55,190
that's what i did a spike how I mean so

509
00:17:55,190 --> 00:17:57,140
what if people are on a version before

510
00:17:57,140 --> 00:17:59,450
for one viewing in terms of breakout

511
00:17:59,450 --> 00:18:00,710
it's not a big deal people aren't going

512
00:18:00,710 --> 00:18:03,740
to be on that site for a long time so

513
00:18:03,740 --> 00:18:05,960
this is the simple example are we done

514
00:18:05,960 --> 00:18:08,840
yet it looks like we're done but a nasty

515
00:18:08,840 --> 00:18:11,210
buggers crept in our analytics to stop

516
00:18:11,210 --> 00:18:12,530
working you'd only spot this if you were

517
00:18:12,530 --> 00:18:14,120
looking at web inspector or fire bug or

518
00:18:14,120 --> 00:18:16,640
something so why are these connections

519
00:18:16,640 --> 00:18:18,050
failing well let's have a look at a more

520
00:18:18,050 --> 00:18:20,180
visual example so this page here users

521
00:18:20,180 --> 00:18:21,830
are manifest but in the manifest it only

522
00:18:21,830 --> 00:18:24,440
points at the CSS file and obviously the

523
00:18:24,440 --> 00:18:26,990
HTML file is implicitly cached so even

524
00:18:26,990 --> 00:18:29,380
though that we have a connection here i

525
00:18:29,380 --> 00:18:31,940
refresh the page and the images suddenly

526
00:18:31,940 --> 00:18:34,250
fail of course this is another piece of

527
00:18:34,250 --> 00:18:35,690
douchebaggery the application cache

528
00:18:35,690 --> 00:18:37,730
doesn't like stuff that isn't in the app

529
00:18:37,730 --> 00:18:39,590
cache the first time we saw the page it

530
00:18:39,590 --> 00:18:41,540
wasn't cashed we refreshed got the

531
00:18:41,540 --> 00:18:43,310
version from the cache everything Oh

532
00:18:43,310 --> 00:18:46,310
Liam just stopped loading to explain it

533
00:18:46,310 --> 00:18:47,450
some afraid we have to go back to the

534
00:18:47,450 --> 00:18:50,000
diagram unfortunately we've missed some

535
00:18:50,000 --> 00:18:52,700
detail from the top once the browser

536
00:18:52,700 --> 00:18:55,130
makes a get request to a URL it looks to

537
00:18:55,130 --> 00:18:56,570
see if its associated with manifest and

538
00:18:56,570 --> 00:18:58,370
if it is associated with manifest it

539
00:18:58,370 --> 00:19:00,830
uses it and things continue as we've

540
00:19:00,830 --> 00:19:03,560
already seen if the URL isn't associated

541
00:19:03,560 --> 00:19:06,170
with manifest things just request

542
00:19:06,170 --> 00:19:07,670
normally as they normally would without

543
00:19:07,670 --> 00:19:08,990
a manifest now that just sounds like a

544
00:19:08,990 --> 00:19:10,430
complicated way of saying what we've

545
00:19:10,430 --> 00:19:11,800
already said but here's the difference

546
00:19:11,800 --> 00:19:14,030
every request that's triggered by a

547
00:19:14,030 --> 00:19:17,630
cached page your j/s CSS your images as

548
00:19:17,630 --> 00:19:20,090
before they go back through the same

549
00:19:20,090 --> 00:19:21,830
system but they don't reselect a

550
00:19:21,830 --> 00:19:23,450
manifest they'll use the manifest of the

551
00:19:23,450 --> 00:19:26,120
host page now that's fine if the image

552
00:19:26,120 --> 00:19:27,320
is in the cache it will come from the

553
00:19:27,320 --> 00:19:31,100
cash otherwise the connection fails and

554
00:19:31,100 --> 00:19:32,630
that's what we saw if those images it's

555
00:19:32,630 --> 00:19:34,130
no coincidence that this part of the

556
00:19:34,130 --> 00:19:45,910
specification is in section 666

557
00:19:45,920 --> 00:19:48,150
this is the specification of the beast

558
00:19:48,150 --> 00:19:49,980
this is where all the really gnarly

559
00:19:49,980 --> 00:19:54,450
stuff is so this is that's what's

560
00:19:54,450 --> 00:19:55,290
happening here that's why those images

561
00:19:55,290 --> 00:19:57,780
are failing we can fix that by using the

562
00:19:57,780 --> 00:19:59,790
network section of the manifest and we

563
00:19:59,790 --> 00:20:02,490
can list full paths or we can use a star

564
00:20:02,490 --> 00:20:04,830
and that makes things work the reason

565
00:20:04,830 --> 00:20:06,630
that makes things work is if the URL

566
00:20:06,630 --> 00:20:08,370
isn't cached but it's listed in the

567
00:20:08,370 --> 00:20:10,320
network section it's requested normally

568
00:20:10,320 --> 00:20:12,120
otherwise if there's a star in the

569
00:20:12,120 --> 00:20:14,220
network section then the files requested

570
00:20:14,220 --> 00:20:16,320
normally otherwise it fails so that's

571
00:20:16,320 --> 00:20:17,640
how you bring things back those files

572
00:20:17,640 --> 00:20:18,990
that you list a network they won't be

573
00:20:18,990 --> 00:20:20,340
cached they will fail when you're

574
00:20:20,340 --> 00:20:22,980
offline but they will work when you're

575
00:20:22,980 --> 00:20:24,090
online so you need to make sure your

576
00:20:24,090 --> 00:20:25,770
online only stuff such as analytics that

577
00:20:25,770 --> 00:20:27,120
they're taken care of by one of these

578
00:20:27,120 --> 00:20:29,640
two network rules well that's it really

579
00:20:29,640 --> 00:20:33,000
that's the simple example all done and

580
00:20:33,000 --> 00:20:34,410
it was at this point that I wanted to

581
00:20:34,410 --> 00:20:35,850
lock myself in the bathroom and wait

582
00:20:35,850 --> 00:20:37,530
until the internet had gone away maybe

583
00:20:37,530 --> 00:20:39,930
even in the end cubicle at work where

584
00:20:39,930 --> 00:20:42,330
the internet can't get me but but this

585
00:20:42,330 --> 00:20:44,250
is jess conf we're not afraid of peeling

586
00:20:44,250 --> 00:20:45,930
the appcache onion a little bit further

587
00:20:45,930 --> 00:20:47,820
so we'll look at a different kind of

588
00:20:47,820 --> 00:20:51,270
site will look at a get stuff site and

589
00:20:51,270 --> 00:20:53,370
i'm going to use em lanyard calm as an

590
00:20:53,370 --> 00:20:55,340
example for this is something we built

591
00:20:55,340 --> 00:20:57,450
we found on your comm you can look up

592
00:20:57,450 --> 00:20:59,670
future conferences you can get details

593
00:20:59,670 --> 00:21:01,800
on events that you're tracking or

594
00:21:01,800 --> 00:21:03,720
attending and you can get information

595
00:21:03,720 --> 00:21:04,920
about a particular conference so it says

596
00:21:04,920 --> 00:21:06,660
Jess conf because that's got the

597
00:21:06,660 --> 00:21:07,830
scheduling things it would be great if

598
00:21:07,830 --> 00:21:09,450
this worked offline so I can look it up

599
00:21:09,450 --> 00:21:11,010
and I was on a plane or in a different

600
00:21:11,010 --> 00:21:12,690
country wherever but there's too much

601
00:21:12,690 --> 00:21:14,280
data and lanyard to offline afuck ate

602
00:21:14,280 --> 00:21:15,930
everything right but users are only

603
00:21:15,930 --> 00:21:17,760
interested in a subset of the data that

604
00:21:17,760 --> 00:21:20,910
that language has marked pilgrims dive

605
00:21:20,910 --> 00:21:22,770
into html5 that had a decent section on

606
00:21:22,770 --> 00:21:24,150
the application cache and it offered up

607
00:21:24,150 --> 00:21:26,280
a solution to offline ur eyes wikipedia

608
00:21:26,280 --> 00:21:28,400
which is maybe something we could use it

609
00:21:28,400 --> 00:21:31,710
worked by having every page pointing at

610
00:21:31,710 --> 00:21:34,020
our manifest every page and that

611
00:21:34,020 --> 00:21:35,490
manifest just had like the JavaScript

612
00:21:35,490 --> 00:21:39,330
CSS usual stuff because page is pointing

613
00:21:39,330 --> 00:21:40,980
our manifest are implicitly cached as

614
00:21:40,980 --> 00:21:43,170
you kind of get lost in the Wikipedia

615
00:21:43,170 --> 00:21:45,150
labyrinth more and more of the site is

616
00:21:45,150 --> 00:21:47,670
becoming available to you offline dead

617
00:21:47,670 --> 00:21:49,110
simple it doesn't even require

618
00:21:49,110 --> 00:21:51,630
javascript but also as a solution it's

619
00:21:51,630 --> 00:21:53,820
just not good enough reason it's not

620
00:21:53,820 --> 00:21:54,780
good enough is there's no indication

621
00:21:54,780 --> 00:21:56,310
which page is going to be available

622
00:21:56,310 --> 00:21:57,299
offline do you

623
00:21:57,299 --> 00:21:58,619
doesn't know that one of the major

624
00:21:58,619 --> 00:22:00,179
oversights in the spec is there's no way

625
00:22:00,179 --> 00:22:02,100
with JavaScript to ask the browser

626
00:22:02,100 --> 00:22:05,070
what's cached there's nothing there so

627
00:22:05,070 --> 00:22:06,570
we can't we can't provide like a UI to

628
00:22:06,570 --> 00:22:07,860
show the user what they can expect to

629
00:22:07,860 --> 00:22:09,509
work and it's near impossible to manage

630
00:22:09,509 --> 00:22:11,580
update those cached files are only going

631
00:22:11,580 --> 00:22:13,320
to update when the manifest file changes

632
00:22:13,320 --> 00:22:15,960
but when do we change the manifest every

633
00:22:15,960 --> 00:22:17,850
time a page on Wikipedia changes that's

634
00:22:17,850 --> 00:22:20,460
going to be far too frequently and those

635
00:22:20,460 --> 00:22:21,659
updates are going to be heavy as well

636
00:22:21,659 --> 00:22:23,399
imagine you look at 100 pages on

637
00:22:23,399 --> 00:22:25,529
Wikipedia which is you know probably a

638
00:22:25,529 --> 00:22:27,840
conservative number you have 100 pages

639
00:22:27,840 --> 00:22:30,570
cached when a manifest changes that's a

640
00:22:30,570 --> 00:22:32,039
hundred pages for you to download and

641
00:22:32,039 --> 00:22:33,059
we've already decided that that's going

642
00:22:33,059 --> 00:22:35,190
to happen every page load pretty much

643
00:22:35,190 --> 00:22:36,960
latinum was only going to get bigger and

644
00:22:36,960 --> 00:22:37,919
bigger and bigger as you browse around

645
00:22:37,919 --> 00:22:39,330
the site more because we have no cleanup

646
00:22:39,330 --> 00:22:41,580
mechanism got no way of expiring those

647
00:22:41,580 --> 00:22:43,499
pages from the cache the cash will

648
00:22:43,499 --> 00:22:44,940
eventually hit it's allowed limit and

649
00:22:44,940 --> 00:22:47,220
then things will start failing so not

650
00:22:47,220 --> 00:22:49,289
good enough ideally we want to be

651
00:22:49,289 --> 00:22:50,549
showing up to that content to the user

652
00:22:50,549 --> 00:22:53,759
while they're online and in control with

653
00:22:53,759 --> 00:22:55,259
JavaScript which content is going to be

654
00:22:55,259 --> 00:22:56,609
cached and what isn't and defer that

655
00:22:56,609 --> 00:22:58,889
content to the user so maybe in the form

656
00:22:58,889 --> 00:23:00,840
of a save offline or read later button

657
00:23:00,840 --> 00:23:03,989
and indicate which content is available

658
00:23:03,989 --> 00:23:05,399
offline and maybe change the link color

659
00:23:05,399 --> 00:23:06,600
do something there so the user knows

660
00:23:06,600 --> 00:23:08,759
what they can expect it to work for them

661
00:23:08,759 --> 00:23:09,869
when they don't have a connection and

662
00:23:09,869 --> 00:23:11,700
this should be set up with a single view

663
00:23:11,700 --> 00:23:13,409
to any page on the site we can't say to

664
00:23:13,409 --> 00:23:14,609
the user oh if you want the offline

665
00:23:14,609 --> 00:23:16,859
stuff go to slash offline as any page

666
00:23:16,859 --> 00:23:19,769
should make this all work app cache

667
00:23:19,769 --> 00:23:22,619
makes this really really difficult so

668
00:23:22,619 --> 00:23:25,649
when I was a kid we had a sandbox in the

669
00:23:25,649 --> 00:23:27,179
garden not metaphorical sandbox an

670
00:23:27,179 --> 00:23:29,460
actual sandbox with sandy and I'd go

671
00:23:29,460 --> 00:23:31,710
there to play and build stuff you know

672
00:23:31,710 --> 00:23:33,529
it was a real creative outlet for me

673
00:23:33,529 --> 00:23:36,450
unfortunately the family cats they also

674
00:23:36,450 --> 00:23:38,909
used the sound box for a completely

675
00:23:38,909 --> 00:23:41,999
different kind of outlet turns out you

676
00:23:41,999 --> 00:23:44,600
can't build sandcastles a catch it I

677
00:23:44,600 --> 00:23:47,480
made some stunning catch it castles oh

678
00:23:47,480 --> 00:23:50,460
but fast forward 20 years and Here I am

679
00:23:50,460 --> 00:23:52,139
them in the same situation again but

680
00:23:52,139 --> 00:23:53,549
this time it's the idiot someone else is

681
00:23:53,549 --> 00:23:54,840
crapping in my sandbox it's the

682
00:23:54,840 --> 00:23:57,029
application cache putting a manifest

683
00:23:57,029 --> 00:23:58,980
attribute on HTML element means the app

684
00:23:58,980 --> 00:24:01,830
cache moves in and takes over to solve

685
00:24:01,830 --> 00:24:03,269
this we need to take the application

686
00:24:03,269 --> 00:24:07,139
cache and pop him in a box where he can

687
00:24:07,139 --> 00:24:09,299
be Schrodinger's douche bag and we can

688
00:24:09,299 --> 00:24:10,950
leave in there until we care if he's

689
00:24:10,950 --> 00:24:11,130
dead

690
00:24:11,130 --> 00:24:15,150
alive to do this we're going to put the

691
00:24:15,150 --> 00:24:17,400
manifest on one page only just one page

692
00:24:17,400 --> 00:24:20,220
offline stuff to HTML or whatever but

693
00:24:20,220 --> 00:24:21,570
going to make sure that every other page

694
00:24:21,570 --> 00:24:24,120
knows about it by having a little hidden

695
00:24:24,120 --> 00:24:25,920
iframe point into that page so not

696
00:24:25,920 --> 00:24:27,240
matter what page you visit is going to

697
00:24:27,240 --> 00:24:28,590
pick up this cached page and its

698
00:24:28,590 --> 00:24:30,570
manifest the manifest is going to be the

699
00:24:30,570 --> 00:24:32,070
same as you know what we've seen before

700
00:24:32,070 --> 00:24:34,200
CSS JavaScript network rules whatever

701
00:24:34,200 --> 00:24:37,620
but a new rule fall back a fallback rule

702
00:24:37,620 --> 00:24:40,830
has two parts a URL prefix and then a

703
00:24:40,830 --> 00:24:42,570
full relative path to some file to cash

704
00:24:42,570 --> 00:24:44,040
this is the point where they should have

705
00:24:44,040 --> 00:24:45,270
been using JSON or something because

706
00:24:45,270 --> 00:24:46,830
it's getting complicated Google gears

707
00:24:46,830 --> 00:24:49,740
use Jason and it was much more readable

708
00:24:49,740 --> 00:24:52,970
in my opinion so what does fall by 2 ok

709
00:24:52,970 --> 00:24:56,670
so if the URL isn't specifically listed

710
00:24:56,670 --> 00:24:58,860
in the network section it scans all of

711
00:24:58,860 --> 00:25:01,170
these fallback prefixes and it looks for

712
00:25:01,170 --> 00:25:02,760
the largest one that matches the current

713
00:25:02,760 --> 00:25:05,400
URL if any and if there is a match it

714
00:25:05,400 --> 00:25:07,560
will request it normally and if that

715
00:25:07,560 --> 00:25:11,010
request goes ok then it uses it and then

716
00:25:11,010 --> 00:25:12,270
things will continue as if the manifest

717
00:25:12,270 --> 00:25:14,100
wasn't there at all but if the request

718
00:25:14,100 --> 00:25:16,080
fails they'll use the second part the

719
00:25:16,080 --> 00:25:17,460
cache partner will show the cached

720
00:25:17,460 --> 00:25:20,250
version instead and that's really good

721
00:25:20,250 --> 00:25:22,140
because we can we can use that to create

722
00:25:22,140 --> 00:25:23,850
pages that act normally while the user

723
00:25:23,850 --> 00:25:26,610
is online such as this but if we disable

724
00:25:26,610 --> 00:25:29,730
the connection and refresh the page we

725
00:25:29,730 --> 00:25:31,350
get completely different page but the

726
00:25:31,350 --> 00:25:34,110
URL stays the same it's just it's like a

727
00:25:34,110 --> 00:25:35,640
it's more of a rewrite than other than a

728
00:25:35,640 --> 00:25:38,220
redirect so when I bring the connection

729
00:25:38,220 --> 00:25:40,950
back and refresh the page we get the the

730
00:25:40,950 --> 00:25:45,120
online version again unfortunately thank

731
00:25:45,120 --> 00:25:47,940
you I invented that I didn't

732
00:25:47,940 --> 00:25:49,500
unfortunately this gets us into some

733
00:25:49,500 --> 00:25:51,870
browser troubles by using fall back we

734
00:25:51,870 --> 00:25:55,230
wave goodbye to opera support we have

735
00:25:55,230 --> 00:25:56,940
cold like this on lanyard unfortunately

736
00:25:56,940 --> 00:25:58,920
and it's not great but I haven't found a

737
00:25:58,920 --> 00:26:00,960
reliable way of feature detecting fall

738
00:26:00,960 --> 00:26:03,960
back we've got too many false positives

739
00:26:03,960 --> 00:26:06,000
it didn't work i'm looking forward to

740
00:26:06,000 --> 00:26:09,510
removing this one's or prefix is that so

741
00:26:09,510 --> 00:26:11,220
we're using the manifest for static

742
00:26:11,220 --> 00:26:12,810
content only and every user's going to

743
00:26:12,810 --> 00:26:15,810
get the same manifest thank God so where

744
00:26:15,810 --> 00:26:16,980
do we store this the date of that a

745
00:26:16,980 --> 00:26:18,480
particular user wants cached offline

746
00:26:18,480 --> 00:26:20,760
over that we're going to use local

747
00:26:20,760 --> 00:26:22,600
storage and I've flown together

748
00:26:22,600 --> 00:26:25,240
demo of this so you can see from this

749
00:26:25,240 --> 00:26:28,900
page that I have to test articles one of

750
00:26:28,900 --> 00:26:30,789
my test articles is bigger than you have

751
00:26:30,789 --> 00:26:37,120
a test article but that's okay but thank

752
00:26:37,120 --> 00:26:41,559
you sometimes people don't get that joke

753
00:26:41,559 --> 00:26:43,480
okay I just put it in there for my own

754
00:26:43,480 --> 00:26:45,760
entertainment really but as you can see

755
00:26:45,760 --> 00:26:47,410
it's got this save for offline access

756
00:26:47,410 --> 00:26:50,679
button so I'm going to hit that so what

757
00:26:50,679 --> 00:26:53,980
happened when when I press that when i

758
00:26:53,980 --> 00:26:56,049
click that button it looks at the the

759
00:26:56,049 --> 00:26:58,450
URL for the page and gets the HTML

760
00:26:58,450 --> 00:27:00,039
because the URL doesn't change remember

761
00:27:00,039 --> 00:27:03,250
so and then it's going to stall at HTML

762
00:27:03,250 --> 00:27:05,200
into local storage using the pathname of

763
00:27:05,200 --> 00:27:07,510
the URL as a key and we update an index

764
00:27:07,510 --> 00:27:08,740
op object as well so it goes to

765
00:27:08,740 --> 00:27:09,909
something that we can quickly look for

766
00:27:09,909 --> 00:27:12,039
pages available offline on that this

767
00:27:12,039 --> 00:27:13,330
code runs every time the user hits the

768
00:27:13,330 --> 00:27:15,520
cash later button or if they visit the

769
00:27:15,520 --> 00:27:16,809
page later and they've already decided I

770
00:27:16,809 --> 00:27:18,610
want to cash it will run that code again

771
00:27:18,610 --> 00:27:19,809
anyway to make sure that the version in

772
00:27:19,809 --> 00:27:21,520
local storage is as fresh as that the

773
00:27:21,520 --> 00:27:23,500
last version the user saw so if i

774
00:27:23,500 --> 00:27:27,690
disable the connection and hit refresh

775
00:27:27,690 --> 00:27:30,880
write the content comes back but under

776
00:27:30,880 --> 00:27:32,140
the hood it's actually gone to this

777
00:27:32,140 --> 00:27:33,549
completely different fall back page and

778
00:27:33,549 --> 00:27:35,620
what the fall back page does is looks at

779
00:27:35,620 --> 00:27:37,330
the URL because the URL doesn't change

780
00:27:37,330 --> 00:27:39,549
and it looks to see in local storage if

781
00:27:39,549 --> 00:27:41,049
there's content for that URL and if

782
00:27:41,049 --> 00:27:42,730
there is it just repopulate stu page

783
00:27:42,730 --> 00:27:45,429
with it so this is a simplification

784
00:27:45,429 --> 00:27:47,200
you'll also want to catch your l's that

785
00:27:47,200 --> 00:27:49,480
you don't have content for and you know

786
00:27:49,480 --> 00:27:51,340
do more error detection around putting

787
00:27:51,340 --> 00:27:53,770
stuff into local storage but having that

788
00:27:53,770 --> 00:27:55,059
index object is really handy because it

789
00:27:55,059 --> 00:27:56,140
means when we go back to the index we

790
00:27:56,140 --> 00:27:57,309
can just we've got a little piece of

791
00:27:57,309 --> 00:28:00,010
JavaScript I can just go is this your L

792
00:28:00,010 --> 00:28:02,140
cached and we can get a true or false

793
00:28:02,140 --> 00:28:03,760
value and we can show that to the user

794
00:28:03,760 --> 00:28:05,080
so the user knows what they can rely

795
00:28:05,080 --> 00:28:07,020
upon being there when they're offline

796
00:28:07,020 --> 00:28:09,340
this is the same mechanism as we use on

797
00:28:09,340 --> 00:28:12,580
MDOT language comm with a few minor

798
00:28:12,580 --> 00:28:14,650
alterations we store Jason rather than

799
00:28:14,650 --> 00:28:15,970
HTML because it's a more efficient use

800
00:28:15,970 --> 00:28:18,280
of the local storage and we render that

801
00:28:18,280 --> 00:28:20,860
Jason using mustache templates we use

802
00:28:20,860 --> 00:28:22,030
the same mustache templates on the

803
00:28:22,030 --> 00:28:23,350
server as we do on the client so there's

804
00:28:23,350 --> 00:28:25,720
no repetition there and the server

805
00:28:25,720 --> 00:28:27,669
remembers what the user wants cash is we

806
00:28:27,669 --> 00:28:29,710
catch things when you click the attend

807
00:28:29,710 --> 00:28:31,299
but another track button because that

808
00:28:31,299 --> 00:28:32,799
data stored on the server if you lose

809
00:28:32,799 --> 00:28:34,809
your cash or change phone we can quickly

810
00:28:34,809 --> 00:28:36,960
repopulate the

811
00:28:36,960 --> 00:28:39,160
and we expire all day as well when a

812
00:28:39,160 --> 00:28:40,990
conference goes into the into the past

813
00:28:40,990 --> 00:28:43,030
then we get rid of it we assume you need

814
00:28:43,030 --> 00:28:44,710
anymore MDOT Langer calm is is mainly

815
00:28:44,710 --> 00:28:46,750
for current and future conferences the

816
00:28:46,750 --> 00:28:48,700
main sites for the ones in the past and

817
00:28:48,700 --> 00:28:50,200
we do more error detection as well is

818
00:28:50,200 --> 00:28:53,260
the system perfect no now there's a

819
00:28:53,260 --> 00:28:55,600
introduces a few new problems when you

820
00:28:55,600 --> 00:28:57,580
navigate around the site online use that

821
00:28:57,580 --> 00:29:00,520
page is fix fetch bio xhr and we saw

822
00:29:00,520 --> 00:29:02,590
that in asynchronously we change the URL

823
00:29:02,590 --> 00:29:04,570
with push date we do this to avoid

824
00:29:04,570 --> 00:29:05,950
passing some JavaScript you get a minor

825
00:29:05,950 --> 00:29:07,420
performance benefit but it's mainly

826
00:29:07,420 --> 00:29:09,490
about giving a more of an application

827
00:29:09,490 --> 00:29:12,370
like feel to the site app cache screws

828
00:29:12,370 --> 00:29:13,780
is over unfortunately when we do this

829
00:29:13,780 --> 00:29:15,640
and really sorry gonna have to go back

830
00:29:15,640 --> 00:29:18,090
to the diagram earlier we found out that

831
00:29:18,090 --> 00:29:20,350
HTTP requests triggered by a cache page

832
00:29:20,350 --> 00:29:22,150
will always use the manifest of the host

833
00:29:22,150 --> 00:29:24,160
page which is fine however if the

834
00:29:24,160 --> 00:29:26,290
request happens normally then any

835
00:29:26,290 --> 00:29:28,000
requests triggered by that page will

836
00:29:28,000 --> 00:29:31,330
also happen just normally app cache

837
00:29:31,330 --> 00:29:32,980
wants no part of it that means if your

838
00:29:32,980 --> 00:29:34,990
user requests a page when they're online

839
00:29:34,990 --> 00:29:37,060
and it loads fine but then they go

840
00:29:37,060 --> 00:29:38,620
offline like that driving through a

841
00:29:38,620 --> 00:29:42,100
tunnel or whatever new requests like hxh

842
00:29:42,100 --> 00:29:43,570
our JavaScript whatever they will fail

843
00:29:43,570 --> 00:29:45,400
even if they're part of the application

844
00:29:45,400 --> 00:29:47,440
cache even if they're covered by a

845
00:29:47,440 --> 00:29:49,410
fallback rule they will just plain fail

846
00:29:49,410 --> 00:29:51,490
so what we do online your diff a piece

847
00:29:51,490 --> 00:29:54,700
of xhr navigation fails we just set

848
00:29:54,700 --> 00:29:56,920
window.location to whatever the original

849
00:29:56,920 --> 00:29:58,240
request was and that throws things back

850
00:29:58,240 --> 00:29:59,680
to the top of the diagram and the user

851
00:29:59,680 --> 00:30:02,140
barely notices another drawback to this

852
00:30:02,140 --> 00:30:04,360
method is the fall by technique gives us

853
00:30:04,360 --> 00:30:06,010
problems with error feedback to the user

854
00:30:06,010 --> 00:30:09,280
I mentioned before that yo D the

855
00:30:09,280 --> 00:30:11,200
fallback version is is used if the

856
00:30:11,200 --> 00:30:13,600
request habit goes okay but what does ok

857
00:30:13,600 --> 00:30:16,150
mean the request is considered to be

858
00:30:16,150 --> 00:30:18,010
failed if this is some kind of

859
00:30:18,010 --> 00:30:20,350
networking error the HTTP code is for

860
00:30:20,350 --> 00:30:21,490
something something 5 something

861
00:30:21,490 --> 00:30:22,990
something or there's a redirect to

862
00:30:22,990 --> 00:30:25,210
another server that last one can seem a

863
00:30:25,210 --> 00:30:27,130
bit odd the reason for it is this these

864
00:30:27,130 --> 00:30:29,320
things these captive portals so you

865
00:30:29,320 --> 00:30:30,640
request something in it redirects you to

866
00:30:30,640 --> 00:30:32,500
some kind of Wi-Fi thing that wants your

867
00:30:32,500 --> 00:30:34,660
data or wants you to pay for it app

868
00:30:34,660 --> 00:30:36,220
cache is kind of clever here and it

869
00:30:36,220 --> 00:30:37,780
assumes that that counts as no

870
00:30:37,780 --> 00:30:39,220
connection and it will get the version

871
00:30:39,220 --> 00:30:41,530
from the cash if it's there but it also

872
00:30:41,530 --> 00:30:43,150
means you can't legitimately do a server

873
00:30:43,150 --> 00:30:45,100
redirects if you're using app cache so

874
00:30:45,100 --> 00:30:46,960
that means you can make redirect to

875
00:30:46,960 --> 00:30:48,760
Twitter or Facebook for logins instead

876
00:30:48,760 --> 00:30:49,539
you'll need provider

877
00:30:49,539 --> 00:30:50,889
for the user to click on to do that

878
00:30:50,889 --> 00:30:52,570
otherwise your it will count as a failed

879
00:30:52,570 --> 00:30:55,330
request unfortunately when the the

880
00:30:55,330 --> 00:30:57,639
fallback is used we're not told why

881
00:30:57,639 --> 00:30:59,019
there's nothing the API it tells us why

882
00:30:59,019 --> 00:31:00,220
that happened we can't tell the

883
00:31:00,220 --> 00:31:02,830
difference between a mistyped URL and a

884
00:31:02,830 --> 00:31:04,840
URL that the the user just doesn't have

885
00:31:04,840 --> 00:31:06,609
cached offline and that makes our error

886
00:31:06,609 --> 00:31:09,609
messages a little bit vague but that's

887
00:31:09,609 --> 00:31:11,289
it really we've covered all of the

888
00:31:11,289 --> 00:31:13,179
gotchas and it turns what's night offers

889
00:31:13,179 --> 00:31:15,279
a very simple diagram into this big

890
00:31:15,279 --> 00:31:18,429
horrible sprawling Christmas tree I

891
00:31:18,429 --> 00:31:21,789
think of other diagram well the point

892
00:31:21,789 --> 00:31:22,989
I've been trying to make a guess in in

893
00:31:22,989 --> 00:31:24,700
the last 30 minutes is the application

894
00:31:24,700 --> 00:31:27,249
cache is a douche bag as part of my

895
00:31:27,249 --> 00:31:30,039
personal therapy at work I have a

896
00:31:30,039 --> 00:31:31,649
selection of post-it notes on the wall I

897
00:31:31,649 --> 00:31:35,259
have one for each browser and the theory

898
00:31:35,259 --> 00:31:36,909
is I could draw a little against a

899
00:31:36,909 --> 00:31:45,400
browser if it made my day unpleasant

900
00:31:45,410 --> 00:31:47,690
but I had to create one just for the

901
00:31:47,690 --> 00:31:49,310
application cache and it became what

902
00:31:49,310 --> 00:31:51,200
could only be described as riddled with

903
00:31:51,200 --> 00:31:57,110
 very quickly but the application

904
00:31:57,110 --> 00:31:58,280
very quickly but the application
cache is actually extremely useful it

905
00:31:58,280 --> 00:32:00,140
does stuff he does stuff like no other

906
00:32:00,140 --> 00:32:01,700
feature can so we need to learn how to

907
00:32:01,700 --> 00:32:03,530
work with him here's me a presence on a

908
00:32:03,530 --> 00:32:04,850
page will change the behavior of the

909
00:32:04,850 --> 00:32:06,500
site it's not really progressive

910
00:32:06,500 --> 00:32:08,180
enhancement you need to build your whole

911
00:32:08,180 --> 00:32:09,800
site around it which can be okay with

912
00:32:09,800 --> 00:32:10,850
something like sprite cat which is

913
00:32:10,850 --> 00:32:12,620
pretty small but for you know a big

914
00:32:12,620 --> 00:32:14,570
slide such as lanyard you need to

915
00:32:14,570 --> 00:32:17,570
sandbox sandboxing use the iframe trick

916
00:32:17,570 --> 00:32:19,970
so you're only using the app cache of

917
00:32:19,970 --> 00:32:21,740
the connection fails use the app cache

918
00:32:21,740 --> 00:32:23,420
just for static files and then use

919
00:32:23,420 --> 00:32:24,770
something like local storage for

920
00:32:24,770 --> 00:32:26,390
anything optional probably in the future

921
00:32:26,390 --> 00:32:28,100
you're going to use index DB instead for

922
00:32:28,100 --> 00:32:29,830
because that'll be an asynchronous API

923
00:32:29,830 --> 00:32:33,290
and that's it really oh thank you very

924
00:32:33,290 --> 00:32:35,090
much my email address is there if you're

925
00:32:35,090 --> 00:32:36,290
makassar just ask me questions in the

926
00:32:36,290 --> 00:32:38,060
break whatever i'm on twitter a lot of

927
00:32:38,060 --> 00:32:39,890
the demos and stuff or up on github and

928
00:32:39,890 --> 00:32:42,880
the slides are online on language so

