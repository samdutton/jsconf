1
00:00:12,910 --> 00:00:16,550

thank you so can everyone hear me we're

2
00:00:16,550 --> 00:00:18,740
good they gave me a laser pointer which

3
00:00:18,740 --> 00:00:21,320
is a terrible idea but I can't point

4
00:00:21,320 --> 00:00:23,330
that high otherwise so I've tweeted a

5
00:00:23,330 --> 00:00:25,369
link to the slides my Twitter handrails

6
00:00:25,369 --> 00:00:27,439
Calla had if you want to follow along if

7
00:00:27,439 --> 00:00:28,430
you want to experiment instead of

8
00:00:28,430 --> 00:00:30,290
listening to me feel free to go there

9
00:00:30,290 --> 00:00:32,150
there's all sorts of information other

10
00:00:32,150 --> 00:00:35,840
demos to look at other resources check

11
00:00:35,840 --> 00:00:39,650
that out spoiler alright so I'm not

12
00:00:39,650 --> 00:00:41,000
talked about the new mobile web because

13
00:00:41,000 --> 00:00:43,070
we tried that once we tried an old

14
00:00:43,070 --> 00:00:45,800
mobile web we had whap we had wml who

15
00:00:45,800 --> 00:00:47,570
here remembers like Nokia feature phones

16
00:00:47,570 --> 00:00:51,080
with wet ok hey I guess you come close

17
00:00:51,080 --> 00:00:54,410
to to where Nokia is from and you get

18
00:00:54,410 --> 00:00:57,910
people who remember that that's great um

19
00:00:57,910 --> 00:01:00,650
the the power of the web and the reason

20
00:01:00,650 --> 00:01:02,060
whap failed and the reason the iphone

21
00:01:02,060 --> 00:01:03,230
and things like that I've succeeded is

22
00:01:03,230 --> 00:01:05,960
that the web is one platform there's

23
00:01:05,960 --> 00:01:08,869
only one web it's open its universal

24
00:01:08,869 --> 00:01:11,689
it's decentralized the same web is on my

25
00:01:11,689 --> 00:01:15,050
phone that is on my laptop there's no

26
00:01:15,050 --> 00:01:17,570
single gatekeeper there's no web store

27
00:01:17,570 --> 00:01:19,250
that I have to go to and convince

28
00:01:19,250 --> 00:01:21,380
someone to let me publish on the web

29
00:01:21,380 --> 00:01:23,659
there are many new domain providers mini

30
00:01:23,659 --> 00:01:26,090
hosting providers have many options and

31
00:01:26,090 --> 00:01:27,500
this is the power of the web as a medium

32
00:01:27,500 --> 00:01:30,170
it's a very very low barrier to entry

33
00:01:30,170 --> 00:01:32,870
very low friction Democratic medium and

34
00:01:32,870 --> 00:01:36,800
I think that's important so I work for

35
00:01:36,800 --> 00:01:39,010
Mozilla and Mozilla works for the web

36
00:01:39,010 --> 00:01:41,690
Mozilla's a nonprofit that in its

37
00:01:41,690 --> 00:01:43,370
manifesto states that the Internet is a

38
00:01:43,370 --> 00:01:46,220
global public resource that must remain

39
00:01:46,220 --> 00:01:48,979
open and accessible and a key to that is

40
00:01:48,979 --> 00:01:50,620
ensuring that there's a balance between

41
00:01:50,620 --> 00:01:53,810
private interest on the web and public

42
00:01:53,810 --> 00:01:56,720
interest on the web the way that we work

43
00:01:56,720 --> 00:01:59,330
to ensure that balance is about building

44
00:01:59,330 --> 00:02:02,060
firefox firefox is a completely free

45
00:02:02,060 --> 00:02:04,040
open-source web browser you can hack on

46
00:02:04,040 --> 00:02:05,840
the code we're rewriting our dev tools

47
00:02:05,840 --> 00:02:07,729
and react so if you know react you can

48
00:02:07,729 --> 00:02:10,129
make a huge contribution come talk to me

49
00:02:10,129 --> 00:02:11,150
later if you want to learn how to get

50
00:02:11,150 --> 00:02:13,730
involved but we build Firefox so that

51
00:02:13,730 --> 00:02:15,790
when the world's largest corporations

52
00:02:15,790 --> 00:02:19,310
meet to determine what is going into the

53
00:02:19,310 --> 00:02:20,780
web platform what the web is going to

54
00:02:20,780 --> 00:02:23,060
look like that we have earned a place at

55
00:02:23,060 --> 00:02:24,350
that table as a pea

56
00:02:24,350 --> 00:02:26,060
and as a fellow implementer of the web

57
00:02:26,060 --> 00:02:29,420
and that we can influence that we can

58
00:02:29,420 --> 00:02:32,060
speak for the public good as someone

59
00:02:32,060 --> 00:02:33,970
that doesn't have a profit motive I

60
00:02:33,970 --> 00:02:35,840
think that's really important i think

61
00:02:35,840 --> 00:02:37,520
the web is is a global resource it's a

62
00:02:37,520 --> 00:02:39,380
public resource it needs to be preserved

63
00:02:39,380 --> 00:02:41,090
feel free to talk to me about that

64
00:02:41,090 --> 00:02:43,850
afterwards so part of the power of the

65
00:02:43,850 --> 00:02:45,950
web is its ubiquity this is the internet

66
00:02:45,950 --> 00:02:47,270
of twitter account talking about

67
00:02:47,270 --> 00:02:50,030
all the failures in the iot field and

68
00:02:50,030 --> 00:02:52,370
it's being displayed on a samsung smart

69
00:02:52,370 --> 00:02:56,750
fridge in a showroom at a home appliance

70
00:02:56,750 --> 00:02:59,930
store the power of this is that that's

71
00:02:59,930 --> 00:03:03,400
mobile.twitter.com on that smart fridge

72
00:03:03,400 --> 00:03:05,570
samsung didn't have to go out to twitter

73
00:03:05,570 --> 00:03:07,490
and say hey will you please implement

74
00:03:07,490 --> 00:03:11,750
twitter for fridge OS 10 and then they

75
00:03:11,750 --> 00:03:13,490
didn't have another company say LG or

76
00:03:13,490 --> 00:03:14,630
someone else coming and say ah but we

77
00:03:14,630 --> 00:03:16,220
have a better fridge OS can you

78
00:03:16,220 --> 00:03:17,240
implement for hours no they just

79
00:03:17,240 --> 00:03:19,700
implement the web and they have access

80
00:03:19,700 --> 00:03:21,320
to all the contents of the web has and

81
00:03:21,320 --> 00:03:23,500
so the web has this this ability to

82
00:03:23,500 --> 00:03:26,360
shape itself into new forms that we

83
00:03:26,360 --> 00:03:28,550
hadn't imagined yet but all that content

84
00:03:28,550 --> 00:03:32,090
is there it's hugely powerful if you

85
00:03:32,090 --> 00:03:33,230
look closely there a couple things you

86
00:03:33,230 --> 00:03:36,830
can you can learn about this this fridge

87
00:03:36,830 --> 00:03:40,700
for one it's not using it's using the

88
00:03:40,700 --> 00:03:42,080
Samsung built-in browser it's not using

89
00:03:42,080 --> 00:03:44,900
Chrome or Firefox that's custom UI if

90
00:03:44,900 --> 00:03:45,980
you scroll down further you can actually

91
00:03:45,980 --> 00:03:48,290
see it's running Android but you also

92
00:03:48,290 --> 00:03:51,200
know that it has a web connection inside

93
00:03:51,200 --> 00:03:52,970
the showroom floor which means if you

94
00:03:52,970 --> 00:03:54,470
buy the floor model depth of that fridge

95
00:03:54,470 --> 00:03:56,900
you probably get access to home depot or

96
00:03:56,900 --> 00:03:59,570
Sears Wi-Fi network so that's a pretty

97
00:03:59,570 --> 00:04:02,000
good deal and we know that because if it

98
00:04:02,000 --> 00:04:03,470
didn't have a web connection and we

99
00:04:03,470 --> 00:04:05,240
tried to load mobile.twitter.com we'd

100
00:04:05,240 --> 00:04:07,340
see something like this the connection

101
00:04:07,340 --> 00:04:11,750
appears to be offline try again so the

102
00:04:11,750 --> 00:04:13,280
web is ubiquitous but the web isn't

103
00:04:13,280 --> 00:04:16,220
resilient the Twitter app will never do

104
00:04:16,220 --> 00:04:17,690
this you never open twitter on your foam

105
00:04:17,690 --> 00:04:20,450
and you're on a train or on a flight and

106
00:04:20,450 --> 00:04:22,760
say oh I'm sorry just twitter isn't

107
00:04:22,760 --> 00:04:24,560
available right now no you see what data

108
00:04:24,560 --> 00:04:25,940
it had the last time it was available

109
00:04:25,940 --> 00:04:28,640
and you can still compose tweets it'll

110
00:04:28,640 --> 00:04:30,620
just say hey I can't send this until I'm

111
00:04:30,620 --> 00:04:31,970
back online or I can't retrieve new

112
00:04:31,970 --> 00:04:34,490
tweets until I'm back online so apps

113
00:04:34,490 --> 00:04:36,940
have had this this user experience and

114
00:04:36,940 --> 00:04:38,390
reliability

115
00:04:38,390 --> 00:04:41,990
win over the web this talk is going to

116
00:04:41,990 --> 00:04:45,110
talk about how to fix that before we go

117
00:04:45,110 --> 00:04:46,550
on I'm going to be showing a fair amount

118
00:04:46,550 --> 00:04:49,060
of code that uses some es6 features in

119
00:04:49,060 --> 00:04:51,800
particular arrow functions you can think

120
00:04:51,800 --> 00:04:53,690
of them as just a shorthand if you look

121
00:04:53,690 --> 00:04:56,150
for that fat arrow there on the left

122
00:04:56,150 --> 00:04:59,210
hand side are the parameters on the

123
00:04:59,210 --> 00:05:01,040
right hand side is the return value so

124
00:05:01,040 --> 00:05:03,110
these two lines are equivalent take X

125
00:05:03,110 --> 00:05:06,350
return x times two there are some

126
00:05:06,350 --> 00:05:07,880
nuances about how error functions are

127
00:05:07,880 --> 00:05:09,830
different from normal functions but this

128
00:05:09,830 --> 00:05:11,510
is a j/s conference you can ask anyone

129
00:05:11,510 --> 00:05:14,290
else at your table and someone will know

130
00:05:14,290 --> 00:05:16,220
the second thing you're going to see a

131
00:05:16,220 --> 00:05:18,080
lot of our promises the signifier of

132
00:05:18,080 --> 00:05:20,620
promises are this dot then method

133
00:05:20,620 --> 00:05:24,230
promises are an official es6 codified

134
00:05:24,230 --> 00:05:26,030
way of handling a synchronicity in

135
00:05:26,030 --> 00:05:28,010
JavaScript we used to have to nest call

136
00:05:28,010 --> 00:05:29,420
back inside call back inside call back

137
00:05:29,420 --> 00:05:31,850
inside callback which worked but admit

138
00:05:31,850 --> 00:05:33,940
that the order of execution of our code

139
00:05:33,940 --> 00:05:36,860
wasn't a syntactic thing it wasn't this

140
00:05:36,860 --> 00:05:38,120
statement than this statement this since

141
00:05:38,120 --> 00:05:40,580
then this statement it was a side effect

142
00:05:40,580 --> 00:05:43,400
of the nesting of our code makes a code

143
00:05:43,400 --> 00:05:45,080
harder to reason about makes things

144
00:05:45,080 --> 00:05:47,240
harder air is hard to deal with promises

145
00:05:47,240 --> 00:05:49,700
let you just say do this dot then

146
00:05:49,700 --> 00:05:51,410
whenever that finishes call this

147
00:05:51,410 --> 00:05:54,020
callback then call this callback and if

148
00:05:54,020 --> 00:05:55,880
any of them fail pass the error to this

149
00:05:55,880 --> 00:05:58,850
handler you'll see this a lot fetch also

150
00:05:58,850 --> 00:06:00,710
if you haven't seen it promisee

151
00:06:00,710 --> 00:06:03,830
replacement for xml httprequest that's

152
00:06:03,830 --> 00:06:05,960
valid syntax you say fetched you give it

153
00:06:05,960 --> 00:06:08,120
a URL you can optionally pass like

154
00:06:08,120 --> 00:06:11,720
method post I cannot I'm a professional

155
00:06:11,720 --> 00:06:13,790
software developer I cannot write an xhr

156
00:06:13,790 --> 00:06:16,280
request by hand thus intact can anyone

157
00:06:16,280 --> 00:06:17,570
in the room do you remember the syntax

158
00:06:17,570 --> 00:06:19,760
well enough all right you turn to

159
00:06:19,760 --> 00:06:22,960
someone at your table improve it

160
00:06:22,970 --> 00:06:25,350
fetch on the other game fetch data you

161
00:06:25,350 --> 00:06:26,310
get a promise back the promise

162
00:06:26,310 --> 00:06:28,740
eventually returns the data promises are

163
00:06:28,740 --> 00:06:30,240
everywhere now that we have a way to

164
00:06:30,240 --> 00:06:32,640
handle a synchronicity you'll see them

165
00:06:32,640 --> 00:06:33,780
coming up in standards like fetch

166
00:06:33,780 --> 00:06:36,240
service workers push background sync the

167
00:06:36,240 --> 00:06:38,910
new es 2017 a sink and wait keywords are

168
00:06:38,910 --> 00:06:41,250
just syntactic sugar around promises so

169
00:06:41,250 --> 00:06:42,780
you'll have to understand how these work

170
00:06:42,780 --> 00:06:45,240
I really recommend investing the time to

171
00:06:45,240 --> 00:06:46,830
to go through some blog articles go

172
00:06:46,830 --> 00:06:48,450
through some experiments figure these

173
00:06:48,450 --> 00:06:51,870
things out so back on track reliability

174
00:06:51,870 --> 00:06:54,510
how does service workers help us solve

175
00:06:54,510 --> 00:06:58,130
reliability what's the service worker

176
00:06:58,130 --> 00:07:00,390
showing hands who here knows what a

177
00:07:00,390 --> 00:07:04,800
service worker is all right who here has

178
00:07:04,800 --> 00:07:08,490
used them in production oh okay so maybe

179
00:07:08,490 --> 00:07:10,050
if you can write an xhr by handed UV

180
00:07:10,050 --> 00:07:11,970
service workers in production I believe

181
00:07:11,970 --> 00:07:14,910
you on both of those counts there are

182
00:07:14,910 --> 00:07:17,190
people doing this it's it's available

183
00:07:17,190 --> 00:07:19,230
it's in the release versions of Firefox

184
00:07:19,230 --> 00:07:22,560
and Chrome and opera basically service

185
00:07:22,560 --> 00:07:25,380
workers are like script tags but for a

186
00:07:25,380 --> 00:07:26,490
whole domain instead of for an

187
00:07:26,490 --> 00:07:28,530
individual page so when you open a new

188
00:07:28,530 --> 00:07:30,180
tab the scripts on the page run you

189
00:07:30,180 --> 00:07:32,160
close the tab the scripts die service

190
00:07:32,160 --> 00:07:34,500
workers aren't quite like that service

191
00:07:34,500 --> 00:07:36,750
workers could be running without any

192
00:07:36,750 --> 00:07:38,430
tabs open at all or you could have 10

193
00:07:38,430 --> 00:07:40,410
tabs open all sharing the same service

194
00:07:40,410 --> 00:07:45,180
worker so it's a way to start providing

195
00:07:45,180 --> 00:07:47,130
an alternative to the page model of the

196
00:07:47,130 --> 00:07:49,260
web not a replacement for an alternative

197
00:07:49,260 --> 00:07:50,340
because there are some things in the

198
00:07:50,340 --> 00:07:52,970
page model just doesn't work for of

199
00:07:52,970 --> 00:07:54,870
course service workers are going to have

200
00:07:54,870 --> 00:07:56,490
some some superpowers if they can run

201
00:07:56,490 --> 00:07:58,770
without any tabs open and if they're

202
00:07:58,770 --> 00:07:59,730
going to be able to do things like

203
00:07:59,730 --> 00:08:02,070
making the web work offline so like any

204
00:08:02,070 --> 00:08:04,080
other powerful API service workers

205
00:08:04,080 --> 00:08:05,880
require a secure connection you have to

206
00:08:05,880 --> 00:08:09,840
have a TLS certificate show hands let's

207
00:08:09,840 --> 00:08:12,570
encrypt if people heard of used it okay

208
00:08:12,570 --> 00:08:13,830
for those of you I haven't let's encrypt

209
00:08:13,830 --> 00:08:15,000
as a joint venture between the

210
00:08:15,000 --> 00:08:16,260
Electronic Frontier Foundation and

211
00:08:16,260 --> 00:08:19,340
Mozilla to provide free TLS certificates

212
00:08:19,340 --> 00:08:22,590
that are trusted by every browser that

213
00:08:22,590 --> 00:08:24,240
are usable for anything private use

214
00:08:24,240 --> 00:08:26,310
personal use corporate use for profit

215
00:08:26,310 --> 00:08:29,340
whatever security should it shouldn't be

216
00:08:29,340 --> 00:08:30,990
a choice between security and your

217
00:08:30,990 --> 00:08:33,839
wallet so that's super great this tip if

218
00:08:33,839 --> 00:08:35,190
you remember nothing else is worth at

219
00:08:35,190 --> 00:08:35,790
least

220
00:08:35,790 --> 00:08:38,460
two thousand kronor which to put it in

221
00:08:38,460 --> 00:08:40,410
even further local terms is about for

222
00:08:40,410 --> 00:08:44,370
pizza and a coke so so you could either

223
00:08:44,370 --> 00:08:45,900
have a certificate or you could have a

224
00:08:45,900 --> 00:08:49,170
certificate and some pizza I know what I

225
00:08:49,170 --> 00:08:53,070
choose so how do these work you use a

226
00:08:53,070 --> 00:08:54,840
script tag to do can I have per page

227
00:08:54,840 --> 00:08:56,610
JavaScript for a service worker you have

228
00:08:56,610 --> 00:08:59,460
to install the service worker file using

229
00:08:59,460 --> 00:09:02,670
javascript so somewhere in a script tag

230
00:09:02,670 --> 00:09:04,410
you check for support so you do feature

231
00:09:04,410 --> 00:09:05,790
detection if service worker and

232
00:09:05,790 --> 00:09:08,190
navigator then navigate our service

233
00:09:08,190 --> 00:09:09,840
worker register and you pass it the

234
00:09:09,840 --> 00:09:11,220
script to your JavaScript or the path to

235
00:09:11,220 --> 00:09:13,800
your javascript file you can also set

236
00:09:13,800 --> 00:09:15,630
the scope of the service worker by

237
00:09:15,630 --> 00:09:17,460
default it would just be the folder that

238
00:09:17,460 --> 00:09:19,620
the worker itself is N and this kind of

239
00:09:19,620 --> 00:09:22,140
says what what page is my URL bar say

240
00:09:22,140 --> 00:09:24,510
and what service worker gets to control

241
00:09:24,510 --> 00:09:26,760
that page so by setting the scope to the

242
00:09:26,760 --> 00:09:28,860
root any page on my domain could

243
00:09:28,860 --> 00:09:29,940
potentially be controlled by this

244
00:09:29,940 --> 00:09:32,760
service worker you can have multiple

245
00:09:32,760 --> 00:09:34,530
service workers for your domain only one

246
00:09:34,530 --> 00:09:36,030
will work at a time and the most

247
00:09:36,030 --> 00:09:40,480
specific one is the one that's selected

248
00:09:40,490 --> 00:09:42,510
one of the most immediate things you

249
00:09:42,510 --> 00:09:44,640
might want to do is preload a cache we

250
00:09:44,640 --> 00:09:45,840
want to make the web work offline there

251
00:09:45,840 --> 00:09:47,070
are things you're going to want to have

252
00:09:47,070 --> 00:09:48,060
available you're going to want your

253
00:09:48,060 --> 00:09:49,110
stylesheet you're going to want your

254
00:09:49,110 --> 00:09:52,410
basic a pelagic a service worker because

255
00:09:52,410 --> 00:09:54,720
it's running in a separate thread it's

256
00:09:54,720 --> 00:09:57,330
running independent of tabs every API

257
00:09:57,330 --> 00:10:01,050
uses is event-based an asynchronous so

258
00:10:01,050 --> 00:10:02,880
when we do this install step the

259
00:10:02,880 --> 00:10:05,340
serviceworker file we downloaded saved

260
00:10:05,340 --> 00:10:06,840
in the browser and it'll start running

261
00:10:06,840 --> 00:10:08,970
the browser will then give it an install

262
00:10:08,970 --> 00:10:10,590
event so we can add an event listener

263
00:10:10,590 --> 00:10:13,170
for install and say alright don't

264
00:10:13,170 --> 00:10:15,200
resolve this init like wait until we

265
00:10:15,200 --> 00:10:18,360
open a cache and then add all these URLs

266
00:10:18,360 --> 00:10:21,900
to the cash the caches API you say

267
00:10:21,900 --> 00:10:24,030
caches that open and give it a name of a

268
00:10:24,030 --> 00:10:25,590
cash if it doesn't exist it gets created

269
00:10:25,590 --> 00:10:29,430
and then you get a cash reference to

270
00:10:29,430 --> 00:10:32,070
that opened cash and you can do things

271
00:10:32,070 --> 00:10:34,770
like add requests go and synthesize

272
00:10:34,770 --> 00:10:37,770
requests delete things you can inspect

273
00:10:37,770 --> 00:10:39,750
the whole cache the only things that

274
00:10:39,750 --> 00:10:41,100
ever appear in this cache are things

275
00:10:41,100 --> 00:10:43,410
that you put there it's subject to a

276
00:10:43,410 --> 00:10:44,820
normal browser quotas like you would see

277
00:10:44,820 --> 00:10:46,740
for index TV or other things if the

278
00:10:46,740 --> 00:10:48,330
browser ever needs more space it'll stop

279
00:10:48,330 --> 00:10:49,059
it will start

280
00:10:49,059 --> 00:10:50,769
dropping from the least recently used

281
00:10:50,769 --> 00:10:53,379
cash entire caches at once so you'll

282
00:10:53,379 --> 00:10:55,029
never have a situation where like half

283
00:10:55,029 --> 00:10:56,619
of your cash is missing either

284
00:10:56,619 --> 00:10:58,179
everything you put in there is there or

285
00:10:58,179 --> 00:11:01,599
nothing is there so I say all right on

286
00:11:01,599 --> 00:11:03,159
the install event go and cash these

287
00:11:03,159 --> 00:11:04,539
things for us they can be on other

288
00:11:04,539 --> 00:11:05,889
domains they could be other resources

289
00:11:05,889 --> 00:11:08,889
but we can say we want these files in

290
00:11:08,889 --> 00:11:10,959
the cache and then the service worker

291
00:11:10,959 --> 00:11:13,569
and this oh it's actually may be legible

292
00:11:13,569 --> 00:11:15,969
a screen is huge if you're looking at

293
00:11:15,969 --> 00:11:17,469
the slides yourself this is much more

294
00:11:17,469 --> 00:11:18,789
legible but more important thing is just

295
00:11:18,789 --> 00:11:24,489
these these graphics the serviceworker

296
00:11:24,489 --> 00:11:27,399
can act as a proxy inside the users

297
00:11:27,399 --> 00:11:30,279
browser that can intercept and modify

298
00:11:30,279 --> 00:11:32,469
requests it can intercept and modify

299
00:11:32,469 --> 00:11:34,749
responses so when a page goes and

300
00:11:34,749 --> 00:11:36,239
request something like a style sheet

301
00:11:36,239 --> 00:11:38,079
instead of going directly to the

302
00:11:38,079 --> 00:11:40,239
Internet first a fetch event will happen

303
00:11:40,239 --> 00:11:44,349
inside the serviceworker the

304
00:11:44,349 --> 00:11:45,369
serviceworker could say all right well I

305
00:11:45,369 --> 00:11:46,659
have that my cash I can respond from the

306
00:11:46,659 --> 00:11:47,649
cache and that request will never

307
00:11:47,649 --> 00:11:51,489
actually hit the network and it codes

308
00:11:51,489 --> 00:11:52,779
pretty straightforward you can say all

309
00:11:52,779 --> 00:11:53,829
right add an event listener for fetch

310
00:11:53,829 --> 00:11:57,159
and then event respond with caches match

311
00:11:57,159 --> 00:11:59,439
so caches match will search every cash

312
00:11:59,439 --> 00:12:02,829
in that domain look for that events

313
00:12:02,829 --> 00:12:05,199
request so that request object has the

314
00:12:05,199 --> 00:12:08,979
URL the mode the method the headers and

315
00:12:08,979 --> 00:12:11,409
then if we get a response back if the

316
00:12:11,409 --> 00:12:13,379
response is truth if we had a cache hit

317
00:12:13,379 --> 00:12:17,019
return from the cash otherwise go and

318
00:12:17,019 --> 00:12:18,939
fetch out to the network just resend

319
00:12:18,939 --> 00:12:22,539
that request it looks a little bit like

320
00:12:22,539 --> 00:12:26,409
this started a page page once a file it

321
00:12:26,409 --> 00:12:27,609
goes to the serviceworker service worker

322
00:12:27,609 --> 00:12:30,009
says wait I'm going to check my cash if

323
00:12:30,009 --> 00:12:31,629
that fails I'll go to the network and

324
00:12:31,629 --> 00:12:35,079
I'll return that to the browser you can

325
00:12:35,079 --> 00:12:36,549
also flip this and say actually I want

326
00:12:36,549 --> 00:12:38,169
to try to go to the network first but if

327
00:12:38,169 --> 00:12:40,359
that fails show the cash version so you

328
00:12:40,359 --> 00:12:41,919
you're preferring the up-to-date version

329
00:12:41,919 --> 00:12:45,669
and falling back to the cash you could

330
00:12:45,669 --> 00:12:48,189
even build a hybrid that says I want to

331
00:12:48,189 --> 00:12:50,109
try I want to immediately return the

332
00:12:50,109 --> 00:12:53,169
cash version but in parallel I want to

333
00:12:53,169 --> 00:12:54,249
go to the network and get an updated

334
00:12:54,249 --> 00:12:58,400
version for the next time

335
00:12:58,410 --> 00:13:00,720
as an example I've got a video here of

336
00:13:00,720 --> 00:13:02,190
something happening on phone but there's

337
00:13:02,190 --> 00:13:03,660
only one web so we're going to do it on

338
00:13:03,660 --> 00:13:06,470
my desktop my normal browser instead

339
00:13:06,470 --> 00:13:09,269
this is pokedex org which I previously

340
00:13:09,269 --> 00:13:11,040
didn't understand anything about but

341
00:13:11,040 --> 00:13:13,529
then Pokemon go happened and I can tell

342
00:13:13,529 --> 00:13:16,860
you all about it so no one loss in the

343
00:13:16,860 --> 00:13:18,480
author of pouch DB you wrote this as a

344
00:13:18,480 --> 00:13:20,069
demo to show all sorts of techniques for

345
00:13:20,069 --> 00:13:23,370
making sites work well offline one of

346
00:13:23,370 --> 00:13:25,620
the things you'll notice is that in the

347
00:13:25,620 --> 00:13:27,300
inspector all of the style sheets using

348
00:13:27,300 --> 00:13:30,180
CSS spriting but it's just a normal link

349
00:13:30,180 --> 00:13:32,160
rel stylesheet tag and it's a normal

350
00:13:32,160 --> 00:13:36,870
script source j s main DJ s from the

351
00:13:36,870 --> 00:13:40,680
perspective of this website it has no

352
00:13:40,680 --> 00:13:41,850
idea that there's going to be a

353
00:13:41,850 --> 00:13:43,259
serviceworker between it and the

354
00:13:43,259 --> 00:13:44,819
internet it has no idea it's behind a

355
00:13:44,819 --> 00:13:51,389
proxy but if i turn my Wi-Fi off what's

356
00:13:51,389 --> 00:13:54,000
the network tab that's you know this

357
00:13:54,000 --> 00:13:55,529
isn't surprising javascript can do this

358
00:13:55,529 --> 00:14:01,589
but what if i refresh the page but still

359
00:14:01,589 --> 00:14:03,720
worked if you look over the transferred

360
00:14:03,720 --> 00:14:04,949
we can see that this is coming from a

361
00:14:04,949 --> 00:14:06,269
serviceworker instead of the network and

362
00:14:06,269 --> 00:14:07,699
we can actually go into any of these and

363
00:14:07,699 --> 00:14:11,819
see the response headers we can see the

364
00:14:11,819 --> 00:14:13,709
actual response this looks to the

365
00:14:13,709 --> 00:14:15,630
browser just like a normal network

366
00:14:15,630 --> 00:14:17,730
requests all the headers are there the

367
00:14:17,730 --> 00:14:20,040
body is there it went out and just

368
00:14:20,040 --> 00:14:21,360
instead of making it all the way to the

369
00:14:21,360 --> 00:14:22,620
internet before it realized it didn't

370
00:14:22,620 --> 00:14:24,060
have a network connection the

371
00:14:24,060 --> 00:14:25,620
serviceworker stuff didn't said wait I

372
00:14:25,620 --> 00:14:27,750
have that my cash I'm going to return

373
00:14:27,750 --> 00:14:30,660
that in Firefox you can also go into the

374
00:14:30,660 --> 00:14:34,339
storage panel look into cash storage and

375
00:14:34,339 --> 00:14:36,329
see all of the files that are actually

376
00:14:36,329 --> 00:14:38,339
cached by the site you also go into

377
00:14:38,339 --> 00:14:40,980
index DB and see all the the pokemon

378
00:14:40,980 --> 00:14:42,959
data is stored in there this whole site

379
00:14:42,959 --> 00:14:46,170
is open source if you click on the about

380
00:14:46,170 --> 00:14:48,209
link you get that super great resource

381
00:14:48,209 --> 00:14:51,059
to look at and learn if we actually go

382
00:14:51,059 --> 00:14:58,740
into the the worker another broke i'm

383
00:14:58,740 --> 00:15:01,920
using a nightly build with some weird

384
00:15:01,920 --> 00:15:04,199
settings so i'll go into about debugging

385
00:15:04,199 --> 00:15:05,699
in firefox which will list all the

386
00:15:05,699 --> 00:15:09,300
workers and so i can start this worker

387
00:15:09,300 --> 00:15:11,640
up i can debug it

388
00:15:11,640 --> 00:15:14,400
and then in here all right it's all

389
00:15:14,400 --> 00:15:17,130
Babel if I'd whatever if we go into the

390
00:15:17,130 --> 00:15:19,170
repo will do this later or you can do

391
00:15:19,170 --> 00:15:20,490
this later on your own you'll see that

392
00:15:20,490 --> 00:15:23,520
the code that Nolan's using literally is

393
00:15:23,520 --> 00:15:27,630
these seven lines six lines we're saying

394
00:15:27,630 --> 00:15:29,730
look in the cache if there's a response

395
00:15:29,730 --> 00:15:32,550
return it otherwise go to the network so

396
00:15:32,550 --> 00:15:33,900
you can do this for real and it it makes

397
00:15:33,900 --> 00:15:36,510
a website that you know I can close it I

398
00:15:36,510 --> 00:15:42,570
can open it again pokedex org just as if

399
00:15:42,570 --> 00:15:44,970
I was online I'm not if I was in a

400
00:15:44,970 --> 00:15:46,260
browser that didn't support service

401
00:15:46,260 --> 00:15:48,510
workers like Safari and I try to go a

402
00:15:48,510 --> 00:15:50,310
pokedex torg not connected to the

403
00:15:50,310 --> 00:15:52,410
Internet so this is an interesting

404
00:15:52,410 --> 00:15:53,790
property of service workers the first

405
00:15:53,790 --> 00:15:55,770
time you hit the site you don't have the

406
00:15:55,770 --> 00:15:57,120
serviceworker either even if your

407
00:15:57,120 --> 00:15:59,970
browser supports it so your site always

408
00:15:59,970 --> 00:16:02,010
has to work as if service workers

409
00:16:02,010 --> 00:16:04,230
weren't there but if they are you get a

410
00:16:04,230 --> 00:16:05,700
better experience when you come back and

411
00:16:05,700 --> 00:16:08,040
when Apple finally decides to support

412
00:16:08,040 --> 00:16:09,840
service workers so far our users will

413
00:16:09,840 --> 00:16:11,580
also get a better experience without you

414
00:16:11,580 --> 00:16:14,190
having to change any code the the nice

415
00:16:14,190 --> 00:16:15,330
thing about service workers is that it

416
00:16:15,330 --> 00:16:16,920
falls back to a traditional Internet

417
00:16:16,920 --> 00:16:18,870
experience instead of being something

418
00:16:18,870 --> 00:16:20,460
that locks people out you're not

419
00:16:20,460 --> 00:16:22,290
splitting the web into the serviceworker

420
00:16:22,290 --> 00:16:26,040
people and the people that don't let's

421
00:16:26,040 --> 00:16:32,130
turn Wi-Fi back on service workers also

422
00:16:32,130 --> 00:16:33,750
give you complete programmatic control

423
00:16:33,750 --> 00:16:35,640
over requests and responses you don't

424
00:16:35,640 --> 00:16:38,070
just have to do simple caching there's a

425
00:16:38,070 --> 00:16:40,590
link in the slides to this project SW

426
00:16:40,590 --> 00:16:43,500
delta which will intercept requests and

427
00:16:43,500 --> 00:16:46,050
append the version you have so if you

428
00:16:46,050 --> 00:16:49,290
ask for URL main DJ s and the version

429
00:16:49,290 --> 00:16:51,090
your cash is one dot one dot one this

430
00:16:51,090 --> 00:16:53,160
will attend a query parameter cash one

431
00:16:53,160 --> 00:16:54,900
that one not one and then it has a

432
00:16:54,900 --> 00:16:56,400
server-side implementation it looks at

433
00:16:56,400 --> 00:16:58,560
the difference between the latest

434
00:16:58,560 --> 00:17:01,020
version and the cash version creates a

435
00:17:01,020 --> 00:17:03,450
diff ships the diff back the service

436
00:17:03,450 --> 00:17:05,040
worker applies the diff to the the

437
00:17:05,040 --> 00:17:07,110
cached version puts that back in the

438
00:17:07,110 --> 00:17:09,540
cache and then returns that and so this

439
00:17:09,540 --> 00:17:13,140
is a way to kind of ship deltas and save

440
00:17:13,140 --> 00:17:14,570
a lot of band let's save a lot of time

441
00:17:14,570 --> 00:17:18,120
for questionable increases are

442
00:17:18,120 --> 00:17:20,339
non-trivial increases in complexity but

443
00:17:20,339 --> 00:17:21,510
it gives you an idea of the sorts of

444
00:17:21,510 --> 00:17:23,730
creative uses you could use this for

445
00:17:23,730 --> 00:17:25,410
it's not just

446
00:17:25,410 --> 00:17:31,590
or this file as it is unmodified the

447
00:17:31,590 --> 00:17:35,190
second big gap with web versus apps is

448
00:17:35,190 --> 00:17:36,960
engagement throughout the rest of the

449
00:17:36,960 --> 00:17:38,220
conference think about how many times

450
00:17:38,220 --> 00:17:40,980
you take your phone out turn on the

451
00:17:40,980 --> 00:17:42,150
screen just glance at what notifications

452
00:17:42,150 --> 00:17:45,000
are there or how many times you pull

453
00:17:45,000 --> 00:17:46,530
your phone out of your pocket because it

454
00:17:46,530 --> 00:17:48,450
vibrated to tell you you how to

455
00:17:48,450 --> 00:17:52,890
notification apps can tell you when

456
00:17:52,890 --> 00:17:54,060
they're done with something you don't

457
00:17:54,060 --> 00:17:55,140
have to go in and check I don't have to

458
00:17:55,140 --> 00:17:56,910
go and see has dr finished uploading

459
00:17:56,910 --> 00:17:59,040
this file by switching the tab or

460
00:17:59,040 --> 00:18:01,260
refreshing it it'll tell me when it's

461
00:18:01,260 --> 00:18:03,660
done and the web has had the ability to

462
00:18:03,660 --> 00:18:06,210
provide notifications and they can show

463
00:18:06,210 --> 00:18:07,260
up just like any other native

464
00:18:07,260 --> 00:18:09,480
notification but they've been limited to

465
00:18:09,480 --> 00:18:11,580
being on a single page as long as you

466
00:18:11,580 --> 00:18:12,810
have the page open it can give you a

467
00:18:12,810 --> 00:18:16,010
desktop notification slack does this

468
00:18:16,010 --> 00:18:19,230
service workers get you away from that

469
00:18:19,230 --> 00:18:21,270
page model they give you a script that

470
00:18:21,270 --> 00:18:23,820
can run independent of the tabs so you

471
00:18:23,820 --> 00:18:24,870
could actually have a service worker

472
00:18:24,870 --> 00:18:27,780
that when it got an event show in a

473
00:18:27,780 --> 00:18:30,000
notification even if the tab wasn't open

474
00:18:30,000 --> 00:18:31,710
so you can close your gmail tab and

475
00:18:31,710 --> 00:18:34,980
still get notifications of new mail in

476
00:18:34,980 --> 00:18:36,510
fact Facebook is doing this in

477
00:18:36,510 --> 00:18:38,610
production these are notifications

478
00:18:38,610 --> 00:18:40,140
native notifications on Android coming

479
00:18:40,140 --> 00:18:42,630
from facebook com without the browser

480
00:18:42,630 --> 00:18:47,100
being open at all again service workers

481
00:18:47,100 --> 00:18:48,810
are vented so we'll use the push event

482
00:18:48,810 --> 00:18:52,620
for this when we get a push event we say

483
00:18:52,620 --> 00:18:54,330
okay show notification with a title and

484
00:18:54,330 --> 00:18:58,380
a body done so we've looked at three

485
00:18:58,380 --> 00:18:59,550
events so far and service workers

486
00:18:59,550 --> 00:19:01,590
install which is when you first get the

487
00:19:01,590 --> 00:19:03,450
serviceworker fetch which is when a

488
00:19:03,450 --> 00:19:04,920
network request goes out trigger by an

489
00:19:04,920 --> 00:19:07,800
image tag or a script tag or an xhr push

490
00:19:07,800 --> 00:19:10,410
which is when the site wants to notify

491
00:19:10,410 --> 00:19:13,410
the browser somehow there are many other

492
00:19:13,410 --> 00:19:15,720
events that exist or will be coming a

493
00:19:15,720 --> 00:19:18,390
background sync is one that says wake up

494
00:19:18,390 --> 00:19:19,530
the service worker and let it do some

495
00:19:19,530 --> 00:19:21,990
work when I come back online there are

496
00:19:21,990 --> 00:19:23,820
proposals and ideas for things like

497
00:19:23,820 --> 00:19:25,350
geofencing wake up the service worker

498
00:19:25,350 --> 00:19:27,570
and let it run a call back when I enter

499
00:19:27,570 --> 00:19:30,150
a geographic area or wake it up at this

500
00:19:30,150 --> 00:19:33,060
time and date the service worker story

501
00:19:33,060 --> 00:19:34,650
is much more generic and much more

502
00:19:34,650 --> 00:19:38,100
general a general purpose than the

503
00:19:38,100 --> 00:19:39,030
specific application

504
00:19:39,030 --> 00:19:43,830
of make it offline suggests so where

505
00:19:43,830 --> 00:19:47,220
does this push up and come from well

506
00:19:47,220 --> 00:19:50,550
first when you push it'll look like a

507
00:19:50,550 --> 00:19:52,670
completely neat browser native OS native

508
00:19:52,670 --> 00:19:54,750
notification right inside it you can

509
00:19:54,750 --> 00:19:57,600
disable notifications because that can

510
00:19:57,600 --> 00:19:58,590
be annoying of course you have to give

511
00:19:58,590 --> 00:20:02,700
permission the way you get permission is

512
00:20:02,700 --> 00:20:04,980
in your JavaScript on your page you say

513
00:20:04,980 --> 00:20:07,710
navigator serviceworker ready then once

514
00:20:07,710 --> 00:20:09,000
the serviceworker is ready you can call

515
00:20:09,000 --> 00:20:13,560
push manager subscribe and then if the

516
00:20:13,560 --> 00:20:14,970
user clicks ok you get a subscription

517
00:20:14,970 --> 00:20:17,490
object that subscription object has all

518
00:20:17,490 --> 00:20:19,590
the metadata you need to show

519
00:20:19,590 --> 00:20:23,160
notifications on your users computers so

520
00:20:23,160 --> 00:20:24,090
what you'll want to do is you want to

521
00:20:24,090 --> 00:20:26,190
take that subscription object turn into

522
00:20:26,190 --> 00:20:28,950
JSON post it to your back-end somewhere

523
00:20:28,950 --> 00:20:30,750
and save it have a database row that

524
00:20:30,750 --> 00:20:32,880
says this user account has this

525
00:20:32,880 --> 00:20:38,340
subscription metadata Mozilla has a

526
00:20:38,340 --> 00:20:39,390
website called the serviceworker

527
00:20:39,390 --> 00:20:42,720
cookbook at the ever so klever service

528
00:20:42,720 --> 00:20:48,210
work ers domain that has annotated

529
00:20:48,210 --> 00:20:51,330
examples of all of this for the push

530
00:20:51,330 --> 00:20:53,820
example what you'll see is when you get

531
00:20:53,820 --> 00:20:55,800
that subscription back inside is this

532
00:20:55,800 --> 00:20:59,400
enormously ridiculous URL at updates top

533
00:20:59,400 --> 00:21:02,610
pushed at services mozilla com and if

534
00:21:02,610 --> 00:21:09,390
you post to that URL and if the Wi-Fi

535
00:21:09,390 --> 00:21:16,440
works there we go hello world I get a

536
00:21:16,440 --> 00:21:19,590
notification you see that the domain

537
00:21:19,590 --> 00:21:21,210
returned in 201 created which lets me

538
00:21:21,210 --> 00:21:23,910
know that that message was successfully

539
00:21:23,910 --> 00:21:26,370
in queued for delivery to the browser do

540
00:21:26,370 --> 00:21:29,640
it again and because these are native

541
00:21:29,640 --> 00:21:30,930
operating system messages they show up

542
00:21:30,930 --> 00:21:33,060
in my notification drawer and dismiss

543
00:21:33,060 --> 00:21:37,440
them and mass what the heck is happening

544
00:21:37,440 --> 00:21:42,310
here where did this URL come from I

545
00:21:42,320 --> 00:21:44,610
learned graph is about an hour ago and

546
00:21:44,610 --> 00:21:46,710
built a graph for us instead of a

547
00:21:46,710 --> 00:21:51,570
whiteboard what happens is the website

548
00:21:51,570 --> 00:21:53,490
does that get

549
00:21:53,490 --> 00:21:55,539
request it says I want to be able to

550
00:21:55,539 --> 00:21:57,659
show you service show you notifications

551
00:21:57,659 --> 00:22:00,279
the browser asks the user the user can

552
00:22:00,279 --> 00:22:02,770
sense the browser will go up to a third

553
00:22:02,770 --> 00:22:04,600
party service operated by your browser

554
00:22:04,600 --> 00:22:06,760
manufacturer so chrome ones what chrome

555
00:22:06,760 --> 00:22:08,830
run runs one of these Mozilla runs one

556
00:22:08,830 --> 00:22:11,740
of these I'll say hey I need a URL that

557
00:22:11,740 --> 00:22:14,529
I can give to a site to notify me that's

558
00:22:14,529 --> 00:22:17,230
number two you for service will generate

559
00:22:17,230 --> 00:22:20,080
a random URL set it back to the browser

560
00:22:20,080 --> 00:22:21,850
the browser will generate some

561
00:22:21,850 --> 00:22:23,919
cryptographic keys client-side and pass

562
00:22:23,919 --> 00:22:26,649
the URL and the crypto keys in step 4

563
00:22:26,649 --> 00:22:29,470
back to the website that's where this

564
00:22:29,470 --> 00:22:32,440
massive string comes from that's in the

565
00:22:32,440 --> 00:22:34,929
the subscription object then when the

566
00:22:34,929 --> 00:22:36,279
website wants to communicate with the

567
00:22:36,279 --> 00:22:38,049
browser does it through this push

568
00:22:38,049 --> 00:22:40,330
service so it sends a message to that

569
00:22:40,330 --> 00:22:41,980
service and that service access message

570
00:22:41,980 --> 00:22:44,260
queue because your laptop may be turned

571
00:22:44,260 --> 00:22:46,620
off your phone maybe an airplane mode

572
00:22:46,620 --> 00:22:49,210
you'll notice that i sent the header TTL

573
00:22:49,210 --> 00:22:50,770
60 this says that I want this to be

574
00:22:50,770 --> 00:22:52,570
queued for a maximum of 60 seconds

575
00:22:52,570 --> 00:22:54,549
before it expires so if user comes

576
00:22:54,549 --> 00:22:56,710
online in the next 60 seconds deliver

577
00:22:56,710 --> 00:23:01,419
the message otherwise drop it of course

578
00:23:01,419 --> 00:23:02,620
this is all open source you want to see

579
00:23:02,620 --> 00:23:04,029
how this works our implementation is out

580
00:23:04,029 --> 00:23:07,059
there the benefit to this architecture

581
00:23:07,059 --> 00:23:09,610
is it gives you a persistent location to

582
00:23:09,610 --> 00:23:11,169
queue messages compared to you trying to

583
00:23:11,169 --> 00:23:13,870
talk to the browser directly and it

584
00:23:13,870 --> 00:23:15,100
saves battery life because the browser

585
00:23:15,100 --> 00:23:17,590
can have a single WebSocket connected to

586
00:23:17,590 --> 00:23:19,210
this one service instead of an arbitrary

587
00:23:19,210 --> 00:23:20,890
number so for instance on Android

588
00:23:20,890 --> 00:23:22,419
Firefox for Android actually uses the

589
00:23:22,419 --> 00:23:24,429
push service will go and use Google

590
00:23:24,429 --> 00:23:26,140
Cloud messaging because an android phone

591
00:23:26,140 --> 00:23:28,149
will always have a connection to that

592
00:23:28,149 --> 00:23:31,470
service so we kind of proxy to that

593
00:23:31,470 --> 00:23:33,789
again everything in here is encrypted we

594
00:23:33,789 --> 00:23:35,679
don't want access we don't want to

595
00:23:35,679 --> 00:23:38,980
anything about what metadata or what

596
00:23:38,980 --> 00:23:40,870
messages you're sending we don't want

597
00:23:40,870 --> 00:23:42,100
have that responsibility we don't want

598
00:23:42,100 --> 00:23:44,740
to have that potential for privacy

599
00:23:44,740 --> 00:23:48,070
invasion so without any message body all

600
00:23:48,070 --> 00:23:49,779
this does is just wake up the push event

601
00:23:49,779 --> 00:23:52,419
and say hey I've got something if you

602
00:23:52,419 --> 00:23:53,679
want to send a message by you have to

603
00:23:53,679 --> 00:23:55,750
encrypt it to the keys that the browser

604
00:23:55,750 --> 00:23:58,360
passes to you at the same time it sends

605
00:23:58,360 --> 00:24:02,080
the URL if we take this example again we

606
00:24:02,080 --> 00:24:05,919
go back into about debugging so you can

607
00:24:05,919 --> 00:24:06,790
see that all the service work

608
00:24:06,790 --> 00:24:08,290
are asleep right now because they wake

609
00:24:08,290 --> 00:24:09,790
up they handle their event they go back

610
00:24:09,790 --> 00:24:11,230
to sleep that's all you had those event

611
00:24:11,230 --> 00:24:13,330
wait and tell and event respond with

612
00:24:13,330 --> 00:24:15,640
functions or methods they say like wait

613
00:24:15,640 --> 00:24:18,250
until this is done until you turn the

614
00:24:18,250 --> 00:24:19,620
service worker off like I'm not done yet

615
00:24:19,620 --> 00:24:24,820
so I start this up and I hit debug we

616
00:24:24,820 --> 00:24:26,590
see the push of nth listener show

617
00:24:26,590 --> 00:24:27,820
notification let's go ahead and set a

618
00:24:27,820 --> 00:24:34,280
breakpoint there I come over here thing

619
00:24:34,290 --> 00:24:37,080
whoops sorry that's a different instance

620
00:24:37,080 --> 00:24:39,070
alright so I got the break point there

621
00:24:39,070 --> 00:24:45,400
let's say I'm offline so normally if i

622
00:24:45,400 --> 00:24:46,870
want to receive these push events i

623
00:24:46,870 --> 00:24:48,220
would need to be connected to that

624
00:24:48,220 --> 00:24:49,630
service but now that i'm offline i don't

625
00:24:49,630 --> 00:24:52,390
have that connection inside about

626
00:24:52,390 --> 00:24:53,620
debugging I've got this push button

627
00:24:53,620 --> 00:24:55,150
which will actually synthesize a push

628
00:24:55,150 --> 00:25:01,180
event client side so I can hit this wow

629
00:25:01,180 --> 00:25:04,600
why isn't the debugger working so this

630
00:25:04,600 --> 00:25:05,740
is what happens when you run a nightly

631
00:25:05,740 --> 00:25:08,740
build this literally worked last week

632
00:25:08,740 --> 00:25:10,990
but we have been splitting Firefox into

633
00:25:10,990 --> 00:25:12,970
multiple processes and that sometimes

634
00:25:12,970 --> 00:25:16,840
causes issues I will file a bug about

635
00:25:16,840 --> 00:25:17,950
that once we're gone and I will tweet

636
00:25:17,950 --> 00:25:19,270
the link you can all follow it and be

637
00:25:19,270 --> 00:25:21,730
like this messed up dan on stage please

638
00:25:21,730 --> 00:25:28,720
fix faster yeah oh wait no I'm an idiot

639
00:25:28,720 --> 00:25:31,030
hang on check this out that's the

640
00:25:31,030 --> 00:25:32,080
breakpoint inside the body because the

641
00:25:32,080 --> 00:25:33,940
functions are even registered right or

642
00:25:33,940 --> 00:25:35,200
the listeners always been already been

643
00:25:35,200 --> 00:25:37,600
registered so if i run this now bing it

644
00:25:37,600 --> 00:25:40,780
works another thing that's messing up on

645
00:25:40,780 --> 00:25:42,310
stage is apple will turn on do not

646
00:25:42,310 --> 00:25:43,780
disturb mode when you connect to a

647
00:25:43,780 --> 00:25:45,220
projector so i've been sitting there

648
00:25:45,220 --> 00:25:46,870
like why aren't there any notifications

649
00:25:46,870 --> 00:25:48,040
and they're all just piling up in the

650
00:25:48,040 --> 00:25:50,740
background alright so we've got this

651
00:25:50,740 --> 00:25:54,100
event we look at it we can see it's a

652
00:25:54,100 --> 00:25:58,420
push on it we can pop this open you know

653
00:25:58,420 --> 00:26:00,070
see there's no data associate with it

654
00:26:00,070 --> 00:26:02,290
whatever it's a debugger you can step

655
00:26:02,290 --> 00:26:05,490
through it play with that on your own

656
00:26:05,490 --> 00:26:08,890
the last thing at manifests these are

657
00:26:08,890 --> 00:26:12,940
how we solve installation what do I mean

658
00:26:12,940 --> 00:26:15,690
by that

659
00:26:15,700 --> 00:26:18,080
when we think about apps native apps you

660
00:26:18,080 --> 00:26:19,340
can install them you can put them on

661
00:26:19,340 --> 00:26:20,480
your home screen you can rearrange them

662
00:26:20,480 --> 00:26:22,549
give them a place of prominence on your

663
00:26:22,549 --> 00:26:23,990
device if I'm going to be using the bus

664
00:26:23,990 --> 00:26:25,070
schedule a lot if I'm going to be using

665
00:26:25,070 --> 00:26:27,350
the weather website a lot I want to have

666
00:26:27,350 --> 00:26:30,799
one tap access to that the web has

667
00:26:30,799 --> 00:26:32,480
historically either you have bookmarks

668
00:26:32,480 --> 00:26:34,309
which like gets super ugly 16 by 16

669
00:26:34,309 --> 00:26:36,740
images scaled up to be the size of

670
00:26:36,740 --> 00:26:38,929
whatever the launcher needs to be or you

671
00:26:38,929 --> 00:26:40,429
have to go into your browser then into

672
00:26:40,429 --> 00:26:42,140
the bookmark menu then go past all the

673
00:26:42,140 --> 00:26:43,429
things you swear you were going to read

674
00:26:43,429 --> 00:26:45,470
later and dig out the the thing you

675
00:26:45,470 --> 00:26:47,419
wanted it'd be way nicer if we get add

676
00:26:47,419 --> 00:26:49,850
stuff to the home screen that's what

677
00:26:49,850 --> 00:26:51,679
manifests do you manifest act kind of

678
00:26:51,679 --> 00:26:54,200
like head tags they provide metadata but

679
00:26:54,200 --> 00:26:57,320
for multi-page contexts like web apps or

680
00:26:57,320 --> 00:27:00,049
larger sites this is the production

681
00:27:00,049 --> 00:27:02,120
manifester most of it for flipkart which

682
00:27:02,120 --> 00:27:05,779
is an indian e-commerce retailer in the

683
00:27:05,779 --> 00:27:06,950
head of their document they'll say link

684
00:27:06,950 --> 00:27:10,330
rel manifest and point to this JSON file

685
00:27:10,330 --> 00:27:13,399
then they can provide a name a short

686
00:27:13,399 --> 00:27:16,419
name icons with various sizes and types

687
00:27:16,419 --> 00:27:19,130
they can set the start URL to say the

688
00:27:19,130 --> 00:27:22,039
experience for the site begins on this

689
00:27:22,039 --> 00:27:24,320
page even if you're on some other page

690
00:27:24,320 --> 00:27:27,500
later and you want to to interact with

691
00:27:27,500 --> 00:27:29,210
this as an app it knows that that's the

692
00:27:29,210 --> 00:27:31,159
home that's the initial starting

693
00:27:31,159 --> 00:27:34,159
location you can launch our lock the

694
00:27:34,159 --> 00:27:35,480
orientation into a portrait so when you

695
00:27:35,480 --> 00:27:37,909
launch the app the phone turns the

696
00:27:37,909 --> 00:27:41,210
correct way you can set display to stand

697
00:27:41,210 --> 00:27:43,010
alone which hides the URL bar and makes

698
00:27:43,010 --> 00:27:45,640
it look more like a nap appy experience

699
00:27:45,640 --> 00:27:47,899
you can set a theme color background

700
00:27:47,899 --> 00:27:50,840
color this display stand alone thing is

701
00:27:50,840 --> 00:27:53,770
kind of interesting this is a video of

702
00:27:53,770 --> 00:27:56,390
adding flipkart like to an android home

703
00:27:56,390 --> 00:28:01,760
screen menu add to homescreen add if you

704
00:28:01,760 --> 00:28:03,529
go home you can see the icon pops up the

705
00:28:03,529 --> 00:28:04,940
name and icon are taken from the

706
00:28:04,940 --> 00:28:06,890
manifest it looks just like a native app

707
00:28:06,890 --> 00:28:08,870
when you tap it you get a launch screen

708
00:28:08,870 --> 00:28:12,140
just like a native app and there's no

709
00:28:12,140 --> 00:28:14,270
browser Chrome there's no URL bar no

710
00:28:14,270 --> 00:28:17,210
back forward button if you weren't a

711
00:28:17,210 --> 00:28:18,890
developer if you hadn't seen that

712
00:28:18,890 --> 00:28:21,080
initial step you would have no idea that

713
00:28:21,080 --> 00:28:25,070
this wasn't a native application in fact

714
00:28:25,070 --> 00:28:26,149
a very well could have been I in the

715
00:28:26,149 --> 00:28:27,320
same exact technologies you could be

716
00:28:27,320 --> 00:28:27,929
using corto

717
00:28:27,929 --> 00:28:29,220
or something and have built this already

718
00:28:29,220 --> 00:28:30,960
as a native app it's just now you can

719
00:28:30,960 --> 00:28:31,950
get there from the web instead of

720
00:28:31,950 --> 00:28:36,840
proprietary paths but that's also kind

721
00:28:36,840 --> 00:28:38,610
of weird because there's no URL bar and

722
00:28:38,610 --> 00:28:40,289
the web is the web and how do you get

723
00:28:40,289 --> 00:28:44,940
back to it the manifest spec is I think

724
00:28:44,940 --> 00:28:47,730
the weakest of this trio of service

725
00:28:47,730 --> 00:28:49,799
workers push and manifests because we

726
00:28:49,799 --> 00:28:51,360
don't know how to surface it we don't

727
00:28:51,360 --> 00:28:52,950
know how to tell users it like hey this

728
00:28:52,950 --> 00:28:55,350
app those website wants to act like an

729
00:28:55,350 --> 00:28:56,460
app it wants to be on your home screen

730
00:28:56,460 --> 00:28:58,950
it's capable of doing that it knows how

731
00:28:58,950 --> 00:29:01,080
to work offline and once you're in there

732
00:29:01,080 --> 00:29:02,879
we don't really know how to say actually

733
00:29:02,879 --> 00:29:04,200
if you want to send somebody link here's

734
00:29:04,200 --> 00:29:06,629
how you get the URL we've experiment

735
00:29:06,629 --> 00:29:08,039
with long pressing but that conflicts

736
00:29:08,039 --> 00:29:10,529
with other things opera has recently

737
00:29:10,529 --> 00:29:13,700
experimented with a rather interesting

738
00:29:13,700 --> 00:29:16,740
option so where you swipe down and then

739
00:29:16,740 --> 00:29:21,179
to the side and that pops from the app

740
00:29:21,179 --> 00:29:23,190
experience into the browser experience

741
00:29:23,190 --> 00:29:25,830
and then to get back they have this

742
00:29:25,830 --> 00:29:30,590
little mobile phone badge by the URL bar

743
00:29:30,590 --> 00:29:32,730
and soul I don't know clearly there's a

744
00:29:32,730 --> 00:29:33,899
need for this sort of stuff there's a

745
00:29:33,899 --> 00:29:36,450
need to be able to say here's my site's

746
00:29:36,450 --> 00:29:38,070
name here's where it starts it really

747
00:29:38,070 --> 00:29:39,570
only works in portrait mode though if

748
00:29:39,570 --> 00:29:42,029
you're doing that you're maybe haven't

749
00:29:42,029 --> 00:29:43,230
learned the lesson that the web can show

750
00:29:43,230 --> 00:29:46,860
up on a fridge but I don't know about

751
00:29:46,860 --> 00:29:48,240
this whole display stand alone thing

752
00:29:48,240 --> 00:29:51,059
because is the web without URLs still

753
00:29:51,059 --> 00:29:55,619
the web at all if you can't cut and

754
00:29:55,619 --> 00:29:57,869
paste if you can't edit a URL like what

755
00:29:57,869 --> 00:30:00,720
what is that so I don't know but we need

756
00:30:00,720 --> 00:30:02,009
the rest of the metadata and we'll

757
00:30:02,009 --> 00:30:03,539
figure it out this is somewhere that you

758
00:30:03,539 --> 00:30:05,519
as developers by adopting this by

759
00:30:05,519 --> 00:30:06,929
experiment with this can actually

760
00:30:06,929 --> 00:30:08,669
provide a lot of meaningful input and

761
00:30:08,669 --> 00:30:10,889
shape the direction of the web in the

762
00:30:10,889 --> 00:30:14,399
the links on the slides repo and github

763
00:30:14,399 --> 00:30:16,379
there's a link to the Firefox bug we've

764
00:30:16,379 --> 00:30:18,899
just now started preparing to implement

765
00:30:18,899 --> 00:30:20,490
display stand alone in Firefox for

766
00:30:20,490 --> 00:30:23,700
Android there are a lot of open

767
00:30:23,700 --> 00:30:24,779
questions you can come in you can

768
00:30:24,779 --> 00:30:25,649
actually say well I've been thinking

769
00:30:25,649 --> 00:30:27,629
about this of experiment with this this

770
00:30:27,629 --> 00:30:30,200
doesn't work well this does work well so

771
00:30:30,200 --> 00:30:32,309
it's something that we have to we have

772
00:30:32,309 --> 00:30:33,860
to learn how to get there together

773
00:30:33,860 --> 00:30:36,240
something that that's been very humbling

774
00:30:36,240 --> 00:30:39,090
as a as a browser manufacturers we're

775
00:30:39,090 --> 00:30:40,289
finally starting to realize that we

776
00:30:40,289 --> 00:30:41,130
don't know how

777
00:30:41,130 --> 00:30:44,310
to build websites we know how to build

778
00:30:44,310 --> 00:30:47,490
web browsers but like those are big C++

779
00:30:47,490 --> 00:30:49,230
code bases that are compiled and shipped

780
00:30:49,230 --> 00:30:51,810
over the wire every couple of weeks or

781
00:30:51,810 --> 00:30:53,450
every couple days for for hot patches

782
00:30:53,450 --> 00:30:57,690
that don't resemble the web at all we've

783
00:30:57,690 --> 00:30:58,890
had experiments like app cache that

784
00:30:58,890 --> 00:31:00,720
totally failed app cache work great if

785
00:31:00,720 --> 00:31:03,000
you were used it exactly how we wanted

786
00:31:03,000 --> 00:31:04,800
you to use it to make the web work

787
00:31:04,800 --> 00:31:06,420
offline but if you want to do something

788
00:31:06,420 --> 00:31:09,480
fancy like that patching the response in

789
00:31:09,480 --> 00:31:11,880
flight or if you want to say I want

790
00:31:11,880 --> 00:31:14,490
specifically these things cached as a

791
00:31:14,490 --> 00:31:17,610
fallback not as the primary resource we

792
00:31:17,610 --> 00:31:19,230
didn't have have the tools for that so

793
00:31:19,230 --> 00:31:20,880
the the browser manufacturers have

794
00:31:20,880 --> 00:31:21,990
started trying to say all right let's

795
00:31:21,990 --> 00:31:23,580
give the developers let's give you all

796
00:31:23,580 --> 00:31:26,970
in this room and a set of tools a tool

797
00:31:26,970 --> 00:31:28,650
box instead of a specific tool will give

798
00:31:28,650 --> 00:31:30,180
you a tool box and we'll see what you do

799
00:31:30,180 --> 00:31:31,860
and we'll try to learn from that it's

800
00:31:31,860 --> 00:31:33,780
the same way that jQuery influenced the

801
00:31:33,780 --> 00:31:36,780
document query selector method there was

802
00:31:36,780 --> 00:31:38,850
a time when jquery and prototype and

803
00:31:38,850 --> 00:31:40,680
moved to mootools and all these other

804
00:31:40,680 --> 00:31:42,420
libraries competed on how fast they

805
00:31:42,420 --> 00:31:44,880
could parse CSS selectors to find Dom

806
00:31:44,880 --> 00:31:47,040
nodes because before those libraries the

807
00:31:47,040 --> 00:31:48,600
way you selected Dom nodes was using an

808
00:31:48,600 --> 00:31:51,870
xml query language called xpath because

809
00:31:51,870 --> 00:31:53,460
browser manufacturers don't know how to

810
00:31:53,460 --> 00:31:56,100
make websites but we can learn and when

811
00:31:56,100 --> 00:31:57,510
we see these emergent properties and we

812
00:31:57,510 --> 00:32:00,560
see people build things that make sense

813
00:32:00,560 --> 00:32:02,760
then we can codify it so that's kind of

814
00:32:02,760 --> 00:32:03,480
where we're starting with service

815
00:32:03,480 --> 00:32:05,250
workers here's a bunch of tools or

816
00:32:05,250 --> 00:32:06,990
toolbox we'll see what tools come out of

817
00:32:06,990 --> 00:32:10,410
that the important things that we try to

818
00:32:10,410 --> 00:32:13,890
work with the web I've seen people light

819
00:32:13,890 --> 00:32:15,180
up at the suggestion they can hide the

820
00:32:15,180 --> 00:32:17,370
URL bar like oh that's wonderful i can

821
00:32:17,370 --> 00:32:19,620
finally disguise the fact that i'm using

822
00:32:19,620 --> 00:32:21,240
the web I don't have to be a shame that

823
00:32:21,240 --> 00:32:24,270
i'm using the web anymore and i think

824
00:32:24,270 --> 00:32:26,400
that's that's not going to work

825
00:32:26,400 --> 00:32:29,340
long-term the web has a lot of a lot of

826
00:32:29,340 --> 00:32:31,800
quirks but when we work with them we get

827
00:32:31,800 --> 00:32:33,480
to a better place so think about these

828
00:32:33,480 --> 00:32:34,560
tools those things that you can use to

829
00:32:34,560 --> 00:32:36,750
enhance your experience not replace the

830
00:32:36,750 --> 00:32:40,140
web's experience i'm going to be around

831
00:32:40,140 --> 00:32:42,570
all all day all day tomorrow please come

832
00:32:42,570 --> 00:32:44,550
ask me more questions like I said the

833
00:32:44,550 --> 00:32:46,050
the slides are online i tweeted the link

834
00:32:46,050 --> 00:32:48,480
we also have two other m'zullians here

835
00:32:48,480 --> 00:32:50,940
sitting in the back floki and ender who

836
00:32:50,940 --> 00:32:52,980
will be doing a free workshop on these

837
00:32:52,980 --> 00:32:54,570
technologies on monday

838
00:32:54,570 --> 00:32:56,759
meetup.com / javascript iceland the

839
00:32:56,759 --> 00:32:58,980
registration will open tomorrow just

840
00:32:58,980 --> 00:33:02,159
after noon and kudos to these folks who

841
00:33:02,159 --> 00:33:03,990
shared photos of the fridge in the pizza

842
00:33:03,990 --> 00:33:06,450
so thank you so much I have stickers up

