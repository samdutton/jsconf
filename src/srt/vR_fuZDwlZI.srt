1
00:00:21,630 --> 00:00:25,160

you

2
00:00:25,170 --> 00:00:27,330
so again my name is Christopher I work

3
00:00:27,330 --> 00:00:29,760
for ThoughtWorks I do a lot of stuff

4
00:00:29,760 --> 00:00:34,830
also fronted stuff besides from from

5
00:00:34,830 --> 00:00:36,960
hacking and I like hacking I like

6
00:00:36,960 --> 00:00:40,260
building stuff I like languages but

7
00:00:40,260 --> 00:00:42,480
today I like to talk about something

8
00:00:42,480 --> 00:00:44,100
that has been interesting me for the

9
00:00:44,100 --> 00:00:48,830
last year I call it a panoramic tour

10
00:00:48,830 --> 00:00:51,710
through html5 rendering itself today and

11
00:00:51,710 --> 00:00:54,780
it seems that engineering carefully

12
00:00:54,780 --> 00:00:56,280
engineering the title kind of helped

13
00:00:56,280 --> 00:00:58,650
because a lot of guys here today that's

14
00:00:58,650 --> 00:00:59,990
good

15
00:00:59,990 --> 00:01:02,940
but what is this about today what do I

16
00:01:02,940 --> 00:01:07,200
want to talk about so in the next three

17
00:01:07,200 --> 00:01:10,110
minutes I'd like to misuse a few browser

18
00:01:10,110 --> 00:01:14,700
features some of those new I and that so

19
00:01:14,700 --> 00:01:16,649
to make it fit in J's Kampf we use a lot

20
00:01:16,649 --> 00:01:19,110
of JavaScript to play around with SVG

21
00:01:19,110 --> 00:01:22,590
HTML CSS DOM and not sure if you heard

22
00:01:22,590 --> 00:01:25,380
from that before the CSS object model

23
00:01:25,380 --> 00:01:30,120
I do claim that we go boldly go where no

24
00:01:30,120 --> 00:01:31,710
man or woman has gone before

25
00:01:31,710 --> 00:01:35,370
let's see if I can hold up to this and I

26
00:01:35,370 --> 00:01:36,590
hope that we have some fun on the way

27
00:01:36,590 --> 00:01:40,680
because it's not as much about the young

28
00:01:40,680 --> 00:01:42,600
product it's more about the way to how

29
00:01:42,600 --> 00:01:45,000
to get there because I think I had some

30
00:01:45,000 --> 00:01:46,380
fun on the way and I hope you guys have

31
00:01:46,380 --> 00:01:49,680
some fun going through with that there's

32
00:01:49,680 --> 00:01:51,090
special welcome to the chrome devs

33
00:01:51,090 --> 00:01:53,840
today I have a few treats for you guys

34
00:01:53,840 --> 00:01:56,580
there are three bugs I'd like to fix in

35
00:01:56,580 --> 00:01:58,409
the next few weeks maybe they're not

36
00:01:58,409 --> 00:02:00,479
bugs so I have to be careful but I

37
00:02:00,479 --> 00:02:02,450
already talked to my quest yesterday and

38
00:02:02,450 --> 00:02:04,950
it seems like we can tackle a few of

39
00:02:04,950 --> 00:02:06,390
those things today I mean you think

40
00:02:06,390 --> 00:02:08,580
Firefox because Firefox is most helpful

41
00:02:08,580 --> 00:02:11,760
in the stuff that we'd be doing today

42
00:02:11,760 --> 00:02:16,040
come chrome does a good job too so

43
00:02:16,040 --> 00:02:18,510
specifically what we're going to do

44
00:02:18,510 --> 00:02:22,560
today is we'll be trying to trigger the

45
00:02:22,560 --> 00:02:24,870
HTML rendering capabilities that the

46
00:02:24,870 --> 00:02:26,850
browser exposes well it doesn't expose

47
00:02:26,850 --> 00:02:28,110
it actually the browser is a huge

48
00:02:28,110 --> 00:02:29,850
external renderer but normally I'm not

49
00:02:29,850 --> 00:02:32,370
allowed to call it from JavaScript

50
00:02:32,370 --> 00:02:35,819
I'm trying to work around the the ways

51
00:02:35,819 --> 00:02:38,110
and try to

52
00:02:38,110 --> 00:02:40,000
make the browser give me a screenshot of

53
00:02:40,000 --> 00:02:44,380
random webpages or random HTML um we're

54
00:02:44,380 --> 00:02:46,000
going to render HTML to a canvas it

55
00:02:46,000 --> 00:02:49,060
sounds a bit boring but let's see in

56
00:02:49,060 --> 00:02:50,380
other words and that's what I learned

57
00:02:50,380 --> 00:02:52,020
yesterday from Dominic's talk

58
00:02:52,020 --> 00:02:54,970
we're building a prolly fill if you guys

59
00:02:54,970 --> 00:02:58,480
didn't join this awesome talk polyfill

60
00:02:58,480 --> 00:02:59,680
and I'm trying to explain that my words

61
00:02:59,680 --> 00:03:00,940
it might be wrong Dom making correct me

62
00:03:00,940 --> 00:03:03,070
but if you guys know a polyfill the

63
00:03:03,070 --> 00:03:06,190
polyfill tries to make a browser follow

64
00:03:06,190 --> 00:03:07,330
a standard the browser hasn't

65
00:03:07,330 --> 00:03:08,650
implemented that yet you're going to

66
00:03:08,650 --> 00:03:10,030
write a polyfill to make it work a

67
00:03:10,030 --> 00:03:13,180
polyfill is not filling a gap without a

68
00:03:13,180 --> 00:03:14,470
standard created there is no standard

69
00:03:14,470 --> 00:03:16,570
for this it probably will get a standard

70
00:03:16,570 --> 00:03:20,770
if you guys think it's useful so if that

71
00:03:20,770 --> 00:03:21,160
makes sense

72
00:03:21,160 --> 00:03:25,600
um so we're going to add new

73
00:03:25,600 --> 00:03:28,300
capabilities to the canvas which is

74
00:03:28,300 --> 00:03:31,270
basically just Troy's email that just

75
00:03:31,270 --> 00:03:34,690
that Tony method method is what we will

76
00:03:34,690 --> 00:03:36,820
be talking today it sounds easy

77
00:03:36,820 --> 00:03:40,750
and it actually is maybe here's a quick

78
00:03:40,750 --> 00:03:44,410
solution that is code that only works in

79
00:03:44,410 --> 00:03:45,459
Firefox

80
00:03:45,459 --> 00:03:47,230
I certainly only works in the chrome

81
00:03:47,230 --> 00:03:49,720
mode of Firefox I'm posing a bit right

82
00:03:49,720 --> 00:03:51,040
now because I actually don't know what

83
00:03:51,040 --> 00:03:53,290
that exactly means I know that Firefox

84
00:03:53,290 --> 00:03:55,180
is underneath written in a lot of

85
00:03:55,180 --> 00:03:57,209
JavaScript I just don't know how to

86
00:03:57,209 --> 00:03:59,290
trigger that code um because I'm not

87
00:03:59,290 --> 00:04:00,910
really into that space but I know that

88
00:04:00,910 --> 00:04:03,519
that works yeah so what we do what it

89
00:04:03,519 --> 00:04:06,459
does is it gets a canvas and in the end

90
00:04:06,459 --> 00:04:09,730
it draws a tab the content of a tab to

91
00:04:09,730 --> 00:04:12,940
that canvas not sure where the chrome

92
00:04:12,940 --> 00:04:14,440
has something like that I know that if

93
00:04:14,440 --> 00:04:16,419
that Safari for example and chrome do

94
00:04:16,419 --> 00:04:17,590
show you screenshots I guess that must

95
00:04:17,590 --> 00:04:19,060
be implemented somehow possibly in

96
00:04:19,060 --> 00:04:20,979
JavaScript but that's how Firefox does

97
00:04:20,979 --> 00:04:25,030
that so that sounds pretty easy um but

98
00:04:25,030 --> 00:04:28,630
as I kind of indicated it does not work

99
00:04:28,630 --> 00:04:31,120
in a normal web page but that's what my

100
00:04:31,120 --> 00:04:33,910
goal is I like to call this from any

101
00:04:33,910 --> 00:04:37,780
random web page why is it not why is not

102
00:04:37,780 --> 00:04:39,310
available in the web page all there's

103
00:04:39,310 --> 00:04:41,530
security concerns and there are have

104
00:04:41,530 --> 00:04:43,390
been awesome talks today yesterday also

105
00:04:43,390 --> 00:04:46,330
from my quest about why you want to

106
00:04:46,330 --> 00:04:49,150
limit what your websites or your

107
00:04:49,150 --> 00:04:51,159
javascript is allowed to do

108
00:04:51,159 --> 00:04:54,369
if your JavaScript would be allowed to

109
00:04:54,369 --> 00:04:56,739
render random web content from random

110
00:04:56,739 --> 00:04:59,589
sources to a canvas it would allow you

111
00:04:59,589 --> 00:05:02,110
to inspect this and do something with

112
00:05:02,110 --> 00:05:06,669
that so sadly um it does there's no easy

113
00:05:06,669 --> 00:05:10,089
way to make it work so I like to ignore

114
00:05:10,089 --> 00:05:12,159
any concerns that any content security

115
00:05:12,159 --> 00:05:16,479
policy or same-origin policy has unlike

116
00:05:16,479 --> 00:05:17,919
to work around it let's see if we can do

117
00:05:17,919 --> 00:05:21,069
that so you guys I guess are all huge

118
00:05:21,069 --> 00:05:24,490
fans of SVG and SVG unknown to me maybe

119
00:05:24,490 --> 00:05:26,800
unknown to you has a foreign object a

120
00:05:26,800 --> 00:05:29,679
tag the foreign object lets you allow to

121
00:05:29,679 --> 00:05:33,580
embed any kind of HTML it actually

122
00:05:33,580 --> 00:05:35,559
allows you to embed without HTML code

123
00:05:35,559 --> 00:05:37,719
but you have to convert it to XHTML this

124
00:05:37,719 --> 00:05:40,719
is a valid SVG and that is basically an

125
00:05:40,719 --> 00:05:44,649
image that just shows HTML so maybe you

126
00:05:44,649 --> 00:05:46,869
see where I'm getting here I'm I'm

127
00:05:46,869 --> 00:05:49,059
allowed to draw images to to the canvas

128
00:05:49,059 --> 00:05:51,519
now I have an image basically which

129
00:05:51,519 --> 00:05:53,589
includes HTML so let's see if we can

130
00:05:53,589 --> 00:05:54,809
build on that

131
00:05:54,809 --> 00:06:00,129
so one short step as I said XHTML I

132
00:06:00,129 --> 00:06:02,589
can't form and them HTML added I must

133
00:06:02,589 --> 00:06:07,919
converted I need to provide XHTML and

134
00:06:07,919 --> 00:06:09,909
Firefox but looking at the chrome

135
00:06:09,909 --> 00:06:13,059
developers makes it very easy here there

136
00:06:13,059 --> 00:06:14,499
is an XML serialize

137
00:06:14,499 --> 00:06:17,079
you just ignore the basic code just the

138
00:06:17,079 --> 00:06:19,749
XML civilizer that helps you to convert

139
00:06:19,749 --> 00:06:23,949
any random document into XHTML now in

140
00:06:23,949 --> 00:06:25,899
Chrome and Safari that does not work and

141
00:06:25,899 --> 00:06:28,300
the guys have a point they say the

142
00:06:28,300 --> 00:06:31,329
standard does not require XML serialize

143
00:06:31,329 --> 00:06:35,619
transform an HTML document into HTML so

144
00:06:35,619 --> 00:06:37,209
they have a different behavior there

145
00:06:37,209 --> 00:06:38,949
it's actually Firefox that's doing

146
00:06:38,949 --> 00:06:40,509
something that that's understand it

147
00:06:40,509 --> 00:06:44,740
doesn't ask for so let's assume we have

148
00:06:44,740 --> 00:06:46,689
a way of converting that if we if we're

149
00:06:46,689 --> 00:06:48,249
going to implement that from today in

150
00:06:48,249 --> 00:06:49,629
chrome in Safari

151
00:06:49,629 --> 00:06:52,899
we need to have our own substitution for

152
00:06:52,899 --> 00:06:55,539
that and I'm I'm really looking into a

153
00:06:55,539 --> 00:06:58,119
lot of HTML parsers right lately I've

154
00:06:58,119 --> 00:07:00,469
been looking for

155
00:07:00,469 --> 00:07:03,770
for a year I might have found something

156
00:07:03,770 --> 00:07:06,409
this afternoon but there's no good if

157
00:07:06,409 --> 00:07:09,020
there's no good HTML to HTML converter

158
00:07:09,020 --> 00:07:10,639
out there in pure JavaScript that works

159
00:07:10,639 --> 00:07:12,199
in the browser so if you guys know of

160
00:07:12,199 --> 00:07:13,639
something like that just come up to me

161
00:07:13,639 --> 00:07:17,469
please so considering that we have that

162
00:07:17,469 --> 00:07:19,490
what can we do with that right now

163
00:07:19,490 --> 00:07:23,209
so in the future with pelops

164
00:07:23,209 --> 00:07:26,629
we can basically just throw our SVG into

165
00:07:26,629 --> 00:07:28,999
a blob and created object URL from that

166
00:07:28,999 --> 00:07:32,360
this object URL is something we can just

167
00:07:32,360 --> 00:07:34,369
pipe into an image and that image could

168
00:07:34,369 --> 00:07:36,559
go into the canvas and we're done it's

169
00:07:36,559 --> 00:07:38,479
not that easy because Safari isn't that

170
00:07:38,479 --> 00:07:40,339
far at least it hasn't been that far a

171
00:07:40,339 --> 00:07:43,159
month ago or something so we need to

172
00:07:43,159 --> 00:07:45,259
fall back to data URIs your eyes I guess

173
00:07:45,259 --> 00:07:47,689
you know that these I think were kind of

174
00:07:47,689 --> 00:07:50,149
designed for adding small image content

175
00:07:50,149 --> 00:07:53,240
to make your life easy to maybe improve

176
00:07:53,240 --> 00:07:54,969
the bandwidth problems

177
00:07:54,969 --> 00:07:58,909
improve upon of problems and what we can

178
00:07:58,909 --> 00:08:00,349
do is basically if you have an SVG

179
00:08:00,349 --> 00:08:04,219
that's what we started we can create an

180
00:08:04,219 --> 00:08:07,129
image with Apps basic scheme here just

181
00:08:07,129 --> 00:08:09,050
add a data image with the type SVG XML

182
00:08:09,050 --> 00:08:12,019
trial said we'd have ade and then so the

183
00:08:12,019 --> 00:08:16,399
SVG inside so what does that mean we can

184
00:08:16,399 --> 00:08:18,919
now bring this together and remember

185
00:08:18,919 --> 00:08:21,379
what our task was our task was render

186
00:08:21,379 --> 00:08:24,289
HTML into the canvas so what we can do

187
00:08:24,289 --> 00:08:26,869
is create a new image throw in the SVG

188
00:08:26,869 --> 00:08:28,969
content and then get the canvas into all

189
00:08:28,969 --> 00:08:32,149
the image and that is pretty easy pretty

190
00:08:32,149 --> 00:08:35,630
simple code and I like to say

191
00:08:35,630 --> 00:08:38,419
congratulations it looks like we're done

192
00:08:38,419 --> 00:08:43,130
what we did is Emma did HTML beforehand

193
00:08:43,130 --> 00:08:44,899
converting that to XHTML using for an

194
00:08:44,899 --> 00:08:48,410
object into an SVG then we converted

195
00:08:48,410 --> 00:08:50,860
that into a data URI got an image and

196
00:08:50,860 --> 00:08:54,290
use the canvas dot get context draw

197
00:08:54,290 --> 00:08:59,810
image and that's good so yeah not right

198
00:08:59,810 --> 00:09:01,630
we have a few minutes left right so

199
00:09:01,630 --> 00:09:06,529
there's more things to cover SVG is not

200
00:09:06,529 --> 00:09:08,750
allowed to include any external

201
00:09:08,750 --> 00:09:11,420
resources so I didn't know that

202
00:09:11,420 --> 00:09:12,860
beforehand but if you

203
00:09:12,860 --> 00:09:14,420
going to include refugee in your web

204
00:09:14,420 --> 00:09:17,450
pages your SVG's are not allowed to link

205
00:09:17,450 --> 00:09:19,700
to external resources that again is as

206
00:09:19,700 --> 00:09:21,170
far as I understand for security reasons

207
00:09:21,170 --> 00:09:24,200
so that is bad though because our

208
00:09:24,200 --> 00:09:27,230
problem is HTML we want to render HTML

209
00:09:27,230 --> 00:09:30,110
HTML allows for a lot of external

210
00:09:30,110 --> 00:09:32,210
resources and I'm not sure I think I

211
00:09:32,210 --> 00:09:34,190
covered all of them you have images you

212
00:09:34,190 --> 00:09:36,440
have much of you knew about input

213
00:09:36,440 --> 00:09:38,870
elements of type image you have style

214
00:09:38,870 --> 00:09:41,990
sheets you have inside style sheets

215
00:09:41,990 --> 00:09:45,440
background images you have staunchly CSS

216
00:09:45,440 --> 00:09:48,230
may import other CSS style sheets you

217
00:09:48,230 --> 00:09:51,040
have fonts and all of those things

218
00:09:51,040 --> 00:09:53,360
linked to external resources and

219
00:09:53,360 --> 00:09:55,250
although it's I'd like to render to the

220
00:09:55,250 --> 00:09:58,820
canvas too so here's a kind of nifty

221
00:09:58,820 --> 00:10:00,590
idea we could try to embed those

222
00:10:00,590 --> 00:10:03,200
resources into the SVG SVG could take

223
00:10:03,200 --> 00:10:08,540
data your eyes inside to write so how do

224
00:10:08,540 --> 00:10:10,700
you find those external elements my girl

225
00:10:10,700 --> 00:10:13,940
still is find a generic way of piping

226
00:10:13,940 --> 00:10:16,550
HTML into the canvas so let's find out

227
00:10:16,550 --> 00:10:18,710
how to make it solution to get that done

228
00:10:18,710 --> 00:10:21,830
so that looks like pre a simple code I

229
00:10:21,830 --> 00:10:24,320
think you create an empty document you

230
00:10:24,320 --> 00:10:26,360
pipe your HTML into that document and

231
00:10:26,360 --> 00:10:28,160
then you just get elements by tag name I

232
00:10:28,160 --> 00:10:30,320
don't even need to carry all I can do is

233
00:10:30,320 --> 00:10:32,660
just get all the images out and I can

234
00:10:32,660 --> 00:10:36,410
just iterate over those images and do

235
00:10:36,410 --> 00:10:38,480
something with that all right now I know

236
00:10:38,480 --> 00:10:40,670
I know have all my images that might

237
00:10:40,670 --> 00:10:44,200
email references what do I need to do

238
00:10:44,200 --> 00:10:46,940
that's how my image looks like it's an

239
00:10:46,940 --> 00:10:49,220
external image and I like to embed that

240
00:10:49,220 --> 00:10:52,490
well we talked about data URIs before so

241
00:10:52,490 --> 00:10:54,710
what I can do is just basically get that

242
00:10:54,710 --> 00:10:56,630
image image to get the content and stuff

243
00:10:56,630 --> 00:10:59,630
it into as a data URI into the source

244
00:10:59,630 --> 00:11:01,610
and I'm done and how can we do that we

245
00:11:01,610 --> 00:11:04,700
just use our plain simple Ajax I load

246
00:11:04,700 --> 00:11:08,300
the content by our Ajax and that's how I

247
00:11:08,300 --> 00:11:09,980
construct it I add that data URI

248
00:11:09,980 --> 00:11:14,690
I'll encode that to base64 via B to a

249
00:11:14,690 --> 00:11:20,180
function and I might be done well first

250
00:11:20,180 --> 00:11:20,780
things first

251
00:11:20,780 --> 00:11:23,390
Ajax you know needs to follow same

252
00:11:23,390 --> 00:11:26,720
origin policy so this will not allow

253
00:11:26,720 --> 00:11:28,550
me to load random webpages it only

254
00:11:28,550 --> 00:11:30,350
allows to me to load stuff that I'm

255
00:11:30,350 --> 00:11:32,000
allowed to see

256
00:11:32,000 --> 00:11:37,480
so just need to mention that secondly

257
00:11:37,480 --> 00:11:41,300
loading binary images through Ajax is

258
00:11:41,300 --> 00:11:43,490
crazy that's not what Ajax was designed

259
00:11:43,490 --> 00:11:46,250
to be Ajax was designed well the name

260
00:11:46,250 --> 00:11:49,490
says XML all right it's used to XML and

261
00:11:49,490 --> 00:11:54,829
and Jason you allow it to load text not

262
00:11:54,829 --> 00:11:59,209
binary data so xhr to XML HTTP because -

263
00:11:59,209 --> 00:12:03,079
now has capabilities for loading binary

264
00:12:03,079 --> 00:12:06,019
data which gives you back a blob again

265
00:12:06,019 --> 00:12:08,300
Safari is not playing along well here so

266
00:12:08,300 --> 00:12:12,290
what we're doing we need to find a

267
00:12:12,290 --> 00:12:14,600
workaround and that's what I've been

268
00:12:14,600 --> 00:12:16,009
doing the whole time are just being

269
00:12:16,009 --> 00:12:18,230
throwing things into Google and quite

270
00:12:18,230 --> 00:12:20,209
often land on Stack Overflow and find a

271
00:12:20,209 --> 00:12:22,310
solution for my problem I had so that's

272
00:12:22,310 --> 00:12:23,600
something you can find on Stack Overflow

273
00:12:23,600 --> 00:12:25,550
with a big sign saying don't do that

274
00:12:25,550 --> 00:12:28,430
that's ugly it's bad but it seems to

275
00:12:28,430 --> 00:12:31,160
work in all those browsers so the is you

276
00:12:31,160 --> 00:12:35,269
know screw screw a XHTML HTTP request -

277
00:12:35,269 --> 00:12:37,399
and screw blobs I can do that with all

278
00:12:37,399 --> 00:12:39,769
browsers and I'm happy it's pretty slow

279
00:12:39,769 --> 00:12:41,300
though if you load like megabytes of

280
00:12:41,300 --> 00:12:43,220
data and you iterate through all the the

281
00:12:43,220 --> 00:12:44,509
code points so what it actually does the

282
00:12:44,509 --> 00:12:48,019
code I mean you can you you can read but

283
00:12:48,019 --> 00:12:51,980
it basically just converts it from a to

284
00:12:51,980 --> 00:12:55,149
cope point and throws away all the other

285
00:12:55,149 --> 00:12:58,459
bits and just converts it back ugly but

286
00:12:58,459 --> 00:13:02,449
it works so we good I'm setting the

287
00:13:02,449 --> 00:13:04,579
second point now we I kind of describe

288
00:13:04,579 --> 00:13:06,620
how to inline images what about

289
00:13:06,620 --> 00:13:08,509
background images it seems a bit similar

290
00:13:08,509 --> 00:13:11,209
they are images too but the problem here

291
00:13:11,209 --> 00:13:14,149
is background images are referenced in

292
00:13:14,149 --> 00:13:16,759
CSS how do I find my background images I

293
00:13:16,759 --> 00:13:20,300
need to dig into CSS now that basically

294
00:13:20,300 --> 00:13:24,139
requires me pausing CSS to find which we

295
00:13:24,139 --> 00:13:27,050
source resources on you to inline so we

296
00:13:27,050 --> 00:13:28,639
need to build something like this

297
00:13:28,639 --> 00:13:30,559
function pass CSS and if I throw in a

298
00:13:30,559 --> 00:13:31,850
span that has a background image I need

299
00:13:31,850 --> 00:13:34,850
to find this external image PNG so let's

300
00:13:34,850 --> 00:13:39,230
write CSS puzzle

301
00:13:39,240 --> 00:13:40,980
you see we're getting a it's getting a

302
00:13:40,980 --> 00:13:43,590
bit complicated to be fed though we're

303
00:13:43,590 --> 00:13:45,840
done pretty quickly that is slide that

304
00:13:45,840 --> 00:13:49,230
describes a CSS parser well we can just

305
00:13:49,230 --> 00:13:51,510
use the CSS parser or from the browser I

306
00:13:51,510 --> 00:13:54,810
didn't know that I've been using a pure

307
00:13:54,810 --> 00:13:56,640
JavaScript solution for a long time

308
00:13:56,640 --> 00:13:58,650
until I realized that the CSS only

309
00:13:58,650 --> 00:13:59,430
existed

310
00:13:59,430 --> 00:14:02,040
it's the CSS object model the browser

311
00:14:02,040 --> 00:14:06,080
allows you to basically access its Pazza

312
00:14:06,080 --> 00:14:09,270
so that's a nifty code that just does it

313
00:14:09,270 --> 00:14:11,760
what it does is you create a style

314
00:14:11,760 --> 00:14:15,000
element you pub your CSS content to that

315
00:14:15,000 --> 00:14:17,520
style element and then you need to do

316
00:14:17,520 --> 00:14:20,730
one very important step the browser only

317
00:14:20,730 --> 00:14:23,100
starts to evaluate that that CSS if it

318
00:14:23,100 --> 00:14:24,840
actually needs to do so so you need to

319
00:14:24,840 --> 00:14:27,150
create a fake document at that style

320
00:14:27,150 --> 00:14:28,980
element to that document and then the

321
00:14:28,980 --> 00:14:33,000
browser starts to pass that CSS and then

322
00:14:33,000 --> 00:14:35,250
you're done the style element sheet dot

323
00:14:35,250 --> 00:14:38,250
CSS rules lists you gives you a list or

324
00:14:38,250 --> 00:14:41,130
kind kind of lists lists like element to

325
00:14:41,130 --> 00:14:45,120
access all your CSS rules that is and

326
00:14:45,120 --> 00:14:46,680
when I found this piece of code I

327
00:14:46,680 --> 00:14:48,000
thought that's so awesome I didn't know

328
00:14:48,000 --> 00:14:52,560
that existed this is basically the

329
00:14:52,560 --> 00:14:55,950
browser doing CSS pausing to be fair

330
00:14:55,950 --> 00:14:58,380
it's really an air ugly API to be fair

331
00:14:58,380 --> 00:15:00,660
if I just if I envisioned how I would do

332
00:15:00,660 --> 00:15:02,460
that in in nodejs or any other

333
00:15:02,460 --> 00:15:04,530
programming language I would require the

334
00:15:04,530 --> 00:15:06,450
CSS parser and tell the CSS positive

335
00:15:06,450 --> 00:15:08,400
I'll write my code it turns out that

336
00:15:08,400 --> 00:15:10,980
Angele in in the browser Dom you always

337
00:15:10,980 --> 00:15:13,890
tend to kind of access some weird API to

338
00:15:13,890 --> 00:15:16,320
get some stuff done to be fair I think

339
00:15:16,320 --> 00:15:19,920
nobody actually designed actually

340
00:15:19,920 --> 00:15:21,690
designed that for that use case I don't

341
00:15:21,690 --> 00:15:23,940
think anybody wanted the user or the

342
00:15:23,940 --> 00:15:26,070
JavaScript rip our CSS well I need that

343
00:15:26,070 --> 00:15:29,160
so here I am I want to get that stuff

344
00:15:29,160 --> 00:15:35,010
done so can we put this together we now

345
00:15:35,010 --> 00:15:37,500
can pass our rules we get a list we get

346
00:15:37,500 --> 00:15:40,260
a list of rules and I mean we can

347
00:15:40,260 --> 00:15:41,910
iterate over those rules just like we

348
00:15:41,910 --> 00:15:43,950
did with the images before we go through

349
00:15:43,950 --> 00:15:45,690
all the rules check if it has a

350
00:15:45,690 --> 00:15:49,430
background image and if it does call our

351
00:15:49,430 --> 00:15:52,480
virtual method do inline image URL

352
00:15:52,480 --> 00:15:54,670
this method is something we already did

353
00:15:54,670 --> 00:15:56,290
for the image we can do the same stuff

354
00:15:56,290 --> 00:15:57,579
with the background images and we're

355
00:15:57,579 --> 00:16:00,459
done so I showed you how to do inline

356
00:16:00,459 --> 00:16:01,930
images now we're doing the same stuff

357
00:16:01,930 --> 00:16:03,399
with background images only we need to

358
00:16:03,399 --> 00:16:05,760
policy if that's before when we good

359
00:16:05,760 --> 00:16:10,779
so next step number three

360
00:16:10,779 --> 00:16:14,769
what about link elements to inline to

361
00:16:14,769 --> 00:16:17,980
the reference style sheets my hTML is

362
00:16:17,980 --> 00:16:20,529
allowed to reference other style sheets

363
00:16:20,529 --> 00:16:22,540
if I want to run in my HTML or when I

364
00:16:22,540 --> 00:16:24,670
might want to make sure that my style

365
00:16:24,670 --> 00:16:26,949
sheets are rendered alongside so I need

366
00:16:26,949 --> 00:16:28,570
to embed them to remember we are

367
00:16:28,570 --> 00:16:32,410
rendering SVG to a canvas and the SVG is

368
00:16:32,410 --> 00:16:34,089
embedding HTML but it's not allowed to

369
00:16:34,089 --> 00:16:35,320
reference any external stuff time in

370
00:16:35,320 --> 00:16:38,980
learning everything so it looks simple

371
00:16:38,980 --> 00:16:42,010
at first we just kind of go with similar

372
00:16:42,010 --> 00:16:44,170
paths as with the image we're using Ajax

373
00:16:44,170 --> 00:16:45,130
to load the content

374
00:16:45,130 --> 00:16:46,510
it's simple here because we're actually

375
00:16:46,510 --> 00:16:49,209
using a reloading text what we do is we

376
00:16:49,209 --> 00:16:51,130
throw out the link and in the same place

377
00:16:51,130 --> 00:16:53,079
we put a style element that includes the

378
00:16:53,079 --> 00:16:56,260
content of that CSS make sure that you

379
00:16:56,260 --> 00:16:58,180
put the starlet and the same position as

380
00:16:58,180 --> 00:17:00,970
a link as CSS um as we learn today again

381
00:17:00,970 --> 00:17:04,030
follows the order of the declarations so

382
00:17:04,030 --> 00:17:07,720
be careful here we're not done yet

383
00:17:07,720 --> 00:17:10,270
it looks simple to just embed that

384
00:17:10,270 --> 00:17:13,510
content but the resources inside the CSS

385
00:17:13,510 --> 00:17:16,540
I'm just in lining all those relative

386
00:17:16,540 --> 00:17:19,990
links are relative to the source through

387
00:17:19,990 --> 00:17:21,490
the URL of the stylesheet

388
00:17:21,490 --> 00:17:24,970
so I can icon just pull in the CSS and

389
00:17:24,970 --> 00:17:26,350
just dump it into the HTML all those

390
00:17:26,350 --> 00:17:28,000
links will be broken all the relative

391
00:17:28,000 --> 00:17:29,770
links will be broken what I need to do

392
00:17:29,770 --> 00:17:36,070
is carefully inspect my my CSS unloading

393
00:17:36,070 --> 00:17:38,049
so I need to pass this stuff again I

394
00:17:38,049 --> 00:17:40,090
need to find all those references

395
00:17:40,090 --> 00:17:43,260
background images fonts import rules and

396
00:17:43,260 --> 00:17:47,260
need to adapt all those URLs to a

397
00:17:47,260 --> 00:17:49,179
relative to the UL of the style of the

398
00:17:49,179 --> 00:17:51,309
mother starship basically so for example

399
00:17:51,309 --> 00:17:54,490
if I have if I have an image dot slash

400
00:17:54,490 --> 00:17:56,620
images thoughts PI PNG it's an asset

401
00:17:56,620 --> 00:17:59,380
style default CSS I need to replace the

402
00:17:59,380 --> 00:18:01,809
dot dot with the assets from the starchy

403
00:18:01,809 --> 00:18:06,730
so I'm using a pure Jas ULP

404
00:18:06,730 --> 00:18:10,090
euro is which allows me to base my URL

405
00:18:10,090 --> 00:18:12,220
absolutely I think it's a wrong name it

406
00:18:12,220 --> 00:18:14,550
should be relatively to the sheet URL so

407
00:18:14,550 --> 00:18:17,740
if I inline my CSS content I need to fix

408
00:18:17,740 --> 00:18:19,809
all those paths and when I fix all those

409
00:18:19,809 --> 00:18:21,430
part and I'm done then I need to go

410
00:18:21,430 --> 00:18:23,020
through and replace all the background

411
00:18:23,020 --> 00:18:25,000
images we're in the like just what we

412
00:18:25,000 --> 00:18:31,059
did before so there you go we rendered

413
00:18:31,059 --> 00:18:33,820
HTML through the CF SVG's for an object

414
00:18:33,820 --> 00:18:34,980
we inlined

415
00:18:34,980 --> 00:18:37,390
not all of the external resources by now

416
00:18:37,390 --> 00:18:38,490
there's a bit more as I showed before

417
00:18:38,490 --> 00:18:41,590
but we load in binary content through HX

418
00:18:41,590 --> 00:18:42,880
or the text content through Ajax

419
00:18:42,880 --> 00:18:46,120
reinventing image images through data

420
00:18:46,120 --> 00:18:48,910
URI to embedding style sheets with

421
00:18:48,910 --> 00:18:52,090
parsing CSS to find resources to fix the

422
00:18:52,090 --> 00:18:53,220
past

423
00:18:53,220 --> 00:18:55,360
so what does that what does it look like

424
00:18:55,360 --> 00:18:59,559
it's demo time I'm showing you kind of

425
00:18:59,559 --> 00:19:01,240
boring demo right now let's see if that

426
00:19:01,240 --> 00:19:03,820
makes sense I have a canvas up there

427
00:19:03,820 --> 00:19:09,010
maybe I should assume in a bit so

428
00:19:09,010 --> 00:19:18,429
whoopsie that's a bit cut off what we

429
00:19:18,429 --> 00:19:32,400
can do is just switch over here and so

430
00:19:32,400 --> 00:19:35,880
so what I have there isn't a text area

431
00:19:35,880 --> 00:19:40,480
where I can type in arbitrary HTML and

432
00:19:40,480 --> 00:19:43,390
this is drawn into the canvas up there

433
00:19:43,390 --> 00:19:44,800
if you don't believe me that this is a

434
00:19:44,800 --> 00:19:47,110
canvas I can show you pretty easily if I

435
00:19:47,110 --> 00:19:49,750
right-click on this in Firefox it allows

436
00:19:49,750 --> 00:19:52,870
me to view the image so what I have

437
00:19:52,870 --> 00:19:55,240
right now here is my HTML as an image

438
00:19:55,240 --> 00:19:57,970
and if you look at the not sure whether

439
00:19:57,970 --> 00:19:59,620
you can see that it's pretty small but

440
00:19:59,620 --> 00:20:01,390
you see the data you are a UI in the

441
00:20:01,390 --> 00:20:05,140
browser resource so I basically now have

442
00:20:05,140 --> 00:20:07,630
an image that I just rendered inside the

443
00:20:07,630 --> 00:20:09,760
browser with an external image and I can

444
00:20:09,760 --> 00:20:19,090
do way more crazy stuff with that

445
00:20:19,100 --> 00:20:25,890
so back to demo so we could say we've

446
00:20:25,890 --> 00:20:28,920
done here I'd like to give you a small

447
00:20:28,920 --> 00:20:32,850
bonus let's see if that makes fun I

448
00:20:32,850 --> 00:20:35,340
don't only want to render a static HTML

449
00:20:35,340 --> 00:20:40,950
I want to render aged in an HTML page

450
00:20:40,950 --> 00:20:44,580
that includes JavaScript I want to make

451
00:20:44,580 --> 00:20:47,430
sure that if my JavaScript does some

452
00:20:47,430 --> 00:20:49,020
stuff with my page that I render the

453
00:20:49,020 --> 00:20:53,700
final outcome so is that possible and it

454
00:20:53,700 --> 00:20:56,730
turns out it is well what I can

455
00:20:56,730 --> 00:20:59,010
basically do is just create an iframe

456
00:20:59,010 --> 00:21:02,220
throw my HTML into that iframe and just

457
00:21:02,220 --> 00:21:03,960
wait for the iframe to trigger the

458
00:21:03,960 --> 00:21:05,370
onload event when the onload event

459
00:21:05,370 --> 00:21:09,060
triggers my page has done its rendering

460
00:21:09,060 --> 00:21:12,150
stuff and the state kind of the state

461
00:21:12,150 --> 00:21:15,330
possibly changed and I can just then

462
00:21:15,330 --> 00:21:17,670
take the document of the iframe and then

463
00:21:17,670 --> 00:21:19,710
get the HTML out again and then I'll

464
00:21:19,710 --> 00:21:21,990
have like a different HTML string and

465
00:21:21,990 --> 00:21:24,270
that basically allows me to execute

466
00:21:24,270 --> 00:21:26,880
JavaScript at the same time I'm not

467
00:21:26,880 --> 00:21:29,790
really sure about the sandboxing stuff I

468
00:21:29,790 --> 00:21:32,370
did read a bit up on sandboxing the

469
00:21:32,370 --> 00:21:34,860
iframe and it turns out oh yeah my

470
00:21:34,860 --> 00:21:36,060
feeling from that was I don't need to

471
00:21:36,060 --> 00:21:37,530
sandbox it it works but if you guys have

472
00:21:37,530 --> 00:21:39,120
security concerns but do come up there

473
00:21:39,120 --> 00:21:40,860
to me and tell me if I need to make that

474
00:21:40,860 --> 00:21:43,200
secure somehow it's forcing my security

475
00:21:43,200 --> 00:21:47,900
concerns so there are a few issues here

476
00:21:47,900 --> 00:21:49,980
as I said before the same-origin policy

477
00:21:49,980 --> 00:21:52,470
does not allow you to to load random

478
00:21:52,470 --> 00:21:56,070
content so Ajax you know that stuff what

479
00:21:56,070 --> 00:21:58,200
you can do is if you if you have control

480
00:21:58,200 --> 00:22:00,990
over the origins you can expose common

481
00:22:00,990 --> 00:22:03,960
object resource sharing so correct yeah

482
00:22:03,960 --> 00:22:08,220
cause a problem I had with the WebKit

483
00:22:08,220 --> 00:22:10,110
family I'm not sure if I feel I'm still

484
00:22:10,110 --> 00:22:14,220
allowed to call it WebKit family but

485
00:22:14,220 --> 00:22:18,000
chrome sadly cannot write background

486
00:22:18,000 --> 00:22:20,850
images back so this is a pausing that I

487
00:22:20,850 --> 00:22:22,710
showed earlier does not work in Chrome

488
00:22:22,710 --> 00:22:24,510
because of this simple bug so what I do

489
00:22:24,510 --> 00:22:26,730
right now is we can just fall back to

490
00:22:26,730 --> 00:22:28,830
the CSS object model implementation that

491
00:22:28,830 --> 00:22:30,750
a guy on github does so

492
00:22:30,750 --> 00:22:33,179
he's got an awesome implementation for

493
00:22:33,179 --> 00:22:34,799
nodejs which I'm just using in a browser

494
00:22:34,799 --> 00:22:37,620
and that's awesome so I know chrome has

495
00:22:37,620 --> 00:22:39,210
that stuff in that case I'm using a

496
00:22:39,210 --> 00:22:41,970
polyfill I guess so

497
00:22:41,970 --> 00:22:46,890
a kind of special problem is if you're

498
00:22:46,890 --> 00:22:48,990
embedding SVG's if you have an SVG

499
00:22:48,990 --> 00:22:51,510
inside your HTML remember that the HTML

500
00:22:51,510 --> 00:22:53,130
goes to into another SVG so you have an

501
00:22:53,130 --> 00:22:55,890
SVG inside the SVG that suit doesn't

502
00:22:55,890 --> 00:22:57,809
seem to work neither in Safari nor

503
00:22:57,809 --> 00:23:01,260
chrome there's a workaround but that's a

504
00:23:01,260 --> 00:23:06,390
basic issue the last point is my major

505
00:23:06,390 --> 00:23:09,360
pain point and that's where I needed to

506
00:23:09,360 --> 00:23:11,159
ask the Google guys I had a conversation

507
00:23:11,159 --> 00:23:12,990
with Mike yesterday and maybe you

508
00:23:12,990 --> 00:23:15,750
listened to his talk yesterday as

509
00:23:15,750 --> 00:23:17,700
neither Safari not chrome allow me to

510
00:23:17,700 --> 00:23:20,220
read from the canvas after I draw this

511
00:23:20,220 --> 00:23:23,070
SVG to it there seems to be a different

512
00:23:23,070 --> 00:23:24,720
interpretation of what the standard

513
00:23:24,720 --> 00:23:26,850
requires Firefox allows you to do that

514
00:23:26,850 --> 00:23:30,510
Chrome Safari don't if you want to then

515
00:23:30,510 --> 00:23:32,970
work with the content you right now you

516
00:23:32,970 --> 00:23:34,860
cannot you can't which is I think a

517
00:23:34,860 --> 00:23:36,390
south state because obviously I can't

518
00:23:36,390 --> 00:23:38,220
think of an attack vector because if I'm

519
00:23:38,220 --> 00:23:39,720
allowed to load all that content and I'm

520
00:23:39,720 --> 00:23:40,860
allowed to render that content I should

521
00:23:40,860 --> 00:23:44,549
be able to read from this one last sat

522
00:23:44,549 --> 00:23:45,960
point is I 11

523
00:23:45,960 --> 00:23:48,419
even the ie 11 preview has no support

524
00:23:48,419 --> 00:23:52,710
for an object so ie 11 sadly none of the

525
00:23:52,710 --> 00:23:54,510
IE versions do support that stuff that

526
00:23:54,510 --> 00:23:55,190
we're doing here

527
00:23:55,190 --> 00:23:57,270
good news though this ability in the

528
00:23:57,270 --> 00:23:59,159
browser's have increased and especially

529
00:23:59,159 --> 00:24:00,630
the Firefox guys there's one guy in

530
00:24:00,630 --> 00:24:02,880
Firefox that seems to be interested in

531
00:24:02,880 --> 00:24:05,460
that and every time I complained he

532
00:24:05,460 --> 00:24:09,090
quickly fixed that bug the last bug I

533
00:24:09,090 --> 00:24:11,280
reported was my fault so he was nice too

534
00:24:11,280 --> 00:24:14,400
so what's that sorry all about I ended

535
00:24:14,400 --> 00:24:16,980
up putting that into a library it's on

536
00:24:16,980 --> 00:24:20,250
github it seems a few people are using

537
00:24:20,250 --> 00:24:21,390
that at least they're hitting the start

538
00:24:21,390 --> 00:24:23,159
button on github I just don't know what

539
00:24:23,159 --> 00:24:25,260
they do move out I don't have really I

540
00:24:25,260 --> 00:24:26,580
don't know what people want to use it

541
00:24:26,580 --> 00:24:29,039
for I just talked to dominate and he

542
00:24:29,039 --> 00:24:30,780
said he's got an interesting to case but

543
00:24:30,780 --> 00:24:33,539
I still need to ask him I have it I have

544
00:24:33,539 --> 00:24:35,580
a use case for that and that maybe

545
00:24:35,580 --> 00:24:38,610
sounds a bit weird my originally idea

546
00:24:38,610 --> 00:24:42,000
was I want to start testing my CSS my

547
00:24:42,000 --> 00:24:43,860
idea was if I can just take screenshots

548
00:24:43,860 --> 00:24:44,580
I'm

549
00:24:44,580 --> 00:24:47,399
I just compare my screenshots old versus

550
00:24:47,399 --> 00:24:50,700
new and Mike might even crazy idea was I

551
00:24:50,700 --> 00:24:52,769
wanted to do that in the browser and I

552
00:24:52,769 --> 00:24:56,100
can now do that I can now render web

553
00:24:56,100 --> 00:24:58,559
pages in the browser and I can do my

554
00:24:58,559 --> 00:25:00,269
testing on that that's also in github if

555
00:25:00,269 --> 00:25:04,289
in case you're interested so thanks for

556
00:25:04,289 --> 00:25:05,700
listening and do something cool with

557
00:25:05,700 --> 00:25:08,279
that and I might say that because pop

558
00:25:08,279 --> 00:25:10,620
works is painful for me being here we're

559
00:25:10,620 --> 00:25:13,440
hiring if you interested check that out

560
00:25:13,440 --> 00:25:27,110
thank

