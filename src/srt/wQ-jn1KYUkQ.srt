1
00:00:02,780 --> 00:00:05,460

does it work yeah it works well that's

2
00:00:05,460 --> 00:00:06,810
big

3
00:00:06,810 --> 00:00:10,320
so hello my name is Ann amigas I work as

4
00:00:10,320 --> 00:00:12,240
a front-end developer and designer in

5
00:00:12,240 --> 00:00:15,059
lunar logic we are no management

6
00:00:15,059 --> 00:00:17,130
software house based in Krakow Poland

7
00:00:17,130 --> 00:00:20,910
which is not far thankfully we built

8
00:00:20,910 --> 00:00:25,859
apps in rails in elixir in react and

9
00:00:25,859 --> 00:00:27,960
whatever technology suits our clients

10
00:00:27,960 --> 00:00:31,080
needs best the title of my talk is make

11
00:00:31,080 --> 00:00:35,010
your animations perform well and I had a

12
00:00:35,010 --> 00:00:38,219
pleasure to create and maintain free

13
00:00:38,219 --> 00:00:40,920
open-source libraries you can ignore the

14
00:00:40,920 --> 00:00:45,930
CSS name in the name stir and before I

15
00:00:45,930 --> 00:00:48,270
give you the first tip on animation

16
00:00:48,270 --> 00:00:50,039
performance I need to share a short

17
00:00:50,039 --> 00:00:54,899
story about my life so about two years

18
00:00:54,899 --> 00:00:57,960
ago I bought my very first own apartment

19
00:00:57,960 --> 00:01:00,989
and I decided to decorate it on my own

20
00:01:00,989 --> 00:01:04,949
and what I found out it's that like

21
00:01:04,949 --> 00:01:07,260
decorating your house is very similar to

22
00:01:07,260 --> 00:01:09,450
designing a website you just need to put

23
00:01:09,450 --> 00:01:13,770
many things together that go well what I

24
00:01:13,770 --> 00:01:17,610
also realized is that most of the things

25
00:01:17,610 --> 00:01:19,530
that are out there in furniture shops

26
00:01:19,530 --> 00:01:23,310
are not the things that I want in my

27
00:01:23,310 --> 00:01:26,100
house I just didn't like the things that

28
00:01:26,100 --> 00:01:28,680
I could afford and the things that I

29
00:01:28,680 --> 00:01:31,740
couldn't afford I liked so kind of it

30
00:01:31,740 --> 00:01:36,090
didn't much so this is my lamp in the

31
00:01:36,090 --> 00:01:40,259
living room after two years and if I had

32
00:01:40,259 --> 00:01:41,670
to compare it to something on the

33
00:01:41,670 --> 00:01:45,360
website is it's this just text that says

34
00:01:45,360 --> 00:01:47,430
low thing that she puts in a place where

35
00:01:47,430 --> 00:01:51,030
the low there should be it just kills

36
00:01:51,030 --> 00:01:52,710
you that's something like that is there

37
00:01:52,710 --> 00:01:54,630
anything about it every time I see it

38
00:01:54,630 --> 00:01:56,549
that you should actually put something

39
00:01:56,549 --> 00:02:00,270
real there so it's good because at some

40
00:02:00,270 --> 00:02:03,000
point you're going to replace it the

41
00:02:03,000 --> 00:02:06,799
next piece I have is this beautiful

42
00:02:06,799 --> 00:02:10,670
coffee table when I found it after light

43
00:02:10,670 --> 00:02:14,810
year and a half I told that it's perfect

44
00:02:14,810 --> 00:02:17,150
because it was affordable what color was

45
00:02:17,150 --> 00:02:22,010
matching my place it has this shelf to

46
00:02:22,010 --> 00:02:24,260
put all my art albums there so it's just

47
00:02:24,260 --> 00:02:26,090
it's just perfect and I assembled it

48
00:02:26,090 --> 00:02:28,190
myself so I feel it's like really

49
00:02:28,190 --> 00:02:31,280
powerful after that and if I had to

50
00:02:31,280 --> 00:02:33,140
compare it it would be comparing it to

51
00:02:33,140 --> 00:02:35,980
the animation that just helps user to

52
00:02:35,980 --> 00:02:38,420
understand the app better it just guides

53
00:02:38,420 --> 00:02:41,840
him at some context so everything that

54
00:02:41,840 --> 00:02:43,760
the user is doing there so it's just

55
00:02:43,760 --> 00:02:49,810
really good thing and I have this chairs

56
00:02:49,810 --> 00:02:52,760
well this countertop is of irregular

57
00:02:52,760 --> 00:02:55,340
size the regular chairs are just too low

58
00:02:55,340 --> 00:02:57,980
and regular hookers are too high for it

59
00:02:57,980 --> 00:03:01,190
so I have to choose from like very small

60
00:03:01,190 --> 00:03:04,400
pool of chairs I found this online and

61
00:03:04,400 --> 00:03:06,650
they're like why it's for the ball and

62
00:03:06,650 --> 00:03:10,640
kind of like simple so it's they're

63
00:03:10,640 --> 00:03:12,170
going to be kind of okay

64
00:03:12,170 --> 00:03:15,049
but it turned out they're kind of okay

65
00:03:15,049 --> 00:03:17,030
it's not enough for me I just hate them

66
00:03:17,030 --> 00:03:19,310
I never sit on them I prefer to eat

67
00:03:19,310 --> 00:03:22,220
standing up the only moment that they're

68
00:03:22,220 --> 00:03:24,140
in use is some the big part is when

69
00:03:24,140 --> 00:03:26,570
someone gets like really drunk and

70
00:03:26,570 --> 00:03:29,690
decides to sit on them and I can't get

71
00:03:29,690 --> 00:03:31,730
rid of them because like I have chairs

72
00:03:31,730 --> 00:03:33,560
they're like everything is fine about

73
00:03:33,560 --> 00:03:35,750
them but it's just me that don't like

74
00:03:35,750 --> 00:03:37,670
them and my friends whispering them

75
00:03:37,670 --> 00:03:40,070
crazy just throw away and have nothing

76
00:03:40,070 --> 00:03:42,560
there and what I could compare it to

77
00:03:42,560 --> 00:03:45,530
it's just animation that you put

78
00:03:45,530 --> 00:03:47,329
something out there without really

79
00:03:47,329 --> 00:03:50,510
thinking about it and it just stays

80
00:03:50,510 --> 00:03:53,720
there forever you have no time to

81
00:03:53,720 --> 00:03:57,860
replace it because you know you already

82
00:03:57,860 --> 00:03:59,750
you already put something there and you

83
00:03:59,750 --> 00:04:01,549
have different priorities so it's like

84
00:04:01,549 --> 00:04:04,040
laggy you make all your users just

85
00:04:04,040 --> 00:04:06,769
downloads thousands of assets and it's

86
00:04:06,769 --> 00:04:10,100
not really helping anyone it makes the

87
00:04:10,100 --> 00:04:13,130
experience worse in like all cases

88
00:04:13,130 --> 00:04:15,560
basically and it's going to stay there

89
00:04:15,560 --> 00:04:16,160
believe me

90
00:04:16,160 --> 00:04:18,500
so the first rule of performance of an

91
00:04:18,500 --> 00:04:20,660
animation is just to not use them if you

92
00:04:20,660 --> 00:04:22,789
don't really need them just don't force

93
00:04:22,789 --> 00:04:23,170
you

94
00:04:23,170 --> 00:04:27,460
to download many assets to make the

95
00:04:27,460 --> 00:04:32,950
whole up more junky okay now that we

96
00:04:32,950 --> 00:04:35,320
have the most important rule of CSS and

97
00:04:35,320 --> 00:04:37,570
JavaScript and any kind of animations

98
00:04:37,570 --> 00:04:40,570
behind us the important thing is to

99
00:04:40,570 --> 00:04:42,700
choose the right tool so there's this

100
00:04:42,700 --> 00:04:46,000
debate CSS or JavaScript animations some

101
00:04:46,000 --> 00:04:49,720
people prefer this or that actually to

102
00:04:49,720 --> 00:04:52,120
be honest they're both perfectly good

103
00:04:52,120 --> 00:04:55,480
tools but they suit different purpose so

104
00:04:55,480 --> 00:04:58,570
if you have CSS animations they're just

105
00:04:58,570 --> 00:05:00,420
great if you have something simple up

106
00:05:00,420 --> 00:05:03,310
simple to put up like I don't know

107
00:05:03,310 --> 00:05:05,470
something that just needs to slide up

108
00:05:05,470 --> 00:05:08,110
the screen this is perfect then during

109
00:05:08,110 --> 00:05:10,120
the native to the browser they get all

110
00:05:10,120 --> 00:05:14,070
the GPU acceleration from the browser

111
00:05:14,070 --> 00:05:17,700
there's a need to put prefixes for them

112
00:05:17,700 --> 00:05:21,340
unfortunately but it's not much and the

113
00:05:21,340 --> 00:05:23,350
only bad thing about them is that if you

114
00:05:23,350 --> 00:05:25,690
need to schedule more than like one or

115
00:05:25,690 --> 00:05:28,330
two animations in CSS it's just a pain

116
00:05:28,330 --> 00:05:30,190
and this is where the JavaScript

117
00:05:30,190 --> 00:05:33,640
animations actually shine they're really

118
00:05:33,640 --> 00:05:35,920
good at scheduling and timing so if you

119
00:05:35,920 --> 00:05:37,930
need to put more than one animation and

120
00:05:37,930 --> 00:05:40,360
schedule them one after another this is

121
00:05:40,360 --> 00:05:40,900
great

122
00:05:40,900 --> 00:05:42,130
and there are many ways how you can

123
00:05:42,130 --> 00:05:44,380
implement JavaScript animations during

124
00:05:44,380 --> 00:05:47,620
like pure JavaScript it needs some

125
00:05:47,620 --> 00:05:49,210
optimizations I will talk about the

126
00:05:49,210 --> 00:05:51,970
trick later there's web animation API

127
00:05:51,970 --> 00:05:54,400
which is my personal favorite because it

128
00:05:54,400 --> 00:05:57,670
takes the best things of both words it's

129
00:05:57,670 --> 00:06:00,040
it's got this GPU acceleration from the

130
00:06:00,040 --> 00:06:02,680
browser and at the same time it get the

131
00:06:02,680 --> 00:06:05,710
scheduling and timing unfortunately it

132
00:06:05,710 --> 00:06:08,530
still needs to be poly field so until

133
00:06:08,530 --> 00:06:11,050
like all the browser vendors decide to

134
00:06:11,050 --> 00:06:13,990
have it there well you need to polyfill

135
00:06:13,990 --> 00:06:17,680
that and there are frameworks but you

136
00:06:17,680 --> 00:06:19,690
need to decide if they're really needed

137
00:06:19,690 --> 00:06:22,150
in your app because well it's some code

138
00:06:22,150 --> 00:06:25,480
that you're downloading and well it can

139
00:06:25,480 --> 00:06:28,270
be heavy like music is amazing platform

140
00:06:28,270 --> 00:06:30,610
but it's really heavy so for small apps

141
00:06:30,610 --> 00:06:33,130
with notes many animations is not good

142
00:06:33,130 --> 00:06:34,120
choice and MJ

143
00:06:34,120 --> 00:06:38,949
can be a good choice then okay so so we

144
00:06:38,949 --> 00:06:42,850
have the choice of Bustos and the the

145
00:06:42,850 --> 00:06:46,150
most important tip behind us but before

146
00:06:46,150 --> 00:06:47,860
we actually start optimizing our

147
00:06:47,860 --> 00:06:50,740
animations it's good to know what's

148
00:06:50,740 --> 00:06:54,220
going up what's going on in the behind

149
00:06:54,220 --> 00:06:57,639
because it makes us realize that some

150
00:06:57,639 --> 00:07:01,360
optimizations can can can make things

151
00:07:01,360 --> 00:07:03,040
better or worse actually

152
00:07:03,040 --> 00:07:06,669
so how actually browser paints a website

153
00:07:06,669 --> 00:07:09,400
let's talk about this for a moment like

154
00:07:09,400 --> 00:07:12,250
very briefly so first step is the

155
00:07:12,250 --> 00:07:16,180
browser makes get request and it gets

156
00:07:16,180 --> 00:07:19,930
HTML or in turn then the h2 the hTML is

157
00:07:19,930 --> 00:07:22,479
parsed and Dom is created document

158
00:07:22,479 --> 00:07:25,330
object model it looks like a tree it's

159
00:07:25,330 --> 00:07:27,669
got all the notes from the HTML in it

160
00:07:27,669 --> 00:07:31,180
they're visible in this way after that

161
00:07:31,180 --> 00:07:33,669
the styles are applied it's from the

162
00:07:33,669 --> 00:07:36,340
user agent from your style sheets inline

163
00:07:36,340 --> 00:07:41,530
Styles the don't is taken out and we

164
00:07:41,530 --> 00:07:43,300
have a render tree render tree is very

165
00:07:43,300 --> 00:07:46,690
similar to the Dom with this difference

166
00:07:46,690 --> 00:07:49,510
that render tree has all the Styles

167
00:07:49,510 --> 00:07:52,360
applied and there are only things that's

168
00:07:52,360 --> 00:07:54,400
going to be actually visible on a page

169
00:07:54,400 --> 00:07:57,669
so for example if the image elements

170
00:07:57,669 --> 00:08:00,910
here had display:none and a paragraph

171
00:08:00,910 --> 00:08:04,389
element had a pseudo class that's what

172
00:08:04,389 --> 00:08:05,680
would happen

173
00:08:05,680 --> 00:08:07,479
they'll be it would be also represented

174
00:08:07,479 --> 00:08:10,389
in the render tree and then the layout

175
00:08:10,389 --> 00:08:13,479
is calculated at this point the browser

176
00:08:13,479 --> 00:08:15,430
is trying to figure out how much space

177
00:08:15,430 --> 00:08:17,229
each of the elements is going to take

178
00:08:17,229 --> 00:08:20,139
and it actually features it as a

179
00:08:20,139 --> 00:08:23,680
collection of vector boxes here we need

180
00:08:23,680 --> 00:08:26,500
to remember that the parent size affects

181
00:08:26,500 --> 00:08:31,120
its children size after this points when

182
00:08:31,120 --> 00:08:32,979
browser already figure out how much

183
00:08:32,979 --> 00:08:36,459
space each element is going to take we

184
00:08:36,459 --> 00:08:39,459
have everything rasterized and put into

185
00:08:39,459 --> 00:08:42,180
layers you can think of layers as of

186
00:08:42,180 --> 00:08:44,800
something like layers in Photoshop that

187
00:08:44,800 --> 00:08:46,600
if you have things on two different

188
00:08:46,600 --> 00:08:47,220
layers

189
00:08:47,220 --> 00:08:49,350
then you can move them around if things

190
00:08:49,350 --> 00:08:51,329
are on the same layer then there is not

191
00:08:51,329 --> 00:08:53,730
much of what you can do actually they're

192
00:08:53,730 --> 00:08:59,069
just glued together so yeah so our our

193
00:08:59,069 --> 00:09:02,910
our collection of boxes moves to to this

194
00:09:02,910 --> 00:09:04,769
two layers layers are going to be

195
00:09:04,769 --> 00:09:07,350
represented as this box shadow I hope

196
00:09:07,350 --> 00:09:12,110
that you appreciate how cheesy this is

197
00:09:12,110 --> 00:09:15,060
okay and the last step is compositing

198
00:09:15,060 --> 00:09:16,949
and at this step this is the first step

199
00:09:16,949 --> 00:09:21,029
that browser takes advantage of the GPU

200
00:09:21,029 --> 00:09:25,379
so it optimizes its its way around here

201
00:09:25,379 --> 00:09:29,459
so the the layers that we had actually

202
00:09:29,459 --> 00:09:32,339
get glued together into one frame that

203
00:09:32,339 --> 00:09:35,550
is then shell to the our end user dude

204
00:09:35,550 --> 00:09:38,990
it's good to one frame one picture so

205
00:09:38,990 --> 00:09:42,589
this was the first render but actually

206
00:09:42,589 --> 00:09:45,689
you must understand that every time the

207
00:09:45,689 --> 00:09:49,290
user makes any change on the on your

208
00:09:49,290 --> 00:09:50,910
page so by changing I mean like

209
00:09:50,910 --> 00:09:53,069
scrolling hovering over element that

210
00:09:53,069 --> 00:09:56,279
changes and hover or just clicking

211
00:09:56,279 --> 00:09:58,980
something that gets a class somewhere

212
00:09:58,980 --> 00:10:00,930
else then the browser needs to go

213
00:10:00,930 --> 00:10:03,480
through all the steps again with the

214
00:10:03,480 --> 00:10:07,040
small change that instead of having

215
00:10:07,040 --> 00:10:10,500
instead of having this request at the

216
00:10:10,500 --> 00:10:12,569
beginning there can be some JavaScript

217
00:10:12,569 --> 00:10:17,100
that's introduces the change so there

218
00:10:17,100 --> 00:10:19,319
are different types of change that you

219
00:10:19,319 --> 00:10:20,879
can actually introduce and some of them

220
00:10:20,879 --> 00:10:23,100
are more important for performance and

221
00:10:23,100 --> 00:10:24,689
some of them are a less performance so

222
00:10:24,689 --> 00:10:27,480
let's go through them the first type of

223
00:10:27,480 --> 00:10:29,040
changes when we change layout

224
00:10:29,040 --> 00:10:31,850
it's when we animates with height

225
00:10:31,850 --> 00:10:37,500
margins left or right properties and in

226
00:10:37,500 --> 00:10:39,600
this case browser needs to go through

227
00:10:39,600 --> 00:10:41,339
all the steps because it needs to figure

228
00:10:41,339 --> 00:10:43,050
out how much space each element is

229
00:10:43,050 --> 00:10:47,579
taking and unfortunately it's it's a

230
00:10:47,579 --> 00:10:50,309
very costly change then there is when we

231
00:10:50,309 --> 00:10:53,579
change the paint properties the browser

232
00:10:53,579 --> 00:10:55,829
knows how much space each elements takes

233
00:10:55,829 --> 00:10:58,709
so it can skip this step so it's a bit

234
00:10:58,709 --> 00:11:00,060
more performance

235
00:11:00,060 --> 00:11:02,190
these are changes like background color

236
00:11:02,190 --> 00:11:06,870
color shadows things like that and there

237
00:11:06,870 --> 00:11:08,880
is the most performant type of change

238
00:11:08,880 --> 00:11:11,520
when we only change compositing in

239
00:11:11,520 --> 00:11:16,440
compositing its transforms or opacity in

240
00:11:16,440 --> 00:11:18,570
this case we don't change layout or

241
00:11:18,570 --> 00:11:20,940
paint so this is the most optimal kind

242
00:11:20,940 --> 00:11:23,610
of change which means that these are the

243
00:11:23,610 --> 00:11:25,470
two properties that you should be

244
00:11:25,470 --> 00:11:28,620
animating like in in most cases they're

245
00:11:28,620 --> 00:11:31,080
like perfectly fine to anything you want

246
00:11:31,080 --> 00:11:36,570
to do in animation all right why is that

247
00:11:36,570 --> 00:11:39,960
so why this should be the only purpose

248
00:11:39,960 --> 00:11:43,320
is for for animating first it's this GPU

249
00:11:43,320 --> 00:11:45,420
acceleration that I that I said that's

250
00:11:45,420 --> 00:11:47,520
happening at the compositing stage and

251
00:11:47,520 --> 00:11:51,770
the second one is layer creation so at

252
00:11:51,770 --> 00:11:57,390
next to last step we had rasterizing and

253
00:11:57,390 --> 00:11:59,160
creating layers but actually you need to

254
00:11:59,160 --> 00:12:01,620
know that that by default browser puts

255
00:12:01,620 --> 00:12:04,530
everything into one layer so we need to

256
00:12:04,530 --> 00:12:06,180
figure out ways so that the browser

257
00:12:06,180 --> 00:12:09,750
would create smaller layers and by

258
00:12:09,750 --> 00:12:14,010
default when we have this when we have

259
00:12:14,010 --> 00:12:16,200
these different layers like things can

260
00:12:16,200 --> 00:12:18,360
be moved around and they don't affect

261
00:12:18,360 --> 00:12:21,840
other things so it means that that the

262
00:12:21,840 --> 00:12:24,810
animation is smooth so what creates

263
00:12:24,810 --> 00:12:27,780
other layers frizzier perspective

264
00:12:27,780 --> 00:12:30,330
transforms animated this is a keyword

265
00:12:30,330 --> 00:12:34,470
animated 2d transfers or opacity if

266
00:12:34,470 --> 00:12:38,460
element is top on the top or it's a

267
00:12:38,460 --> 00:12:41,250
child of the compositing layer that was

268
00:12:41,250 --> 00:12:44,250
already created accelerated CSS filters

269
00:12:44,250 --> 00:12:47,400
and in special cases video canvas or

270
00:12:47,400 --> 00:12:50,430
plugins like flash or Silverlight this

271
00:12:50,430 --> 00:12:53,340
is what creates layers so we have a

272
00:12:53,340 --> 00:12:56,130
small problem here and I'll give you an

273
00:12:56,130 --> 00:12:58,350
example to understand it better let's

274
00:12:58,350 --> 00:13:00,420
say that we have here an animation is

275
00:13:00,420 --> 00:13:02,980
applied to the button and it's

276
00:13:02,980 --> 00:13:07,540
it rotates the button all the time so

277
00:13:07,540 --> 00:13:09,880
it's fine we have two layers button is

278
00:13:09,880 --> 00:13:12,399
just moving around notes and that's

279
00:13:12,399 --> 00:13:16,149
actually affecting anything around but

280
00:13:16,149 --> 00:13:18,160
in most cases you would want the button

281
00:13:18,160 --> 00:13:21,250
to actually be moved only for example if

282
00:13:21,250 --> 00:13:24,940
someone hovers over the verse over it so

283
00:13:24,940 --> 00:13:26,740
that's the point where you want the

284
00:13:26,740 --> 00:13:30,940
animation to happen so the problem here

285
00:13:30,940 --> 00:13:32,829
is that the browser doesn't know that

286
00:13:32,829 --> 00:13:35,230
this animation is bound to happen so

287
00:13:35,230 --> 00:13:38,290
it's it puts everything on one layer and

288
00:13:38,290 --> 00:13:42,430
when user actually actually just hovers

289
00:13:42,430 --> 00:13:44,800
over over the elements it only has to

290
00:13:44,800 --> 00:13:47,260
create the new layer so everything needs

291
00:13:47,260 --> 00:13:50,350
to be repainted and what users is of

292
00:13:50,350 --> 00:13:51,430
course not

293
00:13:51,430 --> 00:13:53,589
like the button doesn't disappear

294
00:13:53,589 --> 00:13:56,529
anywhere but there is a small lag and it

295
00:13:56,529 --> 00:13:59,800
can make user think that your your app

296
00:13:59,800 --> 00:14:04,810
is responsive or it's just slow and the

297
00:14:04,810 --> 00:14:06,670
worst part is that after animation is

298
00:14:06,670 --> 00:14:09,639
done it's also pushed layers together

299
00:14:09,639 --> 00:14:13,060
again so if a user hovers over it again

300
00:14:13,060 --> 00:14:15,720
it will do the same thing repaint things

301
00:14:15,720 --> 00:14:18,880
so there is one more thing that can make

302
00:14:18,880 --> 00:14:22,660
your browser create a new layer and this

303
00:14:22,660 --> 00:14:25,180
is the will change property and it can

304
00:14:25,180 --> 00:14:26,740
help us with the prone that we've had

305
00:14:26,740 --> 00:14:29,589
using it is very easy you just need to

306
00:14:29,589 --> 00:14:31,540
apply it to the element that is going to

307
00:14:31,540 --> 00:14:35,170
be changed and explicitly say like we'll

308
00:14:35,170 --> 00:14:38,980
change transform browser will we'll know

309
00:14:38,980 --> 00:14:41,680
that it needs to listen for a change it

310
00:14:41,680 --> 00:14:43,480
will create the new layer for this

311
00:14:43,480 --> 00:14:47,339
element so so we can change things

312
00:14:47,339 --> 00:14:50,889
without being worried that and you learn

313
00:14:50,889 --> 00:14:54,100
it to be created at the moment of of

314
00:14:54,100 --> 00:14:56,290
user actually interacting with the

315
00:14:56,290 --> 00:14:59,680
website there are a few rules that you

316
00:14:59,680 --> 00:15:02,500
need to follow with will change first

317
00:15:02,500 --> 00:15:04,810
one is you need to give a browser a

318
00:15:04,810 --> 00:15:07,480
moment to think so let's say that you

319
00:15:07,480 --> 00:15:11,079
want to apply some animation in hover

320
00:15:11,079 --> 00:15:14,709
you cannot add like we'll change

321
00:15:14,709 --> 00:15:17,319
transform for the hovered element you

322
00:15:17,319 --> 00:15:19,839
need to be one step ahead of the browser

323
00:15:19,839 --> 00:15:22,209
because when user hovers over element

324
00:15:22,209 --> 00:15:24,790
the browser already is like making the

325
00:15:24,790 --> 00:15:27,550
best optimizations it can for for it to

326
00:15:27,550 --> 00:15:29,829
happen and actually putting will change

327
00:15:29,829 --> 00:15:32,800
at this point could could interrupt the

328
00:15:32,800 --> 00:15:35,170
browser so please check at least added

329
00:15:35,170 --> 00:15:38,199
one moment before you want this change

330
00:15:38,199 --> 00:15:45,370
to happen like here to just button you

331
00:15:45,370 --> 00:15:47,680
can't also try to optimize too many

332
00:15:47,680 --> 00:15:50,620
elements you might think that well why

333
00:15:50,620 --> 00:15:53,350
just no ads will change to everything

334
00:15:53,350 --> 00:15:54,819
and have everything on different

335
00:15:54,819 --> 00:15:56,680
separate layers and just move things

336
00:15:56,680 --> 00:15:58,600
around without affecting anything else

337
00:15:58,600 --> 00:16:02,490
don't ever do this here was a nice

338
00:16:02,490 --> 00:16:05,740
spider-man quote on the slide but I had

339
00:16:05,740 --> 00:16:08,319
to remove it because it was just already

340
00:16:08,319 --> 00:16:11,230
on CSS conf two days ago I would just

341
00:16:11,230 --> 00:16:13,089
hint you that it was Uncle Sam saying

342
00:16:13,089 --> 00:16:17,829
that things about responsibility so

343
00:16:17,829 --> 00:16:21,100
every layer consumes memory starting to

344
00:16:21,100 --> 00:16:24,160
use them wisely if user has a less

345
00:16:24,160 --> 00:16:26,790
powerful device like low end phone

346
00:16:26,790 --> 00:16:29,260
actually having too many layers can

347
00:16:29,260 --> 00:16:33,160
trash his his or her browser and well

348
00:16:33,160 --> 00:16:34,810
the experience won't be very good then

349
00:16:34,810 --> 00:16:38,709
write another rule that you need to

350
00:16:38,709 --> 00:16:40,990
remember is to use use will change

351
00:16:40,990 --> 00:16:43,060
inside sheets only if the change is

352
00:16:43,060 --> 00:16:45,399
bound to happen constantly if you have

353
00:16:45,399 --> 00:16:47,050
animation that will happen only once

354
00:16:47,050 --> 00:16:50,620
it's better to move I think the will

355
00:16:50,620 --> 00:16:54,850
change property to JavaScript and if you

356
00:16:54,850 --> 00:16:58,089
have changed like hovering over elements

357
00:16:58,089 --> 00:16:59,649
that will happen all the time for

358
00:16:59,649 --> 00:17:01,149
example I don't know we show something

359
00:17:01,149 --> 00:17:03,189
on hover on each element on the page

360
00:17:03,189 --> 00:17:05,559
then it should say in your style sheets

361
00:17:05,559 --> 00:17:08,199
and those it's a good idea to actually

362
00:17:08,199 --> 00:17:10,209
remove this hint once once you're done

363
00:17:10,209 --> 00:17:11,740
with your animations so that browser

364
00:17:11,740 --> 00:17:15,040
wouldn't have this layer and it wouldn't

365
00:17:15,040 --> 00:17:18,370
just listen for user to interact with

366
00:17:18,370 --> 00:17:20,829
your page you can do this easily just

367
00:17:20,829 --> 00:17:22,929
grab the element that is supposed to

368
00:17:22,929 --> 00:17:25,550
have the animation on that

369
00:17:25,550 --> 00:17:28,340
put two even listeners here for example

370
00:17:28,340 --> 00:17:30,920
we have Mao Center so on Mouse

371
00:17:30,920 --> 00:17:35,570
intelligence ad will change property to

372
00:17:35,570 --> 00:17:37,730
the lemons and when the animation and

373
00:17:37,730 --> 00:17:41,300
event fires you just remove this just

374
00:17:41,300 --> 00:17:43,010
remove this will change property by

375
00:17:43,010 --> 00:17:47,660
setting it out and of course it's not

376
00:17:47,660 --> 00:17:52,340
supported in I am edge but you can use

377
00:17:52,340 --> 00:17:55,210
the fallback which is transform

378
00:17:55,210 --> 00:17:58,730
translate Freddie - we just add this as

379
00:17:58,730 --> 00:18:01,580
I said 3d transfer is also creating a

380
00:18:01,580 --> 00:18:04,010
new layer so it's kind of a hug but it

381
00:18:04,010 --> 00:18:06,500
works exactly the same as will change to

382
00:18:06,500 --> 00:18:10,880
be honest all right the next technique I

383
00:18:10,880 --> 00:18:12,680
wanted to say is more of a principle

384
00:18:12,680 --> 00:18:17,060
it's called flippity-flip States stands

385
00:18:17,060 --> 00:18:19,160
for first last inverted play and it's

386
00:18:19,160 --> 00:18:21,740
just what we were doing here so

387
00:18:21,740 --> 00:18:24,350
basically if you wanted to pull element

388
00:18:24,350 --> 00:18:27,020
from point A to B you don't push it by

389
00:18:27,020 --> 00:18:29,510
200 pixels to the right you first pull

390
00:18:29,510 --> 00:18:31,910
it 200 pixels to the left and then let

391
00:18:31,910 --> 00:18:34,760
it slide to its original position it

392
00:18:34,760 --> 00:18:36,590
could be implemented very easily with

393
00:18:36,590 --> 00:18:41,270
transforms as you can see just as in the

394
00:18:41,270 --> 00:18:44,120
example and if you would for example had

395
00:18:44,120 --> 00:18:47,990
some kind of many that's that we wanted

396
00:18:47,990 --> 00:18:50,000
to show in this way we would just

397
00:18:50,000 --> 00:18:52,760
position it absolutely then we would add

398
00:18:52,760 --> 00:18:55,190
some transform to move it out of the

399
00:18:55,190 --> 00:18:58,190
viewports add some transitions so it

400
00:18:58,190 --> 00:19:00,290
would slide not just show up in the

401
00:19:00,290 --> 00:19:03,380
place and add for example a class of

402
00:19:03,380 --> 00:19:06,260
active that when applied with just let

403
00:19:06,260 --> 00:19:08,090
the elements slide to its original

404
00:19:08,090 --> 00:19:12,500
position you might ask why would we do

405
00:19:12,500 --> 00:19:15,380
that like what's the point there is this

406
00:19:15,380 --> 00:19:18,350
100 milliseconds gap that happens in

407
00:19:18,350 --> 00:19:20,390
between the moment that the whole page

408
00:19:20,390 --> 00:19:22,610
is loaded and the moment that user is

409
00:19:22,610 --> 00:19:24,980
able to interact with your page it's

410
00:19:24,980 --> 00:19:27,590
just how our brains work we are not able

411
00:19:27,590 --> 00:19:29,809
to interact with

412
00:19:29,809 --> 00:19:32,929
and I think like on such short notice so

413
00:19:32,929 --> 00:19:34,879
we're taking advantage of this hundred

414
00:19:34,879 --> 00:19:38,059
milliseconds gap and even though it's

415
00:19:38,059 --> 00:19:40,399
like optimize we're using transforms

416
00:19:40,399 --> 00:19:42,409
there's still some small calculation

417
00:19:42,409 --> 00:19:44,989
that's browser needs to make to figure

418
00:19:44,989 --> 00:19:47,299
out where's the destination point of

419
00:19:47,299 --> 00:19:50,090
this elements and here if we first move

420
00:19:50,090 --> 00:19:52,190
element out and then let it slide or

421
00:19:52,190 --> 00:19:54,469
general original position then actually

422
00:19:54,469 --> 00:19:56,840
where we're having this animations than

423
00:19:56,840 --> 00:19:59,379
up front so the browser did the

424
00:19:59,379 --> 00:20:02,179
calculation this gap and when the user

425
00:20:02,179 --> 00:20:04,429
clicks on elements the change happens

426
00:20:04,429 --> 00:20:06,229
instantly the calculation doesn't have

427
00:20:06,229 --> 00:20:09,259
to be done in this moment so the flip

428
00:20:09,259 --> 00:20:11,450
technique actually can make a difference

429
00:20:11,450 --> 00:20:14,029
on less powerful devices and low-end

430
00:20:14,029 --> 00:20:16,429
phones so it's where where you should be

431
00:20:16,429 --> 00:20:20,149
using it also you should use it only for

432
00:20:20,149 --> 00:20:24,080
the animation that happens when when

433
00:20:24,080 --> 00:20:26,089
user interacts with our with our

434
00:20:26,089 --> 00:20:29,239
websites and there are free useful

435
00:20:29,239 --> 00:20:31,609
resources that you can use there is a

436
00:20:31,609 --> 00:20:34,729
flip J's library by Paul Lewis from

437
00:20:34,729 --> 00:20:37,609
Google there is my library that is

438
00:20:37,609 --> 00:20:39,769
actually a collection of examples how

439
00:20:39,769 --> 00:20:42,049
you can use it and there is a really

440
00:20:42,049 --> 00:20:44,599
good article by Paul Lewis who is

441
00:20:44,599 --> 00:20:46,460
actually a creator of the technique as

442
00:20:46,460 --> 00:20:52,070
well okay do you remember this this was

443
00:20:52,070 --> 00:20:54,200
how the browser went through all the

444
00:20:54,200 --> 00:20:55,849
steps to show the page to the browser to

445
00:20:55,849 --> 00:20:58,789
our user but actually it's just one

446
00:20:58,789 --> 00:21:02,419
frame and to have our animation looks

447
00:21:02,419 --> 00:21:05,330
smooth we should serve this frame every

448
00:21:05,330 --> 00:21:10,399
16 milliseconds why 16 milliseconds 60

449
00:21:10,399 --> 00:21:12,379
frames per second is what our browsers

450
00:21:12,379 --> 00:21:15,379
can do for for our animation so this is

451
00:21:15,379 --> 00:21:19,190
how fast we should be serving the frames

452
00:21:19,190 --> 00:21:21,529
to the user so that animation would look

453
00:21:21,529 --> 00:21:22,789
good

454
00:21:22,789 --> 00:21:24,710
one second is just thousand milliseconds

455
00:21:24,710 --> 00:21:27,109
and when we divide tiles and by 60 it

456
00:21:27,109 --> 00:21:30,830
gives us 16 milliseconds truth be told

457
00:21:30,830 --> 00:21:33,349
it should be more like 10 milliseconds

458
00:21:33,349 --> 00:21:36,589
because after after the browser goes

459
00:21:36,589 --> 00:21:38,119
through all the steps there are still

460
00:21:38,119 --> 00:21:40,580
some you know cleaning up to do but I

461
00:21:40,580 --> 00:21:41,980
don't want to scare us

462
00:21:41,980 --> 00:21:47,350
stay with 16 if we don't we if the

463
00:21:47,350 --> 00:21:50,100
browser fails to provide us with this

464
00:21:50,100 --> 00:21:53,410
frame every 16 milliseconds the

465
00:21:53,410 --> 00:21:56,950
animation will just look not smooth it

466
00:21:56,950 --> 00:21:59,080
will look junk like it there will be

467
00:21:59,080 --> 00:22:02,140
junk the user might feel that actually

468
00:22:02,140 --> 00:22:04,210
your application is not responding very

469
00:22:04,210 --> 00:22:07,419
well so now imagine that browser is

470
00:22:07,419 --> 00:22:09,490
trying to meet this 60 millisecond

471
00:22:09,490 --> 00:22:12,220
deadline it's already at layout part

472
00:22:12,220 --> 00:22:14,410
it's figuring out how how much space

473
00:22:14,410 --> 00:22:17,950
each element is going to take and then

474
00:22:17,950 --> 00:22:20,470
the JavaScript comes in like something

475
00:22:20,470 --> 00:22:22,299
needs to be changed so the browser needs

476
00:22:22,299 --> 00:22:24,040
to go through all the steps again like

477
00:22:24,040 --> 00:22:26,110
it needs to recalculate the styles and

478
00:22:26,110 --> 00:22:29,620
the layout again well things happen try

479
00:22:29,620 --> 00:22:33,610
to meet that in 16 milliseconds browser

480
00:22:33,610 --> 00:22:35,950
is probably going to miss the deadline

481
00:22:35,950 --> 00:22:38,110
and the frame is going to be lost

482
00:22:38,110 --> 00:22:41,410
animation will look terribly fortunately

483
00:22:41,410 --> 00:22:43,480
there is a thing that can help us with

484
00:22:43,480 --> 00:22:46,110
that and it's the requestanimationframe

485
00:22:46,110 --> 00:22:49,030
function finally is something like truly

486
00:22:49,030 --> 00:22:51,309
JavaScript e right

487
00:22:51,309 --> 00:22:54,010
what requestanimationframe does it's

488
00:22:54,010 --> 00:22:56,650
just it makes sure that all the

489
00:22:56,650 --> 00:23:00,270
JavaScript that is about to somehow

490
00:23:00,270 --> 00:23:03,850
influence the frame is going to come in

491
00:23:03,850 --> 00:23:06,040
in the first possible moment of each

492
00:23:06,040 --> 00:23:12,340
frame so this is how it works and it's

493
00:23:12,340 --> 00:23:14,950
quite easy to implement this is like the

494
00:23:14,950 --> 00:23:17,470
easiest case that we could have that we

495
00:23:17,470 --> 00:23:22,570
just we need to just fire this function

496
00:23:22,570 --> 00:23:25,030
with something that is about to be

497
00:23:25,030 --> 00:23:28,210
repeated and then recursively call the

498
00:23:28,210 --> 00:23:32,950
function from the inside and of course

499
00:23:32,950 --> 00:23:34,750
as with everything that's cool in the

500
00:23:34,750 --> 00:23:36,790
web there a requestanimationframe has

501
00:23:36,790 --> 00:23:39,549
some rules it needs to vendor prefixes

502
00:23:39,549 --> 00:23:41,679
and it needs polyfill for the

503
00:23:41,679 --> 00:23:45,429
less-fortunate browsers fortunately

504
00:23:45,429 --> 00:23:47,830
polyfill takes care of vendor prefixes

505
00:23:47,830 --> 00:23:49,360
so if you're using polyfill you don't

506
00:23:49,360 --> 00:23:50,740
have to care about that

507
00:23:50,740 --> 00:23:54,460
also if you're using green sock or

508
00:23:54,460 --> 00:23:56,980
web animation API or jQuery free bundle

509
00:23:56,980 --> 00:23:59,200
and hire you also don't have to remember

510
00:23:59,200 --> 00:24:01,150
about requestanimationframe because it's

511
00:24:01,150 --> 00:24:04,810
already there it's inside inside these

512
00:24:04,810 --> 00:24:07,810
tools there is canceled animation frame

513
00:24:07,810 --> 00:24:10,390
which is like complementary function

514
00:24:10,390 --> 00:24:12,520
that will just stop your animation from

515
00:24:12,520 --> 00:24:16,690
happening and it's way better than using

516
00:24:16,690 --> 00:24:19,030
set interval actually set interval is

517
00:24:19,030 --> 00:24:22,660
what what is in the polyfill but browser

518
00:24:22,660 --> 00:24:26,740
doesn't optimize for first set interval

519
00:24:26,740 --> 00:24:29,050
it doesn't take that interval into

520
00:24:29,050 --> 00:24:30,970
consideration when it's scheduling up

521
00:24:30,970 --> 00:24:34,540
the frame and setting the role is just

522
00:24:34,540 --> 00:24:37,030
guessing that in next 16 milliseconds

523
00:24:37,030 --> 00:24:38,830
then your frame will happen but if

524
00:24:38,830 --> 00:24:41,170
something offsets and goes wrong is

525
00:24:41,170 --> 00:24:46,600
still much mr. frame and the last thing

526
00:24:46,600 --> 00:24:49,090
I wanted to say to you about it is to

527
00:24:49,090 --> 00:24:50,980
test your animations before actually

528
00:24:50,980 --> 00:24:53,680
optimizing because things that you think

529
00:24:53,680 --> 00:24:55,720
might actually be needed for your

530
00:24:55,720 --> 00:24:59,170
animation might might make it worse and

531
00:24:59,170 --> 00:25:01,360
things that should be smooth might

532
00:25:01,360 --> 00:25:03,670
actually not work very well so test your

533
00:25:03,670 --> 00:25:06,040
test your animations and of course the

534
00:25:06,040 --> 00:25:09,760
best thing to the to do testing is to

535
00:25:09,760 --> 00:25:12,520
use dev tools both in Chrome and in

536
00:25:12,520 --> 00:25:16,020
Firefox at least that's what I'm using

537
00:25:16,020 --> 00:25:19,030
for example in Chrome it can enable the

538
00:25:19,030 --> 00:25:22,060
rendering top you need to click this

539
00:25:22,060 --> 00:25:24,400
free small dot menu and just in more

540
00:25:24,400 --> 00:25:26,110
tools you have friends ring tab and all

541
00:25:26,110 --> 00:25:28,780
the cool things and then you'll be able

542
00:25:28,780 --> 00:25:31,180
to actually see for example where the

543
00:25:31,180 --> 00:25:34,210
layer borders are to see paint flashing

544
00:25:34,210 --> 00:25:37,210
or you can see the FPS meter or any

545
00:25:37,210 --> 00:25:39,250
strong performance issues that you could

546
00:25:39,250 --> 00:25:44,560
have also you can use the timeline tool

547
00:25:44,560 --> 00:25:46,570
to record your animation the shorter

548
00:25:46,570 --> 00:25:48,040
they're recording the better because

549
00:25:48,040 --> 00:25:49,810
it's easier to investigate what's going

550
00:25:49,810 --> 00:25:54,340
on if you have the green small blocks at

551
00:25:54,340 --> 00:25:56,230
the top it means that your animation is

552
00:25:56,230 --> 00:26:00,250
actually smooth then there are like

553
00:26:00,250 --> 00:26:03,130
really new shiny tools there like to

554
00:26:03,130 --> 00:26:05,110
things that I just discovered like month

555
00:26:05,110 --> 00:26:06,870
ago that they're there

556
00:26:06,870 --> 00:26:10,919
layers tab which shows you why every

557
00:26:10,919 --> 00:26:13,440
layer in the website was created it says

558
00:26:13,440 --> 00:26:15,570
for example that is the root layer or

559
00:26:15,570 --> 00:26:18,570
it's it's the layer is because it's on

560
00:26:18,570 --> 00:26:20,789
top of other layer or it's because it's

561
00:26:20,789 --> 00:26:23,940
animated transform it's really really

562
00:26:23,940 --> 00:26:26,640
useful thing and there is the new

563
00:26:26,640 --> 00:26:29,760
animation tab in in chrome that lets see

564
00:26:29,760 --> 00:26:32,549
for example run your animation so we're

565
00:26:32,549 --> 00:26:36,860
just record it and investigate it too

566
00:26:36,870 --> 00:26:40,440
Firefox also has animation step and it's

567
00:26:40,440 --> 00:26:44,639
also very similar but it was there first

568
00:26:44,639 --> 00:26:47,340
as well you can run your animation bit

569
00:26:47,340 --> 00:26:50,250
slower or you can if you if you inspect

570
00:26:50,250 --> 00:26:52,320
an animated element it will show you if

571
00:26:52,320 --> 00:26:54,570
it's optimized by this small lightning

572
00:26:54,570 --> 00:26:57,360
bolt icon next to it or if it's not

573
00:26:57,360 --> 00:26:59,429
optimized it will give you a warning

574
00:26:59,429 --> 00:27:01,440
what's going on in there why it's not

575
00:27:01,440 --> 00:27:07,139
why it's not okay so to sum up please

576
00:27:07,139 --> 00:27:09,720
don't overuse animations if they are not

577
00:27:09,720 --> 00:27:11,340
going to help your user and they are

578
00:27:11,340 --> 00:27:13,559
just there for your pleasure of the or

579
00:27:13,559 --> 00:27:16,200
the pleasure of a designer try to skip

580
00:27:16,200 --> 00:27:19,980
them not make the user feel the junk

581
00:27:19,980 --> 00:27:23,399
junk eNOS of Europe animate only

582
00:27:23,399 --> 00:27:25,889
transforms and opacity because they are

583
00:27:25,889 --> 00:27:28,289
the most performance in that way try to

584
00:27:28,289 --> 00:27:30,809
take leverage of will change flip and

585
00:27:30,809 --> 00:27:34,549
request animation frame wins applicable

586
00:27:34,549 --> 00:27:37,740
don't overuse layers don't overuse the

587
00:27:37,740 --> 00:27:40,679
wheel change property test your

588
00:27:40,679 --> 00:27:44,370
animations animates elements that are on

589
00:27:44,370 --> 00:27:46,769
top layers don't animate things that are

590
00:27:46,769 --> 00:27:49,110
behind something because it will make

591
00:27:49,110 --> 00:27:52,950
all the things up on them to be create

592
00:27:52,950 --> 00:27:58,049
like to go to the other layers and yeah

593
00:27:58,049 --> 00:28:00,659
test animations before optimizing the

594
00:28:00,659 --> 00:28:03,539
most important one here are some

595
00:28:03,539 --> 00:28:05,789
resources I'll post the slides after

596
00:28:05,789 --> 00:28:08,870
this talk maybe tomorrow we'll see and

597
00:28:08,870 --> 00:28:12,659
thank you very much

