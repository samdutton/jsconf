<section>
<p><span data-start="9.469" data-end="13.23">alright so you know this is the theme of</span> <span data-start="13.23" data-end="15.66">my talk and I like to start off with the</span> <span data-start="15.66" data-end="17.25">subtitle is why you know give me one</span> <span data-start="17.25" data-end="21.119">point though and when I when I say that</span> <span data-start="21.119" data-end="22.83">I guess I'm just really talking about</span> <span data-start="22.83" data-end="26.07">how do we stabilize something that is by</span> <span data-start="26.07" data-end="28.23">definition unstable right how many</span> <span data-start="28.23" data-end="30.33">people are familiar with Denver a little</span> <span data-start="30.33" data-end="33.78">bit heard of it that is way too few of</span> <span data-start="33.78" data-end="35.88">you that is unacceptable sember org you</span> <span data-start="35.88" data-end="38.1">all have laptops right now because the</span> <span data-start="38.1" data-end="39.84">fact that it is zero point four point</span> <span data-start="39.84" data-end="42.48">zero means that it is unstable anything</span> <span data-start="42.48" data-end="43.89">could change at any time the fact that</span> <span data-start="43.89" data-end="45.989">we have you know stable releases and</span> <span data-start="45.989" data-end="47.52">unstable releases just something nice</span> <span data-start="47.52" data-end="49.92">that ride does for us but it could just</span> <span data-start="49.92" data-end="52.289">change it anytime and so how do you deal</span> <span data-start="52.289" data-end="54.239">with that it's actually a complicated</span> <span data-start="54.239" data-end="56.64">problem let's start kind of small a</span> <span data-start="56.64" data-end="59.1">couple of I don't know caveats that I've</span> <span data-start="59.1" data-end="61.23">seen in terms of code usage that comes</span> <span data-start="61.23" data-end="63.6">up on the mailing list a lot and things</span> <span data-start="63.6" data-end="66.03">you should just generally not do right</span> <span data-start="66.03" data-end="69.42">or should do and just do them right this</span> <span data-start="69.42" data-end="71.189">is a great example right like oh if</span> <span data-start="71.189" data-end="72.33">something goes wrong I want to know</span> <span data-start="72.33" data-end="74.52">about it I want to say hey we're just</span> <span data-start="74.52" data-end="75.81">going to log that error I think that's</span> <span data-start="75.81" data-end="78.15">been a common theme overall today is</span> <span data-start="78.15" data-end="80.61">logging but the problem here is that</span> <span data-start="80.61" data-end="82.38">you're not exiting the process right</span> <span data-start="82.38" data-end="84.18">it's just like oh yeah no no did</span> <span data-start="84.18" data-end="86.22">something wrong and it'll probably work</span> <span data-start="86.22" data-end="88.71">itself out no it is not going to work</span> <span data-start="88.71" data-end="91.619">itself out you need to say stop exit</span> <span data-start="91.619" data-end="93.93">time restart the process all right let</span> <span data-start="93.93" data-end="95.97">everything reset it's important remember</span> <span data-start="95.97" data-end="100.02">this and so you really need to listen</span> <span data-start="100.02" data-end="102.39">for these errors and this is this</span> <span data-start="102.39" data-end="103.89">actually from the docs I mean how many</span> <span data-start="103.89" data-end="105.38">people have seen this snippet of code</span> <span data-start="105.38" data-end="108.06">you all should be raising your hands</span> <span data-start="108.06" data-end="110.79">okay that's sad but it's all right I'll</span> <span data-start="110.79" data-end="113.399">forgive you the thing is that there's</span> <span data-start="113.399" data-end="117.18">actually sort of a sneaky sneaky error</span> <span data-start="117.18" data-end="119.1">that's not trapped here and you would</span> <span data-start="119.1" data-end="121.32">probably see this in your code if you</span> <span data-start="121.32" data-end="123.36">use this in production and the reason</span> <span data-start="123.36" data-end="125.04">for that is that the underlying socket</span> <span data-start="125.04" data-end="127.02">can throw errors and that error will be</span> <span data-start="127.02" data-end="130.379">bubbled up to the request and so I will</span> <span data-start="130.379" data-end="132.03">give a node jitsu beta account to the</span> <span data-start="132.03" data-end="133.18">first person who changed</span> <span data-start="133.18" data-end="135.549">usage to this which is that you should</span> <span data-start="135.549" data-end="137.68">have the error event handler there and</span> <span data-start="137.68" data-end="139.93">if you don't believe me why I have the</span> <span data-start="139.93" data-end="143.319">source code line cited so I'm not</span> <span data-start="143.319" data-end="145.599">kidding and these are just sneaky things</span> <span data-start="145.599" data-end="148">right I think forgot who said it today</span> <span data-start="148" data-end="149.59">but it just just said assume you're</span> <span data-start="149.59" data-end="151.719">and that's totally true like you</span> <span data-start="151.719" data-end="153.189">and that's totally true like you never know what's going to go on I</span> <span data-start="153.189" data-end="156.28">solutely seen Ryan matt raney debugging</span> <span data-start="156.28" data-end="158.53">assess Scylla all week and like you just</span> <span data-start="158.53" data-end="160.06">never know the socket could just be like</span> <span data-start="160.06" data-end="161.53">oh you know the colonel just decided to</span> <span data-start="161.53" data-end="163.51">panic it's not notes fault but you got</span> <span data-start="163.51" data-end="167.62">to handle it next big one is event</span> <span data-start="167.62" data-end="169.84">emitters I mean a vented programming is</span> <span data-start="169.84" data-end="171.73">great but it's really dangerous and</span> <span data-start="171.73" data-end="174.549">we've seen this pop up a few times in a</span> <span data-start="174.549" data-end="175.959">library that we have written and</span> <span data-start="175.959" data-end="178.239">maintained for the last year called node</span> </p>
<p><span data-start="178.239" data-end="181">HTTP proxy that's a pretty full featured</span> <span data-start="181" data-end="182.919">reverse proxy and node kind of like the</span> <span data-start="182.919" data-end="186.25">sweet spot for fast asynchronous i/o but</span> <span data-start="186.25" data-end="187.51">the problem with that is that if you</span> <span data-start="187.51" data-end="189.969">start listening to events and don't</span> <span data-start="189.969" data-end="192.7">remove those listeners eventually you're</span> <span data-start="192.7" data-end="194.109">going to have some leaks and that's not</span> <span data-start="194.109" data-end="196.419">good right thankfully node will warn you</span> <span data-start="196.419" data-end="198.01">about this so maybe you'll see something</span> <span data-start="198.01" data-end="201.04">like this and by the way this this is</span> <span data-start="201.04" data-end="203.47">fixed so don't be afraid and you should</span> <span data-start="203.47" data-end="208.359">also upgrade to 5x so let's let's say we</span> <span data-start="208.359" data-end="209.949">had some code like this right you want</span> <span data-start="209.949" data-end="211.479">to do something and then notify the</span> <span data-start="211.479" data-end="215.47">person that you're done normal naive</span> <span data-start="215.47" data-end="217.72">approach would just say ok when I'm done</span> <span data-start="217.72" data-end="220.449">call this function but why are you using</span> <span data-start="220.449" data-end="223.09">dot on right event cardinality is</span> <span data-start="223.09" data-end="225.37">important if you're only expecting one</span> <span data-start="225.37" data-end="229.9">done event then only do this once right</span> <span data-start="229.9" data-end="231.759">and this gets important when you start</span> <span data-start="231.759" data-end="233.68">to think about closure scope because if</span> <span data-start="233.68" data-end="235.599">you're using something in the scope of</span> <span data-start="235.599" data-end="239.229">the callback and that event emitter that</span> <span data-start="239.229" data-end="241.389">event handler is never removed then that</span> <span data-start="241.389" data-end="243.639">can never be free because it still needs</span> <span data-start="243.639" data-end="246.43">to be kept around to maybe be used in</span> <span data-start="246.43" data-end="247.72">that function that will never be called</span> <span data-start="247.72" data-end="250.659">later on right seeing a lot of blank</span> <span data-start="250.659" data-end="252.37">stares I'm hoping I'm hoping this gets</span> <span data-start="252.37" data-end="257.199">through maybe not use a process monitor</span> <span data-start="257.199" data-end="259.359">you know I think most people do this</span> <span data-start="259.359" data-end="261.94">probably monitor upstart I wrote this</span> <span data-start="261.94" data-end="263.95">thing called forever that people use I</span> <span data-start="263.95" data-end="264.96">think I hope</span> </p>
<p><span data-start="264.96" data-end="268.41">I use it and you just start it and when</span> <span data-start="268.41" data-end="270.36">your app crashes you can restart it and</span> <span data-start="270.36" data-end="271.919">that's why that first slide that I</span> <span data-start="271.919" data-end="273.69">showed where you just eagerly exit the</span> <span data-start="273.69" data-end="276.12">process makes sense because I gots not a</span> <span data-start="276.12" data-end="277.949">big deal we're going to restart you</span> <span data-start="277.949" data-end="279.81">probably have your application states to</span> <span data-start="279.81" data-end="281.22">realize to some sort of remote database</span> <span data-start="281.22" data-end="284.13">like Redis or a file maybe if you're not</span> <span data-start="284.13" data-end="287.61">feeling that adventurous and you know</span> <span data-start="287.61" data-end="291.3">just do it and stabilize your</span> <span data-start="291.3" data-end="292.77">dependencies and this is this is a great</span> <span data-start="292.77" data-end="294.33">topic this has come up a couple of times</span> <span data-start="294.33" data-end="295.979">today I know Isaac talked about it and</span> <span data-start="295.979" data-end="298.229">this is kind of the power of node conf</span> <span data-start="298.229" data-end="299.49">this is stuff that I learned in the last</span> <span data-start="299.49" data-end="301.289">like 48 hours like I've actually been</span> <span data-start="301.289" data-end="303.99">doing this wrong for the last year up</span> <span data-start="303.99" data-end="307.56">until two days ago and the reason that</span> <span data-start="307.56" data-end="309.03">you want to stabilize your dependencies</span> <span data-start="309.03" data-end="310.91">is so you don't see things like this so</span> <span data-start="310.91" data-end="313.11">okay I have it installed on my local</span> <span data-start="313.11" data-end="314.759">machine and then I push your production</span> <span data-start="314.759" data-end="316.289">and whoops I forgot to put it in my</span> <span data-start="316.289" data-end="318.99">package about JSON and okay that's</span> <span data-start="318.99" data-end="321.09">whoops ok now it's not installed on my</span> <span data-start="321.09" data-end="322.8">production box and you know you start it</span> <span data-start="322.8" data-end="324.15">up with forever and all of a sudden you</span> <span data-start="324.15" data-end="325.62">see it's spin restarting because you</span> <span data-start="325.62" data-end="326.97">just don't have that module installed</span> <span data-start="326.97" data-end="329.789">and this local installation doesn't</span> <span data-start="329.789" data-end="331.83">solve this because the workflow that I</span> <span data-start="331.83" data-end="333.36">see it from a lot of people as they will</span> <span data-start="333.36" data-end="335.28">say hey I'm going to require this module</span> </p>
<p><span data-start="335.28" data-end="336.84">I'm going to try and run my program oh</span> <span data-start="336.84" data-end="339.03">my program doesn't run I'm not going to</span> <span data-start="339.03" data-end="341.07">do the smart thing and go update my</span> <span data-start="341.07" data-end="344.009">package.json and then use NPM install to</span> <span data-start="344.009" data-end="345.63">install it from there I'm just going to</span> <span data-start="345.63" data-end="347.55">do NPM install package name and not</span> <span data-start="347.55" data-end="350.039">update the relative dependencies in my</span> <span data-start="350.039" data-end="353.039">package.json and that's exactly why we</span> <span data-start="353.039" data-end="355.199">wrote this tool and so what this will do</span> <span data-start="355.199" data-end="357.169">is it will spawn up your child process</span> <span data-start="357.169" data-end="359.82">for your application figure out what the</span> <span data-start="359.82" data-end="361.68">dependencies are and update them for you</span> <span data-start="361.68" data-end="363.719">so this one's actually pretty neat</span> <span data-start="363.719" data-end="365.849">pretty useful but there's actually one</span> <span data-start="365.849" data-end="367.71">problem with this and it's a problem</span> <span data-start="367.71" data-end="370.08">that i found on the last 48 hours that</span> <span data-start="370.08" data-end="372.15">happens to be the dependencies that have</span> <span data-start="372.15" data-end="374.789">been listed here and i'm not even going</span> <span data-start="374.789" data-end="376.259">to ask for a show of hands here because</span> </p>
<p><span data-start="376.259" data-end="377.909">I didn't even know for two days ago so</span> <span data-start="377.909" data-end="379.59">the problem here is that I'm being</span> <span data-start="379.59" data-end="383.719">really really conservative and for a</span> <span data-start="383.719" data-end="386.159">ecosystem that moves as fast as the node</span> <span data-start="386.159" data-end="388.05">dutchess community you can't be this</span> <span data-start="388.05" data-end="390.69">conservative I'm saying I only want zero</span> <span data-start="390.69" data-end="392.759">point zero point three that's it nothing</span> <span data-start="392.759" data-end="394.11">nothing greater than that nothing</span> <span data-start="394.11" data-end="396.5">less than that has to be that version</span> <span data-start="396.5" data-end="398.67">alternatively you could be really really</span> <span data-start="398.67" data-end="401.13">optimistic and say anything greater than</span> <span data-start="401.13" data-end="402.75">or equal to zero point zero point three</span> <span data-start="402.75" data-end="404.97">neither of those are a really good</span> <span data-start="404.97" data-end="407.34">middle ground because you need to figure</span> <span data-start="407.34" data-end="409.89">out what semantic versioning really</span> <span data-start="409.89" data-end="412.11">means and so let's take a look at this</span> <span data-start="412.11" data-end="414">this is the incorrect way that I have</span> <span data-start="414" data-end="415.2">done this on every single one of my</span> <span data-start="415.2" data-end="417.15">modules or not necessarily incorrect</span> <span data-start="417.15" data-end="420.39">just overly optimistic and so you know</span> <span data-start="420.39" data-end="422.22">if one of these gets updated to say hits</span> <span data-start="422.22" data-end="423.36">a one point oh and there's a breaking</span> </p>
<p><span data-start="423.36" data-end="425.31">API a change in here you're not going to</span> <span data-start="425.31" data-end="426.87">know if you're going to deploy to</span> <span data-start="426.87" data-end="428.88">production and have five or six</span> <span data-start="428.88" data-end="430.83">application servers running that may</span> <span data-start="430.83" data-end="432.18">have been started up at different</span> <span data-start="432.18" data-end="434.13">periods of time they may have different</span> <span data-start="434.13" data-end="435.99">versions of that dependency installed on</span> <span data-start="435.99" data-end="438.06">each server if you do this and that's</span> <span data-start="438.06" data-end="439.74">really dangerous because you're back oh</span> <span data-start="439.74" data-end="442.23">I have six servers and now one in six</span> <span data-start="442.23" data-end="444.18">connections is failing and I don't know</span> <span data-start="444.18" data-end="445.62">why and i'm just going to log into the</span> <span data-start="445.62" data-end="447.84">first server i feel like and say oh the</span> <span data-start="447.84" data-end="449.07">dependency is installed here in the</span> <span data-start="449.07" data-end="450.99">correct one it's just not that easy what</span> <span data-start="450.99" data-end="453.63">you should be doing is this I was doing</span> <span data-start="453.63" data-end="456.84">it wrong do you you should be doing this</span> <span data-start="456.84" data-end="459.87">the X indicates that you will accept any</span> <span data-start="459.87" data-end="462.57">version of up to the greatest version at</span> <span data-start="462.57" data-end="465.63">that minor version level so in semantic</span> <span data-start="465.63" data-end="468.72">versioning your major minor patch the</span> <span data-start="468.72" data-end="471.09">second X or start of the last x is patch</span> <span data-start="471.09" data-end="473.1">versions so I basically say I know</span> <span data-start="473.1" data-end="474.72">there'll be no breaking changes in patch</span> <span data-start="474.72" data-end="476.88">versions that's by definition defined in</span> <span data-start="476.88" data-end="479.31">cember and I'm just going to accept any</span> <span data-start="479.31" data-end="480.66">of those but if there's anything greater</span> <span data-start="480.66" data-end="483.09">than that like a 0.24 eyes for example</span> <span data-start="483.09" data-end="485.82">not going to accept that because there</span> <span data-start="485.82" data-end="487.26">might be a breaking change in there and</span> </p>
<p><span data-start="487.26" data-end="488.73">I'm running this in production and that</span> <span data-start="488.73" data-end="491.28">could be really really dangerous but for</span> <span data-start="491.28" data-end="493.02">something like colors which has a</span> <span data-start="493.02" data-end="495.3">ridiculously simple API which is never</span> <span data-start="495.3" data-end="497.73">going to change and those major versions</span> <span data-start="497.73" data-end="499.74">or minor versions rather probably won't</span> <span data-start="499.74" data-end="501.99">affect the core API that I use I'm going</span> <span data-start="501.99" data-end="503.76">to be a little bit more optimistic there</span> <span data-start="503.76" data-end="505.29">and say I'm going to accept anything up</span> <span data-start="505.29" data-end="509.22">to a major version release</span> <span data-start="509.23" data-end="512.229">so just a little bit Isaac talked about</span> <span data-start="512.229" data-end="513.49">this earlier today you really should</span> <span data-start="513.49" data-end="514.72">just pop in and start playing with</span> <span data-start="514.72" data-end="517.27">sember it's really helpful really you</span> <span data-start="517.27" data-end="519.1">know package managers and package</span> <span data-start="519.1" data-end="520.39">writers out there you should know about</span> <span data-start="520.39" data-end="521.979">this and you should think about this</span> <span data-start="521.979" data-end="523.72">when you're determining versions for</span> <span data-start="523.72" data-end="525.16">your packages you know there are</span> <span data-start="525.16" data-end="527.5">nineteen hundred packages on NPM I</span> <span data-start="527.5" data-end="529.21">wonder how many of them are version</span> <span data-start="529.21" data-end="531.01">correctly considering the fact that like</span> <span data-start="531.01" data-end="532.72">my twenty were not versioned right and</span> </p>
<p><span data-start="532.72" data-end="535.29">I've been trying to do write her a year</span> <span data-start="535.29" data-end="539.41">so play with it use it love it let's</span> <span data-start="539.41" data-end="543.04">have better versioning find the best</span> <span data-start="543.04" data-end="544.87">tool for the job so this is kind of a</span> <span data-start="544.87" data-end="546.07">mini announcement we're going to be</span> <span data-start="546.07" data-end="547.42">putting this on all the projects that we</span> <span data-start="547.42" data-end="550.54">maintain later this week and so I think</span> <span data-start="550.54" data-end="552.64">it was Paul kerna who said earlier today</span> <span data-start="552.64" data-end="554.74">that you know be where the single module</span> <span data-start="554.74" data-end="557.23">authors you know that I'm just learning</span> <span data-start="557.23" data-end="559.42">node module authors it's not bad I'm</span> <span data-start="559.42" data-end="561.49">really happy that you're learning node</span> <span data-start="561.49" data-end="564.31">but just be aware that if that author</span> <span data-start="564.31" data-end="566.08">disappears or decides they don't like</span> <span data-start="566.08" data-end="567.88">node and goes back to PHP you're</span> <span data-start="567.88" data-end="570.31">maintaining that but anything that you</span> <span data-start="570.31" data-end="572.53">see with this seal we maintain I stay up</span> <span data-start="572.53" data-end="573.88">till six in the morning fixing that's</span> <span data-start="573.88" data-end="576.01">eastern time so you know now you know</span> <span data-start="576.01" data-end="580.6">why I am structure your code this came</span> <span data-start="580.6" data-end="583.93">up i think in md's talk one of the great</span> <span data-start="583.93" data-end="585.37">things about node is that it doesn't</span> <span data-start="585.37" data-end="588.19">enforce any code structure for you but</span> <span data-start="588.19" data-end="589.81">you really need to think about it this</span> <span data-start="589.81" data-end="591.79">is a pretty common template that i use</span> <span data-start="591.79" data-end="593.11">for most of my libraries and</span> <span data-start="593.11" data-end="595.18">applications you've got some sort of</span> <span data-start="595.18" data-end="596.83">tooling and your bin folder you've got</span> <span data-start="596.83" data-end="599.56">some sort of configuration / environment</span> <span data-start="599.56" data-end="602.2">you have some sort of lib maybe some</span> <span data-start="602.2" data-end="605.05">static files tests i do do integration</span> <span data-start="605.05" data-end="609.7">testing sorry Felix and then of course</span> <span data-start="609.7" data-end="612.34">any sort of sub modules you have there</span> <span data-start="612.34" data-end="613.75">of course some people are starting to</span> <span data-start="613.75" data-end="616">put things in node underscore modules as</span> <span data-start="616" data-end="619.15">per NPM one point oh that's something</span> <span data-start="619.15" data-end="621.31">that's still kind of experimentation I</span> <span data-start="621.31" data-end="623.44">some people do it I don't do it it could</span> <span data-start="623.44" data-end="626.2">be a good thing to do moving on but he</span> <span data-start="626.2" data-end="630.67">did just release that this week I decide</span> <span data-start="630.67" data-end="633.52">on a network architecture and what do I</span> <span data-start="633.52" data-end="635.77">mean by that if you're running something</span> <span data-start="635.77" data-end="638.32">that can run on one machine you probably</span> <span data-start="638.32" data-end="640.83">want to use cluster</span> <span data-start="640.83" data-end="643.11">and what that does is it uses shield</span> <span data-start="643.11" data-end="645.96">shared file descriptors to you know</span> <span data-start="645.96" data-end="648.36">basically open up a socket pass that to</span> <span data-start="648.36" data-end="650.64">the STD end of any child process this</span> <span data-start="650.64" data-end="654.15">has come up a few times today cluster</span> <span data-start="654.15" data-end="656.1">seems to be the best implementation of</span> <span data-start="656.1" data-end="658.08">it out there right now spark obviously</span> <span data-start="658.08" data-end="660.75">was the predecessor which still is a</span> <span data-start="660.75" data-end="663.3">good example in code reading you know</span> </p>
<p><span data-start="663.3" data-end="665.58">RTF see we're all here at a dev</span> <span data-start="665.58" data-end="669.72">conference the other one is to do some</span> <span data-start="669.72" data-end="672.51">sort of proxying and you know this is</span> <span data-start="672.51" data-end="674.67">what we do it no Jitsu this is an</span> <span data-start="674.67" data-end="677.45">extremely simple round-robin proxy</span> <span data-start="677.45" data-end="679.17">that's one of the great things about</span> <span data-start="679.17" data-end="682.5">node because this request handler in the</span> </p>
<p><span data-start="682.5" data-end="685.59">HTTP proxy creates or actually runs</span> <span data-start="685.59" data-end="687.3">synchronously right so you can just pop</span> <span data-start="687.3" data-end="688.89">it off and put it back on and you can be</span> <span data-start="688.89" data-end="691.11">assured that there is order here so you</span> <span data-start="691.11" data-end="692.37">know you're going to remove it and then</span> <span data-start="692.37" data-end="693.93">always add it to the end so there's no</span> <span data-start="693.93" data-end="695.07">need to worry about any sort of</span> <span data-start="695.07" data-end="696.51">threading or things like that you just</span> <span data-start="696.51" data-end="699.06">say remove it proxy to it put it back on</span> <span data-start="699.06" data-end="701.64">there and just cycle that set of servers</span> <span data-start="701.64" data-end="705.21">overall now you know what if there was</span> <span data-start="705.21" data-end="707.52">just some tool out there that did all of</span> <span data-start="707.52" data-end="709.71">this for you I mean wouldn't that be</span> <span data-start="709.71" data-end="715.71">great there's more so we have been</span> <span data-start="715.71" data-end="718.13">working on hibu for about a year now and</span> <span data-start="718.13" data-end="721.35">I'm pretty excited to announce that we</span> <span data-start="721.35" data-end="724.29">are releasing it today so what is it</span> <span data-start="724.29" data-end="727.41">right it is an application server for</span> <span data-start="727.41" data-end="730.41">nodejs that's based on the package JSON</span> <span data-start="730.41" data-end="734.13">format and so let's run through a little</span> <span data-start="734.13" data-end="737.94">demo so essentially it's two servers</span> <span data-start="737.94" data-end="740.04">right you have a basically the high</span> <span data-start="740.04" data-end="741.33">boost server which i'm going to start up</span> <span data-start="741.33" data-end="745.17">first after i do this so that's going to</span> <span data-start="745.17" data-end="746.61">run and i'm not going to show you a port</span> <span data-start="746.61" data-end="748.41">it's running on so nobody tries and gets</span> <span data-start="748.41" data-end="752.16">me over the network and everybody read</span> <span data-start="752.16" data-end="755.73">this is that good okay good great so</span> <span data-start="755.73" data-end="757.89">what this does is that this will respond</span> <span data-start="757.89" data-end="761.55">to incoming requests for a rest api if</span> <span data-start="761.55" data-end="762.99">anybody went to the cast talk today i</span> <span data-start="762.99" data-end="764.31">think there's definitely some overlap</span> <span data-start="764.31" data-end="766.44">there but we're definitely focused on</span> <span data-start="766.44" data-end="768.45">just note and not supporting everything</span> <span data-start="768.45" data-end="770.73">else so that gives us some flexibility</span> <span data-start="770.73" data-end="772.8">in that we can just say we only support</span> <span data-start="772.8" data-end="774.209">package.json formats</span> <span data-start="774.209" data-end="779.679">and so what would one of those look like</span> <span data-start="779.689" data-end="784.559">and so let's jump into an example is</span> <span data-start="784.559" data-end="787.92">this Oh drat I changed everything else</span> <span data-start="787.92" data-end="792.389">except for this sorry basic I don't even</span> <span data-start="792.389" data-end="795.839">know another one classic there we go so</span> <span data-start="795.839" data-end="797.999">here's a pretty simple package.json</span> <span data-start="797.999" data-end="801.48">right it has some sort of repository I</span> <span data-start="801.48" data-end="803.16">think this is actually the simplest node</span> <span data-start="803.16" data-end="804.749">application on the planet if you go to</span> <span data-start="804.749" data-end="807.3">it but it has a good package.json with</span> <span data-start="807.3" data-end="810.449">proper versions so essentially we're</span> <span data-start="810.449" data-end="812.879">going to say hey now that I want the API</span> <span data-start="812.879" data-end="815.069">client for hi boo on oh now you know my</span> <span data-start="815.069" data-end="819.089">port drat and I'm going to say hey I</span> <span data-start="819.089" data-end="820.8">want to start this application right</span> <span data-start="820.8" data-end="832.319">let's do that yes okay yeah its bond</span> <span data-start="832.319" data-end="834.929">okay and so you can sort of see from</span> <span data-start="834.929" data-end="836.97">this example that its bonds it using</span> <span data-start="836.97" data-end="838.499">forever so that means if it goes down</span> <span data-start="838.499" data-end="839.97">it's going to restart it and does all</span> <span data-start="839.97" data-end="842.069">that process management for you it</span> <span data-start="842.069" data-end="844.199">spawns it on a unique port for that IP</span> <span data-start="844.199" data-end="847.799">so you always have things isolated and</span> <span data-start="847.799" data-end="849.569">then you can actually start this up</span> <span data-start="849.569" data-end="851.519">again right so now I have two of these</span> <span data-start="851.519" data-end="853.47">things running now i have three of these</span> <span data-start="853.47" data-end="855.449">things running all from the same call</span> <span data-start="855.449" data-end="857.939">and you know now that i have them</span> <span data-start="857.939" data-end="859.799">running i might actually want to access</span> <span data-start="859.799" data-end="863.309">them and to do that I need to run the</span> <span data-start="863.309" data-end="865.98">load balancer and this uses a modified</span> <span data-start="865.98" data-end="868.499">version of the very simple load balancer</span> <span data-start="868.499" data-end="870.509">script that I show you before and this</span> <span data-start="870.509" data-end="874.29">will all be released in about nine</span> <span data-start="874.29" data-end="877.17">minutes so now the balance is running</span> <span data-start="877.17" data-end="880.649">and as we can see the domain of this</span> <span data-start="880.649" data-end="883.439">particular application happens to be dev</span> <span data-start="883.439" data-end="888.36">jitsu and what I have in my etsy hosts</span> <span data-start="888.36" data-end="892.87">file</span> <span data-start="892.88" data-end="897.42">is that I have a bunch of dev ji to</span> <span data-start="897.42" data-end="899.459">stuff set up so I'm just going to hit</span> <span data-start="899.459" data-end="903.33">one of those sites and I'm going to see</span> <span data-start="903.33" data-end="906.779">my app right good stuff but now I may</span> <span data-start="906.779" data-end="916.529">want to later on stop my app so I'm</span> <span data-start="916.529" data-end="930.71">going to stop my app right now</span> <span data-start="930.72" data-end="933.19">and now it stopped</span> <span data-start="933.19" data-end="941.17">well maybe it's not do it live and now</span> <span data-start="941.17" data-end="950.23">it started so Oh three two one file</span> <span data-start="950.23" data-end="953.02">descriptor reload now it's tough uses a</span> <span data-start="953.02" data-end="955.21">file watcher so it takes a split second</span> <span data-start="955.21" data-end="957.43">it could easily plugged out to use Redis</span> <span data-start="957.43" data-end="959.95">and be much faster so yeah we just</span> <span data-start="959.95" data-end="962.44">stopped a node.js application and</span> <span data-start="962.44" data-end="964.9">restart it and did all that stuff little</span> <span data-start="964.9" data-end="967.06">known fact in the node community is that</span> </p>
<p><span data-start="967.06" data-end="968.41">I actually wrote the programmatic</span> <span data-start="968.41" data-end="971.05">support for NPM or helped Isaac write it</span> <span data-start="971.05" data-end="972.63">I guess it since Isaac writes everything</span> <span data-start="972.63" data-end="975.16">so what this will do is actually install</span> <span data-start="975.16" data-end="976.87">all of your NPM dependencies for you</span> <span data-start="976.87" data-end="978.82">automatically get the right versions</span> <span data-start="978.82" data-end="980.86">this is why I harp so much on the</span> <span data-start="980.86" data-end="983.47">package.json dependencies because if you</span> <span data-start="983.47" data-end="984.91">don't have the right dependencies and</span> <span data-start="984.91" data-end="986.44">you decide to start multiple ones of</span> <span data-start="986.44" data-end="987.85">these overtime on different machines</span> <span data-start="987.85" data-end="990.04">that is a really difficult problem to</span> <span data-start="990.04" data-end="993.67">the bug and so I guess in closing before</span> <span data-start="993.67" data-end="997.6">I hit some questions I just was really</span> <span data-start="997.6" data-end="1009.47">looking forward to doing this</span> <span data-start="1009.48" data-end="1011.88">yeah I've got I've got one more slide</span> <span data-start="1011.88" data-end="1013.32">which is another one of my favorite</span> <span data-start="1013.32" data-end="1015.81">lines you know why why you know make</span> <span data-start="1015.81" data-end="1022.019">questions trademark anybody cool man</span> <span data-start="1022.019" data-end="1023.339">that's great no questions I'm yeah</span> <span data-start="1023.339" data-end="1028.71">that's that's oh wait now I got 10</span> <span data-start="1028.72" data-end="1031.209">yeah yeah it's all round robin and just</span> <span data-start="1031.209" data-end="1034.449">oh I'm sorry the question was is that</span> <span data-start="1034.449" data-end="1036.699">load balancer doing rabid proxying and</span> <span data-start="1036.699" data-end="1039.819">the answer is yes and so the thing about</span> <span data-start="1039.819" data-end="1041.74">the stop request that came in when you</span> <span data-start="1041.74" data-end="1043.209">tell it to stop it will stop all</span> <span data-start="1043.209" data-end="1046.059">instances it's not really refined enough</span> <span data-start="1046.059" data-end="1047.439">to say oh I want to stop this one</span> <span data-start="1047.439" data-end="1049.09">particular drone or that one particular</span> <span data-start="1049.09" data-end="1050.95">drone and they're jitsu we generally</span> <span data-start="1050.95" data-end="1052.39">have multiple machines running and we'll</span> <span data-start="1052.39" data-end="1054.7">just say Oh turn off that machine which</span> <span data-start="1054.7" data-end="1055.929">might have two or three processes</span> <span data-start="1055.929" data-end="1058.539">running on it and scale in that way per</span> <span data-start="1058.539" data-end="1062.71">machine horizontally how much each</span> <span data-start="1062.71" data-end="1065.26">process uses so this is actually a</span> <span data-start="1065.26" data-end="1066.549">feature that I'm working on it forever</span> <span data-start="1066.549" data-end="1068.049">for the next version which is to just</span> <span data-start="1068.049" data-end="1070.9">monitor things by the OS module but</span> <span data-start="1070.9" data-end="1074.02">that's not in there yet so that the</span> <span data-start="1074.02" data-end="1076.179">question was is there an option in hibu</span> <span data-start="1076.179" data-end="1079.12">for doing rolling restarts so kind of</span> <span data-start="1079.12" data-end="1080.83">the way so I've got a few minutes left</span> <span data-start="1080.83" data-end="1083.65">let's just jump into the code so</span> <span data-start="1083.65" data-end="1085.84">essentially it all the way I like to say</span> <span data-start="1085.84" data-end="1088.21">about this this project is that it all</span> <span data-start="1088.21" data-end="1091">wraps this one function which is the</span> <span data-start="1091" data-end="1093.28">spawn function and this does a bunch of</span> <span data-start="1093.28" data-end="1094.51">stuff to figure out where your app is</span> <span data-start="1094.51" data-end="1096.07">and you know install the dependencies</span> <span data-start="1096.07" data-end="1097.929">and do all those sorts of things but at</span> <span data-start="1097.929" data-end="1100.059">the end of the day it just spawns this</span> <span data-start="1100.059" data-end="1102.76">thing called the carapace and it's fully</span> <span data-start="1102.76" data-end="1105.37">pluggable so I have a chroot plug-in</span> <span data-start="1105.37" data-end="1106.75">which is a good example like sometimes</span> <span data-start="1106.75" data-end="1108.549">you want to be in chroot sometimes you</span> <span data-start="1108.549" data-end="1111.19">don't depending on who you are and so</span> <span data-start="1111.19" data-end="1112.659">plugins can say oh I want to spawn with</span> <span data-start="1112.659" data-end="1114.73">these options and these can actually be</span> <span data-start="1114.73" data-end="1117.37">used by the carapace file so you know</span> <span data-start="1117.37" data-end="1120.37">because this is designed to spawn any</span> <span data-start="1120.37" data-end="1122.65">node application not necessarily a</span> <span data-start="1122.65" data-end="1125.2">server that's not baked in but one could</span> <span data-start="1125.2" data-end="1127.179">easily write a cluster plugin that</span> <span data-start="1127.179" data-end="1129.34">utilize cluster for particular HTTP</span> <span data-start="1129.34" data-end="1131.62">servers that does rolling restart</span> <span data-start="1131.62" data-end="1133.39">cluster does rolling restart for you so</span> <span data-start="1133.39" data-end="1134.62">if you are going to be running a lot of</span> </p>
<p><span data-start="1134.62" data-end="1136.57">HTTP servers you should write that</span> <span data-start="1136.57" data-end="1138.309">plugin because I haven't had the time to</span> <span data-start="1138.309" data-end="1142.99">yet but I plan on it all right anything</span> <span data-start="1142.99" data-end="1144.179">else</span> </p>
</section>