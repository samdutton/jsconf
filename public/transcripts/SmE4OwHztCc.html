<section>
<p><span data-start="25.5" data-end="34.15">Ok. So, this is quite a large subject to talk about in 25 minutes, but I'll do my best to</span> <span data-start="34.15" data-end="40.43">cover what happens when you get the HTML and it how it comes and pints to your page, you</span> <span data-start="40.43" data-end="49.33">will understand some of the terms of what is happening behind the screens.</span> <span data-start="49.33" data-end="52.68">So thank you for having me in Berlin, it's been a beautiful city I've been exploring</span> <span data-start="52.68" data-end="57.909">it for the last week, it's been really great to be here.</span> <span data-start="57.909" data-end="65.01">As you were told I'm Ryan, I'm team leader of the Zen desk in Melbourne Australia, where</span> <span data-start="65.01" data-end="71.11">I work on lots of finance stuff, I'm really interested in how the browser works on the</span> <span data-start="71.11" data-end="74.11">front end side of things.</span> <span data-start="74.11" data-end="78.85">Just a high level view of what we will cover. We'll look at sort of the high level view</span> <span data-start="78.85" data-end="85.32">of it, it comes to be, how the HTML is passed, how it gets through the different processes</span> <span data-start="85.32" data-end="91.17">in the browser, we'll dig into each section and along the way we will have performance</span> <span data-start="91.17" data-end="98.81">insights, so performance things are recommended, that can be explained as what the browser</span> <span data-start="98.81" data-end="103.159">is actually doing, as it's constructing the website.</span> <span data-start="103.159" data-end="109.85">As I said this is a kind of like a 30,000 foot view, I've got 25 minutes to cover a</span> <span data-start="109.85" data-end="113.52">really, really in depth subject so I'll do my best.</span> </p>
<p><span data-start="113.52" data-end="120.159">So, the browser. It's probably one of the most complex applications that we use, I use</span> <span data-start="120.159" data-end="127.56">it for 90% of my interaction with the computer, like I've had my text editor or browser open</span> <span data-start="127.56" data-end="132.7">and I use all my applications through the browser, so it's a pretty prevalent application</span> <span data-start="132.7" data-end="135.76">and a really complex thing.</span> <span data-start="135.76" data-end="141.98">So looking at, sort of like the components that make up a browser, for the rendering</span> <span data-start="141.98" data-end="147.19">stuff, the binding, a lot of operating system stuff, so when it talks to the network, it</span> <span data-start="147.19" data-end="155.56">will use certain APIs depending on the operating system, Mac or windows, then the rendering</span> <span data-start="155.56" data-end="160.849">part, that's about actually constructing the website from the HTML that gets sent to it,</span> <span data-start="160.849" data-end="167.93">platform stuff that's dependent on windows or OS x, there are different things between</span> <span data-start="167.93" data-end="176.77">operating systems, then JavaScript virtual machine. I'll only cover this bit, the rendering</span> <span data-start="176.77" data-end="184.569">the parsing of the HTML, how it lays out the page and pints to it the screen and you get</span> <span data-start="184.569" data-end="187.25">the final result of the actual website you are working on.</span> </p>
<p><span data-start="187.25" data-end="194.13">If you look at the high level flow, we have got sort of two processes, one will parse</span> <span data-start="194.13" data-end="201.569">the HTML, one the CSS, then combined to the render or frame tree depending on which browser</span> <span data-start="201.569" data-end="207.76">you look at it, essentially a data structure of the two bits put together, that will then</span> <span data-start="207.76" data-end="216.129">layout the render tree, it will put it when you have absolute position it will know to</span> <span data-start="216.129" data-end="222.79">do all of that and then painting is the operation of drawing the graphics and giving you the</span> <span data-start="222.79" data-end="223.879">visual output.</span> <span data-start="223.879" data-end="232.47">If we go to parsing, there are a few things about parsing for HTML that are a bit different</span> <span data-start="232.47" data-end="237.489">to most languages, it's very for giving by nature you can make a lot of mistakes and</span> <span data-start="237.489" data-end="242.629">it will just work, that's one of the great things about web development, you can make</span> <span data-start="242.629" data-end="248.12">a lot of mistakes and it will still work for you, that means that the parsing isn't straightforward,</span> <span data-start="248.12" data-end="253.06">in most languages if you make a mistake or throw an error, it will error out, HTML will</span> <span data-start="253.06" data-end="261.15">try to recover. It can be halted, so we will go into when it can stop parsing in certain</span> <span data-start="261.15" data-end="266.96">situations, wilt do speculative parsing, that's kind of a big word, will go into what that</span> <span data-start="266.96" data-end="271.71">means soon and re-entering, that probably means nothing to you right now, we'll explain</span> <span data-start="271.71" data-end="274.49">what that means as we go.</span> </p>
<p><span data-start="274.49" data-end="283.749">There was a stage when we did try to do strict parsing, but if you made a mistake you got</span> <span data-start="283.749" data-end="288.77">an error page, that was a pretty bad experience, if you put something in production that had</span> <span data-start="288.77" data-end="292.589">a mistake that is what your visitor received, it will take over your whole page and say</span> <span data-start="292.589" data-end="299.27">there is an error in the HTML, you can't always control the HTML rendered on your page if</span> <span data-start="299.27" data-end="304.039">you have dynamic content et cetera.</span> <span data-start="304.039" data-end="312.08">So if we look at valid HTML, this is validation, you can see I'm missing the HTML tag, the</span> <span data-start="312.08" data-end="317.949">head tag, I'm not even closing my tags, I'm not even putting quotes around my attributes,</span> <span data-start="317.949" data-end="323.869">so the parse has to handle this, you see what it actually outputs in the end once it's taken</span> <span data-start="323.869" data-end="331.36">that in, will be that, so it will implicitly insert the HTML in the head tags for you,</span> <span data-start="331.36" data-end="336.96">close the tags and put quotes round the attributes and handle the paragraph and the div, if you</span> <span data-start="336.96" data-end="343.979">see that you would think the div should be inside the paragraph, but it knows for the</span> <span data-start="343.979" data-end="349.99">rules of parsing that it actually can't do that and it, it has to handle that and figure</span> <span data-start="349.99" data-end="357.4">it out for you it's pretty for giving in the way it handles it.</span> </p>
<p><span data-start="357.4" data-end="364.069">So the parsing flow, these are terms common to, if you have learnt about parsing or not,</span> <span data-start="364.069" data-end="368.61">so there is tokenisation, that takes the text and turns it into what are called tokens,</span> <span data-start="368.61" data-end="375.219">that will create the parse tree, that will then create the DOM tree which we all interact</span> <span data-start="375.219" data-end="380.279">with JavaScript, that's the thing you look at in the browser when you are creating or</span> <span data-start="380.279" data-end="385.849">querying the DOM, that's what you are looking at. We'll just, we won't going to the script</span> <span data-start="385.849" data-end="389.349">execution bit, we'll cover that later.</span> <span data-start="389.349" data-end="400.689">So parsing, as each character comes in through the token, it will have special cases, an</span> <span data-start="400.689" data-end="405.689">open tag, it will read the next bunch of characters and then say that's the tag name, look for</span> <span data-start="405.689" data-end="411.259">a closing tag and create a token called 'Start tag', then on the other end it will look for</span> <span data-start="411.259" data-end="421.009">> close tag, that's how it works out everything is positioned, in the example where I didn't</span> <span data-start="421.009" data-end="422.529">have that, if it finds</span> <span data-start="422.529" data-end="430.649">an open tag, or not a close tag it will automatically close it, that's simple rules, it will go</span> <span data-start="430.649" data-end="433.809">through each character and figure out the tokens.</span> </p>
<p><span data-start="433.809" data-end="441.979">That will create a parse tree, so parse tree is representation of your HTML, it's pretty</span> <span data-start="441.979" data-end="448.999">much one-to-one, you can see there, it's got all the elements in there, paragraph, div,</span> <span data-start="448.999" data-end="453.789">then they will take the parse tree and make it into the DOM tree, it's all the DOM elements,</span> <span data-start="453.789" data-end="456.659">that's where you interact with the JavaScript in the page.</span> <span data-start="456.659" data-end="466.009">So, there are certain situation where I said it will actually stop the parsing of the HTML,</span> <span data-start="466.009" data-end="471.74">so when it hits a script tag it needs to actually stop, fetch it for the network, if it's a</span> <span data-start="471.74" data-end="478.889">non-new line script and then it will have to pause, it will have to execute that and</span> <span data-start="478.889" data-end="480.469">then continue on.</span> </p>
<p><span data-start="480.469" data-end="488.509">So, if you have that in your page it will actually make it slower to render to the page.</span> <span data-start="488.509" data-end="495.539">So things like network latency, et cetera. Link and style can also affect it as well,</span> <span data-start="495.539" data-end="504.499">if the script needs to query information about a DOM element, a type or it can affect the</span> <span data-start="504.499" data-end="509.419">parsing while it's doing that.</span> <span data-start="509.419" data-end="515.399">So there is speculative parsing, what it will do, it will twiddle its thumbs while it's</span> <span data-start="515.399" data-end="522.13">pausing for the script to execute, down loading and executing, it will create another threat,</span> <span data-start="522.13" data-end="527.21">another process with the browser and it will actually look ahead, so if you have got images</span> <span data-start="527.21" data-end="532.49">or style sheets it will actually go ahead and fetch all those before it continues on</span> <span data-start="532.49" data-end="538">parsing the page, it's actually kind of smart about that.</span> <span data-start="538" data-end="543.29">The other weird thing about HTML, if we go back to that diagram is that it's re-enter,</span> <span data-start="543.29" data-end="548.75">it can be interrupted, when it gives the describe tag it can bring it down, something like document,</span> <span data-start="548.75" data-end="557.5">dot, you can edit the HTML on the fly it needs to go through that on the fly, if you download</span> <span data-start="557.5" data-end="565.5">JavaScript and too document dot right, you can redo the tree, redo the DOM, that can</span> <span data-start="565.5" data-end="566.78">slow it down.</span> </p>
<p><span data-start="566.78" data-end="577.65">So I come to the first performance insight. You may have been told, put your script that</span> <span data-start="577.65" data-end="585.57">bottom, but never, never known why. So now we know that a script tag will which stop</span> <span data-start="585.57" data-end="591.66">the parser from going through all the HTML, constructor and DOM tree, if we do it at the</span> <span data-start="591.66" data-end="596.74">bottom it can go through and do it uninterrupted, it won't need any script tags, create all</span> <span data-start="596.74" data-end="601.53">the elements, create the DOM tree, at the end you will get all the scripts and it will</span> <span data-start="601.53" data-end="608.93">be faster to render. If that's not an option, there are attributes, defer, that's in IE</span> <span data-start="608.93" data-end="617.21">a long time most browsers support it, defer will actually defer the execution until it's</span> <span data-start="617.21" data-end="624.39">actually done parsing. Async will work slightly differently it will do a separate thread and</span> <span data-start="624.39" data-end="635.44">actually parse and execute the script in that thread adjacent to the parsing one. The DOM</span> <span data-start="635.44" data-end="645.66">document property, if you are waiting for that, is deferrable.. deferrable will..</span> <span data-start="645.66" data-end="651.62">will stop DOM content loading from actually firing and async won't. So you can put it</span> <span data-start="651.62" data-end="661.45">at the bottom or put either defer or async on your scripts it's a trade-off between them.</span> </p>
<p><span data-start="661.45" data-end="668.57">So this parsing stop of visualised in the form of a gif. So it's kind of like my first</span> <span data-start="668.57" data-end="673.57">website, what the parsing looks like. So you can see it's quite, it never actually quite</span> <span data-start="673.57" data-end="675.39">falls over! \{Laughter\} .</span> <span data-start="675.39" data-end="680.78">Trying to figure out what the hell are you doing with that div tag, you can see at the</span> <span data-start="680.78" data-end="690">end he just chucks the spade, there you go, there's your website! \{Laughter\} .</span> </p>
<p><span data-start="690" data-end="698.43">I thought that was pretty good. CSS parsing, I'm not going to say too much about CSS parsing,</span> <span data-start="698.43" data-end="704.42">it's pretty standard, if you have done it in other languages, there is nothing special</span> <span data-start="704.42" data-end="713.45">about it, it will create the CSS object model, like the DOM object model, basically it's</span> <span data-start="713.45" data-end="721.8">a representation of your styles, you have a style sheet, rules, selectors, decorations</span> <span data-start="721.8" data-end="722.8">and so on.</span> </p>
<p><span data-start="722.8" data-end="728.41">So that will then move on to our second stage of combining those two, so we have got a DOM,</span> <span data-start="728.41" data-end="734.18">CSS object model and that will go into and create what's called the render or the frame</span> <span data-start="734.18" data-end="735.48">tree.</span> <span data-start="735.48" data-end="741.68">So, accommodation, you combine the two object models, style resolution, that means it will</span> <span data-start="741.68" data-end="746.79">figure out all the styles applied to nodes, it's the actual representation of what will</span> <span data-start="746.79" data-end="751.92">show on the screen, it's not a one-to-one mapping of your HTML.</span> </p>
<p><span data-start="751.92" data-end="759.07">I'll explain what that means in a second. So if we revisit that diagram, you can see</span> <span data-start="759.07" data-end="768.18">that parsing HTML and CSS isn't always necessarily can happen in parallel. JavaScript can affect</span> <span data-start="768.18" data-end="771.54">those two running at the same time.</span> <span data-start="771.54" data-end="779.24">So, the render tree is actually multiple trees, there are like four of them, render objects</span> <span data-start="779.24" data-end="785.19">which are kind of like the actual node itself, it's got a refer to the DOM node, hanging</span> <span data-start="785.19" data-end="790.68">off that the render style, so that's kind of like the styles that apply to that DOM</span> <span data-start="790.68" data-end="791.31">element.</span> <span data-start="791.31" data-end="798.72">You have got things like layers, so the browser needs to know if it's positioned absolute,</span> <span data-start="798.72" data-end="805.76">or if it has a z index on it where to place it on the page so it puts it in the right</span> <span data-start="805.76" data-end="810.42">order. Then line boxes, if you are wrapping text it needs to know how to lay that out</span> <span data-start="810.42" data-end="819.45">as well, based on font size, the constraints of what's inside, it gets a bit complex.</span> <span data-start="819.45" data-end="824.56">So, like I said it's not a one-to-one mapping, things that are not in the render tree are</span> <span data-start="824.56" data-end="830.6">all non-visual elements, so your head, your script, your titles, any node that is actually</span> <span data-start="830.6" data-end="837.66">hidden by display-none, or nodes that are apparent by hidden display-none, won't make</span> <span data-start="837.66" data-end="844.39">it into the render tree it doesn't need to show on the page.</span> </p>
<p><span data-start="844.39" data-end="849.54">If you look at things in the render page but not in the DOM, it's quite a lot of text to</span> <span data-start="849.54" data-end="856.68">look at, we can look at the top, a paragraph tag, so we've got a sentence and then we have</span> <span data-start="856.68" data-end="862.88">got two in line tags, strong and emphasise tag. On the left hand side, down the bottom</span> <span data-start="862.88" data-end="867.55">there, you can see that's actually what the render tree looks like, a render block assigned</span> <span data-start="867.55" data-end="869.529">to the tag, a block</span> <span data-start="869.529" data-end="876.55">level element, in side there it's got a text, then it hits the strong tag, inside that it's</span> <span data-start="876.55" data-end="883.98">got some text emphasised and so on and so on, hanging off that render box this line</span> <span data-start="883.98" data-end="888.85">indexes, that will figure out based on the constraints of where it's rendering, if it</span> <span data-start="888.85" data-end="895.88">needs to wrap the text it will create a line box, a box round each line of text, 'The quick</span> <span data-start="895.88" data-end="900.29">brown fox', was one line and 'Jumps over the lazy dog', would be the second box, that's</span> <span data-start="900.29" data-end="906.64">two separate line boxes, you can see, there are two separate line boxes, it knows how</span> <span data-start="906.64" data-end="913.72">to lay it out, it will change it if you change an element or the browser will now need to</span> <span data-start="913.72" data-end="918.75">figure out what's now in different lines.</span> <span data-start="918.75" data-end="926.93">So, the DOM node, like I said, is converted to a render object, or the render object has</span> <span data-start="926.93" data-end="933.72">a reference to the DOM node, it's a visual output of what's shown on the page, geometric</span> <span data-start="933.72" data-end="941.19">information about it, it's width and height, it can layout and paint itself, so it will</span> <span data-start="941.19" data-end="947.3">work out where it sits on the page in relation ship to everything else, it's if it's floating</span> <span data-start="947.3" data-end="953.839">it will need to have multiple element, if it's positioned at absolute it's taken out</span> <span data-start="953.839" data-end="962.16">of the flow and positioned based on, like, if a parent has position-relative for example.</span> </p>
<p><span data-start="962.16" data-end="968.23">It will hold styles and computer metrics about itself, so it will hold, you know it's font</span> <span data-start="968.23" data-end="970.67">size, width and height.</span> <span data-start="970.67" data-end="981.48">So, hopefully this will work, it's a really cool video of.. if it loads.. someone hacked</span> <span data-start="981.48" data-end="989.06">the Mozilla Firefox and actually true boxes around, as it's laying out a page, it's slowed</span> <span data-start="989.06" data-end="997.38">down quite a lot, you can see it's actually figuring out dimensions, it's laying out all</span> <span data-start="997.38" data-end="1002.49">its children and figuring out the position, it starts top left of the box and works out</span> <span data-start="1002.49" data-end="1004.57">where it needs to sit.</span> <span data-start="1004.57" data-end="1012.94">I'll play that again.. it's quite cool, you can see it has to do quite a lot of work,</span> <span data-start="1012.94" data-end="1017.22">laying out all its children and then it will figure out where it is, it stops there and</span> <span data-start="1017.22" data-end="1021.73">it slide down.</span> <span data-start="1021.73" data-end="1027.339">This is not a very complex website, you can imagine something with quite a lot of stuff</span> <span data-start="1027.339" data-end="1030.449">going on, it needs to do quite a lot of work.</span> </p>
<p><span data-start="1030.449" data-end="1045.24">I always like watching this, it's really cool.</span> <span data-start="1045.24" data-end="1048.659">Right. So. so how it lays out the information, it calculates all the visual properties, it</span> <span data-start="1048.659" data-end="1053.45">has to combine all the style, so, that means the browser default styles the external styles</span> <span data-start="1053.45" data-end="1059.139">you are linking to, any inline style elements or any inline styles, also take into account</span> <span data-start="1059.139" data-end="1065.57">some of the old HTML element, properties, attributes like VGA colour, have to take that</span> <span data-start="1065.57" data-end="1071.11">into account to set a background colour if that's on there as well. There's a lot of</span> <span data-start="1071.11" data-end="1077.269">complexity round matching rules for each element which I won't go into because its quite a</span> <span data-start="1077.269" data-end="1081.84">big subject, and how it shares the styles and how it does the cascade all those rules</span> <span data-start="1081.84" data-end="1089.899">round how CSS works. Do the style computation, work out information about, it so colours</span> <span data-start="1089.899" data-end="1099.929">to apply, width and height et cetera. Now we're into the layout process, this is we</span> <span data-start="1099.929" data-end="1105.999">have got our tree, render tree with our visual information like the video I showed where</span> <span data-start="1105.999" data-end="1111.429">you could see all the elements moving round the page, you might have heard it called reflow</span> <span data-start="1111.429" data-end="1118.369">or relayout as well if you transfer it.</span> </p>
<p><span data-start="1118.369" data-end="1124.529">So it's a recursive process, hopeful remember what recursion is, so it will work it's way</span> <span data-start="1124.529" data-end="1131.389">down the tree, then as if we remember each render project that's you sign too DOM node</span> <span data-start="1131.389" data-end="1139.33">how to lay itself it will layout it's children first, it needs to know based on all the dimensions</span> <span data-start="1139.33" data-end="1145.429">of the children what height and what width it should be, layout its children, then layout</span> <span data-start="1145.429" data-end="1149.419">itself, then flow all the way through the tree of your render tree then figure out where</span> <span data-start="1149.419" data-end="1154.86">everything sits</span> <span data-start="1154.86" data-end="1160.549">It will batch layout, so it will do incremental layout the browser will be intelligent, every</span> <span data-start="1160.549" data-end="1166.369">time you do a change it won't do a relay out yes I did will combine them all and do them</span> <span data-start="1166.369" data-end="1172.259">at a regular interval so essentially when something changes in a DOM the render tree</span> <span data-start="1172.259" data-end="1180.009">representation will say flag itself as dirty so saying I need to re layout the browser</span> <span data-start="1180.009" data-end="1185.47">will come a longer pick up all the objects that need layout and lay them out in one go</span> <span data-start="1185.47" data-end="1193.94">rather than individually that will traverse the tree using recursion, find all the dirty</span> <span data-start="1193.94" data-end="1197.72">render objects, because I need to layout all these bits and figure out where everything</span> <span data-start="1197.72" data-end="1207.61">sits. This will happen so it won't block. However this immediate layout where it needs</span> <span data-start="1207.61" data-end="1215.59">to layout the entire document for example if you change the font size, if you have a</span> <span data-start="1215.59" data-end="1220.289">fall back font then I font face coming the height of the fight might change slightly</span> <span data-start="1220.289" data-end="1224.71">that will cause a whole layout of the page it needs to figure out where everything sits</span> <span data-start="1224.71" data-end="1229.83">again because it shifts down that will also happen when you resize the browser and also</span> <span data-start="1229.83" data-end="1237.429">when you access certain JavaScript properties like node.offset height you want to get the</span> <span data-start="1237.429" data-end="1241.6">height to give you the proper value.</span> </p>
<p><span data-start="1241.6" data-end="1249.399">Comes to performance inside number 2. We want to make note from the browser and we want</span> <span data-start="1249.399" data-end="1256.11">to batch our changes. We want to act like a browser do all your DOM changes in one go</span> <span data-start="1256.11" data-end="1263.309">than rewrite you want to do all your reads in one pass all your writes, and just show</span> <span data-start="1263.309" data-end="1265.73">here a bad example.</span> <span data-start="1265.73" data-end="1272.46">So this code is trying to create like a aspect ratio four div, so like a 16:9 it’s reading</span> <span data-start="1272.46" data-end="1280.769">its width dividing it by 1.7, you get height like 16:9 resolution. You can see here I am</span> <span data-start="1280.769" data-end="1286.58">reading the client width, and then I am writing it to the DOM, I am reading, it writing it.</span> <span data-start="1286.58" data-end="1292.21">What that force it to do if I reading it then writing it that's fine but if I read it again</span> <span data-start="1292.21" data-end="1296.299">oh crap I need to layout the page need to give you the true dimension for the client</span> <span data-start="1296.299" data-end="1302.019">width because div 2 could have changed cause of div 1 has got a different height now that</span> <span data-start="1302.019" data-end="1309.489">could affect div 2 that needs to go and layout the page and give you the correct value.</span> <span data-start="1309.489" data-end="1312.84">So the best way to too that is actually to too your reads in one go and your writes in</span> <span data-start="1312.84" data-end="1318.659">one go. So you want to read all the values back, and then you want to write them in one</span> <span data-start="1318.659" data-end="1326.919">go. So this is obviously naive code, so the real world situation is there's a library</span> <span data-start="1326.919" data-end="1331.82">you're not using your framework of a DOM which is pretty good, a pretty good article calling</span> <span data-start="1331.82" data-end="1338.71">preventing layout thrashing which talks about reading writing, reading writing, which I</span> <span data-start="1338.71" data-end="1344.69">highly recommend you read. Fast DOM will give you an API to do all your reads you called</span> <span data-start="1344.69" data-end="1350.399">fast DOM.read when you want to read something from the DOM, and likewise if you do write</span> <span data-start="1350.399" data-end="1354.909">it will co-ordinate the process for you so it will make sure it will batch all the reads</span> <span data-start="1354.909" data-end="1359.72">then do all the writes one after the other. Most</span> <span data-start="1359.72" data-end="1367.399">modern JS framework will do this internally, it will do so does ember with their newer</span> <span data-start="1367.399" data-end="1369.779">rendering.</span> </p>
<p><span data-start="1369.779" data-end="1378.94">So finally we are on to 4, paint. This is what takes all the information from the render</span> <span data-start="1378.94" data-end="1384.369">tree and will actually do the calls to actually paint something. So kind of think of it like</span> <span data-start="1384.369" data-end="1389.899">the canvas API where you are drawing boxes, paint uses the process of taking all the information</span> <span data-start="1389.899" data-end="1395.049">from the render tree and gives you the visual output.</span> <span data-start="1395.049" data-end="1398.639">There's a few things about it, it will take so it will layout the render tree, take all</span> <span data-start="1398.639" data-end="1402.639">that information you have done the layout so it knows where it sits the co-ordinates</span> <span data-start="1402.639" data-end="1410.379">of the items, it will create layers, so layers of things you have got a position absolute,</span> <span data-start="1410.379" data-end="1418.799">make that work from the bottom up things display correctly, it's an incremental process, and</span> <span data-start="1418.799" data-end="1426.32">actually there's a 12 step phase, it needs to paint like the background colour and image,</span> <span data-start="1426.32" data-end="1432.499">the porters, the shadows et cetera build it up so it comes out in the correct order you</span> <span data-start="1432.499" data-end="1440.96">have got the correct rendering it's quite a heavy process. So if we remember one of</span> <span data-start="1440.96" data-end="1445.519">the trees of the render trees or render layers will try to group things into layers if you</span> <span data-start="1445.519" data-end="1452.72">got a position absolute element all it's children will be in it's own layer if its got transparency,</span> <span data-start="1452.72" data-end="1459.19">if it's got over flow hidden it's I canvas or video it will put it into it's own layer.</span> </p>
<p><span data-start="1459.19" data-end="1468.659">It's kind of a many to 1 one layer can have many render objects over DOM nodes it can</span> <span data-start="1468.659" data-end="1472.239">put on the screen.</span> <span data-start="1472.239" data-end="1481.429">Painting, so painting will also produce what's called a bitmap for each layer, so this used</span> <span data-start="1481.429" data-end="1487.359">to be CPU based but a lot of browsers now do it on the graphics card on the GPU, so</span> <span data-start="1487.359" data-end="1491.889">that’s lot faster the GPU is obviously made for drawing graphics, there some really good</span> <span data-start="1491.889" data-end="1504.139">articles about a Blink and Webkit do it, it will take that bitmap like a jpeg upload it</span> <span data-start="1504.139" data-end="1511.149">to the GPU create what's called a texture, those textures will be composit he'd into</span> <span data-start="1511.149" data-end="1523.009">at file image it's a bunch of images they get put together put on the screen.</span> </p>
<p><span data-start="1523.009" data-end="1529.499">This comes to performance inside number 3, so inline critical CSS this is a new thing</span> <span data-start="1529.499" data-end="1535.35">you might have seen. Essentially it’s a way of taking the most important bits of your</span> <span data-start="1535.35" data-end="1543.999">site and inlining the CSS in a style tag inside your HTML right in the head, that will speed</span> <span data-start="1543.999" data-end="1549.109">up first paint times so you delay everything else you delay all your other CSS all your</span> <span data-start="1549.109" data-end="1553.98">other JavaScript, so then the browser can come in parse all your HTML, you can get something</span> <span data-start="1553.98" data-end="1559.73">on the screen really fast, you will see lots of sites like filament group, a lot of people</span> <span data-start="1559.73" data-end="1568.639">really into performance talk about this a lot. The last bit about delta last bitmap,</span> <span data-start="1568.639" data-end="1573.999">browsers performance where they can compare the last paint to next paint they can do a</span> <span data-start="1573.999" data-end="1580.929">dif when you do visual regression testing they can do something where they go ok only</span> <span data-start="1580.929" data-end="1588.07">this bit changed I only have to draw this box here, it can be smart about it.</span> </p>
<p><span data-start="1588.07" data-end="1593.239">So we take an example I don't actually do this on my website but I went into the DevTools,</span> <span data-start="1593.239" data-end="1602.359">this is my blog, so the idea is that on the first render I would get this, essentially</span> <span data-start="1602.359" data-end="1606.98">the most important thing of a blog is the blog content we care about related articles</span> <span data-start="1606.98" data-end="1613.08">or my logo or the blog title you just want to read the article. The ready idea is you</span> <span data-start="1613.08" data-end="1620.529">render that straight away on second part when everything loads asynchronously you get everything</span> <span data-start="1620.529" data-end="1621.83">else coming in,</span> <span data-start="1621.83" data-end="1635.039">you can see there I have got a different font that is helvetica, comes in and you set ubuntu,</span> <span data-start="1635.039" data-end="1639.85">you get that in under a second you could have that on the users screen so it gives an illusion</span> <span data-start="1639.85" data-end="1643.529">that your site is really fast but what you are doing is delaying all the stuff and giving</span> <span data-start="1643.529" data-end="1647.429">them the important information. I guess the other thing is to think about is that you</span> <span data-start="1647.429" data-end="1652.82">don't want stuff to shift round so like the header up the top you want to have fixed height</span> <span data-start="1652.82" data-end="1658.379">so inline CSS so it doesn't jump, you kind of want to make it not jump as much so it's</span> <span data-start="1658.379" data-end="1664.669">not jarring to the user.</span> <span data-start="1664.669" data-end="1669.919">So all of these tips I have talked about apply after page load as well, this the process</span> <span data-start="1669.919" data-end="1675.69">to get it on the page initially but things like layout and paint all happen as you interact</span> <span data-start="1675.69" data-end="1680.34">with the website it's so really important information to know about.</span> </p>
<p><span data-start="1680.34" data-end="1691.57">For recap, we parse our CSS and our HTML that creates a DOM tree, the DOM tree then gets</span> <span data-start="1691.57" data-end="1699.479">converted into a render tree, so the CSS and the HTML combined. It's actually 4 trees so</span> <span data-start="1699.479" data-end="1711.059">the layers, the line boxes, the render objects, and the render styles. So layout is a process</span> <span data-start="1711.059" data-end="1715.09">where it computes where the elements will appear on the page, based on it's relationship</span> <span data-start="1715.09" data-end="1720.029">to other elements, taking into account all the CSS, then painting will actually produce</span> <span data-start="1720.029" data-end="1726.139">an image of that layer give you the visual output you are expecting on the page. Like</span> </p>
<p><span data-start="1726.139" data-end="1730.32">I said this process is really complicated I have little scratched the surface, there</span> <span data-start="1730.32" data-end="1734.739">are some really great articles I will share round later I highly recommend you check it</span> <span data-start="1734.739" data-end="1741.259">out some really good talks in here, really good article about going more indepth on how</span> <span data-start="1741.259" data-end="1744.259">the browser works as well.</span> <span data-start="1744.259" data-end="1759.409">Go hug a browser engineer they have a hard job. It's 
really interesting it's made me a better developer</span> </p>
</section>