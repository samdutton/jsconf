<section>
<p><span data-start="10.65" data-end="21.5">you</span> <span data-start="25.23" data-end="28.05">so good morning I hope everyone's had</span> <span data-start="28.05" data-end="29.34">their coffee we've got a lot to cover</span> <span data-start="29.34" data-end="31.62">here I'm glad we got started pretty</span> <span data-start="31.62" data-end="35.13">quickly so we should be good so I</span> <span data-start="35.13" data-end="36.72">realized that the term static</span> <span data-start="36.72" data-end="38.79">metaprogramming probably requires a</span> <span data-start="38.79" data-end="42.84">little bit of explanation so how many</span> <span data-start="42.84" data-end="47.1">people know what metaprogramming is so a</span> <span data-start="47.1" data-end="48.93">pretty good chunk of you so</span> <span data-start="48.93" data-end="50.67">metaprogramming is basically writing</span> <span data-start="50.67" data-end="53.19">programs that manipulate either</span> <span data-start="53.19" data-end="56.22">themselves or other programs as data and</span> <span data-start="56.22" data-end="58.05">usually when we talk about meta</span> <span data-start="58.05" data-end="59.49">programming we're talking about things</span> <span data-start="59.49" data-end="62.25">like you know hooking getters and</span> <span data-start="62.25" data-end="65.479">setters and customizing method dispatch</span> <span data-start="65.479" data-end="67.979">languages like Ruby and small talk</span> <span data-start="67.979" data-end="70.11">really allow you to kind of reach into</span> <span data-start="70.11" data-end="72.619">the runtime and do some funky things</span> <span data-start="72.619" data-end="74.759">what I want to talk about today is not</span> <span data-start="74.759" data-end="76.979">this kind of meta programming but rather</span> <span data-start="76.979" data-end="80.97">programs that manipulate code so that's</span> <span data-start="80.97" data-end="82.32">kind of a different type of meta</span> <span data-start="82.32" data-end="84.509">programming which some people call</span> <span data-start="84.509" data-end="90.3">static meta programming so a thing that</span> <span data-start="90.3" data-end="92.88">manipulates code a compiler is actually</span> <span data-start="92.88" data-end="96.03">a really good example of that right a</span> <span data-start="96.03" data-end="97.979">compiler is a thing that takes code in</span> <span data-start="97.979" data-end="102.179">and outputs code now normally a compiler</span> <span data-start="102.179" data-end="104.369">is something that takes in some sort of</span> <span data-start="104.369" data-end="106.47">high-level code and outputs something</span> <span data-start="106.47" data-end="109.259">lower-level so a C++ compiler you know</span> <span data-start="109.259" data-end="112.05">spits out machine code and a Java</span> <span data-start="112.05" data-end="115.709">compiler spits out Java byte code but</span> <span data-start="115.709" data-end="117.179">you know you can also compile to another</span> <span data-start="117.179" data-end="119.58">high-level language probably a lot of</span> <span data-start="119.58" data-end="121.229">you familiar with CoffeeScript right</span> <span data-start="121.229" data-end="123.509">which just compiles to JavaScript and</span> <span data-start="123.509" data-end="125.13">there's a ton of other languages that do</span> <span data-start="125.13" data-end="127.649">this people sometimes call these</span> <span data-start="127.649" data-end="130.259">transpilers it's basically just a</span> <span data-start="130.259" data-end="135">compiler it's the same thing so compiler</span> <span data-start="135" data-end="138.47">basically consists of two main parts the</span> <span data-start="138.47" data-end="141.87">first thing is the parser so the parser</span> <span data-start="141.87" data-end="144.87">takes source code and it creates some</span> <span data-start="144.87" data-end="147.09">sort of structured representation of</span> <span data-start="147.09" data-end="149.25">that source code usually we call this a</span> <span data-start="149.25" data-end="154.02">parse tree or an abstract syntax tree</span> <span data-start="154.02" data-end="156.06">and the second main part of a compiler</span> <span data-start="156.06" data-end="158.43">is a code generator so the code</span> <span data-start="158.43" data-end="161.82">generator takes a parse tree you know</span> <span data-start="161.82" data-end="163.71">does some analysis on it walks over it</span> <span data-start="163.71" data-end="167.46">and spits out the object code and of</span> <span data-start="167.46" data-end="169.82">course this is this is a pretty big</span> <span data-start="169.82" data-end="172.56">simplification in particular there's</span> <span data-start="172.56" data-end="174.75">usually a lot of stuff that happens in</span> <span data-start="174.75" data-end="176.61">that middle step there of analysis and</span> <span data-start="176.61" data-end="180.78">optimization those things but like I</span> <span data-start="180.78" data-end="183.78">said you know we don't we we don't</span> <span data-start="183.78" data-end="185.34">always have to compile from a high level</span> <span data-start="185.34" data-end="187.74">language to a low level language we can</span> <span data-start="187.74" data-end="190.83">compile you know to another high level</span> <span data-start="190.83" data-end="192.78">language or we can compile to the same</span> <span data-start="192.78" data-end="194.85">language that we started with and this</span> <span data-start="194.85" data-end="198.66">is what I want to talk about next so I'm</span> <span data-start="198.66" data-end="200.48">going to show you some examples of using</span> </p>
<p><span data-start="200.48" data-end="202.38">JavaScript compiler called</span> <span data-start="202.38" data-end="206.28">s prema prema is a nice simple fast</span> <span data-start="206.28" data-end="209.01">compiler for JavaScript but it's also</span> <span data-start="209.01" data-end="210.69">written in JavaScript which is kind of</span> <span data-start="210.69" data-end="211.11">cool</span> <span data-start="211.11" data-end="213.78">so you can you can dive in and check out</span> <span data-start="213.78" data-end="215.1">the source and understand what it's</span> <span data-start="215.1" data-end="219.99">doing and Esprit m'a also has two</span> <span data-start="219.99" data-end="222.06">related modules</span> <span data-start="222.06" data-end="225.57">yes Traverse and es Co Jen so so es</span> </p>
<p><span data-start="225.57" data-end="228.09">Traverse is a module for traversing the</span> <span data-start="228.09" data-end="229.56">parse trees that are generated by us</span> <span data-start="229.56" data-end="232.02">prima and es Co gen is for doing code</span> <span data-start="232.02" data-end="233.7">generation from the parse trees and</span> <span data-start="233.7" data-end="235.38">we're gonna use both of these in the</span> <span data-start="235.38" data-end="239.79">examples that I'm going to show you so</span> <span data-start="239.79" data-end="241.2">this is a really really simple example</span> <span data-start="241.2" data-end="243.81">of what you can do with this prima has a</span> <span data-start="243.81" data-end="246.45">nice simple API right we require a</span> </p>
<p><span data-start="246.45" data-end="248.72">Suprema or include the source tag and</span> <span data-start="248.72" data-end="252.24">just call the parse function so this is</span> <span data-start="252.24" data-end="254.37">a very very simple JavaScript program</span> <span data-start="254.37" data-end="255.75">here write a single function that</span> <span data-start="255.75" data-end="261.049">returns a value Esprit MA is going to</span> <span data-start="261.049" data-end="264.09">emit a parse tree that looks something</span> <span data-start="264.09" data-end="265.35">like this this is a bit of a</span> <span data-start="265.35" data-end="268.26">simplification but at the top level we</span> <span data-start="268.26" data-end="270.96">have a program the program consists of</span> <span data-start="270.96" data-end="273.24">one thing a function declaration the</span> <span data-start="273.24" data-end="274.79">function declaration has an identifier</span> <span data-start="274.79" data-end="277.5">the name of the function and it has a</span> <span data-start="277.5" data-end="279.66">body the body has one thing which is a</span> <span data-start="279.66" data-end="282.9">return statement and it returns 42 so</span> <span data-start="282.9" data-end="285.27">this is sort of a simplified version if</span> <span data-start="285.27" data-end="287.639">you want to see it in its full glory</span> </p>
<p><span data-start="287.639" data-end="288.99">I'm not sure if that's big enough to</span> <span data-start="288.99" data-end="291.99">read but you get the picture it's you</span> <span data-start="291.99" data-end="293.43">know there's a lot of detail there to</span> <span data-start="293.43" data-end="297.689">the parse tree so on its own this is a</span> <span data-start="297.689" data-end="299.49">little bit boring right okay so we parse</span> <span data-start="299.49" data-end="301.08">JavaScript and we get a parse tree who</span> <span data-start="301.08" data-end="304.979">cares but it turns out that if we if we</span> <span data-start="304.979" data-end="306.659">actually do stuff to this parse tree we</span> <span data-start="306.659" data-end="308.669">can we can analyze it and do a lot of</span> <span data-start="308.669" data-end="311.43">useful and really interesting things and</span> <span data-start="311.43" data-end="313.59">I'm going to show a basic example here</span> <span data-start="313.59" data-end="316.86">which is to do a style checker so this</span> <span data-start="316.86" data-end="318.3">is sort of an example of how something</span> <span data-start="318.3" data-end="323.069">like jslint works and so as Brian</span> <span data-start="323.069" data-end="324.539">mentioned I work on the chrome team at</span> </p>
<p><span data-start="324.539" data-end="326.759">Google and on the chromium project we</span> <span data-start="326.759" data-end="329.789">have style guides and we have a C++</span> <span data-start="329.789" data-end="331.59">style guide and a JavaScript style guide</span> <span data-start="331.59" data-end="334.889">and they're not quite the same variables</span> <span data-start="334.889" data-end="336.599">in C++ have underscores and in</span> <span data-start="336.599" data-end="339.12">JavaScript we use camel case so I find</span> <span data-start="339.12" data-end="340.289">myself getting mixed up sometimes</span> <span data-start="340.289" data-end="342.36">between these style guides and you know</span> <span data-start="342.36" data-end="344.039">really wastes a lot of time in code</span> <span data-start="344.039" data-end="346.08">review when you realize that you used</span> <span data-start="346.08" data-end="347.189">underscores when you should have used</span> <span data-start="347.189" data-end="347.999">camel case</span> <span data-start="347.999" data-end="350.789">so I wrote a style checker that can that</span> <span data-start="350.789" data-end="352.56">I can run is a pre-commit hook to</span> <span data-start="352.56" data-end="353.969">prevent me from making these mistakes</span> <span data-start="353.969" data-end="357.12">and I'll show you just how easy it is to</span> <span data-start="357.12" data-end="360.389">do this with a spray map so that's</span> <span data-start="360.389" data-end="361.919">basically the code right there it's</span> <span data-start="361.919" data-end="364.979">about 15 lines of code and it's really</span> <span data-start="364.979" data-end="367.919">pretty simple so the first thing we do</span> <span data-start="367.919" data-end="371.219">is just call the Esprit ml parse</span> <span data-start="371.219" data-end="374.55">function to to parse the parse the code</span> <span data-start="374.55" data-end="378.439">and get back an abstract syntax tree and</span> <span data-start="378.439" data-end="381.93">then we use the es Traverse module to</span> <span data-start="381.93" data-end="385.68">walk over the syntax tree now yes</span> <span data-start="385.68" data-end="387.27">traverse can basically does a</span> <span data-start="387.27" data-end="390">depth-first traversal of a parse tree</span> <span data-start="390" data-end="393.27">and you can visit each node either on</span> <span data-start="393.27" data-end="395.49">the way down before you visit its sub</span> <span data-start="395.49" data-end="398.129">trees or on the way up and and in this</span> <span data-start="398.129" data-end="399.569">case we're doing it on the way down it's</span> <span data-start="399.569" data-end="402">not really relevant but that's just the</span> <span data-start="402" data-end="406.11">meaning of the enter why we're using</span> <span data-start="406.11" data-end="409.05">enter there so this function that we</span> <span data-start="409.05" data-end="410.189">have here is going to be called for</span> <span data-start="410.189" data-end="411.779">every node and we're just looking for</span> <span data-start="411.779" data-end="414.36">nodes that are variable declarations and</span> <span data-start="414.36" data-end="415.56">when we find that node we're going to</span> <span data-start="415.56" data-end="417.839">call the check variable names function</span> <span data-start="417.839" data-end="421.949">and again this is pretty simple</span> <span data-start="421.949" data-end="424.409">so a variable declaration can have more</span> <span data-start="424.409" data-end="426.179">than one variable that it declares right</span> <span data-start="426.179" data-end="427.229">so we're going to iterate through each</span> <span data-start="427.229" data-end="429.239">of those and we're just gonna call a</span> <span data-start="429.239" data-end="431.729">function for every single one and I'm</span> <span data-start="431.729" data-end="433.559">basically just looking to see if the</span> <span data-start="433.559" data-end="435.239">name of the variable has an underscore</span> <span data-start="435.239" data-end="437.669">in it and if it does that's an error</span> <span data-start="437.669" data-end="439.83">that I want to report so I'm just gonna</span> <span data-start="439.83" data-end="442.649">push this errors object to an array and</span> <span data-start="442.649" data-end="444.539">at the end of the script I report all</span> <span data-start="444.539" data-end="448.319">the errors that were found so that's it</span> <span data-start="448.319" data-end="452.459">really really simple and short now have</span> <span data-start="452.459" data-end="454.229">some sample code here that I want to</span> <span data-start="454.229" data-end="455.969">test against and if I run these scripts</span> <span data-start="455.969" data-end="459.149">on that codes lo and behold it detects</span> <span data-start="459.149" data-end="462.419">the errors and and and spits me out a</span> <span data-start="462.419" data-end="467.309">warning so this is just a really simple</span> <span data-start="467.309" data-end="469.379">example of the kind of style checks you</span> <span data-start="469.379" data-end="472.919">can do as I said you know this is</span> <span data-start="472.919" data-end="476.189">basically the way jslint works and so if</span> <span data-start="476.189" data-end="478.589">you have a style guide in your project</span> <span data-start="478.589" data-end="480.119">you know you could imagine writing a</span> <span data-start="480.119" data-end="481.829">style checker that will check every</span> <span data-start="481.829" data-end="483.719">single aspect of your style guide and</span> <span data-start="483.719" data-end="487.669">it's really not that complicated to do</span> <span data-start="487.669" data-end="491.909">so this is an example of analyzing the</span> <span data-start="491.909" data-end="494.069">parse tree right so we read in the code</span> <span data-start="494.069" data-end="496.199">we analyze the parse tree but we left</span> <span data-start="496.199" data-end="499.319">the original code intact so the next</span> <span data-start="499.319" data-end="501.029">thing I want to do is something a little</span> <span data-start="501.029" data-end="502.8">bit more interesting which is to</span> <span data-start="502.8" data-end="506.36">actually rewrite the source code and</span> <span data-start="506.36" data-end="509.849">what I'm going to do is I find so I find</span> <span data-start="509.849" data-end="511.499">often when I'm developing I'm trying to</span> <span data-start="511.499" data-end="513.389">understand the flow of my code and how</span> <span data-start="513.389" data-end="514.86">it flows between functions and</span> <span data-start="514.86" data-end="516.719">especially if I have a lot of callbacks</span> <span data-start="516.719" data-end="519.329">and we can get really complicated and I</span> <span data-start="519.329" data-end="520.949">like to insert logging statements and</span> <span data-start="520.949" data-end="523.56">probably a lot of people do this but</span> <span data-start="523.56" data-end="525.569">sometimes it's super annoying to have to</span> <span data-start="525.569" data-end="527.339">go and insert logging statements in like</span> <span data-start="527.339" data-end="530.61">10 or 15 different places so I wrote</span> <span data-start="530.61" data-end="533.459">this little script that basically adds</span> <span data-start="533.459" data-end="535.769">logging to every single function in a</span> <span data-start="535.769" data-end="539.67">particular source file and again it's</span> <span data-start="539.67" data-end="543.47">actually surprisingly simple to do this</span> <span data-start="543.47" data-end="546.209">so again we we first take the source</span> <span data-start="546.209" data-end="547.68">code and we parse it into an abstract</span> <span data-start="547.68" data-end="551.309">syntax tree then we're going to walk</span> <span data-start="551.309" data-end="553.529">over that tree and look for particular</span> <span data-start="553.529" data-end="555.48">nodes so this time we're look</span> <span data-start="555.48" data-end="557.839">for function declaration nodes and</span> <span data-start="557.839" data-end="560.699">function expressions and when we find</span> <span data-start="560.699" data-end="562.41">one we just call this this function add</span> <span data-start="562.41" data-end="566.67">before code so this function is a little</span> <span data-start="566.67" data-end="568.5">bit more complex than we had before you</span> <span data-start="568.5" data-end="571.5">know we're not just reporting errors so</span> <span data-start="571.5" data-end="572.79">first we figure out the name of the</span> <span data-start="572.79" data-end="575.76">function and then what I do in the</span> <span data-start="575.76" data-end="579.47">second line here is to build up a string</span> <span data-start="579.47" data-end="581.85">that contains the code that I want to</span> <span data-start="581.85" data-end="583.079">insert at the beginning of every</span> <span data-start="583.079" data-end="584.76">function so it's just a console dot log</span> <span data-start="584.76" data-end="587.339">statement with the name of the function</span> <span data-start="587.339" data-end="588.6">but you could do some more sophisticated</span> <span data-start="588.6" data-end="591.99">stuff here with you know printing the</span> <span data-start="591.99" data-end="595.13">values of the arguments to the function</span> <span data-start="595.13" data-end="599.19">now the next line is is interesting I'm</span> <span data-start="599.19" data-end="600.57">actually going to take this string that</span> </p>
<p><span data-start="600.57" data-end="602.94">I built up and use this prima to parse</span> <span data-start="602.94" data-end="604.949">it and so I'm going to have a little</span> <span data-start="604.949" data-end="607.399">parse tree a very very tiny parse tree</span> <span data-start="607.399" data-end="610.41">that I'm going to use an insert into the</span> <span data-start="610.41" data-end="615.139">original parse tree so to get an idea of</span> <span data-start="615.139" data-end="618.66">what what we're doing here the original</span> <span data-start="618.66" data-end="622.319">parse tree is something like this and we</span> <span data-start="622.319" data-end="624.81">have a function declaration its body is</span> <span data-start="624.81" data-end="627.389">a block statement and that has a body</span> <span data-start="627.389" data-end="629.13">which is an array of statements and</span> <span data-start="629.13" data-end="630.449">those statements represent basically</span> <span data-start="630.449" data-end="635.19">every single line in the function so my</span> <span data-start="635.19" data-end="637.199">mini parse tree that I created from that</span> <span data-start="637.199" data-end="638.79">string that I built up is actually just</span> <span data-start="638.79" data-end="640.92">a single statement object and I'm going</span> <span data-start="640.92" data-end="643.709">to take that and I'm going to add it to</span> <span data-start="643.709" data-end="646.319">the array at the beginning of the array</span> <span data-start="646.319" data-end="649.05">that represents the body of the original</span> <span data-start="649.05" data-end="650.43">function so I've modified the original</span> <span data-start="650.43" data-end="655.199">parse tree here and then the next step</span> <span data-start="655.199" data-end="657.06">to actually do something useful now that</span> </p>
<p><span data-start="657.06" data-end="659.699">I've modified the parse tree is to Amit</span> <span data-start="659.699" data-end="664.079">Amit code so using the es cogent module</span> <span data-start="664.079" data-end="667.23">I actually generate new source code from</span> <span data-start="667.23" data-end="668.97">the original from the modified parse</span> <span data-start="668.97" data-end="671.55">tree so I took in the original code</span> <span data-start="671.55" data-end="673.35">modified the parse tree and I'm spitting</span> <span data-start="673.35" data-end="675.66">out some new JavaScript and then I can</span> <span data-start="675.66" data-end="677.399">you know run that JavaScript and it's</span> <span data-start="677.399" data-end="683.519">gonna log all the function enters so</span> <span data-start="683.519" data-end="685.589">just a simple example to show you what</span> <span data-start="685.589" data-end="688.019">this is doing here right here's a simple</span> <span data-start="688.019" data-end="689.279">simple snippet</span> <span data-start="689.279" data-end="694.199">that contains two functions and if I run</span> <span data-start="694.199" data-end="697.35">my little script on this it spits out</span> <span data-start="697.35" data-end="699.259">two new code that looks almost the same</span> <span data-start="699.259" data-end="701.249">except for the fact that it's got these</span> <span data-start="701.249" data-end="702.87">console dot log statements at the</span> <span data-start="702.87" data-end="705.06">beginning of each function and this is</span> <span data-start="705.06" data-end="706.86">done completely automatically right so I</span> <span data-start="706.86" data-end="710.309">could I could do this across a thousand</span> <span data-start="710.309" data-end="715.17">source files if I wanted so this kind of</span> <span data-start="715.17" data-end="716.759">stuff is really really powerful I think</span> <span data-start="716.759" data-end="719.999">for doing the kinds of things that maybe</span> <span data-start="719.999" data-end="722.639">you know Java people will do with with</span> </p>
<p><span data-start="722.639" data-end="725.79">Eclipse refactoring tools I've shown</span> <span data-start="725.79" data-end="727.98">just a couple examples here but really</span> <span data-start="727.98" data-end="729.93">there's kind of no limit to what you can</span> <span data-start="729.93" data-end="732.749">do when you're manipulating these parse</span> <span data-start="732.749" data-end="736.22">trees but these are all examples of</span> <span data-start="736.22" data-end="739.199">basically compiling from JavaScript to</span> <span data-start="739.199" data-end="742.319">JavaScript so I want to get into</span> <span data-start="742.319" data-end="744.48">something a little different which is</span> <span data-start="744.48" data-end="746.069">what if our source language is not</span> </p>
<p><span data-start="746.069" data-end="749.22">JavaScript maybe some of you you know</span> <span data-start="749.22" data-end="751.559">I've always dreamed of creating your own</span> <span data-start="751.559" data-end="752.1">language</span> <span data-start="752.1" data-end="754.379">something like CoffeeScript maybe that</span> <span data-start="754.379" data-end="756.629">compiles to JavaScript right it's a</span> <span data-start="756.629" data-end="759.3">really really simple and powerful way to</span> <span data-start="759.3" data-end="761.399">create a new language and to play with</span> <span data-start="761.399" data-end="765.959">language concepts and for that I'm going</span> <span data-start="765.959" data-end="767.939">to show you how you can use parser</span> <span data-start="767.939" data-end="772.35">generators so parser generators a</span> <span data-start="772.35" data-end="774.809">personal generator is basically a thing</span> <span data-start="774.809" data-end="777.6">that takes a language grammar as input</span> <span data-start="777.6" data-end="779.339">so language grammar is just you know a</span> <span data-start="779.339" data-end="783.329">formal description of a language and it</span> <span data-start="783.329" data-end="786.899">spits out a parser that will parse that</span> <span data-start="786.899" data-end="791.04">language and you've probably heard of</span> <span data-start="791.04" data-end="794.429">some of the more famous perc√© or</span> <span data-start="794.429" data-end="798.089">generators yak bison or JavaScript</span> <span data-start="798.089" data-end="802.259">there's Dyson but today I'm going to</span> <span data-start="802.259" data-end="805.259">show you an example of something called</span> <span data-start="805.259" data-end="807.839">peg das which is a which is a slightly</span> <span data-start="807.839" data-end="810.24">different kind of parser generator that</span> <span data-start="810.24" data-end="812.55">uses parsing expression grammars trying</span> <span data-start="812.55" data-end="817.649">to explain very briefly so let's talk</span> <span data-start="817.649" data-end="819.959">about these grammars it's basically you</span> <span data-start="819.959" data-end="821.04">know if you're going to write a new</span> <span data-start="821.04" data-end="821.98">language you</span> <span data-start="821.98" data-end="823.66">need to know how to deal with formal</span> <span data-start="823.66" data-end="827.68">grammars so how many people are familiar</span> <span data-start="827.68" data-end="830.2">with this kind of syntax for</span> <span data-start="830.2" data-end="832.74">context-free grammars</span> <span data-start="832.74" data-end="836.08">okay so quite a few of you this is</span> <span data-start="836.08" data-end="838.45">basically a meta language it's a</span> <span data-start="838.45" data-end="841.84">language for describing languages and if</span> <span data-start="841.84" data-end="843.16">you're designing your own language or</span> <span data-start="843.16" data-end="844.81">you're even looking at other languages</span> <span data-start="844.81" data-end="846.28">this is the kind of thing that you'll</span> <span data-start="846.28" data-end="849.94">see quite a bit what I have here is an</span> <span data-start="849.94" data-end="852.43">example of recognizing an arithmetic</span> <span data-start="852.43" data-end="855.79">language so basically just sort of math</span> <span data-start="855.79" data-end="860.05">expressions you can have numbers you can</span> <span data-start="860.05" data-end="862.71">have plus or minus operators</span> <span data-start="862.71" data-end="868.68">multiplication division and brackets and</span> <span data-start="868.68" data-end="870.55">you'll see if you're familiar with</span> <span data-start="870.55" data-end="873.4">regular expressions you'll see that some</span> <span data-start="873.4" data-end="875.35">of the similar syntax is used in</span> <span data-start="875.35" data-end="879.07">context-free grammars now me maybe</span> <span data-start="879.07" data-end="880.66">you've seen these in slightly different</span> <span data-start="880.66" data-end="883.78">forms there's Backus noir form and EB n</span> </p>
<p><span data-start="883.78" data-end="886.42">F they're slightly different but they're</span> <span data-start="886.42" data-end="888.58">really just different representations of</span> <span data-start="888.58" data-end="890.44">the same thing so this is the form that</span> <span data-start="890.44" data-end="894.73">I'm going to use today but first I want</span> <span data-start="894.73" data-end="898.03">to talk about one particular thing this</span> <span data-start="898.03" data-end="899.83">little this what we call the choice</span> <span data-start="899.83" data-end="902.23">operator so this is basically works like</span> <span data-start="902.23" data-end="904.93">a logical or in most programming</span> <span data-start="904.93" data-end="908.71">languages except the one difference is</span> <span data-start="908.71" data-end="911.47">that in context-free grammars it's</span> <span data-start="911.47" data-end="914.86">actually unordered so it's not like a</span> <span data-start="914.86" data-end="916.9">short-circuiting operator like you have</span> <span data-start="916.9" data-end="919.3">in programming languages and this is</span> <span data-start="919.3" data-end="921.52">because context-free grammars come from</span> <span data-start="921.52" data-end="924.16">linguistics actually you know they</span> <span data-start="924.16" data-end="925.39">weren't computer scientists who</span> <span data-start="925.39" data-end="927.16">originally came up with these things an</span> <span data-start="927.16" data-end="930.52">implementing unordered choice it can be</span> <span data-start="930.52" data-end="931.87">a bit of a pain and sometimes you have</span> <span data-start="931.87" data-end="935.56">language ambiguities and so there's a</span> <span data-start="935.56" data-end="937.33">slightly different variation called</span> <span data-start="937.33" data-end="939.25">parsing expression grammars and that's</span> <span data-start="939.25" data-end="941.62">what we're going to use today and pegs</span> <span data-start="941.62" data-end="944.86">use ordered choice so it's it's just</span> <span data-start="944.86" data-end="946.45">like the logical operator in a</span> <span data-start="946.45" data-end="948.49">programming language so if the if the</span> <span data-start="948.49" data-end="951.49">first option is used then we don't even</span> <span data-start="951.49" data-end="954.27">bother looking at the second option and</span> <span data-start="954.27" data-end="955.9">to indicate</span> <span data-start="955.9" data-end="957.79">that the operator is ordered choice they</span> <span data-start="957.79" data-end="960.07">usually use a slash instead of the</span> <span data-start="960.07" data-end="963.31">vertical bar but it's it's a minor minor</span> <span data-start="963.31" data-end="968.98">syntax difference so let's take a look</span> <span data-start="968.98" data-end="971.2">at what it looks like to use peg KS to</span> <span data-start="971.2" data-end="973.69">parse this arithmetic language that we</span> <span data-start="973.69" data-end="977.02">have so you can just take the string and</span> <span data-start="977.02" data-end="981.82">call the build parser function and it</span> <span data-start="981.82" data-end="983.98">will return you an object which is a</span> <span data-start="983.98" data-end="986.26">parser and then I can use this parser</span> <span data-start="986.26" data-end="988.3">just like I use the Esprit my parser to</span> <span data-start="988.3" data-end="994.51">parse jsr to parse my new language and</span> <span data-start="994.51" data-end="997.06">if i if i try and test out this code so</span> <span data-start="997.06" data-end="1000.39">try and parse one plus ten actually get</span> <span data-start="1000.39" data-end="1002.67">an error and this is something that if</span> <span data-start="1002.67" data-end="1004.53">you use parsing expression grammars a</span> <span data-start="1004.53" data-end="1006.36">lot of people are going to run into this</span> <span data-start="1006.36" data-end="1009.06">the first time they try something and</span> <span data-start="1009.06" data-end="1011.94">it's an error about left recursion and i</span> <span data-start="1011.94" data-end="1013.56">think it's worth explaining why this</span> <span data-start="1013.56" data-end="1016.11">happens because so many people run into</span> <span data-start="1016.11" data-end="1021.93">it it's actually very simple so a lot of</span> <span data-start="1021.93" data-end="1024.57">parsing expression grammars are tools to</span> <span data-start="1024.57" data-end="1026.13">deal with parsing expression grammars</span> <span data-start="1026.13" data-end="1028.1">use what's called a recursive descent</span> <span data-start="1028.1" data-end="1032.25">parser and a recursive descent parser</span> <span data-start="1032.25" data-end="1035.12">basically treats each one of these rules</span> <span data-start="1035.12" data-end="1037.86">so the things along the left-hand side</span> <span data-start="1037.86" data-end="1041.91">here also called non terminals a treat</span> <span data-start="1041.91" data-end="1045.33">shows just as functions so basically the</span> <span data-start="1045.33" data-end="1047.79">the two things in blue they're these are</span> <span data-start="1047.79" data-end="1052.05">just function calls effectively and you</span> <span data-start="1052.05" data-end="1054.03">know if you've ever written recursive</span> <span data-start="1054.03" data-end="1055.86">function that calls itself as the first</span> <span data-start="1055.86" data-end="1057.66">line of that function then you probably</span> <span data-start="1057.66" data-end="1059.58">understand why this is not going to work</span> <span data-start="1059.58" data-end="1061.62">right it's it's it's simply just</span> <span data-start="1061.62" data-end="1063.24">infinite recursion it keeps trying to</span> <span data-start="1063.24" data-end="1067.65">satisfy the expression by by itself so</span> <span data-start="1067.65" data-end="1069.45">that's why you can't use left recursion</span> <span data-start="1069.45" data-end="1074.37">in a recursive descent parser but it's</span> <span data-start="1074.37" data-end="1076.2">actually quite simple to fix and a lot</span> <span data-start="1076.2" data-end="1078.48">of people tear their hair out about how</span> <span data-start="1078.48" data-end="1081.18">to deal with left recursion but but the</span> <span data-start="1081.18" data-end="1083.4">real simple fix is that you just use</span> <span data-start="1083.4" data-end="1085.65">iteration instead of recursion all right</span> <span data-start="1085.65" data-end="1087.15">and this is something that that a lot of</span> <span data-start="1087.15" data-end="1088.92">people know from programming that you</span> <span data-start="1088.92" data-end="1091.05">rewrite almost any recursive algorithm</span> <span data-start="1091.05" data-end="1094.29">as being an iterative algorithm but a</span> <span data-start="1094.29" data-end="1095.7">lot of people kind of forget this when</span> <span data-start="1095.7" data-end="1097.35">it deals with when that when it comes to</span> <span data-start="1097.35" data-end="1101.52">language grammars so to use iteration in</span> <span data-start="1101.52" data-end="1105">in this in this grammar we just have to</span> <span data-start="1105" data-end="1108">use the star operator and this is just</span> <span data-start="1108" data-end="1110.22">like a regular expression so star means</span> <span data-start="1110.22" data-end="1114.84">you can have zero or more repetitions of</span> <span data-start="1114.84" data-end="1118.41">whatever's inside the brackets there so</span> <span data-start="1118.41" data-end="1119.88">now that we've fixed our grammar let's</span> <span data-start="1119.88" data-end="1123.84">try parsing the new grammar and yeah it</span> <span data-start="1123.84" data-end="1128.04">parses and everything all is good except</span> <span data-start="1128.04" data-end="1130.02">you may notice that it's this this parse</span> <span data-start="1130.02" data-end="1132">tree that it generates here is kind of</span> <span data-start="1132" data-end="1135.45">weird it's it's like just a bunch of</span> <span data-start="1135.45" data-end="1138.39">nested arrays and it's not like that</span> <span data-start="1138.39" data-end="1140.07">nice parse tree that we saw from a</span> <span data-start="1140.07" data-end="1142.32">suprema that had all this great</span> <span data-start="1142.32" data-end="1145.53">information you may also notice that the</span> <span data-start="1145.53" data-end="1149.58">number 10 up here got parsed as like</span> <span data-start="1149.58" data-end="1152.31">separate digits so this is kind of weird</span> <span data-start="1152.31" data-end="1155.13">right I it's a little bit hard to work</span> <span data-start="1155.13" data-end="1158.01">with if if you have to visit like look</span> <span data-start="1158.01" data-end="1161.28">at each number individually so let's</span> <span data-start="1161.28" data-end="1163.32">look at how we can fix that we can fix</span> <span data-start="1163.32" data-end="1165.06">this using something called semantic</span> <span data-start="1165.06" data-end="1169.53">actions so peg dot j s basically allows</span> <span data-start="1169.53" data-end="1172.35">you to embed little snippets of</span> </p>
<p><span data-start="1172.35" data-end="1176.22">JavaScript code inside any of your rules</span> <span data-start="1176.22" data-end="1179.91">and you can use these to customize how</span> <span data-start="1179.91" data-end="1182.55">it builds the parse tree so we're gonna</span> <span data-start="1182.55" data-end="1185.82">edit our number or number rule down here</span> <span data-start="1185.82" data-end="1187.44">and we're gonna add this identifier</span> <span data-start="1187.44" data-end="1189.54">digits so we we have a name with which</span> <span data-start="1189.54" data-end="1191.43">to refer to the things that got captured</span> <span data-start="1191.43" data-end="1194.19">and then we just add a little snippet of</span> </p>
<p><span data-start="1194.19" data-end="1196.92">JavaScript code to join those digits</span> <span data-start="1196.92" data-end="1199.5">together into a single string and that's</span> <span data-start="1199.5" data-end="1200.82">going to make it much easier to work</span> <span data-start="1200.82" data-end="1203.94">with and when I run the parser again I</span> <span data-start="1203.94" data-end="1206.49">see that it looks much nicer I've got</span> <span data-start="1206.49" data-end="1210.27">you know the number 10 there rather than</span> <span data-start="1210.27" data-end="1215.82">the individual digits another thing that</span> <span data-start="1215.82" data-end="1218.4">can be useful in when you're working</span> <span data-start="1218.4" data-end="1222.15">with peg KS is to insert as</span> <span data-start="1222.15" data-end="1224.04">snippet of code at the top of your</span> <span data-start="1224.04" data-end="1226.59">function some of your semantic actions</span> <span data-start="1226.59" data-end="1229.92">may require you know helper functions or</span> <span data-start="1229.92" data-end="1232.52">whatever so what you can do is actually</span> <span data-start="1232.52" data-end="1235.62">just put brackets at the top of your</span> <span data-start="1235.62" data-end="1239.49">grammar and insert whatever JavaScript</span> <span data-start="1239.49" data-end="1242.13">code you want so maybe instead of just</span> <span data-start="1242.13" data-end="1244.59">returning a string to represent my</span> <span data-start="1244.59" data-end="1246.75">numbers maybe I want to actually build</span> <span data-start="1246.75" data-end="1250.92">up a real parse tree right so I can</span> <span data-start="1250.92" data-end="1253.65">introduce a constructor function here</span> <span data-start="1253.65" data-end="1257.22">that will create a node and then in my</span> <span data-start="1257.22" data-end="1259.98">semantic action I can use that</span> <span data-start="1259.98" data-end="1263.37">constructor to to create my nodes in the</span> <span data-start="1263.37" data-end="1267.78">parse tree so that's really all there is</span> <span data-start="1267.78" data-end="1273.33">to parsing a simple language MPEG KS but</span> <span data-start="1273.33" data-end="1275.64">you know this language doesn't really do</span> <span data-start="1275.64" data-end="1278.16">anything right it's just we parsed some</span> <span data-start="1278.16" data-end="1281.01">numbers and operators but how do we do</span> <span data-start="1281.01" data-end="1285.72">something useful with it so I promised</span> <span data-start="1285.72" data-end="1289.08">in my Brian just held up the 5-minute</span> <span data-start="1289.08" data-end="1291.12">five minute sign for me and I promised</span> <span data-start="1291.12" data-end="1293.28">that I could teach you how to create</span> <span data-start="1293.28" data-end="1294.78">your own language that compiles to</span> </p>
<p><span data-start="1294.78" data-end="1296.91">JavaScript in five minutes so it's</span> <span data-start="1296.91" data-end="1300.97">perfect timing and I think I can do it</span> <span data-start="1300.98" data-end="1303.3">so let's start with the the arithmetic</span> <span data-start="1303.3" data-end="1306.63">remember that we had before we're gonna</span> <span data-start="1306.63" data-end="1308.82">throw away all this stuff that we don't</span> <span data-start="1308.82" data-end="1310.56">need because that arithmetic grammar</span> <span data-start="1310.56" data-end="1312.69">works still part of our grammar I'm just</span> <span data-start="1312.69" data-end="1315.21">gonna hide it right now at the top level</span> <span data-start="1315.21" data-end="1317.52">we have an expression so I want to</span> <span data-start="1317.52" data-end="1320.85">introduce a new top level rule here from</span> <span data-start="1320.85" data-end="1325.77">my new language and that rule is for</span> <span data-start="1325.77" data-end="1327.72">variable declarations and I've just used</span> <span data-start="1327.72" data-end="1330.42">deckle here for shorts and what I want</span> <span data-start="1330.42" data-end="1333.18">to do is have variable declarations that</span> <span data-start="1333.18" data-end="1335.1">are in the style of small talk I don't</span> <span data-start="1335.1" data-end="1336.6">know if anyone's familiar with small</span> <span data-start="1336.6" data-end="1339.39">talk but rather than saying var x equals</span> <span data-start="1339.39" data-end="1343.64">whatever small talk uses colon equals</span> <span data-start="1343.64" data-end="1346.8">four he actually uses it for assignment</span> <span data-start="1346.8" data-end="1348.03">but in this case I'm going to use it for</span> <span data-start="1348.03" data-end="1352.47">variable Declaration and assignment so</span> <span data-start="1352.47" data-end="1354.72">declaration consists of an identifier</span> <span data-start="1354.72" data-end="1355.97">colon equals and then</span> <span data-start="1355.97" data-end="1358.79">expression so let's define identifier an</span> <span data-start="1358.79" data-end="1361.07">identifier is just like JavaScript it</span> <span data-start="1361.07" data-end="1363.14">can be any sequence of digits letters or</span> <span data-start="1363.14" data-end="1367.73">underscore digit the number zero to nine</span> <span data-start="1367.73" data-end="1371.27">letters are a to Z in lowercase and</span> <span data-start="1371.27" data-end="1373.52">capital and notice I said Zed so I</span> <span data-start="1373.52" data-end="1377.72">really am Canadian and we're going to</span> <span data-start="1377.72" data-end="1379.49">throw in a new top-level rule here</span> <span data-start="1379.49" data-end="1381.26">because we want to have multiple</span> <span data-start="1381.26" data-end="1383.6">expressions in this language right our</span> <span data-start="1383.6" data-end="1385.07">will grammar only handle one expression</span> <span data-start="1385.07" data-end="1387.83">and so a program in this case can</span> <span data-start="1387.83" data-end="1389.84">consist of well it can consist of</span> <span data-start="1389.84" data-end="1392.27">nothing actually or it can be one or</span> <span data-start="1392.27" data-end="1394.55">more expressions that are separated by a</span> <span data-start="1394.55" data-end="1398.9">period so small talk uses a period kind</span> <span data-start="1398.9" data-end="1400.85">of like Java Script uses the semicolon</span> <span data-start="1400.85" data-end="1402.74">right and and I'm a big small talk fan</span> <span data-start="1402.74" data-end="1406.63">so I'm going to use that in my language</span> <span data-start="1406.63" data-end="1409.22">so let's take a look at what this looks</span> <span data-start="1409.22" data-end="1410.99">like now when we try and parse a little</span> <span data-start="1410.99" data-end="1413.33">snippet of code with it so I'm just</span> <span data-start="1413.33" data-end="1414.71">going to parse something simple you know</span> <span data-start="1414.71" data-end="1419.15">x equals 2 plus 5 and y equals 3 and it</span> <span data-start="1419.15" data-end="1422">works which is which is cool again we</span> <span data-start="1422" data-end="1423.89">have this really nasty looking parse</span> <span data-start="1423.89" data-end="1425.75">tree that it's kind of hard to do</span> <span data-start="1425.75" data-end="1428.27">anything useful with so we can use</span> <span data-start="1428.27" data-end="1432.29">semantic actions to fix that now when</span> <span data-start="1432.29" data-end="1433.46">you're trying to write a language that</span> <span data-start="1433.46" data-end="1435.05">compiles to JavaScript there's kind of</span> <span data-start="1435.05" data-end="1437.36">two approaches you can take if you're</span> <span data-start="1437.36" data-end="1438.92">really making a full-fledged language</span> <span data-start="1438.92" data-end="1440.3">what you probably want to do is actually</span> <span data-start="1440.3" data-end="1442.67">build up a parse tree and then have a</span> <span data-start="1442.67" data-end="1444.29">separate code generation phase where you</span> <span data-start="1444.29" data-end="1446.63">walk over the parse tree and generate</span> <span data-start="1446.63" data-end="1450.26">the code but I'm going to kind of cheat</span> <span data-start="1450.26" data-end="1453.11">here and because my language really kind</span> <span data-start="1453.11" data-end="1454.64">of maps to the same semantics as</span> </p>
<p><span data-start="1454.64" data-end="1457.79">JavaScript I'm just gonna build up</span> <span data-start="1457.79" data-end="1459.65">JavaScript strings and then at the end</span> <span data-start="1459.65" data-end="1461.3">concatenate them all together and I'm</span> <span data-start="1461.3" data-end="1464">going to have my program so that's what</span> <span data-start="1464" data-end="1465.59">I'm doing for the variable declarations</span> <span data-start="1465.59" data-end="1466.94">here I'm basically just building up a</span> <span data-start="1466.94" data-end="1469.88">string that begins with var inserts the</span> <span data-start="1469.88" data-end="1472.55">the variable name puts the equal sign</span> <span data-start="1472.55" data-end="1475.69">and the expression and a semicolon and</span> <span data-start="1475.69" data-end="1480.02">when I parse my little example looks</span> <span data-start="1480.02" data-end="1481.79">much better right so so you can see I've</span> <span data-start="1481.79" data-end="1484.22">actually got like you know something is</span> <span data-start="1484.22" data-end="1485.51">starting to look like a like a</span> <span data-start="1485.51" data-end="1487.52">JavaScript variable declaration there I</span> <span data-start="1487.52" data-end="1489.95">just need to clean up a few other things</span> <span data-start="1489.95" data-end="1493.13">and just like before we can use semantic</span> <span data-start="1493.13" data-end="1495.32">actions to clean up the parse tree so</span> </p>
<p><span data-start="1495.32" data-end="1497.12">I'm going to concatenate everything</span> <span data-start="1497.12" data-end="1500.77">together in an expression and flatten it</span> <span data-start="1500.77" data-end="1503.93">and it's getting better so now now I</span> <span data-start="1503.93" data-end="1508.22">actually have a full basically valid</span> <span data-start="1508.22" data-end="1512.63">variable declaration there and I'll do</span> <span data-start="1512.63" data-end="1514.84">the same for the per at the program rule</span> <span data-start="1514.84" data-end="1518.65">to basically clean up the rest of it and</span> <span data-start="1518.65" data-end="1522.2">bam I actually you know there we've</span> <span data-start="1522.2" data-end="1524.66">actually compiled a language which is</span> <span data-start="1524.66" data-end="1527.08">not JavaScript although it resembles it</span> <span data-start="1527.08" data-end="1536.93">into valid JavaScript</span> <span data-start="1536.94" data-end="1540.19">so this is not quite a Turing complete</span> <span data-start="1540.19" data-end="1541.69">language so maybe I've cheated a little</span> <span data-start="1541.69" data-end="1544.27">bit here but you can imagine it's it's</span> <span data-start="1544.27" data-end="1545.5">really not that hard</span> <span data-start="1545.5" data-end="1548.649">so you add in things like if statements</span> <span data-start="1548.649" data-end="1550.69">and loops so if any of you have thought</span> <span data-start="1550.69" data-end="1552.25">like you know I really want to design my</span> <span data-start="1552.25" data-end="1553.51">own language but I wouldn't know where</span> <span data-start="1553.51" data-end="1555.52">to begin I encourage you to go home you</span> <span data-start="1555.52" data-end="1556.69">can sit down and write something like</span> <span data-start="1556.69" data-end="1562.659">this a full language easily in a day so</span> </p>
<p><span data-start="1562.659" data-end="1567.76">I hope I've you know encouraged you to C</span> <span data-start="1567.76" data-end="1569.409">compilers is not being just this tool</span> <span data-start="1569.409" data-end="1572.77">that that kind of you you use but never</span> <span data-start="1572.77" data-end="1573.97">look at but but they're actually</span> <span data-start="1573.97" data-end="1576.34">something useful you can use to do</span> <span data-start="1576.34" data-end="1578.799">things you know both in JavaScript or if</span> <span data-start="1578.799" data-end="1580.96">you're looking for you know if you've</span> <span data-start="1580.96" data-end="1582.46">always wanted to design your own</span> <span data-start="1582.46" data-end="1584.59">language and I see people sometimes</span> <span data-start="1584.59" data-end="1588.88">using you know grep and and regular</span> <span data-start="1588.88" data-end="1591.399">expressions to do things and I just want</span> <span data-start="1591.399" data-end="1594.34">to like you know tell them like don't do</span> <span data-start="1594.34" data-end="1596.71">it it's so it's so error-prone it's</span> <span data-start="1596.71" data-end="1600.1">really not that hard to write a simple</span> <span data-start="1600.1" data-end="1603.669">parser for simple languages so if you</span> <span data-start="1603.669" data-end="1605.2">like more information I encourage you</span> <span data-start="1605.2" data-end="1608.95">guys to go check out on prima and pegged</span> <span data-start="1608.95" data-end="1612.34">ojs packages is still pretty early on</span> <span data-start="1612.34" data-end="1614.35">and I and I think you know they love</span> <span data-start="1614.35" data-end="1616.409">contributors and people reporting bugs</span> <span data-start="1616.409" data-end="1619.48">and if you'd like to see more details on</span> <span data-start="1619.48" data-end="1621.97">the code that I showed it's up on github</span> <span data-start="1621.97" data-end="1624.37">you can check it out there and there's</span> <span data-start="1624.37" data-end="1627.88">also a URL for my slides so thanks oh</span> <span data-start="1627.88" data-end="1629.47">and I should add if you have any</span> <span data-start="1629.47" data-end="1630.82">questions please come see me after the</span> <span data-start="1630.82" data-end="1644.09">talk thank</span> </p>
</section>