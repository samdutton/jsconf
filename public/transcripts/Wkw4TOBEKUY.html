<section>
<p><span data-start="17.859" data-end="18.859">Hi everyone.</span> <span data-start="18.859" data-end="19.859">I'm Will.</span> <span data-start="19.859" data-end="26.32">I work for the mobile web team in London.</span> <span data-start="26.32" data-end="27.669">- My name is Pavel.</span> </p>
<p><span data-start="27.669" data-end="28.669">From Moscow.</span> <span data-start="28.669" data-end="30.3">We both work for Badoo.</span> <span data-start="30.3" data-end="34.8">We built web and native applications.</span> <span data-start="34.8" data-end="38.76">More than 200 million users.</span> <span data-start="38.76" data-end="41.339">To meet eachother.</span> <span data-start="41.339" data-end="45.36">- I lead the mobile webteam.</span> </p>
<p><span data-start="45.36" data-end="50.199">We have been rearchitecting a lot at the api lab.</span> <span data-start="50.199" data-end="53.08">I'll talk about that.</span> <span data-start="53.08" data-end="54.759">The problems with Api.</span> <span data-start="54.759" data-end="58.62">Pavel is going to discuss details.</span> <span data-start="58.62" data-end="60.32">About how we have implemented that.</span> <span data-start="60.32" data-end="67.92">And I'll finish with examples of how we used the tools.</span> <span data-start="67.92" data-end="68.92">What is an Api?</span> <span data-start="68.92" data-end="73.93">It is an application programming interface.</span> <span data-start="73.93" data-end="81.18">In simple terms connecting your client side and backend together, transferring data between</span> <span data-start="81.18" data-end="83.11">the two.</span> <span data-start="83.11" data-end="91.54">General operations, inputs, outputs, and has some type semantics around that.</span> <span data-start="91.54" data-end="98.01">It is independent of the implementation we are using to create it.</span> </p>
<p><span data-start="98.01" data-end="99.56">Simple.</span> <span data-start="99.56" data-end="103.909">So, what are the requirements for building a good api.</span> <span data-start="103.909" data-end="105.93">We want a perfect want.</span> <span data-start="105.93" data-end="109.75">It wants to work and be magic.</span> <span data-start="109.75" data-end="117.74">Wants to be flexible, extensible, testable, maintainable and platform and language neutral.</span> <span data-start="117.74" data-end="121.2">Most of all, we are on it together.</span> <span data-start="121.2" data-end="127.5">We want to focus building great features and not the bytes over the web.</span> <span data-start="127.5" data-end="131.7">How can you split up in 3 areas?</span> <span data-start="131.7" data-end="132.739">You have encoding.</span> <span data-start="132.739" data-end="136.56">This is what you send over the world.</span> <span data-start="136.56" data-end="139.59">Format of the data we are sending.</span> <span data-start="139.59" data-end="145.72">Then we have rules about what messages we want to send and how we deal with them.</span> <span data-start="145.72" data-end="147.01">Client server side.</span> </p>
<p><span data-start="147.01" data-end="150.59">We have the messages from A to B.</span> <span data-start="150.59" data-end="156.43">We want general help.</span> <span data-start="156.43" data-end="159.15">And general validation that we do on the messages.</span> <span data-start="159.15" data-end="164.04">How does it look in a classic Api example?</span> <span data-start="164.04" data-end="171.56">We build in web applications that rely on the common technologies.</span> <span data-start="171.56" data-end="179.72">So, typically in the application you are going to make Ajax request, encode it.</span> <span data-start="179.72" data-end="183.94">The server is going to match that.</span> <span data-start="183.94" data-end="190.97">We have some Php or Node logic that will format that data in the response we want.</span> <span data-start="190.97" data-end="193.09">Send it back through the system.</span> <span data-start="193.09" data-end="201.77">Parse it and code it and go through similar validation and use it in the business logic.</span> <span data-start="201.77" data-end="204.62">But what are some of the problems we see?</span> </p>
<p><span data-start="204.62" data-end="208.25">And why we haven't chosen this?</span> <span data-start="208.25" data-end="213.91">Well, we have 2 different encoding semantics.</span> <span data-start="213.91" data-end="216.69">That looks symmetric.</span> <span data-start="216.69" data-end="220.709">But server side we are sending Json.</span> <span data-start="220.709" data-end="225.91">Client we are coding it in url.</span> <span data-start="225.91" data-end="228.269">What happens if we want to send back data the other way?</span> <span data-start="228.269" data-end="234.9">We are limited when using this example.</span> <span data-start="234.9" data-end="237.75">And the server.</span> <span data-start="237.75" data-end="240.92">What we want to initiate.</span> <span data-start="240.92" data-end="244.45">We can use web sockets.</span> </p>
<p><span data-start="244.45" data-end="249.55">Then we have to have another layer of system that deals with the logic.</span> <span data-start="249.55" data-end="253.5">We can't build it all into the same thing easily.</span> <span data-start="253.5" data-end="256.28">And, data access.</span> <span data-start="256.28" data-end="264.15">There is no, when we build an Api, we have different parts of the company dealing with</span> <span data-start="264.15" data-end="266.949">eachother.</span> </p>
<p><span data-start="266.949" data-end="268.24">How this is going to work.</span> <span data-start="268.24" data-end="277.439">We don't have some process defined in the use of the Api that we can use in showing.</span> <span data-start="277.439" data-end="279.43">We don't have the versioning.</span> <span data-start="279.43" data-end="282.069">And have duplicate code.</span> <span data-start="282.069" data-end="286.919">So, Badoo's Api's.</span> <span data-start="286.919" data-end="290.539">How does it fit in the things we are doing?</span> <span data-start="290.539" data-end="293.919">We have a lot of databases in memory caches.</span> <span data-start="293.919" data-end="298.36">That allows us to scale to 200 million users.</span> <span data-start="298.36" data-end="306.979">They are connected via some native, binary interface to a core web Api.</span> </p>
<p><span data-start="306.979" data-end="309.969">That is in Php.</span> <span data-start="309.969" data-end="312.479">We have the desktop side.</span> <span data-start="312.479" data-end="319.129">Which connects and builds the feature.</span> <span data-start="319.129" data-end="322.169">It didn't suit mobile.</span> <span data-start="322.169" data-end="328.9">We have a mobile Api core that sits and presents a different view.</span> </p>
<p><span data-start="328.9" data-end="337.479">We have applications for Ios, Android and Windows.</span> <span data-start="337.479" data-end="341.319">Then the first thing we did was, we have a desktop and native side.</span> <span data-start="341.319" data-end="345.779">We don't have a mobile website.</span> <span data-start="345.779" data-end="347.83">We had designs for mobile.</span> <span data-start="347.83" data-end="351.88">We decided to build a feature of the site.</span> <span data-start="351.88" data-end="353.159">That connects.</span> <span data-start="353.159" data-end="355.96">That uses Java as technology.</span> <span data-start="355.96" data-end="358.389">And the same interface.</span> <span data-start="358.389" data-end="367.24">Then, 18 months, 2 years ago, we wanted a single page for web application.</span> </p>
<p><span data-start="367.24" data-end="371.3">We connected it to the mobile api.</span> <span data-start="371.3" data-end="373.229">We didn't.</span> <span data-start="373.229" data-end="378.669">Sadly, we couldn't use the binary technology out of the box.</span> <span data-start="378.669" data-end="383.27">We had another Api layer on top of the Java.</span> <span data-start="383.27" data-end="388.3">And a semi service there.</span> <span data-start="388.3" data-end="393.259">Recently, we have been joining the back direction.</span> <span data-start="393.259" data-end="398.619">Pavel will talk about some of the ways we used the experiences.</span> <span data-start="398.619" data-end="405.74">And allowed us to encode it in a more web friendly way.</span> <span data-start="405.74" data-end="408.3">- I will talk about the solution we used.</span> <span data-start="408.3" data-end="413.46">And key points you should keep in mind.</span> <span data-start="413.46" data-end="416.869">There are a lot of implementations on market.</span> <span data-start="416.869" data-end="419.21">But some of them are overengineered.</span> <span data-start="419.21" data-end="423.33">Some have too much Xml inside.</span> </p>
<p><span data-start="423.33" data-end="429.939">Forces to write in readable language.</span> <span data-start="429.939" data-end="437.119">Let's take all the best parts and build our own.</span> <span data-start="437.119" data-end="442.279">We want to tell you about building another universal Api.</span> <span data-start="442.279" data-end="446.839">You know what happens if you try to build a universal solution which solves all the</span> <span data-start="446.839" data-end="448.699">problems.</span> <span data-start="448.699" data-end="455.479">I will tell you about the problems we found during the protocol design and how we have</span> <span data-start="455.479" data-end="457.939">solved them.</span> <span data-start="457.939" data-end="459.539">What should be the protocol values?</span> <span data-start="459.539" data-end="468.969">First of all we want to have a protocol description which is independent from language and platform.</span> <span data-start="468.969" data-end="477.249">We want Api to be available for all platforms, including Java, objective C. All the stuff.</span> <span data-start="477.249" data-end="481.129">We want to be it Cpu and network efficient.</span> <span data-start="481.129" data-end="483.06">On the same platforms.</span> <span data-start="483.06" data-end="488.909">We want to have a nice data access class.</span> <span data-start="488.909" data-end="497.06">We want, we don't want to have a config with all the roads, to send a message to get something</span> <span data-start="497.06" data-end="499.83">back.</span> </p>
<p><span data-start="499.83" data-end="503.5">We want to put it inside the protocol.</span> <span data-start="503.5" data-end="510.139">And of course, because we are feature rich product, and we want to deliver new features</span> <span data-start="510.139" data-end="512.77">fast, we want to have versioning.</span> <span data-start="512.77" data-end="519.83">All of you know how long it takes to get from Google and Apple.</span> <span data-start="519.83" data-end="525.089">And the users don't update instantly.</span> <span data-start="525.089" data-end="529.08">So we decided to look at Google protocol buffers.</span> <span data-start="529.08" data-end="532.839">Used in the backend communication.</span> <span data-start="532.839" data-end="537.12">And try to bring it to client server communication.</span> <span data-start="537.12" data-end="546.18">We can take a look at the same diagram we have.</span> <span data-start="546.18" data-end="547.18">Both sides.</span> <span data-start="547.18" data-end="553.18">We want to have a kind of event based system to handle all the messages and take decision</span> <span data-start="553.18" data-end="558.06">what comes to the other end.</span> </p>
<p><span data-start="558.06" data-end="562">We have a generated class with nice Api.</span> <span data-start="562" data-end="566.3">Dependent on a protocol which can be different.</span> <span data-start="566.3" data-end="571.17">We want protocol description.</span> <span data-start="571.17" data-end="577.47">We want to automate as much as possible.</span> <span data-start="577.47" data-end="581.68">So, let's take a closer look at Google Protocol Buffers.</span> <span data-start="581.68" data-end="586.8">They have a nice interface language.</span> <span data-start="586.8" data-end="589.48">All the features that we need.</span> <span data-start="589.48" data-end="591.44">Internal representation is very good.</span> <span data-start="591.44" data-end="595.839">We can easily extend their protocol.</span> <span data-start="595.839" data-end="597.459">Itself.</span> </p>
<p><span data-start="597.459" data-end="602.59">In case we have to patch the compiler, things like that.</span> <span data-start="602.59" data-end="604.05">In terms of language support.</span> <span data-start="604.05" data-end="608.87">It ships support for C++, Java and Python.</span> <span data-start="608.87" data-end="621.459">At 2009, when we started looking at it, there was no support for Php.</span> <span data-start="621.459" data-end="626.98">Plugins allow you to write your own language you need.</span> </p>
<p><span data-start="626.98" data-end="630.17">Encoding is network and Cpu efficient.</span> <span data-start="630.17" data-end="632.81">It is binary.</span> <span data-start="632.81" data-end="641.05">There are a lot of comparisons that are efficient.</span> <span data-start="641.05" data-end="646.86">Let's take a look at details of Google Buffers.</span> <span data-start="646.86" data-end="651.759">Description language has a number of entities.</span> <span data-start="651.759" data-end="658.089">Enumerations, messages, fields and simple service layer.</span> <span data-start="658.089" data-end="663.55">All of the entities have options.</span> <span data-start="663.55" data-end="666.11">Which describe details of the message.</span> <span data-start="666.11" data-end="668.07">But isn't passed.</span> <span data-start="668.07" data-end="677.24">The main advantage of Google implementation of the compiler and the language itself.</span> <span data-start="677.24" data-end="681.189">Is that is self describing.</span> <span data-start="681.189" data-end="684.98">It is a protocol buffers message.</span> <span data-start="684.98" data-end="690.579">It is brilliant stuff.</span> </p>
<p><span data-start="690.579" data-end="692.22">Let's look at details.</span> <span data-start="692.22" data-end="698.48">Field can be repeated, optional or required.</span> <span data-start="698.48" data-end="702.87">The message wants validated.</span> <span data-start="702.87" data-end="707.37">It can be an array.</span> <span data-start="707.37" data-end="710.029">0 of that field.</span> <span data-start="710.029" data-end="716.579">Interface description language has a wide type system.</span> <span data-start="716.579" data-end="722.31">Including messages and enumerations, which allow to describe structures.</span> <span data-start="722.31" data-end="725.24">And, all the fields have numbers.</span> <span data-start="725.24" data-end="727.73">Field numbers give us versioning.</span> </p>
<p><span data-start="727.73" data-end="729.35">I will talk about that later.</span> <span data-start="729.35" data-end="733.35">A couple of examples.</span> <span data-start="733.35" data-end="741.339">We had required, user field.</span> <span data-start="741.339" data-end="746.029">Here is a small example of how does a message look in the profile.</span> <span data-start="746.029" data-end="750.399">William will give examples later.</span> <span data-start="750.399" data-end="758.31">So, we have a nice description language we can describe the protocol.</span> <span data-start="758.31" data-end="764.25">Let's find out what we should actually use in application code.</span> <span data-start="764.25" data-end="769.35">We have only binary importing.</span> </p>
<p><span data-start="769.35" data-end="773.48">We have a simple Rpc.</span> <span data-start="773.48" data-end="775.639">And we don't have native support.</span> <span data-start="775.639" data-end="778.149">Only third party solutions.</span> <span data-start="778.149" data-end="781.8">Which have a bit different infrastructure.</span> <span data-start="781.8" data-end="789.57">So, why we have chosen the solution so much parts of which we don't like?</span> <span data-start="789.57" data-end="792.149">Actually, there is an answer.</span> <span data-start="792.149" data-end="797.94">It is because protocol buffer compiler.</span> <span data-start="797.94" data-end="805.36">They allow us to implement our own coding, generate our own classes.</span> <span data-start="805.36" data-end="808.34">And nicely decouple all these things from eachother.</span> <span data-start="808.34" data-end="814.16">The infrastructure is nice.</span> <span data-start="814.16" data-end="818.699">You can write a plugin in 20 lines.</span> <span data-start="818.699" data-end="824.089">There will be an example later.</span> </p>
<p><span data-start="824.089" data-end="830.23">You can write compiler plugins at any language you like and generate the code at language</span> <span data-start="830.23" data-end="832.839">that you need.</span> <span data-start="832.839" data-end="838.74">This architecture makes it completely independent of all the parts.</span> <span data-start="838.74" data-end="842.38">From the serialisation.</span> <span data-start="842.38" data-end="847.129">So, return to the picture.</span> <span data-start="847.129" data-end="848.949">We started with.</span> <span data-start="848.949" data-end="851.379">We have Badoo Api's.</span> <span data-start="851.379" data-end="855.189">On this diagram.</span> <span data-start="855.189" data-end="864.829">We use native encoding for native clients, for communication between Php and services.</span> <span data-start="864.829" data-end="873.499">We want to use Json encoding between our side and the mobile browsers.</span> <span data-start="873.499" data-end="882.319">We want to build our own solution, which encodes protocol buffers in Json.</span> <span data-start="882.319" data-end="885.24">It appears to be quite performant.</span> <span data-start="885.24" data-end="886.809">It is not a problem.</span> </p>
<p><span data-start="886.809" data-end="889.399">We can easily plug in serialisation.</span> <span data-start="889.399" data-end="891.149">Or xml.</span> <span data-start="891.149" data-end="904.189">So, we have to  generate the classes.</span> <span data-start="904.189" data-end="906.95">Simplified development process.</span> <span data-start="906.95" data-end="911.959">Auto generate all of that.</span> <span data-start="911.959" data-end="913.73">We change something.</span> <span data-start="913.73" data-end="919.309">We want to generate all the data access classes.</span> </p>
<p><span data-start="919.309" data-end="921.529">And all the stuff.</span> <span data-start="921.529" data-end="925.29">On mobile developer infrastructure.</span> <span data-start="925.29" data-end="928.99">We have a task.</span> <span data-start="928.99" data-end="931.6">On the website more control over backend.</span> <span data-start="931.6" data-end="939.839">We can generate code only in case that it is newer than generated code.</span> <span data-start="939.839" data-end="944.529">On production we do the generation on deploy process.</span> <span data-start="944.529" data-end="952.519">So, we have a nice interface description language, a tool which auto generates all the classes.</span> <span data-start="952.519" data-end="955.93">And we have a nice encoding we are happy with.</span> <span data-start="955.93" data-end="958.56">Let's talk about message exchange.</span> <span data-start="958.56" data-end="964.269">So, out of the box we have services.</span> <span data-start="964.269" data-end="965.43">Simple implementation.</span> <span data-start="965.43" data-end="973.11">Rpc is an ability of one node to call procedure on another node without knowing the implementation</span> <span data-start="973.11" data-end="974.11">details.</span> <span data-start="974.11" data-end="984.509">For me, the services from Google Buffers are too simple for complex application.</span> <span data-start="984.509" data-end="989.11">We need a protocol layer.</span> </p>
<p><span data-start="989.11" data-end="994.6">Which contains message ID, global protocol service.</span> <span data-start="994.6" data-end="998.83">All will be in a message.</span> <span data-start="998.83" data-end="1005.26">Also we have dependencies that we want 2 way Rpc.</span> <span data-start="1005.26" data-end="1013.79">We need to be able to call procedure on a client.</span> <span data-start="1013.79" data-end="1016.269">To deal with the right client.</span> <span data-start="1016.269" data-end="1017.269">Ask for operator.</span> <span data-start="1017.269" data-end="1018.939">We control the server.</span> </p>
<p><span data-start="1018.939" data-end="1022.689">And we can deploy a number of minutes.</span> <span data-start="1022.689" data-end="1027.03">But we don't control..</span> <span data-start="1027.03" data-end="1030.829">Sorry.</span> <span data-start="1030.829" data-end="1033.11">Plan control is harder.</span> <span data-start="1033.11" data-end="1042.029">So, and, we built our own Rpc implementation.</span> </p>
<p><span data-start="1042.029" data-end="1046.02">We call it two way Rpc.</span> <span data-start="1046.02" data-end="1051.64">Rpc class takes a parameter the common idea and message.</span> <span data-start="1051.64" data-end="1057.57">You can subscribe to any message that came from the backend.</span> <span data-start="1057.57" data-end="1065.169">If you want to listen to all Rpc messages, you can subscribe on Rpc any layer.</span> <span data-start="1065.169" data-end="1069.69">And listen to all responses that could come from the server.</span> <span data-start="1069.69" data-end="1074.54">You can think about this as a back way server.</span> <span data-start="1074.54" data-end="1076.789">Procedure on a client.</span> <span data-start="1076.789" data-end="1085.12">The call back we receive our nice generated class with all the types validated.</span> <span data-start="1085.12" data-end="1089.75">You don't need to worry about field existance.</span> <span data-start="1089.75" data-end="1095.78">And actually we use entities we had at the protocol.</span> <span data-start="1095.78" data-end="1099.429">The enumeration for message ID.</span> <span data-start="1099.429" data-end="1100.88">Requesting the response.</span> <span data-start="1100.88" data-end="1103.34">Normal messages.</span> <span data-start="1103.34" data-end="1108.27">Last but not least.</span> <span data-start="1108.27" data-end="1109.32">Versioning is very important.</span> <span data-start="1109.32" data-end="1114.85">We have out of the box per field versioning.</span> </p>
<p><span data-start="1114.85" data-end="1120.57">When you pass a new field to a client which doesn't know about it, it will ignore it.</span> <span data-start="1120.57" data-end="1122.26">Because of field number.</span> <span data-start="1122.26" data-end="1123.751">I have told earlier.</span> <span data-start="1123.751" data-end="1132.279">Because of Rpc implementation, we can ignore unsupported comments.</span> <span data-start="1132.279" data-end="1133.53">On a client.</span> <span data-start="1133.53" data-end="1137.37">Also, because we use only generated data access classes.</span> <span data-start="1137.37" data-end="1143.63">In case you have removed some field in protocol and try to use it in a client.</span> <span data-start="1143.63" data-end="1145.64">You will receive errors.</span> <span data-start="1145.64" data-end="1149.76">That it doesn't exist.</span> <span data-start="1149.76" data-end="1154.56">So, in the end, you should define protocol in 1 way.</span> <span data-start="1154.56" data-end="1155.79">In 1 place.</span> </p>
<p><span data-start="1155.79" data-end="1164.89">You should use generated classes to abstract protocol internals from the application code.</span> <span data-start="1164.89" data-end="1170.169">You should have validation inside those generated classes.</span> <span data-start="1170.169" data-end="1178.789">To be able to switch like even complete protocol implementation inside.</span> <span data-start="1178.789" data-end="1186.46">You can, this way allows you to have different encodings depending on a situation.</span> <span data-start="1186.46" data-end="1193.4">You have a Rpc layer, a lot of protocol details.</span> <span data-start="1193.4" data-end="1202.899">And gives you simple, you listen what you want.</span> <span data-start="1202.899" data-end="1206.71">And helps you to focus on features, not the protocol details.</span> <span data-start="1206.71" data-end="1210">Versioning is also very critical.</span> </p>
<p><span data-start="1210" data-end="1215.899">So, if you go this way, you'll end up with implementation which actually, everything</span> <span data-start="1215.899" data-end="1216.899">decoupled.</span> <span data-start="1216.899" data-end="1228.6">And now Will will give you a couple of realworld examples of what we have built.</span> <span data-start="1228.6" data-end="1232.799">- Thank you.</span> <span data-start="1232.799" data-end="1236.029">So, now we have all the tools.</span> <span data-start="1236.029" data-end="1240.11">We want to put them together and go through it.</span> <span data-start="1240.11" data-end="1243.029">So, this is a mobile app.</span> <span data-start="1243.029" data-end="1246.45">We have a couple of apps.</span> <span data-start="1246.45" data-end="1248.26">This is a screen.</span> <span data-start="1248.26" data-end="1250.35">And we type in a city.</span> <span data-start="1250.35" data-end="1252.95">Change location.</span> <span data-start="1252.95" data-end="1257.2">We want to click on it and save the location.</span> <span data-start="1257.2" data-end="1261.07">So, what details do we need to build that service?</span> <span data-start="1261.07" data-end="1262.07">Simple.</span> <span data-start="1262.07" data-end="1264.01">Send a city name.</span> <span data-start="1264.01" data-end="1265.24">The part of the city name.</span> </p>
<p><span data-start="1265.24" data-end="1269.67">And we come back with an ID, list of cities.</span> <span data-start="1269.67" data-end="1280.73">And I'm going to talk about, 2 way Rpc.</span> <span data-start="1280.73" data-end="1282.33">Communication as well.</span> <span data-start="1282.33" data-end="1284.58">We also want a client notification.</span> <span data-start="1284.58" data-end="1293.669">The service saying, some reason of state that we need a warning message be displayed.</span> <span data-start="1293.669" data-end="1296.799">These are the protocol definition messages you need to define.</span> <span data-start="1296.799" data-end="1299.5">The first is the enum messagetype.</span> <span data-start="1299.5" data-end="1306.08">Definds the command that we send one way or the server sends back.</span> </p>
<p><span data-start="1306.08" data-end="1309.47">We use the convention here.</span> <span data-start="1309.47" data-end="1311.92">Messages from the client to the server.</span> <span data-start="1311.92" data-end="1312.97">Start with Server.</span> <span data-start="1312.97" data-end="1316.72">And back to the client, start with client.</span> <span data-start="1316.72" data-end="1321.21">It is about readability.</span> <span data-start="1321.21" data-end="1324.58">Then we define the messages for the data we have to send.</span> <span data-start="1324.58" data-end="1326.9">So for city query.</span> <span data-start="1326.9" data-end="1329.929">We have a string.</span> <span data-start="1329.929" data-end="1337.6">And we deliberately try to make the messages semantic.</span> <span data-start="1337.6" data-end="1347.73">We find that being specific about the types of message we send, allows us to see the code.</span> <span data-start="1347.73" data-end="1352.13">And then the response coming back can be a city.</span> <span data-start="1352.13" data-end="1354.38">We have repeated city object.</span> <span data-start="1354.38" data-end="1357.57">Which allows you to nest these things nice.</span> <span data-start="1357.57" data-end="1360.71">And you get a structure.</span> <span data-start="1360.71" data-end="1364.92">Finally, you have client notification message.</span> <span data-start="1364.92" data-end="1370.86">An ID and message.</span> </p>
<p><span data-start="1370.86" data-end="1377.309">Before we move on, there are core things we have to define once.</span> <span data-start="1377.309" data-end="1379.13">Wrapper message.</span> <span data-start="1379.13" data-end="1382.75">We have the initial message.</span> <span data-start="1382.75" data-end="1387.4">Everything that is contained that is sent.</span> <span data-start="1387.4" data-end="1391.62">A version and message ID and a message body.</span> <span data-start="1391.62" data-end="1397.14">We fill the message body with this type of message.</span> <span data-start="1397.14" data-end="1406.09">And the way it works, you can fill that in with optional fields and you have it available</span> <span data-start="1406.09" data-end="1407.45">for you.</span> </p>
<p><span data-start="1407.45" data-end="1409.73">This is a generated class example.</span> <span data-start="1409.73" data-end="1411.52">The details don't matter.</span> <span data-start="1411.52" data-end="1415.15">A couple of things to take away.</span> <span data-start="1415.15" data-end="1420.59">There is a base class we have control over.</span> <span data-start="1420.59" data-end="1425.49">You don't have to edit it on a day to day basis.</span> <span data-start="1425.49" data-end="1428.46">Some generic validation for you.</span> <span data-start="1428.46" data-end="1431.45">Make sure everything is happening properly.</span> </p>
<p><span data-start="1431.45" data-end="1438.76">Here we have the descriptive information that we pulled out when we did the generation stage</span> <span data-start="1438.76" data-end="1444.61">from the message into the actual generated class.</span> <span data-start="1444.61" data-end="1447.779">And then the same thing for peer to peer.</span> <span data-start="1447.779" data-end="1450.81">You can generate it into java.</span> <span data-start="1450.81" data-end="1455.96">We have extended a base class.</span> <span data-start="1455.96" data-end="1461">And we have a descriptor information, specific how we want to format it.</span> <span data-start="1461" data-end="1465.11">Now we have a generated classes.</span> <span data-start="1465.11" data-end="1470.799">And we are ready to start using it with the library.</span> <span data-start="1470.799" data-end="1474.23">So, we want to make a new Rpc call.</span> <span data-start="1474.23" data-end="1478.86">And send server search cities.</span> <span data-start="1478.86" data-end="1480.649">From client to server.</span> <span data-start="1480.649" data-end="1487.99">And we want to give that a city query object which contains the data that we want to query.</span> <span data-start="1487.99" data-end="1489.659">We have to build a new city query.</span> </p>
<p><span data-start="1489.659" data-end="1491.559">We pass it in.</span> <span data-start="1491.559" data-end="1497">Once we have done that, we need to bind some events in.</span> <span data-start="1497" data-end="1501">We want to listen in this case to client cities.</span> <span data-start="1501" data-end="1504.13">And we want to pass that to a call back.</span> <span data-start="1504.13" data-end="1507.46">So, this is kind of node style.</span> <span data-start="1507.46" data-end="1510.53">We pass in an error and city object.</span> <span data-start="1510.53" data-end="1514.41">We can handle the error or ignore it.</span> <span data-start="1514.41" data-end="1520.38">And loop through the list of cities.</span> <span data-start="1520.38" data-end="1524.37">Likewise we can listen to the client notification event here.</span> <span data-start="1524.37" data-end="1528.22">And pass that into a call back.</span> <span data-start="1528.22" data-end="1532.83">And then finally, we send, file a request with function.</span> <span data-start="1532.83" data-end="1538.19">That sends it off to the server and we see for response.</span> <span data-start="1538.19" data-end="1542.779">We said that we want to do a notification on any situation.</span> </p>
<p><span data-start="1542.779" data-end="1546.54">We don't want to have to go and do with every Rpc.</span> <span data-start="1546.54" data-end="1550.639">We want to bind that into the Rpc any call.</span> <span data-start="1550.639" data-end="1556.179">We want to remove that on client notification message there.</span> <span data-start="1556.179" data-end="1562.37">And create an Rpc on any call, we can find it generically.</span> </p>
<p><span data-start="1562.37" data-end="1563.85">Any message that we send.</span> <span data-start="1563.85" data-end="1567.62">Or if we use a different communication channel.</span> <span data-start="1567.62" data-end="1578.01">Websockets or other kinds of service enabled, that can be pulled out.</span> <span data-start="1578.01" data-end="1580.72">So, that's the end of the examples.</span> <span data-start="1580.72" data-end="1584.53">And this is a quick summary of what we have gone through.</span> </p>
<p><span data-start="1584.53" data-end="1588.09">We have discussed Rest and Json.</span> <span data-start="1588.09" data-end="1590.76">Why it wasn't suitable.</span> <span data-start="1590.76" data-end="1592.44">Gone through the protocol values.</span> <span data-start="1592.44" data-end="1595.96">And a few examples.</span> <span data-start="1595.96" data-end="1598.1">So, these are the contact details.</span> <span data-start="1598.1" data-end="1603.58">The slides will be up at Techblog.Badoo.Com.</span> </p>
</section>