<section>
<p><span data-start="15.38" data-end="17.99">so my name is Andy Wingo I work for a</span> <span data-start="17.99" data-end="20.39">company out of Spain called Eagle iya we</span> <span data-start="20.39" data-end="22.16">do a lot of consulting around WebKit and</span> <span data-start="22.16" data-end="25.16">as such I've gotten into javascriptcore</span> <span data-start="25.16" data-end="27.77">a bit javascriptcore is the the</span> <span data-start="27.77" data-end="30.529">javascript engine of the WebKit project</span> <span data-start="30.529" data-end="33.95">itself in fact a bit on VA before on</span> <span data-start="33.95" data-end="36.19">JavaScript core but in reality I'm a</span> <span data-start="36.19" data-end="38.84">traveler in foreign lands here's my</span> <span data-start="38.84" data-end="42.8">heart is from scheme language so it's</span> <span data-start="42.8" data-end="44">interesting coming into these</span> <span data-start="44" data-end="45.8">implications from the outside and seeing</span> <span data-start="45.8" data-end="48.11">you know what's really going on and the</span> <span data-start="48.11" data-end="51.02">tag for this talk had a bit of hubris</span> <span data-start="51.02" data-end="54.86">associate with it I think claiming that</span> </p>
<p><span data-start="54.86" data-end="56.96">JavaScript cores as fast as v8 on its</span> <span data-start="56.96" data-end="60.29">own benchmark and as we'll see that that</span> <span data-start="60.29" data-end="63.53">claim has a shape to it and some of that</span> <span data-start="63.53" data-end="66.619">shape is true and some that shape is not</span> <span data-start="66.619" data-end="70.22">quite true yet but let's take a look at</span> <span data-start="70.22" data-end="73.04">the DFG at the optimizing compiler of</span> <span data-start="73.04" data-end="76.25">the JavaScript core engine and see you</span> <span data-start="76.25" data-end="79.939">know what is it that it actually does so</span> <span data-start="79.939" data-end="82.719">it as I mention the the DFG is</span> <span data-start="82.719" data-end="85.63">JavaScript course optimizing compiler</span> <span data-start="85.63" data-end="88.069">you know the standard architecture of</span> <span data-start="88.069" data-end="89.509">these JavaScript engines is you have</span> <span data-start="89.509" data-end="91.52">something for dealing with cold code and</span> <span data-start="91.52" data-end="92.96">something for dealing with hot code and</span> <span data-start="92.96" data-end="95.03">for javascriptcore we have the low-level</span> <span data-start="95.03" data-end="97.13">interpreter for very cold code there's</span> <span data-start="97.13" data-end="98.96">an intermediate phase with what we call</span> <span data-start="98.96" data-end="101.42">the baseline JIT which is a jit that</span> <span data-start="101.42" data-end="103.52">doesn't do any global analysis or</span> <span data-start="103.52" data-end="105.289">optimization and then we have the DFG</span> <span data-start="105.289" data-end="107.569">jutt which is able to take a bit more</span> <span data-start="107.569" data-end="109.49">time it has a bit more information and</span> <span data-start="109.49" data-end="111.499">it take a bit more of a global view on</span> <span data-start="111.499" data-end="114.469">your program so this much is fairly well</span> <span data-start="114.469" data-end="116.719">known but I don't think it's very you</span> <span data-start="116.719" data-end="119.119">know well understood you know what what</span> <span data-start="119.119" data-end="120.74">it is that this engine does with your</span> <span data-start="120.74" data-end="122.929">code and how it works and you know what</span> <span data-start="122.929" data-end="124.759">does performance characteristics are so</span> </p>
<p><span data-start="124.759" data-end="126.709">I would like to take a more empirical</span> <span data-start="126.709" data-end="129.229">approach to it I would like to you know</span> <span data-start="129.229" data-end="132.56">measure the dfgg it and see how it does</span> <span data-start="132.56" data-end="134.45">on various representative test cases and</span> <span data-start="134.45" data-end="137.15">see ya when it does this when when is it</span> <span data-start="137.15" data-end="138.8">kick in what are its dynamic</span> <span data-start="138.8" data-end="140.81">characteristics not simply you know</span> <span data-start="140.81" data-end="143">performance as a number which is great</span> <span data-start="143" data-end="144.98">for the marketing folks but performance</span> <span data-start="144.98" data-end="146.84">as a shape and distribution which is</span> <span data-start="146.84" data-end="149.12">much more interesting from a perspective</span> <span data-start="149.12" data-end="151.67">understanding the software I'd also take</span> <span data-start="151.67" data-end="154.36">like to take a look at the assembly code</span> <span data-start="154.36" data-end="156.92">that is produced by this so I promise it</span> <span data-start="156.92" data-end="158.599">won't be all assembly back I think it's</span> <span data-start="158.599" data-end="160.01">kind of interesting to see how your</span> <span data-start="160.01" data-end="162.2">javascript is translated into what</span> <span data-start="162.2" data-end="165.65">machine code when you run on a browser</span> <span data-start="165.65" data-end="169.73">with javascript poor so as my tool in</span> <span data-start="169.73" data-end="171.829">this regard i'm going to use the the v8</span> <span data-start="171.829" data-end="175.78">benchmarks v8 version 7 benchmarks and</span> <span data-start="175.78" data-end="178.909">these benchmarks are really geared</span> <span data-start="178.909" data-end="181.25">towards optimizing compilers right they</span> <span data-start="181.25" data-end="183.23">don't test anything else in your system</span> <span data-start="183.23" data-end="185.359">they test your optimizing the output of</span> <span data-start="185.359" data-end="187.37">your optimizing compiler and and also</span> <span data-start="187.37" data-end="189.89">your garbage collector as well and the</span> <span data-start="189.89" data-end="191.239">reason you can know about these is they</span> <span data-start="191.239" data-end="193.76">take quite a long time to run and they</span> <span data-start="193.76" data-end="195.349">take a long time I run because they take</span> <span data-start="195.349" data-end="198.59">a full second to warm up the code for</span> <span data-start="198.59" data-end="200.51">each benchmark and then they measure</span> <span data-start="200.51" data-end="204.59">over another second how they take a</span> <span data-start="204.59" data-end="206.359">number of iterations until you get up to</span> <span data-start="206.359" data-end="208.25">a second of iterations of these</span> <span data-start="208.25" data-end="210.68">benchmarks and they they divide the time</span> <span data-start="210.68" data-end="213.47">by the iterations and you get a time per</span> <span data-start="213.47" data-end="216.26">iteration and that that time ends up</span> <span data-start="216.26" data-end="217.819">going on the denominator of the results</span> <span data-start="217.819" data-end="219.98">so that you know higher values on the v8</span> <span data-start="219.98" data-end="221.989">benchmark as we all know actually</span> <span data-start="221.989" data-end="225.43">correspond to higher performance and so</span> <span data-start="225.43" data-end="227.78">it's very good for measuring you know</span> <span data-start="227.78" data-end="230.209">the best that your compiler can do but</span> <span data-start="230.209" data-end="232.239">it's it's not so good for you know</span> <span data-start="232.239" data-end="234.5">investigating characteristics of the</span> <span data-start="234.5" data-end="236.329">invitation I will take a look first</span> <span data-start="236.329" data-end="238.04">though it you know what are these</span> <span data-start="238.04" data-end="240.949">numbers I have a graph here i'm not sure</span> <span data-start="240.949" data-end="242.629">if these numbers are terribly visible to</span> <span data-start="242.629" data-end="246.319">y'all the green bars correspond to this</span> <span data-start="246.319" data-end="249.049">baseline JIT which doesn't do any global</span> <span data-start="249.049" data-end="250.819">analysis in the yellow bars correspond</span> <span data-start="250.819" data-end="253.099">to the DFG jet which is the optimizing</span> <span data-start="253.099" data-end="254.54">compiler and you can see on you know we</span> <span data-start="254.54" data-end="256.489">get three and four times improvements</span> <span data-start="256.489" data-end="258.289">except on the regular expression one</span> <span data-start="258.289" data-end="260.209">which I'll talk a little bit later about</span> <span data-start="260.209" data-end="262.88">now I want to also use this graph to</span> <span data-start="262.88" data-end="267.26">introduce a idea I'm trying to work on</span> <span data-start="267.26" data-end="268.88">this presentation it's probably not you</span> <span data-start="268.88" data-end="270.41">know finish and can be much better but</span> <span data-start="270.41" data-end="272.24">it's that you know performance is not</span> <span data-start="272.24" data-end="275.12">simply a number it is a distribution</span> <span data-start="275.12" data-end="277.88">that you can sample you need to take a</span> <span data-start="277.88" data-end="279.95">number of samples and see you know what</span> <span data-start="279.95" data-end="281.18">is the range of performance that I</span> <span data-start="281.18" data-end="283.28">expect so at the top of all these</span> <span data-start="283.28" data-end="285.08">bars I've got little histograms</span> <span data-start="285.08" data-end="287.06">superimposed I don't know what I'm doing</span> <span data-start="287.06" data-end="289.13">this quite right anyway but you can see</span> <span data-start="289.13" data-end="292.52">like for example on this DFG jet</span> <span data-start="292.52" data-end="294.2">histogram we see that they're all very</span> <span data-start="294.2" data-end="296.54">tightly clustered whereas on this other</span> <span data-start="296.54" data-end="298.82">dfgg histogram we have a bimodal</span> <span data-start="298.82" data-end="300.59">distribution they're pretty tight you</span> <span data-start="300.59" data-end="302">know but they're your performance tend</span> <span data-start="302" data-end="303.29">to cluster those two values and that's</span> <span data-start="303.29" data-end="304.49">something you really can't capture with</span> <span data-start="304.49" data-end="306.08">the median and I'm going to use this</span> <span data-start="306.08" data-end="309.08">sort of thing as we go forward to really</span> <span data-start="309.08" data-end="312.35">pull apart some of these benchmarks and</span> <span data-start="312.35" data-end="314.75">really I'm not going to use to the</span> <span data-start="314.75" data-end="317.96">straight v8 benchmarks to as my tool I'm</span> <span data-start="317.96" data-end="321.86">going to hack them a bit too to see what</span> <span data-start="321.86" data-end="323.3">are the dynamic characteristics of the</span> </p>
<p><span data-start="323.3" data-end="326.99">DFG I'm going to make the warm-up time</span> <span data-start="326.99" data-end="329.54">variable starting from Nam warm-up at</span> <span data-start="329.54" data-end="332.419">all all the way up to a second with more</span> <span data-start="332.419" data-end="334.97">samples closer to zero so after zero</span> <span data-start="334.97" data-end="336.89">milliseconds after five milliseconds</span> <span data-start="336.89" data-end="339.59">after 10 milliseconds meaning after 10</span> <span data-start="339.59" data-end="340.76">milliseconds you know what's the</span> <span data-start="340.76" data-end="342.59">performance I can expect on my webpage</span> <span data-start="342.59" data-end="345.77">with javascriptcore after 25</span> <span data-start="345.77" data-end="347.57">milliseconds what's what's the kind of</span> <span data-start="347.57" data-end="349.58">performance I can expect and then the</span> <span data-start="349.58" data-end="351.26">thing I measure after the warm-up is</span> <span data-start="351.26" data-end="354.83">going to be 5 milliseconds of a runtime</span> <span data-start="354.83" data-end="359.45">and it it's a good measure of the code</span> <span data-start="359.45" data-end="361.94">that the DFG can produce but it's a it's</span> <span data-start="361.94" data-end="363.86">a very tricky measurement as well</span> <span data-start="363.86" data-end="365.84">because it's sensitive let's say in</span> <span data-start="365.84" data-end="367.49">those five milliseconds milliseconds</span> <span data-start="367.49" data-end="369.229">where I'm measuring you know what if GC</span> <span data-start="369.229" data-end="372.32">hits well you know I I'm going to get</span> <span data-start="372.32" data-end="373.82">much worse results for that particular</span> <span data-start="373.82" data-end="377.75">run for example or what if the optimizer</span> <span data-start="377.75" data-end="379.88">decides to optimize a lot of code in</span> <span data-start="379.88" data-end="382.729">that 5 millisecond window well you know</span> <span data-start="382.729" data-end="384.8">also I can I can experience some</span> <span data-start="384.8" data-end="387.44">slowdowns oh and as well we have some</span> <span data-start="387.44" data-end="389.81">issues with timer precision in</span> </p>
<p><span data-start="389.81" data-end="391.46">JavaScript for memory for measuring</span> <span data-start="391.46" data-end="393.38">these things I'm using that more precise</span> <span data-start="393.38" data-end="395.45">timer that's available in the JC runtime</span> <span data-start="395.45" data-end="397.88">called precise time which gives me a bit</span> <span data-start="397.88" data-end="400.43">more precision in this regard but all of</span> <span data-start="400.43" data-end="402.95">these things you know these unexpected</span> <span data-start="402.95" data-end="405.68">pauses these you know sources of</span> <span data-start="405.68" data-end="407.36">variation in performance can also affect</span> <span data-start="407.36" data-end="409.4">your real code so i think it's is not</span> <span data-start="409.4" data-end="410.69">unfair to actually be measuring these</span> <span data-start="410.69" data-end="414.2">things so in this experiment more than</span> <span data-start="414.2" data-end="415.729">other ones we really need to take a look</span> <span data-start="415.729" data-end="416.87">at this shape</span> <span data-start="416.87" data-end="418.46">performance again and see you know</span> <span data-start="418.46" data-end="420.29">what's going on went out of the way</span> <span data-start="420.29" data-end="422.18">let's take a look at the first v8</span> <span data-start="422.18" data-end="424.78">benchmark which is a Richards benchmark</span> <span data-start="424.78" data-end="428.6">it's a scheduler and it uses some bit</span> <span data-start="428.6" data-end="430.4">operations for maintaining the states of</span> <span data-start="430.4" data-end="434.21">tasks in the scheduler and it uses a</span> <span data-start="434.21" data-end="436.34">bunch of objects with properties and</span> <span data-start="436.34" data-end="438.56">prototype resolution and such what we</span> <span data-start="438.56" data-end="440.24">can see here is that you know here at</span> <span data-start="440.24" data-end="441.47">zero milliseconds we're starting off</span> <span data-start="441.47" data-end="443.78">with pretty poor performance which is</span> <span data-start="443.78" data-end="445.58">natural you don't want to spend your</span> <span data-start="445.58" data-end="447.05">time optimizing code that you don't know</span> <span data-start="447.05" data-end="449.96">is going to run but after you know 5</span> <span data-start="449.96" data-end="452.59">milliseconds 10 milliseconds certainly</span> <span data-start="452.59" data-end="455.66">after 75 milliseconds we're up to our</span> <span data-start="455.66" data-end="458.71">peak performance these vertical lines</span> <span data-start="458.71" data-end="461.72">indicate runs of the optimizing compiler</span> <span data-start="461.72" data-end="463.79">so you can see if they're all clustered</span> <span data-start="463.79" data-end="465.59">before 75 but you probably can't even</span> <span data-start="465.59" data-end="469.1">read that let's go to 0 5 10 15 25 4075</span> <span data-start="469.1" data-end="473.33">one 2203 2,500 seven hundred a thousand</span> <span data-start="473.33" data-end="476.09">milliseconds right so from zero to one</span> <span data-start="476.09" data-end="479.45">second this is your the dynamic profile</span> <span data-start="479.45" data-end="481.97">of the DFG performance and what we see</span> <span data-start="481.97" data-end="484.46">graphed here is the distribution of</span> <span data-start="484.46" data-end="486.11">performance results that I've taken so</span> <span data-start="486.11" data-end="489.29">for I for example warmed up v 8 40</span> <span data-start="489.29" data-end="490.85">milliseconds and then measured the next</span> <span data-start="490.85" data-end="493.19">five milliseconds 50 times alright and</span> <span data-start="493.19" data-end="495.14">those 50 values are applied here same</span> <span data-start="495.14" data-end="497.27">for 5 milliseconds st. for 10 I don't</span> <span data-start="497.27" data-end="499.07">know I tried to make it understandable</span> <span data-start="499.07" data-end="501.35">but it's a it's a novel graph kind and</span> <span data-start="501.35" data-end="503.81">that never goes over quite so well what</span> <span data-start="503.81" data-end="505.4">we see though is performance is fairly</span> <span data-start="505.4" data-end="508.1">tightly clustered the paint there's more</span> <span data-start="508.1" data-end="510.46">paint that means that there's a higher</span> <span data-start="510.46" data-end="513.71">variance in in the performance and here</span> <span data-start="513.71" data-end="515.39">we see things are fairly tight it goes</span> <span data-start="515.39" data-end="517.61">up drops down a bit for some reason I</span> <span data-start="517.61" data-end="520.37">don't quite understand but then no</span> <span data-start="520.37" data-end="523.04">optimizing compiler run happens after 75</span> <span data-start="523.04" data-end="525.65">milliseconds so 75 milliseconds in this</span> <span data-start="525.65" data-end="527.84">benchmark and the DFG is done all that</span> <span data-start="527.84" data-end="533.06">it sees fit to do and so we get a three</span> <span data-start="533.06" data-end="537.19">point seven times performance increase</span> <span data-start="537.19" data-end="540.86">1.0 would be no no increase at all on</span> <span data-start="540.86" data-end="543.2">this particular benchmark relative to</span> <span data-start="543.2" data-end="546.23">the baseline JIT measured over a full</span> <span data-start="546.23" data-end="550.07">second and now we get in a hardcore</span> <span data-start="550.07" data-end="551.14">stuff</span> <span data-start="551.14" data-end="553.91">one of the things that turned out we'll</span> <span data-start="553.91" data-end="555.05">just take an example of one of the</span> <span data-start="555.05" data-end="557.63">functions that that we went to optimize</span> <span data-start="557.63" data-end="559.49">here I don't know how many of you have</span> <span data-start="559.49" data-end="561.08">looked at the source code for the v8</span> <span data-start="561.08" data-end="564.95">benchmarks few y'all the engine hackers</span> </p>
<p><span data-start="564.95" data-end="569.12">I see right so the rest of y'all here's</span> <span data-start="569.12" data-end="572.69">the JavaScript up here we add something</span> <span data-start="572.69" data-end="575.33">to a task saying you know is suspended</span> <span data-start="575.33" data-end="579.59">we do a bit and compare and we have</span> <span data-start="579.59" data-end="581.72">another clause that their logical order</span> <span data-start="581.72" data-end="583.58">together and we return it and the</span> <span data-start="583.58" data-end="586.55">assembly that's below is what you can</span> <span data-start="586.55" data-end="588.17">see on the screen right now corresponds</span> <span data-start="588.17" data-end="591.86">to this this dot state bitwise and with</span> <span data-start="591.86" data-end="595.49">state held first we get this which is a</span> <span data-start="595.49" data-end="598.07">local variable and that's just a memory</span> <span data-start="598.07" data-end="600.53">reference we checked that this has the</span> <span data-start="600.53" data-end="602.72">prototype that we saw when it was</span> <span data-start="602.72" data-end="604.46">initially compiled but it was optimized</span> <span data-start="604.46" data-end="606.41">and if it does not have this prototype</span> <span data-start="606.41" data-end="607.61">we're going to jump to this bailout</span> <span data-start="607.61" data-end="611.3">which one we d optimize which might be a</span> <span data-start="611.3" data-end="613.19">word you've heard from other discussions</span> <span data-start="613.19" data-end="615.71">of optimizing compilers like crankshaft</span> <span data-start="615.71" data-end="619.19">for example then we once we verified</span> <span data-start="619.19" data-end="621.41">that the this object has the shape that</span> <span data-start="621.41" data-end="625.25">we're expecting we directly reference a</span> <span data-start="625.25" data-end="627.56">field in the object using you know what</span> <span data-start="627.56" data-end="630.52">with the v8 folks called hidden classes</span> <span data-start="630.52" data-end="632.57">we get the global variable corresponding</span> <span data-start="632.57" data-end="635.03">to state held so unfortunately we didn't</span> <span data-start="635.03" data-end="637.88">in line this to a constant but okay and</span> <span data-start="637.88" data-end="639.55">then we go ahead and do the bitwise and</span> <span data-start="639.55" data-end="642.56">the first four instructions correspond</span> <span data-start="642.56" data-end="645.56">to type checks that the this state and</span> <span data-start="645.56" data-end="649.22">the state held are both integers are 14</span> <span data-start="649.22" data-end="651.2">this is a 64-bit assembly code and are</span> <span data-start="651.2" data-end="653.87">14 holds the number tag so we compare</span> <span data-start="653.87" data-end="656.05">the number tag on the on the value</span> <span data-start="656.05" data-end="658.73">javascriptcore uses the nan boxing</span> <span data-start="658.73" data-end="661.4">technique nan boxing folks heard of it</span> <span data-start="661.4" data-end="663.95">yeah awesome you guys great if you</span> <span data-start="663.95" data-end="665.81">haven't heard of it you know search nan</span> <span data-start="665.81" data-end="667.67">boxing on the web also search for an</span> <span data-start="667.67" data-end="669.89">unboxing and I don't think there's you</span> <span data-start="669.89" data-end="672.29">know any pugilistic encounters but not I</span> <span data-start="672.29" data-end="675.22">don't know finally after this we have</span> <span data-start="675.22" data-end="677.69">some comparisons we compared the the</span> <span data-start="677.69" data-end="681.47">value to 0 we invert it we actually</span> <span data-start="681.47" data-end="683.3">store it to memory that's the set local</span> <span data-start="683.3" data-end="684.08">and we do</span> <span data-start="684.08" data-end="687.17">branch and and this is sub-optimal to be</span> <span data-start="687.17" data-end="689.09">honest like many of these things could</span> <span data-start="689.09" data-end="691.13">be joined together but you know this</span> <span data-start="691.13" data-end="693.11">this these are the instructions that are</span> <span data-start="693.11" data-end="695.6">produced for that in a very first part</span> <span data-start="695.6" data-end="698.33">of this function there are some more and</span> <span data-start="698.33" data-end="700.04">finally we return and then after the end</span> <span data-start="700.04" data-end="702.14">of the main path all the bailouts all</span> <span data-start="702.14" data-end="704.27">the points where we you know jump too if</span> <span data-start="704.27" data-end="707.66">something wasn't expected I gotta check</span> <span data-start="707.66" data-end="708.86">myself because I could talk about this</span> <span data-start="708.86" data-end="710.54">forever that's just the first benchmark</span> <span data-start="710.54" data-end="713.42">so the second is Delta blue it's a</span> <span data-start="713.42" data-end="718.67">constraint solver and we get a fine</span> <span data-start="718.67" data-end="720.95">speed up on this one we get a bit more</span> <span data-start="720.95" data-end="722.78">more paint here as you can see there's</span> <span data-start="722.78" data-end="724.67">more yellow there's more variance</span> <span data-start="724.67" data-end="725.81">towards there and I'll talk a little bit</span> <span data-start="725.81" data-end="727.43">more about what that means but on this</span> <span data-start="727.43" data-end="729.26">one it's very it's very important to in</span> <span data-start="729.26" data-end="733.13">line but we see some bit if I look at</span> <span data-start="733.13" data-end="734.78">the logs and i'll i'll talk about how to</span> <span data-start="734.78" data-end="737.24">get the logs a little bit later I think</span> <span data-start="737.24" data-end="741.05">yeah we see some entries like delaying</span> <span data-start="741.05" data-end="743.96">optimization for this thing and it's</span> <span data-start="743.96" data-end="745.07">called in a loop because we have</span> <span data-start="745.07" data-end="747.08">insufficient profiling and so this</span> <span data-start="747.08" data-end="748.91">indicates that you know for this</span> <span data-start="748.91" data-end="750.41">optimizing compiler as with all</span> </p>
<p><span data-start="750.41" data-end="752.87">JavaScript optimizing compilers we need</span> <span data-start="752.87" data-end="755.63">what they call profiling which is the</span> <span data-start="755.63" data-end="757.52">the runtime type feedback the type</span> <span data-start="757.52" data-end="761.9">information and there's actually a an</span> <span data-start="761.9" data-end="763.97">option to tweak how much it weights or</span> <span data-start="763.97" data-end="765.77">doesn't wait for some profiling</span> <span data-start="765.77" data-end="768.29">information and in this case it hits the</span> <span data-start="768.29" data-end="771.8">maximum of five attempts to profile so</span> <span data-start="771.8" data-end="773.63">it starts first it up after twenty</span> <span data-start="773.63" data-end="775.88">milliseconds and then eventually after</span> <span data-start="775.88" data-end="778.46">trying again for more times that at 40</span> <span data-start="778.46" data-end="780.41">milliseconds in it goes ahead and</span> <span data-start="780.41" data-end="782.66">increase the optimized code it's like it</span> <span data-start="782.66" data-end="783.98">would like more information so it's</span> <span data-start="783.98" data-end="785.66">going to wait for it it waits doesn't</span> <span data-start="785.66" data-end="789.14">find it so it produces a code that's a</span> <span data-start="789.14" data-end="792.56">general flavor of things this is I look</span> <span data-start="792.56" data-end="794.84">through the logs for you know what kinds</span> <span data-start="794.84" data-end="797.39">of functions were actually compiled in</span> <span data-start="797.39" data-end="799.82">this early phase and if I go back to the</span> <span data-start="799.82" data-end="801.8">graph sorry for switching back and forth</span> <span data-start="801.8" data-end="804.56">we see that you know it's really between</span> <span data-start="804.56" data-end="807.23">15 and 25 and 40 milliseconds is where</span> <span data-start="807.23" data-end="809.48">we start to jump up to our level and</span> <span data-start="809.48" data-end="812.12">that's that's generally the time range</span> <span data-start="812.12" data-end="813.47">that you're optimizing compiler will</span> <span data-start="813.47" data-end="815.42">kick in and I saw this is one of the</span> <span data-start="815.42" data-end="816.86">functions it doesn't look very hot to me</span> </p>
<p><span data-start="816.86" data-end="817.35">I'm</span> <span data-start="817.35" data-end="821.31">I haven't actually run the damn profiler</span> <span data-start="821.31" data-end="823.35">and seen if this is hot but you know</span> <span data-start="823.35" data-end="824.58">just looking to code it didn't look like</span> <span data-start="824.58" data-end="825.63">it was going to be something that was</span> <span data-start="825.63" data-end="827.46">particularly hot and what I what that</span> <span data-start="827.46" data-end="830.34">indicates to me is that here we just</span> <span data-start="830.34" data-end="832.56">have a lot of work to do and indeed if</span> <span data-start="832.56" data-end="835.02">we go back apologize again going back we</span> <span data-start="835.02" data-end="838.2">see a lot more vertical lines in this</span> <span data-start="838.2" data-end="840.21">one compared to richards and they go a</span> <span data-start="840.21" data-end="842.43">lot later you know they go after 75 it</span> <span data-start="842.43" data-end="844.26">seems like oh there's some out all the</span> <span data-start="844.26" data-end="845.64">way up at a thousand and I'm sure if it</span> <span data-start="845.64" data-end="849.3">ran for more more would run so some code</span> <span data-start="849.3" data-end="851.07">especially code with small functions it</span> <span data-start="851.07" data-end="854.55">needs a bunch of inlining and such it's</span> <span data-start="854.55" data-end="855.57">going to take some more work to be</span> <span data-start="855.57" data-end="857.82">optimized Richard's the the previous</span> <span data-start="857.82" data-end="859.92">example it was a bit simpler for the DFG</span> <span data-start="859.92" data-end="863.78">to work with the next one is a crypto</span> <span data-start="863.78" data-end="867.39">crypto is kind of interesting it deals a</span> <span data-start="867.39" data-end="868.53">lot with integers and it deals a lot</span> <span data-start="868.53" data-end="872.46">with arrays as well again we see a lot</span> <span data-start="872.46" data-end="875.82">of lines the there you can see some</span> <span data-start="875.82" data-end="878.7">notable clustering as well clustering is</span> <span data-start="878.7" data-end="880.02">like when a line is bigger that's</span> <span data-start="880.02" data-end="881.73">because two lines are drawn really close</span> <span data-start="881.73" data-end="885.69">together the DFG optimizer will kick in</span> <span data-start="885.69" data-end="887.76">based on a profile count so for example</span> <span data-start="887.76" data-end="890.82">a loop executes a thousand times or</span> <span data-start="890.82" data-end="893.73">something and that can lead to</span> <span data-start="893.73" data-end="895.5">clustering because there are a lot of</span> <span data-start="895.5" data-end="897.81">loops and functions whose execution</span> <span data-start="897.81" data-end="899.43">counts are linked you know if you call</span> <span data-start="899.43" data-end="901.71">this function a thousand times then this</span> <span data-start="901.71" data-end="903.27">loop will run five thousand times and</span> <span data-start="903.27" data-end="904.5">this other function will run a thousand</span> <span data-start="904.5" data-end="906.81">times so they can all kick in about the</span> <span data-start="906.81" data-end="908.85">same time so you can you can get this</span> <span data-start="908.85" data-end="910.86">sort of clustering effect it usually</span> <span data-start="910.86" data-end="912.65">doesn't affect performance I don't think</span> <span data-start="912.65" data-end="914.76">maybe it can cause an affirmation</span> <span data-start="914.76" data-end="918.03">optimization slow down but no no it's an</span> <span data-start="918.03" data-end="921.15">interesting characteristic but I like</span> <span data-start="921.15" data-end="923.01">this one because crypto is a great</span> <span data-start="923.01" data-end="924.6">benchmark to optimize because there's</span> <span data-start="924.6" data-end="927.45">lots of you know classical compiler</span> <span data-start="927.45" data-end="929.91">optimizations that you know us compiler</span> <span data-start="929.91" data-end="932.04">nerds really really dig on and this is a</span> <span data-start="932.04" data-end="933.69">one of the functions that's in the</span> <span data-start="933.69" data-end="936.39">benchmark because we can see you know we</span> <span data-start="936.39" data-end="940.29">have a lot of integer operations trying</span> <span data-start="940.29" data-end="941.67">to keep in the range of integers that</span> <span data-start="941.67" data-end="944.49">are efficient in JavaScript and if I</span> <span data-start="944.49" data-end="946.26">take a look at one of the particular</span> <span data-start="946.26" data-end="949.23">lines which is fetching a value from an</span> <span data-start="949.23" data-end="951.3">array and then doing a bitwise and with</span> <span data-start="951.3" data-end="954.269">constant we can see that we get the</span> <span data-start="954.269" data-end="958.769">array which which is this array we fetch</span> <span data-start="958.769" data-end="963.36">that out from memory we get I which for</span> <span data-start="963.36" data-end="965.459">some reason is in memory as well I don't</span> <span data-start="965.459" data-end="967.529">think it's actually a good idea for it</span> <span data-start="967.529" data-end="970.41">to be in memory but okay and we get this</span> <span data-start="970.41" data-end="971.67">this is actually a relatively new thing</span> <span data-start="971.67" data-end="973.85">just landed about a month ago this</span> <span data-start="973.85" data-end="977.1">butterfly representation this is a way</span> <span data-start="977.1" data-end="981.18">in the future to store out of line data</span> <span data-start="981.18" data-end="984.269">like the elements in an array to</span> <span data-start="984.269" data-end="986.43">potentially store them as unbox values</span> <span data-start="986.43" data-end="988.86">it's not completely taken advantage of</span> <span data-start="988.86" data-end="989.97">yet and I think it's one of the things</span> <span data-start="989.97" data-end="992.459">that in JavaScript core in the DFG will</span> <span data-start="992.459" data-end="995.04">start to see in the next couple months</span> <span data-start="995.04" data-end="998.31">or so but this is a pointer to either a</span> <span data-start="998.31" data-end="1001.61">small amount of inline data so if your</span> <span data-start="1001.61" data-end="1002.839">array only has two elements for example</span> <span data-start="1002.839" data-end="1004.13">they're probably going to be allocated</span> <span data-start="1004.13" data-end="1006.44">in the same block as your as your object</span> <span data-start="1006.44" data-end="1008.39">or a pointer to out of line data</span> <span data-start="1008.39" data-end="1011.57">containing the rest of the array the get</span> <span data-start="1011.57" data-end="1016.01">byval checks that the integers and</span> <span data-start="1016.01" data-end="1019.37">bounds up for the array and if not it</span> <span data-start="1019.37" data-end="1022.16">bails out fetches the value and checks</span> <span data-start="1022.16" data-end="1024.05">if the value is a hole and if not it</span> <span data-start="1024.05" data-end="1025.91">bails out and then finally we do a</span> <span data-start="1025.91" data-end="1028.01">bitwise and another thing that I wasn't</span> <span data-start="1028.01" data-end="1031.13">mentioning before is that between these</span> <span data-start="1031.13" data-end="1033.8">operations these operations are the part</span> <span data-start="1033.8" data-end="1035.54">of the internal representation of the</span> </p>
<p><span data-start="1035.54" data-end="1037.61">DFG compiler so they don't they</span> <span data-start="1037.61" data-end="1039.829">correspond loosely the things that you</span> <span data-start="1039.829" data-end="1042.11">need to do semantically in JavaScript</span> <span data-start="1042.11" data-end="1043.52">but they don't correspond exactly the</span> <span data-start="1043.52" data-end="1045.439">bytecode they don't correspond exactly</span> <span data-start="1045.439" data-end="1048.559">to the the specification either but what</span> <span data-start="1048.559" data-end="1053.39">we see is that for example we have we</span> <span data-start="1053.39" data-end="1054.919">get this array and we put it in our 10</span> <span data-start="1054.919" data-end="1058.46">and then down here we use our 10 and</span> <span data-start="1058.46" data-end="1061.22">then later on we can use a we can use</span> <span data-start="1061.22" data-end="1062.809">these values directly in those registers</span> <span data-start="1062.809" data-end="1064.61">register allocation is you know</span> <span data-start="1064.61" data-end="1067.91">obviously a huge optimization that all</span> <span data-start="1067.91" data-end="1070.01">of the optimizing compilers do and so</span> <span data-start="1070.01" data-end="1071.96">even if you don't have a lot of type</span> <span data-start="1071.96" data-end="1074.059">information in running the optimizing</span> <span data-start="1074.059" data-end="1075.64">compiler on a piece of code can still be</span> <span data-start="1075.64" data-end="1080.59">quite advantageous right so raytrace</span> <span data-start="1080.59" data-end="1083.57">here we have an interesting example is</span> <span data-start="1083.57" data-end="1085.28">the first floating-point example and</span> </p>
<p><span data-start="1085.28" data-end="1087.98">VA test suites it uses some</span> <span data-start="1087.98" data-end="1089.78">floating-point math and it uses objects</span> <span data-start="1089.78" data-end="1092.06">with floating point fields so like this</span> <span data-start="1092.06" data-end="1094.91">X being a floating point number we see</span> <span data-start="1094.91" data-end="1096.53">very tight performance here and then we</span> <span data-start="1096.53" data-end="1099.53">as we warm up a bit more we start to see</span> <span data-start="1099.53" data-end="1102.41">a bit more variance and whenever you see</span> <span data-start="1102.41" data-end="1105.08">variance in a very small benchmark like</span> <span data-start="1105.08" data-end="1107.87">this it means that something is slowing</span> <span data-start="1107.87" data-end="1111.08">down the benchmark sometimes but not</span> <span data-start="1111.08" data-end="1114.83">some other times so any guesses as to</span> <span data-start="1114.83" data-end="1116.06">what this could be in this particular</span> <span data-start="1116.06" data-end="1122.45">case yes yes exactly the reason we have</span> <span data-start="1122.45" data-end="1124.1">so much variance and you probably can</span> <span data-start="1124.1" data-end="1125.21">see this right now but it goes from here</span> <span data-start="1125.21" data-end="1126.89">all the way to hear there's a histogram</span> <span data-start="1126.89" data-end="1129.05">line drawn there is because sometimes we</span> <span data-start="1129.05" data-end="1130.4">hit garbage collection and sometimes we</span> <span data-start="1130.4" data-end="1132.41">don't in the right trace example we get</span> <span data-start="1132.41" data-end="1134.81">a lot of short-lived objects with</span> <span data-start="1134.81" data-end="1137.54">floating point fields so you can you can</span> <span data-start="1137.54" data-end="1139.19">get very good performance as long as you</span> <span data-start="1139.19" data-end="1141.05">don't have GE and if you do hit GC you</span> <span data-start="1141.05" data-end="1143.18">get less performance and I'll talk about</span> <span data-start="1143.18" data-end="1145.75">that a bit more when we get to the more</span> <span data-start="1145.75" data-end="1148.1">strong tests of the garbage collector</span> <span data-start="1148.1" data-end="1151.4">later as one example of code that the</span> </p>
<p><span data-start="1151.4" data-end="1153.95">DFG works with for this one we have this</span> <span data-start="1153.95" data-end="1156.32">normalized function and it takes a</span> <span data-start="1156.32" data-end="1158.39">vector and it returns a new vector and</span> <span data-start="1158.39" data-end="1161.81">at normal I normalized as it compiles</span> <span data-start="1161.81" data-end="1163.94">dysfunction when the DFG gets to this</span> <span data-start="1163.94" data-end="1167.09">top magnitude it's going to inline the</span> <span data-start="1167.09" data-end="1169.58">code for this magnitude which is pretty</span> <span data-start="1169.58" data-end="1171.71">awesome optimization I also done by</span> <span data-start="1171.71" data-end="1175.1">other other systems but you know it's</span> <span data-start="1175.1" data-end="1178.03">pretty key to do and I just want to</span> <span data-start="1178.03" data-end="1181.31">focus a bit on what happens when we</span> <span data-start="1181.31" data-end="1184.72">store the result for this x divided by M</span> <span data-start="1184.72" data-end="1187.55">we ended up dividing by things they're</span> <span data-start="1187.55" data-end="1189.47">placed in SSC registers so it's just one</span> <span data-start="1189.47" data-end="1191.27">instruction after we've loaded up the</span> <span data-start="1191.27" data-end="1193.13">values but then when we go to store it</span> <span data-start="1193.13" data-end="1198.13">we re add a number tag on a value in the</span> <span data-start="1198.13" data-end="1200.51">high beds to the value or I think it</span> <span data-start="1200.51" data-end="1203.29">rotates the value around actually and</span> <span data-start="1203.29" data-end="1205.96">and we store it as a sort of general</span> </p>
<p><span data-start="1205.96" data-end="1209">JavaScript object which only occupies</span> <span data-start="1209" data-end="1213.74">one word but in into this object which</span> <span data-start="1213.74" data-end="1216.32">means that we don't have fields that are</span> <span data-start="1216.32" data-end="1219.13">unboxed values in javascript core we</span> <span data-start="1219.13" data-end="1222.16">have this decks can be like an in 32 for</span> <span data-start="1222.16" data-end="1224.11">example or this that X can be a float</span> <span data-start="1224.11" data-end="1225.07">and we always know it's a float</span> <span data-start="1225.07" data-end="1226.87">otherwise we you know we would leave off</span> <span data-start="1226.87" data-end="1231.55">this tagging step early Boyer again we</span> <span data-start="1231.55" data-end="1233.95">see a lot of paint because we see a lot</span> <span data-start="1233.95" data-end="1238.78">of short-term allocations these are two</span> <span data-start="1238.78" data-end="1241.21">benchmarks that were translated from</span> <span data-start="1241.21" data-end="1244.18">scheme actually by an automatic</span> <span data-start="1244.18" data-end="1246.76">translator by same fellow that does the</span> <span data-start="1246.76" data-end="1248.86">dart to JavaScript translator in cinelli</span> <span data-start="1248.86" data-end="1252.58">and so what we see are a lot of calls to</span> <span data-start="1252.58" data-end="1254.2">small functions and a lot of allocation</span> <span data-start="1254.2" data-end="1256.87">of short-lived objects so this is</span> <span data-start="1256.87" data-end="1258.7">something that a generational collector</span> <span data-start="1258.7" data-end="1261.4">collector will do really awesome on but</span> <span data-start="1261.4" data-end="1265.45">in JavaScript kors case when the garbage</span> <span data-start="1265.45" data-end="1266.89">collector needs to run it actually stops</span> <span data-start="1266.89" data-end="1270.04">everything and then it scans the entire</span> <span data-start="1270.04" data-end="1273.85">space in parallel I mean you have maybe</span> <span data-start="1273.85" data-end="1275.47">eight cores in your system or four cores</span> <span data-start="1275.47" data-end="1277.99">and it will use all of them but it does</span> <span data-start="1277.99" data-end="1279.91">have to scan the whole space to see</span> <span data-start="1279.91" data-end="1281.74">what's live and what's dead and then it</span> <span data-start="1281.74" data-end="1283.69">lets a program go on and that leads to</span> <span data-start="1283.69" data-end="1286">this you know these huge variances here</span> <span data-start="1286" data-end="1290.14">here here an ongoing I think the outside</span> <span data-start="1290.14" data-end="1292.69">color corresponds to ninety percent of</span> <span data-start="1292.69" data-end="1295.66">the samples and that red in the middle</span> <span data-start="1295.66" data-end="1298.81">is the the middle ten percent you can</span> <span data-start="1298.81" data-end="1301">think of the the reddest red is a kind</span> <span data-start="1301" data-end="1306.16">of median line on these so it's just an</span> <span data-start="1306.16" data-end="1308.74">indication of this this thing I you know</span> <span data-start="1308.74" data-end="1310.48">if you take nothing else from this</span> <span data-start="1310.48" data-end="1312.79">presentation is that you know numbers</span> <span data-start="1312.79" data-end="1314.02">are really awesome what you're having</span> <span data-start="1314.02" data-end="1315.76">you know shootouts and races and</span> <span data-start="1315.76" data-end="1317.92">marketing and things like that but if</span> <span data-start="1317.92" data-end="1319.81">you actually want to understand you know</span> <span data-start="1319.81" data-end="1322.21">anything about your own performance then</span> <span data-start="1322.21" data-end="1324.31">you need to treat performance as a</span> <span data-start="1324.31" data-end="1326.74">distribution of values and not simply a</span> <span data-start="1326.74" data-end="1331.63">number next we've got the regular</span> <span data-start="1331.63" data-end="1332.83">expression benchmark and there's not</span> <span data-start="1332.83" data-end="1335.32">really anything to say here because the</span> <span data-start="1335.32" data-end="1336.52">regular expressions have their own</span> <span data-start="1336.52" data-end="1338.62">compiler than in all the engines and</span> <span data-start="1338.62" data-end="1339.97">it's not really subject to the</span> <span data-start="1339.97" data-end="1342.85">optimizing compiler and so the DFG</span> <span data-start="1342.85" data-end="1344.29">doesn't really do anything for us here</span> <span data-start="1344.29" data-end="1347.83">and that's that's basically that it it</span> <span data-start="1347.83" data-end="1350.41">seems to run but very few times maybe 15</span> <span data-start="1350.41" data-end="1352.96">times or so giving us a</span> </p>
<p><span data-start="1352.96" data-end="1354.64">I speed up in the loops around which the</span> <span data-start="1354.64" data-end="1357.58">regular expressions run but but not on</span> <span data-start="1357.58" data-end="1359.559">the regular expressions themselves which</span> <span data-start="1359.559" data-end="1363.429">take the bulk of the time finally we're</span> <span data-start="1363.429" data-end="1366.94">getting to the end here I think good we</span> <span data-start="1366.94" data-end="1369.57">have the splay benchmark which tests</span> <span data-start="1369.57" data-end="1371.83">allocations that are very long-lived so</span> <span data-start="1371.83" data-end="1373.36">it's terrible for generational</span> <span data-start="1373.36" data-end="1375.07">collectors JavaScript court actually</span> <span data-start="1375.07" data-end="1377.59">does fairly well in this but what you</span> <span data-start="1377.59" data-end="1380.409">can see again is is the huge amount of</span> <span data-start="1380.409" data-end="1382.6">variance here we go from know all the</span> <span data-start="1382.6" data-end="1383.86">way on the bottom here when we have to</span> <span data-start="1383.86" data-end="1386.049">stop the world and you know Mark an</span> <span data-start="1386.049" data-end="1388.69">enormous heap to you know something is</span> <span data-start="1388.69" data-end="1391.27">quite good up there and and you don't</span> <span data-start="1391.27" data-end="1393.01">see the this kind of variance if you</span> <span data-start="1393.01" data-end="1394.779">just look at the numbers in the end like</span> <span data-start="1394.779" data-end="1396.52">if you just look at the the raw</span> <span data-start="1396.52" data-end="1398.529">performance numbers measured over a</span> <span data-start="1398.529" data-end="1400.12">second because if you measure a second</span> <span data-start="1400.12" data-end="1402.34">you're amortizing all these garbage</span> <span data-start="1402.34" data-end="1404.26">collection costs you're not measuring</span> <span data-start="1404.26" data-end="1405.88">you know what is your maximum pause time</span> <span data-start="1405.88" data-end="1408.279">for example so in this case we're seeing</span> <span data-start="1408.279" data-end="1413.2">a pretty poor maximum pause time because</span> <span data-start="1413.2" data-end="1415.75">of this stop the world although it's</span> <span data-start="1415.75" data-end="1417.22">parallel you know but stop the world</span> <span data-start="1417.22" data-end="1421.659">marker and finally we have the newest</span> <span data-start="1421.659" data-end="1424.029">addition to the v8 benchmarks I guess if</span> <span data-start="1424.029" data-end="1425.77">they're still around and we don't all</span> <span data-start="1425.77" data-end="1428.59">move to octane benchmarks or such which</span> <span data-start="1428.59" data-end="1430.659">is a navier-stokes benchmark it has a</span> <span data-start="1430.659" data-end="1433.299">ray large array of floating-point</span> <span data-start="1433.299" data-end="1435.22">numbers but not using the type to raise</span> <span data-start="1435.22" data-end="1438.909">so what this really measures is okay</span> <span data-start="1438.909" data-end="1440.649">first of all are you doing good floating</span> <span data-start="1440.649" data-end="1442.419">point wise does your optimizing compiler</span> <span data-start="1442.419" data-end="1445.029">deal with floating point well and can</span> <span data-start="1445.029" data-end="1446.59">you automatically turn arrays of</span> <span data-start="1446.59" data-end="1448.84">floating point values into a raised of</span> <span data-start="1448.84" data-end="1452.14">unbox floats you know and in the case of</span> <span data-start="1452.14" data-end="1454.09">v8 they can do this and the case of</span> <span data-start="1454.09" data-end="1457.36">javascriptcore you know we can so for</span> <span data-start="1457.36" data-end="1459.88">example this get byval fetches a value</span> <span data-start="1459.88" data-end="1463.21">at the index with the same range check</span> <span data-start="1463.21" data-end="1469.539">and is it a hole and we get we get some</span> <span data-start="1469.539" data-end="1472.029">local value I think and then we turned</span> <span data-start="1472.029" data-end="1474.429">this value we got into a double which</span> <span data-start="1474.429" data-end="1475.87">actually doesn't take very much code but</span> <span data-start="1475.87" data-end="1478.72">it's more than if it was an unboxed</span> <span data-start="1478.72" data-end="1479.74">array and we knew it was a double</span> <span data-start="1479.74" data-end="1484.84">already so yeah no no automatic turning</span> <span data-start="1484.84" data-end="1486.9">of arrays into double erase</span> <span data-start="1486.9" data-end="1488.92">finally before I close I'd like to</span> <span data-start="1488.92" data-end="1491.56">mention how I got this data if you want</span> </p>
<p><span data-start="1491.56" data-end="1494.41">JSC and I think there's so many apple</span> <span data-start="1494.41" data-end="1496.3">laptops right here you probably have</span> <span data-start="1496.3" data-end="1497.68">JavaScript core installed if you can</span> <span data-start="1497.68" data-end="1500.41">locate the JSC program if you run it</span> <span data-start="1500.41" data-end="1502.03">with dash dash options it gives you a</span> <span data-start="1502.03" data-end="1505.78">spit out of knobs you can turn the dash</span> <span data-start="1505.78" data-end="1509.46">D will dump bike code which is useful in</span> <span data-start="1509.46" data-end="1512.05">together with the app together with a</span> <span data-start="1512.05" data-end="1514.39">disassembly if you say show DFG</span> <span data-start="1514.39" data-end="1516.91">disassembly but in order to get the time</span> <span data-start="1516.91" data-end="1518.86">stamps the information that I showed you</span> <span data-start="1518.86" data-end="1521.32">you have to enable some verbose logging</span> <span data-start="1521.32" data-end="1524.83">and the the graphs that I showed you I</span> <span data-start="1524.83" data-end="1526.39">measured them without the verbose</span> <span data-start="1526.39" data-end="1529.03">logging and then I superimposed the DFG</span> <span data-start="1529.03" data-end="1532.42">vertical bars after enabling verbose</span> <span data-start="1532.42" data-end="1533.92">logging so they were from separate runs</span> <span data-start="1533.92" data-end="1536.38">and not entirely identical so you know</span> <span data-start="1536.38" data-end="1538.78">don't try to correlate those two</span> <span data-start="1538.78" data-end="1543.91">precisely right so back to the hubris I</span> <span data-start="1543.91" data-end="1546.58">guess you know javascriptcore is fast as</span> <span data-start="1546.58" data-end="1549.27">v8 on its own benchmark and stuff and</span> <span data-start="1549.27" data-end="1552.73">and yeah it is and it's faster and it's</span> <span data-start="1552.73" data-end="1556.99">slower also because you know we got a</span> <span data-start="1556.99" data-end="1558.13">bunch of different tests like we're</span> <span data-start="1558.13" data-end="1560.02">doing real great on Richards I say you</span> <span data-start="1560.02" data-end="1561.7">know we is a JavaScript core hacker I</span> <span data-start="1561.7" data-end="1563.23">don't actually have a dog in this race</span> <span data-start="1563.23" data-end="1566.14">but you know do great on Richards not so</span> <span data-start="1566.14" data-end="1568.59">great on Delta blue the same on Krypto</span> <span data-start="1568.59" data-end="1571.93">really eating it on early boyer but</span> <span data-start="1571.93" data-end="1573.88">we're you know picking up on splay yeah</span> <span data-start="1573.88" data-end="1576.52">and it is you know a classic example of</span> <span data-start="1576.52" data-end="1578.53">you know boy javascriptcore is you know</span> <span data-start="1578.53" data-end="1580.21">really killing it on display right but</span> <span data-start="1580.21" data-end="1582.55">the pause time it's not on this graph</span> <span data-start="1582.55" data-end="1584.29">right you can't see it because those</span> <span data-start="1584.29" data-end="1585.79">costs are more dives over the entire</span> <span data-start="1585.79" data-end="1588.73">second of collection so yeah that's</span> <span data-start="1588.73" data-end="1591.25">that's javascriptcore is optimizing</span> <span data-start="1591.25" data-end="1601.98">compiler I'll take some questions now</span> <span data-start="1601.99" data-end="1609.17">sure first of all awesome talk love the</span> <span data-start="1609.17" data-end="1611.84">tub thank you for being you know BM geek</span> <span data-start="1611.84" data-end="1613.64">obvious they do the question I have is</span> <span data-start="1613.64" data-end="1615.71">for the butterfly um forgot what that</span> <span data-start="1615.71" data-end="1619.01">was not view but something else or is</span> <span data-start="1619.01" data-end="1621.23">that intended to be for arrays only is</span> <span data-start="1621.23" data-end="1623.36">there a plan for making unboxed values</span> <span data-start="1623.36" data-end="1625.19">for objects as well for property on I</span> <span data-start="1625.19" data-end="1627.86">think it's for both I haven't talked</span> <span data-start="1627.86" data-end="1630.38">with the fellow that it meant but as far</span> <span data-start="1630.38" data-end="1632.21">as I understand it's for both sounds</span> <span data-start="1632.21" data-end="1645.38">very cool hi hi are there plans to</span> <span data-start="1645.38" data-end="1647.15">expose this information for developers</span> <span data-start="1647.15" data-end="1650.84">like when are you know certain parts of</span> <span data-start="1650.84" data-end="1653.63">the code hot when is your program</span> <span data-start="1653.63" data-end="1654.56">actually doing something bad that's</span> <span data-start="1654.56" data-end="1656.56">throwing off the digit and whatever</span> <span data-start="1656.56" data-end="1658.34">because it does that's actually</span> <span data-start="1658.34" data-end="1659.81">something that that we're missing right</span> <span data-start="1659.81" data-end="1662.54">now that that kind of information that's</span> <span data-start="1662.54" data-end="1665.45">a good question i think the general</span> <span data-start="1665.45" data-end="1667.46">answer that is the profiler and the</span> <span data-start="1667.46" data-end="1670.31">profiler i believe is hooked up to the</span> <span data-start="1670.31" data-end="1672.5">inspector and if it's not that that's a</span> <span data-start="1672.5" data-end="1676.94">problem I mean that doesn't really tell</span> <span data-start="1676.94" data-end="1678.44">you that it's actually throwing it off I</span> <span data-start="1678.44" data-end="1680.33">mean it just you see a decrease in</span> <span data-start="1680.33" data-end="1681.71">performance but it doesn't really tell</span> <span data-start="1681.71" data-end="1683.53">you you know which part of the code is</span> <span data-start="1683.53" data-end="1686.06">it's causing it or you know why your</span> <span data-start="1686.06" data-end="1690.02">your your kid is failing basically so is</span> <span data-start="1690.02" data-end="1692.08">there I don't know like maybe like a</span> <span data-start="1692.08" data-end="1695.36">heat map that would be awesome it's not</span> <span data-start="1695.36" data-end="1700.19">even that yet okay so JavaScript co has</span> <span data-start="1700.19" data-end="1702.71">three different compilers that seems</span> <span data-start="1702.71" data-end="1705.71">like a fairly high number do they really</span> <span data-start="1705.71" data-end="1709.34">need that many I don't think so uh I</span> <span data-start="1709.34" data-end="1714.74">believe the plan is well the plan is</span> <span data-start="1714.74" data-end="1716.57">driven by results right so does the</span> <span data-start="1716.57" data-end="1720.92">slowdown something or not and i think</span> <span data-start="1720.92" data-end="1723.53">the low-level interpreter has seemed to</span> <span data-start="1723.53" data-end="1725.84">work for just munching a lot of code</span> <span data-start="1725.84" data-end="1729.35">that doesn't run very often and the DFG</span> <span data-start="1729.35" data-end="1731.3">works for hot code and i think the</span> <span data-start="1731.3" data-end="1732.68">question is is this baseline JIT</span> <span data-start="1732.68" data-end="1733.4">necessary</span> <span data-start="1733.4" data-end="1736.76">and it seems it right now to remove it</span> <span data-start="1736.76" data-end="1742.4">is not worth it's still in a performance</span> <span data-start="1742.4" data-end="1743.81">improvement but I think that's probably</span> <span data-start="1743.81" data-end="1746.69">due to inefficiencies or things that</span> <span data-start="1746.69" data-end="1748.79">aren't complete in the me optimizing</span> <span data-start="1748.79" data-end="1752.03">compiler more than any fundamental</span> <span data-start="1752.03" data-end="1754.31">architectural advantage so I'm kind of</span> <span data-start="1754.31" data-end="1764.02">talking about so</span> <span data-start="1764.03" data-end="1766.47">just to double check as I understand the</span> <span data-start="1766.47" data-end="1768.72">the JIT compiler runs in thread so you</span> <span data-start="1768.72" data-end="1770.22">have to stop the world in order to</span> <span data-start="1770.22" data-end="1773.309">compile so like the bunching of</span> <span data-start="1773.309" data-end="1775.2">compilation could cause pauses in and of</span> <span data-start="1775.2" data-end="1781.62">itself as well yeah okay I guess that's</span> </p>
</section>