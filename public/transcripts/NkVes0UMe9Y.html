<section>
<p><span data-start="1.87" data-end="3.72">Source maps through the looking glass Ben Vinegar</span> <span data-start="3.72" data-end="4.72"Audience member: Hi everybody, hi.</span> <span data-start="4.72" data-end="5.762">Hope you are enjoying yourselves.</span> <span data-start="5.762" data-end="6.762">Get your bums inside, come on, let's get going with this.</span> <span data-start="6.762" data-end="7.762">Cool.</span> <span data-start="7.762" data-end="8.762">I hope everyone is loving it.</span> <span data-start="8.762" data-end="9.762">Is everybody pleased?</span> <span data-start="9.762" data-end="12.45">Come on, let's get up a gentle whoop if you are enjoying this.</span> <span data-start="12.45" data-end="13.45">Come on.</span> <span data-start="13.45" data-end="14.45">See!</span> <span data-start="14.45" data-end="15.45">There we go, very gentle.</span> <span data-start="15.45" data-end="16.45">Very gentle, hungover people.</span> <span data-start="16.45" data-end="17.45">It's okay.</span> <span data-start="17.45" data-end="18.45">Everything will be fine.</span> <span data-start="18.45" data-end="20.22">Take some aspirin, everything will be okay.</span> </p>
<p><span data-start="20.22" data-end="25.19">Our next speaker is joining us all the way from San Francisco because we haven't had</span> <span data-start="25.19" data-end="26.75">enough Americans speaking here today.</span> <span data-start="26.75" data-end="28.61">They are here and taking over!</span> <span data-start="28.61" data-end="30.54">He works at a company called Sentry, he is a published author, wrote a book called Third</span> <span data-start="30.54" data-end="31.54">Party JavaScript.</span> </p>
<p><span data-start="31.54" data-end="32.54">Hands up if you have read this one.</span> <span data-start="32.54" data-end="33.54">Wow, nobody has read it apparently.</span> <span data-start="33.54" data-end="34.54">We have an illiterate crowd here.</span> <span data-start="34.54" data-end="35.54">I hunted about Ben before and was going through his Twitter feed and was just looking at everything,</span> <span data-start="35.54" data-end="36.54">and when you see heart, heart, favourite, retweet, retweet, you know you've found somebody</span> <span data-start="36.54" data-end="37.54">very special, so without further ado, let's give a big hand for our next speaker, Ben</span> <span data-start="37.54" data-end="38.54">Vinegar.</span> <span data-start="38.54" data-end="39.54">[Applause] BEN: Hello, everybody.</span> <span data-start="39.54" data-end="40.54">So welcome to this talk.</span> <span data-start="40.54" data-end="41.54">It's called Source Maps Through the Looking Glass and I realise now that a looking glass</span> <span data-start="41.54" data-end="42.54">is not actually a magnifying glass, it's a mirror, but humour me.</span> <span data-start="42.54" data-end="47.829">The idea of this talk is to do a deep dive into source maps, maybe use them today but</span> <span data-start="47.829" data-end="51.01">they are kind of a black box technology so we are going to go deeper and uncover what's</span> <span data-start="51.01" data-end="53.19">there.</span> <span data-start="53.19" data-end="55.87">My name is unfortunately Ben Vinegar, it's a real name.</span> <span data-start="55.87" data-end="67.22">I work at a company called Sentry, an open source company that informs you of errors</span> <span data-start="67.22" data-end="72.55">in your applications, be they single page JavaScript applications or server side code</span> <span data-start="72.55" data-end="77.4">or mobile apps and I will touch on that a little bit later in this talk.</span> </p>
<p><span data-start="77.4" data-end="83.26">So to kick things off, just want to talk a little bit about how JavaScript is used today</span> <span data-start="83.26" data-end="87.22">in 2017.</span> <span data-start="87.22" data-end="95.8">How many people here use like a modern dialect of JavaScript, ES6, 2015, 2017, 2030, 2045?</span> <span data-start="95.8" data-end="102.95">Okay, so most people, then you are familiar with this slide which is a really simple function</span> <span data-start="102.95" data-end="110.33">using ES6 modules and using like rest operator and it also has arrow functions.</span> <span data-start="110.33" data-end="116.95">I love these features, they make running JavaScript more fun but I work on a software product</span> <span data-start="116.95" data-end="124.43">that still targets browsers like IE11 and I run it through a tool called Babel and it</span> <span data-start="124.43" data-end="131.61">generates code like this and this will run IE11 just fine.</span> <span data-start="131.61" data-end="137.129">I want to keep going because for some contrived reason I must also wrap this in webpack, so</span> <span data-start="137.129" data-end="144.069">I run that through this tool and it generates a lot more content, but of course I don't</span> <span data-start="144.069" data-end="148.6">actually want to ship all of these characters to end users so I run this through one more</span> <span data-start="148.6" data-end="153.969">time and I'm left with something like this, this probably seems pretty familiar for most</span> <span data-start="153.969" data-end="155.889">people.</span> <span data-start="155.889" data-end="163.069">So somebody famous once said, like JavaScript has become the assembly language of the web,</span> <span data-start="163.069" data-end="166.269">and I had heard this many times over the years and I always thought this was something that</span> </p>
<p><span data-start="166.269" data-end="174.41">Brendan said, maybe it was when he announced Web Assembly, it seems like the type of thing</span> <span data-start="174.41" data-end="180.34">that he would talk about but it was actually coined all the way back in 2011 by Scott Hanselman,</span> <span data-start="180.34" data-end="188.15">an author and blogger, and he was just observing that when he browsed around his favourite</span> <span data-start="188.15" data-end="193.029">websites, be they Google or Facebook, that the code that was being served to him, nobody</span> <span data-start="193.029" data-end="197.069">wrote this; this was being generated by tools.</span> </p>
<p><span data-start="197.069" data-end="204.709">This was before Babel, webpack etc and the comparison to assembly is pretty apt.</span> <span data-start="204.709" data-end="209.37">It's not just a compilation target but assembly is really hard to read.</span> <span data-start="209.37" data-end="214.219">I do not know how many of you have worked with compiled languages or even written assembly</span> <span data-start="214.219" data-end="220.569">but it looks like this, the actual machine instructions that your computer uses to do</span> <span data-start="220.569" data-end="222.31">stuff.</span> <span data-start="222.31" data-end="227.47">Some of these commands are stuff like: move a value from one memory location to a register;</span> <span data-start="227.47" data-end="233.719">do an additional operation on that register; jump to another location in your program,</span> <span data-start="233.719" data-end="235.43">etc.</span> <span data-start="235.43" data-end="242.099">I have experimented with trying to debug compiled applications using just assembly and I have</span> <span data-start="242.099" data-end="243.549">found this very difficult.</span> <span data-start="243.549" data-end="248.049">I have no idea what my program is doing whatsoever and maybe if you are a programming God you</span> <span data-start="248.049" data-end="252.4">might be able to do this but I'm incapable.</span> </p>
<p><span data-start="252.4" data-end="258.35">Of course, you know, if you are debugging in the browser it doesn't look too dissimilar.</span> <span data-start="258.35" data-end="259.35">My code looks like this.</span> <span data-start="259.35" data-end="266.059">I have single letter variables, all my functions have been reduced to nonsense, stepping around</span> <span data-start="266.059" data-end="271.169">- you can kind of maybe understand what your programme is doing but it's really difficult.</span> <span data-start="271.169" data-end="273.389">Similarly, this isn't just debugging in Chrome.</span> <span data-start="273.389" data-end="279.49">This is a screen shot from Sentry, and what we do is take crash reports from client side</span> <span data-start="279.49" data-end="283.68">JavaScript and suck those up into our web server and give you a sack trace to help you</span> <span data-start="283.68" data-end="293.96">reproduce the bug but it's not very experienced for minified code, if you are looking at column</span> <span data-start="293.96" data-end="306.96">.. that's not very helpful.</span> <span data-start="306.96" data-end="316.659">If I compile a complication and add this like dash-dash debug symbol on Mac OS I get this</span> <span data-start="316.659" data-end="322.47">decent folder on Mac OS if I'm building with LOVM — I don't want to get too deep into that</span> <span data-start="322.47" data-end="328.3">- but if I fire up my debugger again with my compiled program and those symbol files</span> <span data-start="328.3" data-end="334.31">are available, the experience of debugging is a lot easier.</span> </p>
<p><span data-start="334.31" data-end="339.919">Now I can actually step through the code that I wrote, I can actually inspect variables</span> <span data-start="339.919" data-end="345.88">using their logical names and not using like memory addresses or register locations, and</span> <span data-start="345.88" data-end="349.039">it's plausible to do things this way.</span> <span data-start="349.039" data-end="355">So debug symbols map machine instructions, just source locations and symbols, etc, so</span> <span data-start="355" data-end="361.37">why don't we have this — if we've had this forever in compiled languages, why don't we</span> <span data-start="361.37" data-end="363.85">have them in JavaScript or in other languages?</span> <span data-start="363.85" data-end="370.72">Well, JavaScript is different because we are not compiling into some intermediate form,</span> <span data-start="370.72" data-end="375.75">be it by code or machine code; we are really just taking text and transforming it to some</span> <span data-start="375.75" data-end="382.1">other piece of text, right, so the existing sort of debug symbol formats or whatever don't</span> <span data-start="382.1" data-end="384.919">really work in this world.</span> </p>
<p><span data-start="384.919" data-end="396.21">Furthermore, when you have debug symbols and you are doing this, you are not sending it</span> <span data-start="396.21" data-end="402.37">over the Internet back and forth, so many format symbols are not really designed for</span> <span data-start="402.37" data-end="404.03">consumption over the web.</span> <span data-start="404.03" data-end="408.87">This is a bit of a long preamble to where we all know where this is going, which is</span> <span data-start="408.87" data-end="413.36">source maps and what the topic of this talk is.</span> <span data-start="413.36" data-end="419.87">So if you didn't know source maps are pretty much a JSON file and it has a format whose</span> <span data-start="419.87" data-end="427.81">content let you map file names, lines, columns that appear in sort of an output file back</span> <span data-start="427.81" data-end="432.419">into — up to N input source files.</span> <span data-start="432.419" data-end="435.91">The source files can be any kind of text, there's nothing about the source map format</span> <span data-start="435.91" data-end="440.36">specifically that's designed extremely for JavaScript.</span> <span data-start="440.36" data-end="448.35">It can be used for things like CSS .. or other transformations and it's also planned</span> <span data-start="448.35" data-end="453.389">for over HTTP and we will see what that means in a bit.</span> <span data-start="453.389" data-end="460.192">So the very first version of this source map spec, I'm not sure exactly sure but I think</span> <span data-start="460.192" data-end="464.83">it was dated around 2009 and was built for a tool called Closure Inspector.</span> <span data-start="464.83" data-end="468.58">Does anyone here use Closure Compiler?</span> <span data-start="468.58" data-end="471.63">Okay, maybe five hands.</span> </p>
<p><span data-start="471.63" data-end="474.569">I'm actually surprised, I thought there would be more than that but Closure Compiler is</span> <span data-start="474.569" data-end="480.11">an optimiser and a minifier, kind of like prepack if you've looked at that a little</span> <span data-start="480.11" data-end="485.37">bit, but it has been around for a long time and one of the Closure Compiler developers</span> <span data-start="485.37" data-end="495.509">wanted to map what they were seeing back to the original code so he built a Firebug plugin</span> <span data-start="495.509" data-end="499.81">and that used effectively the very first version of source maps.</span> <span data-start="499.81" data-end="504.21">It went through a couple of revisions and the latest version is actually revision 3</span> <span data-start="504.21" data-end="506.38">which was written in 2011.</span> </p>
<p><span data-start="506.38" data-end="509.25">Six years ago is a long time in our world.</span> <span data-start="509.25" data-end="512.469">It has been updated a few times.</span> <span data-start="512.469" data-end="515.839">But something to know is that this is just a proposal.</span> <span data-start="515.839" data-end="521.64">You can't go to MDN and find some really fleshed out specification that says what a source</span> <span data-start="521.64" data-end="522.64">map is.</span> <span data-start="522.64" data-end="529.13">It's just like Google Doc that's on the Internet and you can see at any moment who is reading</span> <span data-start="529.13" data-end="532.67">it at the same time, usually about a dozen people, and you can attempt to chat to them</span> <span data-start="532.67" data-end="536.99">but they are usually not listening.</span> <span data-start="536.99" data-end="541.78">So despite the fact that this is kind of like this specification that doesn't have the standards</span> <span data-start="541.78" data-end="546.17">value behind it, it doesn't really matter because everything kind of uses it which is</span> <span data-start="546.17" data-end="547.279">really cool.</span> <span data-start="547.279" data-end="560.31">Compilers, you know, be it Battle or even C2 JavaScript compiler, module bundlers, every</span> <span data-start="560.31" data-end="567.029">browser, tools like Sentry, so we unminify stack traces, Node stack support is interesting</span> <span data-start="567.029" data-end="576.67">that will magically convert conceptions into their original format if you are maybe using</span> <span data-start="576.67" data-end="579.65">typescript on the server or something like that.</span> </p>
<p><span data-start="579.65" data-end="583.12">So we are going to go through like an end to end example to understand how source maps</span> <span data-start="583.12" data-end="584.12">work.</span> <span data-start="584.12" data-end="587.529">I am going to bring us all the way back to this function that I showed you at the beginning,</span> <span data-start="587.529" data-end="592.09">add JS, just an add function etc.</span> <span data-start="592.09" data-end="604.04">I am going to run this through Babel, just to keep this simple, so from Babel I can just</span> <span data-start="604.04" data-end="612.94">say: hey, take add.JS, take this file, I'm using this ES2015 pre-set to target a particular</span> <span data-start="612.94" data-end="619.64">set of browsers, and then also specify this source maps configuration.</span> <span data-start="619.64" data-end="622.86">If I run that command a couple of things are going to happen.</span> <span data-start="622.86" data-end="633.27">My file is going to be modified a little bit, and also I get a source map file but before</span> <span data-start="633.27" data-end="638.579">I jump to that source map file let's take a look at the output file and at dys.js.</span> <span data-start="638.579" data-end="646.779">It's pretty much the same except with one key addition which is it adds this line to</span> <span data-start="646.779" data-end="650.49">the end of the file which is this source mapping URL directive.</span> </p>
<p><span data-start="650.49" data-end="654.87">This is the thing that tells browsers and other tools where to find the source map file</span> <span data-start="654.87" data-end="659.79">that is associated with this JavaScript file.</span> <span data-start="659.79" data-end="665.52">So browser downloads your JavaScript file, goes to the very end, looks for the last comment</span> <span data-start="665.52" data-end="674.49">and goes, "Aha, I need to add JS.map", and that is relative.</span> <span data-start="674.49" data-end="678.649">It doesn't have to be relative, you can specify a full path and that's where the browser will</span> <span data-start="678.649" data-end="680.589">download it from.</span> </p>
<p><span data-start="680.589" data-end="684.339">A lot of people talk to me that they want to use source maps but don't want to expose</span> <span data-start="684.339" data-end="691.769">[audio problem] .. can have your source mapping URL point to a location that's maybe only</span> <span data-start="691.769" data-end="697.36">accessible on a private network so you can download it and other interlopers can't.</span> <span data-start="697.36" data-end="705.3">You could even host those files locally on your own little web server, so you can point</span> <span data-start="705.3" data-end="709.87">back at local host and you will be able to download that file.</span> <span data-start="709.87" data-end="712.73">Another thing that not everybody is aware of is you don't have to use this source mapping</span> <span data-start="712.73" data-end="713.73">URL directive.</span> <span data-start="713.73" data-end="720.17">There's a header called source map that you can send down with your file that is a clue</span> <span data-start="720.17" data-end="725.91">to your browser where to find these source maps, but not everybody has the power to just</span> <span data-start="725.91" data-end="728.459">arbitrarily change headers.</span> <span data-start="728.459" data-end="731.42">Again, I mentioned CSS earlier.</span> <span data-start="731.42" data-end="739.36">It doesn't strictly have to be this // comment; you can also use this CSS comment at the end</span> <span data-start="739.36" data-end="743.709">of your file too.</span> </p>
<p><span data-start="743.709" data-end="747.43">If you want to get started with source maps and just want to use them, this is pretty</span> <span data-start="747.43" data-end="748.899">much all you need to do.</span> <span data-start="748.899" data-end="753.74">You use tools, generate a source map file, put them on your web server, the browser will</span> <span data-start="753.74" data-end="758.6">download them and now when you start debugging you get to step 3.</span> <span data-start="758.6" data-end="762.8">That's pretty cool, that's it.</span> <span data-start="762.8" data-end="765.64">So I would recommend doing that.</span> <span data-start="765.64" data-end="770.389">Similarly, Sentry, we kind of act like a browser.</span> <span data-start="770.389" data-end="776.68">We actually when we see stack traces that have JavaScript files in them, will actually</span> <span data-start="776.68" data-end="780.829">try to fetch those JavaScript files and if we see that there's a source map header or</span> <span data-start="780.829" data-end="784.339">a source mapping URL directive we will download that source map and will apply it to your</span> <span data-start="784.339" data-end="789.579">stack trace and try to show you the original file, the line and the column, and we even</span> <span data-start="789.579" data-end="793.25">pull surrounding source code too, which is kind of cool, so in this case this is actually</span> <span data-start="793.25" data-end="800.401">an example from our live application with some JSX and that's kind of neat.</span> <span data-start="800.401" data-end="803.381">But we are going to go a little bit deeper because I think it's interesting just to understand</span> <span data-start="803.381" data-end="805.12">how does a source map even work.</span> </p>
<p><span data-start="805.12" data-end="812.11">How many people here have like tried to open a production source map in their text editor?</span> <span data-start="812.11" data-end="815.55">Okay, was that a good experience?</span> <span data-start="815.55" data-end="816.83">No, okay.</span> <span data-start="816.83" data-end="822.16">Typically this is what happens to me which is like my editor pretty much crashes, and</span> <span data-start="822.16" data-end="824.649">they say because source maps can get really big.</span> <span data-start="824.649" data-end="827.91">It's totally normal for them to be megabytes in size.</span> <span data-start="827.91" data-end="832.029">We've seen source maps as large as 30 megabytes which is pretty absurd.</span> <span data-start="832.029" data-end="836.48">The reason we started this with a contrived simple example is that this entire source</span> <span data-start="836.48" data-end="841.889">map can fit in one slide so this is what a source map looks like.</span> </p>
<p><span data-start="841.889" data-end="846.959">I've pushed around the white space a bit so you can read it easier and we will go through</span> <span data-start="846.959" data-end="849.56">all the pieces of this really quickly.</span> <span data-start="849.56" data-end="854.16">So the very first piece is just a version spring, a clue to the browser what version</span> <span data-start="854.16" data-end="856.23">am I dealing with.</span> <span data-start="856.23" data-end="859.58">As we learned early version 3 is pretty much the latest.</span> <span data-start="859.58" data-end="864.05">So pretty much everything says version 3.</span> <span data-start="864.05" data-end="867.05">What file is associated with this, what is this source map for?</span> </p>
<p><span data-start="867.05" data-end="868.05">In this case it's add.js.</span> <span data-start="868.05" data-end="873.37">It's associated with one file.</span> <span data-start="873.37" data-end="878.19">Sources are a list of input files that went into this output file.</span> <span data-start="878.19" data-end="884.72">In our case it's a single file, but if this had many components, modules, you can imagine</span> <span data-start="884.72" data-end="889.47">this could be dozens, maybe even hundreds or a thousand files.</span> <span data-start="889.47" data-end="893.36">Sources content, this is like an optional feature of source maps.</span> <span data-start="893.36" data-end="899.86">Babel inlines all our code into the source map for convenience, and you don't have to</span> <span data-start="899.86" data-end="905.459">do this but this is also what contributes to source as being so large but it's convenient</span> <span data-start="905.459" data-end="906.66">because it works out of the box.</span> <span data-start="906.66" data-end="910.22">You don't have to deal with other problems like where do you find all of these other</span> <span data-start="910.22" data-end="911.95">source files.</span> <span data-start="911.95" data-end="917.17">Lastly, this is the biggest part of what makes a source map a source map, which is this big</span> <span data-start="917.17" data-end="918.45">mappings blob.</span> </p>
<p><span data-start="918.45" data-end="925.99">It kind of looks like a bunch of nonsense but it isn't and we are going to walk through</span> <span data-start="925.99" data-end="931.56">actually translating something by hand, just so you understand what is taking place.</span> <span data-start="931.56" data-end="937.3">So one thing to know is that when you are doing source map parsers, they work through</span> <span data-start="937.3" data-end="939.68">a source map or this mappings property linearly.</span> <span data-start="939.68" data-end="944.69">They start at the very beginning and the very beginning represents line 0.</span> <span data-start="944.69" data-end="948.34">It's not like random access, you can't go to the middle of this blob, you have to process</span> <span data-start="948.34" data-end="951.36">the whole thing in order.</span> <span data-start="951.36" data-end="958.379">So each semicolon denotes a new line so we start at line zero and you will notice that</span> <span data-start="958.379" data-end="963.9">this source map actually begins with five semicolons and that may seem kind of weird.</span> <span data-start="963.9" data-end="970.11">The reason for that is that Babel outputs some sort of preamble to the output file for</span> <span data-start="970.11" data-end="975.35">which there's actually like no matching code or input file and the source map basically</span> <span data-start="975.35" data-end="976.35">recognises that.</span> <span data-start="976.35" data-end="983.1">It's like: hey, just skip over this because there's nothing for us to even point to here.</span> <span data-start="983.1" data-end="988.25">So if we continue, we go past those first opening lines, and we get to what's called</span> <span data-start="988.25" data-end="989.779">a segment.</span> <span data-start="989.779" data-end="994.65">Segments are comma separated and these are the things that actually make the translation</span> <span data-start="994.65" data-end="999.39">from your output source to your input source.</span> </p>
<p><span data-start="999.39" data-end="1002.819">Segments are made of variable length quantities.</span> <span data-start="1002.819" data-end="1009.68">Now, what is QA — maybe that's an L or an I, I'm not sure — GB.</span> <span data-start="1009.68" data-end="1013.3">So it's a variable length quantity called VOQ.</span> <span data-start="1013.3" data-end="1020.36">This is sort of a format that's designed for efficiently encoding arbitrarily large integers.</span> <span data-start="1020.36" data-end="1029.78">It's a little different and was designed for midi files which is interesting.</span> <span data-start="1029.78" data-end="1038.579">So for single characters this is fine, but as you get larger, 123 is only three characters,</span> <span data-start="1038.579" data-end="1047.49">123456789, five characters, or six, so if it's plain text and we've got to download</span> <span data-start="1047.49" data-end="1051.69">it we want to represent that in as small a format as possible.</span> <span data-start="1051.69" data-end="1059.74">What is actually neat about VOQ is arbitrary lengths can also be included efficiently.</span> <span data-start="1059.74" data-end="1064.2">That's the last digit at the bottom.</span> <span data-start="1064.2" data-end="1070.91">It's represented by these five characters so we get to avoid commas and the negative</span> <span data-start="1070.91" data-end="1075.21">prefix which is pretty cool.</span> <span data-start="1075.21" data-end="1078.61">The specifics of how to actually convert these, I don't really know.</span> <span data-start="1078.61" data-end="1083.151">I just let this library called VOQ which you can install to decode them and that's how</span> <span data-start="1083.151" data-end="1087.5">I work through a lot of these problems.</span> <span data-start="1087.5" data-end="1090.13">So let's go back to this QAIGB.</span> </p>
<p><span data-start="1090.13" data-end="1099.83">If I decode this I get 80416 so what does that mean?</span> <span data-start="1099.83" data-end="1101.11">Once you break it down it's pretty simple.</span> <span data-start="1101.11" data-end="1103.789">This is where now the source map starts to make sense.</span> <span data-start="1103.789" data-end="1110.77">The very first value is the column in our output file, add.js, and remember because</span> <span data-start="1110.77" data-end="1116.95">we are working linearly we already know what the line number is, which is like line 5.</span> <span data-start="1116.95" data-end="1119.02">The second value is indexing [sound problem] array.</span> </p>
<p><span data-start="1119.02" data-end="1122.89">We only have a single array so it's 0.</span> <span data-start="1122.89" data-end="1129.39">Then the final are the input and the input source file, so if I convert this, this is</span> <span data-start="1129.39" data-end="1133.929">basically what this segment is trying to tell us.</span> <span data-start="1133.929" data-end="1138.49">We are currently on column 5 line 9 of add.js.</span> <span data-start="1138.49" data-end="1145.56">For this one it's column 5, line 17 and if I break this down and go back to my input</span> <span data-start="1145.56" data-end="1153.539">and output file, it's saying in the output file add is over here and in my input file</span> <span data-start="1153.539" data-end="1156.54">add is over there.</span> <span data-start="1156.54" data-end="1165.539">That's pretty much how this works.</span> <span data-start="1165.539" data-end="1170.22">Source maps really just — they could be character by character, there's nothing that would stop</span> <span data-start="1170.22" data-end="1174.95">you from doing this but we only need to source map the start locations of identifiers.</span> <span data-start="1174.95" data-end="1179.929">That's efficient because if we mapped every single character this mappings property would</span> <span data-start="1179.929" data-end="1185.89">be gigantic but if we only have to do identifiers, it's much smaller so I am only going to convert</span> <span data-start="1185.89" data-end="1190.45">one more value just to kind of bring this idea home.</span> <span data-start="1190.45" data-end="1193.64">The very next value, the very next segment if you can see it is actually just a capital</span> <span data-start="1193.64" data-end="1199.19">G which is a little confusing because it's like: wait a minute, didn't I need four values</span> <span data-start="1199.19" data-end="1200.2">to translate something?</span> </p>
<p><span data-start="1200.2" data-end="1204.76">What am I going to do with this single value which is actually a 8?</span> <span data-start="1204.76" data-end="1206.87">Oh, actually I think it's a 3.</span> <span data-start="1206.87" data-end="1209.7">I may have messed this up.</span> <span data-start="1209.7" data-end="1212.93">So segment values are relative.</span> <span data-start="1212.93" data-end="1216.429">This is sort of like a space-saving kind of idea, right, like I don't need to have the</span> <span data-start="1216.429" data-end="1219.33">absolute value for every single segment.</span> <span data-start="1219.33" data-end="1224.13">I can just work off what I was doing in the last segment so if we just add this value</span> <span data-start="1224.13" data-end="1232.52">to the previous segment and we get a new location which is 11 instead of character 8 — bear</span> <span data-start="1232.52" data-end="1238.97">with me, this is a little confusing — but the idea is there was another identifier add.</span> <span data-start="1238.97" data-end="1240.1">Add appears twice, right?</span> <span data-start="1240.1" data-end="1244.919">So this is actually linking back to the same location.</span> <span data-start="1244.919" data-end="1254.85">Remember, the very first value is the location in the output file, right, so line 5, line</span> <span data-start="1254.85" data-end="1257.21">17, like that didn't change.</span> </p>
<p><span data-start="1257.21" data-end="1262.87">So what's really happening here is that the source map is telling us that this add function</span> <span data-start="1262.87" data-end="1266.75">appears twice in the file, which is kind of interesting.</span> <span data-start="1266.75" data-end="1271.679">So hopefully you have a basic understanding of how this is going.</span> <span data-start="1271.679" data-end="1277.309">I would just keep working through these values, keep translating them, keep getting new translations,</span> <span data-start="1277.309" data-end="1281.96">but the idea here is that I finish in a place where I basically take all these values and</span> <span data-start="1281.96" data-end="1286.529">I dump them into some data structure like a table so that going forward I don't actually</span> <span data-start="1286.529" data-end="1292.24">look at the source map; I just kind of like query this table for the data.</span> <span data-start="1292.24" data-end="1296.48">This is how Web Inspector works, other tools, Sentry etc, work.</span> </p>
<p><span data-start="1296.48" data-end="1301.72">They just munch through a source map, generate this big lookup table and then the rest is</span> <span data-start="1301.72" data-end="1305.37">- just kind of works by itself.</span> <span data-start="1305.37" data-end="1309.08">It seems like a lot to take in but the good news is you don't ever really need to know</span> <span data-start="1309.08" data-end="1310.279">the particulars of how this works.</span> <span data-start="1310.279" data-end="1313.84">I just wanted to explain what is happening because it's kind of neat.</span> <span data-start="1313.84" data-end="1324.159">There is a tool called source-map, it's on npm, it's from Mozilla, and it does what we</span> <span data-start="1324.159" data-end="1329.799">just did, breaks down the source map and provides an API where you can look up the location</span> <span data-start="1329.799" data-end="1331.76">for yourself.</span> <span data-start="1331.76" data-end="1335.64">The API is a little complex because it does a lot but it looks like this.</span> <span data-start="1335.64" data-end="1340.53">I import this library, I read my source map file from the file system, I then create what's</span> <span data-start="1340.53" data-end="1345.48">called a source map consumer, and then I can look up, you know, original position for line</span> <span data-start="1345.48" data-end="1349.95">6, column 0, whatever I want to look up and it will tell me which file, what line, what</span> <span data-start="1349.95" data-end="1355.44">column, so if you are working with source maps and you've ever struggled with — it seems</span> <span data-start="1355.44" data-end="1358.7">like the lines and columns don't match up exactly the way that you wanted, I recommend</span> <span data-start="1358.7" data-end="1361.88">using this library to look up the values yourself to see if they make sense.</span> </p>
<p><span data-start="1361.88" data-end="1366.49">That can spare a lot of time with debugging.</span> <span data-start="1366.49" data-end="1369.409">So this kind of takes me to the end.</span> <span data-start="1369.409" data-end="1370.409">What do we learn?</span> <span data-start="1370.409" data-end="1371.409">It's a bit of a wrap-up.</span> </p>
<p><span data-start="1371.409" data-end="1374.39">So source maps are kind of debug symbols for the web.</span> <span data-start="1374.39" data-end="1375.39">That's close enough.</span> <span data-start="1375.39" data-end="1377.07">They are just files, lines and columns.</span> <span data-start="1377.07" data-end="1384.97">They are designed for efficient transmission over HTTP, that's why there's these relative</span> <span data-start="1384.97" data-end="1390.52">segments, etc, and the cool thing is that almost everything supports them today so if</span> <span data-start="1390.52" data-end="1394.49">you are not using them, you should be using them.</span> </p>
<p><span data-start="1394.49" data-end="1399.419">So again, my name is Ben Vinegar, I hope that you've found this talk vaguely illuminating.</span> <span data-start="1399.419" data-end="1401.039">If you want to find me, this is me on the Internet.</span> <span data-start="1401.039" data-end="1402.85">This is a link to pretty much everything we talked to today.</span> <span data-start="1402.85" data-end="1406.13">Please check out Sentry, it's really helpful and it's open source and you can run it on</span> <span data-start="1406.13" data-end="1407.13">your own server.</span> </p>
<p><span data-start="1407.13" data-end="1408.13">Thank you.</span> </p>
</section>