<section>
<p><span data-start="14.299" data-end="20.76">hi everyone today my talk will be my</span> <span data-start="20.76" data-end="23.58">talk will be on the scaling lesson is</span> <span data-start="23.58" data-end="26.849">that took him learn over the past 45</span> <span data-start="26.849" data-end="28.71">years using the GSN production in</span> <span data-start="28.71" data-end="32.309">problem and the second part my talk will</span> <span data-start="32.309" data-end="34.739">be on IP cluster which is a small</span> <span data-start="34.739" data-end="36.63">library that we have open we have just</span> <span data-start="36.63" data-end="39.42">open source yesterday to help us with</span> <span data-start="39.42" data-end="45.18">scaling no services so I'm young bin my</span> <span data-start="45.18" data-end="47.16">friends just call you ID i'm a</span> <span data-start="47.16" data-end="49.71">co-founder also pin so we is the best</span> <span data-start="49.71" data-end="53.96">live chat company in the world it seems</span> <span data-start="53.96" data-end="57.48">150,000 websites we get 3 billion</span> <span data-start="57.48" data-end="59.55">impressions on our chat widget month and</span> <span data-start="59.55" data-end="63.059">a pic we see 500,000 concurrent</span> <span data-start="63.059" data-end="68.07">connections so in two thousand Canada</span> <span data-start="68.07" data-end="70.35">doing nov 9 and 10 we decided that we</span> <span data-start="70.35" data-end="72.6">wanted to rewrite our dashboard after</span> <span data-start="72.6" data-end="78.9">three years from flex to html5 so at a</span> <span data-start="78.9" data-end="81.06">point flag set have been really good to</span> <span data-start="81.06" data-end="83.909">us because this off all the cross</span> <span data-start="83.909" data-end="87.15">browser issues and they have TCP socket</span> <span data-start="87.15" data-end="89.159">support so we could have a chance of</span> <span data-start="89.159" data-end="93.06">survival for four orders codon streaming</span> <span data-start="93.06" data-end="96.09">data but we were getting running the</span> <span data-start="96.09" data-end="98.07">morn problems because we couldn't it was</span> <span data-start="98.07" data-end="100.07">difficult hire people at new flex and</span> <span data-start="100.07" data-end="103.829">also it was extremely difficult to</span> <span data-start="103.829" data-end="107.54">customize so designers are not happy so</span> <span data-start="107.54" data-end="112.049">we decided to do everything in html5</span> <span data-start="112.049" data-end="115.02">again and apply sauna lessons that we</span> <span data-start="115.02" data-end="116.969">learned pitting our dashboard so for</span> <span data-start="116.969" data-end="118.77">instance in the new version of our</span> <span data-start="118.77" data-end="121.2">dashboard we decided that the entire</span> <span data-start="121.2" data-end="124.909">application state would be based on</span> <span data-start="124.909" data-end="129.75">buying the body that so in the Flex</span> <span data-start="129.75" data-end="131.61">version we had usually have made an API</span> <span data-start="131.61" data-end="133.06">call in a setup fiction</span> <span data-start="133.06" data-end="135.849">to put data in and that was very tedious</span> <span data-start="135.849" data-end="138.34">and it meant that some parts of</span> <span data-start="138.34" data-end="139.75">application that when you if you know</span> <span data-start="139.75" data-end="142.87">about it to set this up you had hot</span> <span data-start="142.87" data-end="145.45">problems like when agents are entered</span> <span data-start="145.45" data-end="147.81">and so on they do not reflect on you I</span> <span data-start="147.81" data-end="151.989">so we decided that we should write a set</span> <span data-start="151.989" data-end="154.3">of not GNE servers that will help to</span> <span data-start="154.3" data-end="156.03">translate the data from our back-end</span> <span data-start="156.03" data-end="158.769">into a format next month I just over by</span> <span data-start="158.769" data-end="162.43">our front end so note was a good fit for</span> <span data-start="162.43" data-end="166.06">us at a time it was a very familiar</span> <span data-start="166.06" data-end="170.25">environment and you can think of our our</span> <span data-start="170.25" data-end="173.08">mediator service as we call them as a</span> <span data-start="173.08" data-end="177.58">kind of dynamic CDN which which means we</span> <span data-start="177.58" data-end="180.28">kind of cash or dynamic information in</span> <span data-start="180.28" data-end="182.14">our servers around the world so</span> <span data-start="182.14" data-end="184.15">distributing also was wrong we also give</span> <span data-start="184.15" data-end="185.709">us additional benefits that lower</span> <span data-start="185.709" data-end="192.04">latency is to our end users and being</span> <span data-start="192.04" data-end="196.42">able to handle the load for different</span> <span data-start="196.42" data-end="200.56">parts of the world so no Jess really</span> <span data-start="200.56" data-end="207.22">rocked it was really fast so it looks</span> <span data-start="207.22" data-end="208.87">good but the problem is of course number</span> <span data-start="208.87" data-end="211">communities a pressure model which is</span> <span data-start="211" data-end="213.97">the typical no problems which is a</span> <span data-start="213.97" data-end="216.7">guys single credit and we have memory</span> <span data-start="216.7" data-end="218.23">leaks in our applications they are to</span> <span data-start="218.23" data-end="222.13">track down so all problems in computer</span> <span data-start="222.13" data-end="223.959">science and software play of redirection</span> <span data-start="223.959" data-end="227.799">right so easy way out interest to buy a</span> <span data-start="227.799" data-end="230.38">couple of load balancers proxies SSL</span> <span data-start="230.38" data-end="233.47">terminators etc but because we will</span> <span data-start="233.47" data-end="234.489">start off with in have that kind of</span> <span data-start="234.489" data-end="236.38">money so we had to be a bit more</span> <span data-start="236.38" data-end="238.66">creative with how we try to schedule our</span> <span data-start="238.66" data-end="243.1">our server so these are some of the</span> <span data-start="243.1" data-end="246.97">things that we try obviously the beauty</span> <span data-start="246.97" data-end="250.18">in cluster module which works well from</span> <span data-start="250.18" data-end="252.069">hitch to be repairs but because we had</span> <span data-start="252.069" data-end="255.19">our service was live chat we had</span> <span data-start="255.19" data-end="257.109">persistent connection with our users so</span> <span data-start="257.109" data-end="259.69">that you can stream the data and this</span> <span data-start="259.69" data-end="261.64">really breaks long polling connections</span> <span data-start="261.64" data-end="264.94">because each additional each each time</span> <span data-start="264.94" data-end="266.71">the long four finishers</span> <span data-start="266.71" data-end="268.24">the browser will connect to a different</span> <span data-start="268.24" data-end="269.199">server and then you lose your whole</span> <span data-start="269.199" data-end="271.96">application state so there was out at a</span> <span data-start="271.96" data-end="273.759">time there was a web sockets for ngx</span> <span data-start="273.759" data-end="275.5">body was at a party module and was not</span> <span data-start="275.5" data-end="280.259">very live we looked at his a proxy and</span> <span data-start="280.259" data-end="287.8">start so history proxy is is a kind of</span> <span data-start="287.8" data-end="290.44">dumb proxy so the biggest problem</span> <span data-start="290.44" data-end="291.789">hitters proxy was that there was no we</span> <span data-start="291.789" data-end="294.25">could get our client IP address in our</span> <span data-start="294.25" data-end="297.759">application because we're using SSL and</span> <span data-start="297.759" data-end="299.68">he proceeded as i understand ssl alright</span> <span data-start="299.68" data-end="302.289">so we looked at stat which is the ssl</span> <span data-start="302.289" data-end="305.949">terminator so what I means is your</span> <span data-start="305.949" data-end="308.229">browser makes an ssl connection to start</span> <span data-start="308.229" data-end="311.759">start on reps that ssl encryption and</span> <span data-start="311.759" data-end="314.169">makes it normal TZ connection to your</span> <span data-start="314.169" data-end="317.71">server so you don't have to end ssl and</span> <span data-start="317.71" data-end="318.97">all the decoding or the decryption</span> <span data-start="318.97" data-end="323.56">standbys by the most start so the</span> <span data-start="323.56" data-end="325.27">application as much if you do its own</span> <span data-start="325.27" data-end="327.88">thing and you don't have to handle it</span> <span data-start="327.88" data-end="330.4">you can handle anything from you as well</span> <span data-start="330.4" data-end="335.59">so when i start for a while but and in</span> <span data-start="335.59" data-end="337.27">the next slide I will talk about how we</span> <span data-start="337.27" data-end="338.74">start the problem trying to get the</span> <span data-start="338.74" data-end="342.37">client IP address from stuff we also</span> <span data-start="342.37" data-end="345.729">look at forwarding soccer file</span> <span data-start="345.729" data-end="349.9">descriptors in Linux you can send the</span> <span data-start="349.9" data-end="353.38">file descriptor between processors so</span> <span data-start="353.38" data-end="355.9">for tcp doesn't work because you could</span> <span data-start="355.9" data-end="357.849">just send the farthest planet process</span> <span data-start="357.849" data-end="360.88">and and we can write off the 40 script</span> <span data-start="360.88" data-end="364.21">but we were using SSL so that kind of</span> <span data-start="364.21" data-end="365.44">poke the whole thing because esta has</span> <span data-start="365.44" data-end="367.479">this really opaque state that you can't</span> <span data-start="367.479" data-end="374.949">stand over socket so let me show you how</span> <span data-start="374.949" data-end="378.07">we managed to capture our client padres</span> <span data-start="378.07" data-end="382.05">so we were very happy that we were using</span> <span data-start="382.05" data-end="384.61">not because we could do things like this</span> <span data-start="384.61" data-end="387.46">which is basically heck the note HTTP</span> <span data-start="387.46" data-end="392.169">server so that what we did was start at</span> <span data-start="392.169" data-end="395.08">this option to after unwraps the</span> <span data-start="395.08" data-end="397.69">encryption for the connection since the</span> </p>
<p><span data-start="397.69" data-end="399.58">IP address on the client we fill in the</span> <span data-start="399.58" data-end="400">first four</span> <span data-start="400" data-end="402.28">bites of the tcp stream so what I'm</span> <span data-start="402.28" data-end="403.87">trying boo here is we are trying to</span> <span data-start="403.87" data-end="406.3">intercept that initial connection even</span> <span data-start="406.3" data-end="409.35">before the HTTP server gets it read off</span> <span data-start="409.35" data-end="413.71">the IP address and then pass it back to</span> <span data-start="413.71" data-end="415.93">the notes to note so you should be</span> <span data-start="415.93" data-end="418.6">server to do it's a healer passing it on</span> <span data-start="418.6" data-end="421.3">and others modulus ave he has to do so</span> <span data-start="421.3" data-end="424.18">as you can see what we did let me go</span> <span data-start="424.18" data-end="427.53">people we get a list of existing</span> <span data-start="427.53" data-end="431.26">connections on a tcp server and one of</span> <span data-start="431.26" data-end="434.23">these connection handlers well this</span> <span data-start="434.23" data-end="436.36">connection event handlers would be the</span> </p>
<p><span data-start="436.36" data-end="440.62">HTTP header process so we intersect the</span> <span data-start="440.62" data-end="444.22">connection and on one receiving any data</span> <span data-start="444.22" data-end="449.86">we attempt to oops we attempt to read</span> <span data-start="449.86" data-end="454.51">off the first few bites that mix up the</span> <span data-start="454.51" data-end="457.62">client IP address and sets it on the</span> <span data-start="457.62" data-end="460.84">socket connection and then pass through</span> <span data-start="460.84" data-end="463.99">the remaining data to the original</span> <span data-start="463.99" data-end="467.85">handler for this soccer so this works</span> <span data-start="467.85" data-end="469.84">it's a bit complicated actually because</span> </p>
<p><span data-start="469.84" data-end="473.76">I kind of thicken up or error handling</span> <span data-start="473.76" data-end="479.47">right and but it worked for for us for</span> <span data-start="479.47" data-end="482.35">for quite a while and so we thought</span> <span data-start="482.35" data-end="487.78">through this for maybe half a year sound</span> <span data-start="487.78" data-end="492.88">the other problems in general when you</span> <span data-start="492.88" data-end="494.38">when you talk about this kind of</span> <span data-start="494.38" data-end="497.05">multi-layer infrastructure where you</span> <span data-start="497.05" data-end="499.87">have proxies SSL two meters is that you</span> <span data-start="499.87" data-end="501.85">get buffer bill which is when all the</span> <span data-start="501.85" data-end="503.979">different components in the stack buffer</span> <span data-start="503.979" data-end="506.74">a little bit of data and so from an</span> <span data-start="506.74" data-end="508.3">application you can tell how much data</span> <span data-start="508.3" data-end="509.979">is being buffered by dresses so how much</span> <span data-start="509.979" data-end="511.15">room is still sorting our network in</span> <span data-start="511.15" data-end="513.669">whether your client has received that</span> <span data-start="513.669" data-end="519.31">they are not so after about six months</span> <span data-start="519.31" data-end="523.33">or rather for six months while we're</span> <span data-start="523.33" data-end="526.27">using stuff we occasionally got problems</span> <span data-start="526.27" data-end="528.76">we start just dies and recent god is</span> <span data-start="528.76" data-end="531.56">inexplicable errors that</span> <span data-start="531.56" data-end="534.85">that what's wrong need not because of</span> <span data-start="534.85" data-end="538.96">something I start was doing and the ssl</span> <span data-start="538.96" data-end="541.73">the tcp handler in node could not handle</span> <span data-start="541.73" data-end="545.75">this so we continue to look for a better</span> <span data-start="545.75" data-end="552.89">solution soft our scaling problem so let</span> <span data-start="552.89" data-end="554.48">me stay that we thank you give you guys</span> <span data-start="554.48" data-end="560.51">a primer on mac bus so you I guess you</span> <span data-start="560.51" data-end="563.57">have study familiar with IP addresses</span> <span data-start="563.57" data-end="565.22">and a net mass that looks like this so</span> </p>
<p><span data-start="565.22" data-end="569.45">II my night 1685 to 128 is the IP</span> <span data-start="569.45" data-end="572.48">address and / 26 refers to the network</span> <span data-start="572.48" data-end="575">at this IP address belongs to so what is</span> <span data-start="575" data-end="577.82">essentially means is that the first if</span> <span data-start="577.82" data-end="582.44">you click the first 26 bits of this IP</span> <span data-start="582.44" data-end="584.75">address that is the network of this IP</span> <span data-start="584.75" data-end="588.11">address so this is a way for now engines</span> <span data-start="588.11" data-end="591.65">to partition that works into site into</span> <span data-start="591.65" data-end="594.22">cyber challenge manageable chunks and</span> <span data-start="594.22" data-end="600.05">true for initiative process like you</span> <span data-start="600.05" data-end="603.08">could route data you can roll back at</span> <span data-start="603.08" data-end="605.089">space on which network you are coming</span> <span data-start="605.089" data-end="611.17">from which now we are going to so we</span> <span data-start="611.17" data-end="614.08">figured out that we could actually abuse</span> <span data-start="614.08" data-end="616.88">net masks by matching on the least</span> <span data-start="616.88" data-end="619.79">significant bits so when we measure the</span> <span data-start="619.79" data-end="623.72">most images are in a typical way that</span> <span data-start="623.72" data-end="626.21">people use that mass if we did load</span> <span data-start="626.21" data-end="628.46">balancing based on that what the problem</span> <span data-start="628.46" data-end="630.26">we will find is that you have some</span> <span data-start="630.26" data-end="631.339">networks where you have a lot of users</span> <span data-start="631.339" data-end="633.98">and sometimes very very very easy so if</span> <span data-start="633.98" data-end="635.48">you try and do load balancing that just</span> <span data-start="635.48" data-end="638.06">because you just end up with this</span> <span data-start="638.06" data-end="639.62">service they have to sell a lot of</span> <span data-start="639.62" data-end="641.51">traffic because I don't know very good</span> <span data-start="641.51" data-end="644.36">like a whore China is in one small neck</span> <span data-start="644.36" data-end="647.3">block so if you got actually we could</span> <span data-start="647.3" data-end="649.25">match on at least if you can beat and in</span> <span data-start="649.25" data-end="651.11">this way we get some sort of random</span> <span data-start="651.11" data-end="653.6">nurse when we're trying to route our</span> <span data-start="653.6" data-end="655.94">users and at the same time because it's</span> <span data-start="655.94" data-end="658.16">based on IP address so for long pulling</span> <span data-start="658.16" data-end="660.86">such different connections we still go</span> <span data-start="660.86" data-end="664.52">back to the same so so in fact the</span> <span data-start="664.52" data-end="665.1">leaner</span> <span data-start="665.1" data-end="668.11">now if you'll Ahmad you that's allow you</span> <span data-start="668.11" data-end="670.93">to match arbitrary numbers addresses</span> <span data-start="670.93" data-end="675.49">addresses so if you see there's a</span> <span data-start="675.49" data-end="677.98">bloodbath 2000 doctrine that is the</span> <span data-start="677.98" data-end="679.24">networks that we're using so what we're</span> <span data-start="679.24" data-end="684.91">saying is match the last two bits of the</span> </p>
<p><span data-start="684.91" data-end="688.48">IP address and that is the net block I</span> <span data-start="688.48" data-end="691.87">mean so called the slot then the client</span> <span data-start="691.87" data-end="694.24">belongs to so what we do here is for</span> <span data-start="694.24" data-end="697.27">each of these blocks we brought it we</span> </p>
<p><span data-start="697.27" data-end="699.88">Rida right into one of our worker</span> <span data-start="699.88" data-end="703.839">processes and this has to be a it has to</span> <span data-start="703.839" data-end="706.41">be a power of two processors because of</span> <span data-start="706.41" data-end="712.6">how the mass works so we deploy this</span> <span data-start="712.6" data-end="715.15">solution and it worked really well for</span> <span data-start="715.15" data-end="718.27">us we could scale the number of worker</span> <span data-start="718.27" data-end="720.82">processors by adjusting the number of</span> <span data-start="720.82" data-end="723.31">bits what you mentioned in this case we</span> <span data-start="723.31" data-end="725.17">are matching to bit so they are four</span> <span data-start="725.17" data-end="727.089">workers but if we had like a 30-foot</span> <span data-start="727.089" data-end="729.66">core machine and you match five bits and</span> <span data-start="729.66" data-end="734.26">half that number of other processors so</span> <span data-start="734.26" data-end="737.86">this worked very well oh no we still get</span> <span data-start="737.86" data-end="739.33">we see at some remaining issues which</span> <span data-start="739.33" data-end="742.48">which is our application our loan</span> <span data-start="742.48" data-end="745.69">application has some memory leaks and</span> <span data-start="745.69" data-end="748.36">over time it builds up n as you know</span> <span data-start="748.36" data-end="751.15">we're not kids about 1 to 2 gigabytes of</span> <span data-start="751.15" data-end="752.709">memory starts to really slow down the</span> <span data-start="752.709" data-end="754.33">process to do garbage collection on time</span> <span data-start="754.33" data-end="757.35">so what we did was once no hits around</span> <span data-start="757.35" data-end="760.18">almost manual process one key byte of</span> <span data-start="760.18" data-end="763.12">memory usage we will we will restart yes</span> <span data-start="763.12" data-end="766">that particular worker it wasn't so bad</span> <span data-start="766" data-end="767.56">in a sense that because unique</span> <span data-start="767.56" data-end="769.39">disconnects the user that users they</span> <span data-start="769.39" data-end="771.64">were connected with which is maybe one</span> <span data-start="771.64" data-end="773.2">over eight of our reasons connected to</span> <span data-start="773.2" data-end="775.06">the particular server but you are so it</span> <span data-start="775.06" data-end="780.59">was a good experience for our users so</span> <span data-start="780.6" data-end="785.47">and ok and and we also had some human</span> <span data-start="785.47" data-end="787.089">errors when we were attending the</span> <span data-start="787.089" data-end="789.7">parties rules because we generated em</span> <span data-start="789.7" data-end="792.31">manually and when we wanted to change</span> <span data-start="792.31" data-end="794.23">the number of slots the number of</span> <span data-start="794.23" data-end="798.01">workers for server it and we</span> <span data-start="798.01" data-end="802.23">updated iptables for free it would prick</span> <span data-start="802.23" data-end="807.07">so we decided to write a new likely to</span> <span data-start="807.07" data-end="810.12">help us handily handle all this iptables</span> <span data-start="810.12" data-end="813.37">manipulation and at the same time help</span> <span data-start="813.37" data-end="816.46">us manage worker processors we're</span> <span data-start="816.46" data-end="817.6">starting them when you are using flash</span> <span data-start="817.6" data-end="820.09">memory restarting and when they are when</span> <span data-start="820.09" data-end="822.1">they are running out off when they are</span> <span data-start="822.1" data-end="824.47">taking too long to respond and and so on</span> <span data-start="824.47" data-end="828.67">so these are some of the features that</span> <span data-start="828.67" data-end="831.1">our library has given in right now so</span> <span data-start="831.1" data-end="834.19">it's Monica you use it like the transfer</span> <span data-start="834.19" data-end="837.91">value in nodejs he has place to work</span> <span data-start="837.91" data-end="839.05">every time and so what it means is that</span> <span data-start="839.05" data-end="843.04">when we want Q of a worker we don't we</span> <span data-start="843.04" data-end="844.36">don't ask you it but what we do is that</span> <span data-start="844.36" data-end="846.82">we changed i became a rule respona canal</span> <span data-start="846.82" data-end="848.38">water resolve new work at first and</span> <span data-start="848.38" data-end="849.85">change hi Petey Lorusso right points in</span> <span data-start="849.85" data-end="852.25">the new worker and let over continue to</span> <span data-start="852.25" data-end="856.3">finish servicing the requested that they</span> <span data-start="856.3" data-end="859">are still outstanding so they're also</span> <span data-start="859" data-end="861.01">allows us to do hot curvy road so when</span> <span data-start="861.01" data-end="864.22">we have a new deploy we can just make a</span> <span data-start="864.22" data-end="866.41">whole bunch of new workers and point</span> <span data-start="866.41" data-end="869.02">iptables to use the use the new</span> <span data-start="869.02" data-end="871.78">processors so Batman who refers to the</span> <span data-start="871.78" data-end="875.92">fact that our new processors thus the</span> <span data-start="875.92" data-end="878.53">soccer object ADC is the actual soccer</span> <span data-start="878.53" data-end="881.89">that gets connected of client so things</span> <span data-start="881.89" data-end="883.51">like doing events they work reliably</span> <span data-start="883.51" data-end="885.76">because you don't go to another way of</span> <span data-start="885.76" data-end="888.43">proxy and obviously a client IP address</span> <span data-start="888.43" data-end="891.85">is there early on the socket three menus</span> <span data-start="891.85" data-end="894.78">of this MPI Monica too busy which posed</span> <span data-start="894.78" data-end="899.23">the note event loop and determines and</span> <span data-start="899.23" data-end="900.67">try to determine if it's taking too long</span> <span data-start="900.67" data-end="903.61">to go to the event which which implies</span> <span data-start="903.61" data-end="906.76">that the no processor is a new processes</span> <span data-start="906.76" data-end="908.77">under too much loot and is spending all</span> <span data-start="908.77" data-end="913">this time Henry depends so then how was</span> <span data-start="913" data-end="917.4">that helps us to detect work instead</span> <span data-start="917.4" data-end="921.04">have run into some kind of problem and</span> <span data-start="921.04" data-end="924.37">they are just general servicing requests</span> <span data-start="924.37" data-end="927.92">fast enough</span> <span data-start="927.93" data-end="931.77">so as I said so that sort of master</span> <span data-start="931.77" data-end="933.42">managers or the other different workers</span> <span data-start="933.42" data-end="936.899">and we use unix dominicans to</span> <span data-start="936.899" data-end="938.61">communicate between a master and the</span> <span data-start="938.61" data-end="941.1">workers the workers select the listening</span> <span data-start="941.1" data-end="943.08">pots that be a decent amount owed is</span> <span data-start="943.08" data-end="945.33">what we do is that we get the operating</span> <span data-start="945.33" data-end="946.56">system to do it so you pick a random</span> <span data-start="946.56" data-end="949.32">port and workers report the partner</span> <span data-start="949.32" data-end="951.089">listening to the master and master will</span> <span data-start="951.089" data-end="953.07">set up the IP table should make sure</span> <span data-start="953.07" data-end="956.1">that you points to the right places the</span> </p>
<p><span data-start="956.1" data-end="958.08">Muslims are looking above means of</span> <span data-start="958.08" data-end="960.69">managing other masters so we in just in</span> <span data-start="960.69" data-end="961.83">case there's a button while saying you</span> <span data-start="961.83" data-end="964.589">to Cuba or to run in another master I</span> <span data-start="964.589" data-end="966.66">because that is designed so that if you</span> <span data-start="966.66" data-end="968.64">run another copy of a muscle it will</span> <span data-start="968.64" data-end="971.22">queue of the 01 and manage and tip over</span> <span data-start="971.22" data-end="976.709">a single cuz i manage them properly so</span> <span data-start="976.709" data-end="980.85">we retire workers when so in a capacitor</span> <span data-start="980.85" data-end="985.02">we set a memory limit per worker and so</span> <span data-start="985.02" data-end="987.92">when workers approach the limit we will</span> </p>
<p><span data-start="987.92" data-end="990.63">Chris we will let them kind of shut down</span> <span data-start="990.63" data-end="995.279">gracefully by by redirecting all the new</span> <span data-start="995.279" data-end="998.61">requests to new servers basis of class</span> <span data-start="998.61" data-end="1000.709">also a cluster men really mean for the</span> <span data-start="1000.709" data-end="1004.55">entire cluster so when you approach like</span> <span data-start="1004.55" data-end="1007.22">the limit of the more memories of the</span> <span data-start="1007.22" data-end="1009.62">entire struggle has we will find the</span> <span data-start="1009.62" data-end="1017.15">odors retire worker and cute so we have</span> <span data-start="1017.15" data-end="1020.959">open source IP castles so this is all</span> <span data-start="1020.959" data-end="1024.92">this our project page and now I will run</span> <span data-start="1024.92" data-end="1029.689">us through an example of IP cluster</span> <span data-start="1029.689" data-end="1040.67">usage so this is a typical route I'm</span> <span data-start="1040.67" data-end="1047.39">WebSocket based application we start a</span> <span data-start="1047.39" data-end="1051.62">web socket and on a connection we send a</span> <span data-start="1051.62" data-end="1058.62">current every 100 milliseconds so</span> <span data-start="1058.62" data-end="1087.7">slick</span> <span data-start="1087.71" data-end="1104.31">oops</span> <span data-start="1104.32" data-end="1118.82">give it over the demo happens every time</span> <span data-start="1118.83" data-end="1125.07">get out of the skip the demo and run</span> <span data-start="1125.07" data-end="1128.82">true let me just run to how we how you</span> <span data-start="1128.82" data-end="1133.769">want to use IP cluster and as in how how</span> <span data-start="1133.769" data-end="1137.22">can we use IP castor and not a Fraggle</span> <span data-start="1137.22" data-end="1139.529">as this thing weighs so much so if you</span> <span data-start="1139.529" data-end="1141.96">notice this on right side is the same</span> <span data-start="1141.96" data-end="1147.929">application but below we at IP cluster</span> <span data-start="1147.929" data-end="1150.51">support so it's assume it's as simple as</span> <span data-start="1150.51" data-end="1153.6">um it's actually familiar with if after</span> <span data-start="1153.6" data-end="1156">me with the cluster module in node is</span> <span data-start="1156" data-end="1159">actually similar you require the IP</span> <span data-start="1159" data-end="1164.73">custom module set up the seller some</span> <span data-start="1164.73" data-end="1166.38">settings photo so this is the socket</span> <span data-start="1166.38" data-end="1169.01">that the master and worker processes</span> <span data-start="1169.01" data-end="1171.51">communicate over it will set IP address</span> <span data-start="1171.51" data-end="1173.789">because otherwise we wouldn't know how</span> <span data-start="1173.789" data-end="1175.769">to setup you table fools so you can a</span> <span data-start="1175.769" data-end="1179.61">master you just set up master and sorry</span> <span data-start="1179.61" data-end="1183.809">let me get a worker you just start yours</span> <span data-start="1183.809" data-end="1186.87">your application as phenomenal except</span> <span data-start="1186.87" data-end="1190.169">this time you don't specify a listening</span> <span data-start="1190.169" data-end="1193.649">port we let we let the operating system</span> <span data-start="1193.649" data-end="1198.149">pick apart and then we will put the pot</span> <span data-start="1198.149" data-end="1201.299">to the master and that's it the master</span> <span data-start="1201.299" data-end="1224.2">vendor or a PTO rules so let me</span> <span data-start="1224.21" data-end="1256.06">what</span> <span data-start="1256.07" data-end="1266.54">okay so let me show you all IP tables</span> <span data-start="1266.55" data-end="1271.21">so I just listed all the rules in the ne</span> </p>
<p><span data-start="1271.21" data-end="1275.47">T table for for this machine and you</span> <span data-start="1275.47" data-end="1285.27">know this is nothing here so our now run</span> <span data-start="1285.27" data-end="1292.84">the select application support and we</span> <span data-start="1292.84" data-end="1298.57">see that we have three rules no 10 in</span> <span data-start="1298.57" data-end="1300.97">fall so what happened was that s each</span> <span data-start="1300.97" data-end="1304">worker was fun we reported the pot day</span> <span data-start="1304" data-end="1305.95">listening to to the to the master and</span> <span data-start="1305.95" data-end="1308.44">master set up the IP t was for that for</span> <span data-start="1308.44" data-end="1314.29">that particular slot so it always waits</span> <span data-start="1314.29" data-end="1316.87">until that worker report support before</span> <span data-start="1316.87" data-end="1318.97">creating iptables room so what this</span> <span data-start="1318.97" data-end="1321.13">means is that we will never create a PK</span> <span data-start="1321.13" data-end="1323.05">value before the worker is ready to</span> <span data-start="1323.05" data-end="1329.35">accept connections so let's see whether</span> <span data-start="1329.35" data-end="1338.86">it works this time I'm sorry I think</span> </p>
<p><span data-start="1338.86" data-end="1344.7">I've song ever so short a time but I</span> <span data-start="1344.7" data-end="1356.17">guess from the yeah I guess from I guess</span> <span data-start="1356.17" data-end="1357.4">one crow is pretty straightforward how</span> <span data-start="1357.4" data-end="1364.72">it works yeah so let me go back to the</span> <span data-start="1364.72" data-end="1368.44">future so to help us with our memory</span> <span data-start="1368.44" data-end="1369.91">leak issues in the future we are</span> <span data-start="1369.91" data-end="1372.34">planning to automate automated hippie</span> <span data-start="1372.34" data-end="1375.4">things about so the good thing about</span> <span data-start="1375.4" data-end="1378.25">article says that because we can we know</span> <span data-start="1378.25" data-end="1380.02">when a worker starts we can take a</span> <span data-start="1380.02" data-end="1382.93">snapshot of the hip and when the worker</span> <span data-start="1382.93" data-end="1385.18">is retired we can wait until every</span> <span data-start="1385.18" data-end="1387.49">single ass connection has has been</span> <span data-start="1387.49" data-end="1389.44">disconnected before we take another hip</span> <span data-start="1389.44" data-end="1391.54">and if the different so in this way we</span> <span data-start="1391.54" data-end="1396.7">can find memory leaks there's also it's</span> <span data-start="1396.7" data-end="1399.13">been hard to see the health of the</span> <span data-start="1399.13" data-end="1399.7">cluster</span> <span data-start="1399.7" data-end="1402.61">is fine time so some kind of dash</span> <span data-start="1402.61" data-end="1404.08">thought would be nice to be able to see</span> <span data-start="1404.08" data-end="1408.96">what the cluster is currently doing so</span> <span data-start="1408.96" data-end="1412.539">um is a shout out to my team and team</span> <span data-start="1412.539" data-end="1415.539">who is one of our developers and has</span> <span data-start="1415.539" data-end="1420.01">worked a lot on up your cluster yeah</span> <span data-start="1420.01" data-end="1434.139">that's all so I could we have let's say</span> <span data-start="1434.139" data-end="1445.58">one question maybe for young bin yes</span> <span data-start="1445.59" data-end="1448.659">hello I'm just wondering it you have</span> <span data-start="1448.659" data-end="1450.82">have you ever tried to use unless site</span> <span data-start="1450.82" data-end="1453.88">youíre DS RSS install so that you can</span> <span data-start="1453.88" data-end="1455.95">sync synchronize a session between</span> <span data-start="1455.95" data-end="1457.899">multiple clients so I mean you don't</span> <span data-start="1457.899" data-end="1461.98">really needs a sticky station ask foster</span> </p>
<p><span data-start="1461.98" data-end="1464.919">I mean for all the note and also have</span> <span data-start="1464.919" data-end="1467.649">you tried to use a something new</span> <span data-start="1467.649" data-end="1470.08">protocol which is a proxy for taco which</span> <span data-start="1470.08" data-end="1473.34">is allow you to load balance between</span> <span data-start="1473.34" data-end="1478.84">multiply and even GPU TCP so let me let</span> <span data-start="1478.84" data-end="1479.86">me see all your questions right the</span> <span data-start="1479.86" data-end="1483.299">first version so why not why not use a</span> <span data-start="1483.299" data-end="1486.97">very special session store yeah and we</span> <span data-start="1486.97" data-end="1489.13">are why you need so you can match the</span> <span data-start="1489.13" data-end="1491.289">income connection with the provides</span> <span data-start="1491.289" data-end="1493.539">instant connection yeah so this meet you</span> <span data-start="1493.539" data-end="1495.37">don't even eat the sticky six and as the</span> <span data-start="1495.37" data-end="1497.59">first place so sort of thing is we</span> <span data-start="1497.59" data-end="1499.98">actually a really kind of hyper session</span> <span data-start="1499.98" data-end="1501.88">management system which is our back-end</span> <span data-start="1501.88" data-end="1506.71">services so essentially for the all</span> <span data-start="1506.71" data-end="1508.48">mediators we could reconnect with</span> <span data-start="1508.48" data-end="1510.84">another mediator end we can still</span> <span data-start="1510.84" data-end="1513.07">répondre back to the same session but a</span> <span data-start="1513.07" data-end="1516.46">problem is that there is a lot of state</span> <span data-start="1516.46" data-end="1519.34">in our front-end service because we are</span> <span data-start="1519.34" data-end="1522.399">we are normalizing the data structure</span> <span data-start="1522.399" data-end="1526.149">into a into a global streaming standard</span> <span data-start="1526.149" data-end="1528.429">for our financial service so let's not</span> <span data-start="1528.429" data-end="1531.309">stay involved and while we can you can</span> <span data-start="1531.309" data-end="1532.8">reconnect or difference over it takes</span> <span data-start="1532.8" data-end="1535.17">a couple seconds to get all that state</span> <span data-start="1535.17" data-end="1539.16">or set up again so we this I mean that's</span> <span data-start="1539.16" data-end="1542.94">why we have we try not to have to prove</span> </p>
</section>