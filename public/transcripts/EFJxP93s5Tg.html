<section>
<p><span data-start="0.11" data-end="1.97">Just go for it: The story of dance mat.js</span> <span data-start="1.97" data-end="3.84">Ramon Huidobro PARISS: Who likes tacos? Raise your hand.</span> <span data-start="3.84" data-end="4.84">I literally asked that to see who was paying attention. Cool. All right. Okay. But who</span> <span data-start="4.84" data-end="5.84">here has personal projects? Really? Has ever worked on a personal project? Okay. That's</span> <span data-start="5.84" data-end="6.84">better. Cool. All right. So, our next speaker will be talking about personal projects and</span> <span data-start="6.84" data-end="7.84">maintaining them and letting you know that you can do it. You're gonna get stuck but</span> <span data-start="7.84" data-end="8.84">keep going. Can we give a warm welcome to Ramon Huidobro?</span> <span data-start="8.84" data-end="9.84">[ Applause ] I said it better backstage, but I got nervous.</span> </p>
</section>

<section>
<p><span data-start="9.84" data-end="14.841"><span class="speaker">Ramon</span>: Hi, everyone, thank you so much for that lovely introduction, and thank you all</span> <span data-start="14.841" data-end="18.07">for being here today. Before my slides appear, I want to say thank you for being here, JSConf,</span> <span data-start="18.07" data-end="23.73">thank you for having me. This is my first time ever as a JSConf anywhere in the world.</span> <span data-start="23.73" data-end="24.73">[ Applause ] This is\h thank you. This is mine. So, I'm</span> <span data-start="24.73" data-end="29.2">just gonna nab it. And\h I really like it. All righty. Okay. We're good to go. Hi, everyone,</span> <span data-start="29.2" data-end="32.82">before we start off, there's a link at the bottom, also in my Twitter, SenorHuidobro,</span> <span data-start="32.82" data-end="35.16">if you want to follow along for convenience sake. My name is Ramon. I am a freelance software</span> </p>
<p><span data-start="35.16" data-end="37.69">Dev and teach kids on the side, I live in Vienna, Austria. And you might think, what's</span> <span data-start="37.69" data-end="42.16">with the picture of the dog, can we see more of the dog, please? Don't worry, I've got</span> <span data-start="42.16" data-end="50.54">you covered. This is Fiona. This is Fiona, we adopted her about three years ago. And</span> <span data-start="50.54" data-end="56.899">I love her so much because her\h especially because of her eyes. She has these Simpsons</span> <span data-start="56.899" data-end="62.68">eyes that look in different directions\hand she says so much with these eyes. My favorite</span> <span data-start="62.68" data-end="72.6">is this top right photo where she's judging my wife while she eats mango. So, in Chile</span> </p>
<p><span data-start="72.6" data-end="79.13">Spanish, we have a word to describe Fiona which is regalona. I haven't been able to</span> <span data-start="79.13" data-end="85.92">find a suitable translation. Tried, put it in, I put in regalona, got it back. I tried</span> <span data-start="85.92" data-end="94.81">it in German. And in Austria, we speak German. There's a bajillion words, but German being</span> <span data-start="94.81" data-end="101.729">German, it capitalized it. [ Laughter ]</span> <span data-start="101.729" data-end="107.85">It in short regalona means spoiled, but you spoil them on purpose and they love you. It's</span> <span data-start="107.85" data-end="114.78">a whole thing. Anyway, let's talk about rhythm video games. In particular, dancing video</span> <span data-start="114.78" data-end="122.2">games. Any of you play Just Dance? Can't quite see. I'm gonna say from that one yes that</span> <span data-start="122.2" data-end="128.92">all of you do. I haven't myself. But what you do is you dance to the rhythm. You do</span> <span data-start="128.92" data-end="134.22">the little poses and you gets points as you go. So, this is fairly popular. They're still</span> <span data-start="134.22" data-end="139.95">making them to this day. But when I was a kid, about 20 years ago, there was this other</span> <span data-start="139.95" data-end="145.89">game called Dance Dance Revolution. Or DDR. [ Applause ]</span> </p>
<p><span data-start="145.89" data-end="151.78">Nice to see\h nice to hear there's a few fans in here. If you're not familiar with DDR as</span> <span data-start="151.78" data-end="159.69">I'm going to refer to it from now on, as you can see in this very well done GIF is that</span> <span data-start="159.69" data-end="164.23">this person's pressing the buttons to the rhythm of the music. Now, on screen what you</span> <span data-start="164.23" data-end="170.709">see is little arrows that come up as the song goes on to tell you when to step on the buttons,</span> <span data-start="170.709" data-end="177.06">right? And it's a lot of fun. You can see it's a bit older. So, this is from PlayStation,</span> <span data-start="177.06" data-end="186.64">I think. It's fairly old. But it's a lot of fun. And the music. How do I put this? I'm</span> <span data-start="186.64" data-end="204.709">gonna show you. Let me just load it up here. [Rockinâ€™ techno music beat thing]</span> </p>
<p><span data-start="204.709" data-end="209.38">It's something else. By the way, whoever is in charge of the playlist of music today,</span> <span data-start="209.38" data-end="218.26">whoo, you're really nailing it. So, I used to play this a lot when I was a kid. But a</span> <span data-start="218.26" data-end="222.08">few years ago I introduced this game to my wife who had never played it before. We were</span> <span data-start="222.08" data-end="230.739">looking for ways to play it. And we actually found an open source alternative called Step</span> <span data-start="230.739" data-end="238.08">Mania. Anybody heard of Step Mania? I see a couple hands. Cool. So, Step Mania lets</span> <span data-start="238.08" data-end="243.03">you load in your own songs and customize it to your own liking. And like I said, it's</span> <span data-start="243.03" data-end="247.86">fully open source. Like I said, we had the software, we had the music. What about the</span> <span data-start="247.86" data-end="253.89">controller, you might be wondering? So, in the arcade, the controllers for Dance Dance</span> </p>
<p><span data-start="253.89" data-end="259.78">Revolution were these big metallic ones. But at home, what you had, especially during the</span> <span data-start="259.78" data-end="268.669">heyday of DDR were these foam mats. They looked like this. And they're great. They were affordable,</span> <span data-start="268.669" data-end="275.689">they were about 30 Euros. So, $30, approximately. And they were a lot of fun. But the problem</span> <span data-start="275.689" data-end="281.581">is that if you use them as much as we did, they kind of wore out after a while. And so,</span> <span data-start="281.581" data-end="286.74">you started getting used to seeing this screen a lot. So, you couldn't really press the buttons</span> <span data-start="286.74" data-end="292.02">anymore. So, we looked into metal alternatives. And they do exist. You can buy them. But I</span> <span data-start="292.02" data-end="296.49">don't know if you saw the price, but it's like for two of them, that's $300. And that's</span> <span data-start="296.49" data-end="304.419">discounted from $900. This is a lot of bones for, you know, wanting to play some DDR. So,</span> <span data-start="304.419" data-end="309.04">we didn't really look into it. But then a few years later my wife and I were at this</span> <span data-start="309.04" data-end="314.729">thing called Maker Faire. Do they have that here? Cool. We were at the Maker Faire in</span> </p>
<p><span data-start="314.729" data-end="326.569">Vienna and I was introduced into bear conductor paint. Anybody familiar with this? And I learned</span> <span data-start="326.569" data-end="331.889">about bare conductive paint on the random Facebook videos you scroll through is you</span> <span data-start="331.889" data-end="338.939">can draw circuits using paint. They had a demo where you can draw lines from a battery</span> <span data-start="338.939" data-end="343.389">to a lightbulb and created a circuit and it worked which was pretty cool. But what you</span> <span data-start="343.389" data-end="355.27">can see is it's also capacitive and can send a receptor. In this case, going to a Raspberry</span> <span data-start="355.27" data-end="362.47">Pi. And you could play a piano using a Raspberry Pi and some paint. Which I thought was cool</span> <span data-start="362.47" data-end="371.27">and then I thought, hmm m. I could do something with this. And I saw there was a Node.js interface</span> <span data-start="371.27" data-end="376.31">that you could install on the Raspberry Pi that even had a nice code example. That was</span> <span data-start="376.31" data-end="386.43">very handy. And then I thought hmm m.. I could definitely make something with this.</span> </p>
<p><span data-start="386.43" data-end="389.83">And\h [ Laughter ]</span> <span data-start="389.83" data-end="398.8">Then I went back to Step Mania and I saw I could customize the controls. What if I took</span> <span data-start="398.8" data-end="413.819">a Raspberry Pi, a yoga mat, a some Node.js? Lo and behold, project dance mat was born.</span> <span data-start="413.819" data-end="417.409">Something to bear in mind, though, this is the first time I had ever worked with anything</span> <span data-start="417.409" data-end="425.43">hardware related. So, needless to say, I was a little intimidated. So, I sat down with</span> <span data-start="425.43" data-end="432.869">my wife, how are we going to make this? Very simple, a dance mat, connect to a computer.</span> <span data-start="432.869" data-end="439.499">The computer thinks, ah ha, this is a keyboard. And handle the button presses as if they were</span> <span data-start="439.499" data-end="447.789">keyboard strokes. Fantastic. So, I had my little bit of setting up here. They have this</span> <span data-start="447.789" data-end="452.21">NPM package that I could install, set the thresholds for touching and releasing. That</span> <span data-start="452.21" data-end="458.179">is how sensitive. Because when something is capacitive, it question detects when your</span> <span data-start="458.179" data-end="466.11">finger is approaching the paint. You want to mess around with the sensitivity. Great.</span> <span data-start="466.11" data-end="472.669">We had everything set up except for the big comment that says send data to PC. Which\h</span> <span data-start="472.669" data-end="478.699">again, I like to jump into projects without doing much research. So, I learned that Raspberry</span> <span data-start="478.699" data-end="483.24">Pis, when you plug them into a computer, the computer doesn't automatically go, oh, that</span> <span data-start="483.24" data-end="489.019">is USB device. I can take it from here. You might be thinking, Ramon.</span> <span data-start="489.019" data-end="494.58">[ Laughter ] Did you not research this? And let me remind</span> <span data-start="494.58" data-end="500.569">you, this is my first time doing a project like this. But okay. I did some searching</span> <span data-start="500.569" data-end="505.409">around, I talked to some friends and I discovered that you can configure what's called a gadget.</span> </p>
<p><span data-start="505.409" data-end="510.649">See, a Raspberry Pi, the most common software used on it is Linux. So, I could configure</span> <span data-start="510.649" data-end="519.36">this Linux kernel to have a little\h to\h when you connect to a PC tell it, ha ha, I'm</span> <span data-start="519.36" data-end="525.77">a USB keyboard device. And I found a blog post that let me do all the copy pasting which</span> <span data-start="525.77" data-end="530.13">is fantastic. I took the copy pasting part\h I took the most important part which is, of</span> <span data-start="530.13" data-end="541.45">course, the serial number, the manufacturer and product. Don't worry about what this does.</span> <span data-start="541.45" data-end="547.269">What it does in sort is basically set it up so this is a script that when run will set</span> <span data-start="547.269" data-end="553.839">itself up as a recognizable USB device for the computer to interact with. So, then, okay,</span> <span data-start="553.839" data-end="559.4">that's one part done. Then I need to actually send data through that USB interface. So,</span> <span data-start="559.4" data-end="565.3">I went on the USB human interface devices documentation and I downloaded what I found</span> <span data-start="565.3" data-end="576.75">out was a 96 page PDF. And I made the sound that a basset hound makes when it barks. Woof\h</span> <span data-start="576.75" data-end="582.699">but I stuck with it. And I found out that, in short, when you go to interact with this</span> <span data-start="582.699" data-end="593.21">USB interface, I need to send a byte array of 8 hexadecimal, that's a code. And I need</span> <span data-start="593.21" data-end="602.25">to send these. I searched and found a nice GitHub listing of all of the keys. Very cool.</span> </p>
<p><span data-start="602.25" data-end="609.089">I defined my little constants for left, right, up and down. And I set these up so that when</span> <span data-start="609.089" data-end="616.3">they're pressed by me, the Raspberry Pi would tell the computer A, B, C and D. This was</span> <span data-start="616.3" data-end="624.32">so exciting. Just to write this code. So, that got me started. So I defined these constants</span> <span data-start="624.32" data-end="630.019">and I told myself, all right, now we'll process the actual touches. First I'll get the keys</span> <span data-start="630.019" data-end="639.189">that are sent from the cap connected to the Raspberry Pi to\h to this function which is</span> <span data-start="639.189" data-end="647.92">an array of electrodes that are pressed. So, what I would do is have\h would parse those</span> <span data-start="647.92" data-end="654.72">pressed keys from the data and then take those and make an array of eight keys. You might</span> <span data-start="654.72" data-end="659.47">be wondering, what if you're just pressing one? You have one pressed key and eight blank</span> <span data-start="659.47" data-end="669.11">ones. Okay. So, to pass\h to parse those keys, all I needed to do was loop through each of</span> <span data-start="669.11" data-end="674.519">the electrodes that are pressed and, depending on which index it has, because you probably</span> <span data-start="674.519" data-end="681.439">saw in the picture, I should have one here. You probably saw that it had 12 or so electrodes</span> <span data-start="681.439" data-end="686.62">that you could touch. So, from left to right I just assigned them accordingly and then</span> <span data-start="686.62" data-end="692.819">I was all set. I could return my pressed keys. Next up, to actually turn that into an array</span> <span data-start="692.819" data-end="700.939">of keys and turn that into a key stroke, I would just force it to be 8 in any case and</span> <span data-start="700.939" data-end="710.5">fill the rest with blank ones. Please stop me if I'm going too fast. So, with that, with</span> <span data-start="710.5" data-end="714.93">this program running, I could have it always detect which ones are pressed and it would</span> <span data-start="714.93" data-end="720.66">just log out the key stroke as it would be. And, of course, if there's more than one pressed,</span> <span data-start="720.66" data-end="724.449">then it would take both into account. Because in DDR, I don't know if you know, there are</span> <span data-start="724.449" data-end="730.279">times when you have to press two like this, like that. I'm not going to go much more on</span> <span data-start="730.279" data-end="736.999">that. So, now we'll actually send\h now we'll actually take the byte array out of that.</span> </p>
<p><span data-start="736.999" data-end="744.36">Turns out there's a JavaScript function for getting 8 bit unsigned integers. So, you could</span> <span data-start="744.36" data-end="752.67">just call Uint8array from key stroke. All set and nice. And now to send this key stroke</span> <span data-start="752.67" data-end="762.18">to the actual USB interface. Um. I hadn't done this before. So, I did some research</span> <span data-start="762.18" data-end="768.389">and I found out that the actual interface in Linux is interacted by something called</span> <span data-start="768.389" data-end="776.5">a file descriptor. So, what a file descriptor is, just gonna take my cursor out of there.</span> <span data-start="776.5" data-end="782.509">Somebody should have said something\h what a file descriptor is any communication Linux</span> <span data-start="782.509" data-end="789.81">does through other devices with any input/output devices is through files. So, a USB device,</span> <span data-start="789.81" data-end="795.589">a computer, a node on a network, or even a Word document, those are all files to Linux</span> <span data-start="795.589" data-end="802.24">so you can send and get data from them. So, I thought, I wonder if there's anything on</span> <span data-start="802.24" data-end="809.939">npm that does this. Lo and behold, there is. I found this Linux device package which let</span> <span data-start="809.939" data-end="818.699">me just open up that USB interface and all I had to do was call device right buffer and</span> </p>
<p><span data-start="818.699" data-end="824.449">I was good to go. Now, you might be wondering, did it work. And I said, well, before we get</span> <span data-start="824.449" data-end="829.99">there, we have to be responsible. When the program ends, I need to close that device.</span> <span data-start="829.99" data-end="840.399">Did it work? Well, let's find out. So, I ran node dance mat.js. I plugged the Raspberry</span> <span data-start="840.399" data-end="847.14">Pi into my laptop. I opened up a text editor, best type of test there is, and look at that.</span> <span data-start="847.14" data-end="853.329">I'm sending A, B and C. I've never been so excited to see these letters.</span> <span data-start="853.329" data-end="858.5">[ Applause ] Now, you might be wondering, Ramon, why did</span> <span data-start="858.5" data-end="864.819">you show us every sordid detail that have? I wanted to show my excitement. I didn't have</span> <span data-start="864.819" data-end="875.579">any experience doing this. I persevered. My wife was very patient with me. And then it</span> <span data-start="875.579" data-end="883.16">worked. And then came the fun part. We could actually start painting. And so, this is a</span> <span data-start="883.16" data-end="890.089">picture from home. We took the paint. We bought a yoga mat at the corner store. We even made</span> <span data-start="890.089" data-end="899.209">it two player compatible. And after a while we cut them up because we found out that dancing</span> <span data-start="899.209" data-end="909.439">so close to each other can cause a few problems. And did it work? Yes. Did we start passing</span> <span data-start="909.439" data-end="917.579">songs with super scores? Eh. You know, we got Ds. But it had been a while since we played.</span> </p>
<p><span data-start="917.579" data-end="922.959">So, then the question was, are we set for life now? And really it depends on how you</span> <span data-start="922.959" data-end="929.97">look at it. So, here's something I learned: Putting paint on a yoga mat and expecting</span> <span data-start="929.97" data-end="937.91">that to stay forever\h eh. So, then, you know, we had to reapply some coats of point. We</span> <span data-start="937.91" data-end="942.23">have to modify some things here and there. And we started gathering a what we call a</span> <span data-start="942.23" data-end="954.54">if I could do this over again. Ramon, why didn't you use an Arduino? What is an Arduino?</span> <span data-start="954.54" data-end="958.8">We found out, yes, it's nice to be able to roll up the yoga mat. But maybe a more flat</span> <span data-start="958.8" data-end="963.92">surface would be good for the paint. And we started\h and, you know, we also thought about</span> <span data-start="963.92" data-end="971.579">maybe for latency to have physical cables instead of paint. And we started doing some</span> <span data-start="971.579" data-end="976.42">mods like that. I don't myself, but my wife knows how to do it, soldering, and she does</span> <span data-start="976.42" data-end="983.889">it well. You might be thinking, do you think you did it? Yes, of course. Because the important</span> <span data-start="983.889" data-end="989.439">thing is, we learned a lot and we are delighted about it. This picture is from three days</span> <span data-start="989.439" data-end="992.11">ago. [ Applause ]</span> </p>
<p><span data-start="992.11" data-end="1000.23">So, I've got a few takeaways for you. I mean, like, you know, if you're not experienced</span> <span data-start="1000.23" data-end="1004.232">in messing around with hardware, it can look super daunting and you might want to have</span> <span data-start="1004.232" data-end="1010.759">a\h what is it called? A fire extinguisher close by. But the importance of playing around</span> <span data-start="1010.759" data-end="1015.79">with stuff is so vital. And it's so much fun. And you learn so much. And here's the important</span> <span data-start="1015.79" data-end="1019.24">part. If you have an idea, just go for it. You never know if it's gonna work. Thanks,</span> <span data-start="1019.24" data-end="1020.24">folks. [ Applause ]</span> <span data-start="1020.24" data-end="1021.24">[ Laughter ]</span> <span data-start="1021.24" data-end="1022.24">[ Applause ] PARISS: All right. So, we're wrapping up.</span> </p>
<p><span data-start="1022.24" data-end="1023.24">We're near the end. Our last talk will be coming on soon. You know what's funny? Every</span> <span data-start="1023.24" data-end="1024.24">time our speaker would come backstage, I would ask them, like, how do you feel? Are you ready?</span> <span data-start="1024.24" data-end="1025.24">I'm really nervous. And I'm like, me too. Like, I'm nervous. And then they get on here</span> <span data-start="1025.24" data-end="1026.24">and they're freaking BeyoncÃ©. They're just so confident. I'm like, you liar. But honestly</span> <span data-start="1026.24" data-end="1027.24">the speakers have been amazing. Give them a round of applause.</span> <span data-start="1027.24" data-end="1028.24">[ Applause ] And we have one last talk. That will be happening</span> </p>
</section>