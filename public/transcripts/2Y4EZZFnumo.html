<section>
<p><span data-start="9.44" data-end="12.54">I'm Curtis with uber I'm the engineering</span> <span data-start="12.54" data-end="15.78">manager uber this is being over with</span> <span data-start="15.78" data-end="18.81">note do you anybody here know what Ober</span> <span data-start="18.81" data-end="20.76">is or has used it before yeah we got a</span> <span data-start="20.76" data-end="21.84">big fan right there</span> <span data-start="21.84" data-end="24.21">a couple here for everybody else we'll</span> <span data-start="24.21" data-end="29.789">talk about my thing works Oh what is</span> <span data-start="29.789" data-end="31.769">uber just so everybody knows what we're</span> <span data-start="31.769" data-end="34.23">talking about this but basically it's an</span> <span data-start="34.23" data-end="36.12">iPhone app and Android app you can also</span> <span data-start="36.12" data-end="38.16">do it with SMS but basically you press</span> <span data-start="38.16" data-end="39.93">single button that green button there</span> <span data-start="39.93" data-end="42.27">and magically a car shows up a black</span> <span data-start="42.27" data-end="43.86">town car it's fancy it takes you where</span> <span data-start="43.86" data-end="46.41">you want to go and it's automatically</span> <span data-start="46.41" data-end="48.39">billed to your credit card no tipping no</span> <span data-start="48.39" data-end="51.44">cash it's just like magical service and</span> <span data-start="51.44" data-end="53.699">people that use it love it they go nuts</span> <span data-start="53.699" data-end="61.649">over it and anyway where you can use it</span> <span data-start="61.649" data-end="63.39">right now we're in San Francisco we've</span> <span data-start="63.39" data-end="65.36">been in San Francisco for almost a year</span> <span data-start="65.36" data-end="68.58">and as of two days ago we launched in</span> </p>
<p><span data-start="68.58" data-end="70.59">New York as well so we're pretty excited</span> <span data-start="70.59" data-end="72.03">about that it was kind of stressful</span> <span data-start="72.03" data-end="73.26">doing that while trying to prepare this</span> <span data-start="73.26" data-end="79.02">talk so and actually we're about to</span> <span data-start="79.02" data-end="81.27">expand as TechCrunch to said Seattle</span> <span data-start="81.27" data-end="84.36">Chicago Boston and DC so if you know</span> <span data-start="84.36" data-end="86.52">anybody there that needs a job or if you</span> <span data-start="86.52" data-end="88.049">live in any of those cities we're coming</span> <span data-start="88.049" data-end="92.009">here soon try it out so yeah anyway the</span> <span data-start="92.009" data-end="93.72">the real goal of this talk is to talk</span> <span data-start="93.72" data-end="97.909">about how we went from an old terrible</span> <span data-start="97.909" data-end="101.579">lamp based system to a node-based system</span> <span data-start="101.579" data-end="103.53">and it was kind of a huge pain to do and</span> <span data-start="103.53" data-end="107.85">it's still concurrently huge pain but to</span> <span data-start="107.85" data-end="109.049">go into that I want to talk a little bit</span> <span data-start="109.049" data-end="110.97">about the story of node and how it came</span> <span data-start="110.97" data-end="111.299">about</span> <span data-start="111.299" data-end="113.579">so our co-founders Travis and Garrett</span> <span data-start="113.579" data-end="114.63">we're basically sitting around and</span> <span data-start="114.63" data-end="116.159">they're like you know it would be really</span> <span data-start="116.159" data-end="117.63">awesome if I could get a car on Friday</span> <span data-start="117.63" data-end="118.979">night because the cab situation in San</span> </p>
<p><span data-start="118.979" data-end="120.869">Francisco so terrible I just want to</span> <span data-start="120.869" data-end="122.31">push a button on my phone and have a car</span> <span data-start="122.31" data-end="124.2">show a private driver maybe we could</span> <span data-start="124.2" data-end="125.43">share this driver with a bunch of our</span> <span data-start="125.43" data-end="128.7">friends and so basically they sort of</span> <span data-start="128.7" data-end="130.289">had this proof-of-concept built out that</span> <span data-start="130.289" data-end="131.73">was just like can we make it so you can</span> <span data-start="131.73" data-end="133.74">push a button and a driver shows up</span> <span data-start="133.74" data-end="135.69">and so it was like built on a lamp stack</span> <span data-start="135.69" data-end="138.3">a very basic proof-of-concept not you</span> <span data-start="138.3" data-end="140.82">know it scalable anything like that it</span> <span data-start="140.82" data-end="142.71">basically kind of looked like this it's</span> <span data-start="142.71" data-end="144.8">like the phone just talks to PHP and</span> <span data-start="144.8" data-end="146.94">mice equal stores all the data about the</span> <span data-start="146.94" data-end="148.49">drivers where they are all this and that</span> <span data-start="148.49" data-end="150.81">this architecture is cool when it's just</span> <span data-start="150.81" data-end="153">you and a driver or maybe a couple of</span> <span data-start="153" data-end="154.5">your friends and a driver but suddenly</span> <span data-start="154.5" data-end="157.2">you have you know we decided to release</span> <span data-start="157.2" data-end="159.39">it to the world you know anybody can get</span> <span data-start="159.39" data-end="160.98">their own private driver with with uber</span> <span data-start="160.98" data-end="163.08">and so when then you have a ton of</span> <span data-start="163.08" data-end="165.75">phones and PHP like there's a ton of</span> </p>
<p><span data-start="165.75" data-end="167.7">Apache processes going on which can</span> <span data-start="167.7" data-end="171.36">cause some issues when you have let's</span> <span data-start="171.36" data-end="173.04">say a hundred drivers on the system and</span> <span data-start="173.04" data-end="176.31">thousands of clients you know one driver</span> <span data-start="176.31" data-end="179.19">is dispatched to two clients two clients</span> <span data-start="179.19" data-end="182.37">think they have the same driver all</span> <span data-start="182.37" data-end="184.98">right that's the same thing but there's</span> <span data-start="184.98" data-end="186.54">a lot of like concurrency problems a lot</span> <span data-start="186.54" data-end="188.31">of race conditions you need as a</span> <span data-start="188.31" data-end="190.65">dispatch system you need one solid</span> <span data-start="190.65" data-end="192.21">process that knows about all the drivers</span> <span data-start="192.21" data-end="193.74">all the clients can connect them</span> <span data-start="193.74" data-end="195.99">properly so this architecture doesn't</span> <span data-start="195.99" data-end="200.61">really work very well so in order to you</span> <span data-start="200.61" data-end="202.29">know move from this to something that</span> <span data-start="202.29" data-end="204">that made more sense like we started</span> <span data-start="204" data-end="205.5">evaluating solutions what's out there</span> <span data-start="205.5" data-end="207.48">how can we build a dispatch system that</span> <span data-start="207.48" data-end="208.86">doesn't have these issues and isn't sort</span> <span data-start="208.86" data-end="212.16">of kind of hacked together and we</span> <span data-start="212.16" data-end="213.66">thought node would be perfect for this</span> <span data-start="213.66" data-end="216.15">single threaded you know it has all the</span> <span data-start="216.15" data-end="217.5">objects in memory it knows where all the</span> <span data-start="217.5" data-end="218.88">drivers are all the clients are there's</span> <span data-start="218.88" data-end="220.41">none of these double dispatch issues it</span> <span data-start="220.41" data-end="224.39">connects one driver at a time so a</span> <span data-start="224.39" data-end="226.47">problem is this is live and we already</span> <span data-start="226.47" data-end="229.29">had like tons of people using it so we</span> <span data-start="229.29" data-end="230.73">can't just turn the system off build a</span> <span data-start="230.73" data-end="232.89">node one and then turn it back on again</span> <span data-start="232.89" data-end="234.75">this thing's going 24 hours a day</span> <span data-start="234.75" data-end="236.19">there's cars going 24 hours a day</span> <span data-start="236.19" data-end="237.3">there's people wanting rides all the</span> <span data-start="237.3" data-end="241.23">time 5 a.m. 3 a.m. whatever so we went</span> <span data-start="241.23" data-end="243.21">component by component to try and fix it</span> <span data-start="243.21" data-end="247.13">so basically the first thing was</span> <span data-start="247.13" data-end="249.48">dispatch that this PHP was doing a lot</span> <span data-start="249.48" data-end="251.07">of stuff that wasn't dispatch related</span> <span data-start="251.07" data-end="253.29">you know like at the end of trips it</span> <span data-start="253.29" data-end="255.33">calculates affaire it does various</span> <span data-start="255.33" data-end="257.7">things and looking them up so first we</span> <span data-start="257.7" data-end="258.959">abstract it out all the non-essential</span> <span data-start="258.959" data-end="261.9">dispatch functions to a Python API and</span> <span data-start="261.9" data-end="264.71">so basically now</span> <span data-start="264.71" data-end="266.72">dispatch was very simple very basic</span> <span data-start="266.72" data-end="268.61">connects clients and drivers still had</span> <span data-start="268.61" data-end="270.169">issues but we patched the issues so it</span> <span data-start="270.169" data-end="271.639">was kind of this ghetto-fabulous</span> <span data-start="271.639" data-end="274.19">solution of like it'll double dispatch</span> <span data-start="274.19" data-end="275.69">but then reverse it on one of them and</span> <span data-start="275.69" data-end="277.43">then it'll come back and it it's a</span> <span data-start="277.43" data-end="279.11">nightmare</span> <span data-start="279.11" data-end="281.27">so then we you said oK we've got that</span> <span data-start="281.27" data-end="283.759">out of there maybe now we can slide note</span> <span data-start="283.759" data-end="285.199">in and actually I don't have a slide for</span> <span data-start="285.199" data-end="287.419">this but we slid a little node what we</span> <span data-start="287.419" data-end="288.83">call connection notes in between the</span> <span data-start="288.83" data-end="291.139">phones and the PHP layer to basically</span> <span data-start="291.139" data-end="295.55">kind of it manages all the connections</span> <span data-start="295.55" data-end="296.9">with the persistent connections with the</span> <span data-start="296.9" data-end="298.97">phones and then tells PHP dispatch like</span> <span data-start="298.97" data-end="301.25">what to do what to do in that regard and</span> <span data-start="301.25" data-end="304.61">so then it allowed us to also like put a</span> <span data-start="304.61" data-end="307.43">new dispatch in the backend and have our</span> <span data-start="307.43" data-end="308.99">connection node setting it to both new</span> <span data-start="308.99" data-end="311.66">and old dispatch which then allows us to</span> <span data-start="311.66" data-end="313.849">test the system live we have two</span> <span data-start="313.849" data-end="315.349">dispatchers running one of which is real</span> <span data-start="315.349" data-end="317.389">one of which is a test one make sure the</span> <span data-start="317.389" data-end="319.55">same things happen and so then now you</span> <span data-start="319.55" data-end="321.77">can have like node here now this box is</span> <span data-start="321.77" data-end="324.02">somewhat misleading there's actually a</span> <span data-start="324.02" data-end="325.43">lot of different components here there's</span> <span data-start="325.43" data-end="326.87">the connection node that I was talking</span> <span data-start="326.87" data-end="328.729">about all the phones talk to that you</span> <span data-start="328.729" data-end="329.63">know there's a ton of different</span> <span data-start="329.63" data-end="332.18">instances of it it does request</span> <span data-start="332.18" data-end="333.59">management and make sure that once the</span> <span data-start="333.59" data-end="335.21">phone sends a request it eventually gets</span> <span data-start="335.21" data-end="337.099">to dispatch or gets to the API or gets</span> <span data-start="337.099" data-end="338.99">wherever it needs to go has built-in</span> <span data-start="338.99" data-end="341.3">retrying things like that there's the</span> <span data-start="341.3" data-end="343.19">dispatch server which is a node which</span> <span data-start="343.19" data-end="345.979">maintains in memory all the drivers all</span> <span data-start="345.979" data-end="347.979">the clients everything that's going on</span> <span data-start="347.979" data-end="350.75">so there's actually a few different</span> <span data-start="350.75" data-end="354.59">tiers inside of that node but the</span> <span data-start="354.59" data-end="357.8">problem is we needed like this is sort</span> <span data-start="357.8" data-end="362.24">of a master slave system here like on</span> <span data-start="362.24" data-end="363.74">the dispatch side because we can't have</span> <span data-start="363.74" data-end="366.909">like five different dispatches all</span> <span data-start="366.909" data-end="369.5">serving up drivers you know it's we need</span> <span data-start="369.5" data-end="371.21">the single threaded nosov node but still</span> <span data-start="371.21" data-end="374.18">need high availability so actually each</span> <span data-start="374.18" data-end="376.07">of the the dispatches see realises its</span> <span data-start="376.07" data-end="378.05">state or I guess there's another slide</span> <span data-start="378.05" data-end="380.12">here which basically separated this into</span> <span data-start="380.12" data-end="382.009">like a real-time system and a historical</span> <span data-start="382.009" data-end="382.909">system this is everything that's</span> <span data-start="382.909" data-end="385.759">happened in the past versus node is</span> <span data-start="385.759" data-end="386.84">everything that's happening right now</span> <span data-start="386.84" data-end="389.93">where everything is at the moment so</span> <span data-start="389.93" data-end="391.82">anyway we serialized things out to Mongo</span> <span data-start="391.82" data-end="394.19">so that basically should one of the</span> <span data-start="394.19" data-end="396.2">dispatch servers fail it can pull the</span> <span data-start="396.2" data-end="397.59">current state of the</span> <span data-start="397.59" data-end="399.27">of the master dispatch server back into</span> <span data-start="399.27" data-end="400.59">one of the slaves in it then takes over</span> <span data-start="400.59" data-end="403.74">as the master so anyway in order to</span> <span data-start="403.74" data-end="406.95">accomplish this what we call no requests</span> <span data-start="406.95" data-end="409.05">left behind we built a few components</span> <span data-start="409.05" data-end="411.78">ones called request manager another is</span> <span data-start="411.78" data-end="413.94">called slave master which may or may not</span> <span data-start="413.94" data-end="416.46">be politically correct and then we also</span> <span data-start="416.46" data-end="418.05">have Mongo rapper now I talked a little</span> <span data-start="418.05" data-end="422.52">bit about these one thing we found that</span> <span data-start="422.52" data-end="424.89">was difficult to with note is it's a</span> <span data-start="424.89" data-end="426.51">process constantly running and we get</span> <span data-start="426.51" data-end="428.19">hundreds of requests per second from all</span> <span data-start="428.19" data-end="431.19">of our drivers phones if we need to push</span> <span data-start="431.19" data-end="433.59">out new code and restart it we may or</span> <span data-start="433.59" data-end="435.24">may not lose one of those requests and</span> <span data-start="435.24" data-end="437.58">so we built request manager so that we</span> <span data-start="437.58" data-end="439.53">could basically tell node like hey I'm</span> <span data-start="439.53" data-end="441.09">gonna shut down and restart because I</span> <span data-start="441.09" data-end="442.62">have new code and it would finish</span> <span data-start="442.62" data-end="443.85">serving up all the requests that had</span> <span data-start="443.85" data-end="445.47">gotten while blocking all the others it</span> <span data-start="445.47" data-end="447.72">would return a 410 gone message and so</span> <span data-start="447.72" data-end="451.71">basically it would say you know I'm not</span> <span data-start="451.71" data-end="453.03">accepting any more requests but I'm</span> <span data-start="453.03" data-end="454.38">gonna still fulfill all the ones that</span> <span data-start="454.38" data-end="456.15">have already come in and then basically</span> <span data-start="456.15" data-end="457.89">once it's cleared out that entire queue</span> <span data-start="457.89" data-end="459.99">it then restarts itself and so we now</span> <span data-start="459.99" data-end="461.34">have a deployment strategy that doesn't</span> <span data-start="461.34" data-end="464.22">ever lose any requests that come in the</span> <span data-start="464.22" data-end="466.97">slave master is an interesting component</span> <span data-start="466.97" data-end="471.03">basically it as I kind of described</span> <span data-start="471.03" data-end="473.22">before we have this dispatch system but</span> <span data-start="473.22" data-end="474.78">there could only be one master and that</span> <span data-start="474.78" data-end="476.82">one does all of the dispatches but we</span> <span data-start="476.82" data-end="478.08">need these slaves here in case something</span> <span data-start="478.08" data-end="479.64">happens to the master and so we built</span> <span data-start="479.64" data-end="480.69">something that's kind of similar to</span> </p>
<p><span data-start="480.69" data-end="483.27">MongoDB replicas sets but not quite as</span> <span data-start="483.27" data-end="485.73">sophisticated or basically there's a</span> <span data-start="485.73" data-end="488.64">pool of them and if the master ever goes</span> <span data-start="488.64" data-end="490.35">down the slaves elect a new master and</span> <span data-start="490.35" data-end="493.65">within milliseconds we've it reloads its</span> <span data-start="493.65" data-end="496.2">state and so again we don't lose</span> <span data-start="496.2" data-end="497.7">anything and if if any of the</span> <span data-start="497.7" data-end="501.39">connections on the tier above it you</span> <span data-start="501.39" data-end="503.64">know sent one to let's say the slave</span> <span data-start="503.64" data-end="505.23">accidentally it would say like I'm sorry</span> </p>
<p><span data-start="505.23" data-end="506.7">I'm not the master this guy is and then</span> <span data-start="506.7" data-end="509.1">it resends the request so those two</span> <span data-start="509.1" data-end="512.43">combined make it so we basically never</span> <span data-start="512.43" data-end="516.15">lose any requests coming in now Mongo</span> <span data-start="516.15" data-end="517.59">wrappers just sort of a helper thing we</span> <span data-start="517.59" data-end="520.02">built so that MongoDB was a little bit</span> <span data-start="520.02" data-end="523.62">easier to interface with and in a node</span> <span data-start="523.62" data-end="525.84">because if you've used the MongoDB when</span> <span data-start="525.84" data-end="526.86">you know you have to make a connection</span> <span data-start="526.86" data-end="528.63">and then you insert the collections if</span> <span data-start="528.63" data-end="530.82">it fails it has to reconnect and you get</span> <span data-start="530.82" data-end="531.84">this asynchronous night</span> <span data-start="531.84" data-end="533.67">where you're tabbed in like you know</span> <span data-start="533.67" data-end="536.04">eight times just to handle a single call</span> <span data-start="536.04" data-end="538.29">so anyway I'll show some brief examples</span> <span data-start="538.29" data-end="539.58">of these modules we're thinking about</span> <span data-start="539.58" data-end="540.63">open sourcing and we just need a</span> <span data-start="540.63" data-end="546.66">genericized a little bit so so request</span> <span data-start="546.66" data-end="548.79">manager is very simple and your</span> <span data-start="548.79" data-end="551.07">constructor of like your server you just</span> <span data-start="551.07" data-end="552.3">start up a new request manager it</span> <span data-start="552.3" data-end="554.64">listens on a port let's say 9000 and</span> <span data-start="554.64" data-end="557.43">anytime that the server receives a</span> <span data-start="557.43" data-end="560.22">request it doesn't the request manager</span> <span data-start="560.22" data-end="561.51">and it creates a context with the</span> <span data-start="561.51" data-end="563.64">request the body that it just received</span> <span data-start="563.64" data-end="566.37">as well as the response object and then</span> <span data-start="566.37" data-end="568.65">our server let's says say processes the</span> <span data-start="568.65" data-end="570.87">message of that that's all the code you</span> <span data-start="570.87" data-end="572.43">need to basically use request manager</span> <span data-start="572.43" data-end="573.96">that's all we added to our server and</span> <span data-start="573.96" data-end="577.38">now we have the ability to restart node</span> <span data-start="577.38" data-end="579.57">without ever losing any requests which</span> <span data-start="579.57" data-end="583.8">is awesome it's really that's it and</span> <span data-start="583.8" data-end="587.15">it's pretty basic</span> <span data-start="587.16" data-end="591.27">the next piece the slave master piece</span> <span data-start="591.27" data-end="593.85">there basically is a like array of</span> <span data-start="593.85" data-end="597.06">servers you know this is like a snippet</span> <span data-start="597.06" data-end="599.33">of our configuration file let's say</span> <span data-start="599.33" data-end="602.46">listens on the port publicly then</span> <span data-start="602.46" data-end="603.84">there's the request manager port as well</span> <span data-start="603.84" data-end="605.52">as the slave master port so all the</span> <span data-start="605.52" data-end="607.47">masters and slaves talk on port 8000 and</span> <span data-start="607.47" data-end="608.88">- they're constantly talking to each</span> <span data-start="608.88" data-end="612">other to make sure that they know who</span> <span data-start="612" data-end="615.03">the master is that everything's cool and</span> <span data-start="615.03" data-end="617.34">this is again is really simple all we</span> <span data-start="617.34" data-end="620.49">did is say new slave master I am server</span> <span data-start="620.49" data-end="623.07">1 let's say or server 2 and here's the</span> <span data-start="623.07" data-end="625.38">list of all the servers and there's a</span> <span data-start="625.38" data-end="627.87">callback so basically when I become the</span> <span data-start="627.87" data-end="630.12">master I need to load in data from Mongo</span> <span data-start="630.12" data-end="633.86">so that I can take over as the master so</span> <span data-start="633.86" data-end="636.15">that's pretty much all that was — we</span> <span data-start="636.15" data-end="637.38">built all these components after we</span> <span data-start="637.38" data-end="638.64">built the dispatch system just a</span> <span data-start="638.64" data-end="640.38">bullet-proof it and we built them in</span> <span data-start="640.38" data-end="641.82">such a way that only took like three or</span> <span data-start="641.82" data-end="644.28">four lines of code to basically make it</span> <span data-start="644.28" data-end="649.35">bulletproof in that regard so and then</span> </p>
<p><span data-start="649.35" data-end="651.87">Mongo wrapper again really simple works</span> <span data-start="651.87" data-end="654">with replica sets or just a host port</span> <span data-start="654" data-end="655.95">pair passing the replicas set the</span> <span data-start="655.95" data-end="657.81">database you want to do there's a retry</span> <span data-start="657.81" data-end="659.94">limit or retry interval</span> <span data-start="659.94" data-end="661.86">you know in case Mongo goes down which</span> <span data-start="661.86" data-end="664.11">in a replica set would be kind of a</span> <span data-start="664.11" data-end="665.67">highly unlikely but you never know</span> <span data-start="665.67" data-end="667.38">one of the things that manga rapper</span> <span data-start="667.38" data-end="669.21">provides that we added was journaling</span> <span data-start="669.21" data-end="673.26">now Mongo does journaling on its own but</span> <span data-start="673.26" data-end="674.49">it doesn't journal when it's down</span> <span data-start="674.49" data-end="677.61">because it doesn't exist so we have our</span> <span data-start="677.61" data-end="679.92">own journaling that basically writes to</span> <span data-start="679.92" data-end="681.48">the file system all the queries that</span> <span data-start="681.48" data-end="684.27">didn't make it into Mongo and so there's</span> <span data-start="684.27" data-end="686.19">a backup directory there how long it</span> <span data-start="686.19" data-end="687.96">retries and restores and then basically</span> <span data-start="687.96" data-end="690.36">anytime we need to insert update remove</span> <span data-start="690.36" data-end="692.25">from Mongo it's as simple as a one-line</span> <span data-start="692.25" data-end="693.84">call and it handles all the reconnecting</span> <span data-start="693.84" data-end="696.96">the Mongo you know making sure that</span> <span data-start="696.96" data-end="698.91">requests eventually gets there no matter</span> <span data-start="698.91" data-end="702.57">what so yeah that's a Mongo rapper</span> <span data-start="702.57" data-end="705">component we also built a serializer</span> <span data-start="705" data-end="707.25">that serialize a state to Mongo but I</span> <span data-start="707.25" data-end="709.26">didn't really write that cuz it's very</span> <span data-start="709.26" data-end="711.42">specific to our use case but these are</span> <span data-start="711.42" data-end="713.37">some of the things that we we think</span> <span data-start="713.37" data-end="715.14">about open sourcing I'd be curious if</span> <span data-start="715.14" data-end="717">anybody would like these components</span> <span data-start="717" data-end="718.05">because then we'll definitely work on</span> <span data-start="718.05" data-end="719.31">that open source it maybe get some</span> <span data-start="719.31" data-end="721.17">people to contribute to them but they</span> <span data-start="721.17" data-end="722.97">actually made our whole architecture</span> <span data-start="722.97" data-end="724.68">like completely bulletproof we don't</span> <span data-start="724.68" data-end="726.06">even care anymore when servers go down</span> <span data-start="726.06" data-end="727.65">that used to be our nightmare on Friday</span> <span data-start="727.65" data-end="730.71">nights like out of the bar I get these</span> <span data-start="730.71" data-end="732.84">email notifications it's just you know</span> <span data-start="732.84" data-end="734.85">the entire architecture originally was</span> <span data-start="734.85" data-end="736.29">running on one server which is never</span> <span data-start="736.29" data-end="741.09">gonna be a good idea so there's a few</span> <span data-start="741.09" data-end="743.85">other things that we got from moving</span> <span data-start="743.85" data-end="745.62">things to node like kind of ancillary</span> <span data-start="745.62" data-end="748.02">benefits to our tools that are actually</span> <span data-start="748.02" data-end="749.31">really interesting we can now share</span> <span data-start="749.31" data-end="751.05">these JavaScript objects between both</span> <span data-start="751.05" data-end="753.03">the client and the server now most of</span> <span data-start="753.03" data-end="754.62">our app is you know our client is on</span> <span data-start="754.62" data-end="756.42">iPhones on androids SMS it's not a</span> </p>
<p><span data-start="756.42" data-end="759.42">JavaScript client but we have a lot of</span> <span data-start="759.42" data-end="761.85">internal tools that are JavaScript like</span> <span data-start="761.85" data-end="764.52">monitoring tools the big one that wired</span> <span data-start="764.52" data-end="766.11">did a story about us recently and they</span> <span data-start="766.11" data-end="767.49">talked about this as well as The Wall</span> <span data-start="767.49" data-end="770.28">Street Journal is called God view and</span> <span data-start="770.28" data-end="773.52">God views basically what we do while I</span> <span data-start="773.52" data-end="775.29">watch this all Friday night now like</span> <span data-start="775.29" data-end="776.46">it's amazing it's just so much fun to</span> <span data-start="776.46" data-end="778.86">watch it's a live real-time Google Maps</span> <span data-start="778.86" data-end="780.21">interface of where all the cars are</span> <span data-start="780.21" data-end="781.47">where they're going who they're picking</span> <span data-start="781.47" data-end="786.12">up what they're doing and so we built</span> <span data-start="786.12" data-end="787.92">this before and just hand coded it up</span> <span data-start="787.92" data-end="789.9">we had our intern last summer coded up</span> <span data-start="789.9" data-end="792.95">in one night and but now we can actually</span> <span data-start="792.95" data-end="796.35">make god of you a little bit more</span> <span data-start="796.35" data-end="797.79">maintainable I'm thinking about</span> <span data-start="797.79" data-end="799.13">rewriting it with now Jay</span> </p>
<p><span data-start="799.13" data-end="800.84">I just learned about that yesterday or</span> <span data-start="800.84" data-end="802.64">two days ago at Jay s Kampf you know</span> <span data-start="802.64" data-end="805.22">basically saying to the to the note</span> <span data-start="805.22" data-end="806.57">dispatch like hey give me all the</span> <span data-start="806.57" data-end="808.31">clients and drivers I'm just gonna draw</span> <span data-start="808.31" data-end="811.49">them on the map here and so we have a</span> <span data-start="811.49" data-end="812.93">lot of internal tools that are now made</span> <span data-start="812.93" data-end="815.18">easier to implement because of note you</span> <span data-start="815.18" data-end="816.35">know we don't have to maintain a</span> <span data-start="816.35" data-end="818.06">separate PHP code base with all these</span> <span data-start="818.06" data-end="819.59">objects and a separate JavaScript code</span> <span data-start="819.59" data-end="820.82">base and then we also have the Python</span> <span data-start="820.82" data-end="822.56">code base and it's just out of control</span> <span data-start="822.56" data-end="824.69">we've we've basically now just purely</span> </p>
<p><span data-start="824.69" data-end="827.44">JavaScript and some Python as well so</span> <span data-start="827.44" data-end="829.34">some of the other cool things we've been</span> <span data-start="829.34" data-end="832.73">doing with some of this data is uh heat</span> <span data-start="832.73" data-end="834.59">maps we've been trying to find new and</span> <span data-start="834.59" data-end="836.54">interesting heat maps to display or what</span> <span data-start="836.54" data-end="839.78">we call data porn team we have like</span> <span data-start="839.78" data-end="844.25">several PhDs that that work on mining</span> <span data-start="844.25" data-end="845.39">our data so that we can make the whole</span> <span data-start="845.39" data-end="847.85">system more efficient this isn't really</span> <span data-start="847.85" data-end="849.2">node related but it's just kind of cool</span> <span data-start="849.2" data-end="851.81">to look at and it's an it's like really</span> <span data-start="851.81" data-end="854.36">intense data analysis so for example</span> <span data-start="854.36" data-end="857.18">this is San Francisco all these points</span> <span data-start="857.18" data-end="858.8">are points where the drivers were when</span> <span data-start="858.8" data-end="860.48">they accepted a request and it's kind of</span> <span data-start="860.48" data-end="862.31">cool how it just outlines the cities and</span> <span data-start="862.31" data-end="866.12">you can see where where they wait when</span> <span data-start="866.12" data-end="867.8">they're about to go pick up people all</span> <span data-start="867.8" data-end="869.93">over the place and then there's things</span> <span data-start="869.93" data-end="871.22">like this this is Manhattan this is</span> <span data-start="871.22" data-end="873.2">where people have opened our app and</span> <span data-start="873.2" data-end="874.64">tried to get a car in Manhattan so this</span> <span data-start="874.64" data-end="876.41">is like basically the demand heat map of</span> </p>
<p><span data-start="876.41" data-end="880.16">Manhattan for people that want an uber</span> <span data-start="880.16" data-end="882.08">car and then there's other ones that</span> <span data-start="882.08" data-end="883.88">we've been doing some more intense data</span> <span data-start="883.88" data-end="885.41">analysis about like how long it takes</span> <span data-start="885.41" data-end="887.57">for our cars to arrive so we have heat</span> <span data-start="887.57" data-end="890.21">maps like this which is that's basically</span> <span data-start="890.21" data-end="891.77">San Francisco you can kind of see the</span> <span data-start="891.77" data-end="893.81">outlines of the streets and basically</span> <span data-start="893.81" data-end="895.76">how many seconds it takes for our car to</span> <span data-start="895.76" data-end="897.44">arrive once you say I need a car and</span> <span data-start="897.44" data-end="899.18">we're actually really good in various</span> <span data-start="899.18" data-end="901.61">areas of downtown obviously out in this</span> <span data-start="901.61" data-end="904.58">burbs we're not as good but there's not</span> <span data-start="904.58" data-end="906.32">as much volume there so it kind of makes</span> <span data-start="906.32" data-end="908.96">sense so these are kind of some of the</span> <span data-start="908.96" data-end="910.91">problems that we're solving node has</span> <span data-start="910.91" data-end="913.01">helped us make a really cool scalable</span> <span data-start="913.01" data-end="915.5">distributed architecture the CEO and I</span> <span data-start="915.5" data-end="917.33">had a peer-to-peer content delivery</span> <span data-start="917.33" data-end="918.71">network before called red swoosh so</span> <span data-start="918.71" data-end="919.66">we're really good at building</span> <span data-start="919.66" data-end="923">distributed like fault tolerant reliance</span> <span data-start="923" data-end="924.41">systems and so we're taking that that</span> <span data-start="924.41" data-end="926.93">knowledge and basically bringing it to</span> <span data-start="926.93" data-end="930.11">you know an on-demand car service that's</span> <span data-start="930.11" data-end="933.169">going to be in every city in the u.s. so</span> <span data-start="933.169" data-end="935.929">and then again like we said we have</span> <span data-start="935.929" data-end="937.639">teams of people doing this amazing data</span> <span data-start="937.639" data-end="941.899">analysis as well so yeah if you want to</span> <span data-start="941.899" data-end="942.829">read more about some of the data</span> <span data-start="942.829" data-end="944.569">analysis we do we publish it to our blog</span> <span data-start="944.569" data-end="946.429">this is the link to see the two posts</span> <span data-start="946.429" data-end="949.129">that we've done so far one was a we</span> <span data-start="949.129" data-end="950.389">analyze we could take the weather data</span> <span data-start="950.389" data-end="952.399">and correlated it analyze the effect of</span> <span data-start="952.399" data-end="954.169">rain on demand and it turns out rain is</span> <span data-start="954.169" data-end="956.149">amazing for our business I used to love</span> <span data-start="956.149" data-end="958.16">sunny days now I don't anymore</span> <span data-start="958.16" data-end="960.769">so that's why you know why we're going</span> <span data-start="960.769" data-end="965.929">to Seattle so anyway if you want to</span> <span data-start="965.929" data-end="967.22">check out some of our data post we have</span> <span data-start="967.22" data-end="968.629">this we also have one that shows how</span> <span data-start="968.629" data-end="970.22">we're actually cheaper than cabs despite</span> <span data-start="970.22" data-end="971.6">being more expensive if you value your</span> <span data-start="971.6" data-end="973.22">time at all that's a really interesting</span> <span data-start="973.22" data-end="975.47">post especially in San Francisco where</span> <span data-start="975.47" data-end="978.169">cabs don't really show up so yeah so</span> <span data-start="978.169" data-end="981.529">check that out this is we're doing some</span> <span data-start="981.529" data-end="982.939">really cool stuff and we're hiring so if</span> <span data-start="982.939" data-end="984.529">anybody needs a job let me know come</span> <span data-start="984.529" data-end="985.009">find me</span> <span data-start="985.009" data-end="990.829">so that's pretty much it short talk the</span> <span data-start="990.829" data-end="993.139">question is how big is our deployment</span> <span data-start="993.139" data-end="995.299">right now we're powering it on just six</span> <span data-start="995.299" data-end="999.619">servers like I said we've got actually</span> <span data-start="999.619" data-end="1000.309">that's not true</span> <span data-start="1000.309" data-end="1005.079">we have 10 servers but yeah we basically</span> <span data-start="1005.079" data-end="1007.629">have at least three of each component in</span> <span data-start="1007.629" data-end="1009.369">the like so basically there's like the</span> <span data-start="1009.369" data-end="1010.989">connection no tear the dispatched here</span> <span data-start="1010.989" data-end="1013.029">the API — and like we have at least</span> <span data-start="1013.029" data-end="1015.97">three nodes of each tear some have more</span> <span data-start="1015.97" data-end="1019.72">some have less and it just depends on</span> <span data-start="1019.72" data-end="1021.629">demand but we have we don't have the</span> <span data-start="1021.629" data-end="1023.559">elasticity of demand problem that a lot</span> <span data-start="1023.559" data-end="1024.639">of people have that's why people go to</span> <span data-start="1024.639" data-end="1025.839">ec2 because they never know when they'll</span> <span data-start="1025.839" data-end="1027.22">get demand spikes and need to spawn up</span> <span data-start="1027.22" data-end="1029.019">new servers we don't really have that</span> <span data-start="1029.019" data-end="1030.22">problem because we control how many</span> <span data-start="1030.22" data-end="1031.72">drivers we have and drivers are the only</span> <span data-start="1031.72" data-end="1033.189">thing that generates significant demand</span> <span data-start="1033.189" data-end="1036.13">on our system so you know if we if we're</span> <span data-start="1036.13" data-end="1038.11">gonna hire thousand new drivers we know</span> <span data-start="1038.11" data-end="1039.789">about it well ahead of time and can you</span> <span data-start="1039.789" data-end="1045.789">know work on that so you local</span> <span data-start="1045.789" data-end="1046.959">deployments engineering wiser</span> <span data-start="1046.959" data-end="1051.549">what do you oh we haven't really seen</span> <span data-start="1051.549" data-end="1055.63">that is something we need to do it might</span> <span data-start="1055.63" data-end="1057.309">make the request slightly faster our</span> <span data-start="1057.309" data-end="1060.76">biggest issue right now is like ATT like</span> <span data-start="1060.76" data-end="1062.559">getting 3G connection every driver has</span> <span data-start="1062.559" data-end="1063.95">an iPhone in their car and that</span> <span data-start="1063.95" data-end="1065.81">how we know what's going on in all the</span> <span data-start="1065.81" data-end="1069.05">cars and you know AT&T in San Francisco</span> </p>
<p><span data-start="1069.05" data-end="1070.4">New York are legendary for their</span> <span data-start="1070.4" data-end="1073.01">unreliability so hoping the Verizon</span> <span data-start="1073.01" data-end="1082.04">iPhone can fix that a little bit it's</span> <span data-start="1082.04" data-end="1084.25">not super extensive I mean it's</span> <span data-start="1084.25" data-end="1087.23">basically like there's a client object a</span> <span data-start="1087.23" data-end="1089.09">driver objects like a trip object like</span> <span data-start="1089.09" data-end="1090.5">there's there's these basically</span> <span data-start="1090.5" data-end="1092.51">JavaScript objects that we then use to</span> <span data-start="1092.51" data-end="1094.61">then plot like God view and things like</span> <span data-start="1094.61" data-end="1097.52">that but you know there's not a there's</span> <span data-start="1097.52" data-end="1100.49">not a ton I mean we're actually just</span> <span data-start="1100.49" data-end="1101.75">embarking on rebuilding all of our</span> <span data-start="1101.75" data-end="1103.82">internal tools using backbone and so</span> <span data-start="1103.82" data-end="1105.71">with that I think we're actually going</span> <span data-start="1105.71" data-end="1107.57">to have a lot of interesting tie-ins but</span> <span data-start="1107.57" data-end="1109.4">really gotta be is the only thing right</span> <span data-start="1109.4" data-end="1110.78">now that shares between the client in</span> <span data-start="1110.78" data-end="1117.86">the server so oh that's just kind of</span> <span data-start="1117.86" data-end="1121.4">like a super crazy backup like if if for</span> <span data-start="1121.4" data-end="1123.11">some reason it never gets inserted after</span> <span data-start="1123.11" data-end="1125.33">days and days and it's kind of like dump</span> <span data-start="1125.33" data-end="1126.74">the queries here and so will eventually</span> <span data-start="1126.74" data-end="1128.54">go back and look and see what what never</span> <span data-start="1128.54" data-end="1131.27">got inserted into the database so um</span> <span data-start="1131.27" data-end="1133.34">yeah it's just like where queries go to</span> <span data-start="1133.34" data-end="1142.67">die basically anything else yeah we used</span> <span data-start="1142.67" data-end="1146.63">the Mongo native DB module we just</span> <span data-start="1146.63" data-end="1148.76">extended an open source the node logger</span> <span data-start="1148.76" data-end="1150.5">module which I think just got renamed to</span> <span data-start="1150.5" data-end="1151.96">n logger</span> <span data-start="1151.96" data-end="1160.01">we also use I think node settings really</span> <span data-start="1160.01" data-end="1161.84">basic stuff we wrote almost everything</span> <span data-start="1161.84" data-end="1163.61">we have by hand we basically just</span> <span data-start="1163.61" data-end="1165.86">brought in logging brought in settings</span> <span data-start="1165.86" data-end="1167.96">and then the Mongo DB interface and it</span> <span data-start="1167.96" data-end="1171.08">oh we also used the o3 module for XML</span> <span data-start="1171.08" data-end="1174.8">parsing because again the the proof of</span> <span data-start="1174.8" data-end="1176.99">concept system used XML and so now we're</span> <span data-start="1176.99" data-end="1178.07">like working on getting everything to</span> </p>
<p><span data-start="1178.07" data-end="1179.6">JSON but again when it's a system in</span> <span data-start="1179.6" data-end="1181.16">flight and you have to wait for people</span> <span data-start="1181.16" data-end="1182.69">to upgrade their iPhones you know</span> <span data-start="1182.69" data-end="1185">upgrade the app on their iPhones so we</span> <span data-start="1185" data-end="1186.77">need to accept both XML and JSON</span> <span data-start="1186.77" data-end="1191.75">requests from there so no no only Python</span> <span data-start="1191.75" data-end="1193.76">does that we use sequel alchemy for that</span> <span data-start="1193.76" data-end="1197.58">so else</span> </p>
</section>