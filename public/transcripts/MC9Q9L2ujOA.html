<section>
<p><span data-start="37.98" data-end="41.44">alright thanks for coming to this talk</span> <span data-start="41.44" data-end="44.44">it seems to be my luck that at</span> <span data-start="44.44" data-end="46.63">conferences I'm often up against people</span> <span data-start="46.63" data-end="49.36">i admire at the same time in the other</span> <span data-start="49.36" data-end="51.07">room and that is the case here you</span> <span data-start="51.07" data-end="52.87">should definitely check out James long's</span> <span data-start="52.87" data-end="55.78">works on ensuite je s macros for</span> <span data-start="55.78" data-end="57.79">JavaScript since we came to this talk</span> <span data-start="57.79" data-end="60.399">and you're missing that but since you</span> <span data-start="60.399" data-end="62.5">did come to this talk I think you're in</span> <span data-start="62.5" data-end="65.979">for a treat I'm going to talk about a</span> <span data-start="65.979" data-end="68.68">project called regenerator which is an</span> <span data-start="68.68" data-end="70.75">effort to take one of the really cool I</span> <span data-start="70.75" data-end="73.42">think the coolest feature of the next</span> <span data-start="73.42" data-end="75.76">version of JavaScript acma script 6 and</span> <span data-start="75.76" data-end="79.659">simulate it using javascript of today so</span> <span data-start="79.659" data-end="80.979">you can go ahead and use that feature</span> <span data-start="80.979" data-end="84.46">from the future in the present or in a</span> <span data-start="84.46" data-end="87.76">browser more to the point i'm ben newman</span> <span data-start="87.76" data-end="90.909">and i work at facebook a release</span> <span data-start="90.909" data-end="94.42">regenerator with my my team at facebook</span> <span data-start="94.42" data-end="96.25">which is the javascript infrastructure</span> <span data-start="96.25" data-end="97.99">team and we have been maintaining it</span> <span data-start="97.99" data-end="100.15">actively so it's not just thrown over</span> <span data-start="100.15" data-end="102.01">the wall if you want to talk to me</span> <span data-start="102.01" data-end="104.65">specifically in following up on any of</span> <span data-start="104.65" data-end="106.24">this stuff or just get to know me i'm</span> <span data-start="106.24" data-end="109.27">benjamin without the eye on most forms</span> <span data-start="109.27" data-end="114.64">of social media as you can see there so</span> <span data-start="114.64" data-end="118.54">when we released regenerator wrote up</span> <span data-start="118.54" data-end="121.09">this sort of call to action page and</span> <span data-start="121.09" data-end="124.39">posted it up on hacker news and got into</span> <span data-start="124.39" data-end="126.43">like the top five and the the comments</span> <span data-start="126.43" data-end="130.169">were all really surprisingly</span> <span data-start="130.169" data-end="132.159">appreciative there was very little</span> <span data-start="132.159" data-end="135.01">backlash and one of the things I think</span> <span data-start="135.01" data-end="137.92">went well about this launch is that it's</span> <span data-start="137.92" data-end="140.26">it signals just from a headline like</span> <span data-start="140.26" data-end="143.26">this that you might need to have or want</span> <span data-start="143.26" data-end="146.14">to have a little bit of context a little</span> <span data-start="146.14" data-end="148.03">bit of experience with the idea of</span> <span data-start="148.03" data-end="151.269">generator functions before you have an</span> <span data-start="151.269" data-end="153.7">opinion about you know the way we did it</span> <span data-start="153.7" data-end="157">was correct or the best way of doing it</span> <span data-start="157" data-end="161.53">and so I I live in New York and one of</span> <span data-start="161.53" data-end="164.409">our local meetups is Brooklyn j/s at the</span> <span data-start="164.409" data-end="166.659">last instance of Brooklyn jas Brittany</span> <span data-start="166.659" data-end="168.819">sister Rose gave a talk about technical</span> <span data-start="168.819" data-end="171.67">writing and she gave me a term that that</span> <span data-start="171.67" data-end="174.31">now sort of helps me conceptualize this</span> <span data-start="174.31" data-end="177.76">this idea so you have low context and</span> <span data-start="177.76" data-end="181.84">high context audience members and you</span> <span data-start="181.84" data-end="183.22">can write in different ways and you</span> <span data-start="183.22" data-end="186.34">should write in different ways when your</span> <span data-start="186.34" data-end="187.959">audience comes in with some context</span> <span data-start="187.959" data-end="189.639">versus when they come in with much</span> <span data-start="189.639" data-end="192.73">context and so I'm making a bet that</span> <span data-start="192.73" data-end="195.639">jayus conf and the group of people who</span> <span data-start="195.639" data-end="197.65">have come to this talk stand the best</span> <span data-start="197.65" data-end="199.629">chance of having a little bit of context</span> <span data-start="199.629" data-end="201.97">around these issues of anyone anywhere</span> <span data-start="201.97" data-end="204.519">so I hope you don't mind if I abuse you</span> <span data-start="204.519" data-end="207.069">with what I would consider to be a</span> <span data-start="207.069" data-end="208.599">pretty technical talk there's a lot of</span> <span data-start="208.599" data-end="211.69">code and I would just encourage you if</span> <span data-start="211.69" data-end="213.849">you if you want to follow along at all</span> <span data-start="213.849" data-end="216.4">look at the slides read along with the</span> <span data-start="216.4" data-end="218.319">code as I'm talking about it otherwise</span> <span data-start="218.319" data-end="221.739">if I'm just talking about it and you</span> <span data-start="221.739" data-end="223.209">know you haven't been looking you may</span> <span data-start="223.209" data-end="224.68">find yourself lost which is totally fine</span> <span data-start="224.68" data-end="226.87">i'll try to change the tone of my voice</span> <span data-start="226.87" data-end="228.069">when there's something like sort of</span> <span data-start="228.069" data-end="230.739">independently interesting and you know</span> <span data-start="230.739" data-end="234">maybe you can get back on the the path</span> <span data-start="234" data-end="239.5">but with that warning out of the way so</span> <span data-start="239.5" data-end="242.879">calls to action right are something we</span> <span data-start="242.879" data-end="246.519">often feel like issuing when we've built</span> <span data-start="246.519" data-end="248.079">something that we're proud of we think</span> <span data-start="248.079" data-end="249.819">other people should use it we think it's</span> <span data-start="249.819" data-end="252.19">a better way of doing things then the</span> <span data-start="252.19" data-end="253.359">way things have been done in the past</span> <span data-start="253.359" data-end="256.329">and we want to tell ourselves that we</span> <span data-start="256.329" data-end="257.859">and everybody else should have been</span> <span data-start="257.859" data-end="261.94">doing it this way all along and github</span> <span data-start="261.94" data-end="264.7">is indeed littered with better ways of</span> <span data-start="264.7" data-end="266.289">doing things really better ways for</span> <span data-start="266.289" data-end="268.34">someone of doing something</span> <span data-start="268.34" data-end="270.68">that never quite caught on and why is</span> <span data-start="270.68" data-end="275.6">that well I would claim that in addition</span> <span data-start="275.6" data-end="278.96">to having a bright idea about how you</span> <span data-start="278.96" data-end="280.49">ought to have done something from the</span> <span data-start="280.49" data-end="283.669">beginning you can't just go back and</span> <span data-start="283.669" data-end="285.53">start over from scratch if you could it</span> <span data-start="285.53" data-end="286.85">would be easy to do it the right way</span> <span data-start="286.85" data-end="291.32">from scratch but they're also you also</span> <span data-start="291.32" data-end="293.3">have to have a second clever idea which</span> <span data-start="293.3" data-end="295.34">is how to get from where you are right</span> <span data-start="295.34" data-end="297.68">now with the the application stack that</span> <span data-start="297.68" data-end="300.68">you've inherited to that new place that</span> <span data-start="300.68" data-end="303.05">is as if you started from scratch with</span> <span data-start="303.05" data-end="305.3">all the right ideas so there has to be a</span> <span data-start="305.3" data-end="307.639">way forward not just backwards and then</span> <span data-start="307.639" data-end="311.3">forwards again and I would go I would go</span> <span data-start="311.3" data-end="312.53">further to claim that programming</span> <span data-start="312.53" data-end="314.93">languages are notoriously difficult in</span> <span data-start="314.93" data-end="316.82">this way they're difficult to fix</span> <span data-start="316.82" data-end="321.229">forward so if i can ask inflammatory</span> <span data-start="321.229" data-end="322.52">question that may not be so inflammatory</span> <span data-start="322.52" data-end="324.38">here because this is a JavaScript and</span> <span data-start="324.38" data-end="328.28">not a Python conference what why is it</span> <span data-start="328.28" data-end="330.77">it's been since 2008 and Python 3 is</span> <span data-start="330.77" data-end="333.169">definitely a better language in a lot of</span> <span data-start="333.169" data-end="335.78">ways than Python 2 and Python 2 is one</span> <span data-start="335.78" data-end="336.83">of the most successful programming</span> <span data-start="336.83" data-end="338.78">language in the history of programming</span> <span data-start="338.78" data-end="342.26">languages why is it that big projects</span> <span data-start="342.26" data-end="345.53">haven't switched to python 3 Django for</span> <span data-start="345.53" data-end="351.02">instance and so I don't know how many</span> <span data-start="351.02" data-end="352.669">people have used python of any version</span> <span data-start="352.669" data-end="356.81">in the room almost everyone maybe eighty</span> <span data-start="356.81" data-end="358.37">ninety percent how many people have</span> <span data-start="358.37" data-end="361.039">written a line of Python 3 that runs in</span> <span data-start="361.039" data-end="363.59">production all right all right we can</span> <span data-start="363.59" data-end="366.77">walk away from this discussion okay so I</span> <span data-start="366.77" data-end="368.33">don't want to go into this too much but</span> </p>
<p><span data-start="368.33" data-end="371.389">Python 3 is a lot of new features some</span> <span data-start="371.389" data-end="373.099">of which are fairly trivial to switch</span> <span data-start="373.099" data-end="375.08">over to they have a two to three script</span> <span data-start="375.08" data-end="377.389">to convert your print keywords to print</span> <span data-start="377.389" data-end="379.19">function since that's so like small</span> <span data-start="379.19" data-end="380.72">cosmetic thing that changed but there</span> <span data-start="380.72" data-end="382.9">are also differences in the semantics of</span> <span data-start="382.9" data-end="386.57">like Unicode handling in Python 3 that</span> <span data-start="386.57" data-end="387.889">are definitely the right way to do</span> <span data-start="387.889" data-end="391.55">things like byte strings in Python 2 or</span> <span data-start="391.55" data-end="394.22">a source of a lot of trouble but you</span> <span data-start="394.22" data-end="396.919">can't just switch one day and start</span> <span data-start="396.919" data-end="399.469">using that feature of Python 3 and</span> <span data-start="399.469" data-end="401.3">because it's one big language that you</span> <span data-start="401.3" data-end="402.11">have to start use</span> <span data-start="402.11" data-end="403.85">in all at once you've got to sort of</span> <span data-start="403.85" data-end="405.59">swallow the things that are difficult to</span> <span data-start="405.59" data-end="408.17">swallow along with savoring the things</span> <span data-start="408.17" data-end="411.53">that you actually want so to bring this</span> <span data-start="411.53" data-end="413.99">back to what we care about how can echo</span> <span data-start="413.99" data-end="416.39">script six which is the technical</span> <span data-start="416.39" data-end="417.86">standards name for the next version of</span> </p>
<p><span data-start="417.86" data-end="420.65">JavaScript avoid this trap the Python 3</span> <span data-start="420.65" data-end="424.79">trap if you will so my crazy idea which</span> <span data-start="424.79" data-end="426.47">I'm giving myself too much credit to</span> <span data-start="426.47" data-end="428.33">call my idea but it's something I've</span> <span data-start="428.33" data-end="430.31">become passionate about in the last year</span> <span data-start="430.31" data-end="432.53">or so is that we might be able to ease</span> <span data-start="432.53" data-end="434.42">ourselves into the new version of the</span> <span data-start="434.42" data-end="437.54">language by simulating its most useful</span> <span data-start="437.54" data-end="441.38">features in the current version of the</span> <span data-start="441.38" data-end="444.05">language right so why would we want to</span> <span data-start="444.05" data-end="445.57">do that obviously there's a cost to</span> <span data-start="445.57" data-end="447.74">simulating features and if you could</span> <span data-start="447.74" data-end="449.09">just switch to the next version of the</span> <span data-start="449.09" data-end="451.4">language native support for all those</span> <span data-start="451.4" data-end="453.05">things and wouldn't you be better off</span> <span data-start="453.05" data-end="456.23">well i think that the insight here is</span> <span data-start="456.23" data-end="458.21">that at every step of this process you</span> <span data-start="458.21" data-end="461.12">have this like perfect hybrid of the old</span> <span data-start="461.12" data-end="463.43">language and the new that suits your</span> <span data-start="463.43" data-end="466.37">needs exactly and you know exactly why</span> <span data-start="466.37" data-end="468.53">you've adopted each of its features you</span> <span data-start="468.53" data-end="470.09">get to prove them out even before</span> <span data-start="470.09" data-end="473.48">they're fully standardized and you you</span> <span data-start="473.48" data-end="476.06">just you know that the language you're</span> <span data-start="476.06" data-end="477.71">using is the language you want to be</span> <span data-start="477.71" data-end="479.6">using and there aren't these like hidden</span> <span data-start="479.6" data-end="482.12">dragons that you're going to have to</span> <span data-start="482.12" data-end="487.75">confront at some point so a phrase that</span> </p>
<p><span data-start="487.75" data-end="490.55">I might have come up with for this is</span> <span data-start="490.55" data-end="492.89">linguistic time-travel we're reaching</span> <span data-start="492.89" data-end="495.88">into the future and selectively taking</span> <span data-start="495.88" data-end="498.65">parts of the future a future of</span> <span data-start="498.65" data-end="500.99">JavaScript bringing them into JavaScript</span> <span data-start="500.99" data-end="505.68">of today so what's an example</span> <span data-start="505.68" data-end="509.25">well this is not generated related this</span> <span data-start="509.25" data-end="511.77">is a sort of simpler but also cool</span> <span data-start="511.77" data-end="514.11">feature of ECMO script six arrow</span> <span data-start="514.11" data-end="517.71">functions are a nice way of writing you</span> <span data-start="517.71" data-end="519.63">know the hundreds of little throwaway</span> <span data-start="519.63" data-end="520.95">callback functions that you need to</span> <span data-start="520.95" data-end="522.659">write in JavaScript so you get to do</span> <span data-start="522.659" data-end="525.839">away with the function keyword and you</span> <span data-start="525.839" data-end="528.089">can just have an expression instead of a</span> <span data-start="528.089" data-end="530.07">whole curly brace delimited body with a</span> <span data-start="530.07" data-end="531.99">return statement in it so these two</span> <span data-start="531.99" data-end="533.58">things are equivalent if you're running</span> <span data-start="533.58" data-end="536.19">a six but there's a fairly</span> <span data-start="536.19" data-end="538.11">straightforward translation from the</span> <span data-start="538.11" data-end="540.89">futuristic syntax to the syntax of today</span> <span data-start="540.89" data-end="543.839">and if you find these slides online</span> <span data-start="543.839" data-end="547.56">you'll see that this is all sort of live</span> <span data-start="547.56" data-end="549.36">editable in case you want to play with</span> <span data-start="549.36" data-end="552.75">it and see how it works and now I've</span> <span data-start="552.75" data-end="557.58">ruined it oh well okay so how does that</span> <span data-start="557.58" data-end="560.339">work well we've got a tool chain that we</span> <span data-start="560.339" data-end="562.43">have to face book that I've worked on</span> <span data-start="562.43" data-end="565.17">and that is open source it actually</span> <span data-start="565.17" data-end="567.029">predates my time at Facebook started</span> <span data-start="567.029" data-end="568.79">working on it when i worked at quora</span> <span data-start="568.79" data-end="572.1">it's called recast and it has some</span> <span data-start="572.1" data-end="574.38">utilities for traversing what are called</span> <span data-start="574.38" data-end="576.15">abstract syntax trees which are these</span> <span data-start="576.15" data-end="578.43">sort of object graph representations of</span> <span data-start="578.43" data-end="581.79">your code and ways of telling what type</span> <span data-start="581.79" data-end="583.35">of node you're looking at and also ways</span> <span data-start="583.35" data-end="586.26">of building up new kinds of nodes so you</span> <span data-start="586.26" data-end="588.54">call recast at parse with a string of</span> <span data-start="588.54" data-end="590.43">code that gives you back this tree and</span> <span data-start="590.43" data-end="594.27">then you need to modify the tree hope</span> <span data-start="594.27" data-end="597">you can see this the slides are at</span> </p>
<p><span data-start="597" data-end="600.87">Benjamin without the idea hub I 0 / jazz</span> <span data-start="600.87" data-end="606.48">camp 2014 if you want to pull that up ok</span> <span data-start="606.48" data-end="608.7">so we're traversing the tree starting at</span> <span data-start="608.7" data-end="610.05">the root of it which is typically like</span> <span data-start="610.05" data-end="613.589">the program type node and this callback</span> <span data-start="613.589" data-end="615.48">function is going to be called on every</span> <span data-start="615.48" data-end="617.22">node and we just want to only do</span> <span data-start="617.22" data-end="618.75">anything for the arrow function</span> <span data-start="618.75" data-end="620.04">expression it's because we're going to</span> <span data-start="620.04" data-end="621.42">try to get rid of those and turn them</span> <span data-start="621.42" data-end="623.31">into plain old good old-fashioned</span> <span data-start="623.31" data-end="627.45">functions so we grabbed the body of the</span> <span data-start="627.45" data-end="629.339">arrow function expression if we find one</span> <span data-start="629.339" data-end="632.82">and if it's an expression function that</span> <span data-start="632.82" data-end="634.98">is it doesn't have a curly brace block</span> <span data-start="634.98" data-end="636.42">statement body with a return statement</span> <span data-start="636.42" data-end="638.329">in it we want to turn it into</span> <span data-start="638.329" data-end="642.1">one of those because expression</span> <span data-start="642.1" data-end="645.319">functions are not legal until we have</span> <span data-start="645.319" data-end="647.329">xmas cryptic so I guess that's a another</span> <span data-start="647.329" data-end="651.549">feature that we're supporting here and</span> <span data-start="651.549" data-end="654.529">then we want to create a new function</span> <span data-start="654.529" data-end="657.47">expression using all the same properties</span> <span data-start="657.47" data-end="658.999">as the arrow function expression</span> <span data-start="658.999" data-end="660.079">basically the only thing that's</span> <span data-start="660.079" data-end="662.569">different is the the type this function</span> <span data-start="662.569" data-end="664.67">expression now instead of arrow function</span> <span data-start="664.67" data-end="667.069">expression and then one of the</span> <span data-start="667.069" data-end="668.899">conveniences of arrow functions is that</span> <span data-start="668.899" data-end="672.29">they automatically bind to the value of</span> <span data-start="672.29" data-end="674.389">this in the enclosing environment so we</span> <span data-start="674.389" data-end="676.129">have to simulate that as well so we're</span> <span data-start="676.129" data-end="677.899">going to make a member expression out of</span> <span data-start="677.899" data-end="679.85">our function expression and the</span> <span data-start="679.85" data-end="682.1">identifier bind and call that as a</span> <span data-start="682.1" data-end="685.459">method passing this to it right and then</span> <span data-start="685.459" data-end="687.319">all that remains is to replace the</span> <span data-start="687.319" data-end="689.209">original arrow function expression with</span> <span data-start="689.209" data-end="693.35">this bound expression and then you call</span> <span data-start="693.35" data-end="695.6">recast I'd print with that same abstract</span> <span data-start="695.6" data-end="698.299">syntax tree grab the little code</span> <span data-start="698.299" data-end="700.189">property off of the object that it</span> <span data-start="700.189" data-end="703.459">returns and print that however you want</span> <span data-start="703.459" data-end="705.29">or write it to a file and it prints out</span> <span data-start="705.29" data-end="707.949">the thing that we were trying to create</span> <span data-start="707.949" data-end="711.679">cool so that's sort of a warm-up example</span> <span data-start="711.679" data-end="713.869">of transforming code at the abstract</span> <span data-start="713.869" data-end="717.259">syntax tree level and if you already</span> <span data-start="717.259" data-end="718.489">have a build stuff for static resources</span> <span data-start="718.489" data-end="722.149">you can have this newfound ability in a</span> <span data-start="722.149" data-end="723.799">matter of minutes if you use browserify</span> <span data-start="723.799" data-end="727.939">or some other static build pipeline so</span> <span data-start="727.939" data-end="732.049">what is this recast thing well I came up</span> <span data-start="732.049" data-end="734.239">with the name when I first wrote it I</span> <span data-start="734.239" data-end="735.949">thought it was clever because it</span> <span data-start="735.949" data-end="737.959">recursively traverses abstract syntax</span> <span data-start="737.959" data-end="743.299">trees so wreck AST sort of makes sense</span> <span data-start="743.299" data-end="745.699">at that level but it's also a word an</span> <span data-start="745.699" data-end="748.1">english verb which means to like melt</span> <span data-start="748.1" data-end="750.86">some metal down and reshape it or you</span> <span data-start="750.86" data-end="752.449">know arrange something again remodel</span> <span data-start="752.449" data-end="754.639">supply a theater work with a new cast</span> <span data-start="754.639" data-end="757.79">sort of thing so i also like to think it</span> <span data-start="757.79" data-end="761.689">has some poetry to it so how do you use</span> <span data-start="761.689" data-end="764.419">recast just to recap you require it you</span> <span data-start="764.419" data-end="766.16">call recast at parts on the source and</span> <span data-start="766.16" data-end="767.869">then you get to do literally anything</span> <span data-start="767.869" data-end="770.769">you want with the abstract syntax tree</span> <span data-start="770.769" data-end="771.92">recast</span> <span data-start="771.92" data-end="775.31">care it does bundle suggested traversal</span> <span data-start="775.31" data-end="777.5">tool but you really don't even have to</span> <span data-start="777.5" data-end="779.389">use that and I'm not even super thrilled</span> <span data-start="779.389" data-end="781.43">with it so I recommend you find anything</span> <span data-start="781.43" data-end="783.529">that works and then you call recast up</span> <span data-start="783.529" data-end="784.94">print with the modified abstract syntax</span> <span data-start="784.94" data-end="787.16">tree and you know do whatever you want</span> <span data-start="787.16" data-end="789.11">with the resulting string so that's</span> <span data-start="789.11" data-end="791.72">that's how it goes and what's magical</span> <span data-start="791.72" data-end="793.579">about this like you could just pretty</span> <span data-start="793.579" data-end="795.86">print the result and that would give you</span> <span data-start="795.86" data-end="798.199">working code you'd be able to use Eknath</span> <span data-start="798.199" data-end="800.18">script six today which is part of the</span> <span data-start="800.18" data-end="801.68">promise here but there's another</span> <span data-start="801.68" data-end="803.3">property of recast that's pretty cool</span> <span data-start="803.3" data-end="806.779">that's I think best described as</span> <span data-start="806.779" data-end="808.3">non-destructive partial source</span> <span data-start="808.3" data-end="811.31">transformation so it will try to use</span> <span data-start="811.31" data-end="814.519">reuse original source code for parts of</span> <span data-start="814.519" data-end="817.91">the tree that you didn't modify which is</span> <span data-start="817.91" data-end="820.519">cool both because it lets you write</span> <span data-start="820.519" data-end="822.139">transforms and then generate human</span> <span data-start="822.139" data-end="824.089">readable diffs and I've done this to</span> <span data-start="824.089" data-end="826.76">great success in my job at Facebook and</span> <span data-start="826.76" data-end="831.35">because since the printer knows where</span> <span data-start="831.35" data-end="833.029">those original fragments of source code</span> <span data-start="833.029" data-end="835.149">are coming from can actually give you</span> <span data-start="835.149" data-end="838.31">really good source maps for free totally</span> <span data-start="838.31" data-end="840.44">automatically for any arbitrary abstract</span> <span data-start="840.44" data-end="842">syntax tree transform you might want to</span> <span data-start="842" data-end="844.61">write so if you like source maps that</span> <span data-start="844.61" data-end="847.04">might be pretty appealing so this</span> <span data-start="847.04" data-end="849.74">presents a moral hazard of sorts you can</span> <span data-start="849.74" data-end="851">start writing scripts that you know</span> <span data-start="851" data-end="852.35">rearrange the furniture in your code</span> <span data-start="852.35" data-end="857.209">base ad nauseam and appear to be you</span> <span data-start="857.209" data-end="858.62">know the most productive program or</span> <span data-start="858.62" data-end="860.75">anyone has ever seen and the laziest at</span> <span data-start="860.75" data-end="865.25">the same time or you can in the Gandhian</span> <span data-start="865.25" data-end="866.81">sense be the change you want to see in</span> <span data-start="866.81" data-end="869.81">the world and I my confession is that I</span> <span data-start="869.81" data-end="871.79">gave in to that temptation the first</span> <span data-start="871.79" data-end="876.199">temptation for a time there was a couple</span> <span data-start="876.199" data-end="879.019">of weeks or months at work where I had</span> <span data-start="879.019" data-end="881.12">written a script that would translate a</span> <span data-start="881.12" data-end="883.37">lot of old idioms for defining classes</span> <span data-start="883.37" data-end="885.47">in JavaScript in our code base to the</span> <span data-start="885.47" data-end="888.11">new ekman script six class syntax and I</span> <span data-start="888.11" data-end="889.19">was just running it over tens of</span> <span data-start="889.19" data-end="890.93">thousands of files coming in in the</span> <span data-start="890.93" data-end="892.37">morning and like you know spending five</span> <span data-start="892.37" data-end="894.11">minutes or so doing that and then like</span> <span data-start="894.11" data-end="896.72">waiting for humans to review those gifts</span> <span data-start="896.72" data-end="899.36">and it's remarkable both the people to</span> <span data-start="899.36" data-end="901.01">review them and that in a lot of cases</span> <span data-start="901.01" data-end="902.36">they didn't realize that this had</span> <span data-start="902.36" data-end="904.29">actually been generated by a script</span> <span data-start="904.29" data-end="908.37">the beauty of recast and all told I only</span> <span data-start="908.37" data-end="910.339">converted sixteen hundred or so files</span> <span data-start="910.339" data-end="912.709">for like a combined hundred fifty</span> <span data-start="912.709" data-end="915.12">thousand insertions and deletions worth</span> <span data-start="915.12" data-end="917.759">of diff and I guess you can tell from</span> <span data-start="917.759" data-end="920.959">this we have about one class per file so</span> <span data-start="920.959" data-end="924.209">1658 classes the cool thing is that we</span> <span data-start="924.209" data-end="928.11">now have 3,500 almost 3,600 classes in</span> <span data-start="928.11" data-end="930.6">the code base today and you know you</span> <span data-start="930.6" data-end="932.699">know that those extra classes got</span> <span data-start="932.699" data-end="934.259">written by people who just looked around</span> <span data-start="934.259" data-end="936.089">at the code base that had been sort of</span> <span data-start="936.089" data-end="938.399">boot strapped into the new style and</span> <span data-start="938.399" data-end="940.649">they did what they found everywhere else</span> <span data-start="940.649" data-end="942.449">they mimicked the style as you should do</span> <span data-start="942.449" data-end="944.37">in any large code base so that's the</span> <span data-start="944.37" data-end="946.35">real value of this kind of automatic</span> <span data-start="946.35" data-end="949.829">source transformation if you get nothing</span> <span data-start="949.829" data-end="952.139">outside of this talk there's a cool unix</span> <span data-start="952.139" data-end="953.73">tool called parallel that lets you write</span> <span data-start="953.73" data-end="955.949">really simple as you know</span> <span data-start="955.949" data-end="957.93">single-threaded scripts that take one</span> <span data-start="957.93" data-end="960.149">argument and then run a whole bunch of</span> <span data-start="960.149" data-end="962.04">copies of them appropriate for you know</span> <span data-start="962.04" data-end="963.87">the number of cores I've 32 cores and I</span> <span data-start="963.87" data-end="966.75">my def machine at facebook so i was able</span> <span data-start="966.75" data-end="969.269">to do something like 230 sort of</span> <span data-start="969.269" data-end="971.16">subjected seconds worth of work in 12</span> <span data-start="971.16" data-end="974.55">seconds so that's cool i give a whole</span> <span data-start="974.55" data-end="976.829">talk actually about this project a</span> <span data-start="976.829" data-end="979.35">couple of months ago so these these</span> <span data-start="979.35" data-end="983.25">links will take you there ok so what</span> <span data-start="983.25" data-end="985.829">about something little trickier as</span> <span data-start="985.829" data-end="988.019">promised we are going to talk about</span> <span data-start="988.019" data-end="990.959">generator functions so here's an example</span> <span data-start="990.959" data-end="994.17">of a generator function and I apologize</span> <span data-start="994.17" data-end="997.23">that it's not like Fibonacci or</span> <span data-start="997.23" data-end="999">something like that it's a little bit</span> <span data-start="999" data-end="1000.769">more sophisticated this had all of the</span> <span data-start="1000.769" data-end="1002.24">things that I wanted to talk about in it</span> <span data-start="1002.24" data-end="1004.01">so that's why I chose this function for</span> <span data-start="1004.01" data-end="1006.319">printing out the or rather yielding each</span> <span data-start="1006.319" data-end="1009.98">of the permutations of a given list so I</span> <span data-start="1009.98" data-end="1012.05">did look this out to remind myself how</span> <span data-start="1012.05" data-end="1015.829">to do this ah so the way it works is if</span> <span data-start="1015.829" data-end="1018.47">the list is just 1 or 0 elements that's</span> <span data-start="1018.47" data-end="1021.74">the only permutation of the list so you</span> <span data-start="1021.74" data-end="1024.77">yield that otherwise you take the list</span> <span data-start="1024.77" data-end="1026.54">consisting of just the first element in</span> <span data-start="1026.54" data-end="1029.059">the list and then you take all the</span> <span data-start="1029.059" data-end="1032.47">permutations of the rest of the list and</span> <span data-start="1032.47" data-end="1035.78">for each of those child permutations you</span> <span data-start="1035.78" data-end="1038.209">sort of walk the first element</span> <span data-start="1038.209" data-end="1042.47">it at each place so you you know none of</span> <span data-start="1042.47" data-end="1044.059">those permutations contain that element</span> <span data-start="1044.059" data-end="1045.98">but then you put it back in at each</span> <span data-start="1045.98" data-end="1048.559">possible place and so when you yield</span> <span data-start="1048.559" data-end="1050.33">each of those things you're yielding all</span> <span data-start="1050.33" data-end="1052.33">the possible permutations of the list</span> <span data-start="1052.33" data-end="1055.73">and here's an example of how you might</span> <span data-start="1055.73" data-end="1061.01">use it with the list 132 and get some</span> <span data-start="1061.01" data-end="1073.97">water so if you're used to generator</span> <span data-start="1073.97" data-end="1076.1">functions in Python you may not be used</span> <span data-start="1076.1" data-end="1078.5">to the next method of the generator</span> <span data-start="1078.5" data-end="1080.779">object returning little object that has</span> <span data-start="1080.779" data-end="1082.58">a value field and a done field but</span> <span data-start="1082.58" data-end="1085.309">that's the API that we've decided on for</span> </p>
<p><span data-start="1085.309" data-end="1087.799">Agnes crypt 6 so in each of those cases</span> <span data-start="1087.799" data-end="1090.039">the value is one of the permutations and</span> <span data-start="1090.039" data-end="1092.149">done would be false but then at the very</span> <span data-start="1092.149" data-end="1094.37">end done is true and the value is</span> <span data-start="1094.37" data-end="1097.37">so that's that's what that's</span> <span data-start="1097.37" data-end="1100.159">about there's also another syntax for a</span> <span data-start="1100.159" data-end="1102.669">prettier syntax for iterating over the</span> <span data-start="1102.669" data-end="1105.529">values of a generator the four of loop</span> <span data-start="1105.529" data-end="1108.14">so it's easy to confuse this with 4n but</span> <span data-start="1108.14" data-end="1110.21">iterates over the values of its argument</span> <span data-start="1110.21" data-end="1119.59">instead of the keys</span> <span data-start="1119.6" data-end="1121.98">so how hard could it be to translate</span> <span data-start="1121.98" data-end="1124.35">this futuristic syntax into something</span> <span data-start="1124.35" data-end="1127.71">that runs in a browser today well this</span> <span data-start="1127.71" data-end="1131.79">was like May of 2013 I thought it was</span> <span data-start="1131.79" data-end="1134.76">funny to tweet cryptically about having</span> <span data-start="1134.76" data-end="1137.13">almost finished my life's work and boy</span> <span data-start="1137.13" data-end="1138.69">was that hubris because I wasn't</span> <span data-start="1138.69" data-end="1140.94">anywhere close to being done the project</span> <span data-start="1140.94" data-end="1142.44">was actually called degenerate at that</span> <span data-start="1142.44" data-end="1144.87">point sort of self-deprecating is my</span> <span data-start="1144.87" data-end="1147.809">style i guess and i was i was so far</span> <span data-start="1147.809" data-end="1150.929">away from being anywhere on top of this</span> <span data-start="1150.929" data-end="1152.97">project that i'm glad i didn't actually</span> <span data-start="1152.97" data-end="1155.07">identify in this tweet what what i was</span> <span data-start="1155.07" data-end="1157.559">talking about it's basically the</span> <span data-start="1157.559" data-end="1160.14">trickiest code I've ever written which</span> <span data-start="1160.14" data-end="1161.7">may say more about me than the code</span> <span data-start="1161.7" data-end="1163.77">itself but I also think it's bad as</span> <span data-start="1163.77" data-end="1168">tricky as translation or source</span> <span data-start="1168" data-end="1170.79">transformation gets so if you absorb any</span> <span data-start="1170.79" data-end="1173.549">of this then that's great you've</span> <span data-start="1173.549" data-end="1178.04">absorbed you know something that is</span> <span data-start="1178.04" data-end="1180.24">probably the best example of a really</span> <span data-start="1180.24" data-end="1183.12">nasty source to source transformation</span> <span data-start="1183.12" data-end="1185.99">and you can do anything at that point</span> <span data-start="1185.99" data-end="1189.59">okay so here's our original function and</span> <span data-start="1189.59" data-end="1192.33">what's the first step well it's going to</span> <span data-start="1192.33" data-end="1196.23">turn out to be convenient if we take all</span> <span data-start="1196.23" data-end="1198.059">of the variable declarations from inside</span> <span data-start="1198.059" data-end="1200.04">of this function and waste them to the</span> <span data-start="1200.04" data-end="1201.24">the top of the function which is</span> <span data-start="1201.24" data-end="1203.58">something that JavaScript does anyway so</span> <span data-start="1203.58" data-end="1207.87">first PSP and i are now declared at the</span> <span data-start="1207.87" data-end="1209.19">first line of the function and wherever</span> <span data-start="1209.19" data-end="1212.07">they used to be variable declarations</span> <span data-start="1212.07" data-end="1213.6">those are just assignment statements</span> <span data-start="1213.6" data-end="1215.76">right so why do we do that why does that</span> <span data-start="1215.76" data-end="1216.78">matter that doesn't actually change</span> <span data-start="1216.78" data-end="1220.559">anything yet well then introduce a</span> <span data-start="1220.559" data-end="1222.299">couple more variables some temporary</span> <span data-start="1222.299" data-end="1227.34">variables and a loop variable I yeah</span> <span data-start="1227.34" data-end="1230.16">okay the reason for that t0 and t1 is</span> <span data-start="1230.16" data-end="1231.48">that we're going to turn the four of</span> <span data-start="1231.48" data-end="1233.549">loop just into a while loop so that we</span> <span data-start="1233.549" data-end="1234.87">can treat it the same way as any other</span> <span data-start="1234.87" data-end="1238.59">while loop so if you if you see 4p of PS</span> <span data-start="1238.59" data-end="1240.99">it's now going to change into this call</span> <span data-start="1240.99" data-end="1243.48">to the values function of our little</span> <span data-start="1243.48" data-end="1246.6">runtime object wrap generator and then</span> <span data-start="1246.6" data-end="1248.61">just going to iterate over that</span> <span data-start="1248.61" data-end="1250.89">generator calling next until it's done</span> <span data-start="1250.89" data-end="1251.71">and each</span> <span data-start="1251.71" data-end="1253.87">time it will assign the value to the</span> <span data-start="1253.87" data-end="1255.85">loop variable P so now we've got a plain</span> <span data-start="1255.85" data-end="1257.71">old while lib don't have to care about</span> <span data-start="1257.71" data-end="1260.83">four of loops anymore okay so still</span> <span data-start="1260.83" data-end="1262.24">haven't really changed anything still</span> <span data-start="1262.24" data-end="1264.85">have yield expressions and it's still a</span> <span data-start="1264.85" data-end="1267.61">generator but now we're going to return</span> <span data-start="1267.61" data-end="1270.669">a an anonymous generator that doesn't</span> <span data-start="1270.669" data-end="1272.409">take any arguments it's just a closure</span> <span data-start="1272.409" data-end="1274.6">that has all of those variables in its</span> <span data-start="1274.6" data-end="1277.69">scope and so now now we're beginning to</span> <span data-start="1277.69" data-end="1280.929">get somewhere and so this is a big leap</span> <span data-start="1280.929" data-end="1283.6">but we need to turn the body of this</span> <span data-start="1283.6" data-end="1285.19">function into something that can execute</span> <span data-start="1285.19" data-end="1288.61">in JavaScript of today and my idea for</span> <span data-start="1288.61" data-end="1291.58">how to do that is to have a switch</span> <span data-start="1291.58" data-end="1294.149">statement inside of a wild true loop</span> <span data-start="1294.149" data-end="1296.679">where the cases of the switch statement</span> <span data-start="1296.679" data-end="1299.73">are jump targets that we can sort of</span> <span data-start="1299.73" data-end="1302.59">jump to as if we had a go-to statement</span> <span data-start="1302.59" data-end="1304.21">in JavaScript which sounds like the</span> <span data-start="1304.21" data-end="1305.47">worst thing in the world but ends up</span> <span data-start="1305.47" data-end="1308.77">being pretty cool so the first one is</span> <span data-start="1308.77" data-end="1310.899">case zero as you might imagine and this</span> <span data-start="1310.899" data-end="1312.7">is going to test to see what the length</span> <span data-start="1312.7" data-end="1314.37">of the list is if it's less than two</span> <span data-start="1314.37" data-end="1318.159">we're going to jump to case five and we</span> <span data-start="1318.159" data-end="1320.11">do that by setting contacts next to five</span> <span data-start="1320.11" data-end="1321.64">and then breaking which you'll note</span> <span data-start="1321.64" data-end="1323.32">breaks out of the switch statement but</span> <span data-start="1323.32" data-end="1325.299">not the while loop so we loop back</span> <span data-start="1325.299" data-end="1327.22">around for another iteration context</span> <span data-start="1327.22" data-end="1333.82">next is five and then case five will</span> <span data-start="1333.82" data-end="1337.39">come later you may remember in this case</span> <span data-start="1337.39" data-end="1339.27">that we wanted to yield the list itself</span> <span data-start="1339.27" data-end="1341.98">so the way we do that is by returning</span> <span data-start="1341.98" data-end="1343.87">the list so that's the answer to what</span> <span data-start="1343.87" data-end="1345.399">happens to the yield expression it</span> <span data-start="1345.399" data-end="1348.49">becomes a return statement but we want</span> <span data-start="1348.49" data-end="1350.62">to know where to come back to after we</span> <span data-start="1350.62" data-end="1352.779">call back into the the generator next</span> <span data-start="1352.779" data-end="1354.909">function so we've set context I next two</span> <span data-start="1354.909" data-end="1356.26">three in this case which is the next</span> <span data-start="1356.26" data-end="1359.799">case and if you remember in that case</span> <span data-start="1359.799" data-end="1361.63">after we yield that one value of the</span> <span data-start="1361.63" data-end="1363.549">list we're done so we're going to jump</span> <span data-start="1363.549" data-end="1365.679">all the way to the end which happens to</span> <span data-start="1365.679" data-end="1369.13">be a case 19 as you can see over there</span> <span data-start="1369.13" data-end="1371.77">on the side which is called context stop</span> <span data-start="1371.77" data-end="1374.2">shuts everything down and freeze some</span> <span data-start="1374.2" data-end="1378.309">memory and so that's the like you know</span> <span data-start="1378.309" data-end="1382.539">abort abort case but in case the length</span> <span data-start="1382.539" data-end="1384.909">was not less than 2 then we were going</span> <span data-start="1384.909" data-end="1385.42">to jump to</span> <span data-start="1385.42" data-end="1388.72">the fifth case and here it is this is</span> <span data-start="1388.72" data-end="1392.92">where we call where we get the first</span> <span data-start="1392.92" data-end="1394.78">element as a list and then the rest of</span> <span data-start="1394.78" data-end="1397.12">the permutations and the values of those</span> <span data-start="1397.12" data-end="1399.69">that permutations object and we</span> <span data-start="1399.69" data-end="1401.74">deliberately fall through which is</span> <span data-start="1401.74" data-end="1402.91">another thing you should probably never</span> <span data-start="1402.91" data-end="1404.35">do when you're writing a real switch</span> <span data-start="1404.35" data-end="1405.55">statement but in this case it is</span> <span data-start="1405.55" data-end="1407.97">intentional that we fall through to case</span> <span data-start="1407.97" data-end="1410.05">8k say it exists just so that we can</span> <span data-start="1410.05" data-end="1414.94">jump back to it by the way and then if</span> <span data-start="1414.94" data-end="1418.36">we are if we are done with the generator</span> <span data-start="1418.36" data-end="1420.19">we're going to jump to a case 19 which</span> <span data-start="1420.19" data-end="1422.74">is the the final case otherwise we're</span> <span data-start="1422.74" data-end="1424.54">going to set the loop variable to the</span> <span data-start="1424.54" data-end="1428.38">value of the most recent thing that was</span> <span data-start="1428.38" data-end="1430.17">returned by the generator next method</span> <span data-start="1430.17" data-end="1433.84">and now here's our sort of obliterated</span> <span data-start="1433.84" data-end="1437.02">vassar rated for loop or setting I the</span> <span data-start="1437.02" data-end="1439.93">loop index variable 20 and the loop head</span> <span data-start="1439.93" data-end="1443.19">location is this case 11 and while the</span> <span data-start="1443.19" data-end="1445.57">while I is less than list of length</span> <span data-start="1445.57" data-end="1452.29">we're going to jump to 17 or in case it</span> <span data-start="1452.29" data-end="1453.91">is not less than length we jump to 17</span> <span data-start="1453.91" data-end="1458.05">otherwise we plan on jump in back to 14</span> <span data-start="1458.05" data-end="1460.72">after we yield this expression and I</span> <span data-start="1460.72" data-end="1462.73">think this is a good illustration of</span> <span data-start="1462.73" data-end="1466.27">what's cool about recast so this these</span> <span data-start="1466.27" data-end="1468.1">comments here this like practice that</span> <span data-start="1468.1" data-end="1470.86">people have some people of lining their</span> <span data-start="1470.86" data-end="1472.33">comments up vertically especially when</span> <span data-start="1472.33" data-end="1473.89">all the words are the same link finishes</span> <span data-start="1473.89" data-end="1477.48">so visually pleasing that's that's very</span> <span data-start="1477.48" data-end="1480.28">idiomatic it's very hard to capture in</span> <span data-start="1480.28" data-end="1482.95">code to identify the intent of that</span> <span data-start="1482.95" data-end="1485.05">formatting and try to like recreate it</span> <span data-start="1485.05" data-end="1488.38">later if you're pretty printing so the</span> <span data-start="1488.38" data-end="1489.76">fact that recast is able to just take</span> <span data-start="1489.76" data-end="1491.77">that whole rate up prototype duck and</span> <span data-start="1491.77" data-end="1495.4">cat dot call blah expression and just</span> <span data-start="1495.4" data-end="1498.4">copy it over to the output and you'll</span> <span data-start="1498.4" data-end="1500.8">notice it's actually indented it by two</span> <span data-start="1500.8" data-end="1504.16">spaces means that in large part the</span> <span data-start="1504.16" data-end="1505.54">parts of the the tree that you haven't</span> <span data-start="1505.54" data-end="1507.55">touched just carry over all of their</span> <span data-start="1507.55" data-end="1509.23">idiomatic formatting and you don't have</span> <span data-start="1509.23" data-end="1511.84">to apologize for that when you submit a</span> <span data-start="1511.84" data-end="1515.56">diff for humans to review ok so we're</span> <span data-start="1515.56" data-end="1517.9">yielding that permutation which is</span> <span data-start="1517.9" data-end="1520.12">concatenation of a prefix and the first</span> <span data-start="1520.12" data-end="1523.81">element and a suffix and then coming</span> <span data-start="1523.81" data-end="1526.09">back to case 14 the next time we call in</span> <span data-start="1526.09" data-end="1528.37">to the generator and this is the update</span> <span data-start="1528.37" data-end="1530.05">case of that for loop so we're</span> <span data-start="1530.05" data-end="1531.61">incrementing the loop variable and then</span> <span data-start="1531.61" data-end="1534.55">jumping back to case 11 which was which</span> <span data-start="1534.55" data-end="1536.77">was the head of that loop where we test</span> <span data-start="1536.77" data-end="1539.11">the length and eventually I is not going</span> <span data-start="1539.11" data-end="1541.15">to be less than the length anymore and</span> <span data-start="1541.15" data-end="1544.3">so we're going to get jumped to the the</span> <span data-start="1544.3" data-end="1548.86">case 17 here and where is that taking us</span> <span data-start="1548.86" data-end="1551.26">let's see Oh remember we were inside of</span> <span data-start="1551.26" data-end="1553.45">a while loop so we need to jump back to</span> <span data-start="1553.45" data-end="1555.34">the head of that while loop and then</span> <span data-start="1555.34" data-end="1557.62">continue testing the result of the</span> <span data-start="1557.62" data-end="1560.29">generator to see if we're done finally</span> <span data-start="1560.29" data-end="1562.54">there are a lot of permutations of even</span> <span data-start="1562.54" data-end="1565.09">small lists so you can see how this ends</span> <span data-start="1565.09" data-end="1566.92">up generating a lot of them but that's</span> <span data-start="1566.92" data-end="1569.62">it that's java script that runs in a</span> <span data-start="1569.62" data-end="1573.49">browser today with one exception I still</span> <span data-start="1573.49" data-end="1574.9">haven't explained where this context</span> <span data-start="1574.9" data-end="1576.61">object comes from and I'm going to sort</span> <span data-start="1576.61" data-end="1579.13">of wave my hands here but we're going to</span> <span data-start="1579.13" data-end="1581.08">pass the whole anonymous function to</span> <span data-start="1581.08" data-end="1584.32">this wrap generator runtime function and</span> <span data-start="1584.32" data-end="1585.97">that will return the generator object</span> <span data-start="1585.97" data-end="1589.12">that has the next method and also make</span> <span data-start="1589.12" data-end="1590.95">sure that the context gets passed in in</span> <span data-start="1590.95" data-end="1595.21">each case okay so if you stuck with me</span> <span data-start="1595.21" data-end="1597.31">through that then you understand how</span> <span data-start="1597.31" data-end="1605.14">regenerator works yeah well that's a</span> <span data-start="1605.14" data-end="1612.31">good question yeah yeah I if I could</span> <span data-start="1612.31" data-end="1615.61">make it prettier I certainly would but I</span> <span data-start="1615.61" data-end="1617.92">will say this is a function that has</span> <span data-start="1617.92" data-end="1619.75">like multiple yields in it and loops and</span> <span data-start="1619.75" data-end="1621.49">everything so it's like a good example</span> <span data-start="1621.49" data-end="1623.77">in a fairly compact space of like all</span> <span data-start="1623.77" data-end="1625.27">the features of a generator which is</span> <span data-start="1625.27" data-end="1627.34">contributing in part to it looking</span> <span data-start="1627.34" data-end="1629.89">pretty messy but you could imagine</span> <span data-start="1629.89" data-end="1632.56">stepping through this and debugging the</span> <span data-start="1632.56" data-end="1635.49">code with a little bit of context I hope</span> <span data-start="1635.49" data-end="1639.929">maybe that's wishful thinking all right</span> <span data-start="1639.929" data-end="1642.779">so that's all well and good you can</span> <span data-start="1642.779" data-end="1644.309">convince yourself if you stare that</span> <span data-start="1644.309" data-end="1645.659">could long enough that it kind of does</span> <span data-start="1645.659" data-end="1647.759">what it's supposed to do generate some</span> <span data-start="1647.759" data-end="1652.009">permutations but how in the world do you</span> <span data-start="1652.009" data-end="1654.45">programmatically generate code like that</span> <span data-start="1654.45" data-end="1658.169">from ECMO script six so i'll show you</span> <span data-start="1658.169" data-end="1661.679">how a for statement which is you know</span> <span data-start="1661.679" data-end="1664.23">the normal like three part for statement</span> <span data-start="1664.23" data-end="1665.94">rather than a for n if we rub statement</span> <span data-start="1665.94" data-end="1669.419">gets code generated alright so this is</span> <span data-start="1669.419" data-end="1673.139">an actual case from the emitter code for</span> <span data-start="1673.139" data-end="1675.24">a generator so when we encounter</span> <span data-start="1675.24" data-end="1678.36">something of type for statement we first</span> <span data-start="1678.36" data-end="1682.23">create a series of locations and these</span> <span data-start="1682.23" data-end="1687.179">are sort of like uninitialized literal</span> <span data-start="1687.179" data-end="1689.759">numeric values that are going to end up</span> <span data-start="1689.759" data-end="1694.35">becoming jump targets and case labels in</span> <span data-start="1694.35" data-end="1697.289">that switch statement and so if the for</span> <span data-start="1697.289" data-end="1699.899">statement does have an in a net part the</span> <span data-start="1699.899" data-end="1701.759">like variable declaration thing we're</span> <span data-start="1701.759" data-end="1704.039">going to explode that which is my sort</span> <span data-start="1704.039" data-end="1707.429">of made-up terminology for turning it</span> <span data-start="1707.429" data-end="1709.47">into like a state machine if it contains</span> <span data-start="1709.47" data-end="1713.369">any yields and then we're going to mark</span> <span data-start="1713.369" data-end="1716.429">the head to say you know now we're at a</span> <span data-start="1716.429" data-end="1718.35">place where we would want to jump back</span> <span data-start="1718.35" data-end="1720.059">to if we were doing another iteration of</span> <span data-start="1720.059" data-end="1723.269">the loop if there's a test in the for</span> <span data-start="1723.269" data-end="1724.919">statement and it doesn't have to be a</span> <span data-start="1724.919" data-end="1729.029">test then if the test is false we jump</span> <span data-start="1729.029" data-end="1731.999">to the after location and note that we</span> <span data-start="1731.999" data-end="1733.409">don't even really know where the after</span> <span data-start="1733.409" data-end="1735.84">location is yet but it's still fine to</span> <span data-start="1735.84" data-end="1737.789">plan on jumping there when we do know</span> <span data-start="1737.789" data-end="1741.149">and then because this is a loop we want</span> <span data-start="1741.149" data-end="1742.619">to keep track of what loops were inside</span> <span data-start="1742.619" data-end="1744.509">in case we come across a break or a</span> <span data-start="1744.509" data-end="1746.49">continue or return that we need to</span> <span data-start="1746.49" data-end="1748.499">interpret in that context so there's</span> <span data-start="1748.499" data-end="1753.69">this leap manager leap is my made-up</span> <span data-start="1753.69" data-end="1755.879">term for a break or continue or a yield</span> <span data-start="1755.879" data-end="1758.85">or a throw that knows how to deal with</span> <span data-start="1758.85" data-end="1761.279">those things and there's we're putting a</span> <span data-start="1761.279" data-end="1764.179">new loop entry onto that stack and then</span> <span data-start="1764.179" data-end="1768.62">exploding the the body of the loop</span> <span data-start="1768.63" data-end="1772.65">and now after the body we are going to</span> <span data-start="1772.65" data-end="1775.05">omit the code for the update part of the</span> <span data-start="1775.05" data-end="1777.42">for statement and so we need to mark</span> <span data-start="1777.42" data-end="1779.88">that so we can jump to it if there is an</span> <span data-start="1779.88" data-end="1781.11">update part I guess I might have been</span> <span data-start="1781.11" data-end="1783.45">able to avoid marking it if there wasn't</span> <span data-start="1783.45" data-end="1786.69">but I did then we generate code for that</span> <span data-start="1786.69" data-end="1790.26">and we met some code that jumps back to</span> <span data-start="1790.26" data-end="1792.36">the head of the loop so we're going to</span> <span data-start="1792.36" data-end="1795.36">go right back to the test part and then</span> <span data-start="1795.36" data-end="1798.03">mark the after part and so now we've</span> <span data-start="1798.03" data-end="1799.53">marked all of our locations they have</span> <span data-start="1799.53" data-end="1803.57">actual numeric values and can be used in</span> <span data-start="1803.57" data-end="1806.76">the code that generated and now we're</span> <span data-start="1806.76" data-end="1809.37">done so we break out of this case we've</span> <span data-start="1809.37" data-end="1812.1">successfully emitted code for a for</span> <span data-start="1812.1" data-end="1818.25">statement so how does look work it's</span> <span data-start="1818.25" data-end="1819.96">actually dead simple simplest thing in</span> <span data-start="1819.96" data-end="1823.47">the talk it returns a literal abstract</span> <span data-start="1823.47" data-end="1826.32">syntax tree node object initialized to</span> <span data-start="1826.32" data-end="1828.21">negative one just as a sentinel for this</span> <span data-start="1828.21" data-end="1832.5">is not good yet and then when we mark it</span> <span data-start="1832.5" data-end="1834.69">we're keeping this listing of all of the</span> <span data-start="1834.69" data-end="1836.85">statements that we've emitted so far so</span> <span data-start="1836.85" data-end="1838.71">we know what the next one what the the</span> <span data-start="1838.71" data-end="1840.57">location of the next one is going to be</span> <span data-start="1840.57" data-end="1843.42">so mark assigns that location to</span> <span data-start="1843.42" data-end="1848.85">whatever literal node you pass into it</span> <span data-start="1848.85" data-end="1851.22">and goes I haven't initializes it and</span> <span data-start="1851.22" data-end="1852.6">had some assertions about it not being</span> <span data-start="1852.6" data-end="1855.96">already initialized and so forth so once</span> <span data-start="1855.96" data-end="1857.25">we've marked something we know that</span> <span data-start="1857.25" data-end="1859.44">we're going to emit a case statement in</span> <span data-start="1859.44" data-end="1862.08">the in the switch statement eventually</span> <span data-start="1862.08" data-end="1866.91">all right so b dot literal and in that</span> <span data-start="1866.91" data-end="1868.95">literal maybe a little confusing those</span> <span data-start="1868.95" data-end="1871.62">are actually provided by recast if if</span> <span data-start="1871.62" data-end="1873.9">you recall you could say require recast</span> <span data-start="1873.9" data-end="1875.94">at types that builders that literal and</span> <span data-start="1875.94" data-end="1879.23">require recast at types that named types</span> <span data-start="1879.23" data-end="1882.409">cool</span> <span data-start="1882.419" data-end="1884.609">right so this is an example about how</span> <span data-start="1884.609" data-end="1888.119">that jump if not thing works and it's</span> <span data-start="1888.119" data-end="1890.429">pretty straightforward but I'm not going</span> <span data-start="1890.429" data-end="1893.519">to spend time on it right now basically</span> <span data-start="1893.519" data-end="1895.409">you do some assertions and you try to</span> <span data-start="1895.409" data-end="1898.859">avoid having double negation if possible</span> <span data-start="1898.859" data-end="1900.359">just because that was a problem that I</span> <span data-start="1900.359" data-end="1902.369">could fix and it makes the code nicer</span> <span data-start="1902.369" data-end="1906.049">and then you emit an if statement that</span> <span data-start="1906.049" data-end="1909.629">sets the context next property to the</span> <span data-start="1909.629" data-end="1910.739">next location that you want to jump to</span> <span data-start="1910.739" data-end="1915.23">and also admit a break statement so I</span> <span data-start="1915.23" data-end="1917.82">know I race through that but I think it</span> <span data-start="1917.82" data-end="1919.23">will be self-explanatory if you were to</span> <span data-start="1919.23" data-end="1922.109">go back and look at it all right so</span> <span data-start="1922.109" data-end="1927.21">explode statement is the last of the</span> <span data-start="1927.21" data-end="1929.22">sort of drill down examples that I want</span> <span data-start="1929.22" data-end="1931.71">to talk about I don't think I actually</span> <span data-start="1931.71" data-end="1934.139">have time to go through it but the</span> <span data-start="1934.139" data-end="1939.059">interesting part about it is that recast</span> <span data-start="1939.059" data-end="1941.879">or sorry regenerator understands whether</span> <span data-start="1941.879" data-end="1944.789">a statement or an expression contains</span> <span data-start="1944.789" data-end="1946.859">any yield expressions or any problematic</span> <span data-start="1946.859" data-end="1950.489">breaks or continues and if it doesn't if</span> <span data-start="1950.489" data-end="1952.529">it doesn't in my terminology contain</span> <span data-start="1952.529" data-end="1955.739">leap then we can just omit the statement</span> <span data-start="1955.739" data-end="1958.049">as it was so a large part of the</span> <span data-start="1958.049" data-end="1960.989">performance promises of regenerator are</span> <span data-start="1960.989" data-end="1962.73">that if you're not using yield in a</span> <span data-start="1962.73" data-end="1964.859">certain part of your code it just is</span> <span data-start="1964.859" data-end="1969.149">left untouched you could imagine you</span> <span data-start="1969.149" data-end="1970.859">know exploding everything out into a big</span> <span data-start="1970.859" data-end="1972.359">state machine that is much longer than</span> <span data-start="1972.359" data-end="1974.909">your original code and that would be you</span> <span data-start="1974.909" data-end="1978.59">know perhaps logically correct but not</span> <span data-start="1978.59" data-end="1982.429">performant or very easily compressible</span> <span data-start="1982.429" data-end="1985.379">okay another exciting part is what</span> <span data-start="1985.379" data-end="1986.999">happens if an exception gets thrown in</span> <span data-start="1986.999" data-end="1989.009">the middle of the state machine and the</span> <span data-start="1989.009" data-end="1990.84">secret to that is remembering where you</span> <span data-start="1990.84" data-end="1993.57">last knew that you were and having a</span> <span data-start="1993.57" data-end="1996.809">little map that can be inspected to</span> <span data-start="1996.809" data-end="2000.049">figure out what try statement or catch</span> <span data-start="2000.049" data-end="2002.09">block or finally block you're inside of</span> <span data-start="2002.09" data-end="2006.83">and sort of twiddles context next and</span> <span data-start="2006.83" data-end="2009.44">then calls back into the generator and</span> <span data-start="2009.44" data-end="2012.95">so you appear to resume at the the place</span> <span data-start="2012.95" data-end="2015.71">where you expected to for instance you</span> <span data-start="2015.71" data-end="2017.679">an exception is thrown by this block</span> <span data-start="2017.679" data-end="2020.779">you'll resume in the code that was</span> <span data-start="2020.779" data-end="2023.96">emitted for the catch block so this</span> <span data-start="2023.96" data-end="2026.059">whole example actually works and ends up</span> <span data-start="2026.059" data-end="2029.36">being surprisingly short and I'll I'll</span> <span data-start="2029.36" data-end="2032.299">leave that for free to go through if you</span> <span data-start="2032.299" data-end="2036.01">are so inclined and then here's the</span> <span data-start="2036.01" data-end="2038.63">runtime code that supports all of that</span> <span data-start="2038.63" data-end="2040.22">and the interesting thing about this is</span> <span data-start="2040.22" data-end="2042.35">that it's invoking this in the very</span> <span data-start="2042.35" data-end="2044.09">middle the inner function that's the</span> <span data-start="2044.09" data-end="2045.14">function with the switch statement</span> <span data-start="2045.14" data-end="2047.63">inside of it that we've been talking</span> <span data-start="2047.63" data-end="2049.97">about so far and so that's where you see</span> <span data-start="2049.97" data-end="2052.609">it's passed in the context and we get</span> <span data-start="2052.609" data-end="2055.19">the value back out if everything is ok</span> <span data-start="2055.19" data-end="2058.399">we return the object with value and done</span> <span data-start="2058.399" data-end="2060.8">properties if there's an exception then</span> <span data-start="2060.8" data-end="2063.74">we call context dispatch exception with</span> <span data-start="2063.74" data-end="2065.72">that exception value and that's what</span> <span data-start="2065.72" data-end="2067.97">sets everything up for control to resume</span> <span data-start="2067.97" data-end="2073.28">in the exceptional control path all</span> <span data-start="2073.28" data-end="2076.04">right so the good news is as mentioned</span> <span data-start="2076.04" data-end="2077.599">earlier this is pretty much as hard as</span> <span data-start="2077.599" data-end="2079.849">it gets which may not sound like good</span> <span data-start="2079.849" data-end="2083.75">news but like this was a hard project</span> <span data-start="2083.75" data-end="2086.69">for me I'll be honest and it took a</span> <span data-start="2086.69" data-end="2088.31">while to wrap my head around these</span> <span data-start="2088.31" data-end="2091.97">things and so it's means nothing if it</span> <span data-start="2091.97" data-end="2094.46">if it takes you a while to wrap your</span> <span data-start="2094.46" data-end="2097.31">head around them as well but if you pick</span> <span data-start="2097.31" data-end="2099.38">up on anything here at least gotten a</span> <span data-start="2099.38" data-end="2101.18">sense for like how complicated this is</span> <span data-start="2101.18" data-end="2104.33">or in the end how tractable it is then</span> <span data-start="2104.33" data-end="2107.18">that's great and you can do a lot of</span> <span data-start="2107.18" data-end="2109.31">smaller things like adding support for</span> <span data-start="2109.31" data-end="2111.26">async functions and weight expressions</span> <span data-start="2111.26" data-end="2114.56">to the language in like this much code</span> <span data-start="2114.56" data-end="2116.39">this is the entire run time for that</span> <span data-start="2116.39" data-end="2118.67">really cool acma script 7 feature that's</span> <span data-start="2118.67" data-end="2119.96">coming down the pipe and that's already</span> <span data-start="2119.96" data-end="2123.08">implemented in a pull request for a</span> <span data-start="2123.08" data-end="2126.44">generator but I just mentioned that's a</span> <span data-start="2126.44" data-end="2128.869">necklace crypt 7 feature not echo script</span> <span data-start="2128.869" data-end="2130.52">six so we're not just bridging the gap</span> <span data-start="2130.52" data-end="2133.07">here between today and whenever acma</span> <span data-start="2133.07" data-end="2135.109">script 6 is fully supported we're always</span> <span data-start="2135.109" data-end="2139.089">going to be looking into the future so</span> <span data-start="2139.089" data-end="2141.55">my motto is always be transpiring</span> <span data-start="2141.55" data-end="2144.44">because incremental translation is the</span> <span data-start="2144.44" data-end="2146.78">key to avoiding that pythons 3 trap for</span> </p>
<p><span data-start="2146.78" data-end="2148.91">JavaScript that's how we bring about the</span> <span data-start="2148.91" data-end="2149.39">future with</span> <span data-start="2149.39" data-end="2152">choking on it and it's how we know that</span> <span data-start="2152" data-end="2153.05">the future is actually going to be</span> <span data-start="2153.05" data-end="2156.71">pretty great because it's as I said</span> <span data-start="2156.71" data-end="2159.28">before linguistic time travel of a sort</span> <span data-start="2159.28" data-end="2161.99">still really hard not everything can be</span> <span data-start="2161.99" data-end="2163.28">transpired I don't know what to do</span> <span data-start="2163.28" data-end="2166.49">without prescrip symbols and st</span> <span data-start="2166.49" data-end="2167.69">transforms don't always play well</span> <span data-start="2167.69" data-end="2169.49">together to transforms could be</span> <span data-start="2169.49" data-end="2171.32">competing to be like the thing that adds</span> <span data-start="2171.32" data-end="2172.7">something to the first line of a</span> <span data-start="2172.7" data-end="2174.95">function and who wins well it just you</span> <span data-start="2174.95" data-end="2176.96">have to figure out which one should come</span> <span data-start="2176.96" data-end="2178.79">first you have to break that tie and you</span> <span data-start="2178.79" data-end="2181.64">can't really do that automatically you</span> <span data-start="2181.64" data-end="2182.78">really need to have something like</span> <span data-start="2182.78" data-end="2184.52">source maps when you're hugging</span> <span data-start="2184.52" data-end="2186.32">generated code like we just went through</span> <span data-start="2186.32" data-end="2189.53">because it's not as readable as the</span> <span data-start="2189.53" data-end="2192.29">futuristic syntax for sure and the</span> <span data-start="2192.29" data-end="2193.7">language specification can totally</span> <span data-start="2193.7" data-end="2195.89">change out from under you a saint can</span> <span data-start="2195.89" data-end="2197.9">wait not specified yet might have to</span> <span data-start="2197.9" data-end="2200.06">rewrite that pull request but it wasn't</span> <span data-start="2200.06" data-end="2201.47">too much effort in the first place so</span> </p>
<p><span data-start="2201.47" data-end="2204.14">I'm going to try to track those changes</span> <span data-start="2204.14" data-end="2207.47">as they come so my team at Facebook</span> <span data-start="2207.47" data-end="2208.73">JavaScript infrastructure is gonna be</span> <span data-start="2208.73" data-end="2211.19">working with this as long as it takes to</span> <span data-start="2211.19" data-end="2214.73">make the process seamless and it's all</span> <span data-start="2214.73" data-end="2216.29">gonna be open source we're just getting</span> <span data-start="2216.29" data-end="2218.66">started and you are absolutely more than</span> </p>
</section>