<section>
<p><span data-start="27.949" data-end="30.769">Hi everybody, that is an awesome piece of trivia.</span> <span data-start="30.769" data-end="33.88">I also ran into my friend Justin here, who I</span> <span data-start="33.88" data-end="37.66">ran the first workshop with 6 years ago, and I haven't</span> <span data-start="37.66" data-end="41.44">seen him for almost that amount of time, so awesome to</span> <span data-start="41.44" data-end="43.19">see you.</span> <span data-start="43.19" data-end="46.6">Thank you for attending my talk, it is called refactoring the dinosaur.</span> <span data-start="46.6" data-end="52.6">I'm truly honoured to speak at JSconf, so thank you to the organisers.</span> <span data-start="52.6" data-end="56.329">As Ben said, I actually work at Kickstarter as a developer</span> <span data-start="56.329" data-end="59.92">in New York City, and we're a pretty eclectic bunch</span> <span data-start="59.92" data-end="61.59">of people.</span> </p>
<p><span data-start="61.59" data-end="65.81">We tend to always have side projects going on, and I'm</span> <span data-start="65.81" data-end="68.82">always continually inspired by my colleagues.</span> <span data-start="68.82" data-end="70.56">This is the library at Kickstarter.</span> <span data-start="70.56" data-end="74.42">It is actually known as the quiet space where you can work.</span> <span data-start="74.42" data-end="76.84">However, after hours it comes alive.</span> <span data-start="76.84" data-end="83.29">We have 4D and D groups internally that play here, and which is awesome, and there's</span> <span data-start="83.29" data-end="86.42">actually a hardware hacking club also that meets here</span> <span data-start="86.42" data-end="88.85">every second Thursday, and that has a grand total</span> <span data-start="88.85" data-end="92.06">of three people in it, including myself.</span> <span data-start="92.06" data-end="97.32">But one other person of this hardware hacking club is Zak Donham,</span> <span data-start="97.32" data-end="100.189">and you probably can't quite tell what he's doing</span> <span data-start="100.189" data-end="103.5">here, but there's actually shrimp in the water and he's</span> <span data-start="103.5" data-end="106.74">recording the sounds the shrimp are making, which is</span> <span data-start="106.74" data-end="107.74">amazing.</span> </p>
<p><span data-start="107.74" data-end="110.06">He is a wonderful person, an artist.</span> <span data-start="110.06" data-end="112.87">He does a lot of technology outreach for Kickstarter, and he</span> <span data-start="112.87" data-end="114.77">is fantastic.</span> <span data-start="114.77" data-end="120.61">Recently he created this this Kickstarter project so people at Kickstarter actually</span> <span data-start="120.61" data-end="123.049">run their own Kickstarters, believe it or not, and it is</span> <span data-start="123.049" data-end="126.75">called the public radio, and it is this idea of radio</span> <span data-start="126.75" data-end="131.36">monogamy and so if you have one station you really love,</span> <span data-start="131.36" data-end="135.64">this radio is hard tuned to that radio station, so there's</span> <span data-start="135.64" data-end="141.22">a volume button and also a switch to turn it on.</span> </p>
<p><span data-start="141.22" data-end="144.12">And I'm not sure whether you can see that I need the video</span> <span data-start="144.12" data-end="146.319">to come up for me for this, but I actually have the</span> <span data-start="146.319" data-end="150.099">radio here, and that's going to form the basis for the</span> <span data-start="150.099" data-end="152.57">case study I'll be talking about today.</span> <span data-start="152.57" data-end="159.64">And so Zak and his co-partner Spencer write actually put together</span> <span data-start="159.64" data-end="161.83">this radio from scratch and designed the board</span> <span data-start="161.83" data-end="164.25">and everything, and one of the review tiers for</span> <span data-start="164.25" data-end="168.39">their Kickstarter project was to send it as a kit,</span> <span data-start="168.39" data-end="171.58">so someone can actually receive all the parts, including</span> </p>
<p><span data-start="171.58" data-end="175.36">I think the mason jar, and they can actually solder</span> <span data-start="175.36" data-end="178.489">it together themselves, and then they are also responsible</span> <span data-start="178.489" data-end="181.62">for flashing the software on to the chip on the</span> <span data-start="181.62" data-end="184.68">board, and, you know, a flashing that radio station property</span> <span data-start="184.68" data-end="185.68">as well.</span> </p>
<p><span data-start="185.68" data-end="188.56">So that they can get the radio station they want.</span> <span data-start="188.56" data-end="191.34">So if you haven't run a Kickstarter project before,</span> <span data-start="191.34" data-end="195.189">it is actually really a huge undertaking, and so you</span> <span data-start="195.189" data-end="197.93">know they had a lot of ledger six to take care of, and</span> <span data-start="197.93" data-end="200.86">at the time they'd written a CLI app in order to flash</span> <span data-start="200.86" data-end="203.95">the chip, however they wanted something a little bit</span> <span data-start="203.95" data-end="206.72">more user-friendly just in case there were people that</span> <span data-start="206.72" data-end="208.84">weren't used to the terminal.</span> <span data-start="208.84" data-end="212.18">So I volunteered to write a hardware out for them, just because I've</span> <span data-start="212.18" data-end="215.75">done that kind of thing before, and at the time they</span> <span data-start="215.75" data-end="218.72">had these Python files they were using for the CLA,</span> <span data-start="218.72" data-end="222.84">and so I ended up just using those files and I used a Python</span> <span data-start="222.84" data-end="227.939">GUI kit, and this is the app I put together.</span> </p>
<p><span data-start="227.939" data-end="232.84">And I wasn't super proud of it, it worked really well.</span> <span data-start="232.84" data-end="236.48">You know, you put your radio station in, you'd pick the programmer</span> <span data-start="236.48" data-end="239.749">you're using, which I have one here, as you can see</span> <span data-start="239.749" data-end="241.829">it is the blue guy right here.</span> </p>
<p><span data-start="241.829" data-end="245.4">And, you know, you have to obviously change your band emphasis and channel</span> <span data-start="245.4" data-end="249.24">spacing for what country you live in for the radio.</span> <span data-start="249.24" data-end="251.359">And it worked really well, I worked on the support</span> <span data-start="251.359" data-end="253.409">forums to make sure no one was having an awful time</span> <span data-start="253.409" data-end="254.409">with it.</span> <span data-start="254.409" data-end="259.41">However, it had some problems, some accessibility problems, because you couldn't keyboard tab</span> <span data-start="259.41" data-end="264.02">between the fields, and the screen readers couldn't actually</span> <span data-start="264.02" data-end="266.75">read what was going on, so it was kind of hard</span> <span data-start="266.75" data-end="267.75">to use.</span> <span data-start="267.75" data-end="270.58">It is not super good looking.</span> <span data-start="270.58" data-end="274.501">If I hadn't put that picture on there with rounded corners, it probably would</span> <span data-start="274.501" data-end="276.91">have looked like some kind of virus about to install</span> <span data-start="276.91" data-end="279.69">itself on your computer (Laughter).</span> </p>
<p><span data-start="279.69" data-end="283.31">And the aero management was really different because the open source</span> <span data-start="283.31" data-end="288.47">software I was using to run the flashing process, it</span> <span data-start="288.47" data-end="291.03">has status codes but doesn't actually have anything in-depth.</span> <span data-start="291.03" data-end="295.28">You have to regx against the standard error output,</span> <span data-start="295.28" data-end="296.78">just to figure out what was going on.</span> <span data-start="296.78" data-end="300.5">So a lot of the time, if there was any error, I dumped the log in the</span> <span data-start="300.5" data-end="303.37">app and it looked even more scary at that point.</span> </p>
<p><span data-start="303.37" data-end="307">So I'm a modern lady, you know.</span> <span data-start="307" data-end="310.13">I have modern tastes in software.</span> <span data-start="310.13" data-end="313.94">And so I thought we can do better for hardware apps.</span> <span data-start="313.94" data-end="317.79">This is the way we've written hardware apps for a long time now, we can</span> <span data-start="317.79" data-end="320.07">do way better than this.</span> </p>
<p><span data-start="320.07" data-end="323.92">For both our end users, but also for developers, like developers should have a</span> <span data-start="323.92" data-end="327.13">much nicer time writing these kind of applications, you</span> <span data-start="327.13" data-end="329.92">know, they can be really frustrating to write.</span> <span data-start="329.92" data-end="336.67">And so I actually rewrote the entire app in JavaScript, and</span> <span data-start="336.67" data-end="338.11">this is actually what it looks like.</span> <span data-start="338.11" data-end="342.42">So I'm going to do a quick demo, if the demo gods are nice.</span> <span data-start="342.42" data-end="346.19">I'm just going to bring up the app, and it is very small on</span> <span data-start="346.19" data-end="349.25">this resolution, so I'm going to zoom in.</span> <span data-start="349.25" data-end="350.25">All right.</span> <span data-start="350.25" data-end="351.59">This magnificent line.</span> <span data-start="351.59" data-end="356.21">All right, this is the new app.</span> <span data-start="356.21" data-end="358.83">First off, I can actually keyboard tab into it, which is</span> <span data-start="358.83" data-end="359.83">great.</span> <span data-start="359.83" data-end="364.43">I can hide away these event settings if you don't need them, and it just looks less like</span> <span data-start="364.43" data-end="367.4">a computer virus, in my opinion.</span> </p>
<p><span data-start="367.4" data-end="372.02">So I'm going to turn the radio on and hopefully you can hear that.</span> <span data-start="372.02" data-end="376.53">music plays] I'm going to change the radio station.</span> <span data-start="376.53" data-end="380.08">Losing my Religion  —  that's great.</span> <span data-start="380.08" data-end="382.54">I don't need to change any of these right now, because it will work well</span> <span data-start="382.54" data-end="384.62">enough for me to flash it.</span> </p>
<p><span data-start="384.62" data-end="389.34">So while we had no sort of progress, I also implemented a progress meter, and I'm</span> <span data-start="389.34" data-end="391.21">actually going to turn this light out so you can see</span> <span data-start="391.21" data-end="395.16">the programmer here actually programming it.</span> <span data-start="395.16" data-end="399.5">And here we go.</span> <span data-start="399.5" data-end="402.26">Please work.</span> <span data-start="402.26" data-end="409.18">music plays] New radio station.</span> <span data-start="409.18" data-end="410.57">[applause].</span> <span data-start="410.57" data-end="412.35">So I am just going to turn this off.</span> <span data-start="412.35" data-end="415.3">I feel like this is a much better experience, and I actually had a lot more</span> <span data-start="415.3" data-end="418.19">fun writing it, but there's a lot of complications because</span> <span data-start="418.19" data-end="421.33">this is not really your standard way of writing hardware</span> <span data-start="421.33" data-end="424.5">apps in JavaScript, so I wanted to take you through</span> <span data-start="424.5" data-end="427.34">some of the challenges and how I put this together.</span> </p>
<p><span data-start="427.34" data-end="430.19">So let's go back.</span> <span data-start="430.19" data-end="431.97">All right.</span> <span data-start="431.97" data-end="438.61">So I actually wrote the GUI in NWJS, so some of you might be wondering why didn't</span> <span data-start="438.61" data-end="439.61">you use electron?</span> <span data-start="439.61" data-end="445.4">This is the new one, but you have to build native modules for use with hardware.</span> <span data-start="445.4" data-end="449.84">A lot of the time it is the USB interface, so it is easier to</span> <span data-start="449.84" data-end="453.03">rebuild those to work with NWJS so that was the main</span> <span data-start="453.03" data-end="458.46">reason I went with that, and I also created a brand</span> <span data-start="458.46" data-end="462.43">new from scratch library that will actually drive the</span> <span data-start="462.43" data-end="464.71">flashing process itself.</span> </p>
<p><span data-start="464.71" data-end="471.03">And I'll explain why, as we go through, but this is the API I wanted to be able to</span> <span data-start="471.03" data-end="473.89">use in the first place, and it is not the API I actually</span> <span data-start="473.89" data-end="477.15">had access to at the time.</span> <span data-start="477.15" data-end="484.24">I have to go through very briefly what is actually on this, what is in this radio,</span> <span data-start="484.24" data-end="486.08">how does it actually work?</span> <span data-start="486.08" data-end="490.59">So the main brains of this circuit is the ATtiny 45.</span> <span data-start="490.59" data-end="493.27">This is a microchip put out by Atmel.</span> <span data-start="493.27" data-end="494.97">It is super powerful.</span> <span data-start="494.97" data-end="501.62">It has four kilobytes of programme memory.</span> <span data-start="501.62" data-end="502.62">That's amazing.</span> <span data-start="502.62" data-end="504.18">Why would you need more space?</span> <span data-start="504.18" data-end="507.92">It also has 266 bytes of EPROM.</span> <span data-start="507.92" data-end="513.55">It stands for electronically erasable programmable read</span> <span data-start="513.55" data-end="514.55">only memory.</span> </p>
<p><span data-start="514.55" data-end="519.24">Essentially what that means is you can flash a constant to that memory, or a couple of</span> <span data-start="519.24" data-end="523.01">constants, and you can save on your four kilobytes if you</span> <span data-start="523.01" data-end="526.94">need to store like values that are never going to change,</span> <span data-start="526.94" data-end="527.94">right?</span> <span data-start="527.94" data-end="529.94">So that's actually where the radio station of</span> <span data-start="529.94" data-end="533.57">choice is flashed to, so that, you know, you don't have</span> <span data-start="533.57" data-end="536.3">to keep flashing the software over each time.</span> </p>
<p><span data-start="536.3" data-end="538.779">And it is actually just a euro.</span> <span data-start="538.779" data-end="542.37">You can buy this for a euro and I don't even think that's the bulk price.</span> <span data-start="542.37" data-end="544.19">You can probably get it for less.</span> <span data-start="544.19" data-end="546.58">That's the brains behind this.</span> <span data-start="546.58" data-end="552.53">The way they get this code, or the radio station to actually go on to the device, is we need</span> <span data-start="552.53" data-end="554.64">a translator in between.</span> <span data-start="554.64" data-end="559.49">So this here is a programmer which is like the middle of the diagram, and I find it really</span> <span data-start="559.49" data-end="563.68">ugly so I put a rainbow on it to make it prettier.</span> <span data-start="563.68" data-end="567.71">This is a drawing I did to try to just make this stuff</span> <span data-start="567.71" data-end="570.17">seem more interesting than it is.</span> <span data-start="570.17" data-end="574.03">And so this programmer actually sort of takes the code that's compiled on</span> <span data-start="574.03" data-end="578.48">your computer, which is usually C, and it is able to speak</span> <span data-start="578.48" data-end="581.94">to the chip, and so the programmer is providing you with</span> <span data-start="581.94" data-end="584.46">a USB interface.</span> </p>
<p><span data-start="584.46" data-end="585.94">And then the programmer can take that and it</span> <span data-start="585.94" data-end="589.44">uses the SPI protocol which is the serial programming</span> <span data-start="589.44" data-end="592.44">interface protocol in order to talk to the chip.</span> <span data-start="592.44" data-end="596.44">So it is doing the actual signal, sort of bit flipping</span> <span data-start="596.44" data-end="599.53">in order to get that on to the chip.</span> <span data-start="599.53" data-end="604.78">So this is sort of how you normally have to create your application.</span> </p>
<p><span data-start="604.78" data-end="607.55">You have a GUI, it can be in any language you</span> <span data-start="607.55" data-end="612.34">want, like Python, or even just actual regular CR objective</span> <span data-start="612.34" data-end="615.24">C, JavaScript in this case.</span> <span data-start="615.24" data-end="620.26">It takes user input and then obviously compiles down and then it calls</span> <span data-start="620.26" data-end="622.04">the upload process.</span> </p>
<p><span data-start="622.04" data-end="627.65">That is always a child process, and that is also that has always bothered me, and I'll</span> <span data-start="627.65" data-end="630.27">explain why it is a child process.</span> <span data-start="630.27" data-end="635.48">It actually writes to the chip and that's really all there is to it.</span> <span data-start="635.48" data-end="638.55">Now the application that you normally use to upload</span> <span data-start="638.55" data-end="645.19">this, it was written 16 years ago, it is called AVRDUDE.</span> <span data-start="645.19" data-end="646.21">And it is really cool.</span> <span data-start="646.21" data-end="650.63">It is a C executable, available for all platforms, less than 500 kilobytes,</span> <span data-start="650.63" data-end="653.26">which is cool, and this is what everybody has been</span> <span data-start="653.26" data-end="654.92">using since it came out.</span> <span data-start="654.92" data-end="659.94">There's not really any alternatives at this point other than Atmel's IDE.</span> <span data-start="659.94" data-end="668.59">So AVRDUDE stands for AVR downloader uploader, so it is very interesting,</span> <span data-start="668.59" data-end="671.029">and an AVR is an acronym used for the microchips</span> <span data-start="671.029" data-end="672.88">that Atmel puts out.</span> <span data-start="672.88" data-end="675.52">They've confirmed that AVR has absolutely no</span> <span data-start="675.52" data-end="678.12">meaning whatsoever, so I can't tell you what that stands</span> <span data-start="678.12" data-end="679.12">for.</span> </p>
<p><span data-start="679.12" data-end="680.12">Look on Wiki.</span> <span data-start="680.12" data-end="683.93">It was written in C, it is open source, which is amazing.</span> <span data-start="683.93" data-end="688.46">And everybody uses it because, you know, it works really well.</span> <span data-start="688.46" data-end="690.64">It has been around for a long time.</span> <span data-start="690.64" data-end="697.22">It has a lot of traction because of that, and people have added extra</span> <span data-start="697.22" data-end="699.91">programme and chips over time, and it has the greatest</span> <span data-start="699.91" data-end="703.61">compatibility and it is the only thing out there that</span> <span data-start="703.61" data-end="706.85">has that strength that you don't  —  you can create</span> <span data-start="706.85" data-end="709.29">dynamic apps like this with, right, without having to</span> <span data-start="709.29" data-end="713.98">open an I; and so even the Arduino ID and the systems</span> <span data-start="713.98" data-end="716.01">use that over the surface.</span> </p>
<p><span data-start="716.01" data-end="719.46">So if you go on to your preferences and see the logging, you can see</span> <span data-start="719.46" data-end="722.31">the AVRDUDE command running.</span> <span data-start="722.31" data-end="726.67">It has have some limitations, however, it is command line only, which is why I have</span> <span data-start="726.67" data-end="730.31">to spin up a child process every time if I'm doing runtime</span> <span data-start="730.31" data-end="735.96">code, and that can be a pain, and it also means</span> <span data-start="735.96" data-end="739.6">sometimes you have to handle like multi-processors or threading,</span> <span data-start="739.6" data-end="741.57">because it will lock-up the EY while you're running</span> <span data-start="741.57" data-end="742.57">that.</span> </p>
<p><span data-start="742.57" data-end="745.56">There are no tests in it at all, so it relies on</span> <span data-start="745.56" data-end="749.35">manual testing if anyone requests it, and it has this</span> <span data-start="749.35" data-end="753.56">fragmented community, if people are updating it mostly</span> <span data-start="753.56" data-end="758.69">because it doesn't change a lot in spite of a decade,</span> <span data-start="758.69" data-end="764.17">but it doesn't the same community feel as JavaScript,</span> <span data-start="764.17" data-end="767.11">and that's something that disappointed me.</span> </p>
<p><span data-start="767.11" data-end="769.839">People can be rude in the forums if you're a newbie,</span> <span data-start="769.839" data-end="776.22">and it has been pretty disappointing for me.</span> <span data-start="776.22" data-end="779.97">Creating an alternative for this piece of software itself</span> <span data-start="779.97" data-end="783.13">was obvious to me, and so this project here with</span> <span data-start="783.13" data-end="786.11">the radio led me down the track of just completely rewriting</span> <span data-start="786.11" data-end="787.59">this thing.</span> <span data-start="787.59" data-end="788.59">And so why?</span> <span data-start="788.59" data-end="792.87">You know, well, we have a small family of packages kind of mentality which</span> <span data-start="792.87" data-end="795.26">I really like, like why do we have this monolith?</span> <span data-start="795.26" data-end="798.34">People should be able to install the chip support and the</span> <span data-start="798.34" data-end="801.49">programming support they want.</span> <span data-start="801.49" data-end="806.26">It has, you know, it is easier to test that way, because they're small chunks.</span> <span data-start="806.26" data-end="808.1">It has better flexibility for use.</span> <span data-start="808.1" data-end="811.42">So instead of just having it on the command line, you should be able</span> <span data-start="811.42" data-end="815.76">to require it with a common JS pattern and then use it that</span> <span data-start="815.76" data-end="818.11">way, which is the main pinpoint for me.</span> </p>
<p><span data-start="818.11" data-end="821.58">It is also more accessible.</span> <span data-start="821.58" data-end="825.11">People that are coming in now to learn programming are not necessarily learning C</span> <span data-start="825.11" data-end="829.81">any more but JavaScript, and this opens this world up to</span> <span data-start="829.81" data-end="832.56">more people and provides an alternative.</span> <span data-start="832.56" data-end="836.76">I'm not looking to replace the AVRDUDE; I just want to provide a different</span> <span data-start="836.76" data-end="841.46">alternative and have a go at seeing what modern principles bring to it.</span> <span data-start="841.46" data-end="843.3">I also want to publish others.</span> <span data-start="843.3" data-end="845.83">I don't want to just write a keys of code for that</span> <span data-start="845.83" data-end="849.19">programmer and that chip, want to be able to have this</span> <span data-start="849.19" data-end="852.52">as a tool that everyone can use.</span> <span data-start="852.52" data-end="856.37">So I wrote a tool called AVRGIRL.</span> <span data-start="856.37" data-end="857.37">[applause].</span> <span data-start="857.37" data-end="862.89">It stands for AVR general iSP programming tool.</span> <span data-start="862.89" data-end="863.89">[applause].</span> <span data-start="863.89" data-end="875.58">I wanted to keep the tradition going.</span> </p>
<p><span data-start="875.58" data-end="878.22">I respect, like AVRDUDE is an amazing tool.</span> <span data-start="878.22" data-end="881.08">I'm not here to say it is bad in any way.</span> <span data-start="881.08" data-end="884.96">I want to pay homage to it.</span> <span data-start="884.96" data-end="890.24">And so you go on your little journey of programming these things and think:</span> <span data-start="890.24" data-end="891.24">this is awesome.</span> <span data-start="891.24" data-end="893.33">Why has no one does this before?</span> <span data-start="893.33" data-end="896.74">People have maybe rewritten pots of AVRDUDE for their</span> <span data-start="896.74" data-end="900.85">own use, but not the whole library, like how bad could</span> <span data-start="900.85" data-end="902.81">this be?</span> <span data-start="902.81" data-end="906.43">And while we're on the topic of dinosaurs, I found</span> <span data-start="906.43" data-end="911.06">a lot of mammoth shave while doing this, and one popped</span> <span data-start="911.06" data-end="913.83">up immediately, and I felt that's okay, I can</span> <span data-start="913.83" data-end="914.83">do it.</span> </p>
<p><span data-start="914.83" data-end="918.29">And before I knew it they were everywhere.</span> <span data-start="918.29" data-end="920.94">And I'm thinking: this is why people haven't tried</span> <span data-start="920.94" data-end="922.5">to do this before.</span> <span data-start="922.5" data-end="930.94">So whenever you try and look up how to solve this, this is usually what you run into, okay,</span> <span data-start="930.94" data-end="933.43">or you just run into people who have used the software</span> <span data-start="933.43" data-end="935.79">but don't know how it works.</span> <span data-start="935.79" data-end="939.5">So this posed quite a challenge, so I want to really quickly go</span> <span data-start="939.5" data-end="944.07">over a couple of challenges I had with this, just</span> <span data-start="944.07" data-end="946.49">so that people can understand the hardware world a</span> <span data-start="946.49" data-end="947.62">little more.</span> <span data-start="947.62" data-end="951.48">I'm a little lonely in this world; I want to share my</span> <span data-start="951.48" data-end="952.48">pain.</span> </p>
<p><span data-start="952.48" data-end="956.1">Challenge number 1: support USB programmers this</span> <span data-start="956.1" data-end="962.56">the AVRISP v2, and it runs via USB and there are a lot</span> <span data-start="962.56" data-end="965.98">that run via parallel ports and all sorts of stuff, but</span> <span data-start="965.98" data-end="968.69">I want to support more modern stuff to begin with, and</span> <span data-start="968.69" data-end="970.61">see if there's demand beyond there.</span> <span data-start="970.61" data-end="974.459">Here is an example of four different programmers.</span> <span data-start="974.459" data-end="979.81">We have the AVRISF mark two, the spark fund tiny programmer and the</span> <span data-start="979.81" data-end="984.209">spark fun pocket programmer, and then we have the USB</span> <span data-start="984.209" data-end="986.6">tiny programmer.</span> <span data-start="986.6" data-end="991.98">And so these are great, and the reason why there's a lot of them is they all have different</span> <span data-start="991.98" data-end="993.899">advantages.</span> <span data-start="993.899" data-end="998.22">The problem is they all speak different languages.</span> <span data-start="998.22" data-end="1008.45">So in the web world we have HTTP and HTTS, it's no different in hardware, we have a lot</span> <span data-start="1008.45" data-end="1012.529">of protocols, we need to support, and so far</span> <span data-start="1012.529" data-end="1015.62">in writing AVRGIRL we've come across these protocols</span> <span data-start="1015.62" data-end="1016.62">in particular.</span> </p>
<p><span data-start="1016.62" data-end="1018.85">I don't have time to go into them in detail now, but</span> <span data-start="1018.85" data-end="1021.5">I have blogged about a couple.</span> <span data-start="1021.5" data-end="1025">So we have STK500 version one, which is by Atmel.</span> <span data-start="1025" data-end="1028.159">Then they came out with version two, which is quite different.</span> <span data-start="1028.159" data-end="1033.97">We have AVR109USP tiny AR.</span> <span data-start="1033.97" data-end="1038.919">There was actually a node module for each of these</span> <span data-start="1038.919" data-end="1044.089">in npm, which is awesome, and that was Ryan Day and</span> <span data-start="1044.089" data-end="1049.09">Jacob Rosenthal, and a lot of these modules were written</span> <span data-start="1049.09" data-end="1052.429">specifically for use case and weren't really super</span> <span data-start="1052.429" data-end="1053.429">generic.</span> <span data-start="1053.429" data-end="1055.57">So I had to pull request some of them and some</span> <span data-start="1055.57" data-end="1059.649">of them I've had to rewrite from scratch, because it</span> <span data-start="1059.649" data-end="1061.909">would basically be rewriting the whole thing.</span> </p>
<p><span data-start="1061.909" data-end="1070.17">And so I learned a lot about how hardware talks to</span> <span data-start="1070.17" data-end="1073.279">devices, and then how computers talk to programmers.</span> <span data-start="1073.279" data-end="1075.67">It was actually really cool.</span> <span data-start="1075.67" data-end="1079.61">And so I got all of this information from data sheets, and, you know, this is kind of</span> <span data-start="1079.61" data-end="1082.039">how it feels when you first read a data sheet.</span> <span data-start="1082.039" data-end="1084.299">You're like: what is this?</span> <span data-start="1084.299" data-end="1090.44">So this is an example of a data sheet for a previous library I wrote to drive OLED screens.</span> </p>
<p><span data-start="1090.44" data-end="1094.1">And after a while, the thing starts swimming into</span> <span data-start="1094.1" data-end="1095.95">a place where they make sense.</span> <span data-start="1095.95" data-end="1099.48">But a lot of the time that's all you have because Google is not going to give</span> <span data-start="1099.48" data-end="1101">you a lot of information.</span> </p>
<p><span data-start="1101" data-end="1103.15">But we got there in the end.</span> <span data-start="1103.15" data-end="1106.5">I have some protocols that are now supported.</span> <span data-start="1106.5" data-end="1108.989">All of the Arduinos can be flashed with this software</span> <span data-start="1108.989" data-end="1112.549">and this programmer here also has support right now.</span> <span data-start="1112.549" data-end="1115.71">So challenge number 2, O/I have to somehow support</span> <span data-start="1115.71" data-end="1118.33">all of these Atmel chips, so how many can there really</span> <span data-start="1118.33" data-end="1119.33">be?</span> <span data-start="1119.33" data-end="1121.97">Well there's 400 of them.</span> <span data-start="1121.97" data-end="1123.159">[Laughter].</span> </p>
<p><span data-start="1123.159" data-end="1127.519">Luckily not all of them are actually relevant, some are architecture</span> <span data-start="1127.519" data-end="1128.62">and that sort of thing.</span> <span data-start="1128.62" data-end="1132.98">I'm supporting risk architecture which is what the Atmel AVR chips are, so</span> <span data-start="1132.98" data-end="1136.019">that whittled it down to 135.</span> <span data-start="1136.019" data-end="1138.559">That's fine, that's great.</span> <span data-start="1138.559" data-end="1144.44">So this configuration sits in not a format that I'm</span> <span data-start="1144.44" data-end="1145.95">used to.</span> <span data-start="1145.95" data-end="1148.889">I wanted it to look like this, and this is not the</span> <span data-start="1148.889" data-end="1152.679">entire object of configurations I created in the end, I</span> <span data-start="1152.679" data-end="1154.379">had to create my own spec for this.</span> </p>
<p><span data-start="1154.379" data-end="1158.7">There's about 50 properties, so here's a snapshot of the properties</span> <span data-start="1158.7" data-end="1161.35">you need to know, such as the name of it, the</span> <span data-start="1161.35" data-end="1165.71">timeout, if it doesn't connect within 200 milliseconds, then</span> <span data-start="1165.71" data-end="1166.71">it is a timeout.</span> <span data-start="1166.71" data-end="1169.149">Things like that.</span> <span data-start="1169.149" data-end="1171.09">Really kind of in-depth stuff.</span> <span data-start="1171.09" data-end="1173.429">But what I had to work with was 200 megabytes of</span> <span data-start="1173.429" data-end="1178.95">XML files to pull out those configurations, so that was</span> <span data-start="1178.95" data-end="1182.399">particularly time consuming, but I thought this has to</span> <span data-start="1182.399" data-end="1186.57">be done, and I don't want this stuck in XML forever.</span> <span data-start="1186.57" data-end="1192.639">So writing XML translations is really  —  I wouldn't</span> <span data-start="1192.639" data-end="1193.639">recommend it.</span> <span data-start="1193.639" data-end="1197.94">There are a lot of late nights, a lot of crying, shouting at my significant other when</span> </p>
<p><span data-start="1197.94" data-end="1199.549">I was in the middle of a bug, and he asked me what</span> <span data-start="1199.549" data-end="1201.73">I wanted for dinner.</span> <span data-start="1201.73" data-end="1202.73">Sorry.</span> <span data-start="1203.73" data-end="1206.049">But luckily I have this awesome module.</span> <span data-start="1206.049" data-end="1208.86">Well, I don't have it, but I used it.</span> <span data-start="1208.86" data-end="1210.769">It is called XML to JS.</span> <span data-start="1210.769" data-end="1212.45">I highly recommend using it.</span> <span data-start="1212.45" data-end="1213.45">It is awesome.</span> <span data-start="1213.45" data-end="1216.919">It passes the whole thing, you set up how flat</span> <span data-start="1216.919" data-end="1218.48">you want it, and it was amazing.</span> <span data-start="1218.48" data-end="1222.45">So I had to deal with pulling out the random bits of the configuration</span> <span data-start="1222.45" data-end="1226.2">I wanted, but actually worked out really well, and so</span> <span data-start="1226.2" data-end="1232.399">I now have 135 chips converted with my spec, only five</span> <span data-start="1232.399" data-end="1234.98">of them have been tested, so I need more people to test</span> <span data-start="1234.98" data-end="1235.98">it.</span> </p>
<p><span data-start="1235.98" data-end="1238.09">I have no idea whether it is actually working, and</span> <span data-start="1238.09" data-end="1243.289">I don't think I'll actually ever open source the</span> <span data-start="1243.289" data-end="1246.75">translation file I wrote, because no one is ever going</span> <span data-start="1246.75" data-end="1250.12">to want to use it, and I'm scared that my job prospects</span> <span data-start="1250.12" data-end="1252.74">will go down the plughole after that.</span> </p>
<p><span data-start="1252.74" data-end="1255.389">But, you know, it got done.</span> <span data-start="1255.389" data-end="1259.649">I'm actually really excited I can work with JSXML.</span> <span data-start="1259.649" data-end="1266.22">After a while it felt like things were actually moving forward, which is great.</span> <span data-start="1266.22" data-end="1269.45">This is sort of how I want the architecture to look eventually,</span> <span data-start="1269.45" data-end="1274.259">the driver itself is just the npm module you install,</span> <span data-start="1274.259" data-end="1279.23">and you get the entire kitchen sink, similar to AVRDUDE.</span> <span data-start="1279.23" data-end="1281.48">So we have our chip config where I'm storing that in</span> <span data-start="1281.48" data-end="1284.44">a module so people don't have to use that.</span> <span data-start="1284.44" data-end="1286.809">For AVRGIRL, you can use it for anything.</span> <span data-start="1286.809" data-end="1292">The protocols have been implemented as specific modules, so if a programmer is not</span> <span data-start="1292" data-end="1294.32">supported, you can still support the programmer as long</span> <span data-start="1294.32" data-end="1297.59">as it has that protocol, and then in the programmer</span> <span data-start="1297.59" data-end="1301.309">is just like separate wrappers around the protocols with</span> <span data-start="1301.309" data-end="1305.109">the vendor ID and the product ID, and just an easy way</span> <span data-start="1305.109" data-end="1306.57">to connect with it.</span> </p>
<p><span data-start="1306.57" data-end="1311.01">But I said before, that I want some more modules, right, so I've designed every single</span> <span data-start="1311.01" data-end="1315.759">package to run by itself, standalone, so that you don't</span> <span data-start="1315.759" data-end="1318.19">have to buy into the whole AVRGIRL thing.</span> <span data-start="1318.19" data-end="1323.149">You can use it by itself and pick and choose what you need.</span> <span data-start="1323.149" data-end="1324.809">So what have I done so far?</span> <span data-start="1324.809" data-end="1329.74">I've released four packages, I've AVRGIRL Arduino, which flashes</span> <span data-start="1329.74" data-end="1334.559">all of the common Arduinos, which pretty much made use</span> <span data-start="1334.559" data-end="1337.739">of all of those protocols.</span> </p>
<p><span data-start="1337.739" data-end="1341.6">I rewrote STK500 version two, because I wanted it to have things like writing fuses</span> <span data-start="1341.6" data-end="1344.6">and EPROM, and the original model was written for the</span> <span data-start="1344.6" data-end="1350.059">Arduino so it didn't support the USB library I needed either.</span> <span data-start="1350.059" data-end="1355.049">AVRGIRL chips JSON is the evidence of my tears, converting</span> <span data-start="1355.049" data-end="1361.049">it to JSON, and the AVRGIRL ISP mark two is this</span> <span data-start="1361.049" data-end="1363.21">programmer here, so you come out of the box interface</span> <span data-start="1363.21" data-end="1364.97">with any chip this programmer.</span> <span data-start="1364.97" data-end="1370.029">So I'm using AVRGIRL ASP mark two in that public radio app I showed you.</span> <span data-start="1370.029" data-end="1371.029">Again, why?</span> <span data-start="1371.029" data-end="1374.529">Why go through all of these tiers to create this</span> <span data-start="1374.529" data-end="1379.059">for when AVRDUDE is perfectly acceptable?</span> <span data-start="1379.059" data-end="1381.96">Well, I want to provide a better developer experience, I have</span> <span data-start="1381.96" data-end="1384.109">a lot of empathy for developers, because I know what</span> <span data-start="1384.109" data-end="1385.48">it is like to be one.</span> </p>
<p><span data-start="1385.48" data-end="1391.529">I want to have really great documentation and have something that feels more native,</span> <span data-start="1391.529" data-end="1393.85">so that they don't feel stupid because they don't know</span> <span data-start="1393.85" data-end="1396.429">stuff about hardware.</span> <span data-start="1396.429" data-end="1399.2">This is just a example from the forums I talked about.</span> <span data-start="1399.2" data-end="1404.929">This person, they're a little  —  they're actually wrong.</span> <span data-start="1404.929" data-end="1407.289">So it's not cool.</span> <span data-start="1407.289" data-end="1409.749">It actually ended up a typo in Atmel's data sheet and</span> <span data-start="1409.749" data-end="1412.639">Atmel apologised, but it was not what David suggested</span> <span data-start="1412.639" data-end="1414.769">it was.</span> <span data-start="1414.769" data-end="1417.029">I don't want people to feel like this.</span> <span data-start="1417.029" data-end="1419.779">It is just not okay, and I think as a JavaScript community</span> <span data-start="1419.779" data-end="1422.97">we are really good at this stuff.</span> <span data-start="1422.97" data-end="1427.72">So without obscuring what the code is, this the kind of API you have</span> <span data-start="1427.72" data-end="1430.34">now, so you have this awareness you're entering programming</span> <span data-start="1430.34" data-end="1433.109">mode, writing the EPROM and exiting programming</span> <span data-start="1433.109" data-end="1436.179">mode, it feels natural and you know there's a callback in</span> <span data-start="1436.179" data-end="1439.859">there, and we're all comfortable with that, and this</span> <span data-start="1439.859" data-end="1442.32">is what it looks like right now in order to be able to</span> <span data-start="1442.32" data-end="1446.539">flash the chip, ten line lines of code, which is great.</span> </p>
<p><span data-start="1446.539" data-end="1449.729">So to be nice to other developers, you want to have</span> <span data-start="1449.729" data-end="1453.22">beautiful docs, which I'm trying to write extensively</span> <span data-start="1453.22" data-end="1457.489">and also blog posting about it, ease of use, and it</span> <span data-start="1457.489" data-end="1460.429">should be implemented in modern tools, modern languages,</span> <span data-start="1460.429" data-end="1461.429">right?</span> <span data-start="1461.429" data-end="1465.479">And then let's provide a better user experience for people that buy this crazy Kickstarter</span> <span data-start="1465.479" data-end="1468.14">kit and have no idea what they're doing.</span> <span data-start="1468.14" data-end="1470.1">Let's have improved accessibility.</span> <span data-start="1470.1" data-end="1475.22">The screen reader issue still hasn't been solved in NWJS, but I'm hoping for that,</span> <span data-start="1475.22" data-end="1479.34">but let's make it easier to be able to use these tools.</span> <span data-start="1479.34" data-end="1482.899">Let's not make it look like a computer virus as well,</span> <span data-start="1482.899" data-end="1485.84">and, you know, hopefully we'll have more uptake in</span> <span data-start="1485.84" data-end="1490.249">this stuff and a much larger hardware community as a result.</span> <span data-start="1490.249" data-end="1493.61">And so, this proof of concept, this app here just</span> <span data-start="1493.61" data-end="1496.95">taught me so much about what it's like to have to provide</span> <span data-start="1496.95" data-end="1499.869">for both users and developers and be stuck in the middle.</span> </p>
<p><span data-start="1499.869" data-end="1502.809">I feel like I learnt a lot about it and privileged</span> <span data-start="1502.809" data-end="1506.11">to be able to work with Zak on this stuff, and I'm excited</span> <span data-start="1506.11" data-end="1508.22">to hopefully release this as the new official</span> <span data-start="1508.22" data-end="1510.94">software for the radio for people who want to change their</span> <span data-start="1510.94" data-end="1513.5">mind about the radio station.</span> </p>
<p><span data-start="1513.5" data-end="1517.58">Hopefully people will maybe take AVRGIRL and use it for fun stuff like remotely</span> <span data-start="1517.58" data-end="1522.24">bricking each other's chips through games online.</span> <span data-start="1522.24" data-end="1526.529">I played this game with someone a couple of weeks ago.</span> <span data-start="1526.529" data-end="1527.529">It was fun.</span> <span data-start="1527.529" data-end="1532.759">If you'd like to follow progress, I have the master</span> <span data-start="1532.759" data-end="1536.479">module which links to all of the others, it is new</span> <span data-start="1536.479" data-end="1538.179">cat/AVRGIRL on github.</span> </p>
<p><span data-start="1538.179" data-end="1542.999">If you want to read a blog post, I'm doing lots about it, there are four right</span> <span data-start="1542.999" data-end="1546.379">now describing all the different challenges I've</span> <span data-start="1546.379" data-end="1547.6">met.</span> <span data-start="1547.6" data-end="1550.47">Thank you for being here for my lessons of JavaScript,</span> </p>
</section>