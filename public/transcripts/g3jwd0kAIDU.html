<section>
<p><span data-start="5.61" data-end="9.54">so my name is Constantine and I'll learn</span> <span data-start="9.54" data-end="13.92">how to use this remote just another</span> <span data-start="13.92" data-end="23.409">second so there are just three buttons</span> <span data-start="23.419" data-end="26.64">I'll use my finger and I just press</span> <span data-start="26.64" data-end="30.329">spacebar here so I work for Facebook on</span> <span data-start="30.329" data-end="33.12">Marketplace team and I mostly focus on</span> <span data-start="33.12" data-end="35.22">performance recently before joining</span> <span data-start="35.22" data-end="37.35">marketplace in Seattle I worked in</span> <span data-start="37.35" data-end="40.44">Facebook UK and I worked on yarn package</span> <span data-start="40.44" data-end="44.64">manager anyone loves packages and before</span> <span data-start="44.64" data-end="46.5">that I worked on react native so I'm a</span> <span data-start="46.5" data-end="48.479">little bit biased towards what framework</span> <span data-start="48.479" data-end="53.17">to choose when you build a mobile app so</span> <span data-start="53.18" data-end="56.64">today I'm going to talk what I have been</span> <span data-start="56.64" data-end="58.769">working on for the last year actually</span> <span data-start="58.769" data-end="63.119">making Marketplace load faster just</span> <span data-start="63.119" data-end="64.86">before we start anyone is familiar with</span> <span data-start="64.86" data-end="68.189">react nice</span> <span data-start="68.189" data-end="72.96">how about react native much less so this</span> <span data-start="72.96" data-end="76.619">talk is I made it so that you could</span> <span data-start="76.619" data-end="79.68">actually take it home some ideas how to</span> <span data-start="79.68" data-end="80.909">make your application faster</span> <span data-start="80.909" data-end="83.46">specifically react native but it also</span> <span data-start="83.46" data-end="85.799">applies to react and actually if you</span> <span data-start="85.799" data-end="87.659">think about it it applies to any other</span> <span data-start="87.659" data-end="92.579">application so first of all what is</span> <span data-start="92.579" data-end="95.429">marketplace anyone used marketplace</span> <span data-start="95.429" data-end="99.149">before so it's a platform it's actually</span> <span data-start="99.149" data-end="101.369">a tab inside Facebook application anyone</span> <span data-start="101.369" data-end="104.46">knows about Facebook so it's a social</span> <span data-start="104.46" data-end="106.46">network</span> <span data-start="106.46" data-end="108.59">and there are tabs in it and marketplace</span> <span data-start="108.59" data-end="110.96">is one of the tabs it's a place where</span> <span data-start="110.96" data-end="113.36">you can buy and sell things to people in</span> <span data-start="113.36" data-end="118.21">your community so marketplace started in</span> <span data-start="118.21" data-end="121.58">2016 and it took us to build to build</span> <span data-start="121.58" data-end="123.92">the first version for iOS just six</span> <span data-start="123.92" data-end="126.29">months and actually we tested it in</span> </p>
<p><span data-start="126.29" data-end="129.59">Hawaii so it means that this stock sort</span> <span data-start="129.59" data-end="132.62">of brings it back home then it took us</span> <span data-start="132.62" data-end="134.69">just two months to build the Android</span> <span data-start="134.69" data-end="136.79">version and this is actually quite rare</span> <span data-start="136.79" data-end="140.45">for applications of this size in company</span> <span data-start="140.45" data-end="144.86">of this this size because it's usually</span> <span data-start="144.86" data-end="145.88">like six months</span> <span data-start="145.88" data-end="148.459">iOS then another six months Android but</span> <span data-start="148.459" data-end="150.92">because we reused JavaScript and 90% of</span> <span data-start="150.92" data-end="153.62">the code was reused we were able to do</span> <span data-start="153.62" data-end="155.38">it just in two months</span> <span data-start="155.38" data-end="158.39">so what officially launched in October</span> <span data-start="158.39" data-end="161.3">2016 to mainland US and some other</span> <span data-start="161.3" data-end="164.87">countries and now it's global and there</span> <span data-start="164.87" data-end="167.36">are more than 800 million people using</span> <span data-start="167.36" data-end="171.7">this application every month and</span> <span data-start="171.7" data-end="174.29">marketplace is more than just buying and</span> <span data-start="174.29" data-end="176.42">selling items to people around you it's</span> <span data-start="176.42" data-end="179.12">also both buying a car finding a place</span> <span data-start="179.12" data-end="184.06">to live some daily deals some business</span> <span data-start="184.06" data-end="186.95">opportunities quite a lot the team is</span> <span data-start="186.95" data-end="189.44">quite large it's more than 100 engineers</span> <span data-start="189.44" data-end="191.54">working on the same react native code</span> <span data-start="191.54" data-end="196.67">base so market will plays grew from 0 to</span> <span data-start="196.67" data-end="199.78">800 million in just about two years and</span> <span data-start="199.78" data-end="203.81">the Tube team grew as well so we need to</span> <span data-start="203.81" data-end="206.51">hire more people and we need to make the</span> <span data-start="206.51" data-end="209.57">application nice to work with and react</span> <span data-start="209.57" data-end="211.88">native played a big role in how to make</span> <span data-start="211.88" data-end="217.73">a good developer experience so anyone is</span> <span data-start="217.73" data-end="221.66">familiar with hot reloading anyone knows</span> <span data-start="221.66" data-end="223.459">the difference between live reloading</span> <span data-start="223.459" data-end="226.73">and hot reloading all right not everyone</span> <span data-start="226.73" data-end="229.64">so live reloading is when you develop a</span> <span data-start="229.64" data-end="232.76">website you change your code type</span> <span data-start="232.76" data-end="235.43">something save it and then your browser</span> <span data-start="235.43" data-end="238.25">or application refreshes with the latest</span> <span data-start="238.25" data-end="240.4">code and you see the changes</span> <span data-start="240.4" data-end="243.349">hot reloading is when you make your</span> <span data-start="243.349" data-end="247.549">changes on your laptop like here make</span> <span data-start="247.549" data-end="249.56">some code some code changes to my react</span> <span data-start="249.56" data-end="253.579">component I press save and then it goes</span> <span data-start="253.579" data-end="256.4">to the device and only the components</span> <span data-start="256.4" data-end="258.919">that actually changed get re-rendered</span> <span data-start="258.919" data-end="262.25">as usual react tree renders components</span> <span data-start="262.25" data-end="265.52">at at its pleasure and this iteration is</span> <span data-start="265.52" data-end="266.99">quite fast because I'm just changing</span> <span data-start="266.99" data-end="270.55">code a little bit and here we go and</span> <span data-start="270.55" data-end="272.87">another thing that you probably don't</span> <span data-start="272.87" data-end="275.419">know at Facebook we don't like building</span> <span data-start="275.419" data-end="277.91">the Facebook application will love the</span> <span data-start="277.91" data-end="279.919">application but building it is not fun</span> <span data-start="279.919" data-end="282.02">because it takes 30 minutes to have a</span> <span data-start="282.02" data-end="284.75">new binary on your device because we</span> <span data-start="284.75" data-end="287.479">have millions of files something good</span> <span data-start="287.479" data-end="290.09">about react native as I mentioned 90% of</span> <span data-start="290.09" data-end="292.91">the code or even more is written in</span> </p>
<p><span data-start="292.91" data-end="295.37">JavaScript and we don't need to change</span> <span data-start="295.37" data-end="298.46">the native code that often so what we</span> <span data-start="298.46" data-end="300.62">can do is we can grab the latest binary</span> <span data-start="300.62" data-end="303.349">from a build server install it on the</span> <span data-start="303.349" data-end="306.08">device and then build the JavaScript</span> <span data-start="306.08" data-end="308.259">file from the source code</span> <span data-start="308.259" data-end="310.88">as a matter of fact we have integration</span> <span data-start="310.88" data-end="315.05">with our IDE that just grabs this binary</span> <span data-start="315.05" data-end="316.82">and does everything with just one single</span> <span data-start="316.82" data-end="322.55">click another big deal is hiring people</span> <span data-start="322.55" data-end="325.55">as I told you marketplace team has grown</span> <span data-start="325.55" data-end="329.36">a lot to build a lot of features and at</span> </p>
<p><span data-start="329.36" data-end="332.15">Facebook we have a joke that it's really</span> <span data-start="332.15" data-end="334.099">hard to find Android developers because</span> <span data-start="334.099" data-end="337.28">we already hired every Android developer</span> <span data-start="337.28" data-end="339.469">who wanted to work for us</span> <span data-start="339.469" data-end="344.149">so we we need a high incidentally there</span> <span data-start="344.149" data-end="345.709">are more JavaScript developers around</span> <span data-start="345.709" data-end="349.209">still hard to hire them but possible</span> <span data-start="349.209" data-end="351.769">less than 5% of people working on</span> <span data-start="351.769" data-end="353.749">marketplace are actually specializing in</span> <span data-start="353.749" data-end="357.259">native platforms it doesn't mean that we</span> <span data-start="357.259" data-end="359.269">don't use their skills we just leverage</span> <span data-start="359.269" data-end="360.949">their ability to work on something</span> <span data-start="360.949" data-end="363.769">complex platform specific all the other</span> <span data-start="363.769" data-end="366.349">people are quite quick to adapt to their</span> <span data-start="366.349" data-end="369.469">javascript code base and become quite</span> <span data-start="369.469" data-end="375.169">proficient building features Repton</span> <span data-start="375.169" data-end="379.069">react native are also very popular if</span> <span data-start="379.069" data-end="381.459">you count github stars which I do</span> <span data-start="381.459" data-end="386.769">periodically there it probably in top 10</span> <span data-start="386.769" data-end="391.159">frameworks on github by star count of</span> <span data-start="391.159" data-end="394.639">course it doesn't matter but if you look</span> <span data-start="394.639" data-end="396.979">at the number of contributors individual</span> <span data-start="396.979" data-end="398.629">people who contribute to the codebase</span> <span data-start="398.629" data-end="400.909">react native is one of the top projects</span> <span data-start="400.909" data-end="404.569">and also it built a community around it</span> <span data-start="404.569" data-end="406.969">what I'm saying is that when we hire</span> <span data-start="406.969" data-end="409.849">people from outside to work on</span> <span data-start="409.849" data-end="412.309">marketplace those people are very likely</span> <span data-start="412.309" data-end="415.159">already familiar with our technology</span> <span data-start="415.159" data-end="417.8">technology and it means that they can be</span> <span data-start="417.8" data-end="422.269">productive straightaway so I just</span> <span data-start="422.269" data-end="424.699">described react native a JavaScript</span> <span data-start="424.699" data-end="426.74">framework that allowed us to grow the</span> <span data-start="426.74" data-end="430.579">team fast but what about javascript and</span> <span data-start="430.579" data-end="433.55">been building an application that works</span> <span data-start="433.55" data-end="436.669">fast javascript has a lot of things that</span> <span data-start="436.669" data-end="440.709">people people say that it's not good for</span> <span data-start="440.709" data-end="444.309">performance it's garbage collected</span> <span data-start="444.309" data-end="448.459">anyone else has ideas yes</span> <span data-start="448.459" data-end="450.919">dynamic typing I'm just kidding I</span> <span data-start="450.919" data-end="454.069">actually have it written here it has</span> <span data-start="454.069" data-end="456.769">module system that's not really mature</span> <span data-start="456.769" data-end="459.139">enough we have not different module</span> <span data-start="459.139" data-end="461.989">system it's single threaded how do you</span> <span data-start="461.989" data-end="463.999">build a UI when single threaded but</span> <span data-start="463.999" data-end="465.289">thankfully we actually have a</span> <span data-start="465.289" data-end="467.259">synchronous code and co-routines</span> <span data-start="467.259" data-end="469.879">but anyway a lot of people are biased</span> <span data-start="469.879" data-end="473.03">about javascript and there are reasons</span> <span data-start="473.03" data-end="476.33">so Facebook occasionally surveys people</span> <span data-start="476.33" data-end="478.61">who are using their applications and</span> <span data-start="478.61" data-end="480.83">there is a direct correlation between</span> <span data-start="480.83" data-end="483.98">how fast the application loads and how</span> <span data-start="483.98" data-end="485.69">satisfied are people with the</span> <span data-start="485.69" data-end="490.37">application and performance work that we</span> <span data-start="490.37" data-end="492.77">did on marketplace in the last year</span> <span data-start="492.77" data-end="495.29">shows that people engage more with the</span> <span data-start="495.29" data-end="497.66">application if it loads faster for every</span> <span data-start="497.66" data-end="499.55">hundred milliseconds there is a certain</span> <span data-start="499.55" data-end="501.86">percent of improvement of how people</span> <span data-start="501.86" data-end="504.56">engage with marketplace and I'm not</span> <span data-start="504.56" data-end="506.12">talking about just looking at the screen</span> <span data-start="506.12" data-end="507.89">and I'm going away I'm actually good I'm</span> </p>
<p><span data-start="507.89" data-end="510.2">I'm actually meaning that it sticks to</span> <span data-start="510.2" data-end="513.95">people if something loads fast so</span> <span data-start="513.95" data-end="516.83">Facebook application leadership spend</span> <span data-start="516.83" data-end="518.719">some time researching how fast the</span> <span data-start="518.719" data-end="520.88">application should be for people to feel</span> <span data-start="520.88" data-end="524.06">comfortable with it and in the last 40</span> <span data-start="524.06" data-end="526.04">years there have been a lot of</span> <span data-start="526.04" data-end="530.15">researches and the consensus is that if</span> <span data-start="530.15" data-end="532.76">the application if a computer system</span> <span data-start="532.76" data-end="535.1">refreshes a screen within one second</span> <span data-start="535.1" data-end="539.99">then people perceive that it's fast so</span> <span data-start="539.99" data-end="542.48">that was the goal for all the tabs at</span> </p>
<p><span data-start="542.48" data-end="545.33">Facebook how do we make them fast as in</span> <span data-start="545.33" data-end="548.75">load within one second and on a slow</span> <span data-start="548.75" data-end="551.26">device like this</span> <span data-start="551.26" data-end="554.78">Samsung j5 prime which is not a nicest</span> <span data-start="554.78" data-end="559.25">device that around but surprisingly it's</span> <span data-start="559.25" data-end="561.29">one of the most popular devices in the</span> <span data-start="561.29" data-end="564.08">world so we started with three and a</span> <span data-start="564.08" data-end="569.06">half seconds for 75% of people load in</span> <span data-start="569.06" data-end="571.76">marketplace and when we heard about the</span> <span data-start="571.76" data-end="573.589">goal we thought well it's a bit humorous</span> <span data-start="573.589" data-end="578.81">70 % improvement are you serious</span> <span data-start="578.81" data-end="582.26">a year passed and turns out they</span> <span data-start="582.26" data-end="584.33">believed in us and they were serious so</span> <span data-start="584.33" data-end="587.06">we are getting closer so what I'm going</span> <span data-start="587.06" data-end="590.3">to talk next about is how we achieved</span> <span data-start="590.3" data-end="593.15">that and I tried to focus on things that</span> <span data-start="593.15" data-end="595.61">you people working on react and react</span> <span data-start="595.61" data-end="597.98">native could actually bring it home and</span> <span data-start="597.98" data-end="601.61">reuse it and even though many people</span> <span data-start="601.61" data-end="604.1">hold JavaScript as a liability of react</span> <span data-start="604.1" data-end="607.49">native I think it's on the contrary we</span> <span data-start="607.49" data-end="610.31">have many years of experience optimizing</span> <span data-start="610.31" data-end="612.83">websites and if you haven't seen this</span> <span data-start="612.83" data-end="615.08">talk from ilya grigorik</span> <span data-start="615.08" data-end="618.14">from six years ago pretty much</span> <span data-start="618.14" data-end="620.81">everything applies to optimizing react</span> <span data-start="620.81" data-end="625.52">native so similar to optimizing websites</span> <span data-start="625.52" data-end="627.89">or any other application we start with</span> <span data-start="627.89" data-end="630.38">measuring all different sub spans how</span> <span data-start="630.38" data-end="633.14">things are loading then we find the slow</span> <span data-start="633.14" data-end="635.54">things and we make a decision it is</span> <span data-start="635.54" data-end="637.16">something that we really need at the</span> <span data-start="637.16" data-end="639.38">startup that we call the critical path</span> <span data-start="639.38" data-end="643.1">or is it something and if it is not</span> <span data-start="643.1" data-end="645.38">let's just do it later and if it is</span> <span data-start="645.38" data-end="647.39">let's do it in parallel with something</span> <span data-start="647.39" data-end="652.64">else so what's another cool thing about</span> </p>
<p><span data-start="652.64" data-end="655.13">JavaScript and ability to debug your</span> <span data-start="655.13" data-end="658.28">applications is that JavaScript can run</span> <span data-start="658.28" data-end="660.83">on many things and there is a feature</span> <span data-start="660.83" data-end="663.29">called debug JavaScript remotely on</span> <span data-start="663.29" data-end="665.39">react native and not a lot of people</span> <span data-start="665.39" data-end="667.55">realize that it's actually sending the</span> </p>
<p><span data-start="667.55" data-end="670.3">JavaScript application of react native</span> <span data-start="670.3" data-end="674.69">to the browser it executes their full</span> <span data-start="674.69" data-end="677.3">application builds the component tree</span> <span data-start="677.3" data-end="679.49">and then sends signal to the device</span> <span data-start="679.49" data-end="682.01">telling what needs to be rendered in the</span> <span data-start="682.01" data-end="684.8">native code so full JavaScript is for</span> <span data-start="684.8" data-end="687.35">real running in the browser and it means</span> <span data-start="687.35" data-end="689.24">that we have access to the development</span> <span data-start="689.24" data-end="691.07">tools that are coming with the browsers</span> <span data-start="691.07" data-end="692.39">for example in Chrome</span> </p>
<p><span data-start="692.39" data-end="695.18">I can click performance tab I can click</span> <span data-start="695.18" data-end="698.72">record and get some samples and then it</span> <span data-start="698.72" data-end="700.64">has a very good integration with react</span> <span data-start="700.64" data-end="702.56">and react native is running react.js</span> <span data-start="702.56" data-end="704.87">inside it so we actually have a very</span> <span data-start="704.87" data-end="707.48">nice flame chart of all the components</span> <span data-start="707.48" data-end="709.97">that are loading and we can see which</span> <span data-start="709.97" data-end="712.13">components are slow or which component</span> <span data-start="712.13" data-end="714.26">are unnecessary and we can make some</span> <span data-start="714.26" data-end="716.12">assumptions like let's let's not have</span> <span data-start="716.12" data-end="717.86">this component or let's let's optimize</span> <span data-start="717.86" data-end="720.86">that first now you have to take this</span> <span data-start="720.86" data-end="723.38">with a grain of salt because we're</span> <span data-start="723.38" data-end="726.35">running this on a desktop browser on</span> <span data-start="726.35" data-end="731.3">your powerful MacBook probably and it's</span> <span data-start="731.3" data-end="735.77">a v8 JavaScript engine on a real device</span> <span data-start="735.77" data-end="737.9">it will be a JavaScript core that runs</span> <span data-start="737.9" data-end="741.53">on Android and iOS and it's completely</span> <span data-start="741.53" data-end="743.84">different picture but if you really want</span> <span data-start="743.84" data-end="745.7">to have the same flame chart there is a</span> <span data-start="745.7" data-end="749.45">tool called systrace that just collects</span> <span data-start="749.45" data-end="751.58">the traces and it integrates with react</span> <span data-start="751.58" data-end="753.62">native and you can see how your</span> <span data-start="753.62" data-end="758">components work on a real device so</span> <span data-start="758" data-end="760.25">measuring performance is actually an art</span> <span data-start="760.25" data-end="763.19">we could be talking have a separate talk</span> <span data-start="763.19" data-end="765.59">about how to measure performance on a</span> <span data-start="765.59" data-end="767.33">group of people on a large group of</span> <span data-start="767.33" data-end="769.85">people how about the distributions</span> <span data-start="769.85" data-end="771.68">between different people what kind of</span> <span data-start="771.68" data-end="775.25">category of devices exists but I think</span> <span data-start="775.25" data-end="777.62">the first two tools that I showed you</span> <span data-start="777.62" data-end="781.01">could be a good start how to start</span> <span data-start="781.01" data-end="783.53">improving your performance so now let's</span> <span data-start="783.53" data-end="787.37">actually look at what things helped us</span> <span data-start="787.37" data-end="790.94">to improve react native so this one is</span> <span data-start="790.94" data-end="793.4">an obvious one I'm pretty sure everyone</span> <span data-start="793.4" data-end="795.19">who is running a mobile application</span> <span data-start="795.19" data-end="799.1">should be running their network requests</span> <span data-start="799.1" data-end="800.81">in parallel when things are loading</span> <span data-start="800.81" data-end="802.73">because you're doing stuff on the server</span> <span data-start="802.73" data-end="804.38">and stuff on the client they shouldn't</span> <span data-start="804.38" data-end="807.5">be interconnected however there is a</span> <span data-start="807.5" data-end="809.81">caveat I know some people are using</span> <span data-start="809.81" data-end="812.62">graph girl here who likes graph you'll</span> <span data-start="812.62" data-end="817.91">yeah so with mobile and graph QL and</span> </p>
<p><span data-start="817.91" data-end="819.91">JavaScript there is a caveat because</span> <span data-start="819.91" data-end="823.4">usually people using react native they</span> <span data-start="823.4" data-end="825.35">use JavaScript implementation of graph</span> <span data-start="825.35" data-end="827.69">queue for those who don't know what</span> <span data-start="827.69" data-end="831.29">graph QL is it's a it's a concept that</span> <span data-start="831.29" data-end="835.31">allows your components to define what</span> <span data-start="835.31" data-end="837.5">they need and it means that the query</span> <span data-start="837.5" data-end="841.22">for the data is based on the components</span> <span data-start="841.22" data-end="843.05">so you need a graphical engine that</span> <span data-start="843.05" data-end="844.91">would inspect your components build a</span> <span data-start="844.91" data-end="845.69">query</span> <span data-start="845.69" data-end="848.33">and then send this query and if it is in</span> </p>
<p><span data-start="848.33" data-end="851.24">JavaScript you see the blue line we need</span> <span data-start="851.24" data-end="853.58">to start up JavaScript VM we need to</span> <span data-start="853.58" data-end="855.56">start up react native we need to start</span> <span data-start="855.56" data-end="858.13">the bundle we need to find the graph QL</span> <span data-start="858.13" data-end="860.69">JavaScript implementation and then send</span> <span data-start="860.69" data-end="864.02">the request what we should be doing is</span> <span data-start="864.02" data-end="867.74">running it in parallel so if you are</span> <span data-start="867.74" data-end="870.47">using react native or a very similar</span> <span data-start="870.47" data-end="872.93">framework and the graph QL you should</span> <span data-start="872.93" data-end="874.76">the question how can I make the request</span> <span data-start="874.76" data-end="877.22">in parallel at Facebook we have a very</span> <span data-start="877.22" data-end="880.01">thin layer implemented in native code</span> <span data-start="880.01" data-end="882.91">that is capable of sending the request</span> <span data-start="882.91" data-end="886.25">from Java or from Objective C that's how</span> <span data-start="886.25" data-end="889.61">we achieve that also I brought you some</span> <span data-start="889.61" data-end="893.27">good news if you update to latest react</span> <span data-start="893.27" data-end="896.84">native you will know that it has the</span> <span data-start="896.84" data-end="900.05">latest JavaScript core engine for those</span> <span data-start="900.05" data-end="901.91">who don't know JavaScript core is the</span> </p>
<p><span data-start="901.91" data-end="904.07">JavaScript engine that react native is</span> <span data-start="904.07" data-end="906.83">using the problem is that it hasn't been</span> <span data-start="906.83" data-end="910.91">updated for two years and it has been 32</span> <span data-start="910.91" data-end="912.92">bits and now we have the latest one</span> <span data-start="912.92" data-end="915.82">that's 64 bits it's not only good for</span> <span data-start="915.82" data-end="918.47">library compatibility but also it comes</span> <span data-start="918.47" data-end="920.83">with two years of optimizations and</span> <span data-start="920.83" data-end="923.72">performance tweaks it's one of the</span> <span data-start="923.72" data-end="925.37">easiest things that that you can</span> <span data-start="925.37" data-end="926.96">actually do to improve your reg native</span> <span data-start="926.96" data-end="931.01">performance oh this one is really cool</span> <span data-start="931.01" data-end="933.02">but legal department didn't allow me to</span> <span data-start="933.02" data-end="935.26">mention anything about it</span> <span data-start="935.26" data-end="938.54">just imagine unicorns exploding with</span> <span data-start="938.54" data-end="943.88">jelly beans moving on now let's talk</span> <span data-start="943.88" data-end="945.98">about what we can do to the JavaScript</span> <span data-start="945.98" data-end="949.19">bundle by default all react native</span> <span data-start="949.19" data-end="953.39">surfaces in our application are compiled</span> <span data-start="953.39" data-end="955.82">in one JavaScript file this is a very</span> <span data-start="955.82" data-end="958.57">common technique anyone using webpack</span> <span data-start="958.57" data-end="962.24">pretty much everyone so it compiles all</span> <span data-start="962.24" data-end="964.67">the JavaScript in one javascript file it</span> <span data-start="964.67" data-end="967.4">gets zipped and sent over the network to</span> <span data-start="967.4" data-end="970.28">the device with react native it's a</span> <span data-start="970.28" data-end="971.78">little bit different we want to optimize</span> <span data-start="971.78" data-end="974.51">it differently the problem is that this</span> </p>
<p><span data-start="974.51" data-end="976.61">JavaScript on react native is actually</span> <span data-start="976.61" data-end="978.8">part of the application</span> <span data-start="978.8" data-end="982.16">and if we want to load any react native</span> <span data-start="982.16" data-end="985.25">screen we need to read this file and if</span> <span data-start="985.25" data-end="988.01">it's large like sex may six megabytes or</span> <span data-start="988.01" data-end="990.74">maybe 20 megabytes it's quite heavy for</span> <span data-start="990.74" data-end="995.6">IO it will take time to load so ideally</span> <span data-start="995.6" data-end="997.279">we want to split it into two like</span> <span data-start="997.279" data-end="1000.54">webpack can do you can have a very small</span> <span data-start="1000.54" data-end="1003.04">javascript bundle for the your initial</span> <span data-start="1003.04" data-end="1005.26">screen and then you can load other</span> <span data-start="1005.26" data-end="1008.02">things later for example unclick or</span> <span data-start="1008.02" data-end="1011.29">maybe it's a different surface now the</span> <span data-start="1011.29" data-end="1012.79">trick is that actually for react native</span> <span data-start="1012.79" data-end="1014.68">we don't need to do that there is a</span> <span data-start="1014.68" data-end="1016.839">feature called Ram bundles it's a fancy</span> <span data-start="1016.839" data-end="1021.7">name means random access memory but what</span> <span data-start="1021.7" data-end="1023.41">it actually does it compels every</span> </p>
<p><span data-start="1023.41" data-end="1025.99">JavaScript module is its own file and</span> <span data-start="1025.99" data-end="1030.309">puts it in the application so we when</span> <span data-start="1030.309" data-end="1032.14">you start up your application you only</span> <span data-start="1032.14" data-end="1034.66">read the modules that are required in</span> <span data-start="1034.66" data-end="1038.62">your initial startup path and it means</span> <span data-start="1038.62" data-end="1040.809">that you only pay I owe only for the</span> <span data-start="1040.809" data-end="1044.55">modules that you need now talking about</span> <span data-start="1044.55" data-end="1049.48">requires and imports let's imagine we</span> <span data-start="1049.48" data-end="1053.47">have a very heavy component like I even</span> <span data-start="1053.47" data-end="1057.28">called it very expensive and let's say</span> <span data-start="1057.28" data-end="1058.87">it does something nasty not just this</span> <span data-start="1058.87" data-end="1061.24">console log that indicates that's</span> <span data-start="1061.24" data-end="1062.83">something I still like it it mines a</span> <span data-start="1062.83" data-end="1066.16">Bitcoin for you now you want to use this</span> <span data-start="1066.16" data-end="1067.9">component but you know that it mines a</span> <span data-start="1067.9" data-end="1069.97">bit going so it's very slow so what you</span> <span data-start="1069.97" data-end="1072.73">do when you use it on line 20 you say</span> <span data-start="1072.73" data-end="1074.26">hey don't load this very expensive</span> <span data-start="1074.26" data-end="1077.679">component before I make a click there's</span> <span data-start="1077.679" data-end="1080.23">a conditional for the state but you</span> <span data-start="1080.23" data-end="1081.94">didn't know that import is actually</span> <span data-start="1081.94" data-end="1084.49">eagerly loading and it means when we</span> <span data-start="1084.49" data-end="1087.7">have on line 3 import very expensive</span> <span data-start="1087.7" data-end="1089.38">component you actually get a bit Co in</span> <span data-start="1089.38" data-end="1093.73">mind we don't want global code executed</span> <span data-start="1093.73" data-end="1096.64">during our startup time so what we can</span> <span data-start="1096.64" data-end="1099.37">do is change the import into the old</span> <span data-start="1099.37" data-end="1103.3">common GS require that allows you to</span> <span data-start="1103.3" data-end="1106.45">import files within the functions so we</span> <span data-start="1106.45" data-end="1109.39">define a new variable called lead very</span> <span data-start="1109.39" data-end="1112.6">expensive it's  by default</span> <span data-start="1112.6" data-end="1115.81">and then on the key press we say require</span> <span data-start="1115.81" data-end="1118.48">this module and then it becomes</span> <span data-start="1118.48" data-end="1121.54">available as a as something to render</span> <span data-start="1121.54" data-end="1124.09">now obviously you don't want to do it</span> <span data-start="1124.09" data-end="1127.6">for everything in your application so</span> <span data-start="1127.6" data-end="1129.58">thankfully react native packager that's</span> <span data-start="1129.58" data-end="1132.49">called Metro bundler has this setting</span> <span data-start="1132.49" data-end="1134.62">that automatically translates all your</span> <span data-start="1134.62" data-end="1137.92">imports into these require statements so</span> <span data-start="1137.92" data-end="1141.07">you can write idiomatic JavaScript but</span> <span data-start="1141.07" data-end="1142.83">it's smart enough to find that</span> <span data-start="1142.83" data-end="1145.27">components are not used during the</span> <span data-start="1145.27" data-end="1147.22">startup it converts them into require</span> <span data-start="1147.22" data-end="1149.68">statements and you don't pay the extra</span> <span data-start="1149.68" data-end="1158.86">thing so we talked about what things you</span> <span data-start="1158.86" data-end="1161.68">can do with your configurations and then</span> <span data-start="1161.68" data-end="1164.47">other people built parts of your</span> <span data-start="1164.47" data-end="1167.17">application build frameworks for you and</span> <span data-start="1167.17" data-end="1169.63">you can just tweak some knobs and get it</span> <span data-start="1169.63" data-end="1173.14">work faster now let's talk about what</span> <span data-start="1173.14" data-end="1178.3">you can do to your production code so</span> <span data-start="1178.3" data-end="1180.34">you can find a lot of information on the</span> <span data-start="1180.34" data-end="1182.65">web about optimizing react components</span> <span data-start="1182.65" data-end="1186.1">the gist of it is we don't want to call</span> <span data-start="1186.1" data-end="1188.38">render function multiple times for your</span> <span data-start="1188.38" data-end="1191.08">component and react is very generous</span> <span data-start="1191.08" data-end="1192.67">about cold in render because it's</span> <span data-start="1192.67" data-end="1196.39">supposed to be fast however if it's</span> <span data-start="1196.39" data-end="1200.07">critical for you to don't call extra</span> <span data-start="1200.07" data-end="1204.13">extra extra times the component then you</span> <span data-start="1204.13" data-end="1209.44">you can do some tricks so here is a</span> <span data-start="1209.44" data-end="1213.23">common way of how we can avoid it</span> <span data-start="1213.24" data-end="1215.74">this component implemented should</span> <span data-start="1215.74" data-end="1219.76">component update function the idea is if</span> <span data-start="1219.76" data-end="1222.37">it returns true then the render function</span> <span data-start="1222.37" data-end="1224.56">will be called and if it returns false</span> <span data-start="1224.56" data-end="1226.93">react will trust you that this component</span> <span data-start="1226.93" data-end="1230.59">shouldn't be rendered in this case we</span> <span data-start="1230.59" data-end="1232.87">look at the property color and we say</span> <span data-start="1232.87" data-end="1235.57">only update this component only rerender</span> <span data-start="1235.57" data-end="1239.98">this component when color changes this</span> <span data-start="1239.98" data-end="1242.98">this concept is very popular so there is</span> <span data-start="1242.98" data-end="1245.86">a pure component in react what it does</span> <span data-start="1245.86" data-end="1246.46">it</span> <span data-start="1246.46" data-end="1248.2">matically implements should component</span> <span data-start="1248.2" data-end="1251.26">update for you and only calls rerender</span> <span data-start="1251.26" data-end="1257.98">when a prop changes and I'd like to</span> <span data-start="1257.98" data-end="1261.37">finish my talk on a point that focusing</span> <span data-start="1261.37" data-end="1264.01">on perception can give you more results</span> <span data-start="1264.01" data-end="1267.3">than actually grinding the components</span> <span data-start="1267.3" data-end="1269.05">here is what I mean</span> <span data-start="1269.05" data-end="1273.04">by default react built a component tree</span> <span data-start="1273.04" data-end="1275.98">depth first so we have some top</span> <span data-start="1275.98" data-end="1278.89">component and it goes down down down to</span> <span data-start="1278.89" data-end="1281.2">the most inner component in it</span> <span data-start="1281.2" data-end="1284.11">then goes up up up by the stack then</span> <span data-start="1284.11" data-end="1286.33">goes again and it kind of builds the</span> <span data-start="1286.33" data-end="1290.98">whole tree now react fiber is coming to</span> <span data-start="1290.98" data-end="1293.5">react native soon but for now we don't</span> <span data-start="1293.5" data-end="1295.63">have this way to prioritize things how</span> <span data-start="1295.63" data-end="1299.02">to load them so for example in</span> <span data-start="1299.02" data-end="1301.99">marketplace we can decide that hey user</span> <span data-start="1301.99" data-end="1306.04">content is more important than a fancy</span> <span data-start="1306.04" data-end="1308.8">navigation at the top and we could save</span> <span data-start="1308.8" data-end="1310.96">50 milliseconds by just delaying the</span> <span data-start="1310.96" data-end="1314.2">navigation the header and show the</span> <span data-start="1314.2" data-end="1316.39">components the user content that people</span> <span data-start="1316.39" data-end="1319.78">could engage with here is how you can do</span> <span data-start="1319.78" data-end="1322.63">it with react native so you can define</span> <span data-start="1322.63" data-end="1322.96">that</span> <span data-start="1322.96" data-end="1325.09">alright this header is very expensive I</span> <span data-start="1325.09" data-end="1327.37">don't want to have to render it from the</span> <span data-start="1327.37" data-end="1333.1">first go but how do I know that it got</span> <span data-start="1333.1" data-end="1335.5">rendered at all because components are</span> <span data-start="1335.5" data-end="1338.02">built in JavaScript and code is rendered</span> <span data-start="1338.02" data-end="1341.02">in the native that and there is some</span> <span data-start="1341.02" data-end="1342.79">communication between those threads but</span> <span data-start="1342.79" data-end="1344.65">they are completely independent you</span> <span data-start="1344.65" data-end="1347.32">cannot just say wait 400 milliseconds</span> <span data-start="1347.32" data-end="1349.33">and then render the header because a</span> <span data-start="1349.33" data-end="1351.07">hundred milliseconds on a slow device</span> <span data-start="1351.07" data-end="1353.77">may pass and you start rendering the</span> <span data-start="1353.77" data-end="1356.26">header before anything rendered on the</span> <span data-start="1356.26" data-end="1359.17">screen so you slow it down but we have a</span> <span data-start="1359.17" data-end="1361.48">trick for example I created a little</span> <span data-start="1361.48" data-end="1365.38">view component on line 23 and it has an</span> <span data-start="1365.38" data-end="1368.02">own layout callback this view is</span> <span data-start="1368.02" data-end="1371.56">actually invisible but react native</span> <span data-start="1371.56" data-end="1374.8">still renders it when we have this view</span> <span data-start="1374.8" data-end="1377.08">rendered we know that hey something this</span> <span data-start="1377.08" data-end="1379.03">component already was rendered by the</span> <span data-start="1379.03" data-end="1379.97">native code</span> <span data-start="1379.97" data-end="1382.46">so we can do things that we wanted to</span> <span data-start="1382.46" data-end="1385.61">delay so it has the only out callback</span> <span data-start="1385.61" data-end="1388.519">that goes to line seven and that's when</span> <span data-start="1388.519" data-end="1390.47">we change the state of the component and</span> <span data-start="1390.47" data-end="1395.36">say hey I render other things now as a</span> <span data-start="1395.36" data-end="1397.899">matter of fact in marketplace this was</span> <span data-start="1397.899" data-end="1400.34">one of the most common things that we</span> <span data-start="1400.34" data-end="1403.279">have been doing reg native application</span> <span data-start="1403.279" data-end="1406.309">is just one large component that goes</span> <span data-start="1406.309" data-end="1408.919">into more smaller components and in</span> <span data-start="1408.919" data-end="1410.809">marketplace we were saying alright this</span> <span data-start="1410.809" data-end="1413.509">looks like a heavy component let's delay</span> <span data-start="1413.509" data-end="1416.45">it the problem is that we have a large</span> <span data-start="1416.45" data-end="1419.36">team and a lot of features so these</span> <span data-start="1419.36" data-end="1421.789">components started piling up and of</span> <span data-start="1421.789" data-end="1423.379">course we started delaying them but</span> <span data-start="1423.379" data-end="1425.84">there are a lot of layers a lot of</span> <span data-start="1425.84" data-end="1429.049">things that javascript has still to go</span> <span data-start="1429.049" data-end="1432.47">through and when we measure when we</span> <span data-start="1432.47" data-end="1434.899">measure this this just didn't sit with</span> <span data-start="1434.899" data-end="1438.559">me right right we spent 500 milliseconds</span> <span data-start="1438.559" data-end="1442">on a slow device to render this screen</span> <span data-start="1442" data-end="1444.35">because we have flat list we have many</span> <span data-start="1444.35" data-end="1446.09">things we still delay them but we can</span> <span data-start="1446.09" data-end="1448.37">delay everything because the code will</span> <span data-start="1448.37" data-end="1453.08">be really hard to read but really I can</span> <span data-start="1453.08" data-end="1455.179">implement this thing from scratch and it</span> <span data-start="1455.179" data-end="1457.97">would run under 200 milliseconds because</span> <span data-start="1457.97" data-end="1461.09">it's just four images I can just do a</span> <span data-start="1461.09" data-end="1465.59">view and put images in there so we</span> <span data-start="1465.59" data-end="1468.379">thought about it and we implemented this</span> <span data-start="1468.379" data-end="1471.289">we decided to do a little trick so we</span> <span data-start="1471.289" data-end="1476.09">implement the light one and then destroy</span> <span data-start="1476.09" data-end="1479.809">it and render the full view with all the</span> <span data-start="1479.809" data-end="1481.94">flag stars and craft and of course this</span> <span data-start="1481.94" data-end="1483.529">is not shippable this is a terrible</span> <span data-start="1483.529" data-end="1486.23">experience because it blinks but not</span> <span data-start="1486.23" data-end="1488.539">everyone knows that react native has a</span> <span data-start="1488.539" data-end="1492.2">very good animation library that allows</span> <span data-start="1492.2" data-end="1495.35">you to run an animation when a component</span> <span data-start="1495.35" data-end="1498.74">is destroyed so for a couple of weeks we</span> <span data-start="1498.74" data-end="1501.409">tested a few ideas and this is what we</span> <span data-start="1501.409" data-end="1504.35">settle to it we render the light view</span> <span data-start="1504.35" data-end="1507.35">with the runs within 200 milliseconds in</span> <span data-start="1507.35" data-end="1510.11">the background we build the full view</span> <span data-start="1510.11" data-end="1512.059">with all the crafts that takes 500</span> <span data-start="1512.059" data-end="1512.65">millisecond</span> <span data-start="1512.65" data-end="1515.83">then we destroy the light one and we</span> <span data-start="1515.83" data-end="1518.62">animate in with a fade out into the</span> <span data-start="1518.62" data-end="1520.15">thing that's already in the background</span> <span data-start="1520.15" data-end="1524.8">this way we have quite indistinguishable</span> <span data-start="1524.8" data-end="1527.2">change but at the same time the light</span> <span data-start="1527.2" data-end="1529.09">view is already clickable and people can</span> <span data-start="1529.09" data-end="1532.17">engage with the application much sooner</span> <span data-start="1532.17" data-end="1535.39">so lets me summarize what I talked about</span> <span data-start="1535.39" data-end="1536.05">today</span> </p>
<p><span data-start="1536.05" data-end="1537.88">Market Place is on a great trajectory</span> <span data-start="1537.88" data-end="1541.42">and keeps growing react native is one of</span> <span data-start="1541.42" data-end="1544.15">the tools to satisfy the product growth</span> <span data-start="1544.15" data-end="1547.48">needs and we can use our experience from</span> <span data-start="1547.48" data-end="1549.25">the web from optimizing all those</span> <span data-start="1549.25" data-end="1551.95">websites for many years and apply it to</span> <span data-start="1551.95" data-end="1554.92">react native and in general mobile J's</span> <span data-start="1554.92" data-end="1564.08">on mobile that's all</span> </p>
</section>