<section>
<p><span data-start="7.67" data-end="10.769">so let's talk about p oj s first of all</span> <span data-start="10.769" data-end="12.57">thank you all for coming here I know</span> <span data-start="12.57" data-end="14.82">that I'm competing this fall down stairs</span> <span data-start="14.82" data-end="17.01">so I'm amazed as many people came here I</span> <span data-start="17.01" data-end="18.539">would be in vaults talk right now but I</span> <span data-start="18.539" data-end="21.72">have to get the talk right now so my</span> <span data-start="21.72" data-end="23.369">name is on us Carl I've work this was a</span> <span data-start="23.369" data-end="25.14">lot and this work i'm presenting today</span> <span data-start="25.14" data-end="28.23">was made by by now something like 15</span> <span data-start="28.23" data-end="29.91">contributors that are not all on a slide</span> <span data-start="29.91" data-end="31.65">one person is gonna slide is julian</span> <span data-start="31.65" data-end="33.21">actually made the slides for me he's</span> <span data-start="33.21" data-end="35.28">also half a PDF of GS offers so Julian</span> <span data-start="35.28" data-end="41.34">raise your hand hi Julian yeah p Please</span> <span data-start="41.34" data-end="42.96">time Julian you don't have look at</span> <span data-start="42.96" data-end="44.61">montes kind of slides I usually make</span> <span data-start="44.61" data-end="47.55">that's a big plus so I'm going to talk</span> <span data-start="47.55" data-end="49.5">to the what PR rendering and about</span> <span data-start="49.5" data-end="51.329">structure PDF and how we do this in PDF</span> </p>
<p><span data-start="51.329" data-end="54.93">OGS about images and fonts but also I</span> <span data-start="54.93" data-end="56.219">would have spent quite a bit of time on</span> <span data-start="56.219" data-end="58.289">the problems he encounters encountered</span> <span data-start="58.289" data-end="60.719">and also actual performance problems</span> <span data-start="60.719" data-end="64.019">around here and I want to show you what</span> <span data-start="64.019" data-end="65.159">kind of things are really important to</span> <span data-start="65.159" data-end="66.45">optimize if you are looking at system</span> <span data-start="66.45" data-end="68.34">like this and then we conclude is a to</span> <span data-start="68.34" data-end="70.56">do and the to do list or PM tjs and</span> <span data-start="70.56" data-end="74.01">double gatorade MO so the goal of the</span> </p>
<p><span data-start="74.01" data-end="75.84">PDF ojs project was to produce a</span> <span data-start="75.84" data-end="78.99">faithful high quality fast efficient PDF</span> <span data-start="78.99" data-end="81.21">renderer and by the time we started this</span> <span data-start="81.21" data-end="82.92">project really the motivation for us was</span> <span data-start="82.92" data-end="85.38">to find out what is possible to use the</span> </p>
<p><span data-start="85.38" data-end="88.32">HTML Javascript platform to build a PDF</span> <span data-start="88.32" data-end="89.909">member at that point they were a couple</span> <span data-start="89.909" data-end="91.979">connect to a PDF renderers for tiny</span> <span data-start="91.979" data-end="95.1">subset or maybe can not draw figures PDF</span> <span data-start="95.1" data-end="97.47">like render commands but collection PDF</span> <span data-start="97.47" data-end="99.03">renderer and all browsers at that point</span> <span data-start="99.03" data-end="101.88">you're using native code to do PDF</span> <span data-start="101.88" data-end="104.25">rendering so chrome for example embeds</span> <span data-start="104.25" data-end="106.259">is like commercial foxit PDF renderer</span> <span data-start="106.259" data-end="108.39">and we were just wondering why it's not</span> <span data-start="108.39" data-end="109.68">being done in javascript in order to</span> <span data-start="109.68" data-end="111.54">find out and personally I'm not reading</span> <span data-start="111.54" data-end="114">a web authoring a platform engineer I'm</span> <span data-start="114" data-end="115.259">a browser platform so I was curious</span> <span data-start="115.259" data-end="116.79">whether there are things in a platform</span> <span data-start="116.79" data-end="118.259">that some are prohibitive maybe it's a</span> <span data-start="118.259" data-end="120.45">slow features on the same so there's one</span> <span data-start="120.45" data-end="121.979">experiment in browser technology with</span> <span data-start="121.979" data-end="126.03">event PDF entering and really the the</span> <span data-start="126.03" data-end="127.77">main goal from this perspective being a</span> <span data-start="127.77" data-end="129.78">browser implementer is you want to avoid</span> <span data-start="129.78" data-end="131.08">having native code no platform</span> <span data-start="131.08" data-end="134.25">of former vp engineering of mozilla</span> <span data-start="134.25" data-end="136.27">affectionately called Acrobat Reader or</span> <span data-start="136.27" data-end="138.18">popular native code execution format</span> <span data-start="138.18" data-end="140.56">there's every time you put native code</span> <span data-start="140.56" data-end="142.18">into a browser there's always a risk if</span> <span data-start="142.18" data-end="144.37">getting it exploited and PDF readers</span> <span data-start="144.37" data-end="146.53">have been exploiting a pass intensively</span> <span data-start="146.53" data-end="148.96">so the last major iPhone exploit wall</span> <span data-start="148.96" data-end="151.87">space on the PDF reader in the iPhone</span> <span data-start="151.87" data-end="155.53">itself so using the web to build these</span> <span data-start="155.53" data-end="158.14">pieces gives us a secure platform where</span> <span data-start="158.14" data-end="160.21">you can run PDF documents display that</span> <span data-start="160.21" data-end="161.98">may don't with your risk of being taking</span> <span data-start="161.98" data-end="164.97">about shop so that's at the PDF format</span> </p>
<p><span data-start="164.97" data-end="167.35">PDF is kind of pretty standard document</span> <span data-start="167.35" data-end="169.36">format it looks very similar to unlock</span> <span data-start="169.36" data-end="170.83">my formats like your documents there's a</span> <span data-start="170.83" data-end="172.09">header that tell us a little bit about a</span> <span data-start="172.09" data-end="175.209">PDF version and this an actual body wrap</span> <span data-start="175.209" data-end="179.26">contains streamed objects that are</span> <span data-start="179.26" data-end="180.91">identified by a position into the file</span> <span data-start="180.91" data-end="183.04">and this building an object or after</span> <span data-start="183.04" data-end="184.51">concepts of the different pages that are</span> <span data-start="184.51" data-end="185.83">linked together to a document and</span> <span data-start="185.83" data-end="187.69">individual pages of rendering commands</span> <span data-start="187.69" data-end="189.64">and images and so on and then at the end</span> <span data-start="189.64" data-end="191.98">of documents there's a table the xref</span> <span data-start="191.98" data-end="194.83">table and this provides click mapping of</span> <span data-start="194.83" data-end="197.11">object ids to index us into the file so</span> <span data-start="197.11" data-end="198.58">this is what you use to achieve fine</span> <span data-start="198.58" data-end="200.2">individual objects in this large file</span> <span data-start="200.2" data-end="202.63">and this fights going to be large that's</span> <span data-start="202.63" data-end="203.89">a megabyte so it's really important to</span> <span data-start="203.89" data-end="205.239">have a central point where you can find</span> <span data-start="205.239" data-end="208.06">them and then the trailer at the very</span> <span data-start="208.06" data-end="209.38">end of the file kind of tells you how</span> <span data-start="209.38" data-end="211.18">you can find to the root of this object</span> <span data-start="211.18" data-end="214.209">tree and when this PDF format was</span> <span data-start="214.209" data-end="216.7">specified many many years ago it's kind</span> <span data-start="216.7" data-end="219.04">of predated really exchanging data or</span> <span data-start="219.04" data-end="221.23">the wire so I just for my country not</span> <span data-start="221.23" data-end="224.68">very suitable to actually be transferred</span> <span data-start="224.68" data-end="225.67">because you have too busy fetch the</span> <span data-start="225.67" data-end="227.23">entire file all the way the last bite</span> <span data-start="227.23" data-end="228.97">before you can display any single page</span> <span data-start="228.97" data-end="230.38">so by now there are couple additional</span> <span data-start="230.38" data-end="231.88">extensions to this format but it can</span> <span data-start="231.88" data-end="234.34">only just fetch some parts of it and</span> <span data-start="234.34" data-end="236.2">stuff like that so there's like</span> <span data-start="236.2" data-end="237.55">complications on top of this but this is</span> <span data-start="237.55" data-end="240.7">the basic structure the video processing</span> <span data-start="240.7" data-end="242.11">this is for currently loading the entire</span> <span data-start="242.11" data-end="244.84">file with six HR into an array but we</span> <span data-start="244.84" data-end="246.82">can also support very easily this idea</span> <span data-start="246.82" data-end="248.65">of having range requests only get parts</span> <span data-start="248.65" data-end="250.239">of the files you can quickly window</span> <span data-start="250.239" data-end="252.79">these things and you basically you</span> <span data-start="252.79" data-end="254.5">create a PDF document object around that</span> <span data-start="254.5" data-end="256.989">and you can fetch pages from that the</span> <span data-start="256.989" data-end="260.65">document and these two stages to</span> <span data-start="260.65" data-end="263.38">rendering first we start rendering by</span> <span data-start="263.38" data-end="264.37">providing a graphics</span> <span data-start="264.37" data-end="267.49">context and the page and this is going</span> <span data-start="267.49" data-end="269.02">to go and read all the objects</span> <span data-start="269.02" data-end="270.46">associated with that page which contains</span> <span data-start="270.46" data-end="274.18">of rendering objects and images and it's</span> <span data-start="274.18" data-end="275.229">going to process all of them to identify</span> <span data-start="275.229" data-end="277.18">resources we have to load before we can</span> <span data-start="277.18" data-end="278.949">actually display the page and then once</span> <span data-start="278.949" data-end="281.65">those resources have been loaded in</span> <span data-start="281.65" data-end="283.27">particular fonts and images then we can</span> <span data-start="283.27" data-end="285.639">actually execute is the sequence of</span> <span data-start="285.639" data-end="287.77">commands that we have just reported for</span> <span data-start="287.77" data-end="289.93">the page this is important because in a</span> <span data-start="289.93" data-end="292.78">general HTML page when you apply some</span> <span data-start="292.78" data-end="296.74">custom font by CSS then the CSS rule</span> <span data-start="296.74" data-end="298.389">takes a moment to load they can just go</span> <span data-start="298.389" data-end="300.13">ahead and render the page miss of their</span> <span data-start="300.13" data-end="301.6">own font and the browser automatically</span> <span data-start="301.6" data-end="303.31">is going to we render the page assume</span> <span data-start="303.31" data-end="305.08">the actual CSS rule and the font is</span> <span data-start="305.08" data-end="307.449">available for canvas unfortunate is not</span> <span data-start="307.449" data-end="309.639">being done so if you set a new font on</span> <span data-start="309.639" data-end="311.199">canvas and don't wait for the browser to</span> <span data-start="311.199" data-end="312.58">load it and start drawing you just get</span> <span data-start="312.58" data-end="314.35">the bad font in there in its it so to</span> <span data-start="314.35" data-end="316.36">avoid that be basically that's what we</span> <span data-start="316.36" data-end="318.729">record these pdfs home as first and then</span> <span data-start="318.729" data-end="320.05">load the font the months of font is</span> <span data-start="320.05" data-end="321.55">loaded then they actually display the</span> <span data-start="321.55" data-end="326.47">page so here's an example of a PDF file</span> <span data-start="326.47" data-end="328.03">and an object on this kind of PDF file</span> <span data-start="328.03" data-end="331.11">so object number three is a page in this</span> <span data-start="331.11" data-end="333.55">this PDF document and have read two</span> <span data-start="333.55" data-end="335.41">important parts when it's the resource</span> <span data-start="335.41" data-end="337.9">part where funds and graphic objects are</span> <span data-start="337.9" data-end="339.4">in and then contents is the actual</span> <span data-start="339.4" data-end="341.11">command screen that renders a PDF</span> <span data-start="341.11" data-end="345.13">document so initially we attach numbered</span> <span data-start="345.13" data-end="347.02">option number three if you say get page</span> <span data-start="347.02" data-end="348.82">and then if you start rendering we have</span> <span data-start="348.82" data-end="350.53">to fetch the resources and actual</span> <span data-start="350.53" data-end="352.96">content and parcels further and this is</span> <span data-start="352.96" data-end="354.669">what the extra content stream of this</span> <span data-start="354.669" data-end="356.919">page he looks like it's a sequence of</span> <span data-start="356.919" data-end="359.41">commands here streams can Adobe's way of</span> <span data-start="359.41" data-end="361.479">saying array so it's just an array of</span> <span data-start="361.479" data-end="363.699">commands that executes in sequence in</span> <span data-start="363.699" data-end="364.84">this very different commands here the</span> <span data-start="364.84" data-end="366.91">first one sets a graphic state this is</span> <span data-start="366.91" data-end="369.34">the second one is the s0 there that's a</span> <span data-start="369.34" data-end="372.22">fun command it says select 10 and then</span> <span data-start="372.22" data-end="373.9">you can see actually text go on commands</span> <span data-start="373.9" data-end="378.97">the middle part of it and if you were to</span> <span data-start="378.97" data-end="380.71">look at a PDF document in a text editor</span> <span data-start="380.71" data-end="382.479">and it's not encrypted and it's not</span> <span data-start="382.479" data-end="383.8">compressed you would actually literally</span> <span data-start="383.8" data-end="385.57">see this text here so it's a text-based</span> <span data-start="385.57" data-end="390.19">format however to achieve better achieve</span> <span data-start="390.19" data-end="392.409">small documents frequently is actually</span> <span data-start="392.409" data-end="395.08">compressed with zip so basically the</span> <span data-start="395.08" data-end="396.62">stream part isn't taken and compare</span> <span data-start="396.62" data-end="400.52">it's a simple deflate algorithm so in</span> <span data-start="400.52" data-end="402.08">this first step that we collect all the</span> <span data-start="402.08" data-end="404.54">resources we walk the extra catalog and</span> <span data-start="404.54" data-end="405.889">find all these different funds and</span> <span data-start="405.889" data-end="407.81">anything else you need and apparently</span> <span data-start="407.81" data-end="410.69">build an intermediate presentation that</span> <span data-start="410.69" data-end="412.669">contains all the rendering commands that</span> <span data-start="412.669" data-end="415.49">we encounter and again we cannot execute</span> <span data-start="415.49" data-end="417.5">them yet because we have not loaded all</span> <span data-start="417.5" data-end="419">the resources associated with it so you</span> <span data-start="419" data-end="420.65">can see here that we set the graphic</span> <span data-start="420.65" data-end="422.24">stage and then we nor this dependency</span> <span data-start="422.24" data-end="424.52">this actually goes off and files off a</span> <span data-start="424.52" data-end="426.38">custom CSS rule that attaches to the</span> <span data-start="426.38" data-end="429.49">document to load the font and the</span> <span data-start="429.49" data-end="431.57">satphone command here cannot be executed</span> <span data-start="431.57" data-end="433.52">yet we are destroying this in an array</span> <span data-start="433.52" data-end="435.71">as soon the actual font loading is</span> <span data-start="435.71" data-end="437">complete then you can execute this</span> <span data-start="437" data-end="439.19">sequence and the rest of the IR looks</span> <span data-start="439.19" data-end="441.02">pretty much like a canvas interface so</span> <span data-start="441.02" data-end="442.25">canvas is currently the back end we are</span> <span data-start="442.25" data-end="445.01">using and it's roughly the same commands</span> <span data-start="445.01" data-end="447.68">that are also in canvas though one minor</span> <span data-start="447.68" data-end="448.789">difference is that we actually keep</span> <span data-start="448.789" data-end="450.289">track of the state of a per serve and</span> <span data-start="450.289" data-end="452.419">texas output it so not everything in PDF</span> <span data-start="452.419" data-end="454.94">is absolute position actual text you</span> <span data-start="454.94" data-end="456.8">have to measure how long the virtus and</span> <span data-start="456.8" data-end="458.51">then position refers to the air since</span> <span data-start="458.51" data-end="459.77">there might be more text showing up</span> <span data-start="459.77" data-end="464.45">without an extra positioning so once</span> <span data-start="464.45" data-end="465.62">then all the phones are loaded then we</span> <span data-start="465.62" data-end="466.55">can't you go ahead and execute the</span> <span data-start="466.55" data-end="468.02">sequence of commands and all the funds</span> <span data-start="468.02" data-end="469.729">will be available and all the images we</span> <span data-start="469.729" data-end="471.2">are payable and we can draw them to a</span> <span data-start="471.2" data-end="475.34">canvas and that's it images so PDF</span> <span data-start="475.34" data-end="476.419">documents can contain a bunch of</span> <span data-start="476.419" data-end="478.4">different image formats this is like</span> <span data-start="478.4" data-end="480.62">eight or nine different ones pretty</span> <span data-start="480.62" data-end="483.289">common one is jpg and then we first</span> <span data-start="483.289" data-end="484.7">started this we did a little experiment</span> <span data-start="484.7" data-end="487.28">of implementing jtag just in JavaScript</span> <span data-start="487.28" data-end="489.11">they turned out to be really really slow</span> <span data-start="489.11" data-end="490.46">something like 10 to 100 x slower</span> <span data-start="490.46" data-end="492.5">depending on what exactly the JPEG file</span> <span data-start="492.5" data-end="493.97">look like so what we ended up doing</span> <span data-start="493.97" data-end="495.86">instead is since the format stalls</span> <span data-start="495.86" data-end="497.93">natively supported by the browser we</span> <span data-start="497.93" data-end="499.55">just take the content of the file and</span> <span data-start="499.55" data-end="501.56">basically for encode it and then stick</span> <span data-start="501.56" data-end="503.93">it back into a Dom element that does the</span> <span data-start="503.93" data-end="507.53">actual decoding work for us and if it's</span> <span data-start="507.53" data-end="509.09">not a JPEG stream then we have to do the</span> <span data-start="509.09" data-end="510.889">manual the corn by hand there's a bunch</span> <span data-start="510.889" data-end="512.39">of different formats if it is at four so</span> </p>
<p><span data-start="512.39" data-end="514.57">PNG for example can appear NPS</span> <span data-start="514.57" data-end="516.89">unfortunately the pd a —  the PNG format</span> <span data-start="516.89" data-end="519.169">that we use is not exactly the Veda PNG</span> <span data-start="519.169" data-end="520.909">standard looks like there's a couple of</span> <span data-start="520.909" data-end="523.219">different things in there I'm not sure</span> <span data-start="523.219" data-end="524.6">it'll become available so I think by the</span> <span data-start="524.6" data-end="526.43">time that it is they avoid the sound of</span> <span data-start="526.43" data-end="527.91">an entire past yet so I do</span> <span data-start="527.91" data-end="530.13">like snapchat original fit and that</span> <span data-start="530.13" data-end="531.33">ended up not being what's being a</span> <span data-start="531.33" data-end="533.52">standard so PNG we have to do by hand</span> <span data-start="533.52" data-end="535.83">it's a pretty efficient file format so</span> <span data-start="535.83" data-end="537.15">it's not very difficult to do that</span> <span data-start="537.15" data-end="540.14">there's also this just bitmap</span> <span data-start="540.14" data-end="542.55">compression formats and so on but you do</span> <span data-start="542.55" data-end="543.93">they're basically just read the data we</span> <span data-start="543.93" data-end="545.4">convert it to a color space and then use</span> <span data-start="545.4" data-end="548.04">canvas and just blit the pixel data and</span> <span data-start="548.04" data-end="549.72">there so most of this tends to be three</span> <span data-start="549.72" data-end="554.34">efficient fonts so PDF documents can</span> <span data-start="554.34" data-end="555.57">contain a bunch of different font</span> <span data-start="555.57" data-end="557.73">formats as type 1 fonts type two phones</span> <span data-start="557.73" data-end="560.04">type 3 fonts and the casual observer</span> <span data-start="560.04" data-end="561.27">might think that these are like super</span> <span data-start="561.27" data-end="563.16">sized right like type 2 is a superset of</span> <span data-start="563.16" data-end="565.17">type 1 and then type 3 super sub type 2</span> <span data-start="565.17" data-end="566.85">and there's this farthest thing from the</span> <span data-start="566.85" data-end="569.16">truth so type 1 and type 2 are super</span> <span data-start="569.16" data-end="571.83">sets and subsets of each other and you</span> <span data-start="571.83" data-end="575.4">cannot cannot convert trivially either</span> <span data-start="575.4" data-end="576.84">one into the other but you can do some</span> <span data-start="576.84" data-end="578.82">tricks so type 1 fonts actually not</span> <span data-start="578.82" data-end="581.46">support on the web type 2 fonts are it</span> <span data-start="581.46" data-end="583.41">since you can convert it to open type so</span> <span data-start="583.41" data-end="585.18">what you end up doing is we take type 1</span> <span data-start="585.18" data-end="586.71">fonts and kind of reinterpret them the</span> <span data-start="586.71" data-end="588.84">interpret the sequence of commands that</span> <span data-start="588.84" data-end="590.19">draws the autumn out of the phone and</span> <span data-start="590.19" data-end="592.13">amid the equivalent have two</span> <span data-start="592.13" data-end="594.06">instructions for that and convert all</span> <span data-start="594.06" data-end="595.86">the hinting data and they get a type too</span> <span data-start="595.86" data-end="597.87">fond out of that and a type two font we</span> <span data-start="597.87" data-end="600.21">can wrap into an open type font</span> <span data-start="600.21" data-end="601.65">container and then that the browser can</span> <span data-start="601.65" data-end="604.8">load and I'll use a custom CSS rule let</span> <span data-start="604.8" data-end="605.97">me inject in the document to actually</span> <span data-start="605.97" data-end="608.94">load the font as we are parsing through</span> <span data-start="608.94" data-end="611.04">the document unfortunately some funds</span> <span data-start="611.04" data-end="613.05">cannot be converted this way so type 3</span> <span data-start="613.05" data-end="615.48">fonts they even go a step further and</span> <span data-start="615.48" data-end="618.03">it's typed refund every glyph is a PDF</span> <span data-start="618.03" data-end="620.55">document so in theory for every glue if</span> <span data-start="620.55" data-end="621.9">you can have a video playing in there</span> <span data-start="621.9" data-end="623.55">and I will flash running and everything</span> <span data-start="623.55" data-end="625.86">else creativeness you can do in PDF so</span> <span data-start="625.86" data-end="627.21">attack free fonts you cannot convert</span> <span data-start="627.21" data-end="628.2">this easily basic whether you're</span> <span data-start="628.2" data-end="629.64">planning to do there this is simply use</span> <span data-start="629.64" data-end="631.08">the rendering pipeline you already have</span> <span data-start="631.08" data-end="633">to draw a to individual good it's going</span> <span data-start="633" data-end="635.4">to horace loeb fantastically type free</span> <span data-start="635.4" data-end="636.81">phones almost never use so it's not be a</span> <span data-start="636.81" data-end="641.22">practical problem alright so this is</span> <span data-start="641.22" data-end="642.45">kind of nice part so far everything's</span> <span data-start="642.45" data-end="643.62">weird everything is great everything is</span> <span data-start="643.62" data-end="645.12">fast let's talk about the promise</span> <span data-start="645.12" data-end="647.34">furniture and live a quite a few so</span> <span data-start="647.34" data-end="649.35">there's plenty in a browser no way to</span> <span data-start="649.35" data-end="650.97">detect it on it's loaded I explained</span> <span data-start="650.97" data-end="652.95">this before on canvas that if you just</span> <span data-start="652.95" data-end="655.17">specify a new font and start drawing</span> <span data-start="655.17" data-end="656.79">with it you can have the wrong form</span> <span data-start="656.79" data-end="657.54">under the fundage</span> <span data-start="657.54" data-end="660.66">loads so there's no way to get notified</span> <span data-start="660.66" data-end="662.82">right now that's of course kind of like</span> </p>
<p><span data-start="662.82" data-end="665.79">BRB so the ended up doing is you can</span> <span data-start="665.79" data-end="668.759">detect it and I by by indirection so you</span> <span data-start="668.759" data-end="670.23">can set yourself a timeout that's going</span> <span data-start="670.23" data-end="671.579">to call you back all the time you're</span> <span data-start="671.579" data-end="673.259">waiting for the phone to load it can</span> <span data-start="673.259" data-end="675.81">take the little one pixel canvas and put</span> <span data-start="675.81" data-end="677.19">the font in there and then measure its</span> <span data-start="677.19" data-end="679.62">bids and if the font loads eventually</span> <span data-start="679.62" data-end="681.029">it's going to change then and then you</span> <span data-start="681.029" data-end="682.92">know the phone has been loaded of course</span> <span data-start="682.92" data-end="684.36">this is not a particularly efficient way</span> <span data-start="684.36" data-end="687.569">of doing these things so that's that's a</span> <span data-start="687.569" data-end="688.74">nice thing when you're working for a</span> <span data-start="688.74" data-end="690.569">company it makes the browser so you can</span> <span data-start="690.569" data-end="692.04">talk to the guys so do these things and</span> <span data-start="692.04" data-end="694.47">we already proposed in addition the</span> <span data-start="694.47" data-end="696.209">html5 to the lord have an event in</span> <span data-start="696.209" data-end="697.68">actual font loading is complete on the</span> <span data-start="697.68" data-end="700.44">canvas now that kind of random problem</span> <span data-start="700.44" data-end="702.12">ran into was actual phone measurements</span> <span data-start="702.12" data-end="704.61">so I explained before that in PDF not</span> <span data-start="704.61" data-end="706.5">every command is absolute positioned in</span> <span data-start="706.5" data-end="707.94">case of text you're supposed to measure</span> <span data-start="707.94" data-end="709.41">the width of the text and I continued</span> <span data-start="709.41" data-end="712.47">after that and this over that sometimes</span> <span data-start="712.47" data-end="713.699">absolute positioning as well so it's</span> <span data-start="713.699" data-end="715.17">very important to be very precise on</span> <span data-start="715.17" data-end="716.85">measurements and it turns out if you</span> <span data-start="716.85" data-end="718.829">measure with canvas fonts on many</span> <span data-start="718.829" data-end="720.54">different browsers including ours you</span> <span data-start="720.54" data-end="722.1">get kind of like results a little bit</span> <span data-start="722.1" data-end="723.66">off by a couple pic pixels but that's</span> <span data-start="723.66" data-end="725.519">enough like your fonts kind of blew into</span> <span data-start="725.519" data-end="728.339">each other looks really crappy and we</span> <span data-start="728.339" data-end="729.6">realize that this is a rounding error</span> <span data-start="729.6" data-end="731.22">that happens in many font</span> <span data-start="731.22" data-end="732.779">implementations so many browsers didn't</span> <span data-start="732.779" data-end="734.04">use the same font engines and they have</span> <span data-start="734.04" data-end="735.6">certain rounding errors they're getting</span> <span data-start="735.6" data-end="739.05">used by PDF and you're not doing a very</span> <span data-start="739.05" data-end="740.88">gross hack to other come back though at</span> <span data-start="740.88" data-end="742.05">the end of the talk I can show you what</span> <span data-start="742.05" data-end="743.519">it looks like took it everywhere all</span> <span data-start="743.519" data-end="746.01">these kind of things subject response</span> <span data-start="746.01" data-end="747.389">look very different than in Europe</span> <span data-start="747.389" data-end="749.01">platforms it looks different for paying</span> <span data-start="749.01" data-end="750.66">the person operating system different</span> <span data-start="750.66" data-end="753.18">from like version of the OS to be</span> <span data-start="753.18" data-end="755.579">depending on canvas drawers so on more</span> <span data-start="755.579" data-end="757.23">modern platforms like mac OS and the</span> <span data-start="757.23" data-end="758.61">recent version of windows looks pretty</span> <span data-start="758.61" data-end="759.87">good but if you go back to Windows XP</span> <span data-start="759.87" data-end="763.26">you cannot on your own text selection</span> <span data-start="763.26" data-end="764.579">doesn't be repairable for us right now</span> <span data-start="764.579" data-end="766.199">these in cameras to the back end so you</span> <span data-start="766.199" data-end="767.639">exploring other options they are using</span> </p>
<p><span data-start="767.639" data-end="769.889">SVG for example a text search little bit</span> <span data-start="769.889" data-end="772.439">easier to do that on canvas printing is</span> <span data-start="772.439" data-end="774.12">the same using right now fixed size</span> <span data-start="774.12" data-end="775.8">canvas if you print that we leave a</span> <span data-start="775.8" data-end="777.329">little black crap because we are</span> <span data-start="777.329" data-end="778.949">pixelating at a much lower resolution</span> <span data-start="778.949" data-end="781.62">this mostly again an API problem there</span> <span data-start="781.62" data-end="783.329">is no turbid good API right now on the</span> <span data-start="783.329" data-end="786.24">web to print so I'm be filed a bug and</span> <span data-start="786.24" data-end="788.519">it's something they want to fix so it</span> <span data-start="788.519" data-end="789.66">should be much more efficient way how</span> <span data-start="789.66" data-end="790.29">you can communicate</span> <span data-start="790.29" data-end="792.329">print commands for example you could</span> <span data-start="792.329" data-end="793.86">have a print canvas they can say okay I</span> <span data-start="793.86" data-end="795.57">want to like to print Lima canvas I will</span> <span data-start="795.57" data-end="797.279">do print commands on it and the browser</span> <span data-start="797.279" data-end="798.66">can figure out how to translate that to</span> <span data-start="798.66" data-end="801.389">your local printer and a performance of</span> <span data-start="801.389" data-end="802.529">course is a problem i'm going to talk</span> <span data-start="802.529" data-end="806">about that a little bit more in a second</span> <span data-start="806" data-end="809.819">been doing this project II this has been</span> <span data-start="809.819" data-end="812.029">my first video our JavaScript project</span> </p>
<p><span data-start="812.029" data-end="814.92">I'm not a drastic web author I do</span> <span data-start="814.92" data-end="817.649">browsers for a living so then they</span> <span data-start="817.649" data-end="819.899">started doing this is very important for</span> <span data-start="819.899" data-end="821.519">us to have very nice maintainable code</span> <span data-start="821.519" data-end="823.44">because we're not very good javascript</span> <span data-start="823.44" data-end="825.089">hackers so want to make sure everything</span> <span data-start="825.089" data-end="826.11">is really extensible people to</span> <span data-start="826.11" data-end="827.49">understand it they start a project</span> <span data-start="827.49" data-end="828.75">straight on github phone and make sure</span> <span data-start="828.75" data-end="831.149">people can help us and how about just</span> <span data-start="831.149" data-end="832.709">committee contributors so we really try</span> <span data-start="832.709" data-end="835.43">to write very nice stylized modular code</span> <span data-start="835.43" data-end="839.699">that's great however in some cases it</span> <span data-start="839.699" data-end="841.529">also has to be really fast so if you are</span> <span data-start="841.529" data-end="843.089">sitting somewhere deep and an image</span> <span data-start="843.089" data-end="845.16">decoder we have to make you t-shirt it's</span> <span data-start="845.16" data-end="847.92">very fast and efficient otherwise be</span> <span data-start="847.92" data-end="849.269">doesn't seem enough competitive for some</span> <span data-start="849.269" data-end="850.98">native code PDF reader and their must</span> <span data-start="850.98" data-end="852.18">view the goal we wanted to see that you</span> <span data-start="852.18" data-end="853.92">can use javascript to be as efficient as</span> <span data-start="853.92" data-end="857.1">the native code implementations so just</span> <span data-start="857.1" data-end="858.66">a couple of things that's going to run</span> <span data-start="858.66" data-end="861.75">into an optimizing observations more or</span> <span data-start="861.75" data-end="864.48">less then we've this piece of code here</span> <span data-start="864.48" data-end="867.66">is the actual deflate algorithm that we</span> <span data-start="867.66" data-end="869.519">also had and decompresses the PDF</span> <span data-start="869.519" data-end="870.899">command screen that comes with another</span> <span data-start="870.899" data-end="874.8">text file and first for tonight's</span> <span data-start="874.8" data-end="876.3">modular version was way too slow to be</span> <span data-start="876.3" data-end="878.16">used and I use the profiler then we're</span> <span data-start="878.16" data-end="879.329">going to go ahead and find out where the</span> <span data-start="879.329" data-end="881.01">problems are one of the first things i</span> <span data-start="881.01" data-end="884.1">optimize is that this little compunction</span> <span data-start="884.1" data-end="885.54">their insurer buffer but it does every</span> <span data-start="885.54" data-end="888.68">time you're decoding more data from the</span> <span data-start="888.68" data-end="890.819">compressed file you have to make sure</span> <span data-start="890.819" data-end="892.26">you can write your output buffer and</span> <span data-start="892.26" data-end="894.24">it's ensure buffer make sure but it is</span> <span data-start="894.24" data-end="895.68">enough room to ride another character</span> <span data-start="895.68" data-end="897">and I used to call this straight</span> <span data-start="897" data-end="898.769">directly from the code and it turns out</span> <span data-start="898.769" data-end="899.88">this function part is way too expensive</span> <span data-start="899.88" data-end="901.23">there are too many characters these</span> <span data-start="901.23" data-end="902.85">files a large amounts of megabytes and</span> <span data-start="902.85" data-end="904.62">make Bay 20 function calls really slow</span> <span data-start="904.62" data-end="907.11">so instead but you're not doing is</span> <span data-start="907.11" data-end="908.85">either kind pulled if condition out of</span> <span data-start="908.85" data-end="910.5">there and we only conditionally call it</span> <span data-start="910.5" data-end="912.269">if the buffer needs to be extended and</span> <span data-start="912.269" data-end="915.149">that mean that was a base substantial</span> <span data-start="915.149" data-end="917.91">speed up at the same time it's important</span> <span data-start="917.91" data-end="919.38">you don't go overboard so kind of this</span> <span data-start="919.38" data-end="920.83">kind of inlining makes sense</span> <span data-start="920.83" data-end="922.63">we perform is critical and it's a very</span> <span data-start="922.63" data-end="924.82">thin function you don't want to go</span> <span data-start="924.82" data-end="926.23">overboard completely stop using</span> <span data-start="926.23" data-end="927.94">functions because your coat looks</span> <span data-start="927.94" data-end="930.34">totally unreadable so just get code here</span> <span data-start="930.34" data-end="931.12">that's actually a very substantial</span> <span data-start="931.12" data-end="933.25">amount of code I use several times in</span> <span data-start="933.25" data-end="935.08">its function if I take that apart</span> <span data-start="935.08" data-end="936.79">everywhere then the code needs to be</span> <span data-start="936.79" data-end="938.92">long and readable and there the function</span> <span data-start="938.92" data-end="940.69">call overhead is much less in comparison</span> <span data-start="940.69" data-end="942.16">to what happens in the function so that</span> <span data-start="942.16" data-end="944.41">one we didn't touch and then similarly</span> <span data-start="944.41" data-end="946.9">vettel like helper functions are on this</span> <span data-start="946.9" data-end="949.06">like code one shift right at sixteen you</span> <span data-start="949.06" data-end="950.62">can't afford in this kind of performance</span> <span data-start="950.62" data-end="952.69">critical code according to helper</span> <span data-start="952.69" data-end="954.82">functions it's also important the wavy</span> <span data-start="954.82" data-end="956.47">represent data here so this length the</span> <span data-start="956.47" data-end="958.48">code is an array contains data and it</span> <span data-start="958.48" data-end="960.22">contains we two different things length</span> <span data-start="960.22" data-end="962.68">and a code initially we used to have an</span> <span data-start="962.68" data-end="964.96">array in there is two indexes index zero</span> <span data-start="964.96" data-end="966.94">index one for data and length and it's</span> <span data-start="966.94" data-end="968.2">additional area look up was also pretty</span> <span data-start="968.2" data-end="969.82">expensive so just kind of munch those</span> <span data-start="969.82" data-end="971.05">two numbers together and shifted them</span> <span data-start="971.05" data-end="972.88">together and that God where's another</span> <span data-start="972.88" data-end="974.23">like fifty percent or so speed</span> <span data-start="974.23" data-end="976.21">improvement so it's very important that</span> <span data-start="976.21" data-end="978.13">when you have critical code after you</span> <span data-start="978.13" data-end="979.3">have written in a nice way you can go</span> <span data-start="979.3" data-end="981.82">ahead and optimize it and you will only</span> <span data-start="981.82" data-end="983.23">do that for the critical parts of your</span> <span data-start="983.23" data-end="985.99">code something else that I was talking</span> <span data-start="985.99" data-end="987.13">about earlier is if you're using the</span> <span data-start="987.13" data-end="989.23">internal jpeg dakota in the browser and</span> <span data-start="989.23" data-end="991.09">it's really important abroad jpg is a</span> <span data-start="991.09" data-end="992.47">very complex format it's a lot of</span> <span data-start="992.47" data-end="994.36">complex math going on to decode it you</span> <span data-start="994.36" data-end="995.67">do not want to rather than JavaScript</span> <span data-start="995.67" data-end="997.3">unfortunately we are into the same</span> <span data-start="997.3" data-end="999.97">problem here as this PNG that Adobe's</span> <span data-start="999.97" data-end="1001.56">implementation of JPEGs subtly different</span> <span data-start="1001.56" data-end="1003.71">differs on the way sentiment on the web</span> <span data-start="1003.71" data-end="1005.58">in particular there's something wrong</span> <span data-start="1005.58" data-end="1007.2">with color space conversion so actually</span> <span data-start="1007.2" data-end="1009.27">hear the vet is wrong on the web the</span> </p>
<p><span data-start="1009.27" data-end="1010.89">Jeep actor displayed is the very</span> <span data-start="1010.89" data-end="1012.48">Photoshop generates done not the way the</span> <span data-start="1012.48" data-end="1015">standards say and you can't we change</span> <span data-start="1015" data-end="1016.38">that because so many images are made by</span> <span data-start="1016.38" data-end="1019.35">Photoshop and in PDF the format is</span> <span data-start="1019.35" data-end="1020.88">correctly the way the spec wants it to</span> <span data-start="1020.88" data-end="1023.01">be used and unfortunately incompatible</span> <span data-start="1023.01" data-end="1024.839">so if you try to render the document at</span> <span data-start="1024.839" data-end="1028.199">the PDF JPEG you get completely wrong</span> <span data-start="1028.199" data-end="1030.24">color space so the end up doing we can</span> <span data-start="1030.24" data-end="1032.52">manage the JPEG fiber redid the insert a</span> <span data-start="1032.52" data-end="1034.199">little header the browser knows about</span> <span data-start="1034.199" data-end="1036">and choose a different color space and</span> <span data-start="1036" data-end="1038.24">then we load that you leave rewritten</span> <span data-start="1038.24" data-end="1041.16">jpg file into the browser that made that</span> <span data-start="1041.16" data-end="1044.159">work</span> <span data-start="1044.169" data-end="1045.949">that's or at least I'm going to talk a</span> <span data-start="1045.949" data-end="1047.36">lil bit about the way we journeyed all</span> <span data-start="1047.36" data-end="1049.279">these data streams so we have frequently</span> <span data-start="1049.279" data-end="1050.96">but we do in PDF to jsu read data and</span> <span data-start="1050.96" data-end="1053.21">invite out data into a file again or a</span> <span data-start="1053.21" data-end="1054.919">buffer and then loaded into browser and</span> <span data-start="1054.919" data-end="1057.23">the first naive implementation that</span> <span data-start="1057.23" data-end="1059.149">someone from the team did look like this</span> <span data-start="1059.149" data-end="1061.34">here you get the screen data as a bunch</span> <span data-start="1061.34" data-end="1062.84">of bytes and then you've a lot of right</span> <span data-start="1062.84" data-end="1064.97">function that you give an array of data</span> <span data-start="1064.97" data-end="1066.889">and it goes through that it's a for in</span> <span data-start="1066.889" data-end="1069.71">loop and pushes into a new font array</span> <span data-start="1069.71" data-end="1070.94">we're also new phone data is collected</span> <span data-start="1070.94" data-end="1072.95">and then down there is kind of roughly</span> <span data-start="1072.95" data-end="1074.87">about the font loop well look look like</span> <span data-start="1074.87" data-end="1076.309">there's some data by pull out of there</span> <span data-start="1076.309" data-end="1078.889">and be right two bytes for example with</span> <span data-start="1078.889" data-end="1080.84">a file and this was horribly slow and</span> <span data-start="1080.84" data-end="1083.51">for like many different reasons and just</span> <span data-start="1083.51" data-end="1086.12">animate a couple of minutes or four in a</span> <span data-start="1086.12" data-end="1088.909">race if you do a for in loop or an array</span> <span data-start="1088.909" data-end="1091.7">and the indexes have to be string defied</span> <span data-start="1091.7" data-end="1093.769">in the for in loop so I in this array</span> <span data-start="1093.769" data-end="1096.08">learn in this loop over this array it's</span> <span data-start="1096.08" data-end="1098.899">always a string by the specification so</span> <span data-start="1098.899" data-end="1100.669">you have to take this numeric index is 0</span> <span data-start="1100.669" data-end="1102.409">and 1 and string defy them all the time</span> <span data-start="1102.409" data-end="1104.69">and that definitely substantial cost so</span> <span data-start="1104.69" data-end="1107.679">you want to avoid for in loops or a race</span> <span data-start="1107.679" data-end="1110.96">the next thing is the actual push on an</span> <span data-start="1110.96" data-end="1112.61">array to store data it's not a</span> <span data-start="1112.61" data-end="1114.139">particularly good idea that's really</span> <span data-start="1114.139" data-end="1115.549">expensive you have to call this native</span> <span data-start="1115.549" data-end="1116.899">push method you have to extend their</span> <span data-start="1116.899" data-end="1118.49">array every time so that turned out</span> <span data-start="1118.49" data-end="1122.69">pretty expensive down here to write out</span> <span data-start="1122.69" data-end="1124.49">the data and he created a new array</span> <span data-start="1124.49" data-end="1127.399">around it every time and modern GCS can</span> <span data-start="1127.399" data-end="1129.2">take care of the trash for generating</span> <span data-start="1129.2" data-end="1130.88">here in this loop but just making that</span> <span data-start="1130.88" data-end="1132.95">object is pretty expensive so you're</span> <span data-start="1132.95" data-end="1134.779">kind of using Apple of like cash space</span> <span data-start="1134.779" data-end="1136.73">there and the hardware it is to make all</span> <span data-start="1136.73" data-end="1138.889">the solar rays and that's what at least</span> <span data-start="1138.889" data-end="1140.299">also call in this function here it</span> <span data-start="1140.299" data-end="1142.519">almost does nothing it's a pretty big</span> <span data-start="1142.519" data-end="1144.26">overhead so after optimizing all these</span> <span data-start="1144.26" data-end="1145.85">things the font loading code would</span> <span data-start="1145.85" data-end="1149.48">substantially faster and I was after</span> <span data-start="1149.48" data-end="1150.59">optimizing either but pretty curious</span> <span data-start="1150.59" data-end="1152.09">what is actually really the fastest way</span> <span data-start="1152.09" data-end="1154.01">in a browser to ride into a variable</span> <span data-start="1154.01" data-end="1156.74">size buffer and 20 prize that you eat</span> <span data-start="1156.74" data-end="1158.45">strings and that's the sweetie weird</span> <span data-start="1158.45" data-end="1160">because strings are not even eight byte</span> <span data-start="1160" data-end="1164.649">array is every 16 bit arrays so</span> <span data-start="1164.649" data-end="1166.76">basically what I ended up doing a</span> <span data-start="1166.76" data-end="1168.38">current code base now is that we have</span> <span data-start="1168.38" data-end="1169.7">started string out empty and then</span> <span data-start="1169.7" data-end="1171.44">concatenate characters in there using</span> <span data-start="1171.44" data-end="1174.47">from charcoal and give a constants we</span> <span data-start="1174.47" data-end="1175.6">have to write in there because you</span> <span data-start="1175.6" data-end="1178.9">this hex string notation to write it in</span> <span data-start="1178.9" data-end="1181.99">and the best explanation I can give you</span> <span data-start="1181.99" data-end="1183.789">for that why strings are so efficient in</span> <span data-start="1183.789" data-end="1184.929">browsers is that they are highly</span> <span data-start="1184.929" data-end="1187.15">optimized for benchmarks so kind of pre</span> <span data-start="1187.15" data-end="1188.919">sunspider it's like very popular a</span> <span data-start="1188.919" data-end="1190.44">terrible terrible JavaScript benchmark</span> <span data-start="1190.44" data-end="1192.4">people used to avoid string</span> <span data-start="1192.4" data-end="1193.84">concatenation because it was terribly</span> <span data-start="1193.84" data-end="1196.63">slow in ie6 now in a post Suns by the</span> <span data-start="1196.63" data-end="1198.22">world and suffered a lot of string</span> <span data-start="1198.22" data-end="1200.32">concatenation so today everything</span> <span data-start="1200.32" data-end="1202.33">everybody deeply optimized for computing</span> <span data-start="1202.33" data-end="1203.5">strengths some knowledge reaching</span> <span data-start="1203.5" data-end="1206.32">operation so if you want a bit something</span> <span data-start="1206.32" data-end="1207.76">really fast what you do we have to make</span> <span data-start="1207.76" data-end="1209.049">a benchmark and then everyone's been</span> <span data-start="1209.049" data-end="1213.669">optimized for it all right that's what</span> <span data-start="1213.669" data-end="1215.65">at least typed arrays to not to be also</span> <span data-start="1215.65" data-end="1216.88">a really important performance feature</span> <span data-start="1216.88" data-end="1218.83">for us so we switched all over they used</span> <span data-start="1218.83" data-end="1220.77">to type the race the best we can and</span> <span data-start="1220.77" data-end="1222.85">that gives you a nice speed up and even</span> <span data-start="1222.85" data-end="1224.409">for literal is just like tables of data</span> <span data-start="1224.409" data-end="1226.12">it's actually very efficient to do that</span> <span data-start="1226.12" data-end="1228.07">it's often also more compact so this is</span> <span data-start="1228.07" data-end="1230.35">for example a 32-bit array of 32-bit</span> <span data-start="1230.35" data-end="1233.169">integers and it's much more compact</span> <span data-start="1233.169" data-end="1235.27">represented to the typed array because a</span> <span data-start="1235.27" data-end="1237.1">regular arranged larger data entities</span> <span data-start="1237.1" data-end="1238.84">that store the type and the value and</span> <span data-start="1238.84" data-end="1240.19">type the race everything is the same</span> <span data-start="1240.19" data-end="1242.83">time unfortunately for type 2 race you</span> <span data-start="1242.83" data-end="1244.69">can't form easily the literals or on</span> <span data-start="1244.69" data-end="1245.919">them so what you did because we make a</span> <span data-start="1245.919" data-end="1247.57">regular array that you can initialize</span> <span data-start="1247.57" data-end="1249.58">the literal and then this rather typed</span> <span data-start="1249.58" data-end="1251.98">array all around it and for a brief</span> <span data-start="1251.98" data-end="1253.299">moment you have the full array in memory</span> <span data-start="1253.299" data-end="1254.919">but then it gets replaced this it happed</span> <span data-start="1254.919" data-end="1258.97">array of course and then some some</span> <span data-start="1258.97" data-end="1261">browsers you don't have time to raise a</span> <span data-start="1261" data-end="1264.309">new slides Opera Safari mobile 99 don't</span> <span data-start="1264.309" data-end="1266.289">heaven yet as far as I can tell in that</span> <span data-start="1266.289" data-end="1267.58">case you just emulated type area so</span> <span data-start="1267.58" data-end="1269.38">using traditional erase and their their</span> </p>
<p><span data-start="1269.38" data-end="1271.96">API is roughly compatible so basic on</span> <span data-start="1271.96" data-end="1273.28">these browsers works is a little</span> <span data-start="1273.28" data-end="1274.659">emulation layer in between it's just</span> <span data-start="1274.659" data-end="1278.35">much lower believe what I was going to</span> <span data-start="1278.35" data-end="1280.45">encourage this a couple of slides views</span> <span data-start="1280.45" data-end="1282.49">to hear is I encourage you to use</span> <span data-start="1282.49" data-end="1284.44">profilers the really fundamentally</span> <span data-start="1284.44" data-end="1287.169">useful in our code base you go ahead and</span> <span data-start="1287.169" data-end="1289.69">you write the code as nicely as you can</span> <span data-start="1289.69" data-end="1291.37">and you grab a profiler and you kind of</span> <span data-start="1291.37" data-end="1292.929">knock off the top like five or six</span> <span data-start="1292.929" data-end="1295.09">performance photos you can find that</span> <span data-start="1295.09" data-end="1296.799">visit has already taken care of the</span> <span data-start="1296.799" data-end="1297.97">majority of the performance you can</span> <span data-start="1297.97" data-end="1299.62">squeeze out of the program so you can</span> <span data-start="1299.62" data-end="1301.45">have it kind of boat you can have a very</span> <span data-start="1301.45" data-end="1303.159">nice modular code the same time it can</span> <span data-start="1303.159" data-end="1305.86">also be very efficient and some of the</span> <span data-start="1305.86" data-end="1307.21">stuff is really subtle it's very hard to</span> <span data-start="1307.21" data-end="1308.85">tell so I started</span> <span data-start="1308.85" data-end="1311.59">fi I was founded type of syntax really</span> <span data-start="1311.59" data-end="1314.32">confusing so I like to avoid it like the</span> <span data-start="1314.32" data-end="1315.61">plague and I wrote myself a little</span> <span data-start="1315.61" data-end="1317.41">helper functions like is now it's going</span> <span data-start="1317.41" data-end="1318.79">to tell me that that value as a number</span> <span data-start="1318.79" data-end="1320.77">and the users very consistent is the</span> <span data-start="1320.77" data-end="1321.94">code base and one of the things their</span> <span data-start="1321.94" data-end="1324.97">profile are highlighted as I was going</span> <span data-start="1324.97" data-end="1326.65">through the cool base is that in this</span> <span data-start="1326.65" data-end="1328.36">little loop here where data is being</span> <span data-start="1328.36" data-end="1332.62">processed and rewritten I used to I used</span> </p>
<p><span data-start="1332.62" data-end="1334.51">Islam to check whether that the value</span> <span data-start="1334.51" data-end="1336.73">was getting back as invalid a bite or</span> <span data-start="1336.73" data-end="1337.93">actually I have reached the end of the</span> <span data-start="1337.93" data-end="1339.31">file in which case i think i define it's</span> <span data-start="1339.31" data-end="1341.44">coming back and this function call to</span> <span data-start="1341.44" data-end="1343.72">islam was the majority of the cost of</span> <span data-start="1343.72" data-end="1344.95">this loop here and like ninety percent</span> <span data-start="1344.95" data-end="1346.9">of the time was being spent calling the</span> <span data-start="1346.9" data-end="1348.55">islam function not even inside it as</span> <span data-start="1348.55" data-end="1351.7">much is calling it so a profiler can</span> <span data-start="1351.7" data-end="1352.66">very easily kind of highlight these</span> <span data-start="1352.66" data-end="1353.71">things and there's various different</span> <span data-start="1353.71" data-end="1355.66">ones other the Firebug is available</span> </p>
<p><span data-start="1355.66" data-end="1358.51">Firefox and then Kate based process of a</span> <span data-start="1358.51" data-end="1360.67">profiler built in so we can very nicely</span> <span data-start="1360.67" data-end="1362.38">identified that's a problem you can just</span> <span data-start="1362.38" data-end="1363.79">take the guts of the function in line it</span> <span data-start="1363.79" data-end="1366.52">and you have a limited overhead for the</span> <span data-start="1366.52" data-end="1370.21">call there and that video get this goes</span> <span data-start="1370.21" data-end="1372.1">a long way so you sacrifice a little bit</span> <span data-start="1372.1" data-end="1374.56">of beauty there you fix a couple places</span> <span data-start="1374.56" data-end="1376.09">up and they're not as nice as you would</span> <span data-start="1376.09" data-end="1377.29">prefer to write them but you get me a</span> <span data-start="1377.29" data-end="1381.97">dramatic performance improvements um the</span> <span data-start="1381.97" data-end="1384.67">last but not least don't pause we all</span> <span data-start="1384.67" data-end="1386.71">have run into quite a few problems just</span> <span data-start="1386.71" data-end="1388.39">this dumb cause being slow and the</span> <span data-start="1388.39" data-end="1390.25">reason for that is that javascript has a</span> <span data-start="1390.25" data-end="1392.11">different representation for objects and</span> <span data-start="1392.11" data-end="1393.91">most implementations of browsers which</span> <span data-start="1393.91" data-end="1396.22">are usually in C++ so even JavaScript if</span> <span data-start="1396.22" data-end="1398.5">a Jobs get string a draft object and C++</span> <span data-start="1398.5" data-end="1400.3">it is like see strings and see the space</span> <span data-start="1400.3" data-end="1402.49">objects so whenever you call the Dom it</span> <span data-start="1402.49" data-end="1404.32">take those jobs objects return to see</span> <span data-start="1404.32" data-end="1406.12">those fast objects and then it dont does</span> <span data-start="1406.12" data-end="1407.23">some processing on it and then it</span> <span data-start="1407.23" data-end="1408.64">returns the data which we have to again</span> <span data-start="1408.64" data-end="1410.74">convert back and we the only way to make</span> <span data-start="1410.74" data-end="1412.96">that fast is to not do that do not on</span> <span data-start="1412.96" data-end="1415.18">the damage with it all can avoid it so</span> <span data-start="1415.18" data-end="1418.33">in this case here is rattled cash around</span> <span data-start="1418.33" data-end="1420.04">measure text so whenever even measured</span> <span data-start="1420.04" data-end="1422.38">text for the same form or the same tags</span> <span data-start="1422.38" data-end="1424.63">and the same size then we just don't hit</span> <span data-start="1424.63" data-end="1426.37">the dorm again put in a little cash on a</span> </p>
<p><span data-start="1426.37" data-end="1427.93">JavaScript side and everything is much</span> <span data-start="1427.93" data-end="1430.9">much faster and this particular useful</span> <span data-start="1430.9" data-end="1432.94">for rear ndering so when I showed em own</span> <span data-start="1432.94" data-end="1434.08">a second you will see that the second</span> <span data-start="1434.08" data-end="1435.73">time you go across the pages is very</span> <span data-start="1435.73" data-end="1437.53">fast instant because nothing has to be</span> <span data-start="1437.53" data-end="1438.53">really measured anymore</span> <span data-start="1438.53" data-end="1441.38">and something else it's this one is live</span> <span data-start="1441.38" data-end="1442.82">here is a little ugly hacker was talking</span> <span data-start="1442.82" data-end="1444.62">about so I mentioned to you then many</span> <span data-start="1444.62" data-end="1446.75">browsers don't measure fonts right in</span> <span data-start="1446.75" data-end="1448.73">canvas so if you end up doing we just</span> <span data-start="1448.73" data-end="1450.44">take the text and we pick a much much</span> <span data-start="1450.44" data-end="1452.87">larger font size so it's like 50 times</span> <span data-start="1452.87" data-end="1454.7">larger and then you measure the text is</span> <span data-start="1454.7" data-end="1457.25">a larger XL size and then we divide it</span> <span data-start="1457.25" data-end="1460.82">by the P modification factor this is not</span> <span data-start="1460.82" data-end="1462.77">exactly the size because hinting can</span> <span data-start="1462.77" data-end="1464.87">cause different text measurement but</span> <span data-start="1464.87" data-end="1468.05">it's it's closer to the truth then if</span> <span data-start="1468.05" data-end="1470.36">you just use the direct methods all</span> <span data-start="1470.36" data-end="1472.73">right a couple things of the f to still</span> <span data-start="1472.73" data-end="1474.41">do there's more fun than printing work</span> <span data-start="1474.41" data-end="1476.69">to be done they're not implementing</span> <span data-start="1476.69" data-end="1478.25">entire backyard vendor some more back</span> <span data-start="1478.25" data-end="1481.64">ends in particular at fuji in HTML maybe</span> <span data-start="1481.64" data-end="1483.53">advanced PDF features like forms and</span> <span data-start="1483.53" data-end="1485.75">stuff like that and automated testing</span> <span data-start="1485.75" data-end="1487.16">zalto pretty important it's very easy in</span> <span data-start="1487.16" data-end="1489.38">the code size of the size of the code</span> <span data-start="1489.38" data-end="1490.58">base we have nice pretty easy to break</span> <span data-start="1490.58" data-end="1492.77">stuff if you don't have decent tests all</span> <span data-start="1492.77" data-end="1494.93">right demo that's what people want to</span> <span data-start="1494.93" data-end="1498.4">see anyway so I was not raised enough to</span> <span data-start="1498.4" data-end="1502.84">give the entire presentation this on</span> <span data-start="1502.84" data-end="1507.47">this video for GS but you can see that</span> <span data-start="1507.47" data-end="1508.94">we can render the entire content as well</span> <span data-start="1508.94" data-end="1511.1">you see a couple of entering artifacts</span> <span data-start="1511.1" data-end="1512.21">here and there many of those actually</span> <span data-start="1512.21" data-end="1514.49">are in keynote so keynote exported a bad</span> </p>
<p><span data-start="1514.49" data-end="1516.14">PDF it's not even prev you can actually</span> <span data-start="1516.14" data-end="1519.98">read what we roughly looks the same and</span> <span data-start="1519.98" data-end="1522.29">then be able to like slide out here that</span> <span data-start="1522.29" data-end="1523.46">shows your preview and it's actually</span> <span data-start="1523.46" data-end="1525.5">using the same renderer so if I cool</span> <span data-start="1525.5" data-end="1528.56">down really quickly you can see this is</span> <span data-start="1528.56" data-end="1530.51">all these your Android so if you only</span> <span data-start="1530.51" data-end="1531.8">display a couple of these things and</span> <span data-start="1531.8" data-end="1533.54">lazily render them and the rear ndering</span> <span data-start="1533.54" data-end="1535.37">is fast enough to kind of keep up this</span> <span data-start="1535.37" data-end="1539.06">actual scrolling and then hopefully the</span> <span data-start="1539.06" data-end="1540.44">network is going to work because when I</span> <span data-start="1540.44" data-end="1545.93">contribu this here so this is a little</span> <span data-start="1545.93" data-end="1548.81">demo that someone from Azad put together</span> <span data-start="1548.81" data-end="1551.42">this students from this university so</span> <span data-start="1551.42" data-end="1556.25">this is a 3d that GL canvas that uses</span> </p>
<p><span data-start="1556.25" data-end="1558.05">PDF to jas to render the content of this</span> <span data-start="1558.05" data-end="1559.88">very first document that we end up is</span> <span data-start="1559.88" data-end="1561.62">PHAs and put in a few then you can</span> <span data-start="1561.62" data-end="1563.06">rotate this around and zoom into it and</span> <span data-start="1563.06" data-end="1565.16">what not and this going to show us a</span> <span data-start="1565.16" data-end="1566.69">power wheel you of using proper web</span> <span data-start="1566.69" data-end="1567.66">technology so</span> <span data-start="1567.66" data-end="1568.92">it will be much much harder to do sounds</span> <span data-start="1568.92" data-end="1570.24">like this is a native cool plugin</span> <span data-start="1570.24" data-end="1571.29">because you have to get the content</span> <span data-start="1571.29" data-end="1573.24">somehow into the web stack and if you</span> <span data-start="1573.24" data-end="1574.47">use that technology to render these</span> <span data-start="1574.47" data-end="1575.55">things that's already automatically</span> <span data-start="1575.55" data-end="1578.73">there all right that's for my talk any</span> <span data-start="1578.73" data-end="1604.7">questions</span> <span data-start="1604.71" data-end="1607.89">so there's a pdx back the spec tells you</span> <span data-start="1607.89" data-end="1608.97">about pdfs were supposed to look like</span> <span data-start="1608.97" data-end="1610.74">and then there's reality which is part</span> <span data-start="1610.74" data-end="1612.24">of a different on that gear to</span> <span data-start="1612.24" data-end="1614.1">reverse-engineer so there's many PDF</span> <span data-start="1614.1" data-end="1615.39">termination to literally hundreds of</span> <span data-start="1615.39" data-end="1616.919">them and you have to come back guess a</span> <span data-start="1616.919" data-end="1617.88">little bit and look at different</span> <span data-start="1617.88" data-end="1619.11">documents we find out what the reality</span> <span data-start="1619.11" data-end="1620.37">looks like but the basic spec is</span> <span data-start="1620.37" data-end="1632.279">available and it's an iso spec we</span> <span data-start="1632.279" data-end="1634.5">started we pick candles as the first</span> <span data-start="1634.5" data-end="1637.76">thing we will do HTML and SVG next</span> <span data-start="1637.76" data-end="1640.32">there's no particular reason we know</span> <span data-start="1640.32" data-end="1641.76">that campus is very fast for the same</span> <span data-start="1641.76" data-end="1645.029">reason as string operations fast this</span> <span data-start="1645.029" data-end="1647.88">time competed in marketing / canos</span> <span data-start="1647.88" data-end="1649.559">performance so everyone men's and make</span> <span data-start="1649.559" data-end="1651.059">the candles really fast so we knew we</span> <span data-start="1651.059" data-end="1652.98">would be very fast as canvas we have not</span> <span data-start="1652.98" data-end="1654.39">investigated other ones yet it will</span> <span data-start="1654.39" data-end="1658.289">probably be fast as well oh yeah</span> <span data-start="1658.289" data-end="1660.39">absolutely so SVG is for text selection</span> <span data-start="1660.39" data-end="1666.21">and printing very interesting yeah</span> <span data-start="1666.22" data-end="1674.84">you</span> <span data-start="1674.85" data-end="1677.55">sure I'm not too familiar sports i know</span> <span data-start="1677.55" data-end="1679.23">there's roughly based on a PDF rendering</span> <span data-start="1679.23" data-end="1681.08">pipeline so it should be possible yeah</span> <span data-start="1681.08" data-end="1684.75">yeah oh ok so he was asking that it's</span> <span data-start="1684.75" data-end="1688.41">possible to render he related specs like</span> <span data-start="1688.41" data-end="1690.45">the ports you I rendering pipeline to</span> </p>
<p><span data-start="1690.45" data-end="1698.46">PDF to GS and I swim yes specifications</span> <span data-start="1698.46" data-end="1700.41">but I assume you you dropped a lot of</span> <span data-start="1700.41" data-end="1703.47">stuff because the PDF reader does a lot</span> <span data-start="1703.47" data-end="1706.56">of fancy things let you decide what to</span> <span data-start="1706.56" data-end="1708.96">throw ok so the question box with the V</span> <span data-start="1708.96" data-end="1710.34">implement entire speckle we have dropped</span> <span data-start="1710.34" data-end="1712.29">parts of it because the PDF readers is</span> <span data-start="1712.29" data-end="1714.09">so extensive that's what we true so the</span> <span data-start="1714.09" data-end="1715.68">octopod reader is like a 50 megabyte</span> <span data-start="1715.68" data-end="1717.09">download something that there's a ton of</span> <span data-start="1717.09" data-end="1719.28">crap in there there's like various two</span> <span data-start="1719.28" data-end="1720.87">jobs with engines and I think a flash</span> <span data-start="1720.87" data-end="1722.82">engine or two flash engines various</span> <span data-start="1722.82" data-end="1725.19">stuff that you don't need that's just</span> <span data-start="1725.19" data-end="1726.45">for the business modulus every year they</span> <span data-start="1726.45" data-end="1727.86">put up a new version of a reader some</span> <span data-start="1727.86" data-end="1730.71">more crap in it and in reality most pdx</span> <span data-start="1730.71" data-end="1732.3">an event don't reuse that so if you look</span> <span data-start="1732.3" data-end="1733.68">at popular readers like the monitors in</span> <span data-start="1733.68" data-end="1735.48">chrome or the preview one that's a mac</span> </p>
<p><span data-start="1735.48" data-end="1738.48">OS that thing really to supports PDF 1.3</span> <span data-start="1738.48" data-end="1741.27">plus a few little things so that's</span> <span data-start="1741.27" data-end="1742.5">roughly what we are shooting for we are</span> <span data-start="1742.5" data-end="1743.58">shooting for compatibility vyas</span> <span data-start="1743.58" data-end="1744.81">ninety-nine point nine percent of the</span> <span data-start="1744.81" data-end="1746.79">PDF you will find on to that and that's</span> <span data-start="1746.79" data-end="1748.59">a much much smaller subset about the</span> <span data-start="1748.59" data-end="1751.11">actual spec is so we kind of knew what</span> <span data-start="1751.11" data-end="1752.37">the important stuff is and from the arm</span> <span data-start="1752.37" data-end="1754.08">is iterating we pick a new document that</span> <span data-start="1754.08" data-end="1756.57">we find somewhere the PDF education so</span> <span data-start="1756.57" data-end="1758.04">it's all for example it's going to see</span> <span data-start="1758.04" data-end="1772.08">what features are needed and add those</span> <span data-start="1772.09" data-end="1774.65">the impression that would be very useful</span> <span data-start="1774.65" data-end="1785.88">in other professions as well very good</span> <span data-start="1785.89" data-end="1792.35">um so the disease of stuff for example</span> <span data-start="1792.35" data-end="1793.67">we were considering that it's still a</span> <span data-start="1793.67" data-end="1795.53">quite a bit slower actually so by the</span> <span data-start="1795.53" data-end="1798.68">way some incident code it's up on github</span> <span data-start="1798.68" data-end="1800.66">the zeod stuff in particular is going</span> <span data-start="1800.66" data-end="1802.22">too slow in a browser and Java scripts</span> <span data-start="1802.22" data-end="1804.29">like 10x lower so than native that's</span> <span data-start="1804.29" data-end="1806.87">something we were considering there's</span> <span data-start="1806.87" data-end="1808.76">also we we found also this holds in the</span> <span data-start="1808.76" data-end="1810.17">camera specification you cannot draw a</span> <span data-start="1810.17" data-end="1812.63">dashed line in canvas you can emulate</span> <span data-start="1812.63" data-end="1814.52">that it's just really hard math so</span> <span data-start="1814.52" data-end="1815.75">that's something we propose that's</span> <span data-start="1815.75" data-end="1817.79">already in this back actually similarly</span> <span data-start="1817.79" data-end="1819.89">there's compositing things together in</span> <span data-start="1819.89" data-end="1821.75">canvas and merging images is kind of</span> <span data-start="1821.75" data-end="1823.61">difficult so they will use this project</span> <span data-start="1823.61" data-end="1824.84">to kind of drive what kind of features</span> <span data-start="1824.84" data-end="1828.56">are missing absolutely in the questions</span> <span data-start="1828.56" data-end="1842.44">are back maybe all right</span> <span data-start="1842.45" data-end="1846.45">yeah so I used to work a JavaScript boob</span> <span data-start="1846.45" data-end="1847.86">unless there's a talking on JavaScript</span> <span data-start="1847.86" data-end="1849.36">performance and also couch catches</span> <span data-start="1849.36" data-end="1851.159">performance so there's an ongoing battle</span> <span data-start="1851.159" data-end="1852.809">to like nature's get fast that's going</span> <span data-start="1852.809" data-end="1854.669">to take some time javascript is language</span> <span data-start="1854.669" data-end="1856.409">is actually much harder to optimize than</span> <span data-start="1856.409" data-end="1858.36">a traditional i typed statically</span> <span data-start="1858.36" data-end="1861.21">compiled language as a simple thing as a</span> <span data-start="1861.21" data-end="1863.279">function call with this is really hard</span> <span data-start="1863.279" data-end="1865.799">to tell where it's going there might be</span> <span data-start="1865.799" data-end="1867.299">a getter than just fired you can be</span> <span data-start="1867.299" data-end="1869.19">seated in a code easily that somewhat</span> <span data-start="1869.19" data-end="1871.139">change the binding of that function on</span> <span data-start="1871.139" data-end="1873.09">this somewhere else or you might want</span> <span data-start="1873.09" data-end="1874.799">the Dom the dumb cause an event handler</span> <span data-start="1874.799" data-end="1876.69">that changes it somehow so it's very</span> <span data-start="1876.69" data-end="1878.639">hard to determine you can do you can do</span> <span data-start="1878.639" data-end="1880.62">optimistic population you can kind of in</span> <span data-start="1880.62" data-end="1882.84">line and guard against not failing these</span> <span data-start="1882.84" data-end="1883.919">things are being done so the next</span> <span data-start="1883.919" data-end="1886.289">version of our compiler will do that to</span> <span data-start="1886.289" data-end="1889.35">degree but right now if you wanna make</span> <span data-start="1889.35" data-end="1891.299">it fast and current browsers if you do a</span> <span data-start="1891.299" data-end="1892.47">little bit of poo finding a little bit</span> <span data-start="1892.47" data-end="1894.12">of August occation a couple lines of</span> <span data-start="1894.12" data-end="1895.86">code you get massive performance gains</span> <span data-start="1895.86" data-end="1902.039">so I think it is worth it</span> <span data-start="1902.049" data-end="1905">absolutely so the goal for this quarter</span> <span data-start="1905" data-end="1906.289">is if you want to put out an extension</span> <span data-start="1906.289" data-end="1908.289">that you can download and install and</span> <span data-start="1908.289" data-end="1910.07">ultimately we would like to see this in</span> </p>
<p><span data-start="1910.07" data-end="1915.559">Firefox about our main focuses Firefox</span> <span data-start="1915.559" data-end="1918.26">that's we know best it runs committee</span> <span data-start="1918.26" data-end="1919.49">contributors have poured it to Eddie</span> <span data-start="1919.49" data-end="1922.09">browser out there it runs very well in</span> <span data-start="1922.09" data-end="1925.85">Safari Chrome and Firefox it runs</span> <span data-start="1925.85" data-end="1927.65">somewhat in ie9 as well I just really</span> <span data-start="1927.65" data-end="1936.12">slow because I don't have typed arrays</span> <span data-start="1936.13" data-end="1942.049">yes well so when we set out to do this</span> <span data-start="1942.049" data-end="1943.82">project really one motivation was very</span> <span data-start="1943.82" data-end="1944.99">marginal platform side like we don't</span> <span data-start="1944.99" data-end="1946.97">like plugins plugins crash their crappy</span> <span data-start="1946.97" data-end="1949.1">their security problem so if we pick</span> <span data-start="1949.1" data-end="1951.08">kind of one popular plugin or native</span> <span data-start="1951.08" data-end="1953.179">code piece PDF but flash is kind of the</span> <span data-start="1953.179" data-end="1954.799">obvious elephant in a room as well so</span> <span data-start="1954.799" data-end="1956.659">they has already been project we do</span> <span data-start="1956.659" data-end="1959.24">flash it's it's very partial that's very</span> <span data-start="1959.24" data-end="1961.309">small and we are very hopeful that that</span> <span data-start="1961.309" data-end="1962.72">project will be extended rather poor</span> <span data-start="1962.72" data-end="1964.07">just like it will eventually your place</span> <span data-start="1964.07" data-end="1966.35">flash conceptually PDF and flush every</span> <span data-start="1966.35" data-end="1967.97">the same thing you have commands in the</span> <span data-start="1967.97" data-end="1969.47">stream that summer renders stuff to the</span> <span data-start="1969.47" data-end="1971.299">screen and I think you proved that you</span> <span data-start="1971.299" data-end="1973.07">can look very effectively using the web</span> <span data-start="1973.07" data-end="1975.409">pipeline can I PS like canvas a very</span> <span data-start="1975.409" data-end="1978.02">high level very efficient api's to this</span> <span data-start="1978.02" data-end="1979.549">kind of pixel pushing so really all you</span> <span data-start="1979.549" data-end="1981.559">do is kind of map the high level flash</span> <span data-start="1981.559" data-end="1983.96">format to a high level a canvas format</span> <span data-start="1983.96" data-end="1985.82">there's not all that much heavy lifting</span> <span data-start="1985.82" data-end="1987.26">and computation to be done in javascript</span> <span data-start="1987.26" data-end="1990.86">so you can do it very efficiently all</span> </p>
</section>