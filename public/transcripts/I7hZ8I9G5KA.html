<section>
<p><span data-start="10.13" data-end="12.8">okay since we were so nice to wait for</span> <span data-start="12.8" data-end="15.05">me I will actually do tell you how I met</span> <span data-start="15.05" data-end="17.18">Brandon it was about seven and a half</span> <span data-start="17.18" data-end="20.93">years ago or so and I wasn't like in</span> <span data-start="20.93" data-end="22.55">academia as you heard of a PhD in</span> <span data-start="22.55" data-end="26.48">computer science and my entire career</span> <span data-start="26.48" data-end="28.22">was really going towards being a</span> <span data-start="28.22" data-end="29.84">professor so I've worked all my life</span> <span data-start="29.84" data-end="31.73">being a professor I'm in two different</span> <span data-start="31.73" data-end="33.92">schools I got every degree available in</span> <span data-start="33.92" data-end="35.72">my field and I was trying to write</span> <span data-start="35.72" data-end="38.42">compilers and back then in the beginning</span> </p>
<p><span data-start="38.42" data-end="40.73">I was writing Java compilers and then</span> <span data-start="40.73" data-end="42.44">add the idea to write a JavaScript</span> <span data-start="42.44" data-end="45.65">compiler and the entire academic field</span> <span data-start="45.65" data-end="47.87">that I've worked for thought that it's a</span> <span data-start="47.87" data-end="50.75">really dumb idea I submitted paper after</span> <span data-start="50.75" data-end="52.76">paper showing how we can make JavaScript</span> <span data-start="52.76" data-end="56.15">go really fast and everyone told me that</span> <span data-start="56.15" data-end="57.77">I'm solving the wrong problem that</span> <span data-start="57.77" data-end="59.6">problem was already solved someone</span> <span data-start="59.6" data-end="62.6">invented java and typed languages all</span> <span data-start="62.6" data-end="64.189">you had to do is use Java instead of</span> <span data-start="64.189" data-end="65.84">JavaScript and then you wouldn't need</span> <span data-start="65.84" data-end="68.42">compilers for JavaScript so I couldn't</span> <span data-start="68.42" data-end="70.1">convince anyone in my own field in</span> <span data-start="70.1" data-end="72.95">academia to do javascript compilation i</span> <span data-start="72.95" data-end="75.049">ran into brandon this was all the time</span> <span data-start="75.049" data-end="78.14">when chrome was about to come out and we</span> <span data-start="78.14" data-end="79.7">knew that performance would kind of heat</span> <span data-start="79.7" data-end="82.549">up in the web and brandon hired me to</span> <span data-start="82.549" data-end="84.079">missoula to write a compiler for</span> <span data-start="84.079" data-end="86.299">javascript and we together released one</span> <span data-start="86.299" data-end="88.009">the the first commercially available</span> </p>
<p><span data-start="88.009" data-end="90.38">JavaScript compiler a couple days before</span> <span data-start="90.38" data-end="93.649">actually chrome came out so that's how</span> <span data-start="93.649" data-end="96.079">my Brendan and it was meant to be a very</span> <span data-start="96.079" data-end="98.24">short stay I was originally planned to</span> <span data-start="98.24" data-end="100.1">come up for three months the estimated</span> <span data-start="100.1" data-end="101.63">you can write a compiler for javascript</span> <span data-start="101.63" data-end="103.789">in three months and somehow ended up</span> <span data-start="103.789" data-end="106.34">never leaving all right but now let's</span> <span data-start="106.34" data-end="109.78">talk about Java and JavaScript some more</span> <span data-start="109.78" data-end="114.38">my talk today is going to explore why we</span> <span data-start="114.38" data-end="117.2">are doing Java and JavaScript but also I</span> <span data-start="117.2" data-end="118.67">one will be a little bit technical and</span> <span data-start="118.67" data-end="120.229">show you a little bit of the details of</span> </p>
<p><span data-start="120.229" data-end="122.719">Java and show you how you can implement</span> <span data-start="122.719" data-end="124.7">Java in JavaScript and some in some</span> <span data-start="124.7" data-end="127.78">interesting things emerge if you do that</span> <span data-start="127.78" data-end="130.729">first of all let me explain why we would</span> <span data-start="130.729" data-end="132.41">do this why would anyone in the year</span> <span data-start="132.41" data-end="135.14">2014 try to write a Java VM for</span> </p>
<p><span data-start="135.14" data-end="138.29">JavaScript Java v almost successfully</span> <span data-start="138.29" data-end="140.54">removed from the web stack today it's</span> <span data-start="140.54" data-end="141.95">very very rare that you're running</span> <span data-start="141.95" data-end="143.64">across Java applets</span> <span data-start="143.64" data-end="145.68">mostly banks I think that use it still</span> <span data-start="145.68" data-end="151.17">for security and login mechanisms their</span> <span data-start="151.17" data-end="153.42">reasons to you this year you might know</span> <span data-start="153.42" data-end="157.11">that we started bringing smartphones to</span> <span data-start="157.11" data-end="159.68">market about a year ago firefox OS and</span> <span data-start="159.68" data-end="162.09">firefox OS is targeting parts of the</span> <span data-start="162.09" data-end="164.97">world that have a lot of people who</span> <span data-start="164.97" data-end="166.14">currently have a feature phone and</span> <span data-start="166.14" data-end="167.64">they're looking to get their first</span> <span data-start="167.64" data-end="170.16">smartphone so device we are seeing here</span> <span data-start="170.16" data-end="171.75">it's actually a device we launched about</span> <span data-start="171.75" data-end="174.03">two months ago in India the price with</span> <span data-start="174.03" data-end="176.34">this device is around 30 US dollars so</span> <span data-start="176.34" data-end="178.709">it's about the cost of like a lunch in</span> </p>
<p><span data-start="178.709" data-end="180">San Francisco you can get a smartphone</span> <span data-start="180" data-end="182.1">and this thing is completed powered by</span> <span data-start="182.1" data-end="184.32">html5 so everything you can see in this</span> <span data-start="184.32" data-end="185.88">phone everything that runs on the phone</span> <span data-start="185.88" data-end="188.97">all the apps the UI itself everything is</span> <span data-start="188.97" data-end="193.5">written by html5 in html5 one problem we</span> <span data-start="193.5" data-end="196.07">run into is that it's over the top</span> <span data-start="196.07" data-end="198.75">messaging apps like Watsa are very</span> <span data-start="198.75" data-end="201.57">popular around the world and it differs</span> <span data-start="201.57" data-end="203.73">a little bit where what is popular but</span> <span data-start="203.73" data-end="205.59">you can see that the parts of the world</span> <span data-start="205.59" data-end="207.81">very particularly focusing on is Firefox</span> </p>
<p><span data-start="207.81" data-end="211.29">OS such as here in Latin but also I Asia</span> <span data-start="211.29" data-end="213.51">in those parts of the world there's</span> <span data-start="213.51" data-end="215.67">specific messaging apps that are really</span> <span data-start="215.67" data-end="218.91">popular and it's very hard to convince a</span> <span data-start="218.91" data-end="221.489">maker of this messaging app to make an</span> <span data-start="221.489" data-end="223.68">appt for html5 in some of these cases</span> <span data-start="223.68" data-end="225.87">because there's not a lot of devices out</span> <span data-start="225.87" data-end="228.15">there where today you can only bring</span> <span data-start="228.15" data-end="230.94">html5 content to so an Android you can</span> <span data-start="230.94" data-end="233.19">run an html5 app but you can also run an</span> <span data-start="233.19" data-end="235.29">Android app so these guys have all</span> <span data-start="235.29" data-end="238.44">written android apps for us there's no</span> <span data-start="238.44" data-end="240.48">Android in our stack there's no iOS</span> <span data-start="240.48" data-end="243.09">there's only the web and html5 so we</span> <span data-start="243.09" data-end="245.28">needed somehow away to get these apps to</span> <span data-start="245.28" data-end="248.22">run in our platform in some cases we</span> <span data-start="248.22" data-end="250.56">were able to convince them that html5 is</span> <span data-start="250.56" data-end="251.76">the future and they should write an</span> <span data-start="251.76" data-end="254.459">html5 app for the platform line for</span> <span data-start="254.459" data-end="256.769">example did that but a couple other guys</span> <span data-start="256.769" data-end="258.51">didn't do that and if you look at this</span> <span data-start="258.51" data-end="260.34">graph this data is about a year old but</span> <span data-start="260.34" data-end="262.52">it shows that in some parts of the world</span> <span data-start="262.52" data-end="265.11">some of these messaging apps are very</span> <span data-start="265.11" data-end="267.06">very popular and if you don't have them</span> <span data-start="267.06" data-end="268.59">on your phone nobody's going to buy it</span> <span data-start="268.59" data-end="271.2">look down here for example in many parts</span> <span data-start="271.2" data-end="273.72">of Latin if you don't have what's up</span> <span data-start="273.72" data-end="275.37">it's really difficult to explain to</span> <span data-start="275.37" data-end="276.87">someone why they would want to buy your</span> <span data-start="276.87" data-end="279.48">so we needed a way to have what's up on</span> <span data-start="279.48" data-end="281.76">this device even if what's up was not</span> <span data-start="281.76" data-end="284.25">willing to make an appt an html5 just</span> <span data-start="284.25" data-end="286.65">yet because when we started last year we</span> <span data-start="286.65" data-end="290.7">had we started with 0 users so there's</span> <span data-start="290.7" data-end="293.22">basic two things you can do one you can</span> <span data-start="293.22" data-end="295.83">go ahead and try to just write your own</span> <span data-start="295.83" data-end="298.02">wats up implementation or line</span> <span data-start="298.02" data-end="300.42">implementation we did that and some of</span> <span data-start="300.42" data-end="302.07">those who can get in the marketplace but</span> <span data-start="302.07" data-end="304.2">people often ask specifically for what's</span> <span data-start="304.2" data-end="306.15">up so to go in a store and want to buy a</span> <span data-start="306.15" data-end="309.48">phone this what's up or is lying or his</span> <span data-start="309.48" data-end="313.02">y ver and in these cases people in the</span> <span data-start="313.02" data-end="314.61">store would say well it doesn't have</span> <span data-start="314.61" data-end="317.67">what's up but the moment you start a</span> <span data-start="317.67" data-end="319.11">sentence with it doesn't have what's up</span> <span data-start="319.11" data-end="321.12">the person basically media doesn't want</span> <span data-start="321.12" data-end="322.98">to phone anymore so to solve this</span> <span data-start="322.98" data-end="324.51">problem somehow we have to get what's up</span> <span data-start="324.51" data-end="328.38">onto our phone without relying on them</span> <span data-start="328.38" data-end="330.6">making a wats up version until the</span> <span data-start="330.6" data-end="333.24">enough users that people right naturally</span> <span data-start="333.24" data-end="335.49">software for html5 as well that's kind</span> <span data-start="335.49" data-end="336.72">of the whole idea what Mozilla is all</span> <span data-start="336.72" data-end="338.79">about right we want to try to make html5</span> <span data-start="338.79" data-end="341.67">as successful mobile as it's today on a</span> <span data-start="341.67" data-end="345.39">desktop it gets even a little bit worse</span> <span data-start="345.39" data-end="348.24">because the main competition for Firefox</span> </p>
<p><span data-start="348.24" data-end="350.49">OS phones are these things future phones</span> <span data-start="350.49" data-end="353.76">so for the price range of the very</span> <span data-start="353.76" data-end="356.01">entry-level Firefox OS devices that's</span> <span data-start="356.01" data-end="357.72">kind of the competition you can get some</span> <span data-start="357.72" data-end="360.36">like Nokia feature phone with a dart pad</span> <span data-start="360.36" data-end="362.73">in the small screen these things</span> <span data-start="362.73" data-end="364.68">actually many of these messaging apps</span> <span data-start="364.68" data-end="366.54">are available so this makes the</span> <span data-start="366.54" data-end="367.98">situation for us a little bit more</span> <span data-start="367.98" data-end="370.74">tricky because on the thing we compete</span> <span data-start="370.74" data-end="372.51">with which is so much worse and hardware</span> <span data-start="372.51" data-end="374.28">and it doesn't have proper web</span> <span data-start="374.28" data-end="375.45">experience doesn't have a touch screen</span> <span data-start="375.45" data-end="378.42">but it has whatsapp so people go in a</span> <span data-start="378.42" data-end="380.01">store and I'm on a thing with what's up</span> <span data-start="380.01" data-end="382.26">and then they get this here and not the</span> <span data-start="382.26" data-end="385.2">smartphone at the same time though this</span> <span data-start="385.2" data-end="387.33">is actually also a nice solution because</span> <span data-start="387.33" data-end="389.31">as I said these things run these</span> <span data-start="389.31" data-end="391.14">messaging apps so the idea we were</span> <span data-start="391.14" data-end="393.03">looking at how can we take these</span> <span data-start="393.03" data-end="395.4">messaging apps that are designed for</span> <span data-start="395.4" data-end="397.71">these feature phones and run them on</span> </p>
<p><span data-start="397.71" data-end="402.12">Firefox OS these things of course run</span> <span data-start="402.12" data-end="403.74">Java all right in case you didn't know</span> <span data-start="403.74" data-end="405.99">that if you ever have to install Java</span> <span data-start="405.99" data-end="407.37">and I hope nobody here is that</span> <span data-start="407.37" data-end="409.59">unfortunate when you install that it</span> <span data-start="409.59" data-end="410.61">tells you that this Oh</span> <span data-start="410.61" data-end="412.919">three billion devices or three billion</span> <span data-start="412.919" data-end="414.99">phones running java I'm not sure it's</span> <span data-start="414.99" data-end="416.219">still true today but it's probably</span> <span data-start="416.219" data-end="418.05">roughly the right ballpark there's</span> <span data-start="418.05" data-end="419.46">literally billions of phones out there</span> <span data-start="419.46" data-end="421.379">anything that's not a smartphone today</span> <span data-start="421.379" data-end="424.469">tends to run Java inside of it and it</span> <span data-start="424.469" data-end="425.939">runs a very specific version of Java</span> <span data-start="425.939" data-end="430.229">that's called j2me and I will kind of</span> <span data-start="430.229" data-end="432.24">explain where that fits in many of you</span> <span data-start="432.24" data-end="434.159">have probably never seen this that's not</span> <span data-start="434.159" data-end="435.599">a problem it's just this is all stuff</span> <span data-start="435.599" data-end="437.28">this is like I pulled this we can see</span> <span data-start="437.28" data-end="439.259">how bad the phones are this is like a 14</span> <span data-start="439.259" data-end="441.539">year old picture so this is what some</span> <span data-start="441.539" data-end="443.729">thought the world would look like in the</span> <span data-start="443.729" data-end="446.819">future like 14 years ago so basically</span> <span data-start="446.819" data-end="449.46">idea was that everything is Java all the</span> <span data-start="449.46" data-end="451.86">way from Java cards this is this is sim</span> <span data-start="451.86" data-end="453.539">cards new phone for example another on</span> <span data-start="453.539" data-end="456.389">the way right side here and then there's</span> <span data-start="456.389" data-end="458.759">this lightweight versions of Java this</span> <span data-start="458.759" data-end="461.009">is a micro edition or limited device</span> <span data-start="461.009" data-end="462.779">edition of Java and then here's the</span> <span data-start="462.779" data-end="465.469">grown-up job on desktop a nun service of</span> <span data-start="465.469" data-end="467.34">course today this totally looks</span> <span data-start="467.34" data-end="469.11">different right so the only place where</span> </p>
<p><span data-start="469.11" data-end="471.389">Java really survived is in sim cards</span> <span data-start="471.389" data-end="473.46">that's still javo today and then on a</span> <span data-start="473.46" data-end="475.289">very far end here in enterprise and</span> <span data-start="475.289" data-end="476.969">servers there's still some Java in the</span> <span data-start="476.969" data-end="478.8">middle of it is small is dead the</span> <span data-start="478.8" data-end="480.21">particular piece we care about is this</span> <span data-start="480.21" data-end="483.419">one here the limited configuration of</span> <span data-start="483.419" data-end="485.479">Java that runs on these feature phones</span> <span data-start="485.479" data-end="489.06">the vm that that was built for that is</span> <span data-start="489.06" data-end="491.49">called kvm or the killer x 3m that meant</span> <span data-start="491.49" data-end="492.75">to express that these things are</span> <span data-start="492.75" data-end="494.31">designed to run this relatively little</span> <span data-start="494.31" data-end="495.719">memory that you have available in his</span> <span data-start="495.719" data-end="499.919">future phones so there's a couple</span> <span data-start="499.919" data-end="502.199">different ways how we can go and</span> <span data-start="502.199" data-end="506.699">implement a Java VM in our phone to</span> <span data-start="506.699" data-end="508.05">explain that of this architecture</span> <span data-start="508.05" data-end="510.659">diagram here or Firefox OS I have no</span> <span data-start="510.659" data-end="512.039">idea what the Japanese characters mean</span> <span data-start="512.039" data-end="514.05">in case you wonder I just found this and</span> <span data-start="514.05" data-end="515.61">its really cool graphics I also don't</span> <span data-start="515.61" data-end="518.19">have no idea what the ice cone means but</span> <span data-start="518.19" data-end="519.719">it was really kind of funny and I like</span> <span data-start="519.719" data-end="521.94">the picture so I decided to use this it</span> <span data-start="521.94" data-end="523.409">does show the necessary things I have to</span> <span data-start="523.409" data-end="524.85">show so just ignore the Japanese</span> <span data-start="524.85" data-end="526.38">characters and ignore the ice cream cone</span> <span data-start="526.38" data-end="529.41">for a moment so we have it at the bottom</span> <span data-start="529.41" data-end="531.899">we have gonk which is our version of</span> </p>
<p><span data-start="531.899" data-end="533.339">Linux and a couple other low-level</span> <span data-start="533.339" data-end="535.41">things that are really boring and on top</span> <span data-start="535.41" data-end="537.36">of that is gecko gecko is mozillas</span> <span data-start="537.36" data-end="538.89">rendering engine that's the thing that</span> <span data-start="538.89" data-end="540.69">displays the web and then on top of</span> <span data-start="540.69" data-end="544.259">gecko des Gaia Gaia is this html5</span> <span data-start="544.259" data-end="545.819">experience that we talked about so all</span> <span data-start="545.819" data-end="547.529">the things that you see in Firefox OS</span> <span data-start="547.529" data-end="549.989">are all implemented in html5 and that's</span> <span data-start="549.989" data-end="553.41">what we call Gaia so the simplest way to</span> <span data-start="553.41" data-end="554.85">implement this would be of course to</span> <span data-start="554.85" data-end="557.729">take a Java VM symbolized here to the</span> <span data-start="557.729" data-end="559.589">inventor of Java and you could just kind</span> <span data-start="559.589" data-end="561.929">of like stick that on top of gong next</span> <span data-start="561.929" data-end="563.669">to gecko and basically just kind of veg</span> <span data-start="563.669" data-end="566.489">it into our phone home and then we could</span> <span data-start="566.489" data-end="569.089">run messaging things on top of that of</span> <span data-start="569.089" data-end="571.41">course this is bad at least for two</span> <span data-start="571.41" data-end="575.669">reasons first of all Java has a really</span> <span data-start="575.669" data-end="577.759">bad track record with security um</span> <span data-start="577.759" data-end="580.41">they're still finding really fundamental</span> <span data-start="580.41" data-end="582.749">bugs in Java and they often really bad</span> <span data-start="582.749" data-end="584.399">because they affect all browsers at the</span> <span data-start="584.399" data-end="586.769">same time so if you do this if you take</span> <span data-start="586.769" data-end="588.959">a Java VM and kind of like stick it into</span> <span data-start="588.959" data-end="591.689">our system since the Java VM would be</span> <span data-start="591.689" data-end="593.91">sitting directly on top of Linux and the</span> </p>
<p><span data-start="593.91" data-end="596.939">OS core we would basically create a</span> <span data-start="596.939" data-end="599.939">second surface for vulnerabilities there</span> <span data-start="599.939" data-end="601.229">could be like additional bugs in the</span> <span data-start="601.229" data-end="603.299">Java VM and they would create additional</span> <span data-start="603.299" data-end="606.239">room for the phone to be broken into so</span> <span data-start="606.239" data-end="607.799">that's a really bad idea to kind of put</span> <span data-start="607.799" data-end="609.66">it in addition to the rendering engine</span> <span data-start="609.66" data-end="610.709">you basically have twice as much</span> <span data-start="610.709" data-end="613.789">opportunity for something to go wrong</span> <span data-start="613.789" data-end="616.739">and in the second reason of course is</span> <span data-start="616.739" data-end="618.929">that it would be really bad karma to put</span> <span data-start="618.929" data-end="620.879">another Java VM into the vet stack right</span> <span data-start="620.879" data-end="622.499">so we got to the point where you don't</span> <span data-start="622.499" data-end="625.289">want a neat job on a desktop and this</span> <span data-start="625.289" data-end="626.549">feature phones over the next couple</span> <span data-start="626.549" data-end="629.369">years going out of fashion java will</span> <span data-start="629.369" data-end="632.069">also go out of fashion with it so at</span> <span data-start="632.069" data-end="634.23">this point putting a Java VM into a</span> <span data-start="634.23" data-end="636.209">web-based and standards-based an</span> <span data-start="636.209" data-end="638.369">html5-based phone it seems like a really</span> <span data-start="638.369" data-end="640.589">bad idea so we decided not to go that</span> <span data-start="640.589" data-end="644.91">route so of course what that leaves us</span> <span data-start="644.91" data-end="646.859">is this then is to take our little</span> <span data-start="646.859" data-end="648.989">diagram here with a Japanese characters</span> <span data-start="648.989" data-end="652.169">in the ice cream cone and simply take a</span> </p>
<p><span data-start="652.169" data-end="655.259">Java VM and put it on top of the entire</span> <span data-start="655.259" data-end="658.039">system so we simply avoid a nap in html5</span> <span data-start="658.039" data-end="663.509">that implement the Java VM and that app</span> <span data-start="663.509" data-end="665.789">knows how to download the messaging app</span> <span data-start="665.789" data-end="668.039">itself and I can run this whole thing on</span> <span data-start="668.039" data-end="671.819">an existing phone the really nice part</span> <span data-start="671.819" data-end="674.22">of this is that at the time that we</span> <span data-start="674.22" data-end="675.929">started this which was about four or</span> <span data-start="675.929" data-end="677.759">five months ago we already had a large</span> <span data-start="677.759" data-end="679.919">number of phones out in the field that</span> <span data-start="679.919" data-end="681.689">all don't have the original version of</span> <span data-start="681.689" data-end="684.329">some of these messaging apps if we do it</span> <span data-start="684.329" data-end="686.22">this way since we're not using any</span> <span data-start="686.22" data-end="688.859">privileged html5 capabilities you're not</span> <span data-start="688.859" data-end="690.809">kind of trying to bypass the platform in</span> <span data-start="690.809" data-end="693.869">any way we can actually make an appt an</span> <span data-start="693.869" data-end="696.569">html5 web app like this and just put it</span> <span data-start="696.569" data-end="698.069">in a marketplace where people can</span> <span data-start="698.069" data-end="700.799">download it and it can use this let me</span> <span data-start="700.799" data-end="702.749">sort having to buy a new phone so this</span> <span data-start="702.749" data-end="704.189">is very nice because we address the</span> <span data-start="704.189" data-end="708.839">existing on set of phones as well all</span> <span data-start="708.839" data-end="710.909">right the the downside of it of course</span> <span data-start="710.909" data-end="712.679">is now we have to write a Java VM in</span> </p>
<p><span data-start="712.679" data-end="715.739">JavaScript that's very exciting as I</span> <span data-start="715.739" data-end="718.529">said my background is in writing</span> <span data-start="718.529" data-end="720.359">compilers that's what i did in academia</span> <span data-start="720.359" data-end="725.159">before brennan kind of freed me from</span> <span data-start="725.159" data-end="727.589">academia let's put this way and my</span> <span data-start="727.589" data-end="729.029">entire background net revolves in Java</span> <span data-start="729.029" data-end="730.919">compilers before i started to JavaScript</span> <span data-start="730.919" data-end="732.509">compiler so this is one of the reasons</span> <span data-start="732.509" data-end="734.519">that i found this project particular</span> <span data-start="734.519" data-end="735.689">interesting because i have done both</span> <span data-start="735.689" data-end="737.819">extensively i have written several java</span> </p>
<p><span data-start="737.819" data-end="739.679">VMs and i have written several</span> <span data-start="739.679" data-end="741.6">implementations of java spoken powders I</span> <span data-start="741.6" data-end="744.689">never really try to write a Java VM on</span> <span data-start="744.689" data-end="746.489">top of JavaScript so that seemed very</span> <span data-start="746.489" data-end="751.289">appealing to me so for the next couple</span> <span data-start="751.289" data-end="753.239">of slides I will dive a little bit into</span> <span data-start="753.239" data-end="755.1">technical details and explain to you at</span> <span data-start="755.1" data-end="756.869">the high level of how Java works and</span> <span data-start="756.869" data-end="759.779">show you some of the problems that i ran</span> <span data-start="759.779" data-end="762.539">into trying to build a Java VM that's</span> <span data-start="762.539" data-end="764.909">really ready to run production level</span> <span data-start="764.909" data-end="767.999">code on a device like this don't worry</span> <span data-start="767.999" data-end="769.769">too much if you don't see on understand</span> <span data-start="769.769" data-end="771.119">some of the details for example there</span> <span data-start="771.119" data-end="773.249">will be no quiz after my talk on the</span> <span data-start="773.249" data-end="775.079">details of this slide this is merely</span> <span data-start="775.079" data-end="776.959">meant to kind of highlight some of the</span> <span data-start="776.959" data-end="779.1">concepts need to understand so we can</span> <span data-start="779.1" data-end="780.959">understand the next slide so in this</span> <span data-start="780.959" data-end="782.579">slide here really the only thing you</span> <span data-start="782.579" data-end="785.279">should memorize is that Java is built</span> <span data-start="785.279" data-end="787.859">from class files every Java program that</span> <span data-start="787.859" data-end="789.809">you get consists of a large number of</span> <span data-start="789.809" data-end="792.35">class files and each class file</span> <span data-start="792.35" data-end="795.389">represents one class and these things</span> <span data-start="795.389" data-end="798.119">are stored in a binary format it's</span> <span data-start="798.119" data-end="799.769">basically an array of bytes that</span> <span data-start="799.769" data-end="801.48">contains information about the class</span> <span data-start="801.48" data-end="804.689">itself it contains the fields and the</span> <span data-start="804.689" data-end="806.73">methods of a class</span> <span data-start="806.73" data-end="809.13">the actual code which is sort of the</span> <span data-start="809.13" data-end="811.62">bytecode the bytecode you can think of</span> <span data-start="811.62" data-end="814.199">as a sequence of bytes that explains</span> <span data-start="814.199" data-end="816.72">what instruction the vm should take and</span> <span data-start="816.72" data-end="819.18">the vm goes step-by-step through these</span> <span data-start="819.18" data-end="822.18">by code instructions so really all you</span> <span data-start="822.18" data-end="823.98">have to do to run a Java program is you</span> <span data-start="823.98" data-end="826.139">have to find a way how you can parse</span> <span data-start="826.139" data-end="828.63">these class files and then you write an</span> <span data-start="828.63" data-end="831.029">interpreter for this language this java</span> <span data-start="831.029" data-end="833.76">bytecode language and then you run that</span> <span data-start="833.76" data-end="836.1">interpreter over the code that you find</span> <span data-start="836.1" data-end="838.41">in these classes and once you have one</span> <span data-start="838.41" data-end="841.32">class let's your starting class it will</span> <span data-start="841.32" data-end="843.63">call methods it can call methods in the</span> <span data-start="843.63" data-end="845.519">same class or it can call to other</span> <span data-start="845.519" data-end="847.68">classes whenever it calls another class</span> <span data-start="847.68" data-end="849.87">you have to go and find the class file</span> <span data-start="849.87" data-end="852.18">for the other class so that's that's the</span> <span data-start="852.18" data-end="855.66">other than in time magic behind Java now</span> <span data-start="855.66" data-end="859.199">as I said javac on Java programs consist</span> <span data-start="859.199" data-end="862.43">of a large number of this class files a</span> <span data-start="862.43" data-end="864.72">popular messaging app like what's up or</span> <span data-start="864.72" data-end="866.37">viber is often hundreds of different</span> <span data-start="866.37" data-end="868.949">classes in addition to that you also</span> <span data-start="868.949" data-end="870.899">have library classes which are often</span> <span data-start="870.899" data-end="873.449">thousands of classes it would be of</span> <span data-start="873.449" data-end="875.399">course kind of awkward to have to carry</span> <span data-start="875.399" data-end="877.019">around a thousand files if you're</span> <span data-start="877.019" data-end="879">installing a drama program so what they</span> <span data-start="879" data-end="883.319">came up this is jar files a jar file is</span> <span data-start="883.319" data-end="887.43">a java java like name for a zip file so</span> <span data-start="887.43" data-end="889.35">it turns out jar fights really are like</span> <span data-start="889.35" data-end="891.3">zip files they are exactly structured</span> <span data-start="891.3" data-end="893.069">the same in there basically just a zip</span> <span data-start="893.069" data-end="896.279">archive miss all the Java class files</span> <span data-start="896.279" data-end="897.899">inside of that and if you want to</span> <span data-start="897.899" data-end="899.73">distribute a Java app all you do is you</span> <span data-start="899.73" data-end="901.62">give someone a jar file and then the vm</span> <span data-start="901.62" data-end="903.959">can go and read all that stuff out of</span> <span data-start="903.959" data-end="907.41">the jar file the first problem we run</span> <span data-start="907.41" data-end="910.019">into is that as i explained what you</span> <span data-start="910.019" data-end="911.61">want to do is we want to write an app</span> <span data-start="911.61" data-end="914.13">that knows how to run a Java program and</span> <span data-start="914.13" data-end="916.38">it will get that actual Java program</span> <span data-start="916.38" data-end="918.449">from whoever is distributing the Java</span> <span data-start="918.449" data-end="921.42">program not from us so the first step we</span> <span data-start="921.42" data-end="923.819">have to make sure of is that this Java</span> </p>
<p><span data-start="923.819" data-end="926.13">VM that we are writing can read this</span> <span data-start="926.13" data-end="927.81">original jar files so we need to be able</span> <span data-start="927.81" data-end="932.91">to parse zip files fortunately that's</span> <span data-start="932.91" data-end="934.62">something I had to do before so we did</span> <span data-start="934.62" data-end="936.899">PDF ojs a couple years ago to display</span> <span data-start="936.899" data-end="940.05">PDF documents as html5 and there</span> <span data-start="940.05" data-end="941.82">Oh as well the first problem we have to</span> <span data-start="941.82" data-end="943.95">solve is that PDF documents are</span> <span data-start="943.95" data-end="946.47">basically zip files as well so you can</span> <span data-start="946.47" data-end="947.79">if you can see a mean here like</span> <span data-start="947.79" data-end="949.32">everything out there is a fob basically</span> <span data-start="949.32" data-end="952.019">and we had actually implemented for PDF</span> <span data-start="952.019" data-end="954.269">ojs a zip file reader lets up on github</span> <span data-start="954.269" data-end="957.63">and I'd lying around there for like the</span> <span data-start="957.63" data-end="959.22">last two years and we didn't touch it</span> <span data-start="959.22" data-end="963.029">since then so I took zip file dodge is</span> <span data-start="963.029" data-end="965.04">my word al-ilah parser for class file so</span> <span data-start="965.04" data-end="968.01">kind of see how this goes and should</span> <span data-start="968.01" data-end="969.48">work great right we have again parse</span> <span data-start="969.48" data-end="971.279">class files now we can read the files</span> <span data-start="971.279" data-end="975.72">and it totally didn't work at all that</span> <span data-start="975.72" data-end="977.91">was somewhat unexpected so I spent a</span> <span data-start="977.91" data-end="980.64">good afternoon trying to find out why</span> <span data-start="980.64" data-end="982.38">the class files I was getting out of the</span> <span data-start="982.38" data-end="987.18">jar files did not make any sense and it</span> <span data-start="987.18" data-end="991.11">turns out that if you read the</span> <span data-start="991.11" data-end="993.74">specification of zip files which I did</span> <span data-start="993.74" data-end="997.41">it's a very painful process I hope you</span> <span data-start="997.41" data-end="999">never have to do that it's really it</span> <span data-start="999" data-end="1003.73">sucks the specification says that any</span> <span data-start="1003.73" data-end="1007.55">zeros at the end of a stream you don't</span> <span data-start="1007.55" data-end="1009.649">have to store so if you're storing a</span> <span data-start="1009.649" data-end="1011.45">compressed file and the last couple</span> <span data-start="1011.45" data-end="1013.82">things in the file are zeros you can</span> <span data-start="1013.82" data-end="1016.67">leave out those zeros the program that</span> <span data-start="1016.67" data-end="1018.56">parses the zip file is supposed to know</span> <span data-start="1018.56" data-end="1020.66">that there's something missing just add</span> <span data-start="1020.66" data-end="1024.47">an 0 and I somewhat didn't read this</span> <span data-start="1024.47" data-end="1025.79">right the first time we wrote this</span> <span data-start="1025.79" data-end="1027.77">implementation so what the code</span> <span data-start="1027.77" data-end="1029.6">originally did is if you're running out</span> <span data-start="1029.6" data-end="1034.1">of bytes in your typed array and you get</span> <span data-start="1034.1" data-end="1035.48">an  back you raise an exception</span> <span data-start="1035.48" data-end="1037.579">so this is the error of your running</span> <span data-start="1037.579" data-end="1040.04">into and the fix of course is very easy</span> <span data-start="1040.04" data-end="1042.8">you simply read data from a byte array</span> <span data-start="1042.8" data-end="1045.8">and then we just or a 0 in there this is</span> <span data-start="1045.8" data-end="1047.179">a trick we will use a little bit later</span> <span data-start="1047.179" data-end="1048.65">on a slide as well what this basically</span> <span data-start="1048.65" data-end="1052.28">does it it it forces that to be an</span> <span data-start="1052.28" data-end="1056.15">integer number and  is the</span> <span data-start="1056.15" data-end="1057.77">equivalent of the integer number 0 so</span> <span data-start="1057.77" data-end="1059.54">whenever we read past the end of this</span> <span data-start="1059.54" data-end="1061.73">byte stream then we will start reading</span> <span data-start="1061.73" data-end="1063.35">back zeros which is exactly what the</span> <span data-start="1063.35" data-end="1066.2">specification calls for the neat part is</span> <span data-start="1066.2" data-end="1069.919">that we ship this bug in PDF no Jas for</span> <span data-start="1069.919" data-end="1072.89">years so people have looked at like</span> <span data-start="1072.89" data-end="1073.51">billions</span> </p>
<p><span data-start="1073.51" data-end="1075.7">PDF documents and nobody notices that</span> <span data-start="1075.7" data-end="1077.77">this was wrong this must be because the</span> <span data-start="1077.77" data-end="1080.5">implementation of jar files and of PDF</span> <span data-start="1080.5" data-end="1082.33">readers is separate so the PDF readers</span> <span data-start="1082.33" data-end="1083.98">seemed or generators don't seem to</span> <span data-start="1083.98" data-end="1086.32">generate this kind of optimization with</span> <span data-start="1086.32" data-end="1088.51">zero at the end so since then we</span> <span data-start="1088.51" data-end="1091.38">actually fix that in in Firefox as well</span> <span data-start="1091.38" data-end="1095.35">all right next step so I had now a way</span> <span data-start="1095.35" data-end="1097.99">to read your files after some pain and I</span> <span data-start="1097.99" data-end="1101.53">had a way to parse class files the next</span> <span data-start="1101.53" data-end="1103.3">step of course is VM we have to go and</span> <span data-start="1103.3" data-end="1105.25">get something it will interpret that</span> <span data-start="1105.25" data-end="1106.81">byte code and run the actual Java</span> <span data-start="1106.81" data-end="1109.24">program for us the most natural way of</span> <span data-start="1109.24" data-end="1110.77">doing that these days would be of course</span> <span data-start="1110.77" data-end="1113.44">to take and scripting and scripting is</span> <span data-start="1113.44" data-end="1117.73">this C++ or C C++ compiler that takes</span> <span data-start="1117.73" data-end="1121.15">existing C++ code and it emits through</span> <span data-start="1121.15" data-end="1123.94">llvm and a couple other steps JavaScript</span> <span data-start="1123.94" data-end="1126.79">from that all the last year actually we</span> <span data-start="1126.79" data-end="1128.59">also did an extension of that called</span> </p>
<p><span data-start="1128.59" data-end="1130.93">SMGs which I think Brendan will show in</span> <span data-start="1130.93" data-end="1133.15">his talk in a little bit that makes it</span> <span data-start="1133.15" data-end="1134.53">possible to make this really efficient</span> <span data-start="1134.53" data-end="1136.78">so if you do this path if you go from C</span> <span data-start="1136.78" data-end="1139.51">C++ down to JavaScript you can get</span> <span data-start="1139.51" data-end="1140.68">really really close to native</span> <span data-start="1140.68" data-end="1143.29">performance so is this work this would</span> <span data-start="1143.29" data-end="1144.7">be great because all i have to do is</span> <span data-start="1144.7" data-end="1148.42">take kvm which is written in c and i</span> <span data-start="1148.42" data-end="1150.63">could compile that and i would have a vm</span> <span data-start="1150.63" data-end="1153.13">in my browser or am I rendering engine</span> <span data-start="1153.13" data-end="1156.55">in theory that's really great and you</span> <span data-start="1156.55" data-end="1158.02">should always reuse code if you can</span> <span data-start="1158.02" data-end="1160.54">however in this case I couldn't find a</span> <span data-start="1160.54" data-end="1163.33">license for kvm and I'm serious there's</span> <span data-start="1163.33" data-end="1164.71">no license they put on coat there</span> <span data-start="1164.71" data-end="1166.48">they're saying that there's no license</span> <span data-start="1166.48" data-end="1168.16">and didn't have a license for it so i</span> <span data-start="1168.16" data-end="1169.84">started calling up some old friends from</span> <span data-start="1169.84" data-end="1172.48">sun and there's really no license out</span> <span data-start="1172.48" data-end="1173.89">there so for some reason is out there</span> <span data-start="1173.89" data-end="1176.08">there's no license right now to use it</span> <span data-start="1176.08" data-end="1178.18">and i couldn't find anyone left at</span> </p>
<p><span data-start="1178.18" data-end="1181.03">Oracle who knows how they could slap and</span> <span data-start="1181.03" data-end="1182.86">open-source license on to it so I ended</span> <span data-start="1182.86" data-end="1185.11">up basically not be able to use kvm</span> <span data-start="1185.11" data-end="1186.73">because it's not allowed you can only</span> <span data-start="1186.73" data-end="1188.38">use it for research purposes you cannot</span> <span data-start="1188.38" data-end="1190.6">use it for any other purpose so this was</span> <span data-start="1190.6" data-end="1192.7">very sad because there's essentially no</span> <span data-start="1192.7" data-end="1194.71">other open source project that</span> <span data-start="1194.71" data-end="1197.47">implements this specific flavor of the</span> <span data-start="1197.47" data-end="1199.9">vm there's a couple open-source VMs that</span> <span data-start="1199.9" data-end="1201.46">implement a more heavyweight complete</span> <span data-start="1201.46" data-end="1204.04">java VMS but nothing implements this</span> <span data-start="1204.04" data-end="1207.04">limited configuration at kvm needs</span> <span data-start="1207.04" data-end="1209.26">so one of the reasons I'm here today</span> <span data-start="1209.26" data-end="1211">with you is because son didn't put a</span> <span data-start="1211" data-end="1216.45">license on kvm 14 years ago I all right</span> <span data-start="1216.45" data-end="1222.79">um so divided a vm i went to github and</span> <span data-start="1222.79" data-end="1224.86">try to find who else try to do this and</span> <span data-start="1224.86" data-end="1226.06">it turns out a whole bunch of people</span> <span data-start="1226.06" data-end="1228.04">have tried to write Java VM sin</span> </p>
<p><span data-start="1228.04" data-end="1230.41">JavaScript and everyone tends to do that</span> <span data-start="1230.41" data-end="1233.46">for about two months before they give up</span> <span data-start="1233.46" data-end="1235.09">so I looked at all the different</span> <span data-start="1235.09" data-end="1236.5">implementations that were completely</span> <span data-start="1236.5" data-end="1238.93">incomplete and the one I like the best</span> <span data-start="1238.93" data-end="1242.8">is called no JVM I liked it because the</span> <span data-start="1242.8" data-end="1244.06">code structure was gonna be very nice</span> <span data-start="1244.06" data-end="1247.45">and neat or maybe just because his style</span> <span data-start="1247.45" data-end="1250.42">match my random style very well but</span> <span data-start="1250.42" data-end="1252.13">anyway this was the one that I started</span> <span data-start="1252.13" data-end="1254.92">with I'd had our classified parser and a</span> <span data-start="1254.92" data-end="1256.9">bunch of different other pieces that I</span> <span data-start="1256.9" data-end="1258.31">was able to be used so if this actually</span> <span data-start="1258.31" data-end="1259.84">was able to get the first hello world</span> <span data-start="1259.84" data-end="1263.38">program to work I very quickly realized</span> <span data-start="1263.38" data-end="1265.17">that the way that they implemented</span> <span data-start="1265.17" data-end="1269.26">natives is a really bad idea so what is</span> <span data-start="1269.26" data-end="1271.99">the native and drama as you probably</span> <span data-start="1271.99" data-end="1274.42">know Java is a type-safe language so</span> <span data-start="1274.42" data-end="1275.98">there's a lot of things you cannot do in</span> </p>
<p><span data-start="1275.98" data-end="1278.02">Java you cannot poke around this memory</span> <span data-start="1278.02" data-end="1280.18">addresses you cannot directly call a</span> <span data-start="1280.18" data-end="1282.16">system call that would invoke some</span> <span data-start="1282.16" data-end="1284.5">service from the operating system to do</span> <span data-start="1284.5" data-end="1286.42">these things Java has to somehow paul</span> <span data-start="1286.42" data-end="1289.18">into c code and this C code is what Java</span> <span data-start="1289.18" data-end="1291.76">called native code it's basically in the</span> <span data-start="1291.76" data-end="1293.62">vm a way to recognize that you're</span> <span data-start="1293.62" data-end="1296.38">calling a special magic method this a</span> <span data-start="1296.38" data-end="1298.87">specific name and that name is mapped to</span> <span data-start="1298.87" data-end="1301.87">running a c function instead of trying</span> <span data-start="1301.87" data-end="1305.1">to run actual javascript by core program</span> <span data-start="1305.1" data-end="1310.42">the way that the author of this vm</span> <span data-start="1310.42" data-end="1313.99">implemented all the java libraries is</span> <span data-start="1313.99" data-end="1317.41">that he basically made every single java</span> <span data-start="1317.41" data-end="1320.11">library method a native method so you</span> <span data-start="1320.11" data-end="1321.7">would go ahead and JavaScript implement</span> <span data-start="1321.7" data-end="1323.32">every single thing did you need in Java</span> <span data-start="1323.32" data-end="1327.73">in JavaScript that again is a bad idea</span> <span data-start="1327.73" data-end="1329.35">for a couple different reasons first of</span> <span data-start="1329.35" data-end="1332.62">all there's a lot of stuff the Java</span> <span data-start="1332.62" data-end="1334.96">library that you need for this phones</span> <span data-start="1334.96" data-end="1336.64">that you're not very large is about one</span> <span data-start="1336.64" data-end="1339.91">megabyte as a compressed jar file if you</span> </p>
<p><span data-start="1339.91" data-end="1340.87">I'm</span> <span data-start="1340.87" data-end="1343.39">Press that and because classify it's</span> <span data-start="1343.39" data-end="1345.309">actually very compact there's actually a</span> <span data-start="1345.309" data-end="1347.17">ton of code it's a couple of thousand</span> <span data-start="1347.17" data-end="1349.99">classes and those classes have a lot of</span> <span data-start="1349.99" data-end="1352.75">different implementation details my life</span> <span data-start="1352.75" data-end="1354.34">is too short to like write all of that</span> <span data-start="1354.34" data-end="1356.29">again in JavaScript 14 years later and</span> <span data-start="1356.29" data-end="1358.9">again I was it kind of felt bad karma to</span> <span data-start="1358.9" data-end="1360.4">redo all this work that was done 14</span> <span data-start="1360.4" data-end="1362.29">years ago so of course a much better</span> <span data-start="1362.29" data-end="1364.33">idea would be even though they cannot</span> <span data-start="1364.33" data-end="1369.43">use the same vm that um son did 14 years</span> <span data-start="1369.43" data-end="1371.44">ago we could at least use the same</span> <span data-start="1371.44" data-end="1373.69">libraries maybe and this is very good</span> <span data-start="1373.69" data-end="1377.05">lucky and I'll come back to in a second</span> <span data-start="1377.05" data-end="1380.14">the second piece that the second reason</span> <span data-start="1380.14" data-end="1382.87">it's a really bad idea to try to write a</span> </p>
<p><span data-start="1382.87" data-end="1386.29">Java library in javascript is that even</span> <span data-start="1386.29" data-end="1387.97">though the name is very similar and i'm</span> <span data-start="1387.97" data-end="1389.23">sure brandon has a couple more jobs on</span> <span data-start="1389.23" data-end="1392.29">this one to the name is very similar but</span> <span data-start="1392.29" data-end="1393.94">semantically this languages are very</span> <span data-start="1393.94" data-end="1397.69">very different so in Java for example if</span> <span data-start="1397.69" data-end="1400.809">you invoke a method and give it an</span> <span data-start="1400.809" data-end="1404.92">object that is null something very</span> <span data-start="1404.92" data-end="1407.38">specific happens in Java and you're</span> <span data-start="1407.38" data-end="1410.08">supposed to raise a Java exception so</span> <span data-start="1410.08" data-end="1412.39">what the vm has to do basically it's not</span> <span data-start="1412.39" data-end="1414.22">just throw an underlying javascript</span> <span data-start="1414.22" data-end="1416.17">exception but the vm has to throw a java</span> <span data-start="1416.17" data-end="1418.33">exception has to take a different path</span> <span data-start="1418.33" data-end="1420.79">running bytecode and it has to give the</span> <span data-start="1420.79" data-end="1423.19">program a chance to react properly to</span> <span data-start="1423.19" data-end="1427.179">that null exception and because Java is</span> <span data-start="1427.179" data-end="1428.79">so old and has gone through so many</span> <span data-start="1428.79" data-end="1431.89">rewrites and so many as much cool that's</span> <span data-start="1431.89" data-end="1434.92">written for it java applications tend to</span> <span data-start="1434.92" data-end="1437.23">often really rely on these very subtle</span> <span data-start="1437.23" data-end="1439.39">little details so when you're starting</span> <span data-start="1439.39" data-end="1442.059">what's up for example it does rely on</span> <span data-start="1442.059" data-end="1445">the proper handling of a null objective</span> <span data-start="1445" data-end="1448.21">reference if you start v-chat like this</span> <span data-start="1448.21" data-end="1450.85">it relies on an integer division by zero</span> <span data-start="1450.85" data-end="1452.679">being thrown as an exception and being</span> <span data-start="1452.679" data-end="1455.26">reported so it would be very difficult</span> <span data-start="1455.26" data-end="1458.53">to rewrite all this JavaScript code or</span> <span data-start="1458.53" data-end="1460.75">the Java code in JavaScript and make</span> <span data-start="1460.75" data-end="1463.27">sure that every single step you maintain</span> <span data-start="1463.27" data-end="1466.78">precisely the semantics of Java it would</span> <span data-start="1466.78" data-end="1468.49">be of course much better if you can</span> <span data-start="1468.49" data-end="1471.19">simply take the library code as Java and</span> <span data-start="1471.19" data-end="1473.41">then they simply run that in a vm then</span> <span data-start="1473.41" data-end="1474.62">you don't have to write the code</span> <span data-start="1474.62" data-end="1476.3">and we have guaranteed to write</span> <span data-start="1476.3" data-end="1480.59">semantics so as I said we got lucky here</span> <span data-start="1480.59" data-end="1484.85">because son open sourced the library</span> <span data-start="1484.85" data-end="1488.809">parts of Java just not the kvm itself so</span> <span data-start="1488.809" data-end="1490.97">we could simply download from Sons site</span> <span data-start="1490.97" data-end="1492.77">the entire source code of the library</span> <span data-start="1492.77" data-end="1494.98">that you need for these phones to work</span> <span data-start="1494.98" data-end="1496.97">that saved a ton of effort right there</span> <span data-start="1496.97" data-end="1500.809">that's great all right let's talk a bit</span> <span data-start="1500.809" data-end="1502.58">about the vm so now we have busy all the</span> <span data-start="1502.58" data-end="1504.83">basic pieces we have we can redraw files</span> <span data-start="1504.83" data-end="1508.64">you can look at class files we have the</span> <span data-start="1508.64" data-end="1511.19">library stuff as bytecode not only in a</span> <span data-start="1511.19" data-end="1515.48">vm that can actually run this code the</span> <span data-start="1515.48" data-end="1517.94">vm itself is really straightforward as i</span> <span data-start="1517.94" data-end="1520.76">said earlier java bytecode this is busy</span> <span data-start="1520.76" data-end="1522.77">a sequence of bytes these instructions</span> <span data-start="1522.77" data-end="1525.44">in their encoded there's a little bit</span> <span data-start="1525.44" data-end="1527.96">less than 255 instructions they're</span> <span data-start="1527.96" data-end="1530.03">numbered and there's a definition that</span> <span data-start="1530.03" data-end="1533.63">says if you see zero in your byte stream</span> <span data-start="1533.63" data-end="1535.85">that's a no op don't do anything let's</span> <span data-start="1535.85" data-end="1537.86">go to the next instruction if you see</span> <span data-start="1537.86" data-end="1541.25">one its and it pushes on now constant</span> <span data-start="1541.25" data-end="1544.22">onto the Java stack and so on so the</span> <span data-start="1544.22" data-end="1545.72">most trivial way of implementing this is</span> <span data-start="1545.72" data-end="1547.73">simply you go ahead and you've read a</span> <span data-start="1547.73" data-end="1550.7">little interpreter it grabs the current</span> <span data-start="1550.7" data-end="1553.1">frame and it pulls out the stack and</span> <span data-start="1553.1" data-end="1555.22">then it does operations on it you know</span> <span data-start="1555.22" data-end="1561.92">infinitely spinning wildly it's</span> <span data-start="1561.92" data-end="1564.2">interesting to look at two parts of this</span> <span data-start="1564.2" data-end="1568.67">loop or this instruction execution the</span> <span data-start="1568.67" data-end="1570.2">1i dough is showed briefly a couple</span> <span data-start="1570.2" data-end="1573.62">slides earlier in Java you have strict</span> <span data-start="1573.62" data-end="1575.36">typing so in Java actually have</span> <span data-start="1575.36" data-end="1577.16">different by code instructions for</span> <span data-start="1577.16" data-end="1579.47">adding two integers or adding two long</span> <span data-start="1579.47" data-end="1582.17">integers integers are defined as 32-bit</span> <span data-start="1582.17" data-end="1584.72">integers and lungs are defined 64-bit</span> <span data-start="1584.72" data-end="1587.6">integers so for integer addition what</span> <span data-start="1587.6" data-end="1589.07">you have to make sure is that when you</span> <span data-start="1589.07" data-end="1591.02">add two numbers they're always</span> <span data-start="1591.02" data-end="1593.8">guaranteed come out as an integer again</span> <span data-start="1593.8" data-end="1597.05">now we could make sure that the number</span> <span data-start="1597.05" data-end="1599.809">that goes in into stack pop on those two</span> <span data-start="1599.809" data-end="1601.73">there are always integers however if you</span> <span data-start="1601.73" data-end="1604.28">add two integers in JavaScript and its</span> <span data-start="1604.28" data-end="1606.92">larger than a 32-bit integer what you</span> <span data-start="1606.92" data-end="1609.38">get is a</span> <span data-start="1609.38" data-end="1611.76">right this is overflow to the doubles so</span> </p>
<p><span data-start="1611.76" data-end="1613.56">JavaScript doesn't have this weird case</span> <span data-start="1613.56" data-end="1617.19">of Java where if you go over the</span> <span data-start="1617.19" data-end="1619.02">definition range of an integer you can</span> <span data-start="1619.02" data-end="1620.37">you kind of come back out on the other</span> <span data-start="1620.37" data-end="1622.62">side of the world or like if you add one</span> <span data-start="1622.62" data-end="1625.59">to the largest 32-bit integer then you</span> <span data-start="1625.59" data-end="1628.71">get a negative number so that's really</span> <span data-start="1628.71" data-end="1631.37">nice for javascript but in case of a</span> <span data-start="1631.37" data-end="1634.41">Java VM we have to actually emulate the</span> <span data-start="1634.41" data-end="1636.42">way java reacts here otherwise if some</span> <span data-start="1636.42" data-end="1637.83">program relies on this it wouldn't work</span> <span data-start="1637.83" data-end="1639.87">anymore use the same trick here if you</span> <span data-start="1639.87" data-end="1642.75">or a number of a 0 you force it to be</span> <span data-start="1642.75" data-end="1644.58">converted to an integer number and that</span> <span data-start="1644.58" data-end="1645.96">way we can implement the integer</span> <span data-start="1645.96" data-end="1648.15">semantics of JavaScript the second one</span> <span data-start="1648.15" data-end="1650.67">is a long addition down there and that's</span> <span data-start="1650.67" data-end="1652.95">actually bit harder because javascript</span> <span data-start="1652.95" data-end="1656.07">cannot directly calculate 64-bit numbers</span> <span data-start="1656.07" data-end="1658.53">you have only doubles and a part of the</span> <span data-start="1658.53" data-end="1661.05">doubles is reserved for essentially</span> <span data-start="1661.05" data-end="1663.59">telling the system where the period goes</span> <span data-start="1663.59" data-end="1666.93">so as a result of that we are using</span> <span data-start="1666.93" data-end="1671.28">geelong ojs which is the 64-bit math</span> <span data-start="1671.28" data-end="1673.05">library that ships with a closure</span> <span data-start="1673.05" data-end="1675.93">compiler so all longs that are generated</span> <span data-start="1675.93" data-end="1677.43">on the stack evasive wrapped into those</span> <span data-start="1677.43" data-end="1679.11">objects that allow you to do 64-bit</span> <span data-start="1679.11" data-end="1682.11">computation fortunately on these feature</span> <span data-start="1682.11" data-end="1685.14">phones 64-bit math is very rare so it's</span> <span data-start="1685.14" data-end="1686.97">important to support it but it's not</span> <span data-start="1686.97" data-end="1690.51">really a performance problem a more</span> <span data-start="1690.51" data-end="1692.7">interesting instructions get filled and</span> <span data-start="1692.7" data-end="1694.32">for those of you who don't like reading</span> <span data-start="1694.32" data-end="1695.88">code I promise there's only two or three</span> <span data-start="1695.88" data-end="1697.59">slides left before we go back to memes</span> <span data-start="1697.59" data-end="1700.65">and things to laugh about I wanted to</span> <span data-start="1700.65" data-end="1702.09">show a couple of more examples of stuff</span> <span data-start="1702.09" data-end="1703.05">that's was really interesting to</span> <span data-start="1703.05" data-end="1705.12">implement and as I said I've written</span> <span data-start="1705.12" data-end="1707.87">several Java the ends at this point and</span> <span data-start="1707.87" data-end="1709.83">implementing some of the more complex</span> <span data-start="1709.83" data-end="1713.22">features of Java this time around in</span> </p>
<p><span data-start="1713.22" data-end="1715.11">JavaScript turned out to be very very</span> <span data-start="1715.11" data-end="1716.82">different from any other implementation</span> <span data-start="1716.82" data-end="1718.71">that I've done a good example for this</span> <span data-start="1718.71" data-end="1721.44">get feel what get filled does it gets</span> <span data-start="1721.44" data-end="1724.49">the value of a field of a Java object</span> <span data-start="1724.49" data-end="1726.9">basically what it does is it resolves</span> <span data-start="1726.9" data-end="1730.14">the field into a slot into the object</span> <span data-start="1730.14" data-end="1732.6">and then tries to read from that slot</span> <span data-start="1732.6" data-end="1736.62">and the object the Java specification</span> <span data-start="1736.62" data-end="1738.559">defines certain air</span> <span data-start="1738.559" data-end="1740.33">conditions that can happen one example</span> <span data-start="1740.33" data-end="1744.1">is if you give get filled and null</span> <span data-start="1744.1" data-end="1747.11">object then it is supposed to throw an</span> <span data-start="1747.11" data-end="1749.84">exception so as the interpreters running</span> <span data-start="1749.84" data-end="1752.779">if object happens to be null then this</span> <span data-start="1752.779" data-end="1754.46">race exceptional yield is going to be</span> <span data-start="1754.46" data-end="1756.529">invoked so let's look at that for a</span> <span data-start="1756.529" data-end="1759.049">second because that's so interesting the</span> <span data-start="1759.049" data-end="1761.6">way we did that so what raise exception</span> <span data-start="1761.6" data-end="1763.639">and yield does is essentially it raises</span> <span data-start="1763.639" data-end="1765.169">an exception another show in a second</span> <span data-start="1765.169" data-end="1767.299">what it does and after that it does a</span> <span data-start="1767.299" data-end="1771.11">yield by throwing and Java Script</span> <span data-start="1771.11" data-end="1773.629">exception so again we are trying to</span> <span data-start="1773.629" data-end="1777.35">throw a Java exception by doing some</span> <span data-start="1777.35" data-end="1779.179">code and then throwing a JavaScript</span> <span data-start="1779.179" data-end="1781.429">exception if you can still follow me at</span> <span data-start="1781.429" data-end="1784.399">this point your you re brave the reason</span> <span data-start="1784.399" data-end="1786.83">we are doing this is that Java is fully</span> <span data-start="1786.83" data-end="1789.71">synchronous language this is very</span> <span data-start="1789.71" data-end="1791.33">different from JavaScript we're really</span> <span data-start="1791.33" data-end="1793.159">one of the prime directives of</span> <span data-start="1793.159" data-end="1795.35">javascript is try to run as little code</span> <span data-start="1795.35" data-end="1797.539">as possible in your event loop and don't</span> <span data-start="1797.539" data-end="1799.669">hog the event loop run small snippets of</span> <span data-start="1799.669" data-end="1802.129">code in a lot of system to run events as</span> <span data-start="1802.129" data-end="1806.45">well the way we implement this this</span> <span data-start="1806.45" data-end="1808.97">discrepancy is that we have an outer</span> <span data-start="1808.97" data-end="1810.98">loop that you can see here in context</span> <span data-start="1810.98" data-end="1813.11">prototype execute and it's basically a</span> <span data-start="1813.11" data-end="1815.84">loop where if the code that you run in</span> <span data-start="1815.84" data-end="1818.389">vm execute throws this specific</span> <span data-start="1818.389" data-end="1821.809">exception of vm pause or vm yield where</span> <span data-start="1821.809" data-end="1823.879">this code does ability jumps up and goes</span> <span data-start="1823.879" data-end="1825.86">back to the event handler returns to the</span> <span data-start="1825.86" data-end="1827.21">event loop and then next time we come</span> <span data-start="1827.21" data-end="1829.85">around we've a run code again so this is</span> <span data-start="1829.85" data-end="1832.22">essentially how we implement the ability</span> <span data-start="1832.22" data-end="1835.1">to take a job of thread and at any time</span> <span data-start="1835.1" data-end="1836.749">we can d schedule it so the system can</span> <span data-start="1836.749" data-end="1839.419">do something else and of course this is</span> <span data-start="1839.419" data-end="1841.49">also how to implement multitasking Java</span> <span data-start="1841.49" data-end="1843.83">a multi-threaded system all you have to</span> <span data-start="1843.83" data-end="1845.6">do is basically several of these things</span> <span data-start="1845.6" data-end="1846.889">post it and then you essentially have</span> <span data-start="1846.889" data-end="1848.33">several threats that are running at the</span> <span data-start="1848.33" data-end="1853.13">same time all right</span> </p>
<p><span data-start="1853.13" data-end="1854.63">I promise that you will look at raise</span> <span data-start="1854.63" data-end="1856.37">exception and don't very most of this is</span> <span data-start="1856.37" data-end="1858.8">not interesting the only piece of really</span> <span data-start="1858.8" data-end="1860.51">interesting is the very bottom of this</span> <span data-start="1860.51" data-end="1862.76">if you look at the integer array the you</span> <span data-start="1862.76" data-end="1864.26">and eight array that we are generating</span> <span data-start="1864.26" data-end="1866.48">there what you're actually seeing there</span> <span data-start="1866.48" data-end="1869.18">is that your hand assembling some byte</span> <span data-start="1869.18" data-end="1872.33">code inside that method so when we are</span> <span data-start="1872.33" data-end="1875.03">trying to raise an exception it actually</span> <span data-start="1875.03" data-end="1877.43">turns out we cannot directly raise the</span> <span data-start="1877.43" data-end="1879.62">exception instead they're generating a</span> <span data-start="1879.62" data-end="1882.17">fake java method that we put onto our</span> <span data-start="1882.17" data-end="1884.66">java stack that we implementing in</span> <span data-start="1884.66" data-end="1887.9">javascript the reason you have to do</span> <span data-start="1887.9" data-end="1889.97">that is that there are several steps</span> <span data-start="1889.97" data-end="1893.3">necessary to throw an exception and each</span> <span data-start="1893.3" data-end="1897.56">of these steps can fail individually the</span> <span data-start="1897.56" data-end="1899.54">only way I can handle that for example</span> <span data-start="1899.54" data-end="1901.54">the only way I can properly handle</span> <span data-start="1901.54" data-end="1904.52">throwing an exception while throwing an</span> <span data-start="1904.52" data-end="1907.91">exception is if I have a second method</span> <span data-start="1907.91" data-end="1910.28">in between there so what for example can</span> <span data-start="1910.28" data-end="1912.02">happen is let's say you're trying to</span> <span data-start="1912.02" data-end="1914.42">throw a specific exception with a name</span> <span data-start="1914.42" data-end="1918.02">acts and that name doesn't exist then in</span> <span data-start="1918.02" data-end="1919.34">that case the vm would throw an</span> <span data-start="1919.34" data-end="1921.89">exception telling you that a class could</span> <span data-start="1921.89" data-end="1924.44">not be found and when you're throwing</span> <span data-start="1924.44" data-end="1925.85">that exception you might want out of</span> <span data-start="1925.85" data-end="1927.5">memory which case the vm is going to</span> <span data-start="1927.5" data-end="1929.78">throw a lot of memory exception so you</span> <span data-start="1929.78" data-end="1931.43">have to have this cascading the assault</span> <span data-start="1931.43" data-end="1933.23">in essence this thing this is synthetic</span> <span data-start="1933.23" data-end="1935.27">methods that we are throwing in between</span> <span data-start="1935.27" data-end="1937.75">the stack this is very neat because on</span> <span data-start="1937.75" data-end="1940.01">the simple structure of JavaScript</span> <span data-start="1940.01" data-end="1941.32">allows us to do is very efficiently</span> <span data-start="1941.32" data-end="1943.7">because we're using this UN day to race</span> <span data-start="1943.7" data-end="1946.24">to actually store the stack frames I</span> <span data-start="1946.24" data-end="1948.53">mentioned a couple minutes ago the</span> <span data-start="1948.53" data-end="1951.35">concept of natives natives are in Java a</span> <span data-start="1951.35" data-end="1954.14">way to call to the operating system or</span> <span data-start="1954.14" data-end="1956.6">the underlying code in JavaScript of</span> <span data-start="1956.6" data-end="1958.22">course there's no notion of that we</span> <span data-start="1958.22" data-end="1961.55">simply call the Dom or or into functions</span> <span data-start="1961.55" data-end="1962.93">that implement it in a JavaScript</span> <span data-start="1962.93" data-end="1966.41">library so freely for this VM native</span> <span data-start="1966.41" data-end="1968.72">methods are essentially implementations</span> <span data-start="1968.72" data-end="1973.28">of code in JavaScript in throw cc or C++</span> <span data-start="1973.28" data-end="1976.49">of course it is a very simple Vater</span> <span data-start="1976.49" data-end="1979.01">implementers what we essentially do is</span> <span data-start="1979.01" data-end="1980.93">when you're calling a method you supply</span> <span data-start="1980.93" data-end="1983.36">the name in the bytecode and we have a</span> <span data-start="1983.36" data-end="1985.25">little override list where we look into</span> <span data-start="1985.25" data-end="1986.97">do we have a native</span> <span data-start="1986.97" data-end="1989.429">his name and if the is so they execute</span> <span data-start="1989.429" data-end="1992.07">that JavaScript code instead of trying</span> <span data-start="1992.07" data-end="1994.38">to call a java method in interpreter you</span> <span data-start="1994.38" data-end="1995.88">can see a couple of moment a shins here</span> <span data-start="1995.88" data-end="1997.799">we essentially just calls on native</span> </p>
<p><span data-start="1997.799" data-end="2000.049">JavaScript written code that implements</span> <span data-start="2000.049" data-end="2004.85">those Java functions all right almost</span> <span data-start="2004.85" data-end="2011.049">done one thing we did not expect is that</span> <span data-start="2011.049" data-end="2014.27">just how slow this would be so and if</span> <span data-start="2014.27" data-end="2015.919">you get under this this point we're</span> <span data-start="2015.919" data-end="2017.87">about 100 times slower than the</span> <span data-start="2017.87" data-end="2020.78">application running on the future phone</span> <span data-start="2020.78" data-end="2025.159">and that was really unexpected because</span> <span data-start="2025.159" data-end="2027.65">most of time if you look at Java it</span> <span data-start="2027.65" data-end="2029.99">really runs a lot of the complex</span> <span data-start="2029.99" data-end="2032.929">operations in native code the reason for</span> <span data-start="2032.929" data-end="2035.03">this is that back when was Java was</span> <span data-start="2035.03" data-end="2038.6">first written there were no comparison</span> <span data-start="2038.6" data-end="2040.94">for java it's a lot of the lot of the</span> <span data-start="2040.94" data-end="2042.47">drama programs could not do a lot of</span> <span data-start="2042.47" data-end="2045.38">heavy computation in Java itself so the</span> </p>
<p><span data-start="2045.38" data-end="2047.15">Java language started to provide a lot</span> <span data-start="2047.15" data-end="2051.2">of native see implementations of very</span> <span data-start="2051.2" data-end="2053.149">complex functionality to compensate for</span> <span data-start="2053.149" data-end="2055.639">the fact that Java was so slow so we</span> <span data-start="2055.639" data-end="2057.169">really expected that even if you have a</span> <span data-start="2057.169" data-end="2060.349">slow vm for java you should be a little</span> <span data-start="2060.349" data-end="2064.609">closer to usable than 100 x away it</span> <span data-start="2064.609" data-end="2066.139">turns out that the main reason for this</span> <span data-start="2066.139" data-end="2068.78">being this slow is that there's some</span> <span data-start="2068.78" data-end="2070.76">very frequently called things in any</span> <span data-start="2070.76" data-end="2073.159">programming language let's say comparing</span> <span data-start="2073.159" data-end="2075.2">two strings this is called in java</span> <span data-start="2075.2" data-end="2079.46">equals in java all these things are</span> <span data-start="2079.46" data-end="2082.639">implemented in Java itself so if you're</span> <span data-start="2082.639" data-end="2084.74">comparing two strings you have to call</span> <span data-start="2084.74" data-end="2086.389">this function here and don't worry I</span> <span data-start="2086.389" data-end="2087.859">will not try to read through this what</span> <span data-start="2087.859" data-end="2089.629">this does all you have to remember is</span> <span data-start="2089.629" data-end="2091.849">that there's like 80 bytes or so of</span> <span data-start="2091.849" data-end="2093.619">instructions in here and I highlighted</span> <span data-start="2093.619" data-end="2096.29">is read a loop that's inside of this so</span> <span data-start="2096.29" data-end="2098.119">what this code does it has a whole bunch</span> <span data-start="2098.119" data-end="2099.89">of checking with its video string and</span> <span data-start="2099.89" data-end="2103.25">then it goes to that loop and it for</span> <span data-start="2103.25" data-end="2104.9">every single character it individually</span> <span data-start="2104.9" data-end="2106.79">compares whether it matches the other</span> <span data-start="2106.79" data-end="2109.16">string or not and then returns true or</span> <span data-start="2109.16" data-end="2111.65">false and of course each of these steps</span> <span data-start="2111.65" data-end="2114.98">in this program or Java VM written</span> </p>
<p><span data-start="2114.98" data-end="2118.55">JavaScript has to interpret so comparing</span> <span data-start="2118.55" data-end="2120.65">two strings in this Java</span> <span data-start="2120.65" data-end="2123.559">em with this role is horribly slow we</span> <span data-start="2123.559" data-end="2126.41">did a low profile using using the dev</span> <span data-start="2126.41" data-end="2127.91">tools and you could you need to see that</span> <span data-start="2127.91" data-end="2130.01">most of the time was spent in five or</span> <span data-start="2130.01" data-end="2133.97">six functions like this so a very easy</span> <span data-start="2133.97" data-end="2135.98">way to fix that of course is to use the</span> <span data-start="2135.98" data-end="2137.869">same mechanism we just solve as native</span> <span data-start="2137.869" data-end="2139.88">methods a native method again is</span> <span data-start="2139.88" data-end="2141.68">something that we implemented JavaScript</span> <span data-start="2141.68" data-end="2144.14">instead of in Java so they can simply</span> <span data-start="2144.14" data-end="2146.63">take shortcuts so I have a little native</span> <span data-start="2146.63" data-end="2149.15">method that overrides the pure Java</span> <span data-start="2149.15" data-end="2151.22">implementation and it goes ahead and</span> <span data-start="2151.22" data-end="2152.779">simply check that it's a string and if</span> <span data-start="2152.779" data-end="2154.849">so it has a string compare at a</span> </p>
<p><span data-start="2154.849" data-end="2156.619">JavaScript level that's of course</span> <span data-start="2156.619" data-end="2158.96">massively faster because the JavaScript</span> <span data-start="2158.96" data-end="2161.119">vm in the browser knows how is that very</span> <span data-start="2161.119" data-end="2162.47">efficiently you don't have to be like</span> <span data-start="2162.47" data-end="2164.359">circle that interpreter loop all the</span> <span data-start="2164.359" data-end="2167.63">time so after the dis work of course we</span> <span data-start="2167.63" data-end="2170.289">expected things to get a lot better and</span> <span data-start="2170.289" data-end="2173.63">it did get a lot better it got like ten</span> <span data-start="2173.63" data-end="2176.66">times faster or so but it was still kind</span> <span data-start="2176.66" data-end="2179.599">of painfully slow to use and the reason</span> <span data-start="2179.599" data-end="2181.64">for that probably is that actually Java</span> <span data-start="2181.64" data-end="2183.47">has advanced fight a bit since it's</span> <span data-start="2183.47" data-end="2186.079">early days and today most of time when</span> <span data-start="2186.079" data-end="2188.029">you run Java programs you actually also</span> <span data-start="2188.029" data-end="2191.66">compile them over to an x86 or arm</span> <span data-start="2191.66" data-end="2194.299">machine code so even on this simple</span> <span data-start="2194.299" data-end="2196.309">feature phones this lecture compiler</span> <span data-start="2196.309" data-end="2198.109">built in that takes the bytecode and</span> <span data-start="2198.109" data-end="2199.369">then instead of just running an</span> <span data-start="2199.369" data-end="2201.26">interpreter it generates machine code</span> <span data-start="2201.26" data-end="2202.819">from the by code and then runs that</span> <span data-start="2202.819" data-end="2204.74">machine code and since we still had an</span> <span data-start="2204.74" data-end="2207.079">interpreter we were slower than the</span> <span data-start="2207.079" data-end="2209.299">teacher phone systems to the point where</span> <span data-start="2209.299" data-end="2214.309">the app was not really usable so the the</span> <span data-start="2214.309" data-end="2215.779">next step of course is how to compile</span> </p>
<p><span data-start="2215.779" data-end="2220.849">Java in JavaScript and this seemed like</span> <span data-start="2220.849" data-end="2222.859">a really daunting task for anyone was</span> <span data-start="2222.859" data-end="2225.02">written compilers so for those of you at</span> <span data-start="2225.02" data-end="2227.96">the the the curse or privilege whichever</span> <span data-start="2227.96" data-end="2229.52">way you want to see it to have written a</span> <span data-start="2229.52" data-end="2232.16">compiler generating code in a compiler</span> <span data-start="2232.16" data-end="2234.5">it's like the most painful part of</span> <span data-start="2234.5" data-end="2236.39">compilers because machine code is so</span> <span data-start="2236.39" data-end="2239.359">hard to read and very hard to target and</span> <span data-start="2239.359" data-end="2241.49">it's also the most exciting thing to</span> <span data-start="2241.49" data-end="2243.71">debug like this does you have not debug</span> <span data-start="2243.71" data-end="2245.329">in your life until you have trying to</span> <span data-start="2245.329" data-end="2246.89">debug some machine code that goes wrong</span> <span data-start="2246.89" data-end="2248.99">on you you try to understand what the</span> <span data-start="2248.99" data-end="2250.91">hell happens there in some like binary</span> <span data-start="2250.91" data-end="2252.71">machine code you're looking at</span> <span data-start="2252.71" data-end="2254.63">so they go to this point just seemed</span> <span data-start="2254.63" data-end="2256.25">pretty scary quite honestly because</span> <span data-start="2256.25" data-end="2259.49">every time I had done it before it was a</span> <span data-start="2259.49" data-end="2262.96">really daunting task to deal with</span> <span data-start="2262.96" data-end="2267.05">fortunately this is JavaScript right and</span> <span data-start="2267.05" data-end="2269.3">it is it is not machine language it's</span> <span data-start="2269.3" data-end="2271.88">not x86 and it's not armed and it's a</span> <span data-start="2271.88" data-end="2273.32">lot easier to do this in JavaScript and</span> <span data-start="2273.32" data-end="2275.869">this was almost unexpected for us if you</span> <span data-start="2275.869" data-end="2278.089">look at the compiler that is in j2me</span> </p>
<p><span data-start="2278.089" data-end="2281.27">DOJ's that is probably the smallest java</span> <span data-start="2281.27" data-end="2284.54">compiler i've ever seen if you think</span> <span data-start="2284.54" data-end="2286.58">about it for a moment what it does it</span> <span data-start="2286.58" data-end="2288.14">takes a Java code and of course emits</span> <span data-start="2288.14" data-end="2290.81">javascript code from it it all the</span> <span data-start="2290.81" data-end="2291.859">sudden of course makes a lot of sense</span> <span data-start="2291.859" data-end="2293.69">that it's a very small compiler because</span> <span data-start="2293.69" data-end="2295.7">what you're doing is almost like an</span> <span data-start="2295.7" data-end="2297.77">inversion javascript is actually a much</span> <span data-start="2297.77" data-end="2299.72">more semantically rich language than</span> <span data-start="2299.72" data-end="2301.339">Java and there's much more powerful</span> <span data-start="2301.339" data-end="2303.14">primitives what we're doing is you're</span> <span data-start="2303.14" data-end="2305.75">busy taking Java and we are lowering it</span> <span data-start="2305.75" data-end="2309.74">to this much higher representation this</span> <span data-start="2309.74" data-end="2312.23">is very easy because many things where</span> <span data-start="2312.23" data-end="2315.82">you have to painfully assemble in on</span> <span data-start="2315.82" data-end="2318.349">machine code instructions for Java are</span> <span data-start="2318.349" data-end="2321.74">very very trivial to do in javascript we</span> <span data-start="2321.74" data-end="2322.97">also harnessed a couple of other tricks</span> <span data-start="2322.97" data-end="2325.03">to make this process particularly easy</span> <span data-start="2325.03" data-end="2328.13">when you're trying to compile Java over</span> <span data-start="2328.13" data-end="2331.43">to JavaScript we try to use edge as much</span> <span data-start="2331.43" data-end="2335.24">of the JavaScript semantics itself so</span> <span data-start="2335.24" data-end="2337.52">for example Java objects are represented</span> <span data-start="2337.52" data-end="2340.58">through one JavaScript object they're</span> <span data-start="2340.58" data-end="2341.869">not trying to implement our own garbage</span> <span data-start="2341.869" data-end="2343.67">collector we are not trying to implement</span> <span data-start="2343.67" data-end="2347.27">many other pieces of the Java VM but</span> <span data-start="2347.27" data-end="2348.77">traditionally you have to implement in</span> <span data-start="2348.77" data-end="2350.99">some native language so by making our</span> </p>
<p><span data-start="2350.99" data-end="2352.58">Java implementation match very very</span> <span data-start="2352.58" data-end="2354.47">closely what the JavaScript language</span> <span data-start="2354.47" data-end="2356.42">does the actual compilation approach</span> <span data-start="2356.42" data-end="2359.96">itself becomes really trivial so this</span> <span data-start="2359.96" data-end="2361.04">what compilation looks like and this</span> <span data-start="2361.04" data-end="2363.23">will look eerie familiar to you if you</span> <span data-start="2363.23" data-end="2365.78">remember the execute loop it essentially</span> <span data-start="2365.78" data-end="2367.82">does the same thing that the execute</span> <span data-start="2367.82" data-end="2369.29">function did there's a compile function</span> <span data-start="2369.29" data-end="2371.75">you go over the bike code in sequence</span> <span data-start="2371.75" data-end="2374.27">and for every byte code operation you</span> <span data-start="2374.27" data-end="2376.52">simply omit some code and code in this</span> <span data-start="2376.52" data-end="2378.53">case is simply a string if we define up</span> <span data-start="2378.53" data-end="2380.39">there and we concatenate into that</span> <span data-start="2380.39" data-end="2383.27">string operations in JavaScript that</span> <span data-start="2383.27" data-end="2385.25">basically emulate the stack nature of</span> </p>
<p><span data-start="2385.25" data-end="2386.39">Java</span> <span data-start="2386.39" data-end="2388.609">execute operations that Java is</span> <span data-start="2388.609" data-end="2391.039">executing this turned out to be really a</span> <span data-start="2391.039" data-end="2394.76">very easy way to compile code this part</span> <span data-start="2394.76" data-end="2396.71">was really easy but was a lot less easy</span> <span data-start="2396.71" data-end="2400.76">is actually trying to run that code we</span> <span data-start="2400.76" data-end="2402.71">are running the stuff in an environment</span> <span data-start="2402.71" data-end="2404.69">where content security policies are</span> <span data-start="2404.69" data-end="2406.94">enforced and if you don't know what it</span> <span data-start="2406.94" data-end="2408.529">is I recommend you go and read right</span> <span data-start="2408.529" data-end="2409.549">after this talk because it's very</span> <span data-start="2409.549" data-end="2413.059">important that you know what it is photo</span> <span data-start="2413.059" data-end="2415.13">so you don't know yet CSP survey how you</span> <span data-start="2415.13" data-end="2419.119">can restrict web applications from doing</span> <span data-start="2419.119" data-end="2421.97">dangerous things NFL is one of those</span> <span data-start="2421.97" data-end="2423.44">things that pretty dangerous because if</span> <span data-start="2423.44" data-end="2425.75">you have stuff coming in from the user</span> <span data-start="2425.75" data-end="2428.299">and it somehow gets into Avelle that's</span> <span data-start="2428.299" data-end="2430.099">usually where things go wrong and some</span> <span data-start="2430.099" data-end="2432.2">someone is going to take over your code</span> <span data-start="2432.2" data-end="2434.329">and inject some code so we are in an</span> <span data-start="2434.329" data-end="2435.619">environment where we can actually not</span> <span data-start="2435.619" data-end="2438.17">use a vowel so we can compile it a Java</span> <span data-start="2438.17" data-end="2440.359">program just find a JavaScript but then</span> <span data-start="2440.359" data-end="2442.339">we cannot actually a valid because the</span> <span data-start="2442.339" data-end="2445.72">eval function itself is disallowed I</span> <span data-start="2445.72" data-end="2447.859">unfortunately don't have time to go all</span> <span data-start="2447.859" data-end="2449.93">the evil details but it takes to bypass</span> <span data-start="2449.93" data-end="2451.099">that but essentially what we are doing</span> <span data-start="2451.099" data-end="2454.49">is we are firing up a new iframe and you</span> <span data-start="2454.49" data-end="2456.17">load the code in that you I frame and</span> <span data-start="2456.17" data-end="2458.45">that iframe kind of post messages us</span> <span data-start="2458.45" data-end="2461.75">back and forth um as we execute code and</span> <span data-start="2461.75" data-end="2465.14">it actually even works so um this was in</span> <span data-start="2465.14" data-end="2466.94">surprising to me one of the other</span> <span data-start="2466.94" data-end="2469.099">authors Nick on this project came up</span> <span data-start="2469.099" data-end="2470.93">with this idea and it's pretty insane if</span> <span data-start="2470.93" data-end="2472.49">you really would like to see some fun</span> <span data-start="2472.49" data-end="2474.049">code or recommend you take a look at</span> <span data-start="2474.049" data-end="2478.369">that all right now we had a demo part of</span> <span data-start="2478.369" data-end="2481.16">this it seems that the convention is</span> <span data-start="2481.16" data-end="2482.99">when missoula comes to demo or at least</span> <span data-start="2482.99" data-end="2484.849">when a muscle as CTO comes to demo</span> <span data-start="2484.849" data-end="2487.519">something at a jsf conference you have</span> <span data-start="2487.519" data-end="2489.97">to show some sort of live demo and</span> </p>
<p><span data-start="2489.97" data-end="2491.93">Brandon already set the precedent that</span> <span data-start="2491.93" data-end="2493.839">it usually is a game that you're playing</span> <span data-start="2493.839" data-end="2497.059">there is no quake for j2me as far as i</span> <span data-start="2497.059" data-end="2499.849">know so i picked the second closest</span> <span data-start="2499.849" data-end="2502.369">thing I could find and this is a live</span> <span data-start="2502.369" data-end="2503.99">demo so if it doesn't work I'm very</span> <span data-start="2503.99" data-end="2510.799">sorry let's see where my bookmarks there</span> <span data-start="2510.799" data-end="2515.869">we go so this is the asteroids java game</span> <span data-start="2515.869" data-end="2518">that is common on these on these phones</span> <span data-start="2518" data-end="2520.33">and great there's a loose</span> <span data-start="2520.33" data-end="2523.6">is screwing here I cannot get to my</span> <span data-start="2523.6" data-end="2529.45">storage button see that's great slive</span> <span data-start="2529.45" data-end="2531.45">debugging here all right now it works</span> <span data-start="2531.45" data-end="2533.83">all right so I can go to menu here so</span> <span data-start="2533.83" data-end="2535.15">this is all the java stuff it's running</span> <span data-start="2535.15" data-end="2536.59">this is the interpreter loop running</span> <span data-start="2536.59" data-end="2538.9">here running this asteroid game this is</span> <span data-start="2538.9" data-end="2541.59">a jar file is that you an open source</span> <span data-start="2541.59" data-end="2544.81">j2me game you can find on the web GPL</span> <span data-start="2544.81" data-end="2546.73">it's really great if you have to get</span> <span data-start="2546.73" data-end="2548.62">back a vm if you have a program you have</span> <span data-start="2548.62" data-end="2550.9">the source code for find try to debug</span> <span data-start="2550.9" data-end="2552.1">with something that you only have to buy</span> <span data-start="2552.1" data-end="2555.28">quote for its really painful so here</span> <span data-start="2555.28" data-end="2556.96">this is this a touch events from the</span> <span data-start="2556.96" data-end="2560.56">browser that are sent over to the Java</span> </p>
<p><span data-start="2560.56" data-end="2562.72">VM and I can go ahead here and start</span> <span data-start="2562.72" data-end="2564.46">this everything you see here like this</span> <span data-start="2564.46" data-end="2566.95">this very ugly yellow you I this is all</span> <span data-start="2566.95" data-end="2569.02">rendered in Java unlike 14 year old Java</span> <span data-start="2569.02" data-end="2571.45">code that runs on these phones and I can</span> <span data-start="2571.45" data-end="2577.81">start this and then I'm live demo I can</span> <span data-start="2577.81" data-end="2579.7">I move my ship so this is unfortunate um</span> <span data-start="2579.7" data-end="2581.74">let's see if you if you can do this</span> <span data-start="2581.74" data-end="2586.06">we'll start this again no I cannot all</span> <span data-start="2586.06" data-end="2587.29">right I cannot tell you why I cannot</span> <span data-start="2587.29" data-end="2588.7">move my ship right now it worked in a</span> <span data-start="2588.7" data-end="2590.98">room there you can believe me or not but</span> <span data-start="2590.98" data-end="2592.75">in theory I would we give you like live</span> <span data-start="2592.75" data-end="2594.37">demo right now next time I'm definitely</span> <span data-start="2594.37" data-end="2597.04">record this not show this life alright</span> <span data-start="2597.04" data-end="2603.46">let's go back to our slides all right</span> <span data-start="2603.46" data-end="2605.65">before I don't have time first of all</span> <span data-start="2605.65" data-end="2607.03">thank you very much for listening to me</span> <span data-start="2607.03" data-end="2609.79">going on about Java and JavaScript and</span> </p>
<p><span data-start="2609.79" data-end="2611.95">VMS Whitney JavaScript I would like to</span> <span data-start="2611.95" data-end="2614.02">acknowledge a couple people that have</span> <span data-start="2614.02" data-end="2616.66">worked on this project as many of the</span> <span data-start="2616.66" data-end="2618.97">other projects that are started in the</span> <span data-start="2618.97" data-end="2621.22">past it's usually me who gets to do the</span> <span data-start="2621.22" data-end="2623.44">first fun couple of weeks and a bunch of</span> <span data-start="2623.44" data-end="2624.7">people have to come in who have to like</span> <span data-start="2624.7" data-end="2626.2">do months of hard work to actually make</span> <span data-start="2626.2" data-end="2628.3">it work so there's a whole bunch of</span> <span data-start="2628.3" data-end="2629.95">people for missoula and also outside</span> <span data-start="2629.95" data-end="2631.9">contributors to help the j2me get it to</span> <span data-start="2631.9" data-end="2633.79">the point where it can run java</span> <span data-start="2633.79" data-end="2636.22">applications and i recommend you look up</span> <span data-start="2636.22" data-end="2637.27">their names since you're interested in</span> <span data-start="2637.27" data-end="2638.71">the code for this it's all up on github</span> <span data-start="2638.71" data-end="2642.58">and check it out and run some j2me stuff</span> </p>
</section>