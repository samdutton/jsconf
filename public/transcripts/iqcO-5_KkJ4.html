<section>
<p><span data-start="10.3" data-end="12.3">Hello everyone and</span> <span data-start="12.54" data-end="20.1">Thanks the organization for giving me the chance to give this talk here, in the last CSSconf edition in this type or whatever</span> <span data-start="20.74" data-end="25.02">So it's really a pleasure and an honor to be here in this great conference</span> <span data-start="25.689" data-end="30.599">So the title of my talk is "Improving Website Performance with CSS Containment"</span> <span data-start="31.15" data-end="36.419">So quite a long title even doesn't fit on the slide, so I will go over it slowly</span> <span data-start="37.66" data-end="41.729">So first, let's explain a little bit about me. I'm Manuel Rego</span> </p>
<p><span data-start="41.73" data-end="45.959">I'm part of Igalia Web Pplatform team. Igalia is an open source consultancy that</span> <span data-start="46.539" data-end="47.77">has a</span> <span data-start="47.77" data-end="51.659">Cooperative like structure, so we have people all around the globe</span> <span data-start="52.3" data-end="55.11">despite the headquarter are in Spain and</span> <span data-start="56.05" data-end="61.469">we have a large team working on browsers and we having implementing in several CSS</span> <span data-start="61.719" data-end="64.198">specifications and other things on browsers</span> </p>
<p><span data-start="64.199" data-end="68.069">I have been working on Grid Layout mostly for several years</span> <span data-start="68.42" data-end="73.42">And also other specs in Blink and WebKit and now I'm working also in the CSS Containment</span> <span data-start="76.08" data-end="81.02">And as part of all these work I having interacting more and more with the CSS Working Group people</span> <span data-start="81.02" data-end="84.62">Putting issues participating in discussions and finally joined the group like two years ago</span> </p>
<p><span data-start="86.56" data-end="88">So</span> <span data-start="88" data-end="93.029">Yeah the spec I mean the talk is about CSS Containment. This is a CSS spec</span> <span data-start="93.85" data-end="101.46">this spec has a property that is called "contain" and it has four values "layout", "paint",  "size" and "style" and that's all</span> <span data-start="101.65" data-end="102.57">We are almost done</span> </p>
<p><span data-start="102.57" data-end="106.11">I mean, it's very simple in theory</span> <span data-start="106.11" data-end="108.149">But I think is going to be tricky to explain</span> <span data-start="108.64" data-end="113.699">Maybe you watched some of my talks about Grid Layout or read some of my blog post about it.</span> <span data-start="114.7" data-end="115.96">I mean</span> <span data-start="115.96" data-end="120.54">Grid has tons of properties, many different values for each of them and all that</span> <span data-start="121.869" data-end="125.639">But I believe it's easier to understand that maybe CSS Containment</span> </p>
<p><span data-start="125.64" data-end="129.72">So let's see if I manage to do it properly and you don't get very bored</span> <span data-start="131.2" data-end="135.33">So the other part of the title was improving website performance</span> <span data-start="136" data-end="140.459">So basically you can improve the performance of a website in many different parts</span> <span data-start="140.459" data-end="147.238">You can improve how images are loaded or the resources or whatever. In this case is more about the rendering pipeline</span> <span data-start="147.239" data-end="152.548">These are somehow the main phases from a very nice article by Lin Clark</span> <span data-start="153.099" data-end="157.289">So you have like where you compute the style you do the layout where you are</span> <span data-start="157.51" data-end="160.709">Positioning the things then you paint and then you composite the layers</span> <span data-start="161.68" data-end="167.879">And basically with CSS Containment you're going to be  able to get performance benefits in this pipeline</span> <span data-start="169.78" data-end="173.789">So, let's go to the spec, the spec is now candidate recommendation</span> <span data-start="175.239" data-end="177.628">So it's quite a stable at this stage</span> <span data-start="178.269" data-end="184.828">And we will explain how it works and try to explain the different options and all that. So basically the main goal of</span> <span data-start="185.89" data-end="189.989">CSS Containment is to improve the performance of a website by</span> <span data-start="191.98" data-end="193.359">identifying the</span> <span data-start="193.359" data-end="195.359">independent parts of a website which are</span> <span data-start="195.639" data-end="201.149">parts of the DOM tree that doesn't have to interact with the rest, so somehow it's like isolating</span> <span data-start="201.819" data-end="203.819">that subtree from the rest of the page</span> </p>
<p><span data-start="204.22" data-end="207.509">In a way that if you do modifications inside that subtree</span> <span data-start="207.51" data-end="211.62">they don't get propagated outside so you don't need to do work in the</span> <span data-start="212.2" data-end="214.2">ancestors and all that</span> <span data-start="214.72" data-end="219.929">One confusing thing about containment when you first read about it or you hear about it is that</span> <span data-start="221.199" data-end="227.219">is not that things outside cannot affect the elements inside, is not top to bottom. But is the other way around</span> </p>
<p><span data-start="227.769" data-end="230.548">Things inside that element are not going to affect anything outside</span> <span data-start="230.549" data-end="232.06">So this is a sentence</span> <span data-start="232.06" data-end="237.959">By Tab Atkins, one of the spec editors, that he usually needs to repeat over a over in the CSS Working Group meetings</span> <span data-start="237.959" data-end="242.488">"contain" property doesn't block things going into the subtree, it blocks things leaking out</span> <span data-start="243.459" data-end="246.929">So it's quite relevant for all the containment stuff</span> <span data-start="248.199" data-end="254.699">So yeah, I already say that. This spec only introduces a new property, which name is "contain"</span> <span data-start="254.699" data-end="261.029">So it's very easy to remember and this property has four values, main values, or types of containments</span> <span data-start="262.479" data-end="269.098">layout, paint, size, style. You can just put one or put two combine or combine the four, you can do whatever you want there</span> <span data-start="269.409" data-end="276.419">style is red in the slides because it's market as at risk now in the spec, so we will talk more later about that</span> <span data-start="277.599" data-end="282.989">So imagine this is a website. You have some content, some text, the header, whatever and</span> <span data-start="283.81" data-end="286.859">you know that you have a component, maybe in the top left corner</span> <span data-start="286.96" data-end="292.979">For example that you are showing some live information that you are getting or showing</span> <span data-start="293.349" data-end="297.299">an animation or whatever, but you know that's totally independent from the rest of the page</span> </p>
<p><span data-start="298.06" data-end="302.129">So you identify that part, mark it like a contained element</span> <span data-start="302.56" data-end="306.659">And when the browser does work there, it doesn't need to care about the rest of the pages</span> <span data-start="306.659" data-end="309.509">The page is very big or very complex DOM tree or whatever</span> <span data-start="309.939" data-end="313.919">The browser doesn't need to spend any single time in doing other stuff</span> <span data-start="316.12" data-end="319.56">So basically what web authors will need to do is to identify</span> <span data-start="320.439" data-end="326.759">which are that independent parts of a website and mark them with the "contain" property and then</span> <span data-start="327.339" data-end="329.339">The browser engine needs to do</span> <span data-start="329.889" data-end="332.878">something because it's not just parse the property and</span> <span data-start="333.52" data-end="339.81">implement the restrictions but also it needs to implement some optimizations and avoid doing extra work. Browser engines usually</span> </p>
<p><span data-start="340.18" data-end="342.149">Try to do as less work as possible</span> <span data-start="342.149" data-end="347.939">When you do a change in a website, they have some kind of heuristics in order to achieve that</span> <span data-start="348.729" data-end="352.199">But still there are many corner cases and many combinations of things</span> <span data-start="352.199" data-end="355.049">So when you do a change on a single element that you believe is</span> <span data-start="355.99" data-end="357.75">Not going to affect anything else</span> <span data-start="357.75" data-end="359.5">The browser still needs to maybe</span> <span data-start="359.5" data-end="365.939">Check all the siblings just in case your overflowing content and you need to paint something in other parts of whatever</span> </p>
<p><span data-start="368.289" data-end="373.949">And when you use containment, you have some kind of restrictions or implications of using it</span> <span data-start="373.949" data-end="377.878">so you cannot just put "contain" to all the elements and you are done you need to</span> <span data-start="378.279" data-end="380.279">To put it when it makes sense</span> <span data-start="381.069" data-end="382.449">so there are</span> <span data-start="382.449" data-end="385.228">Like this four type of containers we are going to review</span> <span data-start="385.839" data-end="392.999">First one for example layout containment. Basically here that means that the internal layout of the isolated subtree</span> <span data-start="393.669" data-end="398.999">Is totally isolated from the rest of the tree. So the element where you put "contain: layout"</span> <span data-start="399.88" data-end="403.799">The layout of that element is totally independent of the ancestor</span> <span data-start="405.07" data-end="412.439">so these are the effects it takes to element. Any overflow on that element is treated as ink overflow flow</span> <span data-start="412.72" data-end="415.14">like shadows for example, I'll show an example later</span> </p>
<p><span data-start="416.35" data-end="421.17">That element becomes a containing block for absolute and fixed position and descendants</span> <span data-start="421.93" data-end="427.23">it also creates a new stacking context and independent formating context like display flow-root and</span> <span data-start="427.9" data-end="431.79">Also that the element has no baseline. So why these</span> <span data-start="432.85" data-end="440.489">Restrictions when you use it. So let's see an example of this ink overflow thing. We have here two</span> <span data-start="441.07" data-end="443.07">divs that one has</span> <span data-start="443.2" data-end="449.969">"contain: none" the other "contain: layout", is the magenta dotted border the element that has the "contain: none" or "contain: layout"</span> <span data-start="450.31" data-end="455.549">So if the size of the text is changing here you see that an</span> <span data-start="456.58" data-end="459.63">scrollbar is appearing on the parent element. So the browser</span> <span data-start="460.6" data-end="464.82">Something changes inside and needs to do work outside like painting this scrollbar</span> <span data-start="465.52" data-end="468.419">But with "contain: layout" it doesn't need to do anything outside</span> <span data-start="469.06" data-end="470.71">this is</span> <span data-start="470.71" data-end="473.519">treated as ink overflow, like shadows</span> <span data-start="473.52" data-end="474.78">You cannot access it actually</span> <span data-start="474.78" data-end="480.63">But I mean the browser can avoid doing any work in the parents checking if there are overflow and it needs to paint</span> <span data-start="480.97" data-end="482.97">to show a scrollbar like here</span> <span data-start="484.66" data-end="491.07">Similar is for baseline. I say that when you use layout containment the element is considered to have no baseline</span> </p>
<p><span data-start="492.13" data-end="495.809">So basically is the same, here in the  "contain: none"</span> <span data-start="495.81" data-end="500.19">you see that the "foo" is aligned with the "bar" in the other one if use the</span> <span data-start="500.19" data-end="507.749">synthesized baseline that is the underline in this case, if the size changes inside the browser needs to move foo a</span> <span data-start="508.03" data-end="509.35">little bit below</span> <span data-start="509.35" data-end="513.089">however with "contain: layout" something changes inside but the browser</span> <span data-start="513.64" data-end="517.679">Doesn't care. I mean it can save time and avoid that kind of operations</span> <span data-start="519.729" data-end="525.899">So another type of containment is paint containment, which is pretty similar to "overflow: hidden," but also has some</span> <span data-start="526.69" data-end="531.84">Effects so basically the descendants cannot be displayed outside of the boundaries of that element</span> <span data-start="534.34" data-end="541.559">But again it has some effects, contents are clipped like with "overflow: hidden", but also it becomes the containing block for</span> <span data-start="542.41" data-end="550.23">positioned descendants/children, it also creates a stacking content and independent formatting context. So let's  see another example</span> <span data-start="551.92" data-end="555.96">So we have "contain: none" again in the dotted magenta</span> <span data-start="556.9" data-end="561.719">element and "contain: paint" and we have an absolute positioned at the element that has</span> <span data-start="562.06" data-end="566.82">-100 pixels top and left. It has 200 pixels by 200 pixels size</span> <span data-start="567.46" data-end="571.169">So it's positioned against the parent, it means the viewport or whatever</span> </p>
<p><span data-start="571.17" data-end="576.089">And in the other case is positioned against the container element is moved a little bit left</span> <span data-start="576.91" data-end="578.91">and top and also</span> <span data-start="579.37" data-end="580.57">the</span> <span data-start="580.57" data-end="582.57">overflowing things are clipped</span> </p>
<p><span data-start="582.85" data-end="586.05">So when you change the color</span> <span data-start="586.42" data-end="593.67">Here the browser needs to paint also things outside that element but here the browser needs to paint</span> <span data-start="594.1" data-end="595.63">things inside</span> <span data-start="595.63" data-end="596.46">so again</span> <span data-start="596.46" data-end="600.509">If you have an element with content paint that is not in the viewport the browser can avoid</span> <span data-start="600.79" data-end="605.04">doing work on it doing, doing any painting because</span> <span data-start="605.77" data-end="607.77">the browser is sure that there are not</span> <span data-start="609.22" data-end="614.73">something overflowing that that is painted in the viewport or whatever, they know that they can save that the time</span> <span data-start="615.97" data-end="620.1">Size containment is about how the browser computes the size of an element</span> <span data-start="621.1" data-end="624.57">Basically, if you put "contain: size" is going to ignore the children</span> <span data-start="625.87" data-end="631.679">so the element is treated as having no contents, only things like padding add space or</span> <span data-start="632.05" data-end="636.27">column-gap if you have multi column or the tracks in grid something like that</span> <span data-start="636.27" data-end="641.009">you already defined, but not the contents itself. And also it's monolithic</span> </p>
<p><span data-start="641.01" data-end="646.739">That means that you cannot split it when you print it or it's in multi column or things like that.</span> <span data-start="648.22" data-end="653.7">So again, this is the same example again. So the first element</span> <span data-start="654.22" data-end="657">The size depends on the contents is "Hello World!"</span> <span data-start="657.64" data-end="659.11">and</span> <span data-start="659.11" data-end="661.38">when the contents change the size changes</span> <span data-start="661.38" data-end="667.449">but in this case, only is the padding the one that is  defining  the size of that element, if the</span> <span data-start="668.089" data-end="671.078">contents change it doesn't care. You see that it's overflowing</span> <span data-start="671.899" data-end="676.299">The thing is that when you combine this with the other ones, the browser can say, okay</span> <span data-start="676.399" data-end="683.379">I know for sure that nothing is going to change outside, even the size isn't going to affect anything outside and all that</span> <span data-start="683.959" data-end="687.309">And then last one is style containment</span> <span data-start="687.8" data-end="692.38">This is somehow special because it only affects counters and quotes.</span> <span data-start="692.99" data-end="697.209">I don't know if you use them a lot. I guess no because it's not very common, but</span> <span data-start="697.73" data-end="699.73">at least is on the spec and</span> </p>
<p><span data-start="700.22" data-end="707.47">It's currently market as at risk, because the scope is maybe too narrow only counter and quotes</span> <span data-start="707.47" data-end="713.529">So there are some discussions about if it's worth. Firefox for example is not implementing this so far</span> <span data-start="713.529" data-end="717.729">So that's another reason why is at risk in the spec? Because they don't see the benefit</span> <span data-start="719.449" data-end="725.949">And also chroming implementation of style containment is pretty broken so only works for the very simple cases</span> <span data-start="726.41" data-end="729.31">so if any of you find a use case that</span> </p>
<p><span data-start="729.589" data-end="734.739">Can get performances benefit with style containment share with the CSS Working Group at the GitHub repository</span> <span data-start="735.41" data-end="740.439">Because that will be valuable information to know if we need to keep or not this value</span> <span data-start="741.889" data-end="746.379">so basically the effects are that the counters and quotes are scoped to the subtree and</span> <span data-start="746.99" data-end="751.779">That when you try to increment a counter you actually are creating a new one instead of incrementing it</span> <span data-start="753.23" data-end="756.189">So basically, just an example with counters</span> <span data-start="756.649" data-end="762.249">This is a class that is incrementing this counter "n" and this is just an element that paints the counter</span> <span data-start="762.74" data-end="767.829">So we are here creating this counter "n" and increment it to 1, then we print it is just 1</span> <span data-start="768.949" data-end="770.87">then we have a</span> <span data-start="770.87" data-end="777.729">"contain: style" element, so this counter inside cannot increment the one outside so it creates a new one</span> <span data-start="777.829" data-end="780.369">so we have here 1.1 and</span> <span data-start="781.04" data-end="786.67">When we print it after outside of the contained element, this doesn't know anything of what happened inside with the counter</span> <span data-start="786.949" data-end="792.008">So that's what's isolated, so still 1 again. So that will be the expected output</span> <span data-start="794.29" data-end="797.459">Then with quotes, quotes are I think even a</span> <span data-start="798.01" data-end="799.78">less common use case</span> </p>
<p><span data-start="799.78" data-end="801.899">So you can define</span> <span data-start="802.45" data-end="804.629">Which symbols are you using when you have</span> <span data-start="805.24" data-end="811.26">nested quotes. So this is double first and then single or whatever and then we are opening a quote here</span> <span data-start="811.26" data-end="816.179">We have "foo" then we have the style containment element and we open another quote</span> <span data-start="816.97" data-end="818.97">we have the text "bar" and then we close</span> <span data-start="819.76" data-end="824.999">the quote. When we close this, it doesn't know that a new one was opening inside the style containment element</span> <span data-start="825.31" data-end="827.97">So it just closes the initial opening</span> <span data-start="828.49" data-end="834.09">We are not closing both in this case, but they mean basically that the changes here doesn't affect anything outside</span> <span data-start="836.74" data-end="837.6">So, okay</span> <span data-start="837.6" data-end="844.17">We have aliases in the spec so you can say "contain: content" and that implies layout and paint</span> <span data-start="844.42" data-end="848.189">Or you can say "contain: strict" and that implies layout, paint and size</span> <span data-start="849.46" data-end="855.09">This used to include style too, but like style is market at risk and Firefox was planning to ship</span> <span data-start="855.79" data-end="863.219">CSS Containment, it was removed from the spec at this stage. If in the future style is implemented by all the browsers probably</span> <span data-start="863.56" data-end="867.119">There will be a new alias like "all" or whatever that will include style too</span> </p>
<p><span data-start="868.69" data-end="871.8">So let's just check the status of things</span> <span data-start="872.95" data-end="876.689">This is not a new spec. Maybe it's the first time you've heard about it</span> <span data-start="876.69" data-end="881.489">But if has been shipping for three years already in Chromium, so it's not an new spec at all</span> <span data-start="882.73" data-end="889.889">and Google has been using it in their products like YouTube or Gmail, even in the Chrome Dev Tools, things like that</span> </p>
<p><span data-start="891.31" data-end="896.46">But during past year there has been quite a lot of work in the in the spec</span> <span data-start="897.52" data-end="903.179">Florian Rivoal one of the spec editors has been working quite a lot</span> <span data-start="903.18" data-end="905.489">in pushing the spec to candidate recommendation</span> <span data-start="905.5" data-end="912.96">Also the test suite in Web Platform Tests repository has been completed by Gérard Talbot and with contributors from Mozilla and Chromium</span> <span data-start="913.42" data-end="916.079">while we were working in the implementations</span> <span data-start="916.72" data-end="923.85">We at Igalia having fixing the implementation in Chromium. So it's aligned with the spec and we can start to implement optimizations based on that</span> <span data-start="924.7" data-end="930.579">And that was causing us to be breaking most of the sites</span> <span data-start="930.58" data-end="933.43">I mean, we broke YouTube for a while</span> <span data-start="934.19" data-end="941.169">we broke Gmail, we broke Dev Tools several times because maybe they were using "contain: layout" for example in many places and now</span> <span data-start="941.9" data-end="948.07">the overflow is treated as ink overflow so you can access it, things like that, or now that is a containing block for</span> <span data-start="948.07" data-end="954.399">the positioned descendants, so everything is positioned wrongly, so you need to or stop using contain layout or</span> <span data-start="955.4" data-end="957.73">Change how things work inside that element</span> <span data-start="958.79" data-end="959.99">and</span> </p>
<p><span data-start="959.99" data-end="962.469">Then Firefox is also working on the implementation</span> <span data-start="963.11" data-end="965.11">They are targeting Firefox</span> <span data-start="965.45" data-end="970.389">69 to ship it, but you can already test it behind the runtime flag</span> <span data-start="971.48" data-end="976.18">And meanwhile Chromium has been implementing some optimizations based on css-contain</span> <span data-start="976.18" data-end="981.609">So like I say you can just parse the property in the browser implement the restrictions and you are</span> <span data-start="982.04" data-end="986.38">passing all the tests of CSS Containment so you are totally spec on client</span> <span data-start="986.63" data-end="991.689">But maybe you don't have any optimization in the browser so is not useful at all at the end</span> <span data-start="991.91" data-end="996.67">So then when the browser has that information it needs to still implement some</span> <span data-start="997.31" data-end="998.69">optimizations</span> <span data-start="998.69" data-end="999.8">and</span> <span data-start="999.8" data-end="1004.349">If we look at "Can I use" like Microsoft is moving to Chromium/Blink</span> <span data-start="1004.35" data-end="1011.279">it's getting support for this, all the Chromium browsers has support for this, and Firefox is about to ship in a few releases and</span> <span data-start="1011.59" data-end="1015.12">and then regarding Safari/WebKit there are no public signals yet</span> <span data-start="1017.05" data-end="1021.45">So let's show some examples to try to understand this a little bit better</span> <span data-start="1023.02" data-end="1026.67">This is one example from a blog post I published about</span> <span data-start="1027.64" data-end="1033.57">Containment is very simple and not cool at all. But I believe it's the best want to understand how how it works</span> <span data-start="1033.82" data-end="1041.399">so imagine that we have a very big DOM tree, like ten thousand elements like this item that has all of them have</span> <span data-start="1041.77" data-end="1043.979">one child and</span> </p>
<p><span data-start="1044.5" data-end="1050.7">We are modifying the content of that child over and over or whatever. So we have a DOM tree like this</span> <span data-start="1050.7" data-end="1055.08">We have many many elements here, but we are only doing changes in this green</span> <span data-start="1055.68" data-end="1057.68">div</span> <span data-start="1057.79" data-end="1063.719">But still the browser needs to do work in the rest, not a lot of work maybe just</span> <span data-start="1064.15" data-end="1070.229">Traversing the whole DOM tree to do some checks or whatever but it's doing work in all of them, so we can say okay</span> <span data-start="1070.23" data-end="1077.37">This has "contain: strict". We cannot affect anything outside. We are just changing things inside here, the browser can avoid</span> <span data-start="1077.98" data-end="1079.98">Navigating the rest of the things</span> <span data-start="1080.11" data-end="1085.56">So this example is, I mean not cool at all, is changing the the text in the first</span> <span data-start="1086.35" data-end="1088.03">element</span> <span data-start="1088.03" data-end="1093.78">it actually goes from changing is taking six milliseconds without containment to take</span> <span data-start="1094.36" data-end="1097.349">0.2 milliseconds with "contain: strict". So it's like a</span> <span data-start="1098.17" data-end="1100.17">quite a bit difference</span> </p>
<p><span data-start="1100.48" data-end="1107.01">This is another example is the same one, but I'm using grid layout in the items because I know that</span> <span data-start="1107.59" data-end="1110.49">grid layout has all these track sizing algorithms. So it's</span> <span data-start="1111.28" data-end="1113.28">somehow costly</span> <span data-start="1113.32" data-end="1116.189">if we think about performance, so it takes a while and</span> </p>
<p><span data-start="1116.92" data-end="1119.219">On the left we have Chromium on the right we have Firefox</span> <span data-start="1120.07" data-end="1123.089">that's because I was crafting this example for this talk and</span> <span data-start="1123.43" data-end="1126.899">I realize it we were not getting very good results in Chromium</span> <span data-start="1126.9" data-end="1131.999">So I was checking Firefox and Firefox was much better and it makes actually sense the results</span> <span data-start="1132" data-end="1132.6">We are getting in Firefox</span> <span data-start="1132.6" data-end="1139.08">For example with these 10,000 items in Chromium is like 12 times faster with "contain: strict"</span> <span data-start="1139.3" data-end="1142.229">which is quite a lot but in Firefox is like</span> <span data-start="1143.8" data-end="1148.409">2,700 times faster, but that makes sense because if you need to visit</span> <span data-start="1148.78" data-end="1154.229">10,000 grid containers and do layout on will on each of them and all that, or whatever you need to do</span> </p>
<p><span data-start="1154.3" data-end="1159.57">Instead of just doing it in one. It's suspected that it's very very fast when you just have this</span> <span data-start="1160.09" data-end="1162.72">strict containment in that element, that you just do it there</span> <span data-start="1165.37" data-end="1167.05">So</span> <span data-start="1167.05" data-end="1173.039">We have been working on this at Igalia as part of our ongoing collaboration with Bloomberg in which we implemented</span> <span data-start="1173.53" data-end="1181.019">CSS Grid Layout in the past years or we have been implementing things in JavaScript like async/await or BigInt lately</span> <span data-start="1181.85" data-end="1183.85">and</span> <span data-start="1184.88" data-end="1191.92">Bloomberg has some quite complex UIs and then we're getting benefit of using CSS Containment in some of them</span> <span data-start="1192.47" data-end="1196.959">So this is one of the stress cases we had this is like a huge</span> <span data-start="1197.66" data-end="1202.06">table like layout or grid like layout. It doesn't have to be a table or grid</span> <span data-start="1202.06" data-end="1206.889">It doesn't matter but it has like 10,000 cells or whatever and the text is changing constantly</span> <span data-start="1208.28" data-end="1213.79">but we actually know that we are just changing one number by  another number</span> <span data-start="1213.92" data-end="1217.119">that the number is going to fit in the size we are providing, we know that for sure</span> </p>
<p><span data-start="1218.15" data-end="1220.15">So we don't need</span> <span data-start="1220.67" data-end="1222.969">We can say to the browser. Okay, this element has</span> <span data-start="1224.24" data-end="1228.339">"contain: layout size" and you can avoid doing the layout of the</span> <span data-start="1228.71" data-end="1235">text you are changing there ,because if you are adding a long sentence or whatever the browser needs to do line breaking, all that and</span> <span data-start="1235.37" data-end="1237.79">Calculate some things, so we are saying okay</span> </p>
<p><span data-start="1237.79" data-end="1240.399">You can save all that time if we have "contain: layout size"</span> <span data-start="1240.56" data-end="1244.659">because we know that we are just changing one number way another and it's going to fit inside and</span> <span data-start="1245.18" data-end="1251.139">Then this stress test with 10,000 elements. We were like four times faster using containment. So it's a nice optimization</span> <span data-start="1252.23" data-end="1258.13">This is the still to ported to LayoutNG, which is new thing that Chromium is shipping really soon. So</span> <span data-start="1259.19" data-end="1261.49">It will be like similar things</span> <span data-start="1262.43" data-end="1269.68">This was another one pretty similar again very big table or whatever. Here are some of the</span> <span data-start="1270.47" data-end="1277.66">Progress bars are moving are changing size. We're not changing the contents like that. But something is changing size inside each of them</span> <span data-start="1278.72" data-end="1285.13">But the thing is that in the use case each of these cells were absolute positioned. So we have like</span> <span data-start="1286.61" data-end="1288.939">Each of them has its own layer</span> <span data-start="1289.79" data-end="1294.43">So the browser when something was changing inside one. It was traversing the whole layer three</span> <span data-start="1295.31" data-end="1301.509">and depending on the size of the DOM, that was taking a while in some phases and then we "contain: strict"</span> <span data-start="1301.67" data-end="1308.829">and a very big stress we get like 10% faster. It's not a lot but it is, I mean, everything helps</span> </p>
<p><span data-start="1308.83" data-end="1311.949">Probably we were respecting more, but maybe there are room for more things yet</span> <span data-start="1313.22" data-end="1316.72">So let's talk about the future of all these</span> <span data-start="1317.36" data-end="1322.24">We can expect better browser support Firefox is shipping really soon. We don't know Safari but</span> <span data-start="1322.79" data-end="1327.159">We hope that, I mean, we never heard complaints from Apple about this spec. So it seems</span> <span data-start="1327.679" data-end="1330.009">Maybe at some point they will have it</span> <span data-start="1330.98" data-end="1334.87">Other thing that we can expect is more optimizations based on css-contain</span> <span data-start="1334.87" data-end="1341.079">Basically when people are start to use it, they will say okay like this example, I just did in Chromium</span> <span data-start="1341.75" data-end="1346.39">Ok, this will be much faster than what we are seeing. I mean I'm changing just one element</span> </p>
<p><span data-start="1346.549" data-end="1351.129">It should be almost as fast as having just one element in the DOM despite I have a ton of</span> <span data-start="1351.83" data-end="1353.72">10,000 elements or whatever</span> <span data-start="1353.72" data-end="1357.669">So you can report a bug and probably the browser will try to</span> <span data-start="1358.01" data-end="1359.96">improve that use case with some</span> <span data-start="1359.96" data-end="1364.75">optimization because maybe, I mean this is somehow it's not new because it has been there for a while but</span> <span data-start="1365.179" data-end="1366.76">There has not being a lot of work</span> </p>
<p><span data-start="1366.76" data-end="1372.219">So there are still a lot of room for improvement here in a lot of optimizations to be done in the browser</span> <span data-start="1372.62" data-end="1374.62">And also there are some new features</span> <span data-start="1375.11" data-end="1381.579">or proposals that some browsers are working on, that are based on this spec</span> <span data-start="1382.07" data-end="1387.22">So, I don't know if you have heard about Display Locking proposal from Google. Google is</span> <span data-start="1388.04" data-end="1391.389">experimenting with this and have some experimental implementation already in Chromium</span> <span data-start="1392.21" data-end="1398.049">Main idea of display locking is that in a DOM tree you can lock an element of the DOM</span> <span data-start="1398.84" data-end="1402.069">Then you do manipulation in JavaScript you modify</span> <span data-start="1402.07" data-end="1408.76">Whatever you need there without blocking the main thread and then when everything is ready you unlock it and show it in the screen</span> <span data-start="1409.13" data-end="1415.179">But for that you need that the element is independent of the rest and that's where containment</span> <span data-start="1415.7" data-end="1421.48">comes to the rescue. And I mean you mark that element with "contain" and then you can do that</span> <span data-start="1421.88" data-end="1423.999">so things like this</span> <span data-start="1424.94" data-end="1430.39">in the future will appear maybe display locking is not the the feature that is finally standardized</span> </p>
<p><span data-start="1430.39" data-end="1433.119">But it's one of these ideas</span> <span data-start="1434.03" data-end="1438.28">And that's all from my side. I hope you understand a little bit better</span> <span data-start="1438.28" data-end="1442.659">Now what this spec is about you can start experimenting with it and report bugs about it</span> <span data-start="1443.57" data-end="1444.98">in my blog you can read</span> <span data-start="1445.28" data-end="1447.859">I just only have one article about this but maybe in the future</span> <span data-start="1447.86" data-end="1452.479">I will have more, I've been writing articles about grid and things we are working on for a while</span> <span data-start="1452.64" data-end="1460.009">And I will be around the whole day. Feel free to talk to me about CSS Containment, CSS Grid, what it takes to implement a</span> <span data-start="1461.01" data-end="1465.29">CSS spec in a browser or things like that or even ask me about Igalia and the things we do</span> </p>
</section>