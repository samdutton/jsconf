<section>
<p><span data-start="7.169" data-end="10.99"Audience member: I can't believe I'm right here right now.</span> <span data-start="10.99" data-end="13.07">Give it up for the conference organisers.</span> <span data-start="13.07" data-end="15.469">This is amazing.</span> <span data-start="15.469" data-end="17.4">[Applause].</span> <span data-start="17.4" data-end="21.24">So, hi.</span> </p>
<p><span data-start="21.24" data-end="25.05">My name is cat Kat.</span> <span data-start="25.05" data-end="32.369">I'm the lead maintainer architect for the npm CLI.</span> <span data-start="32.369" data-end="37.73">I'm not here just to talk about the npm CLI, I'm here to talk about an experiment I've</span> <span data-start="37.73" data-end="42.719">been working on called "tink" which I'm hoping will set a precedent for JavaScript package</span> <span data-start="42.719" data-end="46.389">managers in the future.</span> <span data-start="46.389" data-end="52.149">I want to talk about the why, more specifically, about what npm needs to do in order to get</span> <span data-start="52.149" data-end="57.81">JavaScript apps to work, and there is really one big end goal we have had for most of the</span> <span data-start="57.81" data-end="58.81">npm's lifetime.</span> </p>
<p><span data-start="58.81" data-end="63.76">Put a bunch of stuff in your local node modules as fast as possible and everything consumed</span> <span data-start="63.76" data-end="64.76">from there.</span> <span data-start="64.76" data-end="67.369">Make it as fast as you can.</span> <span data-start="67.369" data-end="71.58">That seems pretty straightforward on its own, but what does it really take?</span> <span data-start="71.58" data-end="76.56">So for context, I want talk about the overall problem.</span> <span data-start="76.56" data-end="82.31">What steps we've taken along the way to mitigate the issues we came up with, that came up.</span> <span data-start="82.31" data-end="86.69">Now, the process I'm going to describe is mostly shared between all current package</span> <span data-start="86.69" data-end="88.14">managers.</span> <span data-start="88.14" data-end="93.44">They all do different optimisations and clever things around each step, but they all kind</span> <span data-start="93.44" data-end="100.159">of have to do this at some point or another to be compatible with Node.</span> </p>
<p><span data-start="100.159" data-end="101.77">Let's take a look.</span> <span data-start="101.77" data-end="106.32">This is high-level overview of what a JavaScript installer needs to do.</span> <span data-start="106.32" data-end="112.259">We all do this to some extent or another but ultimate ly the same.</span> <span data-start="112.259" data-end="115.979">First up, it's this one.</span> <span data-start="115.979" data-end="118.24">Reading local dependencies if you have any.</span> <span data-start="118.24" data-end="124.979">You will probably in the this one these days when you have a no auth installed, when you</span> <span data-start="124.979" data-end="130.47">ran it, and npm is still taking five seconds, and you don't know why.</span> <span data-start="130.47" data-end="134.79">It usually isn't more than a couple of seconds but it's still pretty noticeable.</span> <span data-start="134.79" data-end="140.69">Yarn has an interesting optimisation around this where they slap a metadata file based</span> <span data-start="140.69" data-end="150.599">on Node modules, and they match, they say fuck it and trust what is in the modules.</span> <span data-start="150.599" data-end="155.36">npm has been a bit stub Bosch here since we've so far considered that no up case is a fairly</span> <span data-start="155.36" data-end="161.409">rare thing, and if you run npm will be able to autofix any issues with your tree which</span> <span data-start="161.409" data-end="163.709">we think is important enough to warrant the delay.</span> </p>
<p><span data-start="163.709" data-end="168.78">I don't know, we might go ahead and do what Yarn does at some point anyway because people</span> <span data-start="168.78" data-end="174.019">want that sweet, sweet speed-up, but in the end, this step tends to be noticeable, but</span> <span data-start="174.019" data-end="176.59">it's not really the biggest delay.</span> <span data-start="176.59" data-end="178.83">But this next one kind of was for a while.</span> <span data-start="178.83" data-end="183.58">It turns out making literally thousands of requests just to get metadata from the registry</span> <span data-start="183.58" data-end="192.34">in order to calculate our tree is fairly network-intensive operation, and in times, this was definitely</span> <span data-start="192.34" data-end="193.62">a time hog.</span> <span data-start="193.62" data-end="195.45">So, like what happened?</span> <span data-start="195.45" data-end="198.25">Well, basically, log files happened.</span> <span data-start="198.25" data-end="204.14">Log files are supervene for developers, sure, but they're just a single file cache — oh,</span> <span data-start="204.14" data-end="207.569">my God, what it is trying to update right now!</span> <span data-start="207.569" data-end="209.62">Excuse me!</span> <span data-start="209.62" data-end="216.29">They're just a single-file cache of the tree calculations step of your package managers.</span> <span data-start="216.29" data-end="219.14">And that's why we love that stuff so much.</span> </p>
<p><span data-start="219.14" data-end="222.98">Once you've built your project up, none of your team-mates really need to bother doing</span> <span data-start="222.98" data-end="227.159">this stuff until they add or remove any dependency.</span> <span data-start="227.159" data-end="230.959">This is also why I'm pretty adamant that you should use log files for libraries.</span> <span data-start="230.959" data-end="239.56">They just like make life so much easier.</span> <span data-start="239.56" data-end="243.2">This next one has never really been a huge bottleneck on its own, but I still want to</span> <span data-start="243.2" data-end="249.28">next it, because we do put some effort into keeping the stuff being fast enough.</span> </p>
<p><span data-start="249.28" data-end="251.269">I want you to know this stuff happens to exist.</span> <span data-start="251.269" data-end="257.09">Long story short, this is what figures out what existing dependencies need to be removed,</span> <span data-start="257.09" data-end="266.08">added, copied, whatever, since npm at three, we do calculation to flatten that tree.</span> <span data-start="266.08" data-end="270.23">How many of you used npm 3 when it first came out?</span> <span data-start="270.23" data-end="272.11">It was not the fastest thing on earth.</span> <span data-start="272.11" data-end="274.5">It's a lot faster now.</span> <span data-start="274.5" data-end="276.12">Moving on.</span> <span data-start="276.12" data-end="278.04">This one here.</span> <span data-start="278.04" data-end="282.94">This one is by far the heaviest and slowest of all the install steps, mainly because it's</span> <span data-start="282.94" data-end="285.89">the heaviest on pretty much all relevant resources.</span> </p>
<p><span data-start="285.89" data-end="289.67">Let's dive a little deeper into this one.</span> <span data-start="289.67" data-end="293.12">In the end, we have hundreds of megabytes that need to be transferred over the network,</span> <span data-start="293.12" data-end="299.66">and once we have those, we have to spend a bunch of CPU cycles parsing and un zipping</span> <span data-start="299.66" data-end="309.17">the tar balls, and we do tons of heavy disk I/O.</span> <span data-start="309.17" data-end="313.75">All of the three usual suspects are bottlenecks here in one way or the other, with and it</span> <span data-start="313.75" data-end="319.26">depends on your usage pattern at some point in time.</span> <span data-start="319.26" data-end="324.01">Long story short, this is where the bad and slow stuff happens, and this has been a huge</span> <span data-start="324.01" data-end="330.54">target of optimisation for pretty much all package managers.</span> <span data-start="330.54" data-end="333.48">I assume many other package managers too.</span> <span data-start="333.48" data-end="335.91">So, what can we do about this?</span> <span data-start="335.91" data-end="340.33">Well, for one, we can do a bunch of cache ing of — different caching strategies have</span> <span data-start="340.33" data-end="342.22">different trade-offs.</span> <span data-start="342.22" data-end="350.4">npm takes innings it means we have to take the hit of parsing those tar balls every time.</span> </p>
<p><span data-start="350.4" data-end="361.5">Yarn stores them post-distraction which loses them -</span> <span data-start="361.5" data-end="363.59">the npm here is really interesting.</span> <span data-start="363.59" data-end="371.25">Because, they have an extracted cache, like Yarn, but instead of copying the files they</span> <span data-start="371.25" data-end="374.03">hard-link them into their final destinations.</span> <span data-start="374.03" data-end="380.55">This kind of surprisingly isn't really that much faster than copying on SSDs, and stuff,</span> <span data-start="380.55" data-end="385.41">but it's definitely way more space-efficient, because you pay for each package exactly ones</span> <span data-start="385.41" data-end="386.41">across your system.</span> <span data-start="386.41" data-end="388.77">That's pretty cool.</span> <span data-start="388.77" data-end="392.381">And because I can't seem to stop talking about Yarn today, they have a thing called PMP that</span> <span data-start="392.381" data-end="395.03">partially addresses problems in this step.</span> <span data-start="395.03" data-end="402.74">The downside is that tools need to — it costs it can cause incompatibility.</span> <span data-start="402.74" data-end="409.25">PMP is interesting and worth checking out.</span> <span data-start="409.25" data-end="413.87">You can have Maël talk about it at the next talk.</span> <span data-start="413.87" data-end="415.11">He's great.</span> </p>
<p><span data-start="415.11" data-end="418">There is a lot of work making this a bit better.</span> <span data-start="418" data-end="420.51">No surprise, it's the most expensive bit.</span> <span data-start="420.51" data-end="426.63">I will get back to the soon, and what else we can do about it, but for now, let's wrap</span> <span data-start="426.63" data-end="428.31">this walk-through.</span> <span data-start="428.31" data-end="433.62">We do all the downloading, and extracting, and then we have to scan through the packages</span> <span data-start="433.62" data-end="436.38">we installed and scrutiny run scripts.</span> <span data-start="436.38" data-end="441.74">This isn't usually the biggest step since there's usually the run scripts that run,</span> <span data-start="441.74" data-end="443.28">and most aren't that slow.</span> <span data-start="443.28" data-end="448.96">But, this still becomes noticeable on some unfortunate projects.</span> <span data-start="448.96" data-end="453.37">npm doesn't do this, but some package managers actually parallelise this stuff at great risk</span> <span data-start="453.37" data-end="459.56">and complexity, and it does make things a lot faster if you have heavy stuff to build,</span> <span data-start="459.56" data-end="463.19">like .. which takes forever.</span> <span data-start="463.19" data-end="471.15">I think we're better off with a solution with something like Node Preget or have prebuilt</span> <span data-start="471.15" data-end="476.19">binary somewhere on the registry, but that's what we've got right now.</span> </p>
<p><span data-start="476.19" data-end="481.93">What you should take away here, though, is that in the end, node modules is massive.</span> <span data-start="481.93" data-end="484.12">And also, where dreams go to die.</span> <span data-start="484.12" data-end="490.19">Now, the fact is that node modules, while the greatest fraction has caused everyone</span> <span data-start="490.19" data-end="493.82">massive headaches in usability, time wasted.</span> <span data-start="493.82" data-end="501.39">There's a lot to agree with on this front with Ryan's talk about node prerets here at</span> <span data-start="501.39" data-end="502.39">this conference.</span> <span data-start="502.39" data-end="503.75">What are you doing, microphone!</span> <span data-start="503.75" data-end="509.21">Please calm down!</span> <span data-start="509.21" data-end="511.15">But what do we actually do about it?</span> <span data-start="511.15" data-end="518.31">It's easy to complain about, and talk about how bad an idea it is, but I still think that</span> <span data-start="518.31" data-end="520.219">good outweighs the bad.</span> <span data-start="520.219" data-end="522.779">Isolated dependencies are really good.</span> </p>
<p><span data-start="522.779" data-end="526.82">Having each individual project be able to manage dependencies is fantastic.</span> <span data-start="526.82" data-end="529.25">Being safe from dependency hell is really good.</span> <span data-start="529.25" data-end="531.69">The fact that we automatically nest things.</span> <span data-start="531.69" data-end="533.24">That's great.</span> </p>
<p><span data-start="533.24" data-end="538.86">And, you know, we have kind of 900,000 packages out there that some of you might think that</span> <span data-start="538.86" data-end="542.069">some of them are crappy, but most are pretty useful.</span> <span data-start="542.069" data-end="549.87">At least a big enough percentage is useful that we want to keep that and have that compatibility.</span> <span data-start="549.87" data-end="553.89">Package manager developers as well as the largest community to do what we can to make</span> <span data-start="553.89" data-end="555.04">the most of this, right?</span> <span data-start="555.04" data-end="560.79">I of course have my own ideas about this, and I kind of hinted what that was already.</span> <span data-start="560.79" data-end="565.319">What I think we should do at this point is move package management itself directly into</span> <span data-start="565.319" data-end="569.05">the run time instead of an external utility.</span> <span data-start="569.05" data-end="573.899">That is what tink is really about in the end, but what does this mean, and what can we actually</span> <span data-start="573.899" data-end="576.389">do it once we've done that?</span> </p>
<p><span data-start="576.389" data-end="578.22">So, this is what I'm talking about.</span> <span data-start="578.22" data-end="583.05">You literally stop invoking Node yourself and you use tink instead.</span> <span data-start="583.05" data-end="589.37">It was a subcommand called shell that wraps Node and adds patches to FT to make it work</span> <span data-start="589.37" data-end="590.569">its magic.</span> <span data-start="590.569" data-end="591.97">What magic?</span> <span data-start="591.97" data-end="594.899">Well, virtual Node modules.</span> <span data-start="594.899" data-end="599.14">The big idea is that if we control the run time, we control what happens when someone</span> <span data-start="599.14" data-end="601.769">tries to read from Node modules.</span> <span data-start="601.769" data-end="607.829">And, once we can to that at the run time level, all sorts of things start happening.</span> <span data-start="607.829" data-end="611.17">It means that we can get rid of all these copies of Node modules without changing the</span> <span data-start="611.17" data-end="615.18">module loader, or the expected APIs from packages.</span> <span data-start="615.18" data-end="619.14">As far as any packages are concerned, they're accessing the file system the same way they</span> <span data-start="619.14" data-end="627.209">usually do, and this means it's compatible with little details like __name, reading configuration</span> <span data-start="627.209" data-end="628.44">files, and all of that.</span> <span data-start="628.44" data-end="630.269">It works out of the box.</span> <span data-start="630.269" data-end="634.509">Even Spon works.</span> </p>
<p><span data-start="634.509" data-end="638.58">But if we're not in Node modules, where are the files?</span> <span data-start="638.58" data-end="644.31">Well, instead of copying them, we keep them all in a single global cache like npm does,</span> <span data-start="644.31" data-end="648.149">except we deduplicate every single file at the hash level.</span> <span data-start="648.149" data-end="654.209">That means if you have five versions of the same package, you only ever have new copies</span> <span data-start="654.209" data-end="657.459">for the files that actually changed.</span> <span data-start="657.459" data-end="662.72">Storing by hash can make reads very, very fast for us.</span> <span data-start="662.72" data-end="664.05">We can do more.</span> <span data-start="664.05" data-end="669.199">Since we control the run time, let's automatically fudge dependencies for you, as you need them.</span> <span data-start="669.199" data-end="673.42">Why don't we skip downloading dependencies you're not using in your current work.</span> <span data-start="673.42" data-end="679.389">Tink is able to block on reads that fail from the local cache inline and fetch any packages</span> <span data-start="679.389" data-end="685.569">you haven't downloaded yet.</span> <span data-start="685.569" data-end="690.529">Before you say anything, there's a dash-dash production flag to make sure we're not doing</span> <span data-start="690.529" data-end="693.87">random requests in dependencies in production, et cetera.</span> <span data-start="693.87" data-end="697.68">Of course, this means you don't do npm install any more.</span> </p>
<p><span data-start="697.68" data-end="702.5">You don't do npm install and wait for things ever again.</span> <span data-start="702.5" data-end="706.86">Go for it!</span> <span data-start="706.86" data-end="709.76">[Applause].</span> <span data-start="709.76" data-end="714.089">All you actually do is tink add, tink remove to add or remove individual dependencies and</span> <span data-start="714.089" data-end="716.95">you don't have an install step any more.</span> <span data-start="716.95" data-end="720.72">It gets done automatically by tink as needed.</span> <span data-start="720.72" data-end="725.16">It means if your co-worker pushed something and you pulled it, you just run it, and it</span> <span data-start="725.16" data-end="728.26">just kind of works, and you don't have to worry about it.</span> <span data-start="728.26" data-end="732.04">There's no conflicts to worry about, or new installs.</span> <span data-start="732.04" data-end="737.94">Now, you might be concerned about this, by the way, patching FS self surrounds risky,</span> <span data-start="737.94" data-end="738.94">right?</span> <span data-start="738.94" data-end="740.04">But I'm not worried.</span> <span data-start="740.04" data-end="745.029">This is literally the same approach that Electron has taken and they're successful at it.</span> <span data-start="745.029" data-end="749.19">We can also learn from their journey, so I believe this will work out in the end.</span> <span data-start="749.19" data-end="755.12">In fact, some of the code to do this in tink comes directly from electron, and I modified</span> <span data-start="755.12" data-end="757.079">it further.</span> </p>
<p><span data-start="757.079" data-end="761.939">But wait, there's more.</span> <span data-start="761.939" data-end="768.309">Now that we have run time control, tink has TypeScript, ESM, Wasm and JX support out of</span> <span data-start="768.309" data-end="769.309">the box!</span> <span data-start="769.309" data-end="772.47">Yes, 63 per cent!</span> <span data-start="772.47" data-end="774.329">Are you kidding me!</span> <span data-start="774.329" data-end="776.88">How did you all multiply?</span> <span data-start="776.88" data-end="779.86">40 per cent last year.</span> <span data-start="779.86" data-end="785.37">It also runs a very cheap check sum on every single file it loads from the global cache,</span> <span data-start="785.37" data-end="789.459">so you know that, what you're getting out of the cache, what you're getting into your</span> <span data-start="789.459" data-end="794.449">node is passing a checksum for every single load.</span> </p>
<p><span data-start="794.449" data-end="795.79">Which is fantastic.</span> <span data-start="795.79" data-end="797.16">It's super secure.</span> <span data-start="797.16" data-end="801.99">If it turns out you ran the tink show if there is a missing dependency, and if a single file</span> <span data-start="801.99" data-end="806.579">was corrupted in your cache, even, tink will just download and install it for you and fix</span> <span data-start="806.579" data-end="809.649">your dependencies automatically.</span> <span data-start="809.649" data-end="813.38">You can turn this behaviour off in production, but when you're developing, it's super handy.</span> <span data-start="813.38" data-end="818.54">Finally, my favourite part: all of this comes out of the box without the need to configure</span> <span data-start="818.54" data-end="822.009">or install anything besides tink itself.</span> <span data-start="822.009" data-end="824">And I want to emphasise this.</span> <span data-start="824" data-end="827.959">All of this comes without the need for any sort of loader.</span> <span data-start="827.959" data-end="832.88">Webpack, it works.</span> <span data-start="832.88" data-end="836.339">All of this without any kind of loader or extra flag, or anything.</span> <span data-start="836.339" data-end="840.759">You install and run things with tink, and that's all you need to do.</span> <span data-start="840.759" data-end="846.329">Now, let's do a brief tour of the tool itself to give you an idea what I'm actually talking</span> <span data-start="846.329" data-end="849.019">about.</span> <span data-start="849.019" data-end="852.67">This year is the — this is the core feature of the entire tool, just about everything</span> </p>
<p><span data-start="852.67" data-end="856.74">I've talked about so far is available through this one command.</span> <span data-start="856.74" data-end="859.829">You don't need to do npm install any more.</span> <span data-start="859.829" data-end="867.089">All you need to do is run tink shell.</span> <span data-start="867.089" data-end="872.459">This works in the interactive shell and it blocks and awaits for things, and you fetch</span> <span data-start="872.459" data-end="875.47">the dependencies, and it kind of goes.</span> <span data-start="875.47" data-end="879.709">I know I talked about performance a lot before, but a really strong guiding light for me when</span> <span data-start="879.709" data-end="885.23">working on npm and tink has been the idea of simplifying work throws.</span> <span data-start="885.23" data-end="891.499">I want you to have to install and remember as little as possible in order to be productive.</span> <span data-start="891.499" data-end="896.18">I know that's a big problem in JavaScript these days where you install, feels like you</span> <span data-start="896.18" data-end="899.44">install half of npm just to get started.</span> <span data-start="899.44" data-end="903.899">The ability just to start running and having the run time take care of this is super important</span> <span data-start="903.899" data-end="906.089">for me in order to achieve the work flow.</span> <span data-start="906.089" data-end="910.3">I think y' all should have in your day-to-day.</span> <span data-start="910.3" data-end="914.519">I want the package manager to disappear and not be something that you have to think about.</span> <span data-start="914.519" data-end="917.879">That's very important.</span> </p>
<p><span data-start="917.879" data-end="920.589">How many of you are familiar with NPX here?</span> <span data-start="920.589" data-end="922.98">Show of hands.</span> <span data-start="922.98" data-end="923.98">Go!</span> <span data-start="923.98" data-end="926.67">Tink accepts NPX.</span> </p>
<p><span data-start="926.67" data-end="935.54">For the rest of you who don't know NPX is, it's a tool that is bundled within npm itself,</span> <span data-start="935.54" data-end="941.88">and one of the things it lets you do is execute local binaries as well as temporary installations.</span> <span data-start="941.88" data-end="950.959">For example, if you install Jest as a dependency, you can use npm Jest without installing it</span> <span data-start="950.959" data-end="952.04">globally.</span> <span data-start="952.04" data-end="957.72">You don't need to configure a run script for it.</span> <span data-start="957.72" data-end="963.1">Running your local bins through tink exec means we can apply the same logic to preinstall</span> <span data-start="963.1" data-end="969.56">anything necessary for your binary that tink shell does for scripts.</span> <span data-start="969.56" data-end="974.209">But what if you don't want to slow down your app with package management stuff?</span> <span data-start="974.209" data-end="979.079">This command goes ahead and does the cache warming beforehand and runs on installs, binaries,</span> <span data-start="979.079" data-end="981.089">and the likes for you.</span> <span data-start="981.089" data-end="986.069">When you run tink shell, it works as fast as when you, as if you did an npm install</span> <span data-start="986.069" data-end="987.85">or something beforehand.</span> <span data-start="987.85" data-end="993.889">You could argue that it the npm install of tink, but it's an optional step and night</span> <span data-start="993.889" data-end="998.61">not speed things up at all, or might make absolute time pass slower.</span> </p>
<p><span data-start="998.61" data-end="1003.249">On CI, you may as well take the run time hit of fetching dependencies.</span> <span data-start="1003.249" data-end="1007.49">But, what if you want to have an actual node module anyway?</span> <span data-start="1007.49" data-end="1013.79">What if you want to inspect and use other tools or your editor which doesn't understand</span> <span data-start="1013.79" data-end="1015.25">tink yet or whatever?</span> <span data-start="1015.25" data-end="1020.309">In this case, there is a command called Unwind which does a full extraction to node module</span> <span data-start="1020.309" data-end="1025.439">so you can use your editor, non-build tools, pretty much anything in the usual way.</span> <span data-start="1025.439" data-end="1030.959">This is an in my install but a slight difference I will go into next.</span> <span data-start="1030.959" data-end="1041.82">What if you want to debug a specific dependency?</span> <span data-start="1041.82" data-end="1045.19">That will let you patch thing however you want, debug it, et cetera.</span> <span data-start="1045.19" data-end="1047.58">This is what I want to emphasise.</span> <span data-start="1047.58" data-end="1052.95">Because of the way tink works anything inside node modules itself takes precedence over</span> <span data-start="1052.95" data-end="1055.38">the virtual version.</span> <span data-start="1055.38" data-end="1062.55">If you use FS .right file tink will create a physical file for you in node modules which</span> <span data-start="1062.55" data-end="1066.53">helps immensely with compatibility.</span> </p>
<p><span data-start="1066.53" data-end="1067.93">That will just work.</span> <span data-start="1067.93" data-end="1069.59">We will put a file there for you.</span> <span data-start="1069.59" data-end="1071.36">Don't worry too much about it.</span> <span data-start="1071.36" data-end="1072.36">No.</span> <span data-start="1072.36" data-end="1076.25">This command is is also done automatically at the individual package level for any dependencies</span> <span data-start="1076.25" data-end="1084.02">that use install scripts to preserve compatibility because, you know, it doesn't understand Node</span> <span data-start="1084.02" data-end="1088.35">itself but it's very few extractions.</span> </p>
<p><span data-start="1088.35" data-end="1093.66">So, since the closest thing to npm install only builds existing dependencies, how do</span> <span data-start="1093.66" data-end="1098.09">we add and build dependencies?</span> <span data-start="1098.09" data-end="1100.69">The classic trio, add, remove, and update.</span> <span data-start="1100.69" data-end="1101.69">Great, fancy.</span> <span data-start="1101.69" data-end="1109.41">They do basically what is says on the tin.</span> <span data-start="1109.41" data-end="1114.44">By the way, all three of the these become fully interactive if you give them no arguments.</span> <span data-start="1114.44" data-end="1118.11">That means you'll be able to search interactively for new dependencies and pick them from a</span> <span data-start="1118.11" data-end="1121.24">menu for removing and updating.</span> <span data-start="1121.24" data-end="1124.19">Yeah, that's epic.</span> <span data-start="1124.19" data-end="1125.19">Yeah!</span> <span data-start="1125.19" data-end="1127.14">Interactive menus!</span> <span data-start="1127.14" data-end="1128.14">[Applause].</span> <span data-start="1128.14" data-end="1130.09">Very exciting!</span> <span data-start="1130.09" data-end="1133.89">So, the last command I'm going to introduce this is tink check utility.</span> </p>
<p><span data-start="1133.89" data-end="1138.75">The really cool thing about this is it's a one-stop shop for all your verification and</span> <span data-start="1138.75" data-end="1139.75">testing.</span> <span data-start="1139.75" data-end="1144.03">The most noteworthy thing here is that it's going to run your type check out of the box</span> <span data-start="1144.03" data-end="1147.68">without needing to install TypeScript.</span> <span data-start="1147.68" data-end="1151.86">If you do install it as a dev dependency, or use that version of it, it will still run</span> <span data-start="1151.86" data-end="1154.4">it for you.</span> <span data-start="1154.4" data-end="1160.21">But isn't it nice to be able to go into a project and type-check the TypeScript out</span> <span data-start="1160.21" data-end="1162.64">of the box?</span> <span data-start="1162.64" data-end="1163.64">It's really nice.</span> </p>
<p><span data-start="1163.64" data-end="1164.64">Lint it.</span> <span data-start="1164.64" data-end="1165.64">It's really nice.</span> <span data-start="1165.64" data-end="1171.48">At this point some might wonder if I've been doing too much Rust and cargoes lately.</span> <span data-start="1171.48" data-end="1172.48">Rust is great.</span> <span data-start="1172.48" data-end="1176">Where do he would go from here?</span> <span data-start="1176" data-end="1181.51">First, we have to wrap up the prototype because that's all it is right now, a proof-of-consent.</span> <span data-start="1181.51" data-end="1183.72">That should happen soon enough.</span> <span data-start="1183.72" data-end="1188.65">We want to build an own RFC-based team which builds more outside contributors than we usually</span> <span data-start="1188.65" data-end="1191.08">had.</span> <span data-start="1191.08" data-end="1196.01">This will allow us to hash out tink and take it where it needs to go together.</span> <span data-start="1196.01" data-end="1200.78">The RFC process will ensure there's a community-based approach to growth and development which means</span> <span data-start="1200.78" data-end="1203.06">you can make a difference by participating.</span> <span data-start="1203.06" data-end="1208.76">Once that is all set, we are turning tink into npm 8.</span> <span data-start="1208.76" data-end="1212.87">That means that in the future, when you upgrade Node, what used to be called tink will be</span> <span data-start="1212.87" data-end="1217.4">available out of the box as npm, just like current versions of npm are.</span> <span data-start="1217.4" data-end="1219.36">You can still use it as you usually do.</span> </p>
<p><span data-start="1219.36" data-end="1224.98">If you want to opt into this new work flow, the tool will be there for you.</span> <span data-start="1224.98" data-end="1229.73">It will also integrate with MPX meaning your NPX commands will run faster.</span> <span data-start="1229.73" data-end="1239.69">Once npm 8 is shipped, it is a matter of integrating it into Node itself, and I look forward to</span> <span data-start="1239.69" data-end="1242.32">working with the folks over there to make this happen.</span> <span data-start="1242.32" data-end="1251.97">I know it's a big step to be, like, hacking FS itself, but I'm sheer we can make it happen.</span> <span data-start="1251.97" data-end="1262.3">Anyway, there's one more thing: we are planning to release at some point in the future a new</span> <span data-start="1262.3" data-end="1266.4">pack age fetch in API in the main npm registry.</span> <span data-start="1266.4" data-end="1270.62">This is exciting because combined with tink or something similar, there's a good number</span> <span data-start="1270.62" data-end="1274.44">of advantages, and this is where the exciting stuff is starts happening.</span> <span data-start="1274.44" data-end="1277.06">To give you an idea, this is where it should be great.</span> <span data-start="1277.06" data-end="1278.83">The actual API is fairly small.</span> <span data-start="1278.83" data-end="1282.809">It's a couple of new end points that allows us to list files available in the package,</span> <span data-start="1282.809" data-end="1288.92">and to fetch those individually by kind of like unpackage, right?</span> </p>
<p><span data-start="1288.92" data-end="1290.77">What do we get from this?</span> <span data-start="1290.77" data-end="1296.14">For one, some analysis and estimates that it could involve 40 per cent reduction in</span> <span data-start="1296.14" data-end="1299.15">data transfer.</span> <span data-start="1299.15" data-end="1303.61">That means your installs get done way faster.</span> <span data-start="1303.61" data-end="1307.52">If you're on a connection slower than fibre, you will have less to wait for.</span> <span data-start="1307.52" data-end="1312.05">You might actually finish your npm install before the heat Liberals the universe.</span> <span data-start="1312.05" data-end="1317.89">It means you will store less stuff on your system, you don't need to download readmes,</span> <span data-start="1317.89" data-end="1320.42">test code, anything like that.</span> <span data-start="1320.42" data-end="1323.64">You only download the files you actually use.</span> <span data-start="1323.64" data-end="1330.17">This reduction is achieved by having tink shell fetch files lazily.</span> <span data-start="1330.17" data-end="1332.44">And then we cache it really aggressively.</span> <span data-start="1332.44" data-end="1335.26">This is one of the most exciting reasons to do tink for me.</span> <span data-start="1335.26" data-end="1338.14">Finally, this one is interesting.</span> <span data-start="1338.14" data-end="1340.81">Doing things like this has the potential to — hello?</span> <span data-start="1340.81" data-end="1350.32">Has the potential to completely change how mono-based repo libraries work.</span> </p>
<p><span data-start="1350.32" data-end="1358.31">As you probably already know, these libraries involve a lot of sub tools, literally 147</span> <span data-start="1358.31" data-end="1360.81">packages in the Babel mono repo.</span> <span data-start="1360.81" data-end="1367.04">They published this under the scope so folks don't have to depend on the entire thing.</span> <span data-start="1367.04" data-end="1373.06">You don't want the entirety of Babel.</span> <span data-start="1373.06" data-end="1375.01">Now, this can cause a lot of problems.</span> <span data-start="1375.01" data-end="1379.5">For example, users can have issues keeping all packages in sync if they depend on each</span> <span data-start="1379.5" data-end="1384.51">other in some way been on the publisher side, this is a really fragile set-up because it</span> <span data-start="1384.51" data-end="1390.33">makes hair publisher process to subject to time-outs and they need to make sure that's</span> <span data-start="1390.33" data-end="1393.85">correct start the entire publish process where it failed.</span> </p>
<p><span data-start="1393.85" data-end="1395.73">It just gets nasty.</span> <span data-start="1395.73" data-end="1401.09">So, all of these tiny packages have to be released at the same time, usually with the</span> <span data-start="1401.09" data-end="1405.7">tame version, and then you have to deal with the registry being eventually consistent,</span> <span data-start="1405.7" data-end="1410.01">so not all package versions might be available when your user starts selling them, and there</span> <span data-start="1410.01" data-end="1415.68">is chaos everywhere, it's awful, and npm starts erroring on you.</span> <span data-start="1415.68" data-end="1419.34">With tink, this won't be necessary any more.</span> </p>
<p><span data-start="1419.34" data-end="1426.89">Low dash and Babel will be able to publish a single omnibus package.</span> <span data-start="1426.89" data-end="1432.99">It only fetches the sub packages you're using from within the big package.</span> <span data-start="1432.99" data-end="1440.43">Everyone wins, and you only have to have one low dash or babel item in your JSON.</span> <span data-start="1440.43" data-end="1441.43">That's that.</span> <span data-start="1441.43" data-end="1444.82">Like I said, this isn't in progress yet but something we're planning on doing because</span> <span data-start="1444.82" data-end="1446.94">the advantages are really clear to us all round.</span> <span data-start="1446.94" data-end="1449.89">I hope you enjoy it when it does happen.</span> <span data-start="1449.89" data-end="1454.77">In conclusion, tink is exciting, and also, it's kind of a work in progress.</span> <span data-start="1454.77" data-end="1459.08">I'm sorry if you try and download it and it explodes in your face.</span> <span data-start="1459.08" data-end="1462.51">Keep away from flammable things!</span> <span data-start="1462.51" data-end="1466.47">It works by having a virtual node modules that becomes your new run time.</span> <span data-start="1466.47" data-end="1471.43">It has TypeScript, ESM, JSX and Wasm support out of the box.</span> <span data-start="1471.43" data-end="1477.59">It will be known as npm 8 when released, and we will have a new unpackaged registry-style</span> <span data-start="1477.59" data-end="1480.38">API in the future.</span> </p>
<p><span data-start="1480.38" data-end="1482.47">Go to us.</span> <span data-start="1482.47" data-end="1486.11">You can go to development.</span> <span data-start="1486.11" data-end="1489.53">You can check out the repo on GitHub.</span> <span data-start="1489.53" data-end="1490.72">Thank you.</span> </p>
</section>