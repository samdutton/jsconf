<section>
<p><span data-start="15.96" data-end="18.09">so I work on I worked on v8 and I now</span> <span data-start="18.09" data-end="20.58">work on the dart VM and but this is not</span> <span data-start="20.58" data-end="23.79">why I'm here today and I'm going to talk</span> <span data-start="23.79" data-end="25.17">about something completely different</span> <span data-start="25.17" data-end="27.21">though related basically I'm going to</span> <span data-start="27.21" data-end="29.7">talk to you about how you take your hand</span> <span data-start="29.7" data-end="31.59">and you stick it into the guts of the VM</span> <span data-start="31.59" data-end="34.379">where all these sharp things move around</span> <span data-start="34.379" data-end="37.43">and you get it back and scattered and</span> <span data-start="37.43" data-end="39.57">another thing I'm going to talk about</span> <span data-start="39.57" data-end="43.02">today is a very basic thing that all of</span> <span data-start="43.02" data-end="45.87">us desire desire as strongly as we all</span> <span data-start="45.87" data-end="48.21">desire lunch that is going to be after</span> <span data-start="48.21" data-end="53.489">my talk and this thing is toys and some</span> <span data-start="53.489" data-end="55.739">people call would call things that I</span> <span data-start="55.739" data-end="58.739">showed you today prototypes mock-ups</span> <span data-start="58.739" data-end="61.92">mashups experiments but I am calling</span> <span data-start="61.92" data-end="64.14">them just toys because that's</span> <span data-start="64.14" data-end="65.339">essentially what I'm having I'm having</span> <span data-start="65.339" data-end="68.25">some fun and I hope people will have</span> <span data-start="68.25" data-end="69.81">some fun with them and they will learn</span> <span data-start="69.81" data-end="72.21">something because that's how you learn</span> <span data-start="72.21" data-end="76.5">things you play with them and I have</span> <span data-start="76.5" data-end="79.53">been giving quite a number of talks</span> <span data-start="79.53" data-end="82.89">about performance and v8 performance</span> <span data-start="82.89" data-end="84.78">especially and they are all pretty</span> <span data-start="84.78" data-end="86.52">boring they're all like oh like that</span> <span data-start="86.52" data-end="91.02">they go and go and can anybody guess the</span> <span data-start="91.02" data-end="94.979">last line no it's a speculative</span> <span data-start="94.979" data-end="99.27">optimizations obviously so and the most</span> <span data-start="99.27" data-end="101.58">amazing thing about such talks is that</span> <span data-start="101.58" data-end="103.17">people come home and then they heard</span> <span data-start="103.17" data-end="105.18">about inline caches and they try to see</span> <span data-start="105.18" data-end="106.92">what inline caches do to their programs</span> <span data-start="106.92" data-end="109.799">and sorry can't do that you can see</span> <span data-start="109.799" data-end="111.689">they're like pixie dust that makes</span> <span data-start="111.689" data-end="113.25">everything fly with the speed of light</span> <span data-start="113.25" data-end="117">but nobody can see it that's a bit</span> <span data-start="117" data-end="118.65">annoying it's it's annoying for people</span> <span data-start="118.65" data-end="121.77">and gets me very frustrated so I really</span> <span data-start="121.77" data-end="125.4">wanted to show people how like vm works</span> <span data-start="125.4" data-end="127.47">and how it optimizes things and let them</span> <span data-start="127.47" data-end="132.209">observe and when I approach it I have</span> <span data-start="132.209" data-end="134.97">this principle everybody knows letting</span> <span data-start="134.97" data-end="136.95">obviously if you translate it from</span> <span data-start="136.95" data-end="140.01">legend to a current modern language</span> <span data-start="140.01" data-end="141.93">which is English obviously is that if</span> <span data-start="141.93" data-end="144.03">you are working on some VM for language</span> </p>
<p><span data-start="144.03" data-end="146.22">X Y that try to do everything for this</span> <span data-start="146.22" data-end="147.239">VM in X why's that</span> <span data-start="147.239" data-end="149.31">that's a lot of fun</span> <span data-start="149.31" data-end="151.59">and because I follow this principle</span> <span data-start="151.59" data-end="153.54">everywhere where I go like I worked on</span> <span data-start="153.54" data-end="155.52">the Java VM I tried to do stuff in Java</span> <span data-start="155.52" data-end="157.89">I worked on the ADA tried to do more</span> <span data-start="157.89" data-end="160.62">things in JavaScript I work on Dart</span> </p>
<p><span data-start="160.62" data-end="162.84">I try to do most things in dart so I I</span> <span data-start="162.84" data-end="167.069">get some beating for that I think and so</span> <span data-start="167.069" data-end="169.53">I came up with a plan a the very first</span> <span data-start="169.53" data-end="171.63">plan that I had and there was also a</span> <span data-start="171.63" data-end="173.79">little bit in to note at that point so I</span> <span data-start="173.79" data-end="175.98">just took v8 modified it a little bit</span> <span data-start="175.98" data-end="178.68">then I took no GS then I connected them</span> <span data-start="178.68" data-end="181.5">together and let v8 stream data to know</span> </p>
<p><span data-start="181.5" data-end="183.09">GS and then I connected node.js to the</span> <span data-start="183.09" data-end="184.56">browser through a WebSockets</span> <span data-start="184.56" data-end="186.9">oh my god that feels enterprise-e that's</span> <span data-start="186.9" data-end="188.55">what you deploy in the data center to</span> <span data-start="188.55" data-end="189.989">make all these millions of people see</span> <span data-start="189.989" data-end="192.9">what we ate does and if you stop and</span> <span data-start="192.9" data-end="194.25">think for a moment they're like 3d</span> <span data-start="194.25" data-end="196.62">eights there at least which is like two</span> </p>
<p><span data-start="196.62" data-end="199.92">Vav eights too many for this problem so</span> <span data-start="199.92" data-end="201.54">the plan B is very simple you take one</span> <span data-start="201.54" data-end="203.73">lonely v8 and put it into a duck place</span> <span data-start="203.73" data-end="205.739">into the browser modify it a little bit</span> <span data-start="205.739" data-end="207.209">and let it talk to itself because it's</span> <span data-start="207.209" data-end="210.33">alone and here is what came out of this</span> <span data-start="210.33" data-end="212.97">experiment this is code mirror everybody</span> <span data-start="212.97" data-end="214.2">heard about called mirror I suspect</span> <span data-start="214.2" data-end="216.15">which is a company in to edit code and</span> <span data-start="216.15" data-end="218.22">here it shows its own source these</span> <span data-start="218.22" data-end="219.69">slides are running in the browser it</span> <span data-start="219.69" data-end="222.09">shows its own source and if I press the</span> <span data-start="222.09" data-end="224.81">button here not this button this button</span> <span data-start="224.81" data-end="227.67">then it gets annotated with the state of</span> <span data-start="227.67" data-end="230.79">inline caches inside the code mirror so</span> <span data-start="230.79" data-end="232.65">it's showing its own state essentially</span> <span data-start="232.65" data-end="234.9">the state of the VM on which these</span> <span data-start="234.9" data-end="237.299">slides are running and I can like this</span> <span data-start="237.299" data-end="244.739">green okay let me zoom yeah here can you</span> <span data-start="244.739" data-end="249.48">see it yeah so let me unzoom so this</span> <span data-start="249.48" data-end="251.88">these things here they show like that</span> <span data-start="251.88" data-end="254.7">this function has two versions optimize</span> <span data-start="254.7" data-end="256.41">the non optimized because cold is not</span> <span data-start="256.41" data-end="258.57">optimized and a little bit warmer color</span> <span data-start="258.57" data-end="261.15">is optimized and I can like switch</span> <span data-start="261.15" data-end="263.19">between them like t-this is non</span> <span data-start="263.19" data-end="265.169">optimized version and it has inline</span> <span data-start="265.169" data-end="266.85">cache here which is red and red is bad</span> <span data-start="266.85" data-end="269.46">red is like alarm because it's mega</span> <span data-start="269.46" data-end="271.65">morphic and I can even click here click</span> <span data-start="271.65" data-end="274.59">here click yes and I can see assembly</span> <span data-start="274.59" data-end="278.25">for this stuff which is like the current</span> <span data-start="278.25" data-end="280.44">state and I am using bootstrap because</span> </p>
<p><span data-start="280.44" data-end="283.38">I'm do not do any development in the bra</span> <span data-start="283.38" data-end="284.82">so to show this pop up I use bootstrap</span> <span data-start="284.82" data-end="286.62">oh my god Jesus Christ</span> <span data-start="286.62" data-end="289.23">III don't know what I am doing basically</span> <span data-start="289.23" data-end="293.4">and I can switch to an optimized version</span> <span data-start="293.4" data-end="296.88">and has green here green is good and</span> <span data-start="296.88" data-end="299.1">it's a monomorphic thing it says here</span> <span data-start="299.1" data-end="301.64">store I see monomorphic field here ah</span> <span data-start="301.64" data-end="304.35">yeah so that's cool that's cool</span> <span data-start="304.35" data-end="308.79">okay Andrew how do i zoom it like this</span> <span data-start="308.79" data-end="312.03">yeah so okay cool helps very helpful but</span> <span data-start="312.03" data-end="316.14">it has one problem so oh now we have a</span> <span data-start="316.14" data-end="318.72">trouble let me I need I need to hide</span> <span data-start="318.72" data-end="320.82">this yes and go here oh no don't go here</span> <span data-start="320.82" data-end="323.7">go here yeah thank you so it has a</span> <span data-start="323.7" data-end="325.11">problem so on JavaScript site is pretty</span> <span data-start="325.11" data-end="327.06">easy you expert one function from v8</span> <span data-start="327.06" data-end="328.92">which is called scripts and allows you</span> <span data-start="328.92" data-end="331.53">to like pipe out of it the scripts it</span> <span data-start="331.53" data-end="333.96">knows about and then you can take one</span> <span data-start="333.96" data-end="335.76">script and ask for inline caches that</span> <span data-start="335.76" data-end="338.13">are inside the script and then you its</span> <span data-start="338.13" data-end="339.78">serialized in some form you just realize</span> <span data-start="339.78" data-end="342.23">it and you show it in this editor cool</span> <span data-start="342.23" data-end="346.65">but on the other side like in VV 8 you</span> <span data-start="346.65" data-end="349.17">have a code like that oh my god this is</span> </p>
<p><span data-start="349.17" data-end="352.53">C++ it's horrible and the biggest</span> <span data-start="352.53" data-end="354.54">problem is what it's even C++ I would be</span> <span data-start="354.54" data-end="357.57">upset if it were modular too as well the</span> <span data-start="357.57" data-end="358.89">biggest problem is that if you want to</span> <span data-start="358.89" data-end="361.65">extend it a little bit you have to go</span> <span data-start="361.65" data-end="364.05">this back into v8 and you have to like</span> <span data-start="364.05" data-end="366.54">hack it with a hammer until it gives you</span> <span data-start="366.54" data-end="369">what you need and then you have to</span> <span data-start="369" data-end="371.28">recompile Chrome and on my laptop it</span> <span data-start="371.28" data-end="374.25">like it I can fry the eggs when they</span> <span data-start="374.25" data-end="376.89">recompile Chrome on it so it's a little</span> <span data-start="376.89" data-end="378.36">bit painful it doesn't allow you to</span> <span data-start="378.36" data-end="379.89">iterate on features quickly and</span> <span data-start="379.89" data-end="381.45">everybody tries to iterate a child</span> <span data-start="381.45" data-end="383.16">basically cool</span> <span data-start="383.16" data-end="387.45">so and I always have a plan and this is</span> <span data-start="387.45" data-end="389.64">a plan Z you can you see I tried a</span> <span data-start="389.64" data-end="392.64">little bit different plans I'm not going</span> <span data-start="392.64" data-end="397.35">to tell you all like B and D they failed</span> <span data-start="397.35" data-end="401.28">but this is plan Z it's valid JavaScript</span> <span data-start="401.28" data-end="403.83">so I take JavaScript and I describe how</span> <span data-start="403.83" data-end="406.71">objects invade heap look like and I have</span> <span data-start="406.71" data-end="408.54">this magical function struct which takes</span> <span data-start="408.54" data-end="410.43">the description of the object which is</span> <span data-start="410.43" data-end="412.74">the object object literal basically and</span> <span data-start="412.74" data-end="415.11">it converts it to a function that can</span> <span data-start="415.11" data-end="416.94">visualize is from the binary stream</span> <span data-start="416.94" data-end="419.61">and give you back like all these fields</span> <span data-start="419.61" data-end="421.23">with some like meaningful getters and</span> <span data-start="421.23" data-end="423.69">setters so if you like ask for size it</span> <span data-start="423.69" data-end="425.43">will find it in this binary stream and</span> <span data-start="425.43" data-end="428.28">pick it out of there and I can describe</span> <span data-start="428.28" data-end="430.05">the heap object I make have inheritance</span> <span data-start="430.05" data-end="431.64">of strux because that's how obviate</span> <span data-start="431.64" data-end="433.5">internally represents objects like there</span> <span data-start="433.5" data-end="435.42">is a heaped object in the root of the</span> <span data-start="435.42" data-end="437.43">here are here and then you have like map</span> <span data-start="437.43" data-end="439.37">which is a heap object and you have like</span> <span data-start="439.37" data-end="443.37">sizes and stuff and given all this stuff</span> </p>
<p><span data-start="443.37" data-end="446.22">I apply one hammer and one hammer only</span> <span data-start="446.22" data-end="448.41">on the v8 side well this is another</span> <span data-start="448.41" data-end="450.54">object we have yeah so this is one</span> <span data-start="450.54" data-end="453.33">hammer the function heap which returns</span> <span data-start="453.33" data-end="457.95">you a type to review into v8 heap so you</span> <span data-start="457.95" data-end="460.17">can just ask you give me all pages in</span> <span data-start="460.17" data-end="461.7">the v8 heap and it will give you this</span> <span data-start="461.7" data-end="464.34">huge type arrays which represent v8 heap</span> <span data-start="464.34" data-end="465.75">and you can read out of them these</span> <span data-start="465.75" data-end="467.58">objects use my functions to do sterilize</span> <span data-start="467.58" data-end="469.32">them and inspect them you can like</span> <span data-start="469.32" data-end="471.96">iterate the heap and take all the</span> <span data-start="471.96" data-end="473.97">objects there cool and you don't need to</span> <span data-start="473.97" data-end="476.19">recompile chrome anymore you have one</span> <span data-start="476.19" data-end="478.38">modified Chrome and you try all that you</span> <span data-start="478.38" data-end="480.84">want because everything that we need is</span> <span data-start="480.84" data-end="483.9">in the v8 heap and here is another life</span> <span data-start="483.9" data-end="486.12">thing embedded into a slide this is like</span> <span data-start="486.12" data-end="490.29">the first 32 kilobytes of the code space</span> <span data-start="490.29" data-end="492.48">in the current we it he poo that is</span> <span data-start="492.48" data-end="496.14">underlined for these slides I can like</span> <span data-start="496.14" data-end="498.27">look at this and I exceed this some free</span> <span data-start="498.27" data-end="500.61">space fragmentation a little bit and</span> <span data-start="500.61" data-end="502.74">it's pretty cool and I can even</span> <span data-start="502.74" data-end="504.93">disassemble but now that is assembler I</span> <span data-start="504.93" data-end="506.55">am using I just took some random from</span> <span data-start="506.55" data-end="508.77">the github written in JavaScript it's</span> <span data-start="508.77" data-end="510.96">not a v8 assembler any model can</span> <span data-start="510.96" data-end="512.039">disassemble everything that gate</span> <span data-start="512.039" data-end="514.41">generates it it's not complete somebody</span> <span data-start="514.41" data-end="517.56">was not probably wanted to finish it so</span> <span data-start="517.56" data-end="519.18">it kind of jumble everything but it can</span> <span data-start="519.18" data-end="520.95">be so simple some stuff like here it</span> <span data-start="520.95" data-end="522.12">disassembled set correctly for example</span> <span data-start="522.12" data-end="525.69">and this is great because now I can</span> <span data-start="525.69" data-end="529.32">iterate stuff and try all things I want</span> <span data-start="529.32" data-end="532.32">without recompiling chrome but because</span> <span data-start="532.32" data-end="534.66">it's a typed array view into the v8 heap</span> </p>
<p><span data-start="534.66" data-end="538.68">I can even write there I can write there</span> <span data-start="538.68" data-end="541.35">I can take the first page in the heap</span> <span data-start="541.35" data-end="545.13">and overwrite it with random stuff a lot</span> <span data-start="545.13" data-end="548.19">of fun and if I press this button I will</span> <span data-start="548.19" data-end="550.57">I will die in pain now</span> <span data-start="550.57" data-end="553.12">so you would usually expect I press the</span> <span data-start="553.12" data-end="555.43">button you will usually expect a set tab</span> <span data-start="555.43" data-end="558.64">but I have foreseen this and I'm running</span> <span data-start="558.64" data-end="560.92">in the debugger which unfortunately you</span> <span data-start="560.92" data-end="563.77">cannot see what the hell I need an zoom</span> <span data-start="563.77" data-end="565.36">but I cannot turn zoom okay that's</span> <span data-start="565.36" data-end="571.36">pretty sad isn't it that's that</span> <span data-start="571.36" data-end="576.94">how do ya but this is X germ can you</span> <span data-start="576.94" data-end="578.43">imagine that</span> <span data-start="578.43" data-end="582.64">okay I will be so okay let's do let's be</span> <span data-start="582.64" data-end="586.09">evil let's be evil I have to be evil and</span> </p>
<p><span data-start="586.09" data-end="590.53">I cannot see I haven't see yes yes yes</span> <span data-start="590.53" data-end="596.35">here okay die okay okay here we go</span> <span data-start="596.35" data-end="598.84">fontsize I I selected a quite a big one</span> <span data-start="598.84" data-end="601.06">because I knew that you are going to to</span> <span data-start="601.06" data-end="604.9">want to see it can you see it 30 what do</span> <span data-start="604.9" data-end="612.15">you want to see 44 24 2008 CVI I hate it</span> <span data-start="612.15" data-end="616.6">okay okay let's here we go here we go</span> <span data-start="616.6" data-end="620.64">again yes it is booting up what you know</span> <span data-start="620.64" data-end="624.49">where is my oh and the light is I kind</span> <span data-start="624.49" data-end="632.51">of see with my mouse okay here it comes</span> <span data-start="632.52" data-end="642.06">oh yes yes okay Runyon running here we</span> <span data-start="642.06" data-end="646.17">are again so and I press the button and</span> <span data-start="646.17" data-end="648.899">I go here yes we got this sick trap here</span> <span data-start="648.899" data-end="653.6">and we can like thank you</span> <span data-start="653.6" data-end="656.52">so they strike the instruction pointer</span> <span data-start="656.52" data-end="658.56">is now pointing into the baby so we</span> <span data-start="658.56" data-end="660.57">written stuff everywhere it's awesome</span> <span data-start="660.57" data-end="663.33">and by quickly bike by coincidence the</span> <span data-start="663.33" data-end="665.1">size of the string like hello GS conf</span> <span data-start="665.1" data-end="667.74">new was just enough that if I put in the</span> <span data-start="667.74" data-end="669.33">beginning this in three instruction</span> <span data-start="669.33" data-end="670.89">which is a sick trial because it's a</span> <span data-start="670.89" data-end="673.17">sick trap it precisely execute this</span> <span data-start="673.17" data-end="674.49">instruction so it doesn't crash at</span> <span data-start="674.49" data-end="675.93">random stop it Christ from the sick trap</span> <span data-start="675.93" data-end="683.76">okay so yeah okay yes die no I said die</span> <span data-start="683.76" data-end="687.45">yes so this guy is dead now I'm sorry</span> </p>
<p><span data-start="687.45" data-end="688.97">Jim</span> <span data-start="688.97" data-end="692.399">the bugger is starting again I know and</span> <span data-start="692.399" data-end="694.17">it starting again I know that's how we</span> <span data-start="694.17" data-end="704.339">developed chrome by the way so yeah two</span> <span data-start="704.339" data-end="707.49">tabs prepared for this but because okay</span> <span data-start="707.49" data-end="710.04">so the question is why we still use it</span> <span data-start="710.04" data-end="712.529">in C++ if we can do all this awesome</span> <span data-start="712.529" data-end="714">stuff like overwrite memory with random</span> <span data-start="714" data-end="717.209">stuff and stuff yeah so well I have no</span> <span data-start="717.209" data-end="725.82">idea frankly speaking yeah so yeah so</span> <span data-start="725.82" data-end="727.649">oh and this is a time yeah I had this</span> <span data-start="727.649" data-end="729.72">slight embedded to know how long I have</span> <span data-start="729.72" data-end="731.79">to you can see my transcript skills are</span> <span data-start="731.79" data-end="733.11">also not so good you don't have a zero</span> <span data-start="733.11" data-end="738.42">before one awesome clock yeah so this is</span> <span data-start="738.42" data-end="741.99">another plan which I call no GS and I'm</span> <span data-start="741.99" data-end="745.61">going to open source it this is not a VM</span> <span data-start="745.61" data-end="748.26">this is a basically an experiment I'm</span> <span data-start="748.26" data-end="750.42">trying to do bits of pieces of the VM</span> <span data-start="750.42" data-end="752.16">like for example I brought this blog</span> <span data-start="752.16" data-end="753.779">post about how you would try to</span> <span data-start="753.779" data-end="755.459">implement inline caches in JavaScript</span> <span data-start="755.459" data-end="758.49">and this is all parts of this like</span> <span data-start="758.49" data-end="760.35">hidden class is implemented in pure</span> </p>
<p><span data-start="760.35" data-end="762.72">JavaScript and stuff like that and I'm</span> <span data-start="762.72" data-end="763.829">trying to understand how these things</span> <span data-start="763.829" data-end="765.86">fit together so that</span> <span data-start="765.86" data-end="768.019">in fewer JavaScript it has currently a</span> <span data-start="768.019" data-end="770.089">pure indication of pure educational</span> <span data-start="770.089" data-end="772.76">value both for me and for other people</span> <span data-start="772.76" data-end="777.14">who want to understand how VMs work but</span> <span data-start="777.14" data-end="778.25">for me it has the educational value</span> <span data-start="778.25" data-end="780.47">which is like I want to understand if</span> <span data-start="780.47" data-end="782.51">you can make it work properly to get a</span> <span data-start="782.51" data-end="785.81">really awesome VM at the end but to do</span> <span data-start="785.81" data-end="787.13">that I have to do like bits and pieces</span> <span data-start="787.13" data-end="790.399">separately and here is one of these bits</span> <span data-start="790.399" data-end="792.709">and pieces in addition to like hidden</span> <span data-start="792.709" data-end="794.839">class is inline caches I wrote a tracing</span> <span data-start="794.839" data-end="799.01">cheat for this bytecode and so this is</span> <span data-start="799.01" data-end="801.95">my god so I don't do parsers language is</span> <span data-start="801.95" data-end="803.6">a little bit boring for me because like</span> <span data-start="803.6" data-end="805.579">no they're not boring but I mean you</span> <span data-start="805.579" data-end="807.26">have to defend them and say there are</span> <span data-start="807.26" data-end="809.029">list comprehensions in testing that we</span> <span data-start="809.029" data-end="813.23">all need and all like you do not need</span> <span data-start="813.23" data-end="815.209">this this is not the comprehension</span> <span data-start="815.209" data-end="817.67">you're looking for and I don't like that</span> <span data-start="817.67" data-end="819.079">stuff so I like alright I write code</span> <span data-start="819.079" data-end="820.91">like that and it's pretty awesome I</span> <span data-start="820.91" data-end="825.5">think and so if I press this button I</span> <span data-start="825.5" data-end="827.54">hope nothing will crash but because the</span> <span data-start="827.54" data-end="831.26">dreamer is just JavaScript for now yeah</span> <span data-start="831.26" data-end="836.54">here so so the the numbers below is like</span> <span data-start="836.54" data-end="838.82">70 versus 18 milliseconds 18 is like a</span> <span data-start="838.82" data-end="840.709">pure JavaScript version of the same code</span> <span data-start="840.709" data-end="843.68">which is like generate a list of points</span> <span data-start="843.68" data-end="845.81">and then do a vector sum of this we</span> <span data-start="845.81" data-end="847.52">really like generating points and</span> <span data-start="847.52" data-end="850.31">calculating the sum of them in in the VM</span> <span data-start="850.31" data-end="851.959">guys you have seen the points other</span> <span data-start="851.959" data-end="854.81">stuff and it's a little bit like three</span> <span data-start="854.81" data-end="856.43">times slower but actually on the newer</span> <span data-start="856.43" data-end="860.81">v8 it's like only 1.5 times slower so v8</span> <span data-start="860.81" data-end="864.079">people fix something and so generates</span> <span data-start="864.079" data-end="866.24">this trace and the tracing compilers</span> <span data-start="866.24" data-end="867.829">they like they trace loops and they</span> <span data-start="867.829" data-end="870.079">generate this linear ir and you can see</span> <span data-start="870.079" data-end="872.18">what it did with it like how its turn it</span> <span data-start="872.18" data-end="874.399">into a loop so no Java VM actually uses</span> <span data-start="874.399" data-end="876.529">it right now like tracing G trace monkey</span> <span data-start="876.529" data-end="879.35">a little bit diet now they have a method</span> <span data-start="879.35" data-end="882.47">cheat and this is mostly based on what</span> <span data-start="882.47" data-end="883.85">for example you can see in lower cheat</span> <span data-start="883.85" data-end="886.37">and launch it is written and C so if I</span> <span data-start="886.37" data-end="888.86">go there I like see a lot modular to see</span> <span data-start="888.86" data-end="893.149">hmm but to understand what he does it's</span> <span data-start="893.149" data-end="894.8">the easiest way to do it is like</span> <span data-start="894.8" data-end="896.959">implement everything yourself and I</span> <span data-start="896.959" data-end="898.49">didn't want to do it and see I wanted to</span> <span data-start="898.49" data-end="899.49">do it in</span> <span data-start="899.49" data-end="901.05">our script because other people who can</span> <span data-start="901.05" data-end="903.12">also see and even if you don't know see</span> <span data-start="903.12" data-end="905.339">you can understand and you can see oh</span> <span data-start="905.339" data-end="908.1">you can see the pieces of mac OS you can</span> <span data-start="908.1" data-end="909.6">see they like generate it's a JavaScript</span> <span data-start="909.6" data-end="911.52">function out of these and it has like</span> <span data-start="911.52" data-end="913.86">the optimizations well this is a check</span> <span data-start="913.86" data-end="915.48">and the optimization all the stuff you</span> <span data-start="915.48" data-end="917.73">can see in a normal VM and you can learn</span> <span data-start="917.73" data-end="922.88">from this and but now somebody can say</span> <span data-start="922.88" data-end="926.16">ok this is pretty cool but JavaScript</span> </p>
<p><span data-start="926.16" data-end="927.899">I mean you now go to the kindergarten</span> <span data-start="927.899" data-end="929.88">and in Germany and they generate</span> <span data-start="929.88" data-end="933.38">JavaScript all day long basically and</span> <span data-start="933.38" data-end="937.709">this is not so cool and really I mean</span> <span data-start="937.709" data-end="939.81">you are like 26 years old and you still</span> <span data-start="939.81" data-end="943.529">with this stuff so I thought yeah that's</span> <span data-start="943.529" data-end="944.43">true that's true</span> <span data-start="944.43" data-end="947.52">and let's generate some assembly this is</span> <span data-start="947.52" data-end="950.76">not assembly I'm not going to save it</span> <span data-start="950.76" data-end="953.399">yeah so this is it runs inside node as</span> <span data-start="953.399" data-end="955.92">well yeah ok let me make it smaller</span> <span data-start="955.92" data-end="960.81">smaller unzoom yes so obviously how do</span> <span data-start="960.81" data-end="963.69">you start writing a compiler generates</span> <span data-start="963.69" data-end="965.18">assembly you start like doing like her</span> <span data-start="965.18" data-end="970.26">awesome blah awesome blah yeah here it</span> <span data-start="970.26" data-end="972.75">comes yeah if I start like that we were</span> <span data-start="972.75" data-end="974.37">probably like I would have to change my</span> <span data-start="974.37" data-end="976.649">ticket back to or who's on a little bit</span> <span data-start="976.649" data-end="978.39">later date and you will have to stay in</span> <span data-start="978.39" data-end="981">this bubble for longer time so I'm not</span> <span data-start="981" data-end="984.42">going to do that wait a second wait a</span> <span data-start="984.42" data-end="989.43">second wait for a punchline so and also</span> <span data-start="989.43" data-end="990.75">it's pretty hard to understand if you</span> <span data-start="990.75" data-end="992.79">just coming in and like assembler you</span> <span data-start="992.79" data-end="996.029">need to do like register allocator all</span> <span data-start="996.029" data-end="998.31">this cool stuff but a little bit boring</span> <span data-start="998.31" data-end="999.36">for five minutes</span> <span data-start="999.36" data-end="1001.91">and so I thought about that and I said</span> <span data-start="1001.91" data-end="1004.13">oh wait a second let's tap to the power</span> <span data-start="1004.13" data-end="1008.18">the power and the power we have access</span> <span data-start="1008.18" data-end="1011.45">to is áliveá so I took a lot of iam and</span> </p>
<p><span data-start="1011.45" data-end="1013.37">I bounded to note well strictly speaking</span> <span data-start="1013.37" data-end="1015.709">I took si Lang and I bounded to note and</span> <span data-start="1015.709" data-end="1017.209">then I used that to generate bindings</span> <span data-start="1017.209" data-end="1021.5">for LLVM and then I said okay you these</span> <span data-start="1021.5" data-end="1025.459">bindings are pretty cool but I cannot</span> <span data-start="1025.459" data-end="1027.41">work with like v8 Hiba I saw this all</span> <span data-start="1027.41" data-end="1030.949">exists in v8 keep all these objects and</span> </p>
<p><span data-start="1030.949" data-end="1033.11">I thought maybe I should be very evil</span> <span data-start="1033.11" data-end="1035.809">how about I just stick my hand into v8</span> <span data-start="1035.809" data-end="1037.339">hip and I start messing with objects</span> <span data-start="1037.339" data-end="1040.97">like I want to do it and sir all this</span> <span data-start="1040.97" data-end="1045.23">module based on the LLVM Levin sheet</span> <span data-start="1045.23" data-end="1046.64">because I have only five minutes and</span> <span data-start="1046.64" data-end="1048.47">even despite that I have all the code</span> <span data-start="1048.47" data-end="1050.42">like in snippets in the editor I don't</span> <span data-start="1050.42" data-end="1053.27">want to type it yes so let's let's be</span> <span data-start="1053.27" data-end="1055.54">cheating let's be cheating so we do like</span> <span data-start="1055.54" data-end="1065.5">CD engine awesome</span> <span data-start="1065.5" data-end="1071.45">yes okay yes I want to reload this I was</span> <span data-start="1071.45" data-end="1072.799">very fast to write this code huh how</span> <span data-start="1072.799" data-end="1076.73">about that so so I have this code the</span> <span data-start="1076.73" data-end="1078.77">module called Mel door because it sounds</span> <span data-start="1078.77" data-end="1080.419">very evil and it does very evil stuff</span> </p>
<p><span data-start="1080.419" data-end="1083">Mel dot so what man and I also used</span> <span data-start="1083" data-end="1084.77">wheels because this makes me feel like</span> <span data-start="1084.77" data-end="1088.94">very very evil can you see it actually I</span> <span data-start="1088.94" data-end="1091.97">hope you see so I create this guy called</span> <span data-start="1091.97" data-end="1096.08">Mel door and he can like access directly</span> <span data-start="1096.08" data-end="1098.36">like arguments like in v8 if you ever</span> <span data-start="1098.36" data-end="1100.73">used like nodejs you know this v8 : :</span> <span data-start="1100.73" data-end="1102.47">argument subject and then you need to</span> <span data-start="1102.47" data-end="1104.929">cooperate her son need but it allows you</span> <span data-start="1104.929" data-end="1106.669">just basically go in and stick your hand</span> <span data-start="1106.669" data-end="1109.66">and take whatever you want like a</span> <span data-start="1109.66" data-end="1114.65">democracy and and basically you can see</span> <span data-start="1114.65" data-end="1117.59">so yeah you know the first argument then</span> <span data-start="1117.59" data-end="1119.27">you like take the zeros property of</span> <span data-start="1119.27" data-end="1120.74">wheat and taken elements of this</span> <span data-start="1120.74" data-end="1123.5">property and you take like property with</span> <span data-start="1123.5" data-end="1126.169">number two and you take the pro argument</span> <span data-start="1126.169" data-end="1128.24">with number one and you take elements</span> <span data-start="1128.24" data-end="1130.309">from it and then you create a translator</span> <span data-start="1130.309" data-end="1133.25">a translator sounds little bit evil as</span> <span data-start="1133.25" data-end="1135.47">well and the translator is like the</span> <span data-start="1135.47" data-end="1137.15">generic way to translate their of my</span> <span data-start="1137.15" data-end="1140.059">tracing compiler I R stands for the</span> <span data-start="1140.059" data-end="1141.95">intermediate representation internal</span> <span data-start="1141.95" data-end="1143.45">representation whatever you want it to</span> <span data-start="1143.45" data-end="1145.76">stand for so and it has like a little</span> <span data-start="1145.76" data-end="1147.83">bit of points where you can tweak it and</span> <span data-start="1147.83" data-end="1149.36">translate it to anything like two IR of</span> <span data-start="1149.36" data-end="1151.58">the LLVM for example like need to</span> <span data-start="1151.58" data-end="1154.19">translate like a literal we need to</span> <span data-start="1154.19" data-end="1156.5">translate the constants which are pretty</span> <span data-start="1156.5" data-end="1158.12">simple because meld allows you to do</span> <span data-start="1158.12" data-end="1161.12">that and you need like and the tracing</span> </p>
<p><span data-start="1161.12" data-end="1165.11">Gir is very simple it's like a linear</span> <span data-start="1165.11" data-end="1166.99">sequence of code a preheater for the</span> <span data-start="1166.99" data-end="1168.85">and then you have a loop body and that's</span> <span data-start="1168.85" data-end="1173.56">all no conditions only side exits and so</span> <span data-start="1173.56" data-end="1174.91">to translate the loop it's pretty simple</span> <span data-start="1174.91" data-end="1176.83">just create like another block and you</span> <span data-start="1176.83" data-end="1178.39">enter it and then you need to translate</span> <span data-start="1178.39" data-end="1180.88">five functions and then you need to</span> <span data-start="1180.88" data-end="1182.74">connect the back edge to the loop loop</span> <span data-start="1182.74" data-end="1185.5">is done and that translate function is</span> <span data-start="1185.5" data-end="1187.06">very boring like you take things and you</span> <span data-start="1187.06" data-end="1188.47">translate them let's check something</span> <span data-start="1188.47" data-end="1190.78">simple for example check in is the one</span> <span data-start="1190.78" data-end="1192.34">the checks number and basically ton</span> <span data-start="1192.34" data-end="1194.02">boxes the number so Mel do like gives</span> <span data-start="1194.02" data-end="1196.15">you unbox number which takes a v8 number</span> <span data-start="1196.15" data-end="1198.82">and haba you get the double out of it</span> <span data-start="1198.82" data-end="1202.42">and all I can box 32-bit integer or like</span> <span data-start="1202.42" data-end="1204.76">take this like a pointer to the field</span> <span data-start="1204.76" data-end="1206.56">and stuff like that so it's very very</span> <span data-start="1206.56" data-end="1209.16">straightforward multiply numbers and</span> <span data-start="1209.16" data-end="1212.74">like yeah it allows you to build</span> <span data-start="1212.74" data-end="1214.78">conditionals very simple like you just</span> <span data-start="1214.78" data-end="1218.11">say if not value do these otherwise do</span> <span data-start="1218.11" data-end="1221.74">nothing return so a very basic very</span> <span data-start="1221.74" data-end="1224.14">basic and then you this dollar I wanted</span> <span data-start="1224.14" data-end="1225.67">it to look like jQuery to make it very</span> <span data-start="1225.67" data-end="1229.19">attractive everybody's going to use</span> <span data-start="1229.2" data-end="1231.64">everybody is going to use it yeah and so</span> <span data-start="1231.64" data-end="1233.59">then you ask the evil guy to melt stuff</span> <span data-start="1233.59" data-end="1237.97">meld it now and it is done it is done</span> <span data-start="1237.97" data-end="1241.63">and let's see how it works so here I</span> <span data-start="1241.63" data-end="1245.35">have a node and if I run who is like no</span> </p>
<p><span data-start="1245.35" data-end="1249.46">LLVM it runs like 72 milliseconds</span> <span data-start="1249.46" data-end="1253.08">compute some number if I run with LLVM</span> <span data-start="1253.08" data-end="1255.76">it runs in 32 milliseconds whoo ha</span> <span data-start="1255.76" data-end="1258.25">almost as fast maybe a little bit faster</span> <span data-start="1258.25" data-end="1261.13">than the latest v8 and now somebody who</span> <span data-start="1261.13" data-end="1262.69">can say I think you're cheating because</span> <span data-start="1262.69" data-end="1268.3">you're Russian and some people say that</span> <span data-start="1268.3" data-end="1270.13">actually you will not believe that so</span> <span data-start="1270.13" data-end="1276.22">let's make sure that let's make sure</span> <span data-start="1276.22" data-end="1277.93">that I'm not cheating though you can't</span> <span data-start="1277.93" data-end="1281.86">prove it</span> <span data-start="1281.87" data-end="1284.54">I had a debug break so melted also</span> <span data-start="1284.54" data-end="1285.86">allows you to insert the entry</span> <span data-start="1285.86" data-end="1287.63">instruction directly into the code you</span> </p>
<p><span data-start="1287.63" data-end="1290.24">January so I run like that okay let's</span> <span data-start="1290.24" data-end="1297.71">make it bigger I run it and there is a</span> <span data-start="1297.71" data-end="1302.09">sick trap and I can disassemble from</span> <span data-start="1302.09" data-end="1303.32">here sorry</span> <span data-start="1303.32" data-end="1305.63">not zero of course cannot access so this</span> <span data-start="1305.63" data-end="1307.25">is the code which Mehldau generated for</span> <span data-start="1307.25" data-end="1309.11">off function written in this bytecode</span> <span data-start="1309.11" data-end="1310.88">traced through my compiler and then</span> <span data-start="1310.88" data-end="1312.98">compiles through LLVM and they transform</span> <span data-start="1312.98" data-end="1314.45">the node so you can actually use it for</span> <span data-start="1314.45" data-end="1317.54">doing some useful stuff maybe thank you</span> <span data-start="1317.54" data-end="1320.15">that's I think well I'm writing on time</span> <span data-start="1320.15" data-end="1325.88">anyways yes so yeah so the slowdown is</span> <span data-start="1325.88" data-end="1327.86">mostly because v8 I use intentionally a</span> <span data-start="1327.86" data-end="1330.08">non efficient representation compared to</span> <span data-start="1330.08" data-end="1331.73">the a too many in directions does not</span> <span data-start="1331.73" data-end="1334.28">matter okay and of course in the limit I</span> <span data-start="1334.28" data-end="1336.29">wanted to become a real VM as I said I</span> <span data-start="1336.29" data-end="1339.62">like mathematics as well so there is</span> <span data-start="1339.62" data-end="1341.51">also some stuff can you spot a bark I</span> <span data-start="1341.51" data-end="1344.72">hope you cannot draw so this is the plan</span> </p>
<p><span data-start="1344.72" data-end="1347.27">Omega it doesn't matter what the plan is</span> <span data-start="1347.27" data-end="1349.94">it doesn't help to understand VMs thank</span> <span data-start="1349.94" data-end="1363.71">you</span> <span data-start="1363.72" data-end="1366.79">now you can ask some questions but I</span> <span data-start="1366.79" data-end="1371.74">will not answer you can just skip lunch</span> <span data-start="1371.74" data-end="1374.62">hey I just I just looked in NPM and I</span> <span data-start="1374.62" data-end="1378.93">don't see meld oh yeah</span> <span data-start="1378.94" data-end="1380.86">I will publish yeah I hope I will</span> <span data-start="1380.86" data-end="1382.96">publish today yeah everything will be</span> <span data-start="1382.96" data-end="1387.13">open source here someday when I'm 70</span> <span data-start="1387.13" data-end="1390.37">years old so instead of executing it in</span> <span data-start="1390.37" data-end="1394.18">the sea level in in via NVH which is get</span> <span data-start="1394.18" data-end="1396.07">a source and then write an interpreter</span> <span data-start="1396.07" data-end="1399.91">for the assembly basically run v8 on its</span> <span data-start="1399.91" data-end="1402.88">own code that gets executed in v8 again</span> <span data-start="1402.88" data-end="1410.5">with this isn't it what it does every it</span> <span data-start="1410.5" data-end="1416.08">runs v8 on the codes yeah and then this</span> <span data-start="1416.08" data-end="1418.57">kind of thing yeah sure everything</span> <span data-start="1418.57" data-end="1419.56">supposed to I didn't understand the</span> <span data-start="1419.56" data-end="1420.64">question but I think everything is</span> <span data-start="1420.64" data-end="1429.68">possible</span> </p>
</section>