<section>
<p><span data-start="13.23" data-end="19.44">Being the last one on the last day of the presentation in the Side Track.</span> <span data-start="19.44" data-end="24.41">I'm impressed that there are still people here that are not sleeping.</span> <span data-start="24.41" data-end="31.04">It's professionally what we call this slot the twilight zone.</span> <span data-start="31.04" data-end="38.25">And I know that you guys are tired after two days of conferencing and learning and JavaScripting.</span> <span data-start="38.25" data-end="43.29">So, I hope that this talk is going to be a little fun for you.</span> <span data-start="43.29" data-end="48.25">That said, you know, like I've added a few jokes here and there.</span> <span data-start="48.25" data-end="52.68">But my wife tells me that my dad jokes are absolutely terrible.</span> <span data-start="52.68" data-end="57.2">So, we'll see how that works out for you guys.</span> <span data-start="57.2" data-end="58.2">Nobody laughs.</span> <span data-start="58.2" data-end="60.309">That's a good start.</span> </p>
<p><span data-start="60.309" data-end="62.1">Hi.</span> <span data-start="62.1" data-end="64.921">My name is Pier.</span> <span data-start="64.921" data-end="74.36">You might remember me from such amazing projects such as: The Java servlet API.</span> <span data-start="74.36" data-end="78.72">The Java API for XML.</span> <span data-start="78.72" data-end="81.81">Java 2 SE 1.5.</span> <span data-start="81.81" data-end="84.47">And a lot more Java goodness.</span> <span data-start="84.47" data-end="90.01">I'm sure right now you're actually wondering whether I am at the right conference here.</span> <span data-start="90.01" data-end="92.57">Well, I am.</span> </p>
<p><span data-start="92.57" data-end="96.97">You see, like a few years back when I was living in Tokyo, I met this fine gentleman.</span> <span data-start="96.97" data-end="99.59">His name is Jed Schmidt.</span> <span data-start="99.59" data-end="100.979">We were working together.</span> <span data-start="100.979" data-end="105.92">And he's one of the creators of, for example, Brooklyn Jazz.</span> <span data-start="105.92" data-end="108.52">Quite a famous name over there.</span> <span data-start="108.52" data-end="117.759">And thanks to the beatings of these fine gentlemen I kind of like praise the Lord.</span> <span data-start="117.759" data-end="119.079">I saw the light.</span> <span data-start="119.079" data-end="124.869">I abandoned the dark side.</span> <span data-start="124.869" data-end="127.82">And converted to this wonderful world of Node.js.</span> <span data-start="127.82" data-end="135.65">Let me tell you, life since then has been all ponies and rainbows.</span> <span data-start="135.65" data-end="138.269">But I want to point out one thing.</span> <span data-start="138.269" data-end="140.59">I know that I'm gonna anger some of you here.</span> </p>
<p><span data-start="140.59" data-end="143.689">I am not a, you know, like I'm definitely not into Star Wars.</span> <span data-start="143.689" data-end="147.95">I'm more of a Trekkie myself.</span> <span data-start="147.95" data-end="150.65">But enough about me.</span> <span data-start="150.65" data-end="154.819">Let's get into the nitty gritty details of this talk.</span> </p>
<p><span data-start="154.819" data-end="162.67">So, today we're talking about the almighty toilet paper roll.</span> <span data-start="162.67" data-end="168.169">And now I'm sure that you're really wondering, am I at the right conference?</span> <span data-start="168.169" data-end="171.399">How many of you are familiar with this wonderful object?</span> <span data-start="171.399" data-end="175.959">[ Laughter ] I mean, you know, if not this one, we can</span> <span data-start="175.959" data-end="177.14">get the black one.</span> <span data-start="177.14" data-end="178.9">It's so Berlin.</span> <span data-start="178.9" data-end="181.629">You know?</span> <span data-start="181.629" data-end="182.999">Amazing.</span> <span data-start="182.999" data-end="187.22">For your health, I really hope that you had a good use of this today.</span> <span data-start="187.22" data-end="188.92">You know?</span> <span data-start="188.92" data-end="192.769">But what about JavaScript?</span> <span data-start="192.769" data-end="194.569">And toilet paper?</span> <span data-start="194.569" data-end="197.079">Well, let's take a step back.</span> <span data-start="197.079" data-end="204.499">You see, a couple of years back I took a job at a company called Korber, a big giant in</span> <span data-start="204.499" data-end="208.37">industrial manufacturing in Germany.</span> </p>
<p><span data-start="208.37" data-end="211.939">They are one of the largest manufacturers of industrial machines.</span> <span data-start="211.939" data-end="219.389">Including, amongst a thousand other things, tobacco machines, palletizing equipment, we</span> <span data-start="219.389" data-end="224.959">actually do produce machines that produce toilet paper and kitchen rolls.</span> <span data-start="224.959" data-end="227.48">I am embedded with their digital lab.</span> <span data-start="227.48" data-end="229.43">Korber Digital.</span> <span data-start="229.43" data-end="237.659">And we develop digital applications for our customers, right?</span> <span data-start="237.659" data-end="244.409">More specifically, I am in a team that develops this wonderful app.</span> <span data-start="244.409" data-end="247.01">What we're building is called K Edge.</span> <span data-start="247.01" data-end="254.349">K Edge is an app that has been designed to offer shift support in for the operators of</span> <span data-start="254.349" data-end="257.079">toilet paper machines, right?</span> </p>
<p><span data-start="257.079" data-end="262.81">On KEdge, as you can see there, like, you know, operators of operators of these machines</span> <span data-start="262.81" data-end="267.62">can actually see their production stats like how many logs they have produced, the average</span> <span data-start="267.62" data-end="271.729">speed at which the machine is running, downtimes and whatnot.</span> <span data-start="271.729" data-end="274.08">They can see the telemetry from the machine itself.</span> <span data-start="274.08" data-end="276.61">You can see actually the graph over there.</span> <span data-start="276.61" data-end="282.09">We take that graph, we analyze the speed, we create yellow segments or red segments.</span> <span data-start="282.09" data-end="286.65">Yellow segments are reduced productivity so that when we are below that green line you</span> <span data-start="286.65" data-end="287.979">see over there.</span> </p>
<p><span data-start="287.979" data-end="290.819">And the red segments is when the machine is actually stopped.</span> <span data-start="290.819" data-end="297.06">So, what happens, the operator at that point has the ability to create a digital report</span> <span data-start="297.06" data-end="299.61">of their shift, right?</span> <span data-start="299.61" data-end="308.28">So, KEdge is deployed as on a tablet that goes alongside the traditional HMI.</span> </p>
<p><span data-start="308.28" data-end="314.099">The HMI is that big computer you see there that controls actually the machine itself.</span> <span data-start="314.099" data-end="321.75">And the operators use the tablet to create a digital journal of their shift.</span> <span data-start="321.75" data-end="327.259">And, you know, replace their old paperbased trail of stuff.</span> <span data-start="327.259" data-end="328.259">Right?</span> <span data-start="328.259" data-end="332.199">So, let's look a little bit about how KEdge is built.</span> </p>
<p><span data-start="332.199" data-end="336.919">So, this is a quick outline of our architecture.</span> <span data-start="336.919" data-end="338.65">The frontend is a React app.</span> <span data-start="338.65" data-end="339.83">So, lots of JavaScript.</span> <span data-start="339.83" data-end="346.229">It's deployed statically on Amazon S3, served through Cloud front and a login will be handled</span> <span data-start="346.229" data-end="349.49">by incognito really soon.</span> <span data-start="349.49" data-end="357.03">And backup communication goes through Redux to a bunch of JavaScript microservices which</span> <span data-start="357.03" data-end="364.36">have been deployed as Amazon Lambda functions and therefore accessible via the AWS gateway.</span> </p>
<p><span data-start="364.36" data-end="367.36">Interesting, isn't it?</span> <span data-start="367.36" data-end="368.36">No.</span> <span data-start="368.36" data-end="369.909">It's 2019.</span> <span data-start="369.909" data-end="373.43">Nobody cares about another god damned React app.</span> <span data-start="373.43" data-end="378.59">You know, if we were to talk about this, you might just as well go out to the beach and</span> <span data-start="378.59" data-end="379.949">catch some sun while you can.</span> </p>
<p><span data-start="379.949" data-end="382.849">You know, enjoy the heat and so on and so forth.</span> <span data-start="382.849" data-end="387.55">And so, what's actually interesting about what we do?</span> <span data-start="387.55" data-end="395.319">Well, to figure that out, we have to see how toilet paper is actually produced, right?</span> <span data-start="395.319" data-end="401.175">So, thanks to the National Geographic, this is how a modern toilet paper factory looks</span> <span data-start="401.175" data-end="402.849">on the inside.</span> <span data-start="402.849" data-end="413.31">This has been shot at one of the biggest producers of toilet paper here in the European market.</span> <span data-start="413.31" data-end="418.029">And you can actually hear how loud this place is.</span> <span data-start="418.029" data-end="422.599">Right? [it's loud] Giant factories, just to make toilet paper.</span> <span data-start="422.599" data-end="427.15">But easier on the ears, let's look a little bit at how our production line is actually</span> <span data-start="427.15" data-end="428.15">configured.</span> <span data-start="428.15" data-end="432.09">This is a pretty machine, one of ours.</span> <span data-start="432.09" data-end="437.75">Wonderful piece of equipment that runs at around 50 kilometers an hour.</span> <span data-start="437.75" data-end="439.74">And how is toilet paper produced?</span> </p>
<p><span data-start="439.74" data-end="446.93">We start from the top left with some giant jumble rolls, we call them.</span> <span data-start="446.93" data-end="450.789">Those are three tons of paper.</span> <span data-start="450.789" data-end="452.96">Oneply paper.</span> <span data-start="452.96" data-end="457.629">To put that into perspective, one of those rolls is enough for at least three of you</span> <span data-start="457.629" data-end="460.61">to make toilet paper for the rest of your life kind of thing.</span> <span data-start="460.61" data-end="462.379">So, pretty big.</span> <span data-start="462.379" data-end="464.569">We unwind those ones, right?</span> <span data-start="464.569" data-end="470.46">And we unwind them one, two, or three or four of them depending if we want one, two, three</span> <span data-start="470.46" data-end="473.059">or fourply toilet paper.</span> <span data-start="473.059" data-end="477.819">After the winders over here, we have what is called the embosser.</span> <span data-start="477.819" data-end="484.449">It basically takes the splice of toilet paper, pushes them together and embosses this nice</span> <span data-start="484.449" data-end="486.259">pattern over here.</span> <span data-start="486.259" data-end="490.31">And in the process, it injects air into the paper.</span> <span data-start="490.31" data-end="495.719">So, it makes it thicker, it makes it fluffier, softer, gentler on your rear end, maybe.</span> <span data-start="495.719" data-end="505.11">And after the paper is embossed, basically what happens is that the cardboard core here</span> <span data-start="505.11" data-end="508.999">gets produced by the machine that you see in the middle over there.</span> </p>
<p><span data-start="508.999" data-end="513.909">The cardboard core slides in and we actually start rewinding the embossed paper around</span> <span data-start="513.909" data-end="518.09">the cardboard core in giant logs.</span> <span data-start="518.09" data-end="521.4">It's like this, but it's 3 meters wrong.</span> <span data-start="521.4" data-end="528.93">Those go into the thing that look like a cage, it's an accumulator, buffering the unwinding</span> <span data-start="528.93" data-end="535.74">part at the top from the cutting and packaging at the rear end of the line.</span> <span data-start="535.74" data-end="539.42">You see at the very top over there, we have a log saw, which basically take this is log</span> <span data-start="539.42" data-end="542.56">and cuts it and makes these things.</span> <span data-start="542.56" data-end="550.19">And then quickly, the at the left no, sorry, at the right of your screen we see the packager.</span> <span data-start="550.19" data-end="556.11">That basically, you know, takes four, eight, 12 toilet paper rolls, puts them together,</span> <span data-start="556.11" data-end="557.25">wraps them around.</span> <span data-start="557.25" data-end="559.52">Nice package at the supermarket.</span> <span data-start="559.52" data-end="562.199">And at the bottom, the palletizer.</span> <span data-start="562.199" data-end="569.21">And they are stacked up and put in a pact and, boom, ready for shipping.</span> <span data-start="569.21" data-end="574.07">But now you will be asking, is all of this controlled with JavaScript?</span> <span data-start="574.07" data-end="576.11">No.</span> </p>
<p><span data-start="576.11" data-end="580.19">Production a production line even the modern production lines are controlled by something</span> <span data-start="580.19" data-end="584.26">called a PLC or programmable logic controller.</span> <span data-start="584.26" data-end="588.3">I like to call them legacy hardware from the last century.</span> <span data-start="588.3" data-end="594.76">This is a last generation Siemens S7 1500, top of the line.</span> <span data-start="594.76" data-end="596.029">Great PLC.</span> <span data-start="596.029" data-end="602.17">There is one little problem with these beasts that they are still programmed using a thing</span> <span data-start="602.17" data-end="605.55">called lather logic.</span> <span data-start="605.55" data-end="607.56">This is an example of a program.</span> <span data-start="607.56" data-end="613.16">But, you know, like in the PLCs themselves, we don't have variables.</span> </p>
<p><span data-start="613.16" data-end="619.18">In most of the PLCs we address variables are their location in the memory.</span> <span data-start="619.18" data-end="622.36">We don't know exactly what's stored here and there.</span> <span data-start="622.36" data-end="624.69">This is definitely not for the faint of heart.</span> <span data-start="624.69" data-end="629.43">Programming one of those things makes COBOL look so 2019.</span> <span data-start="629.43" data-end="630.93">You know?</span> <span data-start="630.93" data-end="635.43">And if it's not bad enough, we actually don't work on these beautiful brand new machines</span> <span data-start="635.43" data-end="636.43">most of the time.</span> <span data-start="636.43" data-end="641.759">We use them on the machines that have been in the field for like 10, 15 years.</span> <span data-start="641.759" data-end="644.63">This is normally how we find a PLC.</span> <span data-start="644.63" data-end="646.1">This is Inga.</span> <span data-start="646.1" data-end="651.31">It's a machine that I had to connect in order to extract data from in order for our application</span> <span data-start="651.31" data-end="653.3">to work correctly, right?</span> </p>
<p><span data-start="653.3" data-end="655.75">And it's a jungle of wire.</span> <span data-start="655.75" data-end="661.45">And how do we extract data from this medieval piece of kit?</span> <span data-start="661.45" data-end="664.64">Well, we add more wires.</span> <span data-start="664.64" data-end="670.17">We add, you know, like more wires and an industrial PC in there which we call the gateway.</span> <span data-start="670.17" data-end="674.67">And the gateway connected on one side to the PLC with the beautiful' they are Internet</span> <span data-start="674.67" data-end="675.67">table.</span> </p>
<p><span data-start="675.67" data-end="684.899">And thanks to our friends at Twilio, we have a dedicated connection that pumps the data</span> <span data-start="684.899" data-end="686.889">down to the cloud, right?</span> <span data-start="686.889" data-end="691.9">And this, the gateway, is where we run all this JavaScript goodness that we wrote.</span> <span data-start="691.9" data-end="695.75">But before we get into the JavaScript part, like I wanted to show you a little bit the</span> <span data-start="695.75" data-end="697.92">connectivity scenario.</span> </p>
<p><span data-start="697.92" data-end="704.399">So, on the left we have the little factory which is our PLC while in the middle the chip</span> <span data-start="704.399" data-end="706.649">is our gateway, running node.</span> <span data-start="706.649" data-end="712.829">And bridges kind of like the time gap between, you know, like the between the last century</span> <span data-start="712.829" data-end="714.139">and now.</span> <span data-start="714.139" data-end="716.819">And obviously we have the cloud.</span> <span data-start="716.819" data-end="720.79">So, the data flow here is interesting.</span> <span data-start="720.79" data-end="727.329">Because being stuck in the past, that PLC does not know anything about encryption, security,</span> <span data-start="727.329" data-end="728.53">not even a password, right?</span> <span data-start="728.53" data-end="733.38">If I can read from a PLC, I can write to it, I can reprogram it, I can do whatever I want</span> <span data-start="733.38" data-end="734.38">with it.</span> </p>
<p><span data-start="734.38" data-end="739.04">And the only thing that I need to do that is an IP address which I can connect to.</span> <span data-start="739.04" data-end="741.26">Now, this is very insecure.</span> <span data-start="741.26" data-end="744.36">That has been used many times in the past.</span> <span data-start="744.36" data-end="751.889">Probably the most famous case is when all the centrifuges in Iran for processing uranium</span> <span data-start="751.889" data-end="760.61">were disabled by malicious code by disabling the PLC that spun up the centrifuges and boom,</span> <span data-start="760.61" data-end="762.41">it's gone.</span> </p>
<p><span data-start="762.41" data-end="766.029">But when we push the data through the include, we want everything to be safe.</span> <span data-start="766.029" data-end="770.82">So, we started looking at the physical boundaries of security.</span> <span data-start="770.82" data-end="775.649">And so, we install our gateway into the cabinet where the PLC is.</span> <span data-start="775.649" data-end="777.48">We only have one cable.</span> <span data-start="777.48" data-end="779.319">Nothing gets in, nothing gets out.</span> <span data-start="779.319" data-end="784.209">Nobody contacts the PLC from outside of the cabinet of the PLC itself, right?</span> <span data-start="784.209" data-end="788.16">And outside when we want to reach through the cloud, you know, like we have a nice secure</span> <span data-start="788.16" data-end="794.5">modern Linuxbased like VPN on top of an LTE link and yada, yada, yada, right?</span> <span data-start="794.5" data-end="801.01">So, we actually implement we actually define a security perimeter around the PLC so that</span> <span data-start="801.01" data-end="803.61">we can protect it from attacks.</span> <span data-start="803.61" data-end="808.35">And we do this by installing the gateway with a PLC itself, right?</span> <span data-start="808.35" data-end="812.44">The gateway itself also serves another bunch of purposes.</span> <span data-start="812.44" data-end="814.88">We want to consolidate data.</span> <span data-start="814.88" data-end="822.829">Because as much as our friends at Twilio advertise their 4G, in most cases factories are, you</span> <span data-start="822.829" data-end="826.12">know, they're not very well in terms of reception.</span> <span data-start="826.12" data-end="830.22">Most of the times we get 2G, 40 kilo bytes a second.</span> </p>
<p><span data-start="830.22" data-end="833.69">That's not quite enough to actually have a full stream of data coming out.</span> <span data-start="833.69" data-end="837.86">We actually do a lot of the data consolidation on the gateway itself.</span> <span data-start="837.86" data-end="841.85">That's why we need the processing power of JavaScript to do that.</span> <span data-start="841.85" data-end="847.259">And so, we send only, for example, the data that changes in the PLC.</span> <span data-start="847.259" data-end="848.94">And we also do a lot of caching.</span> <span data-start="848.94" data-end="854.62">So, we do we cache everything that we read on to the device itself because, well, it's</span> <span data-start="854.62" data-end="855.62">2G.</span> <span data-start="855.62" data-end="860.7">When and, you know, whatever connectivity comes and goes and so on and so forth.</span> <span data-start="860.7" data-end="865.35">In case of connectivity failures, and some hiccup occurs, we can quickly, or as quick</span> <span data-start="865.35" data-end="871.62">as we can, reingest all the data that we've read while that link was down and then continue</span> <span data-start="871.62" data-end="873.35">at normal operation, right?</span> </p>
<p><span data-start="873.35" data-end="880.199">So, we started this thing with a wonderful program by IBM Research that was called Node</span> <span data-start="880.199" data-end="881.199">Read.</span> <span data-start="881.199" data-end="883.6">It's a wonderful tool.</span> <span data-start="883.6" data-end="887.139">It has libraries that allows us to connect to the PLC.</span> <span data-start="887.139" data-end="891.529">And you see here a very easy configuration, every 10 seconds we have the speed, and we</span> <span data-start="891.529" data-end="892.6">have the first alarm.</span> <span data-start="892.6" data-end="894.49">Shift it down to the right.</span> <span data-start="894.49" data-end="897.19">Send it over to Amazon, right?</span> <span data-start="897.19" data-end="898.97">This is great.</span> <span data-start="898.97" data-end="899.97">Nice going.</span> <span data-start="899.97" data-end="901.93">Can do things very quickly.</span> <span data-start="901.93" data-end="907.819">It's all based in JavaScript, and it's amazing, but gets really complicated when we start</span> <span data-start="907.819" data-end="909.97">reading like a bunch of variables.</span> </p>
<p><span data-start="909.97" data-end="913.519">This is actually a real configuration file we had in production when we started reading</span> <span data-start="913.519" data-end="915.759">more valuables to the thing.</span> <span data-start="915.759" data-end="916.759">And it really gets a mess.</span> <span data-start="916.759" data-end="918.55">It becomes like a bunch of wires.</span> </p>
<p><span data-start="918.55" data-end="920.949">You never know who is changing what.</span> <span data-start="920.949" data-end="924.35">We cannot manage these files and so on and so forth.</span> <span data-start="924.35" data-end="928.3">So, a year ago roughly it dawned on me, you know what?</span> <span data-start="928.3" data-end="929.699">We have the technology.</span> <span data-start="929.699" data-end="932.05">We're going to rebuild it.</span> <span data-start="932.05" data-end="935.18">And we came up with a thing that is called the PLC reader.</span> <span data-start="935.18" data-end="941.57">PLC reader is a wonderful little Node.js application that we wrote in order to clean up the mess</span> <span data-start="941.57" data-end="943.56">that was Node Read.</span> <span data-start="943.56" data-end="944.959">JavaScript, why?</span> <span data-start="944.959" data-end="948.48">Because it was built in Node.</span> <span data-start="948.48" data-end="951.66">Continue with Node because we had the reliability over there.</span> <span data-start="951.66" data-end="957.17">But we managed to bring some automation into the world of point and click, right?</span> <span data-start="957.17" data-end="958.43">It does a very simple job.</span> </p>
<p><span data-start="958.43" data-end="962.509">It reads values from various sources, which we call drivers.</span> <span data-start="962.509" data-end="968.259">And processes in various ways through a pipeline of what we call processers.</span> <span data-start="968.259" data-end="969.259">Right?</span> <span data-start="969.259" data-end="972.41">On top of that, it's easily deployed as a Debian package.</span> <span data-start="972.41" data-end="975.089">We bought a tool, Debianize.</span> <span data-start="975.089" data-end="979.269">It's not point and click, but it's YAML files.</span> <span data-start="979.269" data-end="986.019">Easy to manage, get, central, we can track who changes what and convert with CircleCI</span> <span data-start="986.019" data-end="990.35">and Ansible to anywhere we want.</span> </p>
<p><span data-start="990.35" data-end="992.68">All right?</span> <span data-start="992.68" data-end="996.089">So, let's look at one of those configuration files.</span> <span data-start="996.089" data-end="999.329">Very, very easily here, we have one driver.</span> <span data-start="999.329" data-end="1002.899">A driver that, guess what, next to a PLC.</span> <span data-start="1002.899" data-end="1009.35">A Siemens S7PC, we have the IP address in the port which we connect to, read and write.</span> <span data-start="1009.35" data-end="1017.68">Rack and slot our particular parameters for the RFC106 protocol that we're using to talk</span> <span data-start="1017.68" data-end="1018.68">to these things.</span> <span data-start="1018.68" data-end="1023.709">And what's important is that every 2 seconds we read these variable or better, we read</span> <span data-start="1023.709" data-end="1028.62">these memory addresses at DB 5102.</span> </p>
<p><span data-start="1028.62" data-end="1031.23">And at offset 12.</span> <span data-start="1031.23" data-end="1032.85">That's a word.</span> <span data-start="1032.85" data-end="1034.78">And that's basically a sign 16.</span> <span data-start="1034.78" data-end="1036.76">That's what we call speed.</span> <span data-start="1036.76" data-end="1039.26">That's where we find the speed that the machine is running.</span> <span data-start="1039.26" data-end="1044.89">At offset 36, we see the code of the first alarm and so on and so forth.</span> <span data-start="1044.89" data-end="1046.77">That's one of the drivers.</span> <span data-start="1046.77" data-end="1049.08">We have many drivers which we wrote.</span> <span data-start="1049.08" data-end="1055.18">And to monitor the performance of the gateway.</span> </p>
<p><span data-start="1055.18" data-end="1060.16">Here I just listed like load average Every 10 seconds we read the load average,</span> <span data-start="1060.16" data-end="1064.88">CPU percentages, every 10 seconds, calculate the percentage of the CPU used.</span> <span data-start="1064.88" data-end="1069.82">And we have latency to monitor the connection.</span> <span data-start="1069.82" data-end="1072.52">And this is how we start getting data into the system, right?</span> <span data-start="1072.52" data-end="1081.4">Doing that is very easy, we have processers organized one after the other.</span> <span data-start="1081.4" data-end="1088.16">Each process can subscribe to one, two, many, all of the values that are published by the</span> <span data-start="1088.16" data-end="1091.83">drivers or are republished by the processers.</span> <span data-start="1091.83" data-end="1098.15">And here we have very simple example of three processers that we are actually using.</span> <span data-start="1098.15" data-end="1099.87">The first one is a function.</span> <span data-start="1099.87" data-end="1102.85">The only line of JavaScript that probably you will see in my talk.</span> <span data-start="1102.85" data-end="1107.43">Which takes this speed which in the machine is published in decimeters per minute.</span> <span data-start="1107.43" data-end="1108.89">I don't know why.</span> <span data-start="1108.89" data-end="1113.2">But we divide by ten, meters per minute.</span> </p>
<p><span data-start="1113.2" data-end="1119.47">And the second one is string, we read alarms as unsigned 16bit integers.</span> <span data-start="1119.47" data-end="1122.97">But they're not numbers, we make an average on an alarm code.</span> <span data-start="1122.97" data-end="1125.64">We convert them into strings and consolidate.</span> <span data-start="1125.64" data-end="1130.27">Like I said before, if the alarm changes, we publish it.</span> <span data-start="1130.27" data-end="1135.27">Otherwise, if the alarm is not changed, we swallow that message, right?</span> <span data-start="1135.27" data-end="1140.22">But the most important probably processers that we have are like the last two that we</span> <span data-start="1140.22" data-end="1141.8">use at the end of the pipeline.</span> <span data-start="1141.8" data-end="1144.68">The batcher and the MQTT.</span> <span data-start="1144.68" data-end="1151.05">The batcher is very simply something that subscribes to all the messages, accumulates</span> <span data-start="1151.05" data-end="1157.27">them, and every 30 seconds pushes out that thing that you see like over there.</span> <span data-start="1157.27" data-end="1158.55">Functions out a message.</span> <span data-start="1158.55" data-end="1164.43">Which is no more, no less than an array of timestamp at which the data was read and the</span> <span data-start="1164.43" data-end="1166.65">vault of the data point.</span> <span data-start="1166.65" data-end="1167.68">Giant array.</span> <span data-start="1167.68" data-end="1173.62">We also compress it so it's nice and tiny when we send over our 2G link.</span> <span data-start="1173.62" data-end="1177.09">And then the MQTT processer does what it's supposed to be doing.</span> </p>
<p><span data-start="1177.09" data-end="1181.63">Sends it over to MQTT secure, blah, blah, blah, blah.</span> <span data-start="1181.63" data-end="1185.9">Very nays, right?</span> <span data-start="1185.9" data-end="1187.66">This is how we use JavaScript.</span> <span data-start="1187.66" data-end="1194.07">Everything behind this Y ML fuel, ever processer, every driver, the entire infrastructure to</span> <span data-start="1194.07" data-end="1197.18">drive this thing is written in JavaScript.</span> <span data-start="1197.18" data-end="1200.99">And we're using it like like it's been a labor of love.</span> <span data-start="1200.99" data-end="1209.85">We are extremely proud that it's running in production at real customer's sites.</span> <span data-start="1209.85" data-end="1213.56">It's feeding KEdge with live real data.</span> <span data-start="1213.56" data-end="1216.02">It has been working out great.</span> <span data-start="1216.02" data-end="1222.67">If you are a dad and, you know, maybe how proud you are.</span> <span data-start="1222.67" data-end="1225.98">The other thing that I mentioned, there were a couple of extra things.</span> <span data-start="1225.98" data-end="1228.23">Enough with the kit.</span> <span data-start="1228.23" data-end="1229.32">YAML.</span> <span data-start="1229.32" data-end="1237.42">We've wrote a bunch of YAML extensions which we needed for these configuration files.</span> <span data-start="1237.42" data-end="1239.17">YAML is great, but it's also terrible.</span> </p>
<p><span data-start="1239.17" data-end="1242.71">It doesn't allow including, it doesn't allow a bunch of things.</span> <span data-start="1242.71" data-end="1248.15">So, we wrote a little extension over there to merge a raise over raise.</span> <span data-start="1248.15" data-end="1252.51">So, if we have in one file define a list of drivers and in another file another list of</span> <span data-start="1252.51" data-end="1255.54">drivers, we can just merge them together.</span> <span data-start="1255.54" data-end="1258.6">It works great, obviously with the include driver.</span> </p>
<p><span data-start="1258.6" data-end="1263.52">So, we include a part a snippet of YAML into another file.</span> <span data-start="1263.52" data-end="1269.26">Making sure that all the variables are visible by the included files and whatnot.</span> <span data-start="1269.26" data-end="1271.43">So, there is a little bit of logic over there.</span> <span data-start="1271.43" data-end="1276.14">And then the last one we use a lots for configs ration is the join which takes a lot of joins</span> <span data-start="1276.14" data-end="1278.51">and concatenates them into a giant string.</span> <span data-start="1278.51" data-end="1285.91">It's great for variables, a certificate ID that repeats 25 million times in our configuration</span> <span data-start="1285.91" data-end="1286.91">files.</span> <span data-start="1286.91" data-end="1287.91">Right?</span> <span data-start="1287.91" data-end="1294.53">The other thing that I talked about was Debianize, it's a tool we wrote in order to take your</span> <span data-start="1294.53" data-end="1297.79">npm package and have it as a Deb.</span> <span data-start="1297.79" data-end="1299.16">Why?</span> <span data-start="1299.16" data-end="1301.43">We use Ubuntu on our gateways.</span> <span data-start="1301.43" data-end="1305.06">It was easy to get it out of the way.</span> <span data-start="1305.06" data-end="1311.53">You just slap it in your package.JSON, and then run the npm, this is the configuration</span> <span data-start="1311.53" data-end="1313.76">of the PLC reader in itself.</span> <span data-start="1313.76" data-end="1314.84">It's very complex.</span> </p>
<p><span data-start="1314.84" data-end="1319.02">It has sensible defaults so it's a one line of addition.</span> <span data-start="1319.02" data-end="1321.44">Makes a Debian package for you.</span> <span data-start="1321.44" data-end="1324.29">So, what's the state for us?</span> <span data-start="1324.29" data-end="1329.49">What's the state in terms of all the stuff we have wrote so far?</span> <span data-start="1329.49" data-end="1332.79">We have PLC reader which is open source.</span> <span data-start="1332.79" data-end="1336.51">You can just check it out on npm.</span> <span data-start="1336.51" data-end="1340.48">We have Debianize which is out for everybody to use.</span> <span data-start="1340.48" data-end="1347.451">YAML extensions, open source, get them, download them even if you don't care about PLCs or</span> <span data-start="1347.451" data-end="1348.6">industrial machines.</span> <span data-start="1348.6" data-end="1349.6">They're there.</span> <span data-start="1349.6" data-end="1351.12">They work.</span> <span data-start="1351.12" data-end="1355.76">We also throw in because you're such a good audience, we throw in a freebie, the IRONdb</span> <span data-start="1355.76" data-end="1356.76">persister.</span> <span data-start="1356.76" data-end="1363.54">That's the time series database we use for telemetry data.</span> <span data-start="1363.54" data-end="1370.59">It was a fantastic database created by a friend of mine, Theo.</span> <span data-start="1370.59" data-end="1375.5">But they had no JavaScript drivers for them, so we wrote them and they're also available</span> <span data-start="1375.5" data-end="1379.41">for you guys to use if you use IRONdb.</span> </p>
<p><span data-start="1379.41" data-end="1384.53">And that's pretty much it for me because I think that I have two minutes and I was wonder</span> <span data-start="1384.53" data-end="1387.79">for you guys have any questions?</span> <span data-start="1387.79" data-end="1389.83">Sure.</span> </p>
</section>

<section>
<p><span data-start="1389.83" data-end="1403.07"><span class="speaker">Audience</span>: [ Away from microphone ] PIER: Because that's right.</span> <span data-start="1403.07" data-end="1410.29">Because actually it is readable enough that it can be handled by presale support.</span> <span data-start="1410.29" data-end="1412.19">Because in most for the inclusions.</span> <span data-start="1412.19" data-end="1413.71">That's why we wrote the YAML extensions.</span> <span data-start="1413.71" data-end="1417.37">There are parts that people don't touch.</span> <span data-start="1417.37" data-end="1422.17">But, for example, the list of addresses in the memory, in the PLC, that comes from an</span> <span data-start="1422.17" data-end="1426.9">Excel file that the machine manufacturer actually makes.</span> <span data-start="1426.9" data-end="1429.34">So, that one is handled by a different team.</span> <span data-start="1429.34" data-end="1433.25">When they change the PLC programming, they can just change that part.</span> </p>
<p><span data-start="1433.25" data-end="1435.33">And then, you know, like all the rest flows together.</span> <span data-start="1435.33" data-end="1440.58">So, that's why we chose to use YAML rather than JavaScript for that.</span> <span data-start="1440.58" data-end="1441.99">Yeah.</span> <span data-start="1441.99" data-end="1444.81">Anything else?</span> <span data-start="1444.81" data-end="1447.67">There was a question over there at the bottom.</span> <span data-start="1447.67" data-end="1450.45">But, you know, like I guess, nobody picks it up.</span> </p>
</section>

<section>
<p><span data-start="1450.45" data-end="1454.59"><span class="speaker">Audience</span>: [ Away from microphone ] PIER: Wow.</span> <span data-start="1454.59" data-end="1457.54">Such an amazing question, right?</span> <span data-start="1457.54" data-end="1462.58">I spent the first 15 years of my career building Java systems.</span> <span data-start="1462.58" data-end="1467.75">I'm one of the cofounders of Jakarta and the XML Apache projects and I have been doing</span> <span data-start="1467.75" data-end="1470.24">XML since 1997.</span> <span data-start="1470.24" data-end="1474.77">For me it's like PLC reader, it's a labor of love.</span> </p>
<p><span data-start="1474.77" data-end="1481.891">The problem over there is that we have seen that there is an aggressive actor in the Java</span> <span data-start="1481.891" data-end="1488.2">world that is actually starting to copyright and push their copyright of the APIs out.</span> <span data-start="1488.2" data-end="1491.31">And we're talking about Oracle over there.</span> <span data-start="1491.31" data-end="1497.11">That didn't give us confidence that what we were building for especially in this case</span> <span data-start="1497.11" data-end="1503.42">when these gateways are over a 2G link, we didn't have the confidence that we could update</span> <span data-start="1503.42" data-end="1508.93">the Java virtual machine every six months like Oracle wants us to do kind of thing.</span> <span data-start="1508.93" data-end="1515.72">And I know that Amazon came out with some wonderful things on their side.</span> <span data-start="1515.72" data-end="1519.67">But I wonder how long those are going to last in a court.</span> <span data-start="1519.67" data-end="1525.88">So, JavaScript, on the other hand, you know, ECMA, pretty much every implementation out</span> <span data-start="1525.88" data-end="1527.43">there is open source.</span> <span data-start="1527.43" data-end="1532.49">And it gives us the stability that we need.</span> <span data-start="1532.49" data-end="1536.71">Thank you very much.</span> </p>
</section>