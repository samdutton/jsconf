<section>
<p><span data-start="24.14" data-end="34.89">Yeah, hi. My name is Joa, it's an unusual name, it’s not Joachim, it's just Joa. I</span> <span data-start="34.89" data-end="40.98">did a lot of flash development back in the day days but yeah you know flash is dying</span> <span data-start="40.98" data-end="48.25">all that stuff, so a little bit application if you need a way to convert it to the web.</span> </p>
<p><span data-start="48.25" data-end="55.449">So that's why I started building a project to compile Java bytecode to JavaScript. So</span> <span data-start="55.449" data-end="62.93">let's have a look at the technology landscape, what I am talking about today is mostly these</span> <span data-start="62.93" data-end="69.71">question marks because that's where the magic happens everything outside is done by different</span> <span data-start="69.71" data-end="79.64">tools. So we are actually here it takes Java byte code there are some other solutions as</span> <span data-start="79.64" data-end="89.229">well, takes Java source code, there's scaler.js which is tied to scaler compiler, and there's</span> <span data-start="89.229" data-end="99.27">TVM which is the other project also using Java bytecode, they all have different subtleties.</span> <span data-start="99.27" data-end="107.24">Most source code is compiled directly to JavaScript, only unity is compiling.net, byte code to</span> <span data-start="107.24" data-end="121.56">SE.js. SE.js we don't do it because its in Firefox but in general there's some big issue</span> <span data-start="121.56" data-end="127.28">because there no garbage collection you all know that Java is like JavaScript language,</span> <span data-start="127.28" data-end="132.94">and so we leave that on the web assembly I think this could be a huge opportunity but</span> <span data-start="132.94" data-end="142.46">whoever is sitting here and implementing it please remember there's more than C and C++.</span> </p>
<p><span data-start="142.46" data-end="151.6">Ruby and other implementations. We do everything ahead of time, so you could also choose to</span> <span data-start="151.6" data-end="156.011">do this all just-in-time, the difference is ahead of time means we take the Java byte</span> <span data-start="156.011" data-end="161.12">code and compare it to JavaScript source code instead of doing it at run time which means</span> <span data-start="161.12" data-end="166.069">we could load the byte code in a browser and while the application is running we could</span> <span data-start="166.069" data-end="173.12">convert this to JavaScript code, so you could do it basically if you want to do just-in-time</span> <span data-start="173.12" data-end="177.79">if you want to executable codes you could simply create new functions from existing</span> <span data-start="177.79" data-end="183.94">JavaScript source code you can apply a lot of different optimisation that we can't apply,</span> <span data-start="183.94" data-end="190.55">you could make optimistic assumption, here is a class I know nobody extends this class</span> <span data-start="190.55" data-end="200.78">so I think that's final, you can reinvalidate those assumptions which is called the deoptimisation,</span> <span data-start="200.78" data-end="209.67">you could also support class loaders in Java. You could at run time define a new class,</span> <span data-start="209.67" data-end="217.21">load bytecode, do all that at run time. Well, in fact it's feasible to do it right now because</span> <span data-start="217.21" data-end="223.92">we have workers now and the problem with the jet compiling specially in JavaScript would</span> <span data-start="223.92" data-end="229.879">be that you have all those optimisation and executing them takes a lot of time, you could</span> <span data-start="229.879" data-end="234.36">do it in a worker, and if anybody is interested in doing that I guess it would be a really</span> <span data-start="234.36" data-end="240.66">interesting project, but we don't do it, we do ahead of time because we want the browser</span> <span data-start="240.66" data-end="244.879">to concentrate just on user, because if you do it just-in-time the browser would have</span> <span data-start="244.879" data-end="250.54">to optimise your thing that converts to Java bytecode.</span> </p>
<p><span data-start="250.54" data-end="263.63">Also Java statistically. Trace and compiler which will I will explain in a second what</span> <span data-start="263.63" data-end="269.409">that means, basically it means it goes through the core graph of the programme, and it also</span> <span data-start="269.409" data-end="276.22">knows that at this point there isn't a class extended by a different class. In our case,</span> <span data-start="276.22" data-end="281.62">because we don't just support JavaScript but also other platforms it's nicer because as</span> <span data-start="281.62" data-end="286.63">long as the optimisations are done ahead of time we don't have to write out in JavaScript</span> <span data-start="286.63" data-end="294.38">and can apply to all different platforms. How does the compiler look, what does it do,</span> </p>
<p><span data-start="294.38" data-end="295.849">I hope you can see that.</span> <span data-start="295.849" data-end="304.419">I will try to simplify this as much as I could, but just a quick overview. Basically the compiler</span> <span data-start="304.419" data-end="312.479">creates a class file, also sorry that I am talking so fast, but there is a lot of stuff</span> <span data-start="312.479" data-end="325.94">we have to go through. So, the class file actually is first it's read by our completer,</span> <span data-start="325.94" data-end="331.26">what we call completing is reading basically the byte code which will give us the structure</span> <span data-start="331.26" data-end="338.14">of the class it fields and methods, although things can be read as well by our completer,</span> <span data-start="338.14" data-end="344.39">and every time they are accessed we resolve those symbols. Which basically means that</span> <span data-start="344.39" data-end="352.25">the first methods symbol we resolve is the main function and from there on everything</span> <span data-start="352.25" data-end="356.16">else is getting resolved.</span> <span data-start="356.16" data-end="366.839">So, the function goes into code parser which creates a couple of graphs, at the end it</span> <span data-start="366.839" data-end="374.68">exports a tree, which is kind of a legacy thing for us because we just went to a tree</span> <span data-start="374.68" data-end="381.16">and just the optimiser was going into a special kind of graph structure, we want to get rid</span> <span data-start="381.16" data-end="390.71">of this, and do everything on this graph but right now we are in a tree form. Go through</span> <span data-start="390.71" data-end="400.47">some generic phases that modify the tree, and if the optimiser is enabled, we apply</span> <span data-start="400.47" data-end="408.339">the optimisation if it's not we apply most of the platform specific phaser that make</span> <span data-start="408.339" data-end="416.07">the Java code run in the browser as JavaScript which behaves like Java.</span> </p>
<p><span data-start="416.07" data-end="421.641">Ok I want to give you maybe a little bit of an example to understand how this looks. If</span> <span data-start="421.641" data-end="426.32">you are compiler writing don't spoil the fun because you will already know what happens.</span> <span data-start="426.32" data-end="434.43">So that's like a simple method, with a loop, and it looks quite complex so the first thing</span> <span data-start="434.43" data-end="439.93">we do is we take the byte code, split it into graphs so we know what's going on where is</span> <span data-start="439.93" data-end="448.12">stuff happening, and you can already see it goes from up here, down into loop and jumps</span> <span data-start="448.12" data-end="457.14">back and then becomes the exit part and hello, and you know there are a lot of gotos here</span> <span data-start="457.14" data-end="463.96">and arbitrary jumps how do you represent those in JavaScript. Kind of looks like this if</span> <span data-start="463.96" data-end="473.51">you see you can always do this stuff you can always do a go to in JavaScript as well. You</span> <span data-start="473.51" data-end="478.7">can be the first to write that and everybody will quote you afterwards.</span> <span data-start="478.7" data-end="485.36">Anyways, from this graph structure we also build a tree structure that gives you an information</span> <span data-start="485.36" data-end="492.019">about how is the code actually structured, where is the loop, how do they follow source</span> <span data-start="492.019" data-end="499.969">code manner. This is our first estimate of the JavaScript code, it looks horrible, specially</span> <span data-start="499.969" data-end="506.159">if you look at the loop, you will always generate a wide through which has a lot of break and</span> <span data-start="506.159" data-end="518.479">continue statements, so fast forward like 20 phases, we can always apply a lot of, well</span> <span data-start="518.479" data-end="529.18">simplify and have you simple loop. This is what we put it in the optimiser, this is simplified</span> <span data-start="529.18" data-end="536.87">version of what it sees, again a graph so we go graph to tree to graph. Which is stupid</span> <span data-start="536.87" data-end="542.91">but another thing that we have to solve later.</span> </p>
<p><span data-start="542.91" data-end="550.84">The optimiser, well, does its stuff it has a lot of knowledge about what's going on,</span> <span data-start="550.84" data-end="559.59">and as you can see it can get rid of a lot of stuff, especially in this example. So,</span> <span data-start="559.59" data-end="565.86">when it gets out of the optimiser we're left with this little piece which basically says,</span> <span data-start="565.86" data-end="577.07">well it's here it prints just one. The JavaScript code we finally generate will look like this</span> <span data-start="577.07" data-end="582.201">we also do some renaming so it will probably in the end look like this which is quite nice</span> <span data-start="582.201" data-end="592.5">for such a big method, and the optimiser can prove a lot of stuff is unnecessary, so that's</span> <span data-start="592.5" data-end="594.4">what we want to achieve.</span> <span data-start="594.4" data-end="601.06">So what's the big problem in all of this? Semantics. We have to implement all the, JVM</span> <span data-start="601.06" data-end="612.28">semantics in JavaScript, there's a lot of stuff here, the lazy — there's no time, lazy</span> <span data-start="612.28" data-end="621.59">initialisation, and yeah, just quickly want to explain what all that stuff is. What we</span> <span data-start="621.59" data-end="626.11">don't want to do is we don't want to add too much over head that's what making the Java</span> <span data-start="626.11" data-end="639.4">code in fact run slow and inside of JavaScript. One thing is the class initialiser. It's always</span> <span data-start="639.4" data-end="646.01">executed when a class is first been loading in Java, this where all static variables are</span> <span data-start="646.01" data-end="651.47">being initialised and all that kind of stuff. So when you write this kind of code in Java</span> <span data-start="651.47" data-end="657.72">what actually happens is the base class of system which is object will get it's initialiser</span> <span data-start="657.72" data-end="663.87">called then a system class will get it's initialiser called but any if it's not been called before.</span> </p>
<p><span data-start="663.87" data-end="672.08">We have to do the same when compiling to JavaScript. The most simple way to do it you can add a</span> <span data-start="672.08" data-end="681.66">property to your class, which simply does all this work and we tried different aspects</span> <span data-start="681.66" data-end="688.57">of what works best across browsers, this one where the method is really finding itself</span> <span data-start="688.57" data-end="695.97">it just returns itself, but that didn't work out so great performance wise.</span> <span data-start="695.97" data-end="703.86">In the end this is JavaScript that we generated. So it's in tight, but there's the problem</span> <span data-start="703.86" data-end="710.99">because if you run this stuff in a loop, well, now I would have 10 times for instance this</span> <span data-start="710.99" data-end="716.78">call to initialiser. And the question is can we prove that the loop is taken at least once,</span> <span data-start="716.78" data-end="721.98">because if we can prove this, which we can of course prove is that we can take the initialiser</span> <span data-start="721.98" data-end="726.94">out of the loop for instance and apply just once for a loop so if the loop runs thousand</span> <span data-start="726.94" data-end="732.85">times we don't have to execute the initialiser thousand times. This is very important stuff</span> <span data-start="732.85" data-end="743.31">to do, to make it fly actually you can do even more you can take the access of the system</span> <span data-start="743.31" data-end="749.89">out, variable out, of the loop as well, and pretty good actually you won't notice that</span> <span data-start="749.89" data-end="753.35">is class initialiser is actually running.</span> </p>
<p><span data-start="753.35" data-end="760.29">There is another thing, in stance initialisation where you have a class, all properties like</span> <span data-start="760.29" data-end="768.73">the x property are initialised with value, we wanted to do it smart first and we thought,</span> <span data-start="768.73" data-end="777.39">ok, if you have more than four properties, I think, then we define the variable for this,</span> <span data-start="777.39" data-end="784.29">to minify the JavaScript that we output and then we assign it to those things if you have</span> <span data-start="784.29" data-end="792.11">50 variables in a class, the code is well, it's smaller, but the problem is you learn</span> <span data-start="792.11" data-end="800.04">that JavaScript JMs might guess the size of your object based on how often they see this.x</span> <span data-start="800.04" data-end="809.57">= y , not a local variable but this equals something, so you are back to software one,</span> <span data-start="809.57" data-end="817.79">the JavaScript — well.. make the best guess. That's like a kind of example of what you</span> <span data-start="817.79" data-end="819.33">can do.</span> <span data-start="819.33" data-end="829.79">Numerics are a different thing, in JavaScript you have a long type, well, already solved</span> <span data-start="829.79" data-end="834.62">you can basically put it an to an object you can say I have the high part and the low part</span> <span data-start="834.62" data-end="838.07">and I too all that stuff and it's quite boring,</span> <span data-start="838.07" data-end="844.36">what's more interesting is the other simplifications you can do. For instance if you have a method</span> <span data-start="844.36" data-end="850.67">like, give me the current time in milliseconds and it comes to an end. We implement current</span> <span data-start="850.67" data-end="858.65">and milliseconds on the double, we cast it back to the long. In fact the method would</span> <span data-start="858.65" data-end="864.43">look like this, date now, class it to long, class it to end, you can already see where</span> <span data-start="864.43" data-end="874.14">it's going, it's probably unnecessary to create the long. So, we have a method that converts</span> <span data-start="874.14" data-end="880.14">a double to a long and then we access the low bits of the long, now we have created</span> <span data-start="880.14" data-end="888.1">an object that's totally useless. We want to convert the double into an integer, which</span> <span data-start="888.1" data-end="893.529">is what happens and saves the long.</span> </p>
<p><span data-start="893.529" data-end="900.46">So the main story is always simplify, try to simplify it make it as tight as possible</span> <span data-start="900.46" data-end="904.29">and give rid of everything that's not totally necessary.</span> <span data-start="904.29" data-end="914.63">The integer, first we thought, yeah we love integers they are really cool, a+ b, simple,</span> <span data-start="914.63" data-end="922.37">at the ‘on’ operator, the integer is 30, you need the overflow when you do additional,</span> <span data-start="922.37" data-end="931.671">multiplication, thank you to AMS.js, we can use integer multiplication, that's nice, if</span> <span data-start="931.671" data-end="940.42">you have a double, of course, just — or not. In fact there is a subtle differences when</span> <span data-start="940.42" data-end="947.21">you talk about doubles in JavaScript for instance, if you have a double and apply the or operator</span> <span data-start="947.21" data-end="953.54">to the non-value, the zero, which is the same for Java, if you positive infinity, any value</span> <span data-start="953.54" data-end="960.48">under the maximum integer, JavaScript, well for positive infinity, JavaScript will give</span> <span data-start="960.48" data-end="965.51">you zero, if you 'Or', it whereas an Java you will get the maximum integer, all of a</span> <span data-start="965.51" data-end="971.46">sudden it's not that simple any more to convert your double to an integer. We had this little</span> <span data-start="971.46" data-end="979.791">method written, convert a double to an integer, which did exactly that. Well, we were quite..</span> <span data-start="979.791" data-end="987.99">umm.. quite an interesting moment because we had a benchmark and we found around the</span> <span data-start="987.99" data-end="991.63">benchmark, because it didn't convert a double correct, we implemented the method and the</span> <span data-start="991.63" data-end="999.98">benchmark was 10 per second slower, we thought, the second because we didn't convert the double</span> <span data-start="999.98" data-end="1007.41">correct, you can already see this method is a little bit stupid, infinity is already greater</span> <span data-start="1007.41" data-end="1016.72">than the maximum integer and the negative is lower than the minimum integer. So we tried</span> <span data-start="1016.72" data-end="1024.22">to change this method just a little bit and all of a sudden we had a 10 frames per second</span> <span data-start="1024.22" data-end="1033.159">performance boost, I don't know why the seconds, but I guess somebody could explain, I guess</span> <span data-start="1033.159" data-end="1038.439">it must have to do with the infinity values that it treats it a little bit different,</span> <span data-start="1038.439" data-end="1040.089">but you never know.</span> </p>
<p><span data-start="1040.089" data-end="1046.86">So, there is one last thing that we don't do, but that we will have to do eventually</span> <span data-start="1046.86" data-end="1054.261">in the future, it allows you to, well you divide by zero it throws an exception, which</span> <span data-start="1054.261" data-end="1062.05">is crazy, but it does that. Well, in order to do that you would have to have a method</span> <span data-start="1062.05" data-end="1067.58">that checks if it's zero or not and throws an exception, otherwise you would have to</span> <span data-start="1067.58" data-end="1073.42">prove that some value is never zero.</span> </p>
<p><span data-start="1073.42" data-end="1080.28">Null point exception, is also quite interesting, because, I don't know anybody who is doing</span> <span data-start="1080.28" data-end="1086.03">that at the moment, basically it means this, you have maybe a unit test, do some stuff,</span> <span data-start="1086.03" data-end="1092.8">you say ok, my tests only pass if null point exception is raised. So how do you do this</span> <span data-start="1092.8" data-end="1099.179">in JavaScript? The most obvious way would be to say, ok, I simply check if something</span> <span data-start="1099.179" data-end="1104.5">is null, right and then I raise an exception, but it's quite stupid if you have a lot of</span> <span data-start="1104.5" data-end="1109.37">changed stuff. You can also go on and say I'll correct a method that does a null check</span> <span data-start="1109.37" data-end="1115.98">for me, but that also doesn't scale very well. The cruel thing is in JavaScript</span> <span data-start="1115.98" data-end="1123.14">you are free to do what you want to do and you can modify the prototype of type error</span> <span data-start="1123.14" data-end="1129.34">to fit into a class system, whenever we see a type error from the JavaScript, we already</span> <span data-start="1129.34" data-end="1135.679">know it's a null point exception and it behaves like a null point exception, so in our case,</span> <span data-start="1135.679" data-end="1143.83">the equivalent, so the extra Java null point exception is from the perspective of the application</span> <span data-start="1143.83" data-end="1149.48">always thrown just when the type error is thrown.</span> </p>
<p><span data-start="1149.48" data-end="1154.98">Last little odd thing, is , because in Java you don't have undefined, but in JavaScript</span> <span data-start="1154.98" data-end="1162.03">you have methods that return  and this is also nothing new but, well what does</span> <span data-start="1162.03" data-end="1169.54">this print. It will be false, because  is not strictly equal to null, but it is non — </span> <span data-start="1169.54" data-end="1175.71">so if I just have two of those it would be true. In fact we always want to use strict</span> <span data-start="1175.71" data-end="1181.15">equality, because that's more like what the Java operator would be — so when you too stuff</span> <span data-start="1181.15" data-end="1187.01">like this, you would get a weird exception, because Foo is not now, but it's ,</span> <span data-start="1187.01" data-end="1193.17">if you just use a strict operator. So you want to use the non-strict operator, in those</span> <span data-start="1193.17" data-end="1200.66">cases where it can be null. Well, it's a little bit more complicated with strings and all</span> <span data-start="1200.66" data-end="1205.179">that's, because this would also cause now, when you compare a string and an object to</span> <span data-start="1205.179" data-end="1210.621">convert your object to a string and we also don't want to have that, but in fact, when</span> <span data-start="1210.621" data-end="1218.96">we implemented this, we got a five times improvement in a benchmark in Firefox, the only reason</span> <span data-start="1218.96" data-end="1225.16">why I could explain that, if you do a strict equality check that means it's not null, it</span> <span data-start="1225.16" data-end="1232.9">means that Firefox, well, you can still be  so I don't know what to do, whereas</span> <span data-start="1232.9" data-end="1238.93">where you use a non-strict operator, if you definitely know that the object is well..</span> <span data-start="1238.93" data-end="1244.309">not null or non-defined, maybe there is a hot path that can be triggered and we were</span> <span data-start="1244.309" data-end="1249.52">quite surprised that this actually happened, I would have thought the strict equality would</span> <span data-start="1249.52" data-end="1253.02">be much simpler for a JavaScript engine.</span> </p>
<p><span data-start="1253.02" data-end="1258.6">What's the moral of the story? In the end you want to write, when you generate JavaScript</span> <span data-start="1258.6" data-end="1264.18">you should mimic handwritten JavaScript so to the browser it should always look like</span> <span data-start="1264.18" data-end="1272.08">a user has written the code, not a machine some what translated it. You always have to</span> <span data-start="1272.08" data-end="1283.76">clean up and simplify after you, because well, otherwise all the semantics will slow the</span> <span data-start="1283.76" data-end="1289.79">application down. How much time do I have left? Is there somebody who knows? Nobody</span> <span data-start="1289.79" data-end="1298.07">knows. Ten, cool. Yet you should always try and take short cuts as much as possible, like</span> <span data-start="1298.07" data-end="1306.51">with a type error. Use what is available and, well, you have to test and measure your performance</span> <span data-start="1306.51" data-end="1312.58">and I can't stress this enough, it applies also to everything that you do in normal JavaScript,</span> <span data-start="1312.58" data-end="1319.75">which is you have to measure, so when you apply some optimisations manually, that's,</span> <span data-start="1319.75" data-end="1327.01">well, if you don't measure what happens, it will be quite, yeah.. umm.. well surprising</span> <span data-start="1327.01" data-end="1329.01">results can come out of this.</span> <span data-start="1329.01" data-end="1333.98">So, I just have ten minutes so I'll quickly skip over this, the optimiser, it does everything</span> <span data-start="1333.98" data-end="1338.57">you would expect from an optimiser, there is some cool stuff, so when you write this</span> <span data-start="1338.57" data-end="1347.09">in Java, we usually need for the integer the 'Or' operator but we already know it won't</span> <span data-start="1347.09" data-end="1354.14">overflow, we don't need the operator and we can simply use the implement. You can also</span> <span data-start="1354.14" data-end="1364.22">prove it in this case where you have the integer j, which is growing with i, so you would also</span> <span data-start="1364.22" data-end="1369.15">not need the operator, but when you are looking to the sources of the JavaScript JMs you well</span> <span data-start="1369.15" data-end="1376.07">figure at they know this stuff but not as good,</span> <span data-start="1376.07" data-end="1382.309">probably because this happens just in time and they can't spend as much time in all those</span> <span data-start="1382.309" data-end="1390.76">analysis. Also we don't do it for the browser, because the browser, should think it's still</span> <span data-start="1390.76" data-end="1392.53">an integer.</span> </p>
<p><span data-start="1392.53" data-end="1398.66">This is also quite surprising actually when you write this in Java, Java will always create</span> <span data-start="1398.66" data-end="1412.179">a new string for you and use the — string concatenation, function what we have to do</span> <span data-start="1412.179" data-end="1419.38">for JavaScript, we have to find that there is a string builder, so we can reconstruct</span> <span data-start="1419.38" data-end="1425.42">the JavaScript string concatenation.</span> <span data-start="1425.42" data-end="1433.66">This one is one that's actually looks quite simple on the board, in the slides, but actually</span> <span data-start="1433.66" data-end="1441.89">a lot of different optimisations have to play together, so this is the short iterator in</span> <span data-start="1441.89" data-end="1448.049">Java and the compiler in the byte code will expand it to something like this, while you</span> <span data-start="1448.049" data-end="1453.46">have the iterator in the list, while it gets the next element you get the next element</span> <span data-start="1453.46" data-end="1460.86">you write this stuff a lot in Java code it would be nice to get rid of it, we will generate</span> <span data-start="1460.86" data-end="1466.45">this code-based out of it, what has to happen is the code has to be in lined and you have</span> <span data-start="1466.45" data-end="1472.29">to prove the iterator is not escaping the method, you have to know what values get into</span> <span data-start="1472.29" data-end="1479.851">the iterator and what's taken out of, it like if you have all those 20 things ready, you</span> <span data-start="1479.851" data-end="1486.96">are finally pleased with a result like this. The cool thing is, if you do it in a generic</span> <span data-start="1486.96" data-end="1493.22">way it will apply to all of the code that you insert and that's quite nice. Even if</span> <span data-start="1493.22" data-end="1495.71">you write your own list this would happen.</span> </p>
<p><span data-start="1495.71" data-end="1501.6">This is much, much easier when you actually have source code, in source code you just</span> <span data-start="1501.6" data-end="1508.98">see the special kind of loop and you know, oh, ok, I don't, I generate it differently.</span> <span data-start="1508.98" data-end="1513.7">So, yeah. That's not so smart in the output.</span> <span data-start="1513.7" data-end="1522.33">Last but not least, gene this optimisation, you can prove that, well, if you like to write</span> <span data-start="1522.33" data-end="1529.27">code in a functional style, you can, you can actually let the compiler transform that back</span> <span data-start="1529.27" data-end="1538.79">into a loop, it can know that some stuff is in a tail position, so we can rewrite it into</span> <span data-start="1538.79" data-end="1543.21">a loop, simplify the loop and have a final result like this.</span> </p>
<p><span data-start="1543.21" data-end="1549.35">So, most browsers don't do this, but they do most of the normal optimisations that you</span> <span data-start="1549.35" data-end="1554.44">would expect, actually optimising JavaScript code by hand isn't necessarily something you</span> <span data-start="1554.44" data-end="1564.24">should do these days.</span> <span data-start="1564.24" data-end="1569.79">So we compile it to Java, that's what it looks like, it's basically what all the browsers</span> <span data-start="1569.79" data-end="1578.08">use to generate the \{inaudible\}, Java code comes out of it, the question is which one</span> <span data-start="1578.08" data-end="1586.37">do you use, Blink, Servo, Firefox, they all have their own with extensions, if you compile</span> <span data-start="1586.37" data-end="1591.61">all the web URL and test it in a browser for once, different browsers you well run to an</span> <span data-start="1591.61" data-end="1597.02">enormous amount of inconsistencies, it's just annoying, yeah.</span> <span data-start="1597.02" data-end="1604.46">Workers, it can be quite interesting, the JavaScript you generate can be directly fed</span> <span data-start="1604.46" data-end="1612.62">into a worker, most of the time you can simply say instead of the window just use the 'Self'</span> <span data-start="1612.62" data-end="1619.34">variable, that makes a lot of sense. Also we were quite surprised we also have to check</span> <span data-start="1619.34" data-end="1627.36">for types, if you have some code like things a worker, instruct mode, you will immediately</span> <span data-start="1627.36" data-end="1636.63">get an error like this for some reason error event isn't defined, you the XML, but not</span> <span data-start="1636.63" data-end="1638.73">the error</span> <span data-start="1638.73" data-end="1645.41">event, when we have the of check we have to again rate some stuff like this so it works</span> <span data-start="1645.41" data-end="1650.28">immediately in the worker.</span> </p>
<p><span data-start="1650.28" data-end="1655.7">That's it mostly for the compiler, I wanted to talk about the framework around it, the</span> <span data-start="1655.7" data-end="1661.79">display list, I did a lot of network back in the day, what was really cool was that</span> <span data-start="1661.79" data-end="1666.94">you had a display list where you could sensory impairment lie range stuff and move it around,</span> <span data-start="1666.94" data-end="1673.429">we wanted to have that too. Basically, I think that a lot of frameworks that do something</span> <span data-start="1673.429" data-end="1679.07">similar, where you have a tree-like structure and you can arrange all your objects and again</span> <span data-start="1679.07" data-end="1684.98">you can apply, like the same ideas that you use for opt my zing code, to something that</span> <span data-start="1684.98" data-end="1690.75">happens at run time. So we don't want to walk the tree all the time when we render some</span> <span data-start="1690.75" data-end="1697.69">stuff to the web, so we want a flat representation, we do that basically concatenating all the</span> <span data-start="1697.69" data-end="1706.78">stuff together in a kind of, well specialised structure, but in this case we also cache</span> <span data-start="1706.78" data-end="1714.049">all the information of the vertices, where they would go on WebGL, it's quite a thing,</span> <span data-start="1714.049" data-end="1720.58">it's what, what an optimiser would do as well, it has to figure out, does it make sense to</span> <span data-start="1720.58" data-end="1726.559">apply an optimisation at the time or not make sense, we have to render in simply about mode</span> <span data-start="1726.559" data-end="1737.56">or put all the stuff to reference cards — oh, just 2 minutes — I'll just go and, yeah, cache</span> <span data-start="1737.56" data-end="1746.96">all the virtual information and — so you get really fast results. So we rush through the</span> <span data-start="1746.96" data-end="1753.95">slides, I wanted to show you some demos from the display list, I hope it works. In that</span> <span data-start="1753.95" data-end="1763.47">case we can see one object is moving, so the display list would switch, when everything</span> <span data-start="1763.47" data-end="1771.101">moves it goes into a rendering stage, it's nice for applications as well as games. You</span> <span data-start="1771.101" data-end="1774.94">get those words.</span> </p>
<p><span data-start="1774.94" data-end="1785.87">Just the double thing, ten FPS slower, well, it uses the infinity thing, so instead of</span> <span data-start="1785.87" data-end="1794.63">50 frames, we were at 40 frames. And because I'm out of time, I just want to show you this</span> <span data-start="1794.63" data-end="1800.8">really quickly, we did a lot of the web idea stuff concatenated it to Java, those guys</span> <span data-start="1800.8" data-end="1809.07">that I was working on earlier, converted this big flash application, audio tool to Java</span> <span data-start="1809.07" data-end="1822.11">and then we compiled the Java code to JavaScript and I hope I've got some internet — but I</span> <span data-start="1822.11" data-end="1839">don't.. well that's too bad. No internet. Ok, maybe it loads in the end. So, because</span> <span data-start="1839" data-end="1844.33">when I wanted to show you, this is just a smaller version of the whole thing and speed</span> <span data-start="1844.33" data-end="1854.42">wise we have enough speed now to generate real time audio and JavaScript and render</span> <span data-start="1854.42" data-end="1861.03">all that stuff on the graphics card. So I can do all this, well tweak a lot of stuff</span> <span data-start="1861.03" data-end="1870.88">and it does it all in real time, and so this is like one of the cool things now that we</span> <span data-start="1870.88" data-end="1877.341">have the ability to take the existing stuff and compile it to JavaScript. There is also</span> <span data-start="1877.341" data-end="1884.36">another one, so we also have that in Flash, that's all now running, it's just pure JavaScript</span> <span data-start="1884.36" data-end="1893.2">and it's also at run time parsing all the mega files, so basically just a load of computations</span> <span data-start="1893.2" data-end="1913.12">and you can play your old favourite.. yeah.. music. Ok. So let me see if this last.. nope..</span> <span data-start="1913.12" data-end="1933.7">ah.. ok. So the cool thing here is.. come on, come on, this has web artists and live</span> <span data-start="1933.7" data-end="1945.59">collaboration. Ok. I talked about the guys from audio tool they are now all here. You</span> <span data-start="1945.59" data-end="1950.25">can say hello. Ok.</span> <span data-start="1950.25" data-end="1952.36"Audience member: Hello!</span> </p>
<p><span data-start="1952.36" data-end="1963.1">So this application is now running in a browser and the artists can actually move everything</span> <span data-start="1963.1" data-end="1968.13">around, do some stuff so I don't have to do anything right now, they can make some music,</span> <span data-start="1968.13" data-end="1974.88">you have to be quick, I'm already out of time. So if you know the Flash application this</span> <span data-start="1974.88" data-end="1976.179">was actually</span> <span data-start="1976.179" data-end="1983.63">quite a big thing, so here we have WebGL, let's, it's running very smooth and very nice</span> <span data-start="1983.63" data-end="1993.419">and I can turn all the knobs, do all the routing and for me the good thing is to see now that</span> <span data-start="1993.419" data-end="2000.1">we basically have this running in the browser without Flash, it was a big struggle to get</span> <span data-start="2000.1" data-end="2004.06">this running in Flash, we implemented our own garbage collection because the Flash was,</span> <span data-start="2004.06" data-end="2017.24">well, bad, so a lot of things to get this working. \{music\}. I'm actually not doing anything,</span> <span data-start="2017.24" data-end="2025.271">they can all do it in the live collaboration, which is done by a web artist. You can even</span> <span data-start="2025.271" data-end="2034.52">hook the midi stuff to it, it's really brave it shows the browser is very good at supporting</span> <span data-start="2034.52" data-end="2042.64">application that are very demanding when it comes to resources, it shows you can do what</span> <span data-start="2042.64" data-end="2055.679">you want now, we have this timeline here, which you can — ah, I have to exit this mode.</span> </p>
<p><span data-start="2055.679" data-end="2062.669">Ok, so that was something that we never did in Flash, you can simply adopt the timeline,</span> <span data-start="2062.669" data-end="2067.48">so when you have a second monitor you can now split that application, you can close</span> <span data-start="2067.48" data-end="2080.129">it and it flips just right back and this is well, actually simply amazing. \{Applause\}.</span> <span data-start="2080.129" data-end="2105.769">Right, thank you. Yeah. So I'm guess I'm done. Thanks. Thanks for listening. Well, if you</span> </p>
</section>