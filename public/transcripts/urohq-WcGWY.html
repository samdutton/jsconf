<section>
<p><span data-start="0.32" data-end="2.07">[Music]</span> <span data-start="2.07" data-end="3.84">[Applause]</span> <span data-start="3.84" data-end="5.66">[Music]</span> <span data-start="5.66" data-end="7.41">[Applause]</span> <span data-start="7.41" data-end="9.28">[Music]</span> <span data-start="9.28" data-end="11.02">[Applause]</span> <span data-start="11.02" data-end="12.78">[Music]</span> <span data-start="12.78" data-end="16.86">[Applause]</span> <span data-start="16.87" data-end="23.55">[Music]</span> <span data-start="23.55" data-end="29.309">[Applause]</span> <span data-start="29.309" data-end="35.02">hello my name is Francis I look like</span> <span data-start="35.02" data-end="38.62">this most places on the internet and I</span> <span data-start="38.62" data-end="42.489">work a bustle VP of engineering a puzzle</span> <span data-start="42.489" data-end="46.54">and so we are a Content site where</span> <span data-start="46.54" data-end="49.63">digital a digital media company and a</span> <span data-start="49.63" data-end="52.45">lot of people ask hey Francis how did</span> <span data-start="52.45" data-end="53.739">you everyone a puzzle like that would</span> <span data-start="53.739" data-end="56.23">say so fast and I know this one you know</span> <span data-start="56.23" data-end="58.69">we put everything in Redis and since</span> <span data-start="58.69" data-end="60.489">that's not a talk and it's usually</span> <span data-start="60.489" data-end="63.579">doesn't explain anything I did make this</span> <span data-start="63.579" data-end="65.17">talk and I call it we live in memory</span> <span data-start="65.17" data-end="67.149">because it's a really nice way to say we</span> <span data-start="67.149" data-end="70">use Redis and I'm gonna tell you about</span> <span data-start="70" data-end="72.49">how we use Amazon lambda and graph :</span> </p>
<p><span data-start="72.49" data-end="76.09">Redis to make a really fast API if you</span> <span data-start="76.09" data-end="77.47">want to follow along if you want to do</span> <span data-start="77.47" data-end="79.75">the links any of the open-source you can</span> <span data-start="79.75" data-end="83.44">get the talks on the side here and I</span> <span data-start="83.44" data-end="86.17">just to prove you know that we really do</span> <span data-start="86.17" data-end="88.72">have fast api's I see 70 milliseconds in</span> <span data-start="88.72" data-end="90.369">the title because that's the average but</span> <span data-start="90.369" data-end="93.7">most requests are in 24 milliseconds and</span> <span data-start="93.7" data-end="96.729">this is our API response rate and I love</span> <span data-start="96.729" data-end="98.89">it makes me so happy if you're a stats</span> <span data-start="98.89" data-end="101.95">nerd you'll notice the distribution</span> <span data-start="101.95" data-end="103.96">there is a quite perfect like</span> <span data-start="103.96" data-end="105.85">distribution and that bothers me too and</span> </p>
<p><span data-start="105.85" data-end="111.01">I don't know why so this talks gonna be</span> <span data-start="111.01" data-end="112.299">in three parts I'm gonna tell you what</span> <span data-start="112.299" data-end="113.439">bustled is doing I'm gonna tell you how</span> <span data-start="113.439" data-end="114.64">we're doing it and then I'm gonna say it</span> <span data-start="114.64" data-end="119.32">tell you how you can do it so where as I</span> <span data-start="119.32" data-end="120.909">said we're a digital media company right</span> <span data-start="120.909" data-end="122.799">so we have you know big websites only</span> <span data-start="122.799" data-end="125.53">show ads and you know we do all kind of</span> <span data-start="125.53" data-end="127.289">stuff we're one of the largest</span> <span data-start="127.289" data-end="130.39">publishers for millennial women right</span> </p>
<p><span data-start="130.39" data-end="132.129">I found out we're actually just really</span> <span data-start="132.129" data-end="133.45">big in general we're bigger than the</span> <span data-start="133.45" data-end="136.329">Washington Post and they make news and</span> <span data-start="136.329" data-end="138.37">we're also biggest bigger than like</span> <span data-start="138.37" data-end="140.23">Stack Exchange which is also really</span> <span data-start="140.23" data-end="141.94">weird because that in my head is just</span> <span data-start="141.94" data-end="142.88">one of the most massive</span> <span data-start="142.88" data-end="145.46">sites out there yeah and then also doing</span> <span data-start="145.46" data-end="147.14">research I found out that WebMD is a</span> <span data-start="147.14" data-end="148.94">digital media site we're bigger than</span> <span data-start="148.94" data-end="150.38">them but the fact there are digital</span> <span data-start="150.38" data-end="152.09">media site instead of maybe like I don't</span> <span data-start="152.09" data-end="154.13">know a medical site it makes makes me</span> <span data-start="154.13" data-end="160.07">really and we're growing right so we</span> <span data-start="160.07" data-end="161.63">keep adding these sites to our platform</span> <span data-start="161.63" data-end="163.79">and it means we just got to keep you</span> <span data-start="163.79" data-end="165.14">know being able to go faster and store</span> <span data-start="165.14" data-end="169.55">more data so what are our goals right we</span> <span data-start="169.55" data-end="170.54">want to have the best reader experience</span> <span data-start="170.54" data-end="172.55">right and we want to have the best</span> <span data-start="172.55" data-end="174.08">features so we can make the most</span> <span data-start="174.08" data-end="176.09">interesting compelling content you know</span> <span data-start="176.09" data-end="178.46">and there is not a software project out</span> <span data-start="178.46" data-end="180.11">there that doesn't have these same goals</span> </p>
<p><span data-start="180.11" data-end="183.59">I just want to be good right our</span> <span data-start="183.59" data-end="186.29">strategies to make this happen is we</span> <span data-start="186.29" data-end="188.09">want a very fast page load like we got</span> <span data-start="188.09" data-end="189.98">it we have ads to show you you know and</span> <span data-start="189.98" data-end="192.23">we want to make it really cheap to</span> <span data-start="192.23" data-end="194.12">change things and throw stuff away and</span> <span data-start="194.12" data-end="199.16">try out new ideas yeah before I go much</span> <span data-start="199.16" data-end="200.96">further I just want to say what Amazon</span> <span data-start="200.96" data-end="203.12">lambda is because it's really easy to</span> <span data-start="203.12" data-end="205.6">assume everybody knows that except you</span> <span data-start="205.6" data-end="208.88">it's functions as a service and what</span> <span data-start="208.88" data-end="210.56">does that even mean it means you get an</span> <span data-start="210.56" data-end="213.29">API in this case an Amazon HTTP API</span> <span data-start="213.29" data-end="215.36">alright that lets you execute your</span> <span data-start="215.36" data-end="217.34">JavaScript or a couple other languages</span> <span data-start="217.34" data-end="220.25">function remotely and lets you do it</span> <span data-start="220.25" data-end="222.26">with a consistent environment right so</span> <span data-start="222.26" data-end="224">you have guaranteed CPU guaranteed</span> <span data-start="224" data-end="225.8">memory and it doesn't care if you have</span> <span data-start="225.8" data-end="227.81">one running every second or a hundred</span> <span data-start="227.81" data-end="229.55">thousand running every second you know</span> <span data-start="229.55" data-end="231.17">you're guaranteed to have just as much</span> <span data-start="231.17" data-end="232.76">memory and CPU available to every</span> <span data-start="232.76" data-end="235.43">request and this makes scaling easier</span> <span data-start="235.43" data-end="238.25">right and we're using it because we were</span> <span data-start="238.25" data-end="239.57">able to take a whole bunch of app</span> <span data-start="239.57" data-end="241.52">servers that we had there to handle push</span> <span data-start="241.52" data-end="243.35">notifications and unpredictable traffic</span> <span data-start="243.35" data-end="245.63">and we're paying about 30km month and</span> <span data-start="245.63" data-end="248.12">now we're paying 3km up you know in</span> <span data-start="248.12" data-end="250.88">lambda and sometimes we have like 15 20</span> </p>
<p><span data-start="250.88" data-end="253.07">X or normal traffic for like two minutes</span> <span data-start="253.07" data-end="256.28">you know and that that's sucks well I</span> <span data-start="256.28" data-end="258.109">mean that's hard I should say it's</span> <span data-start="258.109" data-end="261.83">actually really amazing and so and over</span> <span data-start="261.83" data-end="263.27">the time since we've been we've been</span> <span data-start="263.27" data-end="266.27">building this platform for two years in</span> <span data-start="266.27" data-end="268.34">this incarnation or so and we've grown</span> <span data-start="268.34" data-end="269.22">about 10</span> <span data-start="269.22" data-end="271.11">in that amount and I haven't had to</span> <span data-start="271.11" data-end="272.58">worry about it it's still the same</span> <span data-start="272.58" data-end="274.74">functions doing the same stuff you know</span> <span data-start="274.74" data-end="275.91">it's got to make sure the database can</span> <span data-start="275.91" data-end="278.7">stay up to speed and you know I will</span> <span data-start="278.7" data-end="280.95">have to worry about it soon but but it's</span> <span data-start="280.95" data-end="284.73">bought us a lot so how does it actually</span> <span data-start="284.73" data-end="290.43">work right it works like this so when</span> <span data-start="290.43" data-end="292.26">you go and load this article and why</span> <span data-start="292.26" data-end="293.58">your kid wants to hear good night moon</span> <span data-start="293.58" data-end="297.54">again hits our CDN you know the CDN will</span> <span data-start="297.54" data-end="299.13">give you the rendered content or if</span> <span data-start="299.13" data-end="300.69">you're if you're already have the page</span> <span data-start="300.69" data-end="302.34">loaded and it's an API request to go</span> <span data-start="302.34" data-end="304.05">straight to the API we render everything</span> <span data-start="304.05" data-end="307.35">and react our API is handled by graph QL</span> <span data-start="307.35" data-end="308.76">and all the data comes from reddest</span> <span data-start="308.76" data-end="310.92">elasticsearch and you can sort of split</span> <span data-start="310.92" data-end="313.26">this up into a few layers the CDN layer</span> <span data-start="313.26" data-end="315.39">the rendering layer the API layer the</span> <span data-start="315.39" data-end="319.95">database layer and the CDN tries really</span> <span data-start="319.95" data-end="322.23">hard not to bother anyone else with</span> <span data-start="322.23" data-end="324.06">anything if you can serve your request</span> <span data-start="324.06" data-end="326.31">the CDN servers are much closer to where</span> <span data-start="326.31" data-end="327.9">you live you know they're all around the</span> <span data-start="327.9" data-end="330.54">world and I would rather everything to</span> <span data-start="330.54" data-end="332.19">be served out of the CDN I would rather</span> <span data-start="332.19" data-end="336.24">be 100% CDN served site but you know</span> <span data-start="336.24" data-end="338.34">there's a couple options you can use</span> <span data-start="338.34" data-end="340.11">especially if this stack right now we're</span> <span data-start="340.11" data-end="342.48">using fastly but I actually have one</span> <span data-start="342.48" data-end="344.34">more requirement I want out of my CDN is</span> <span data-start="344.34" data-end="346.47">that it should execute my functions this</span> <span data-start="346.47" data-end="348.06">is weird because a function execution</span> <span data-start="348.06" data-end="351.75">isn't exactly an HTTP request and but</span> <span data-start="351.75" data-end="352.98">it's close enough and it can give them</span> <span data-start="352.98" data-end="354.18">the same data and it should be a</span> <span data-start="354.18" data-end="354.93">question again</span> <span data-start="354.93" data-end="356.73">and so in this world where I don't</span> <span data-start="356.73" data-end="358.8">actually have any web servers I don't</span> <span data-start="358.8" data-end="360.39">want to have an upstream web server I</span> <span data-start="360.39" data-end="362.669">want to have you know the CDN do all the</span> <span data-start="362.669" data-end="365.13">work and so we accomplished this kind of</span> <span data-start="365.13" data-end="366.96">hacky we have API gateway which is</span> </p>
<p><span data-start="366.96" data-end="369.51">Amazon's web server for functions and</span> <span data-start="369.51" data-end="371.49">that executes sar lambda and then we</span> <span data-start="371.49" data-end="373.169">have fastly in front of it and fastly</span> <span data-start="373.169" data-end="374.669">gives us really fast cache invalidation</span> <span data-start="374.669" data-end="376.68">so when we update a post it's</span> <span data-start="376.68" data-end="378.9">it's a pushed out to follow the seed in</span> <span data-start="378.9" data-end="381.09">and 100 a minute usually under a second</span> <span data-start="381.09" data-end="384.09">to actually there's a near future where</span> <span data-start="384.09" data-end="385.89">maybe we use cloud flower workers or</span> <span data-start="385.89" data-end="386.62">they run</span> <span data-start="386.62" data-end="389.29">and have a v8 running in in the edge or</span> <span data-start="389.29" data-end="391.27">we use cloud front with their lambda at</span> <span data-start="391.27" data-end="392.8">the edge and have these executor</span> <span data-start="392.8" data-end="394.18">functions for us and that way we can</span> <span data-start="394.18" data-end="396.699">drop a whole hop about 10 or 15</span> <span data-start="396.699" data-end="398.979">milliseconds and you know we can we can</span> <span data-start="398.979" data-end="402.31">serve up stuff that much faster still a</span> <span data-start="402.31" data-end="404.229">little an experimentation but I think</span> <span data-start="404.229" data-end="405.43">this is something CD ends are going to</span> <span data-start="405.43" data-end="409.06">do from out of the box pretty soon their</span> <span data-start="409.06" data-end="411.37">rendering layer you know so this is a</span> <span data-start="411.37" data-end="413.949">function right and it gives us a status</span> <span data-start="413.949" data-end="416.74">and eight a body and headers and that's</span> <span data-start="416.74" data-end="418.36">everything you need for an HTTP response</span> <span data-start="418.36" data-end="420.16">you know it's got a couple of</span> <span data-start="420.16" data-end="422.11">responsibilities like this is the app of</span> <span data-start="422.11" data-end="423.729">bustled you know we're all client-side</span> <span data-start="423.729" data-end="425.35">apps and so it's got to do the</span> <span data-start="425.35" data-end="426.669">server-side rendering it's got to serve</span> <span data-start="426.669" data-end="428.949">up all the assets in a good way it's got</span> <span data-start="428.949" data-end="430.78">to you know be smart about the</span> <span data-start="430.78" data-end="432.699">components and the style shades and</span> <span data-start="432.699" data-end="435.07">break it all apart and so you know we</span> <span data-start="435.07" data-end="437.62">use react for our CMS's we use pre-act</span> <span data-start="437.62" data-end="440.35">because it's not much smaller for when</span> <span data-start="440.35" data-end="443.01">you go to bustled calm or raw / calm and</span> <span data-start="443.01" data-end="445.72">webpack makes everything possible we</span> <span data-start="445.72" data-end="448.87">even went pack the api we're happy with</span> <span data-start="448.87" data-end="451.99">how that works the api it's got a couple</span> <span data-start="451.99" data-end="454.69">of responsibilities it wants to take a</span> <span data-start="454.69" data-end="456.7">query and return some data you know and</span> <span data-start="456.7" data-end="458.47">then when you want to make a change yeah</span> <span data-start="458.47" data-end="460.3">take some input change the state and</span> <span data-start="460.3" data-end="463.36">then return some data and I have the</span> <span data-start="463.36" data-end="465.22">requirement that I want it to be strict</span> </p>
<p><span data-start="465.22" data-end="467.919">I want it to guarantee that when you ask</span> <span data-start="467.919" data-end="468.97">for a field do you know what you're</span> <span data-start="468.97" data-end="472.03">getting and you always get it and so we</span> <span data-start="472.03" data-end="474.91">use graph QL right because graph qo does</span> <span data-start="474.91" data-end="479.169">all these things we're able to we start</span> <span data-start="479.169" data-end="481.09">of like a dozen record services and so</span> <span data-start="481.09" data-end="482.199">whenever we wanted to make a request</span> <span data-start="482.199" data-end="483.58">we'd have to go and get it from one and</span> <span data-start="483.58" data-end="485.349">the other and the other and then try to</span> <span data-start="485.349" data-end="487.27">get them all back and then sometimes if</span> <span data-start="487.27" data-end="489.07">we didn't implement it right status</span> <span data-start="489.07" data-end="490.75">codes to be different you know err</span> <span data-start="490.75" data-end="492.76">errors would be a different shape we had</span> <span data-start="492.76" data-end="494.979">a lot of ifs in our in our response</span> <span data-start="494.979" data-end="496.66">handling to try to normalize it in fact</span> <span data-start="496.66" data-end="498.25">our front-end team did more data</span> <span data-start="498.25" data-end="500.199">normalization than our than our API team</span> <span data-start="500.199" data-end="502.72">and graph QL kind of gave us a single</span> <span data-start="502.72" data-end="504.55">place a single end point where we put</span> <span data-start="504.55" data-end="506.47">everything behind one thing and we wrap</span> <span data-start="506.47" data-end="508">all our third-party services and stuff</span> <span data-start="508" data-end="510.49">in this — it's helped a lot to have one</span> <span data-start="510.49" data-end="513.459">way to do things and the last player is</span> <span data-start="513.459" data-end="515.74">the database layer and you just want it</span> <span data-start="515.74" data-end="517.599">to store data safely right and you</span> <span data-start="517.599" data-end="519.03">wanted to retrieve data fast</span> <span data-start="519.03" data-end="521.219">and I wanted to retrieve data fast in a</span> <span data-start="521.219" data-end="524.099">consistent time because it doesn't help</span> <span data-start="524.099" data-end="526.05">me if I ask for a post and I get it and</span> <span data-start="526.05" data-end="528.15">and you know in under 70 milliseconds</span> <span data-start="528.15" data-end="529.5">and then I asked for it again later and</span> </p>
<p><span data-start="529.5" data-end="531.63">I get it in its second and a half like I</span> <span data-start="531.63" data-end="534.18">think that's broken yeah I want it to be</span> <span data-start="534.18" data-end="536.85">much much faster and so actually it can</span> <span data-start="536.85" data-end="538.53">even be slow if I know how fast it is</span> <span data-start="538.53" data-end="541.26">and in order to get this we use Redis as</span> <span data-start="541.26" data-end="544.83">our primary data star so if you don't</span> <span data-start="544.83" data-end="547.11">know Redis it's a data structure server</span> <span data-start="547.11" data-end="549.24">and it slow gives you things like hashes</span> <span data-start="549.24" data-end="550.83">and started sets and let you talk to it</span> <span data-start="550.83" data-end="551.58">over the network</span> <span data-start="551.58" data-end="553.14">let's do kind of operations on the stuff</span> <span data-start="553.14" data-end="555.18">remember a lot of people use this for</span> <span data-start="555.18" data-end="557.64">cash or maybe they put their sessions in</span> <span data-start="557.64" data-end="558.75">there because they could have sort of a</span> <span data-start="558.75" data-end="561">little JSON session in there and it's</span> <span data-start="561" data-end="562.71">really fast and gives it back but if</span> </p>
<p><span data-start="562.71" data-end="564.54">Redis dies you know if you if the</span> <span data-start="564.54" data-end="566.49">process exits all the data is gone and</span> <span data-start="566.49" data-end="569.52">you know what that's okay but just</span> <span data-start="569.52" data-end="570.87">because as good of that doesn't mean</span> <span data-start="570.87" data-end="572.61">it's actually not good as a database</span> <span data-start="572.61" data-end="575.49">it's got known persistence and most</span> <span data-start="575.49" data-end="576.75">people when they hear we use it they</span> <span data-start="576.75" data-end="578.37">they don't they don't know that because</span> <span data-start="578.37" data-end="579.45">why would you turn it on if it's</span> <span data-start="579.45" data-end="583.589">ephemeral data all right and so I tell</span> <span data-start="583.589" data-end="587.339">them and they don't believe me so I'm</span> <span data-start="587.339" data-end="590.82">gonna show you whenever I write comes in</span> <span data-start="590.82" data-end="592.53">it gets appended to this append-only</span> <span data-start="592.53" data-end="595.35">file which is how it is a lot of</span> <span data-start="595.35" data-end="596.61">databases have this kind of thing this</span> <span data-start="596.61" data-end="599.16">is the write log yeah and every second</span> <span data-start="599.16" data-end="600.72">we write this to disk so if the process</span> <span data-start="600.72" data-end="602.79">itself crashes which we haven't ever had</span> <span data-start="602.79" data-end="607.26">happen in four years but but it can it</span> <span data-start="607.26" data-end="608.91">we can just start it up again</span> </p>
<p><span data-start="608.91" data-end="610.17">I'll pick up where I left off that's</span> <span data-start="610.17" data-end="611.339">what everything back to memory and we're</span> <span data-start="611.339" data-end="614.16">fine we take that throw test3 but we</span> <span data-start="614.16" data-end="615.9">also take a full shot of memory which is</span> <span data-start="615.9" data-end="617.91">a little faster to load that's the Rd be</span> <span data-start="617.91" data-end="620.58">the Redis database file and we put that</span> <span data-start="620.58" data-end="622.62">desk three two and so we can restore</span> <span data-start="622.62" data-end="624.089">another machine we were start staging</span> <span data-start="624.089" data-end="626.01">every night off that data and you know</span> <span data-start="626.01" data-end="627.839">and we just have as much I haven't had</span> <span data-start="627.839" data-end="630.93">as good data retention in Postgres or</span> <span data-start="630.93" data-end="632.76">anything else I mean I mean and that's</span> <span data-start="632.76" data-end="634.38">that's the fault of the problem that's</span> <span data-start="634.38" data-end="635.97">the pole of our ops you know you can do</span> <span data-start="635.97" data-end="638.58">this pretty much any database of course</span> <span data-start="638.58" data-end="639.78">we have high availability there read</span> <span data-start="639.78" data-end="642.39">replicas in the primary so if it does if</span> <span data-start="642.39" data-end="644.339">it does exist it will readers won't</span> <span data-start="644.339" data-end="645.6">notice maybe we'll lose a couple of</span> <span data-start="645.6" data-end="647.43">requests well switches over that's</span> <span data-start="647.43" data-end="650.4">and this works very well for us you know</span> <span data-start="650.4" data-end="654.72">and you can you could do this with your</span> <span data-start="654.72" data-end="657.06">tool of choice this really this talk I</span> <span data-start="657.06" data-end="659.04">love Radisson I would love to actually</span> <span data-start="659.04" data-end="662.16">give an entire read of stock but but</span> <span data-start="662.16" data-end="663.36">this really could be any database</span> <span data-start="663.36" data-end="665.04">whatever your favorite is it will work</span> <span data-start="665.04" data-end="668.73">just fine so if we take our stock and</span> <span data-start="668.73" data-end="670.29">we've split it up into the layers you</span> <span data-start="670.29" data-end="672.09">know the CDN tries to do everything I</span> <span data-start="672.09" data-end="673.53">can not to bother anyone the rendering</span> <span data-start="673.53" data-end="675.24">gives you the rendered content you know</span> <span data-start="675.24" data-end="677.52">the API you know well forms and handles</span> <span data-start="677.52" data-end="679.53">all the changes to stay in the database</span> <span data-start="679.53" data-end="683.16">keeps everything safe we're gonna talk</span> <span data-start="683.16" data-end="686.22">about this part because part of the part</span> </p>
<p><span data-start="686.22" data-end="688.8">I know the most I'm not gonna talk about</span> <span data-start="688.8" data-end="690.9">elasticsearch but we use it you know for</span> <span data-start="690.9" data-end="694.53">search and we also related content and</span> <span data-start="694.53" data-end="696.45">some other nice things you know it's</span> <span data-start="696.45" data-end="698.61">great but in the end of the day Redis is</span> <span data-start="698.61" data-end="701.73">the primary so let's make an example I</span> <span data-start="701.73" data-end="703.5">recently became a dad and so all my</span> <span data-start="703.5" data-end="706.08">shoes are dad shoes you know and so I</span> <span data-start="706.08" data-end="707.82">heard it's actually hard to pull off dad</span> <span data-start="707.82" data-end="709.5">shoes and so I was like well let's check</span> <span data-start="709.5" data-end="711.96">it out and at the top of Google there's</span> <span data-start="711.96" data-end="714.42">a bustle article about dad shoes yeah</span> <span data-start="714.42" data-end="716.97">and it turns out the secret to dad shoes</span> <span data-start="716.97" data-end="720.21">is wearing a flowy skirt but if you look</span> <span data-start="720.21" data-end="725.16">at the data that goes into this post you</span> <span data-start="725.16" data-end="727.68">have what you would expect it's a JSON</span> <span data-start="727.68" data-end="729.75">blog right and we have sort of this tree</span> <span data-start="729.75" data-end="733.08">of data we have the site it's bustled it</span> <span data-start="733.08" data-end="735.48">has a post on the post field you know</span> <span data-start="735.48" data-end="737.28">and it has all the data for the post and</span> </p>
<p><span data-start="737.28" data-end="739.53">Escada the post has an author field that</span> <span data-start="739.53" data-end="742.29">has a user object it has a tags field</span> <span data-start="742.29" data-end="744.33">which has an array of tags and this</span> <span data-start="744.33" data-end="746.16">matches our graph QL querying real</span> <span data-start="746.16" data-end="749.73">closely we're asking for this in the</span> <span data-start="749.73" data-end="751.71">same shape and there's a little bit of</span> <span data-start="751.71" data-end="753.39">prescription here because we can ask for</span> <span data-start="753.39" data-end="754.65">it like this we get like this and we use</span> <span data-start="754.65" data-end="757.05">it like this but if we got it back you</span> <span data-start="757.05" data-end="759.21">know one request for each tag or even if</span> <span data-start="759.21" data-end="761.4">nested data if we got it back in a flat</span> <span data-start="761.4" data-end="764.28">format you know like with a JSON API or</span> <span data-start="764.28" data-end="766.32">something we would basically go and</span> <span data-start="766.32" data-end="767.85">build the shape again you know to give</span> <span data-start="767.85" data-end="770.16">it to our components so we've been very</span> <span data-start="770.16" data-end="771.96">happy with this you also get only the</span> <span data-start="771.96" data-end="774">fields you asked for so we can you know</span> <span data-start="774" data-end="775.47">in the API team just keep throwing stuff</span> <span data-start="775.47" data-end="777.24">in there for people to try out and most</span> <span data-start="777.24" data-end="778.949">using it they do we can get forget</span> <span data-start="778.949" data-end="780.449">fields and it pops up in their linter</span> <span data-start="780.449" data-end="781.499">and they say oh they'll use this field</span> <span data-start="781.499" data-end="784.399">anymore you know and it's kind of cool</span> <span data-start="784.399" data-end="787.17">if we remove all the data we end up with</span> <span data-start="787.17" data-end="791.04">this little tree right a graph perhaps</span> <span data-start="791.04" data-end="794.639">of the of the names of the you know the</span> <span data-start="794.639" data-end="796.319">types and their IDs and their</span> <span data-start="796.319" data-end="798.389">relationships right and if we squint and</span> <span data-start="798.389" data-end="799.579">we can make it kind of look like this</span> <span data-start="799.579" data-end="802.649">all right so this site has a post field</span> <span data-start="802.649" data-end="804.36">with the post and has the author field</span> <span data-start="804.36" data-end="806.759">of the user and the tags with the tags</span> <span data-start="806.759" data-end="808.949">if we want to describe this a little</span> <span data-start="808.949" data-end="811.499">more graph database II you know and they</span> <span data-start="811.499" data-end="813.869">the graph community uses the word</span> <span data-start="813.869" data-end="817.17">predicate to describe an edge I looked</span> <span data-start="817.17" data-end="818.49">it up on google i don't know why i'm</span> <span data-start="818.49" data-end="821.399">sorry but the predicates here side has</span> <span data-start="821.399" data-end="822.929">post and get a little more a little more</span> <span data-start="822.929" data-end="824.459">descriptive with them and so we can</span> <span data-start="824.459" data-end="827.73">store this in the database and like we</span> <span data-start="827.73" data-end="830.699">want to represent it and in order to do</span> <span data-start="830.699" data-end="834.569">that we built a graph database we call</span> <span data-start="834.569" data-end="837.48">it Gradius way after an old video game</span> <span data-start="837.48" data-end="839.279">and this is actually the name of our</span> <span data-start="839.279" data-end="841.019">whole API in the graph database the kind</span> <span data-start="841.019" data-end="843.99">of game hand in hand and this has</span> <span data-start="843.99" data-end="846.329">allowed us to grow with a relatively</span> <span data-start="846.329" data-end="847.949">small engineering team where were less</span> <span data-start="847.949" data-end="850.379">than 15 people you know over the past</span> <span data-start="850.379" data-end="852.179">couple years only we could have done it</span> <span data-start="852.179" data-end="854.67">without this so whenever I say what</span> <span data-start="854.67" data-end="857.1">graph database immediately people say oh</span> <span data-start="857.1" data-end="860.699">like neo4j right and exactly like neo4j</span> <span data-start="860.699" data-end="862.499">except it doesn't do anything to offer</span> <span data-start="862.499" data-end="865.769">to us your fridge a is amazing it's a</span> <span data-start="865.769" data-end="867.899">it's a very complicated actually I have</span> <span data-start="867.899" data-end="870.269">a hard time and this is a failing of</span> <span data-start="870.269" data-end="872.579">mine not it because they have wonderful</span> <span data-start="872.579" data-end="875.069">beautiful tools and I wish I had but</span> <span data-start="875.069" data-end="876.509">it's it's hard for me to understand it</span> <span data-start="876.509" data-end="878.249">does a lot and the queries can get super</span> <span data-start="878.249" data-end="881.1">complex right and the reason ours is</span> <span data-start="881.1" data-end="884.1">faster is because it's because we made</span> <span data-start="884.1" data-end="885.72">some trade-offs but I mean when people</span> <span data-start="885.72" data-end="888.629">say databases are faster right what do</span> <span data-start="888.629" data-end="889.92">they mean you know it's</span> </p>
<p><span data-start="889.92" data-end="892.11">I had a DBA should I work for and his</span> <span data-start="892.11" data-end="894.54">big analogy was trans art slow they have</span> <span data-start="894.54" data-end="896.129">one speed that people get it on up on</span> <span data-start="896.129" data-end="898.559">and off and the people are slow right</span> <span data-start="898.559" data-end="900.24">but if there were no people the trans</span> <span data-start="900.24" data-end="902.279">would be super fast databases are the</span> <span data-start="902.279" data-end="904.29">same they aren't slow the data going in</span> <span data-start="904.29" data-end="906.089">and out it's the queries that are slow</span> <span data-start="906.089" data-end="907.98">and they specially said this every</span> <span data-start="907.98" data-end="909.029">single time somebody complain the</span> <span data-start="909.029" data-end="911.54">databases for slow</span> <span data-start="911.54" data-end="914.55">but you can build a faster train and I</span> <span data-start="914.55" data-end="916.32">was the trade-off we made in fact we</span> <span data-start="916.32" data-end="918.9">traded query flexibility for speed and</span> <span data-start="918.9" data-end="920.55">we made it super difficult to make a</span> <span data-start="920.55" data-end="923.76">slow query you know and if you can't</span> <span data-start="923.76" data-end="925.17">have a slow query then everything is</span> <span data-start="925.17" data-end="930.33">fast right oh I think I should say yeah</span> <span data-start="930.33" data-end="932.82">we because it's not flexible because we</span> <span data-start="932.82" data-end="934.26">can't do these complex queries we</span> <span data-start="934.26" data-end="936.33">replicate to other databases elastic</span> <span data-start="936.33" data-end="937.53">search being one of them you know for</span> <span data-start="937.53" data-end="940.95">search but also to bigquery for you know</span> <span data-start="940.95" data-end="944.28">doing analytics and for you know you can</span> <span data-start="944.28" data-end="945.81">get a feed all the changes and so we're</span> <span data-start="945.81" data-end="947.19">playing of different databases you know</span> <span data-start="947.19" data-end="949.5">we have our DBMS is for reporting you</span> <span data-start="949.5" data-end="951">know but a rightist remains this for</span> <span data-start="951" data-end="955.56">sector so we don't love open source we</span> <span data-start="955.56" data-end="957.66">just had Ghost 2.0 got released various</span> <span data-start="957.66" data-end="959.64">ghost that uses mobile doc as a data</span> <span data-start="959.64" data-end="961.35">storage and we helped develop mobile doc</span> <span data-start="961.35" data-end="964.14">that's how we store all of our posts and</span> <span data-start="964.14" data-end="966.51">so we haven't been able to open source</span> </p>
<p><span data-start="966.51" data-end="969.12">Gradius because it's everything and it's</span> <span data-start="969.12" data-end="970.44">in no shape to be shared with other</span> <span data-start="970.44" data-end="972.3">people and so i started porting</span> <span data-start="972.3" data-end="974.4">everything to something I call Nemesis</span> <span data-start="974.4" data-end="978.06">DB Nemesis is the US arcade port of the</span> <span data-start="978.06" data-end="980.16">gradius game so I figured it was a good</span> <span data-start="980.16" data-end="983.07">name for it and it's really fast you</span> <span data-start="983.07" data-end="984.63">know as fast as iris already got</span> <span data-start="984.63" data-end="986.13">features I wish I could use and Gradius</span> <span data-start="986.13" data-end="987.9">and as soon as we get it to a certain</span> <span data-start="987.9" data-end="989.52">point I want to advertise cluster</span> <span data-start="989.52" data-end="991.98">support so we can get much bigger we</span> <span data-start="991.98" data-end="994.14">we're switching the whole company to it</span> <span data-start="994.14" data-end="997.23">it'll be a nice little migration by it's</span> <span data-start="997.23" data-end="1000.17">not done however I use it completely in</span> <span data-start="1000.17" data-end="1001.85">this talk it does everything we showed</span> <span data-start="1001.85" data-end="1003.74">you here today and if this interests you</span> <span data-start="1003.74" data-end="1005.21">if you want to know how it works please</span> <span data-start="1005.21" data-end="1007.19">see me after please check it out and</span> <span data-start="1007.19" data-end="1009.77">open many issues and and like the fire</span> <span data-start="1009.77" data-end="1010.94">for me to finish this because I think</span> <span data-start="1010.94" data-end="1014.63">it'd be better for everybody so let's</span> <span data-start="1014.63" data-end="1018.2">make a graph QL server we're gonna go</span> <span data-start="1018.2" data-end="1019.34">over the tools we're gonna go over to</span> <span data-start="1019.34" data-end="1020.69">what a schema is we're gonna go over how</span> <span data-start="1020.69" data-end="1022.04">the resolvers work and I talked about</span> <span data-start="1022.04" data-end="1027.85">the loaders and this is our package JSON</span> <span data-start="1027.85" data-end="1029.87">dependencies are Apollo server</span> </p>
<p><span data-start="1029.87" data-end="1031.73">I love Apollo I wish I actually used</span> <span data-start="1031.73" data-end="1035.39">Apollo server for Gradius we started it</span> <span data-start="1035.39" data-end="1037.67">before it was ready I think but it's</span> <span data-start="1037.67" data-end="1039">totally ready now</span> <span data-start="1039" data-end="1042.51">and it's not that complex either and</span> <span data-start="1042.51" data-end="1043.92">that makes me happy it's hard to make</span> <span data-start="1043.92" data-end="1045.689">simple things and so the Apollo tools</span> <span data-start="1045.689" data-end="1047.4">and Apollo server stuff they've they've</span> <span data-start="1047.4" data-end="1049.41">been able to help make a more</span> <span data-start="1049.41" data-end="1050.76">straightforward to develop and I'm very</span> <span data-start="1050.76" data-end="1052.83">happy with it</span> <span data-start="1052.83" data-end="1055.5">and so our server file and this is what</span> <span data-start="1055.5" data-end="1056.73">you would use for developing on your own</span> <span data-start="1056.73" data-end="1061.56">machine reads like this you know you do</span> <span data-start="1061.56" data-end="1065.01">your requires and you get all your type</span> <span data-start="1065.01" data-end="1066.66">definitions it's just a file you read</span> <span data-start="1066.66" data-end="1069.18">into a string and then you start the</span> <span data-start="1069.18" data-end="1070.92">server and you say here that here is the</span> <span data-start="1070.92" data-end="1073.17">schema here are my results and don't</span> <span data-start="1073.17" data-end="1074.73">listen on a port there's not much more</span> <span data-start="1074.73" data-end="1079.29">to it if you have a lambda you know we</span> <span data-start="1079.29" data-end="1080.88">need to play to lambda it's the same</span> <span data-start="1080.88" data-end="1082.53">thing except they have a slightly</span> <span data-start="1082.53" data-end="1084.03">different server which knows how to</span> <span data-start="1084.03" data-end="1085.59">handle the lambda requests and instead</span> <span data-start="1085.59" data-end="1087.69">of listening on a port you tell lambda</span> <span data-start="1087.69" data-end="1089.13">hey this is the name of this is the</span> <span data-start="1089.13" data-end="1090.81">function you call for each request and</span> <span data-start="1090.81" data-end="1095.31">it handles handles the rest but what it</span> <span data-start="1095.31" data-end="1097.62">gives you is a lot so you have the it</span> <span data-start="1097.62" data-end="1099.57">can process graph you all queries but it</span> <span data-start="1099.57" data-end="1101.28">also gives you graphical which is a tool</span> <span data-start="1101.28" data-end="1103.59">that you can use to play with queries</span> <span data-start="1103.59" data-end="1105.33">all right and so I forgive me some</span> <span data-start="1105.33" data-end="1107.07">graphical czar white some are black some</span> <span data-start="1107.07" data-end="1108.6">are dark I don't know how easy this is</span> <span data-start="1108.6" data-end="1111.09">to read but this is a query on the left</span> <span data-start="1111.09" data-end="1112.5">on the data on the right and a big play</span> <span data-start="1112.5" data-end="1114.69">button in the middle and so you can get</span> <span data-start="1114.69" data-end="1116.79">auto completing queries where you can</span> <span data-start="1116.79" data-end="1118.26">hover and see which type it's supposed</span> <span data-start="1118.26" data-end="1120.21">to be and see the data it's gonna get</span> <span data-start="1120.21" data-end="1122.28">copy and paste this into your component</span> <span data-start="1122.28" data-end="1125.22">and use it and even better its</span> <span data-start="1125.22" data-end="1127.74">documenting because there is a schema</span> <span data-start="1127.74" data-end="1129.72">isn't just for the graph 12 server for</span> <span data-start="1129.72" data-end="1132.36">the client — and it's able to pull out</span> <span data-start="1132.36" data-end="1134.61">all the relationships so this is the</span> <span data-start="1134.61" data-end="1136.74">site which has a post which has an</span> <span data-start="1136.74" data-end="1138.84">author which is a user you know and you</span> <span data-start="1138.84" data-end="1140.52">can see what all the types are you know</span> <span data-start="1140.52" data-end="1141.54">you can see if they're gonna be null or</span> <span data-start="1141.54" data-end="1144.57">not and you can click around and and if</span> </p>
<p><span data-start="1144.57" data-end="1145.98">I broke descriptions which I didn't</span> <span data-start="1145.98" data-end="1148.32">you'd see them there too or deprecations</span> <span data-start="1148.32" data-end="1150.27">which I didn't you could see why we got</span> <span data-start="1150.27" data-end="1154.47">rid of stuff and I I firmly github</span> <span data-start="1154.47" data-end="1156.78">scratch qlae API is a wonderful shining</span> <span data-start="1156.78" data-end="1159.15">example of how you can do this right you</span> <span data-start="1159.15" data-end="1160.71">know we crimp stuff from them quite a</span> <span data-start="1160.71" data-end="1164.49">lot so the schema defines what the data</span> <span data-start="1164.49" data-end="1166.02">looks like and it doesn't care how it</span> <span data-start="1166.02" data-end="1166.38">works</span> <span data-start="1166.38" data-end="1168.9">so I have the state I have the posts and</span> <span data-start="1168.9" data-end="1169.929">the users and</span> <span data-start="1169.929" data-end="1172.179">but it all cares is what's the data it</span> <span data-start="1172.179" data-end="1173.619">kind of look like when you give it to</span> <span data-start="1173.619" data-end="1175.99">the API client doesn't care where it</span> <span data-start="1175.99" data-end="1178.119">actually comes from and so the only</span> <span data-start="1178.119" data-end="1181.029">thing required is the query right and</span> <span data-start="1181.029" data-end="1183.49">here we have a field called site and the</span> <span data-start="1183.49" data-end="1186.399">site has requires a name which is an</span> <span data-start="1186.399" data-end="1187.749">enum so you don't have to put in quotes</span> <span data-start="1187.749" data-end="1190.149">and it can only be specific things and</span> <span data-start="1190.149" data-end="1191.71">it returns the site object guaranteed</span> <span data-start="1191.71" data-end="1192.97">that's what the explanation point mean</span> <span data-start="1192.97" data-end="1193.96">this means not normal</span> <span data-start="1193.96" data-end="1197.559">and the site itself has two different</span> <span data-start="1197.559" data-end="1199.33">kinds of things it's got some data the</span> <span data-start="1199.33" data-end="1201.34">idea name right and that comes from our</span> <span data-start="1201.34" data-end="1203.08">database and then it's got this lookup</span> <span data-start="1203.08" data-end="1205.749">field post and post takes the required</span> <span data-start="1205.749" data-end="1207.7">path it's a string and it will try to</span> <span data-start="1207.7" data-end="1209.769">give you a post maybe give you a post</span> <span data-start="1209.769" data-end="1211.99">it's not no I rather it is knowable so</span> <span data-start="1211.99" data-end="1214.45">it doesn't know you know for sure that</span> <span data-start="1214.45" data-end="1216.129">there is opposed to that path and that's</span> <span data-start="1216.129" data-end="1219.249">okay neither do we but there's no</span> <span data-start="1219.249" data-end="1220.749">difference here between data and lookup</span> <span data-start="1220.749" data-end="1224.049">fields and and that comes later in the</span> <span data-start="1224.049" data-end="1227.379">resolvers post is another example you</span> <span data-start="1227.379" data-end="1229.929">have ID path title body those are all</span> <span data-start="1229.929" data-end="1231.58">data they're just strings and numbers</span> <span data-start="1231.58" data-end="1233.74">you know they could be objects but but</span> <span data-start="1233.74" data-end="1236.289">they're data and the authors is a lookup</span> <span data-start="1236.289" data-end="1238.659">for the user the tags does a lookup for</span> <span data-start="1238.659" data-end="1240.759">the tags and we guarantee to give you an</span> <span data-start="1240.759" data-end="1242.35">array and that array is guaranteed to</span> <span data-start="1242.35" data-end="1245.23">have zero or more tags in it so if there</span> <span data-start="1245.23" data-end="1246.19">is anything in the array it's going to</span> <span data-start="1246.19" data-end="1247.45">be a time but it doesn't have to be</span> <span data-start="1247.45" data-end="1249.22">anything and if you use the type</span> <span data-start="1249.22" data-end="1251.23">language or if your type script you know</span> <span data-start="1251.23" data-end="1252.759">you'll notice that there's no way you</span> <span data-start="1252.759" data-end="1256.899">can type the length of an array and</span> <span data-start="1256.899" data-end="1258.34">users and types are boring they're just</span> <span data-start="1258.34" data-end="1262.029">data no that's great so the resolvers</span> <span data-start="1262.029" data-end="1263.919">you don't need a resolver for everything</span> <span data-start="1263.919" data-end="1265.539">just for the lookups right and this is</span> <span data-start="1265.539" data-end="1268.269">where it kind of gets like this is where</span> <span data-start="1268.269" data-end="1270.58">the infinite power and variability you</span> <span data-start="1270.58" data-end="1272.2">know of how you million ways you can do</span> <span data-start="1272.2" data-end="1274.09">things sort of as a paralyzing force</span> <span data-start="1274.09" data-end="1275.35">when you're starting with crafty well</span> <span data-start="1275.35" data-end="1278.08">but it just needs to return full objects</span> <span data-start="1278.08" data-end="1280.899">of other things this is the you know you</span> <span data-start="1280.899" data-end="1282.61">can do many things but this is the most</span> <span data-start="1282.61" data-end="1286.6">common case yeah and we do it per type</span> <span data-start="1286.6" data-end="1289.029">so our query has the site field and so</span> <span data-start="1289.029" data-end="1291.029">it gets a function and it gives you the</span> <span data-start="1291.029" data-end="1293.379">the root is nothing in the query case</span> <span data-start="1293.379" data-end="1295.179">but the argument object for the second</span> <span data-start="1295.179" data-end="1297.009">one if your call site had it required a</span> <span data-start="1297.009" data-end="1299.619">name the site is the post field and if</span> <span data-start="1299.619" data-end="1301.029">you're caught if you recall it requires</span> <span data-start="1301.029" data-end="1303.22">a path but it also gives you the site as</span> <span data-start="1303.22" data-end="1303.549">the</span> <span data-start="1303.549" data-end="1306.399">root of that woke up field and the post</span> <span data-start="1306.399" data-end="1308.019">itself you know you get the post and</span> <span data-start="1308.019" data-end="1309.34">there are no fields on those lookups and</span> <span data-start="1309.34" data-end="1311.259">so using that post you have to look up</span> <span data-start="1311.259" data-end="1312.7">the authors and have to look up the tags</span> <span data-start="1312.7" data-end="1317.44">and in practice we do it like this you</span> <span data-start="1317.44" data-end="1318.909">know so this is the site looking up its</span> <span data-start="1318.909" data-end="1321.639">post and so nemesis TV is something</span> <span data-start="1321.639" data-end="1322.96">called a labeled edge but it just means</span> <span data-start="1322.96" data-end="1325.33">you can you know on the site store a</span> <span data-start="1325.33" data-end="1326.86">path and have it be a reference to</span> <span data-start="1326.86" data-end="1329.259">another object and we look it up and if</span> <span data-start="1329.259" data-end="1330.879">it doesn't exist we return null which is</span> <span data-start="1330.879" data-end="1333.19">perfectly allowed by the schema and then</span> <span data-start="1333.19" data-end="1335.559">we have and then if it does exist we go</span> <span data-start="1335.559" data-end="1336.7">only find it and we return that object</span> <span data-start="1336.7" data-end="1338.859">in fact we return a promise for that</span> <span data-start="1338.859" data-end="1342.549">object which is just fine post is a</span> <span data-start="1342.549" data-end="1344.559">little more complex but the author will</span> <span data-start="1344.559" data-end="1346.179">actually each one is even more simple</span> <span data-start="1346.179" data-end="1348.489">the author looks for an edge to a user</span> <span data-start="1348.489" data-end="1351.789">you know and if and it returns it you</span> <span data-start="1351.789" data-end="1353.23">know pulls out the ID and then actually</span> <span data-start="1353.23" data-end="1354.97">goes and gets the user same thing for</span> <span data-start="1354.97" data-end="1356.799">the tags except it's an array so we get</span> <span data-start="1356.799" data-end="1359.08">all the edges for the for the tags and</span> <span data-start="1359.08" data-end="1360.34">then we just sort of map over and get</span> <span data-start="1360.34" data-end="1362.19">each one return it and promise all and</span> <span data-start="1362.19" data-end="1364.72">so this each returns the object you're</span> <span data-start="1364.72" data-end="1367.69">looking for now if you have ever worked</span> <span data-start="1367.69" data-end="1371.769">and say rails the concept of n plus one</span> <span data-start="1371.769" data-end="1374.2">comes up all the time and this is when</span> <span data-start="1374.2" data-end="1375.639">you're making too many round trips to</span> <span data-start="1375.639" data-end="1377.47">the database and it slows everything</span> <span data-start="1377.47" data-end="1381.039">down and I it's really just not a</span> <span data-start="1381.039" data-end="1384.34">problem if you match the query of the</span> <span data-start="1384.34" data-end="1386.529">commands to match the queries right and</span> <span data-start="1386.529" data-end="1388.989">so data loader is a little utility it's</span> <span data-start="1388.989" data-end="1391.72">like a couple hundred lines and it lets</span> <span data-start="1391.72" data-end="1394.809">you take all the requests you make in</span> <span data-start="1394.809" data-end="1398.619">one once event loop and batch them all</span> <span data-start="1398.619" data-end="1399.94">together so you give it a little</span> <span data-start="1399.94" data-end="1402.179">function do the lookup and I made up a</span> <span data-start="1402.179" data-end="1404.559">function here get a bunch of IDs then</span> <span data-start="1404.559" data-end="1406.059">those how to look up like a whole array</span> <span data-start="1406.059" data-end="1408.669">of IDs and so you can go and ask for a</span> <span data-start="1408.669" data-end="1410.2">bunch of objects and then it's going to</span> <span data-start="1410.2" data-end="1413.799">call your your batch your bachelor your</span> <span data-start="1413.799" data-end="1415.989">get bunch of IDs with addy DuPage array</span> <span data-start="1415.989" data-end="1417.399">of all those things are trying to get</span> <span data-start="1417.399" data-end="1421.299">and this allows you to instead of having</span> <span data-start="1421.299" data-end="1424.239">if I load 50 posts and all their authors</span> <span data-start="1424.239" data-end="1425.109">instead of loading each other</span> <span data-start="1425.109" data-end="1427.539">individually it's going to go and give</span> <span data-start="1427.539" data-end="1429.97">me 50 IDs for those 50 authors so</span> <span data-start="1429.97" data-end="1432.369">instead of doing a new request and you</span> <span data-start="1432.369" data-end="1434.649">look up to the database for each item it</span> <span data-start="1434.649" data-end="1435.92">does it for each depth</span> <span data-start="1435.92" data-end="1439.07">the graph this made it much faster and</span> <span data-start="1439.07" data-end="1440.6">we were able to abuse this a little bit</span> <span data-start="1440.6" data-end="1444.14">and we're able to do it with with Redis</span> <span data-start="1444.14" data-end="1445.43">itself there's something called</span> <span data-start="1445.43" data-end="1447.41">pipelining which lets you put a whole</span> <span data-start="1447.41" data-end="1449.24">bunch of crazed together and no one</span> <span data-start="1449.24" data-end="1451.49">query and send them all and so if we</span> <span data-start="1451.49" data-end="1453.26">wanted to</span> <span data-start="1453.26" data-end="1456.61">this is nemesis DB again which can take</span> </p>
<p><span data-start="1456.61" data-end="1458.63">Redis object or can take your Redis</span> <span data-start="1458.63" data-end="1460.36">loader object which is the same shape</span> <span data-start="1460.36" data-end="1462.83">and if you go and you ask for all these</span> <span data-start="1462.83" data-end="1465.32">notes at the same time with Redis and</span> <span data-start="1465.32" data-end="1467.18">this is not a fair benchmark I ran out</span> <span data-start="1467.18" data-end="1469.64">on my own machine and localhost but it</span> <span data-start="1469.64" data-end="1472.28">will do four different queries and vote</span> <span data-start="1472.28" data-end="1474.86">with Redis loader it does one query with</span> <span data-start="1474.86" data-end="1476.27">with less because it doesn't ask for</span> <span data-start="1476.27" data-end="1478.63">node twice and it's significantly faster</span> <span data-start="1478.63" data-end="1480.77">when you added real network in there</span> <span data-start="1480.77" data-end="1482.84">maybe you need to multiply this by 10 or</span> <span data-start="1482.84" data-end="1486.17">100 but it's still real fast so even if</span> <span data-start="1486.17" data-end="1487.67">we didn't match I don't think I would</span> <span data-start="1487.67" data-end="1490.67">have noticed for our setup but for most</span> <span data-start="1490.67" data-end="1492.23">databases which maybe it's a couple</span> <span data-start="1492.23" data-end="1494.6">milliseconds between responses you know</span> <span data-start="1494.6" data-end="1495.92">it's a good idea to keep them together</span> <span data-start="1495.92" data-end="1498.08">and this keeps you protected I guess it</span> <span data-start="1498.08" data-end="1500.03">becomes from an N plus 1 2 and plus 1</span> <span data-start="1500.03" data-end="1501.86">divided by you know whatever is a</span> <span data-start="1501.86" data-end="1503.63">reasonable batch size 200 or something</span> <span data-start="1503.63" data-end="1510.8">like that the tooling we use to to put</span> <span data-start="1510.8" data-end="1513.17">to deploy our lambdas right now we're</span> <span data-start="1513.17" data-end="1515.81">using Sammy which uses Amazon Sam this</span> <span data-start="1515.81" data-end="1517.94">serverless application model under the</span> <span data-start="1517.94" data-end="1521.9">hood but Sam is kind of annoying uh I'm</span> <span data-start="1521.9" data-end="1522.17">sorry</span> </p>
<p><span data-start="1522.17" data-end="1526.46">Sam is kind of verbose and so we made a</span> <span data-start="1526.46" data-end="1528.11">little wrapper that helps you know</span> <span data-start="1528.11" data-end="1531.26">generate some useful scripts and so that</span> <span data-start="1531.26" data-end="1532.76">were you Sammy for most of our projects</span> </p>
<p><span data-start="1532.76" data-end="1535.73">I'm really excited about architect I</span> <span data-start="1535.73" data-end="1539.21">find out of our codes and it lets you</span> <span data-start="1539.21" data-end="1540.92">describe the kind of server this</span> <span data-start="1540.92" data-end="1541.82">environment you want</span> <span data-start="1541.82" data-end="1543.83">dynamodb tables there's a little</span> <span data-start="1543.83" data-end="1546.71">prescriptive but it's it's it's super</span> <span data-start="1546.71" data-end="1548.36">straightforward to use and I think it</span> <span data-start="1548.36" data-end="1549.83">makes getting started aflame just super</span> <span data-start="1549.83" data-end="1552.26">easy and of course we built a tool</span> <span data-start="1552.26" data-end="1554">called shop which I forgot to put in a</span> <span data-start="1554" data-end="1556.31">description but chef is the shepherd for</span> <span data-start="1556.31" data-end="1558.7">your lambdas</span> <span data-start="1558.7" data-end="1562.09">and chef is not prescriptive it just</span> <span data-start="1562.09" data-end="1563.8">sets up like like here's your functions</span> <span data-start="1563.8" data-end="1565.51">in a folder here's a web pack like</span> <span data-start="1565.51" data-end="1568.33">config that works and will will deploy</span> <span data-start="1568.33" data-end="1571.33">stuff and about a second or two and it's</span> <span data-start="1571.33" data-end="1572.86">a fastest way to get something out there</span> <span data-start="1572.86" data-end="1574.36">because it escapes CloudFormation and</span> <span data-start="1574.36" data-end="1576.16">all those other big things that if you</span> <span data-start="1576.16" data-end="1577.54">don't know about yet maybe get in the</span> <span data-start="1577.54" data-end="1581.32">way but it still works it's great we</span> <span data-start="1581.32" data-end="1584.35">just do we we've required more and it's</span> <span data-start="1584.35" data-end="1585.43">easier to go to Sam</span> <span data-start="1585.43" data-end="1589.27">or rather Sammy I think that's all you</span> <span data-start="1589.27" data-end="1591.91">need to get goin I think you could take</span> <span data-start="1591.91" data-end="1594.76">this and if you go to the repo I'd have</span> <span data-start="1594.76" data-end="1596.2">all the code there and you can choose</span> <span data-start="1596.2" data-end="1597.97">one of those deploy tools and you can</span> <span data-start="1597.97" data-end="1603.28">run your API on lambda today Redis</span> <span data-start="1603.28" data-end="1605.2">running Redis you know for Hobby project</span> <span data-start="1605.2" data-end="1606.58">is a little more expensive so you can</span> <span data-start="1606.58" data-end="1608.41">swap that out for anything you want like</span> <span data-start="1608.41" data-end="1610.63">literally anything you want</span> <span data-start="1610.63" data-end="1615.88">so DynamoDB or Postgres you know and it</span> <span data-start="1615.88" data-end="1618.3">will work the same way</span> <span data-start="1618.3" data-end="1621.46">nemesis isn't finished and you can</span> <span data-start="1621.46" data-end="1623.23">totally help and if you have opinions or</span> <span data-start="1623.23" data-end="1624.7">if you think we could achieve this with</span> <span data-start="1624.7" data-end="1626.71">a database that already exists you</span> <span data-start="1626.71" data-end="1628.42">should come and try to convince me of</span> <span data-start="1628.42" data-end="1628.69">that</span> <span data-start="1628.69" data-end="1630.22">because it would be awesome not to build</span> <span data-start="1630.22" data-end="1634.93">anything we have a ton of open-source</span> <span data-start="1634.93" data-end="1636.81">libraries that we use for our stuff</span> <span data-start="1636.81" data-end="1639.49">you'll you we just share them and</span> <span data-start="1639.49" data-end="1640.42">sometimes we sneak them into other</span> <span data-start="1640.42" data-end="1643.69">things but everything from the command</span> <span data-start="1643.69" data-end="1646.78">batching — you know officially storing</span> </p>
<p><span data-start="1646.78" data-end="1649.57">JSON documents of trees to working with</span> <span data-start="1649.57" data-end="1651.01">async iterators which I want to</span> <span data-start="1651.01" data-end="1653.17">completely replace all my streams with -</span> <span data-start="1653.17" data-end="1654.79">using async functions and streams with</span> <span data-start="1654.79" data-end="1656.8">blue stream which which is was our work</span> <span data-start="1656.8" data-end="1658.33">around before I think iterators was the</span> <span data-start="1658.33" data-end="1662.23">place you should check it out</span> <span data-start="1662.23" data-end="1664.63">love love any feedback and help and</span> <span data-start="1664.63" data-end="1665.92">hopefully it makes things working with</span> <span data-start="1665.92" data-end="1668.91">whatever you're doing somewhat easier</span> <span data-start="1668.91" data-end="1672.22">Thanks</span> </p>
</section>