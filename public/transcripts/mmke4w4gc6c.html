<section>
<p><span data-start="15.779" data-end="18.16">yeah I'm Lanie kenzo I'm a software</span> <span data-start="18.16" data-end="19.81">engineer i work on the product</span> <span data-start="19.81" data-end="22.75">infrastructure team at facebook and back</span> <span data-start="22.75" data-end="25.48">in january at react Jas comp to my</span> <span data-start="25.48" data-end="27.4">teammates dan Schaefer and jing chen</span> <span data-start="27.4" data-end="30.16">gave a talk introducing relay which is</span> <span data-start="30.16" data-end="31.779">our data fetching framework for react</span> <span data-start="31.779" data-end="33.73">and the query language that it uses</span> <span data-start="33.73" data-end="36.64">called graph ql so today in this talk</span> <span data-start="36.64" data-end="38.65">i'm going to start with a description of</span> <span data-start="38.65" data-end="40.75">relay engraft well for anyone who didn't</span> <span data-start="40.75" data-end="41.86">see their talk or who needs a refresher</span> <span data-start="41.86" data-end="43.36">and then i'm going to dive into some</span> <span data-start="43.36" data-end="47.25">specific parts of the real a framework</span> <span data-start="47.25" data-end="49.66">so let's start by thinking about how we</span> <span data-start="49.66" data-end="51.19">at facebook we're doing client</span> <span data-start="51.19" data-end="53.559">development a year ago at that point</span> <span data-start="53.559" data-end="56.02">we've developed react and we had also</span> <span data-start="56.02" data-end="58.059">developed the flux architecture which</span> <span data-start="58.059" data-end="60.07">provides a pattern for one-way data flow</span> <span data-start="60.07" data-end="62.71">through an application and when we use</span> <span data-start="62.71" data-end="65.11">both react and flux we found that we can</span> <span data-start="65.11" data-end="66.31">move faster in the development process</span> <span data-start="66.31" data-end="68.2">and we can build more robust reliable</span> <span data-start="68.2" data-end="71.53">applications but there was one big</span> <span data-start="71.53" data-end="74.2">problem that neither react nor flux</span> <span data-start="74.2" data-end="77.11">really addressed that almost every</span> <span data-start="77.11" data-end="78.67">client developer has faced at one time</span> <span data-start="78.67" data-end="80.59">or another which is what's the best way</span> <span data-start="80.59" data-end="82.479">to fetch data from the server and to</span> <span data-start="82.479" data-end="84.16">organize that data once it's on the</span> <span data-start="84.16" data-end="87.55">client so let's look at how data</span> <span data-start="87.55" data-end="88.78">fetching might work in an application</span> <span data-start="88.78" data-end="91.869">built with reactant flux I'm going to</span> <span data-start="91.869" data-end="93.67">use this example of a news feed story</span> <span data-start="93.67" data-end="96.61">that I wrote about Jay escon and in</span> <span data-start="96.61" data-end="98.44">particular its likes and comments</span> <span data-start="98.44" data-end="101.17">section on the bottom so this like and</span> <span data-start="101.17" data-end="103.75">comment box is was one of the first</span> <span data-start="103.75" data-end="105.31">parts of face book that we wrote with</span> <span data-start="105.31" data-end="107.83">reactant flux it's a really central part</span> <span data-start="107.83" data-end="109.959">of Facebook one where you get people</span> <span data-start="109.959" data-end="111.7">from a bunch of different teams coming</span> <span data-start="111.7" data-end="113.709">in and changing it frequently whether</span> <span data-start="113.709" data-end="115.209">they're updating the design or adding</span> <span data-start="115.209" data-end="117.19">new features so it's kind of a hot hot</span> <span data-start="117.19" data-end="120.819">part of Facebook so let's consider the</span> <span data-start="120.819" data-end="123.34">example of introducing stickers and</span> <span data-start="123.34" data-end="124.599">comments which is something that we</span> <span data-start="124.599" data-end="128.679">actually did last fall let's say that in</span> <span data-start="128.679" data-end="130.5">this part of the application our</span> <span data-start="130.5" data-end="132.94">component tree consists of this comment</span> <span data-start="132.94" data-end="136.18">box which contains a comment list which</span> <span data-start="136.18" data-end="139.33">contains a series of comment items so</span> <span data-start="139.33" data-end="141.189">how does each of these components get</span> <span data-start="141.189" data-end="143.829">the data that it needs the data comes</span> <span data-start="143.829" data-end="145.209">from the server and then it will get</span> <span data-start="145.209" data-end="145.66">past</span> <span data-start="145.66" data-end="147.88">through the component tree so comment</span> <span data-start="147.88" data-end="149.68">box is going to get some set of data and</span> <span data-start="149.68" data-end="151.69">then it will take a subset of that and</span> <span data-start="151.69" data-end="154.3">pass it into comment list and then</span> <span data-start="154.3" data-end="155.71">comment list will take subsets of that</span> <span data-start="155.71" data-end="157.36">data and pass that into each of the</span> <span data-start="157.36" data-end="160.48">comment items in this model the</span> <span data-start="160.48" data-end="162.58">important thing to notice is that every</span> <span data-start="162.58" data-end="164.53">component needs to be aware of the data</span> <span data-start="164.53" data-end="166.39">that its children need so that it can</span> <span data-start="166.39" data-end="168.55">pass the right data down and then that</span> <span data-start="168.55" data-end="169.96">server on point up there needs to be</span> <span data-start="169.96" data-end="171.49">aware of the data required by every</span> <span data-start="171.49" data-end="174.4">single component in that tree so in</span> <span data-start="174.4" data-end="176.05">other words the implementation details</span> <span data-start="176.05" data-end="178.33">of each component the details of what</span> <span data-start="178.33" data-end="180.13">exact data each component needs are</span> <span data-start="180.13" data-end="182.35">leaked up to the parents and to the</span> <span data-start="182.35" data-end="185.71">server why does this matter well it</span> <span data-start="185.71" data-end="187.3">means that if you come along and you</span> <span data-start="187.3" data-end="188.65">want to introduce sticker comments you</span> <span data-start="188.65" data-end="190.39">can't just make a change in comment item</span> <span data-start="190.39" data-end="191.95">you're also going to need to change</span> <span data-start="191.95" data-end="194.98">comment list comment box and that server</span> <span data-start="194.98" data-end="198.34">endpoint this is not cool when you need</span> <span data-start="198.34" data-end="200.65">to change all those files especially</span> <span data-start="200.65" data-end="201.94">when you have different people coming in</span> <span data-start="201.94" data-end="203.38">all trying to make their changes and</span> <span data-start="203.38" data-end="204.91">needing to modify all those files every</span> <span data-start="204.91" data-end="206.89">time you end up with more conflicts and</span> <span data-start="206.89" data-end="208.99">just generally slower development</span> <span data-start="208.99" data-end="212.5">process moreover things can get pretty</span> <span data-start="212.5" data-end="214.15">confusing when you have your data</span> <span data-start="214.15" data-end="215.59">fetching logic in one place on the</span> <span data-start="215.59" data-end="217.66">server and then you're rendering logic</span> <span data-start="217.66" data-end="219.97">on the client so let's say that you look</span> <span data-start="219.97" data-end="222.34">at your server endpoint and you see that</span> <span data-start="222.34" data-end="223.9">you're fetching the birthdays for all</span> <span data-start="223.9" data-end="226.99">the commenters on a story it's really</span> <span data-start="226.99" data-end="228.61">hard to know at a glance whether and</span> <span data-start="228.61" data-end="230.74">where this birthday data is being used</span> <span data-start="230.74" data-end="233.53">in your application on the client so</span> <span data-start="233.53" data-end="235.6">maybe someone ran an a/b test a few</span> <span data-start="235.6" data-end="237.07">months ago and they wanted to see what</span> <span data-start="237.07" data-end="238.3">would happen if they added birthdays for</span> <span data-start="238.3" data-end="240.01">commenters and it didn't really work</span> <span data-start="240.01" data-end="241.63">that well so they removed that code from</span> <span data-start="241.63" data-end="247.42">the client and now oops we have this</span> <span data-start="247.42" data-end="249.37">over fetching situation where we're</span> <span data-start="249.37" data-end="251.23">loading that birthday sending it to the</span> <span data-start="251.23" data-end="252.76">client and then we're not doing anything</span> <span data-start="252.76" data-end="255.58">with it and so it's just wasteful so</span> <span data-start="255.58" data-end="256.66">maybe we're going to try to do a good</span> <span data-start="256.66" data-end="259.09">deed and clean up the server remove that</span> <span data-start="259.09" data-end="260.859">birthday code without realizing that</span> <span data-start="260.859" data-end="262.21">there actually is some corner of</span> <span data-start="262.21" data-end="264.04">application where we're still using the</span> <span data-start="264.04" data-end="266.14">birthdays and now we have an under</span> <span data-start="266.14" data-end="267.7">fetching bug so we're going to send some</span> <span data-start="267.7" data-end="270.15">data the birthday won't be there and</span> <span data-start="270.15" data-end="275.229">things won't be good it's pretty easy to</span> <span data-start="275.229" data-end="277.93">for these data fetching pieces and the</span> <span data-start="277.93" data-end="278.94">and the rendered pieces</span> <span data-start="278.94" data-end="280.44">to get out of sync like this and it will</span> <span data-start="280.44" data-end="282">often cause either over fetching or</span> <span data-start="282" data-end="285.87">under fetching so how would this work in</span> <span data-start="285.87" data-end="288.45">a perfect world ideally if we wanted to</span> <span data-start="288.45" data-end="290.1">introduce sticker comments we would only</span> <span data-start="290.1" data-end="291.6">need to change that comment item</span> <span data-start="291.6" data-end="294.12">component and more generally rather than</span> <span data-start="294.12" data-end="295.89">having our data fetching logic strewn</span> <span data-start="295.89" data-end="297.93">throughout the application and on the</span> <span data-start="297.93" data-end="300.9">server you reside in just one place the</span> <span data-start="300.9" data-end="302.51">same place where we do our rendering</span> <span data-start="302.51" data-end="305.25">this is the idea at the core of relay</span> <span data-start="305.25" data-end="307.47">but to make development easier we should</span> <span data-start="307.47" data-end="309.12">keep our logic for data fetching and</span> <span data-start="309.12" data-end="311.76">rendering in the same place namely</span> <span data-start="311.76" data-end="318.3">within the react component so rather</span> <span data-start="318.3" data-end="320.01">than just containing the logic to render</span> <span data-start="320.01" data-end="321.66">itself like a traditional react</span> <span data-start="321.66" data-end="324.18">component a real a component also</span> <span data-start="324.18" data-end="326.28">contains a declaration of the data that</span> <span data-start="326.28" data-end="328.76">it needs in the form of a data query</span> <span data-start="328.76" data-end="331.23">this way when someone wants to make a</span> <span data-start="331.23" data-end="332.97">small change they can just find the</span> <span data-start="332.97" data-end="335.22">relevant component change its data query</span> <span data-start="335.22" data-end="337.32">and its render method and then they're</span> <span data-start="337.32" data-end="338.64">done you don't they don't need to go</span> <span data-start="338.64" data-end="340.05">change parent components or touch the</span> <span data-start="340.05" data-end="342.42">server with the data query and the</span> <span data-start="342.42" data-end="344.01">rendering in one place it's also a lot</span> <span data-start="344.01" data-end="345.66">easier to know when you're fetching data</span> <span data-start="345.66" data-end="347.49">that you don't don't use or trying to</span> <span data-start="347.49" data-end="349.74">use data that you didn't fetch so you're</span> <span data-start="349.74" data-end="351.39">less likely to get those over fetching</span> <span data-start="351.39" data-end="354.419">and under fetching bugs in order to</span> <span data-start="354.419" data-end="356.31">achieve all these benefits of putting</span> <span data-start="356.31" data-end="358.14">the data query in the component we</span> <span data-start="358.14" data-end="359.85">needed a common way for the components</span> <span data-start="359.85" data-end="362.13">to declare their data requirements and</span> <span data-start="362.13" data-end="365.79">this is where graph ql comes in graph UL</span> <span data-start="365.79" data-end="368.13">at the data queering language and for</span> <span data-start="368.13" data-end="370.44">the last couple years our client</span> <span data-start="370.44" data-end="371.88">applications at facebook have been using</span> <span data-start="371.88" data-end="374.36">graphs well to describe their data needs</span> <span data-start="374.36" data-end="376.95">let's look at an example of what a graph</span> <span data-start="376.95" data-end="379.23">ql query actually might look like so</span> <span data-start="379.23" data-end="380.76">let's let's think about the data that we</span> <span data-start="380.76" data-end="384.84">need to render a cup of comments author</span> <span data-start="384.84" data-end="387.84">here so we want yet the ID of the person</span> <span data-start="387.84" data-end="390.51">the person's name and then some data</span> <span data-start="390.51" data-end="392.04">that we need to render the profile</span> <span data-start="392.04" data-end="394.71">picture so look what happens if we</span> <span data-start="394.71" data-end="396.09">highlight just the fields here and</span> <span data-start="396.09" data-end="398.85">remove the values that's a graft well</span> <span data-start="398.85" data-end="401.61">query as you can see the query here it</span> <span data-start="401.61" data-end="403.35">not only expresses the data that it</span> <span data-start="403.35" data-end="405.48">needs but also the precise nested</span> <span data-start="405.48" data-end="407.55">structure that we want the response to</span> <span data-start="407.55" data-end="410.82">that query to have graph ql is designed</span> <span data-start="410.82" data-end="412.28">to be a thin layer over</span> <span data-start="412.28" data-end="414.65">existing data model so that clients can</span> <span data-start="414.65" data-end="416.21">get the benefit of writing queries like</span> <span data-start="416.21" data-end="417.98">this one without the whole server</span> <span data-start="417.98" data-end="421.61">needing to be totally rewritten another</span> <span data-start="421.61" data-end="423.61">important feature of reps well is that</span> <span data-start="423.61" data-end="426.56">you can compose queries so basically one</span> <span data-start="426.56" data-end="428.03">graph field query can be built up of</span> <span data-start="428.03" data-end="430.91">utter gaps filled queries so this means</span> <span data-start="430.91" data-end="432.95">that if you take a component tree like</span> <span data-start="432.95" data-end="434.87">this for an application on the one hand</span> <span data-start="434.87" data-end="437.75">you can look at it as a way to build a</span> <span data-start="437.75" data-end="439.28">view for the whole application so each</span> <span data-start="439.28" data-end="441.83">parent component will render its</span> <span data-start="441.83" data-end="445.25">children in the same way you can take</span> <span data-start="445.25" data-end="446.72">this component tree and look at it as a</span> <span data-start="446.72" data-end="448.34">guide for how to build the graph ql</span> <span data-start="448.34" data-end="450.08">query for the whole application each</span> <span data-start="450.08" data-end="452.06">parent components graph GL query is</span> <span data-start="452.06" data-end="453.98">composed from the queries of its</span> <span data-start="453.98" data-end="457.76">children so now that you see what graft</span> <span data-start="457.76" data-end="459.47">well is we can look at how relay works</span> <span data-start="459.47" data-end="461.87">overall each relay component contains</span> <span data-start="461.87" data-end="464.6">this query and the render method relays</span> <span data-start="464.6" data-end="465.919">going to take the queries from each</span> <span data-start="465.919" data-end="467.63">component and build up that overall</span> <span data-start="467.63" data-end="470.27">query and send that to the server the</span> <span data-start="470.27" data-end="473">server is going to respond and then</span> <span data-start="473" data-end="474.59">really puts our response data into a</span> <span data-start="474.59" data-end="476.96">single store and then it will use that</span> <span data-start="476.96" data-end="479.24">data to construct prop that it sends out</span> <span data-start="479.24" data-end="482.12">to the components for rendering at its</span> <span data-start="482.12" data-end="485.33">core this is a flux application the only</span> <span data-start="485.33" data-end="486.53">difference is that rather than having</span> <span data-start="486.53" data-end="488.75">several or many stores a relay</span> <span data-start="488.75" data-end="490.52">application just has this one single</span> <span data-start="490.52" data-end="492.919">store containing generic logic for</span> <span data-start="492.919" data-end="496.039">dealing with graft well data having this</span> <span data-start="496.039" data-end="497.78">single store provides a number of nice</span> <span data-start="497.78" data-end="500.3">benefits so for one it reduces the need</span> <span data-start="500.3" data-end="503.36">for a lot of the flux boilerplate it</span> <span data-start="503.36" data-end="505.19">also helps with data consistency across</span> <span data-start="505.19" data-end="507.07">different parts of the application and</span> <span data-start="507.07" data-end="509.87">finally it lets us build certain common</span> <span data-start="509.87" data-end="511.52">product pattern something like pagin</span> <span data-start="511.52" data-end="513.56">aiding through a list of items something</span> <span data-start="513.56" data-end="515.06">that you guys have probably implemented</span> <span data-start="515.06" data-end="518.33">at least one right into relay so that</span> <span data-start="518.33" data-end="519.89">people don't need to build them from</span> <span data-start="519.89" data-end="524.54">scratch every time so now that we see</span> <span data-start="524.54" data-end="526.01">how really works let's look back at this</span> <span data-start="526.01" data-end="527.57">sticker common example and see how much</span> <span data-start="527.57" data-end="529.42">easier relay is going to make our lives</span> <span data-start="529.42" data-end="531.68">rather than needing to change a bunch of</span> <span data-start="531.68" data-end="533.6">files up the whole tree and the server</span> <span data-start="533.6" data-end="535.73">we just changed comment item so more</span> <span data-start="535.73" data-end="537.68">specifically let's say that this is part</span> <span data-start="537.68" data-end="540.02">of our graphical query right now we're</span> <span data-start="540.02" data-end="541.67">just putting for the text of the comment</span> <span data-start="541.67" data-end="544.62">and now we can also</span> <span data-start="544.62" data-end="546.66">with a sticker use that in our render</span> <span data-start="546.66" data-end="550.02">method and we're done we can go build</span> <span data-start="550.02" data-end="551.52">other awesome stuff in the time that we</span> <span data-start="551.52" data-end="552.99">would have spent changing those other</span> <span data-start="552.99" data-end="556.71">files so really solves this big problem</span> <span data-start="556.71" data-end="558.57">of how to fetch data in a way that we</span> <span data-start="558.57" data-end="560.76">found scales really nicely to a complex</span> <span data-start="560.76" data-end="562.56">application being developed by a big</span> <span data-start="562.56" data-end="564.51">engineering team so because you have</span> <span data-start="564.51" data-end="565.86">that data query and the render method</span> <span data-start="565.86" data-end="568.44">encapsulated within the component it's</span> <span data-start="568.44" data-end="570.24">easy for a lot of people to work on a</span> <span data-start="570.24" data-end="572.01">lot of different parts of an application</span> <span data-start="572.01" data-end="575.01">at once so I can make my changes my</span> <span data-start="575.01" data-end="576.51">teammates can make their changes people</span> <span data-start="576.51" data-end="577.98">on other teams can make their changes</span> <span data-start="577.98" data-end="579.18">and we don't need to worry as much about</span> <span data-start="579.18" data-end="580.8">whether we're stepping on each other's</span> <span data-start="580.8" data-end="583.08">toes and whether we have full context on</span> <span data-start="583.08" data-end="584.61">what every other person is doing at that</span> <span data-start="584.61" data-end="588.9">time so far you've heard about the read</span> <span data-start="588.9" data-end="590.85">path and relay but a framework would be</span> <span data-start="590.85" data-end="593.16">would have limited usefulness if it</span> <span data-start="593.16" data-end="594.75">didn't also support a right path if it</span> <span data-start="594.75" data-end="597.3">didn't let developers give users a way</span> <span data-start="597.3" data-end="599.64">to take actions that does liking a story</span> <span data-start="599.64" data-end="603.15">maybe even liking my own story so I'll</span> <span data-start="603.15" data-end="604.95">use the term mutations to refer to these</span> <span data-start="604.95" data-end="606.87">actions that a user can take in an</span> <span data-start="606.87" data-end="609.3">application so in facebook this could be</span> <span data-start="609.3" data-end="611.07">something like sharing a link our suit</span> <span data-start="611.07" data-end="614.09">came to an event or poking a friend and</span> <span data-start="614.09" data-end="616.32">for the rest of the talk I'll focus on</span> <span data-start="616.32" data-end="620.73">how mutations work in relay so to start</span> </p>
<p><span data-start="620.73" data-end="622.62">I'm going to go back and talk about how</span> <span data-start="622.62" data-end="624.39">we at facebook at least we're building</span> <span data-start="624.39" data-end="627">mutations before relay so I joined</span> <span data-start="627" data-end="628.71">facebook a little over three years ago</span> <span data-start="628.71" data-end="629.91">and I was working on the newsfeed</span> <span data-start="629.91" data-end="632.07">product team mostly working on the</span> <span data-start="632.07" data-end="634.2">homepage of the website and i got really</span> <span data-start="634.2" data-end="636">familiar with writing mutations like</span> <span data-start="636" data-end="637.83">this i would write some custom</span> <span data-start="637.83" data-end="640.47">JavaScript and I would write a custom</span> <span data-start="640.47" data-end="642.6">server on point I would have the</span> <span data-start="642.6" data-end="644.7">JavaScript called that in point I would</span> <span data-start="644.7" data-end="646.65">have the endpoint return data and</span> <span data-start="646.65" data-end="649.71">basically whatever format I chose then I</span> <span data-start="649.71" data-end="650.97">would have the JavaScript make sense of</span> <span data-start="650.97" data-end="652.5">that data and update the views</span> <span data-start="652.5" data-end="655.35">accordingly usually by manually updating</span> <span data-start="655.35" data-end="658.29">the DOM and then maybe I wanted to also</span> <span data-start="658.29" data-end="660.48">use that same endpoint from a different</span> <span data-start="660.48" data-end="662.43">part of the client I would need to shove</span> <span data-start="662.43" data-end="664.2">some more messy logic in there to make</span> <span data-start="664.2" data-end="666.48">sure that the server was returning the</span> <span data-start="666.48" data-end="669">data that the client needed regardless</span> <span data-start="669" data-end="670.5">of where it was being called from and</span> <span data-start="670.5" data-end="673.71">the key word here is custom basically</span> <span data-start="673.71" data-end="675.48">every time my team major I wanted to</span> <span data-start="675.48" data-end="677.13">implement a new mutation we had to start</span> <span data-start="677.13" data-end="678.74">from scratch</span> </p>
<p><span data-start="678.74" data-end="680.72">I personally really disliked this</span> <span data-start="680.72" data-end="682.31">pattern of writing mutations with these</span> <span data-start="682.31" data-end="684.44">custom endpoints and custom client code</span> <span data-start="684.44" data-end="686.06">if I'll really repetitive an error prone</span> <span data-start="686.06" data-end="688.94">to me and in my mind this pattern became</span> <span data-start="688.94" data-end="690.35">kind of synonymous with writing</span> <span data-start="690.35" data-end="692.99">JavaScript because I had just started a</span> <span data-start="692.99" data-end="694.43">Facebook I came right out of school this</span> <span data-start="694.43" data-end="695.839">is what I did every time I would write</span> </p>
<p><span data-start="695.839" data-end="697.88">JavaScript so to me this was JavaScript</span> <span data-start="697.88" data-end="699.649">and so I came to think of myself as</span> <span data-start="699.649" data-end="701.12">someone who really didn't like</span> <span data-start="701.12" data-end="702.43">JavaScript and didn't want to write it</span> <span data-start="702.43" data-end="704.48">it wasn't until I was introduced to</span> <span data-start="704.48" data-end="706.79">react and flux that I started to realize</span> <span data-start="706.79" data-end="708.68">that I don't dislike JavaScript I just</span> <span data-start="708.68" data-end="711.89">like this kind of gross pattern of using</span> <span data-start="711.89" data-end="714.11">it so I wouldn't have guessed three</span> <span data-start="714.11" data-end="715.97">years ago that I would be now on a team</span> <span data-start="715.97" data-end="717.26">where I'm writing JavaScript full-time</span> <span data-start="717.26" data-end="719.51">or here with all of you guys but a</span> <span data-start="719.51" data-end="721.79">JavaScript conference but here I am and</span> </p>
<p><span data-start="721.79" data-end="724.67">I'm pretty excited about it so back to</span> <span data-start="724.67" data-end="727.31">mutations we we took a step in the right</span> <span data-start="727.31" data-end="728.779">direction when we introduced a more</span> <span data-start="728.779" data-end="731.45">structured API for doing rights as part</span> <span data-start="731.45" data-end="734.36">of our graph API so this was nice</span> <span data-start="734.36" data-end="735.29">because it gave the client a</span> <span data-start="735.29" data-end="736.94">standardized way to specify what</span> <span data-start="736.94" data-end="739.88">mutation they wanted to do and also to</span> <span data-start="739.88" data-end="741.2">provide the necessary inputs in a</span> <span data-start="741.2" data-end="744.74">structured way but what about the data</span> <span data-start="744.74" data-end="747.89">that that the server returns then each</span> <span data-start="747.89" data-end="749.839">right endpoint in the graph API is being</span> <span data-start="749.839" data-end="751.279">used by a bunch of different clients</span> <span data-start="751.279" data-end="753.14">there's not really a great way to make</span> <span data-start="753.14" data-end="754.399">sure that the server is going to return</span> <span data-start="754.399" data-end="756.32">the data that any client might need to</span> <span data-start="756.32" data-end="759.29">update itself so what we would do</span> <span data-start="759.29" data-end="760.91">instead is usually provide these pretty</span> <span data-start="760.91" data-end="763.459">minimal responses usually just an ID so</span> <span data-start="763.459" data-end="765.5">maybe if it was the mutation was writing</span> <span data-start="765.5" data-end="766.94">a comment we will just return the idea</span> <span data-start="766.94" data-end="768.829">of the new comment or maybe even just a</span> <span data-start="768.829" data-end="771.11">boolean saying this mutation succeeded</span> <span data-start="771.11" data-end="774.8">or it did and so at that point there's</span> <span data-start="774.8" data-end="776.75">two main options for how you update the</span> <span data-start="776.75" data-end="779.24">client you can guess you can say okay I</span> <span data-start="779.24" data-end="781.04">got this boolean things worked so this</span> <span data-start="781.04" data-end="782.42">is how I think the data should look now</span> <span data-start="782.42" data-end="785.54">or you could do a second round trip go</span> <span data-start="785.54" data-end="787.1">back to the server and get the data that</span> <span data-start="787.1" data-end="788.779">you need if you want to be really sure</span> <span data-start="788.779" data-end="792.2">that it's right the first option has</span> <span data-start="792.2" data-end="794.87">issues with correctness potentially and</span> <span data-start="794.87" data-end="797.089">the second has issues with efficiency so</span> <span data-start="797.089" data-end="799.75">neither one of those is really ideal</span> <span data-start="799.75" data-end="802.279">ideally the response from the server</span> <span data-start="802.279" data-end="804.23">would contain exactly the information</span> <span data-start="804.23" data-end="807.11">that the client needs top date itself so</span> <span data-start="807.11" data-end="809.75">let's talk about liking a story let's</span> <span data-start="809.75" data-end="811.19">say we have this mobile client and it</span> <span data-start="811.19" data-end="812.62">shows the number of people who</span> <span data-start="812.62" data-end="814.9">like the story then we would want the</span> <span data-start="814.9" data-end="816.76">server if you did a like to return the</span> <span data-start="816.76" data-end="818.86">new light count so that we could update</span> <span data-start="818.86" data-end="822.73">the story correctly in our web client</span> <span data-start="822.73" data-end="823.96">instead of just showing the number of</span> <span data-start="823.96" data-end="825.07">likes we show this thing that we call</span> <span data-start="825.07" data-end="827.2">the like sentence and it's it's an</span> <span data-start="827.2" data-end="828.49">internationalized string that we</span> <span data-start="828.49" data-end="829.93">generate on the server that provides</span> <span data-start="829.93" data-end="832.15">some social context about who else who</span> <span data-start="832.15" data-end="834.97">who of your friends or who has liked the</span> <span data-start="834.97" data-end="837.58">story so for this we would want the</span> <span data-start="837.58" data-end="838.99">server to actually return the new like</span> <span data-start="838.99" data-end="841.62">sentence so that we could do the update</span> <span data-start="841.62" data-end="844.03">okay but then what if we wanted to</span> <span data-start="844.03" data-end="846.37">change the mobile client to also show</span> <span data-start="846.37" data-end="848.92">the profile pictures of the likers then</span> <span data-start="848.92" data-end="850.48">we would want to make sure to update the</span> <span data-start="850.48" data-end="852.22">server so that it also returns the new</span> <span data-start="852.22" data-end="854.38">likers picture so that we can show that</span> <span data-start="854.38" data-end="857.05">when someone likes it and then maybe if</span> <span data-start="857.05" data-end="859.78">eventually we took out those pictures we</span> <span data-start="859.78" data-end="860.89">would need to clean up that server</span> <span data-start="860.89" data-end="862.72">endpoint get rid of the liker picture</span> <span data-start="862.72" data-end="865.15">and this situation should start feeling</span> <span data-start="865.15" data-end="866.83">kind of familiar to you it's similar to</span> <span data-start="866.83" data-end="868.9">what we saw with data reads where we're</span> <span data-start="868.9" data-end="870.4">in that situation where the server</span> <span data-start="870.4" data-end="872.08">endpoint needed to be aware of the</span> <span data-start="872.08" data-end="874.41">details of the clients rendering logic</span> <span data-start="874.41" data-end="876.76">when we change the client rendering we</span> <span data-start="876.76" data-end="878.68">need to change what we return from the</span> <span data-start="878.68" data-end="880.09">right endpoint on the server and it gets</span> <span data-start="880.09" data-end="881.74">kind of tough and time-consuming to keep</span> <span data-start="881.74" data-end="885.88">those two places in sync just like</span> <span data-start="885.88" data-end="887.95">before relay and graphs well can help us</span> <span data-start="887.95" data-end="890.29">solve the problem so it turns out the</span> <span data-start="890.29" data-end="892.12">graph ql doesn't just support doing data</span> <span data-start="892.12" data-end="894.97">reads it also supports right graph ql</span> <span data-start="894.97" data-end="897.85">mutations so how will this work and</span> <span data-start="897.85" data-end="899.14">graph ql if you want to do a dick read</span> <span data-start="899.14" data-end="900.7">you just provide a query and you get a</span> <span data-start="900.7" data-end="902.8">response mutations are a little</span> <span data-start="902.8" data-end="904.33">different so you need to provide three</span> <span data-start="904.33" data-end="906.31">piece of information the type of the</span> <span data-start="906.31" data-end="908.74">mutation that you're trying to do any</span> <span data-start="908.74" data-end="910.39">inputs that will usually just be an ID</span> <span data-start="910.39" data-end="913.09">or two and then a query for the data</span> <span data-start="913.09" data-end="915.04">that you want after that mutation has</span> <span data-start="915.04" data-end="918.25">been performed so for liking a story</span> <span data-start="918.25" data-end="920.71">what would this be the type is just</span> <span data-start="920.71" data-end="923.47">story like the inputs that you need to</span> <span data-start="923.47" data-end="925.15">give our just the idea of the story that</span> <span data-start="925.15" data-end="927.67">your liking and then the query can be</span> <span data-start="927.67" data-end="929.02">anything but in this case let's say we</span> <span data-start="929.02" data-end="930.61">want to know if the viewer likes the</span> <span data-start="930.61" data-end="931.84">story so you know if you should make</span> <span data-start="931.84" data-end="933.85">that little thumb blue and then the</span> <span data-start="933.85" data-end="935.59">count of the number of people that like</span> <span data-start="935.59" data-end="938.53">it so when we send this information to</span> <span data-start="938.53" data-end="941.29">graft well it performs the right and</span> <span data-start="941.29" data-end="943.69">then it runs that query and then it will</span> <span data-start="943.69" data-end="945.88">send us back this payload which we can</span> <span data-start="945.88" data-end="946.3">use</span> <span data-start="946.3" data-end="950.14">to update the client relay uses graph ql</span> <span data-start="950.14" data-end="951.76">mutations for all of its data rights</span> <span data-start="951.76" data-end="953.59">which provides a standardized way to</span> <span data-start="953.59" data-end="955.21">both perform the rites and then to</span> <span data-start="955.21" data-end="958.54">update the client afterwards but let's</span> <span data-start="958.54" data-end="959.74">look back at these three pieces of</span> <span data-start="959.74" data-end="961.87">information here one of the more</span> <span data-start="961.87" data-end="963.58">interesting problems that we face when</span> <span data-start="963.58" data-end="965.44">developing this mutations framework for</span> <span data-start="965.44" data-end="968.29">relay was how to decide what this query</span> <span data-start="968.29" data-end="971.35">should actually be so our goal here was</span> <span data-start="971.35" data-end="973.45">to get the client data consistent with</span> <span data-start="973.45" data-end="976.06">the new post mutation state of the world</span> <span data-start="976.06" data-end="978.94">so we want this query to be for anything</span> <span data-start="978.94" data-end="981.76">that we had in the store in our in relay</span> <span data-start="981.76" data-end="983.62">that could have changed as a result of</span> <span data-start="983.62" data-end="987.07">the mutation happening so one option the</span> <span data-start="987.07" data-end="988.57">easiest option is just to have the</span> <span data-start="988.57" data-end="990.91">developer write these crazy manually so</span> <span data-start="990.91" data-end="992.38">in this example they would write this</span> <span data-start="992.38" data-end="995.35">query but then let's say someone came</span> <span data-start="995.35" data-end="998.56">and added profile pictures here we would</span> <span data-start="998.56" data-end="1000.75">send this information to the server the</span> <span data-start="1000.75" data-end="1002.04">right would happen we would get this</span> <span data-start="1002.04" data-end="1004.71">response back and we wouldn't have the</span> <span data-start="1004.71" data-end="1006">new profile picture in the right size</span> <span data-start="1006" data-end="1009.84">and and this would be a bug so to avoid</span> <span data-start="1009.84" data-end="1011.4">that the person who added the profile</span> <span data-start="1011.4" data-end="1013.26">pictures would need to make sure to go</span> <span data-start="1013.26" data-end="1014.94">find that mutation query probably</span> <span data-start="1014.94" data-end="1017.04">somewhere in some other file and add the</span> <span data-start="1017.04" data-end="1019.08">profile picture in there and more</span> <span data-start="1019.08" data-end="1020.94">generally we would be in this situation</span> <span data-start="1020.94" data-end="1023.46">where every time someone changed some</span> <span data-start="1023.46" data-end="1024.63">rendering logic they would need to</span> <span data-start="1024.63" data-end="1026.04">remember to go find all of the</span> <span data-start="1026.04" data-end="1027.84">potentially relevant mutation queries</span> <span data-start="1027.84" data-end="1030.3">and change them this wasn't a great</span> <span data-start="1030.3" data-end="1032.25">option for us since with relay we really</span> <span data-start="1032.25" data-end="1034.32">want to minimize these situations where</span> <span data-start="1034.32" data-end="1036.21">you make a change somewhere and then you</span> <span data-start="1036.21" data-end="1037.32">need to make a change in a bunch of</span> <span data-start="1037.32" data-end="1041.55">other places so instead we put the logic</span> <span data-start="1041.55" data-end="1043.32">to determine the correct mutation query</span> <span data-start="1043.32" data-end="1046.49">into relay itself how does this work so</span> <span data-start="1046.49" data-end="1049.11">intrinsic to every graph ql mutation is</span> <span data-start="1049.11" data-end="1051.81">the set of data that can change as a</span> <span data-start="1051.81" data-end="1054.06">result of that mutation so this is an</span> <span data-start="1054.06" data-end="1056.04">independent of what any client renders</span> <span data-start="1056.04" data-end="1057.66">it's a property of the mutation itself</span> <span data-start="1057.66" data-end="1059.34">so it's a property of story like or a</span> <span data-start="1059.34" data-end="1062.04">comment create so here's the set of</span> <span data-start="1062.04" data-end="1064.92">things that can change when we do a</span> <span data-start="1064.92" data-end="1067.8">story like and if we always queried for</span> <span data-start="1067.8" data-end="1069.78">everything that can change every time we</span> <span data-start="1069.78" data-end="1071.85">did a mutation we would clearly end up</span> <span data-start="1071.85" data-end="1074.07">in a consistent state but we might be</span> <span data-start="1074.07" data-end="1075.93">massively over fetching since maybe we</span> <span data-start="1075.93" data-end="1077.01">never rendered any of</span> <span data-start="1077.01" data-end="1079.92">data we don't care about some of them so</span> <span data-start="1079.92" data-end="1082.58">we have relied keep track for each ID of</span> <span data-start="1082.58" data-end="1085.13">the set of data that the client has</span> <span data-start="1085.13" data-end="1087.42">retrieved for that ID and put into its</span> <span data-start="1087.42" data-end="1090.38">store so if we had rendered my story</span> <span data-start="1090.38" data-end="1092.67">maybe this would be the set of the data</span> <span data-start="1092.67" data-end="1094.61">that we have fetched for my story and</span> <span data-start="1094.61" data-end="1098.25">then when you do a mutation on some</span> <span data-start="1098.25" data-end="1100.98">story or on some ID really builds a</span> <span data-start="1100.98" data-end="1103.77">mutation query by intersecting this set</span> <span data-start="1103.77" data-end="1106.68">of things that can possibly change with</span> <span data-start="1106.68" data-end="1108.75">the set of things that it knows that it</span> <span data-start="1108.75" data-end="1110.25">cares about the set of things that it</span> <span data-start="1110.25" data-end="1113.46">has in a store this ensures that we</span> <span data-start="1113.46" data-end="1115.59">query for exactly the set of field that</span> <span data-start="1115.59" data-end="1119.22">needs to be updated so in this case we</span> <span data-start="1119.22" data-end="1122.52">would end up with this query here and</span> <span data-start="1122.52" data-end="1125.13">the really nice part of this is that if</span> <span data-start="1125.13" data-end="1127.35">someone does come along and let's say</span> <span data-start="1127.35" data-end="1130.26">they replace that three likes with the</span> <span data-start="1130.26" data-end="1134.4">like sentence then relay this what we've</span> <span data-start="1134.4" data-end="1136.29">stored will know that we've now fetched</span> <span data-start="1136.29" data-end="1137.85">the like sentence for that story not the</span> </p>
<p><span data-start="1137.85" data-end="1139.65">Lakers count and so when we do this</span> <span data-start="1139.65" data-end="1142.44">intersection the intersected query will</span> <span data-start="1142.44" data-end="1143.85">be the correct one will correctly ask</span> <span data-start="1143.85" data-end="1145.5">the server for the new like sentence</span> <span data-start="1145.5" data-end="1149.85">rather than the like count so those are</span> <span data-start="1149.85" data-end="1152.25">the basics of how relay mutations work</span> <span data-start="1152.25" data-end="1155.4">the user takes an action we send the</span> <span data-start="1155.4" data-end="1157.83">name of the mutation and any inputs into</span> <span data-start="1157.83" data-end="1159.9">relay and really does that intersection</span> <span data-start="1159.9" data-end="1161.79">to figure out what the query should be</span> <span data-start="1161.79" data-end="1164.22">it'll send that over to the server the</span> <span data-start="1164.22" data-end="1166.56">server will respond will put that</span> <span data-start="1166.56" data-end="1168.66">response into the store and then we'll</span> <span data-start="1168.66" data-end="1170.55">notify the affected views by sending</span> <span data-start="1170.55" data-end="1173.22">them updated crops and you'll notice</span> <span data-start="1173.22" data-end="1175.08">that this diagram is kind of similar to</span> <span data-start="1175.08" data-end="1176.49">the one I showed you for the read path</span> <span data-start="1176.49" data-end="1179.49">before in particular the second part is</span> <span data-start="1179.49" data-end="1181.68">identical in the two flows graph ql</span> <span data-start="1181.68" data-end="1183.39">sends us some data relay puts it in the</span> <span data-start="1183.39" data-end="1184.98">store and then we send the props to the</span> <span data-start="1184.98" data-end="1187.41">components these parallels between the</span> <span data-start="1187.41" data-end="1188.91">read and the right flows are not a</span> <span data-start="1188.91" data-end="1191.61">coincidence just like flux relay treats</span> <span data-start="1191.61" data-end="1194.19">data rights as first-class citizens by</span> <span data-start="1194.19" data-end="1196.14">using the same core logic and code to</span> <span data-start="1196.14" data-end="1200.07">handle both reads and writes so if</span> <span data-start="1200.07" data-end="1202.32">you've written mutations before you'll</span> <span data-start="1202.32" data-end="1204.27">know that even when you have v1 working</span> <span data-start="1204.27" data-end="1205.56">when you have the right actually</span> <span data-start="1205.56" data-end="1207.3">happening on the server and then the</span> <span data-start="1207.3" data-end="1209.49">client getting updated correctly there's</span> <span data-start="1209.49" data-end="1210.83">there's often a lot more</span> <span data-start="1210.83" data-end="1213.26">to be done so maybe you have to think</span> <span data-start="1213.26" data-end="1215.69">about things like making that feel more</span> <span data-start="1215.69" data-end="1217.49">responsive by having the client kind of</span> <span data-start="1217.49" data-end="1219.649">doing fake updates instantaneously or</span> <span data-start="1219.649" data-end="1221.21">you have to worry about how to handle</span> <span data-start="1221.21" data-end="1224.179">errors timeout retries or things like</span> <span data-start="1224.179" data-end="1227.45">race conditions because relay has this</span> <span data-start="1227.45" data-end="1229.279">centralized mutations framework we're</span> <span data-start="1229.279" data-end="1231.049">able to take a lot of these common</span> <span data-start="1231.049" data-end="1233.12">concerns and put them into relay itself</span> <span data-start="1233.12" data-end="1235.669">so the developers get that get the</span> <span data-start="1235.669" data-end="1237.32">handling of those issues for free rather</span> <span data-start="1237.32" data-end="1238.669">than needing to solve them again and</span> <span data-start="1238.669" data-end="1241.37">again with each new mutation so let's</span> <span data-start="1241.37" data-end="1242.87">start with that app responsiveness</span> <span data-start="1242.87" data-end="1245.419">example if I implement its story like</span> <span data-start="1245.419" data-end="1246.95">the way that I've described so far and</span> <span data-start="1246.95" data-end="1249.08">then someone use this app and hit the</span> <span data-start="1249.08" data-end="1251.45">like button they notice a significant</span> <span data-start="1251.45" data-end="1253.07">delay between when they hit like and</span> <span data-start="1253.07" data-end="1257">when one app actually changes because</span> <span data-start="1257" data-end="1257.96">we're sitting there waiting for the</span> <span data-start="1257.96" data-end="1259.37">server response to come back waiting for</span> <span data-start="1259.37" data-end="1262.13">that graphical response it would be nice</span> <span data-start="1262.13" data-end="1263.48">if we didn't have to deal with this</span> <span data-start="1263.48" data-end="1266.12">delay and lucky for us really provide</span> <span data-start="1266.12" data-end="1267.86">support for what we call optimistic</span> <span data-start="1267.86" data-end="1270.049">mutations where we immediately update</span> <span data-start="1270.049" data-end="1272.36">the view to the expected post right</span> <span data-start="1272.36" data-end="1273.86">state being optimistic that everything</span> <span data-start="1273.86" data-end="1276.82">will work out nicely on the server</span> <span data-start="1276.82" data-end="1279.23">essentially to make this happen you can</span> <span data-start="1279.23" data-end="1281.179">provide a payload mimicking the server</span> <span data-start="1281.179" data-end="1283.309">response and then the view will change</span> <span data-start="1283.309" data-end="1286.039">instantly based on that payload so that</span> <span data-start="1286.039" data-end="1287.659">optimistic payload doesn't have to</span> <span data-start="1287.659" data-end="1289.159">include everything that would be in the</span> <span data-start="1289.159" data-end="1290.929">server update it can include as much or</span> <span data-start="1290.929" data-end="1292.429">as little information as you need to</span> <span data-start="1292.429" data-end="1293.929">make things feel right so it's kind of</span> <span data-start="1293.929" data-end="1296.029">just a we want this to feel good in</span> <span data-start="1296.029" data-end="1297.139">between when we're waiting for the</span> <span data-start="1297.139" data-end="1299.51">server response to come back so maybe</span> <span data-start="1299.51" data-end="1301.159">for story like we would just do an</span> <span data-start="1301.159" data-end="1302.84">optimistic peeled like this just slip</span> <span data-start="1302.84" data-end="1305.45">does viewer like to true and that would</span> <span data-start="1305.45" data-end="1306.86">cause the the thumb to turn blue</span> <span data-start="1306.86" data-end="1308.72">immediately but maybe you'd think this</span> <span data-start="1308.72" data-end="1310.25">is kind of weird because you still see</span> <span data-start="1310.25" data-end="1313.01">to like so you could do this instead is</span> <span data-start="1313.01" data-end="1314.75">optimistic payload we're now you're also</span> <span data-start="1314.75" data-end="1317.539">incrementing the count by one so that</span> <span data-start="1317.539" data-end="1319.429">you'll get the three likes and the blue</span> <span data-start="1319.429" data-end="1322.76">thumb instantly if I had wanted to do an</span> <span data-start="1322.76" data-end="1324.409">optimistic update like this back when I</span> <span data-start="1324.409" data-end="1325.76">was writing mutation for the newsfeed</span> <span data-start="1325.76" data-end="1327.2">team I would need to just add a bunch of</span> <span data-start="1327.2" data-end="1329.87">code to manually update the Dom in a</span> <span data-start="1329.87" data-end="1331.429">react application i could call us at</span> <span data-start="1331.429" data-end="1333.169">state to get my component to rerender</span> <span data-start="1333.169" data-end="1335.87">with this new optimistic data but in</span> <span data-start="1335.87" data-end="1337.309">really i just provide this optimistic</span> <span data-start="1337.309" data-end="1338.51">tailored and then everything else</span> <span data-start="1338.51" data-end="1339.83">happens automatically the framework</span> <span data-start="1339.83" data-end="1343.059">automatically will update the views</span> <span data-start="1343.059" data-end="1345.129">so I want to describe now how these</span> <span data-start="1345.129" data-end="1347.139">optimistic mutations have been behind</span> <span data-start="1347.139" data-end="1348.94">the scenes even though the view is</span> <span data-start="1348.94" data-end="1350.98">changing immediately with optimistic</span> <span data-start="1350.98" data-end="1352.779">update really isn't immediately</span> <span data-start="1352.779" data-end="1354.85">overriding the data in that graph you'll</span> <span data-start="1354.85" data-end="1357.61">store so instead we maintain a queue of</span> <span data-start="1357.61" data-end="1360.759">in-flight mutations mutations that we've</span> <span data-start="1360.759" data-end="1361.99">done the optimistic update but the</span> <span data-start="1361.99" data-end="1363.669">server response hasn't come back yet and</span> <span data-start="1363.669" data-end="1365.95">when we read data from the store we read</span> <span data-start="1365.95" data-end="1368.379">through that Q so what does that look</span> <span data-start="1368.379" data-end="1370.299">like let's say that this is the data in</span> <span data-start="1370.299" data-end="1373.509">our store for my story so the UI is</span> <span data-start="1373.509" data-end="1374.86">going to reflect what we have in the</span> <span data-start="1374.86" data-end="1378.429">store and then let's say I do alike so</span> <span data-start="1378.429" data-end="1379.899">you'll notice that the UI block</span> <span data-start="1379.899" data-end="1382.779">immediately changed blue but the store</span> <span data-start="1382.779" data-end="1384.7">we haven't changed anything in the store</span> <span data-start="1384.7" data-end="1387.73">yet and now I do a comment again because</span> <span data-start="1387.73" data-end="1389.679">of the optimistic update the UI changes</span> <span data-start="1389.679" data-end="1391.149">instantly but the store is still</span> <span data-start="1391.149" data-end="1394.48">untouched so now we get the server</span> <span data-start="1394.48" data-end="1396.039">payload let's say the like succeeded</span> <span data-start="1396.039" data-end="1398.499">this is when will actually remove that</span> <span data-start="1398.499" data-end="1400.86">like from the queue and update the store</span> <span data-start="1400.86" data-end="1403.84">so now what if we get an error for the</span> <span data-start="1403.84" data-end="1406.33">comment so if we had immediately written</span> <span data-start="1406.33" data-end="1408.279">that comment into the store when as soon</span> <span data-start="1408.279" data-end="1410.23">as I did it this is when we would be in</span> <span data-start="1410.23" data-end="1411.249">a little bit of a sticky situation</span> <span data-start="1411.249" data-end="1413.799">because we need to kind of roll back our</span> <span data-start="1413.799" data-end="1415.21">changes make sure that we left the store</span> <span data-start="1415.21" data-end="1416.529">in the exact state that it had been</span> <span data-start="1416.529" data-end="1418.779">before but because we maintain this</span> <span data-start="1418.779" data-end="1421.6">queue all you need to do is remove it</span> <span data-start="1421.6" data-end="1424.179">from the queue the stores still in good</span> <span data-start="1424.179" data-end="1426.19">shape and the UI goes back to taking the</span> <span data-start="1426.19" data-end="1429.759">comment away the mutations q also makes</span> <span data-start="1429.759" data-end="1432.34">it simple to deal with retries so let's</span> <span data-start="1432.34" data-end="1433.929">say that I'm trying to comment and say</span> <span data-start="1433.929" data-end="1436.45">thanks to my friends here so I hit post</span> <span data-start="1436.45" data-end="1438.49">and the optimistic update happens</span> <span data-start="1438.49" data-end="1440.799">immediately and is added to the queue</span> <span data-start="1440.799" data-end="1443.2">and then an error comes back so in the</span> <span data-start="1443.2" data-end="1444.82">example I just showed you I took them I</span> <span data-start="1444.82" data-end="1446.44">just said okay there was an error take</span> <span data-start="1446.44" data-end="1449.74">it out of the queue revert but what we</span> <span data-start="1449.74" data-end="1452.2">can also do is keep it in the queue but</span> <span data-start="1452.2" data-end="1455.649">mark it with an error state and the view</span> <span data-start="1455.649" data-end="1457.24">can pick up on this air state and show</span> <span data-start="1457.24" data-end="1458.679">that little message unable to post</span> <span data-start="1458.679" data-end="1461.44">comment try again and then if I do hit</span> <span data-start="1461.44" data-end="1463.539">try again it's easy to perform that</span> <span data-start="1463.539" data-end="1465.46">retry since we have that comment</span> <span data-start="1465.46" data-end="1466.99">mutation sitting in the queue and it</span> <span data-start="1466.99" data-end="1468.58">contains all the data that it needs to</span> <span data-start="1468.58" data-end="1470.59">basically send itself off to the server</span> <span data-start="1470.59" data-end="1474.94">again so I hit retry and this time it</span> <span data-start="1474.94" data-end="1477.759">works and voila</span> <span data-start="1477.759" data-end="1480.169">so a final nice feature of relay</span> <span data-start="1480.169" data-end="1482.45">mutations framework is that it provides</span> <span data-start="1482.45" data-end="1484.22">a solution for race conditions that you</span> <span data-start="1484.22" data-end="1486.44">can get when someone is performing a</span> <span data-start="1486.44" data-end="1488.57">quick sequence of mutations on all</span> <span data-start="1488.57" data-end="1490.73">affecting the same object so let's say</span> <span data-start="1490.73" data-end="1492.95">that I quickly like and unlike my story</span> <span data-start="1492.95" data-end="1496.1">a bunch of times in a row there's a</span> <span data-start="1496.1" data-end="1497.509">pretty high chance here that something's</span> <span data-start="1497.509" data-end="1499.639">going to go wrong if we just didn't have</span> <span data-start="1499.639" data-end="1502.989">any special casing for the situation so</span> <span data-start="1502.989" data-end="1505.85">there's a race condition for my</span> <span data-start="1505.85" data-end="1508.399">mutations hitting the server if the if</span> </p>
<p><span data-start="1508.399" data-end="1510.859">I've ended up on an unlike but the like</span> <span data-start="1510.859" data-end="1512.509">is the last one hit the server then</span> <span data-start="1512.509" data-end="1513.83">we're going to have the wrong state of</span> <span data-start="1513.83" data-end="1515.779">data on the server and even if that all</span> <span data-start="1515.779" data-end="1518.679">works out we have another race condition</span> <span data-start="1518.679" data-end="1521.6">for those payloads coming back where</span> <span data-start="1521.6" data-end="1523.909">it's the last one that comes back is the</span> <span data-start="1523.909" data-end="1524.929">like then we're going to have an</span> <span data-start="1524.929" data-end="1527.83">inconsistent State on the client in</span> <span data-start="1527.83" data-end="1530.179">relay we have a way to detect the view</span> <span data-start="1530.179" data-end="1532.279">mutations are dependent and guarantee</span> <span data-start="1532.279" data-end="1533.869">that only one of them is in flight at a</span> <span data-start="1533.869" data-end="1536.69">time so the first one goes off and only</span> <span data-start="1536.69" data-end="1538.46">when that payload comes back do we send</span> <span data-start="1538.46" data-end="1540.679">off the second one and so on so all the</span> <span data-start="1540.679" data-end="1542.33">optimistic rights still happen</span> <span data-start="1542.33" data-end="1544.039">immediately so the person using the</span> <span data-start="1544.039" data-end="1545.359">application doesn't know that we're</span> <span data-start="1545.359" data-end="1546.559">doing anything different behind the</span> <span data-start="1546.559" data-end="1549.739">scenes but we do this thing to ensure</span> <span data-start="1549.739" data-end="1550.73">that we're not going to get these</span> <span data-start="1550.73" data-end="1554.899">collisions so all what I've described so</span> <span data-start="1554.899" data-end="1556.82">far relay and its mutations framework</span> <span data-start="1556.82" data-end="1558.71">are already being used in a few places</span> <span data-start="1558.71" data-end="1560.989">in production at Facebook including our</span> <span data-start="1560.989" data-end="1563.239">standalone groups app and our mobile ads</span> <span data-start="1563.239" data-end="1565.279">manager app which are both using both</span> <span data-start="1565.279" data-end="1567.889">relay and react native I'm going to</span> <span data-start="1567.889" data-end="1569.059">spend the last few minutes here</span> <span data-start="1569.059" data-end="1570.859">discussing a part of relay that we're</span> <span data-start="1570.859" data-end="1572.45">still working on that's not yet in</span> <span data-start="1572.45" data-end="1575.989">production so this was a diagram that I</span> <span data-start="1575.989" data-end="1578.96">showed earlier to explain mutations as i</span> <span data-start="1578.96" data-end="1580.519">explained really can take this mutation</span> <span data-start="1580.519" data-end="1582.95">payload from graft well store it and</span> <span data-start="1582.95" data-end="1584.899">then send the props to any effective</span> <span data-start="1584.899" data-end="1587.6">views so here the action is originating</span> <span data-start="1587.6" data-end="1588.71">from the person who's using the</span> <span data-start="1588.71" data-end="1590.96">application but that doesn't have to be</span> <span data-start="1590.96" data-end="1595.129">the case so imagine if Joe comments on</span> <span data-start="1595.129" data-end="1598.489">my story from his phone we can actually</span> <span data-start="1598.489" data-end="1601.159">use this same path once it goes through</span> <span data-start="1601.159" data-end="1603.799">the cloud to send his mutation payload</span> <span data-start="1603.799" data-end="1606.23">to relay put it in the store and then</span> <span data-start="1606.23" data-end="1608.6">update the views to show his new comment</span> <span data-start="1608.6" data-end="1610.64">do we call this a subscription</span> <span data-start="1610.64" data-end="1612.65">basically if I'm looking at a new speed</span> <span data-start="1612.65" data-end="1614.57">story I can subscribe to all new</span> <span data-start="1614.57" data-end="1616.79">comments happening on that story and at</span> <span data-start="1616.79" data-end="1618.23">the time that i subscribe i'll provide a</span> <span data-start="1618.23" data-end="1620.36">graph to all queries saying here's the</span> <span data-start="1620.36" data-end="1622.91">query for what data i want for every new</span> <span data-start="1622.91" data-end="1625.52">comment that comes in and then using a</span> <span data-start="1625.52" data-end="1627.68">pub sub system in the back end we can</span> <span data-start="1627.68" data-end="1629.39">ensure that all of these mutation</span> <span data-start="1629.39" data-end="1630.89">payloads for each new comment are</span> <span data-start="1630.89" data-end="1633.17">delivered whenever someone comments and</span> <span data-start="1633.17" data-end="1634.7">then relay will automatically update the</span> <span data-start="1634.7" data-end="1637.49">views so along the same lines I've say</span> <span data-start="1637.49" data-end="1639.5">media or firebase this subscriptions</span> <span data-start="1639.5" data-end="1641.75">piece of relay provides a simple way to</span> <span data-start="1641.75" data-end="1644">build dynamic applications that feel</span> <span data-start="1644" data-end="1646.1">alive with real-time updates and this is</span> <span data-start="1646.1" data-end="1646.97">something that we're excited about</span> <span data-start="1646.97" data-end="1648.65">integrating into various parts of</span> <span data-start="1648.65" data-end="1652.31">facebook so I'm going to close with just</span> <span data-start="1652.31" data-end="1654.92">a few last points the core idea of relay</span> <span data-start="1654.92" data-end="1656.81">just to re-emphasize that is that we</span> <span data-start="1656.81" data-end="1658.16">should keep our data fetching logic</span> <span data-start="1658.16" data-end="1660.23">together with our rendering logic within</span> <span data-start="1660.23" data-end="1662.12">each component because we found this</span> <span data-start="1662.12" data-end="1664.25">approach to really scale well to a big</span> <span data-start="1664.25" data-end="1667.24">application being built by a big team</span> <span data-start="1667.24" data-end="1669.5">one of our main goals when we've</span> <span data-start="1669.5" data-end="1671.81">designed really has been to identify</span> <span data-start="1671.81" data-end="1673.49">these problematic patterns that people</span> <span data-start="1673.49" data-end="1675.23">are facing again and again and that are</span> <span data-start="1675.23" data-end="1677.18">slowing them down and pull the</span> <span data-start="1677.18" data-end="1679.19">complexity of those patterns into relay</span> <span data-start="1679.19" data-end="1681.38">so we saw a few examples of this today</span> <span data-start="1681.38" data-end="1683.87">with relay mutations from the way that</span> <span data-start="1683.87" data-end="1685.67">we do that intersection to determine the</span> <span data-start="1685.67" data-end="1687.8">correct mutation query to the way that</span> <span data-start="1687.8" data-end="1689.81">we have optimistic updates in that queue</span> <span data-start="1689.81" data-end="1692.33">to our solution for rage conditions in</span> <span data-start="1692.33" data-end="1694.55">each case someone using relay will get</span> <span data-start="1694.55" data-end="1696.08">these common problems solved for free</span> <span data-start="1696.08" data-end="1698.27">and can focus on bigger and better</span> <span data-start="1698.27" data-end="1700.64">things so I'm going to close with one</span> <span data-start="1700.64" data-end="1703.01">last sticker comment thank you all for</span> <span data-start="1703.01" data-end="1731.49">listening</span> </p>
</section>