<section>
<p><span data-start="10.13" data-end="12.63">some real-time web is something that</span> <span data-start="12.63" data-end="14.34">I've been working on for I don't know</span> <span data-start="14.34" data-end="16.53">four or five years now this idea that</span> <span data-start="16.53" data-end="17.73">the browser could be a two-way</span> <span data-start="17.73" data-end="19.53">communications channel with very low</span> <span data-start="19.53" data-end="21.36">latency so I'm going to show you guys</span> <span data-start="21.36" data-end="24.15">some explain how we do this stuff with</span> <span data-start="24.15" data-end="26.369">XMPP and in this JavaScript library I'm</span> <span data-start="26.369" data-end="27.779">going to show you guys some code and</span> <span data-start="27.779" data-end="32.539">some demos and stuff like that so so</span> <span data-start="32.539" data-end="36.569">XMPP is the protocol that we sort of</span> <span data-start="36.569" data-end="38.399">used to make this magic happen it's one</span> <span data-start="38.399" data-end="39.87">of a couple of choices that you guys</span> <span data-start="39.87" data-end="42.69">have it happens to be my favorite it</span> <span data-start="42.69" data-end="44.639">stands for the extensible messaging and</span> <span data-start="44.639" data-end="46.829">presence protocol it was initially</span> <span data-start="46.829" data-end="50.399">started in I think 99 by Jeremy Miller</span> <span data-start="50.399" data-end="52.709">and some friends to sort of take on the</span> <span data-start="52.709" data-end="55.559">closed into the messaging systems of AOL</span> <span data-start="55.559" data-end="57.479">and Yahoo and those guys how many people</span> <span data-start="57.479" data-end="59.999">in this room know about XMPP or have</span> <span data-start="59.999" data-end="62.28">used it so quite a few</span> <span data-start="62.28" data-end="63.899">so everybody who has a gmail account and</span> <span data-start="63.899" data-end="65.94">didn't raise your hand you know and love</span> </p>
<p><span data-start="65.94" data-end="72.53">XMPP already so it's originally for</span> <span data-start="72.53" data-end="74.73">originally intended to be instant</span> <span data-start="74.73" data-end="77.73">messaging replacement protocol it can be</span> <span data-start="77.73" data-end="79.8">used for pretty much anything with it</span> <span data-start="79.8" data-end="82.2">can be extended and people have done</span> <span data-start="82.2" data-end="84.48">extensions for publish/subscribe</span> <span data-start="84.48" data-end="88.5">semantics for ad-hoc commands XML RPC</span> <span data-start="88.5" data-end="90.39">pretty much anything you can think of</span> <span data-start="90.39" data-end="92.61">someone's written a spec for how to do</span> <span data-start="92.61" data-end="95.25">it over XMPP these days it's used for a</span> <span data-start="95.25" data-end="96.81">lot more than just instant messaging and</span> <span data-start="96.81" data-end="98.49">in fact most of the applications that I</span> <span data-start="98.49" data-end="100.56">write with XMPP have nothing to do with</span> <span data-start="100.56" data-end="104.73">instant messaging so why do we want XMPP</span> <span data-start="104.73" data-end="108.78">well there's we probably everybody in</span> <span data-start="108.78" data-end="111.62">this room does most stuff with HTTP and</span> </p>
<p><span data-start="111.62" data-end="114.42">HTTPS are great you can do a lot of</span> <span data-start="114.42" data-end="119.58">stuff with them REST API s are great you</span> <span data-start="119.58" data-end="120.81">can do a lot of the functions that you</span> <span data-start="120.81" data-end="123.6">want to do the problem is is that HTTP</span> <span data-start="123.6" data-end="126.06">polling really sucks if you want to get</span> <span data-start="126.06" data-end="127.62">the latest Twitter updates you have to</span> <span data-start="127.62" data-end="129.239">ask Twitter hey is there anything new</span> <span data-start="129.239" data-end="130.92">and then you have to ask them hey is</span> <span data-start="130.92" data-end="133.17">there anything new and like 95% of the</span> <span data-start="133.17" data-end="134.13">time there's nothing</span> <span data-start="134.13" data-end="136.47">- but if you want to get low latency and</span> <span data-start="136.47" data-end="138.87">actually have a conversation you have to</span> <span data-start="138.87" data-end="140.97">do all this polling anyway there's no</span> <span data-start="140.97" data-end="142.29">really escaping it</span> <span data-start="142.29" data-end="146.04">and so real-time applications are</span> <span data-start="146.04" data-end="147.63">different they require you to have this</span> <span data-start="147.63" data-end="149.7">low latency which in the HTTP world</span> <span data-start="149.7" data-end="151.17">means you're pulling the crap out of</span> <span data-start="151.17" data-end="154.89">something an XMPP is sort of a good</span> <span data-start="154.89" data-end="159.42">solution to this it's it's a where HTTP</span> <span data-start="159.42" data-end="162.21">is stateless X and P P is stateful has a</span> <span data-start="162.21" data-end="164.58">long live TCP connection under it and so</span> <span data-start="164.58" data-end="167.01">you're probably all asking because of</span> <span data-start="167.01" data-end="169.02">that how do you do this from the web</span> <span data-start="169.02" data-end="172.32">browser so before I get to that I want</span> <span data-start="172.32" data-end="173.94">to for those of you who probably never</span> <span data-start="173.94" data-end="176.1">seen the actual protocol before I just</span> <span data-start="176.1" data-end="177.3">wanted to go through a couple of the</span> <span data-start="177.3" data-end="180.96">protocol points so there's an XMPP</span> </p>
<p><span data-start="180.96" data-end="182.97">Network the network is federated in an</span> <span data-start="182.97" data-end="186.18">open way it's very similar to email you</span> <span data-start="186.18" data-end="188.28">have a client it talks to a server the</span> <span data-start="188.28" data-end="189.81">protocol that they use is called the</span> <span data-start="189.81" data-end="191.37">client to server protocol it's very</span> <span data-start="191.37" data-end="194.58">creatively named and of course you can</span> <span data-start="194.58" data-end="196.05">have lots of clients talking to the same</span> <span data-start="196.05" data-end="198.9">server you can have two servers talking</span> <span data-start="198.9" data-end="200.22">to each other these speak a slightly</span> <span data-start="200.22" data-end="201.78">different protocol called the server to</span> <span data-start="201.78" data-end="205.71">server protocol and of course all lots</span> <span data-start="205.71" data-end="207.12">of servers can talk to lots of servers</span> <span data-start="207.12" data-end="208.62">and each of these servers can have</span> <span data-start="208.62" data-end="209.76">thousands and millions of clients</span> <span data-start="209.76" data-end="211.71">hanging off of it and it works like</span> <span data-start="211.71" data-end="214.14">email so if I'm on on this server here</span> <span data-start="214.14" data-end="216.27">and I send something to server B it's</span> <span data-start="216.27" data-end="217.74">going to forward the message to server B</span> <span data-start="217.74" data-end="219.36">which will forward it on to the user</span> <span data-start="219.36" data-end="219.84">there</span> <span data-start="219.84" data-end="222.9">unlike email there's only one hop here</span> <span data-start="222.9" data-end="225.51">so I go directly to the pure server I</span> <span data-start="225.51" data-end="227.25">don't go through any intermediate nodes</span> <span data-start="227.25" data-end="230.31">and there's no forgery possible meaning</span> <span data-start="230.31" data-end="233.34">that if this so I can the server can</span> <span data-start="233.34" data-end="235.709">forge local users but nothing can forge</span> <span data-start="235.709" data-end="238.32">an arbitrary user on the network so if</span> <span data-start="238.32" data-end="240.27">it came from a server you know that it</span> <span data-start="240.27" data-end="242.13">came from the server you don't have to</span> <span data-start="242.13" data-end="244.43">worry about some of that SMTP spam</span> <span data-start="244.43" data-end="249.15">vector stuff so to get all this data</span> <span data-start="249.15" data-end="251.01">shuttled around we have an addressing</span> <span data-start="251.01" data-end="253.2">scheme it looks a lot like emails</span> <span data-start="253.2" data-end="255.209">addressing scheme this is a domain this</span> <span data-start="255.209" data-end="258.03">is probably this is the simplest XMPP</span> <span data-start="258.03" data-end="260.489">address you can have this is an address</span> <span data-start="260.489" data-end="264.78">of a server in most cases you can have</span> <span data-start="264.78" data-end="267.48">user add a domain that looks</span> <span data-start="267.48" data-end="269.25">like an email address we call this a jid</span> <span data-start="269.25" data-end="272.01">for jabber ID this is called a barrage</span> <span data-start="272.01" data-end="273.99">it because it's just the user in the</span> <span data-start="273.99" data-end="277.35">domain this is called a full jid we have</span> <span data-start="277.35" data-end="279.21">a user a domain and a resource and we</span> <span data-start="279.21" data-end="281.04">need this because you might have</span> <span data-start="281.04" data-end="284.25">multiple connections to an XMPP server</span> <span data-start="284.25" data-end="286.41">and there disambiguated by this resource</span> <span data-start="286.41" data-end="288.18">bit so for instance my connection where</span> <span data-start="288.18" data-end="290.19">i'm at home might be called home and i</span> <span data-start="290.19" data-end="294">might have one for work gmail likes to</span> <span data-start="294" data-end="296.52">give really random strings is these</span> <span data-start="296.52" data-end="298.29">resource identifiers it really doesn't</span> <span data-start="298.29" data-end="300.75">matter what they are as long as you know</span> <span data-start="300.75" data-end="305.01">they're unique so the protocol it's</span> <span data-start="305.01" data-end="307.95">based on XML it uses something that most</span> <span data-start="307.95" data-end="309.84">other XML based things doesn't which it</span> <span data-start="309.84" data-end="312.84">uses XML streams essentially this means</span> <span data-start="312.84" data-end="314.7">you have two XML documents that are</span> <span data-start="314.7" data-end="316.86">built continuously on the fly one in</span> <span data-start="316.86" data-end="319.77">each direction over these so for</span> <span data-start="319.77" data-end="320.94">instance when you make the connection</span> <span data-start="320.94" data-end="324.3">you open up the root element you send</span> <span data-start="324.3" data-end="326.58">these messages across as first level</span> <span data-start="326.58" data-end="328.05">children and when the connection is</span> <span data-start="328.05" data-end="330.57">terminated you send the the root close</span> <span data-start="330.57" data-end="332.97">so at the end of an XMPP connection</span> <span data-start="332.97" data-end="335.07">you'll have two completely valid XML</span> <span data-start="335.07" data-end="337.26">documents but during the XMPP connection</span> <span data-start="337.26" data-end="340.8">you work with XML stanzas which of these</span> <span data-start="340.8" data-end="344.28">first level children so there's three</span> <span data-start="344.28" data-end="347.64">main types of these these first level</span> <span data-start="347.64" data-end="348.12">children</span> <span data-start="348.12" data-end="350.61">the first one is a message and we have</span> <span data-start="350.61" data-end="353.13">presents and we have this weird IQ one</span> <span data-start="353.13" data-end="355.2">and IQ one stands for information query</span> <span data-start="355.2" data-end="357.3">this is pretty much exactly equivalent</span> <span data-start="357.3" data-end="359.31">to an HTTP GET request or an HTTP POST</span> <span data-start="359.31" data-end="361.38">request it's the only one that's</span> <span data-start="361.38" data-end="364.95">required to have a response so message</span> <span data-start="364.95" data-end="367.2">stances these are like the basic</span> <span data-start="367.2" data-end="369.18">building blocks when you send messages</span> <span data-start="369.18" data-end="370.68">back and forth they could be chat</span> <span data-start="370.68" data-end="372.42">messages they could be arbitrary bits of</span> <span data-start="372.42" data-end="374.88">data that you're sending around this is</span> <span data-start="374.88" data-end="376.41">pretty much what a normal chat message</span> <span data-start="376.41" data-end="381.12">would look like you have a from in this</span> <span data-start="381.12" data-end="382.56">case the from is always going to be a</span> <span data-start="382.56" data-end="384.33">full jid unless it comes from a server</span> <span data-start="384.33" data-end="387.9">or something you have a — that's where</span> <span data-start="387.9" data-end="389.25">you're sending it to you can send it to</span> <span data-start="389.25" data-end="390.96">a barrage it you can send it to a domain</span> <span data-start="390.96" data-end="393.62">all kinds of stuff and it has a type</span> <span data-start="393.62" data-end="395.52">most of the time this is going to be</span> <span data-start="395.52" data-end="397.98">chat for private messages it might be</span> <span data-start="397.98" data-end="399.57">group chat for group chat messages</span> <span data-start="399.57" data-end="401.07">there's also some other</span> <span data-start="401.07" data-end="402.57">types like headline and things that are</span> <span data-start="402.57" data-end="406.41">used for various weird purposes and then</span> <span data-start="406.41" data-end="408.27">we have the body which just has the text</span> <span data-start="408.27" data-end="410.79">of the message you're sending um and of</span> <span data-start="410.79" data-end="411.75">course if you're sending a message</span> <span data-start="411.75" data-end="413.64">that's not chat you might not have a</span> <span data-start="413.64" data-end="416.39">body you might have something else here</span> <span data-start="416.39" data-end="420.45">presence is how you know somebody is</span> <span data-start="420.45" data-end="423.18">online or a way or busy and that kind of</span> <span data-start="423.18" data-end="426">thing in XMPP we use it it's sort of a</span> <span data-start="426" data-end="429.84">mini publish/subscribe system here's</span> <span data-start="429.84" data-end="432.92">somebody setting their presence to away</span> <span data-start="432.92" data-end="435.66">we have you know type equals away</span> <span data-start="435.66" data-end="437.49">there's also if you have no type than</span> <span data-start="437.49" data-end="439.17">its type util it's basically available</span> <span data-start="439.17" data-end="441.69">presence there's also do not disturb and</span> <span data-start="441.69" data-end="444.63">some other ones and then the show is is</span> <span data-start="444.63" data-end="449.28">a it's not arbitrary text here there's</span> <span data-start="449.28" data-end="450.78">only a few possible parameters and</span> <span data-start="450.78" data-end="451.86">that's just to give the client</span> <span data-start="451.86" data-end="454.56">developers something I hint at how to</span> <span data-start="454.56" data-end="456.66">show this presence and then the status</span> <span data-start="456.66" data-end="458.16">is just freeform text you can put this</span> <span data-start="458.16" data-end="459.69">is like Facebook status messages or</span> </p>
<p><span data-start="459.69" data-end="462.54">Twitter updates that kind of thing and</span> <span data-start="462.54" data-end="464.79">one last thing on presence is that you</span> <span data-start="464.79" data-end="466.32">have to subscribe to people's presence</span> <span data-start="466.32" data-end="468.15">so for instance if I want to add</span> <span data-start="468.15" data-end="471.12">somebody to my so we can't say buddy</span> <span data-start="471.12" data-end="472.77">list because AOL has trademarked that</span> <span data-start="472.77" data-end="475.02">name so we call them rosters if I want</span> <span data-start="475.02" data-end="477.72">to add somebody to my roster I send them</span> <span data-start="477.72" data-end="479.85">a present subscription request and they</span> <span data-start="479.85" data-end="482.28">can approve it or deny it and then I can</span> <span data-start="482.28" data-end="483.9">see their presence and these presents</span> <span data-start="483.9" data-end="486.15">are two-way just like Twitter follows</span> <span data-start="486.15" data-end="488.13">which means I can subscribe to you but</span> <span data-start="488.13" data-end="489.63">you don't have to be subscribed to me or</span> <span data-start="489.63" data-end="491.16">we can be mutually subscribed to each</span> <span data-start="491.16" data-end="499.38">other so so I queue messages are look</span> <span data-start="499.38" data-end="503.07">just like this there's a there's a two</span> <span data-start="503.07" data-end="504.99">just like everything else has we have a</span> <span data-start="504.99" data-end="507.78">type equals get there's also a type</span> <span data-start="507.78" data-end="510.21">equal set get is sort of like a HTTP GET</span> <span data-start="510.21" data-end="511.59">request and set would be more like a</span> <span data-start="511.59" data-end="514.05">post so this is generally used when</span> <span data-start="514.05" data-end="515.52">you're accessing some information as</span> <span data-start="515.52" data-end="517.5">opposed to you know changing some data</span> <span data-start="517.5" data-end="520.41">all of every IQ has to have this ID</span> <span data-start="520.41" data-end="522.18">attribute they have to be unique for the</span> <span data-start="522.18" data-end="524.19">stream and this is because when you get</span> <span data-start="524.19" data-end="526.53">a response to the IQ it has to have the</span> <span data-start="526.53" data-end="528.69">same ID attribute on the response and</span> <span data-start="528.69" data-end="532.26">then a lot of the different protocols</span> <span data-start="532.26" data-end="534.93">and XMPP use this query child</span> <span data-start="534.93" data-end="537.24">this namespace here I've shortened them</span> <span data-start="537.24" data-end="539.4">so these aren't the real quite the real</span> <span data-start="539.4" data-end="541.92">namespaces tells you which sort of</span> <span data-start="541.92" data-end="544.23">extension protocol is in use here this</span> <span data-start="544.23" data-end="547.58">one for instance is service discovery</span> <span data-start="547.58" data-end="550.47">here's the response to that same IQ that</span> <span data-start="550.47" data-end="554.28">would be sent from the server you can</span> <span data-start="554.28" data-end="556.8">see that we have the same ID there this</span> <span data-start="556.8" data-end="558.69">is type equals result because it's a</span> <span data-start="558.69" data-end="560.13">response we could also have a type</span> <span data-start="560.13" data-end="561.86">equals error if something went wrong and</span> <span data-start="561.86" data-end="564.84">we have the same idea as I said and then</span> <span data-start="564.84" data-end="567.63">this is this is all of the answer stuff</span> <span data-start="567.63" data-end="570.57">so we did a service discovery queries</span> <span data-start="570.57" data-end="572.34">and this is the service discovery result</span> <span data-start="572.34" data-end="574.83">it's telling us about the identity of</span> <span data-start="574.83" data-end="577.14">this thing is an e jeopardy server and</span> <span data-start="577.14" data-end="579.24">it has these features and usually there</span> <span data-start="579.24" data-end="582.11">will be a giant list of these it for a</span> </p>
<p><span data-start="582.11" data-end="585.63">XMPP server various different objects on</span> <span data-start="585.63" data-end="587.67">the XMPP Network will respond to service</span> <span data-start="587.67" data-end="589.74">discovery queries with with different</span> <span data-start="589.74" data-end="592.92">things so now we get to this point where</span> <span data-start="592.92" data-end="595.22">we want to integrate XMPP with the web</span> <span data-start="595.22" data-end="597.51">which is kind of a challenge because as</span> <span data-start="597.51" data-end="598.98">we all know the web is stateless and</span> <span data-start="598.98" data-end="602.97">it's only one way well I mean we can</span> <span data-start="602.97" data-end="604.71">only ask in one direction we can't ask</span> <span data-start="604.71" data-end="608.04">them the other direction so there's a</span> <span data-start="608.04" data-end="610.29">lot of sites that have started using X</span> <span data-start="610.29" data-end="611.97">and PP on the web these are a couple of</span> <span data-start="611.97" data-end="614.88">them these sites are chess Park is a</span> <span data-start="614.88" data-end="616.29">site that I built the other three are</span> <span data-start="616.29" data-end="618.75">not all of these sites use the library</span> <span data-start="618.75" data-end="620.51">that I'm about to show you</span> <span data-start="620.51" data-end="624.66">dropo uses XMPP every collaboration zone</span> <span data-start="624.66" data-end="627.18">and drop yo is a multi-user chatroom so</span> <span data-start="627.18" data-end="629.79">when so when you you know drag a file</span> <span data-start="629.79" data-end="631.8">into the browser to share with your</span> <span data-start="631.8" data-end="633.6">friends it actually sends a message to</span> <span data-start="633.6" data-end="635.19">the group chat room and everyone in the</span> <span data-start="635.19" data-end="637.8">collaboration in the collaboration space</span> <span data-start="637.8" data-end="640.23">will get a message XMPP message saying</span> <span data-start="640.23" data-end="643.2">there's a file dragged there and that</span> <span data-start="643.2" data-end="645.36">kind of thing presently and Yammer both</span> <span data-start="645.36" data-end="647.04">use it for real-time updates on the site</span> <span data-start="647.04" data-end="651.5">to keep the the homepage is dynamic and</span> </p>
<p><span data-start="651.5" data-end="654.18">XMPP on the web is sort of made possible</span> <span data-start="654.18" data-end="655.77">through Bosh which is bi-directional</span> <span data-start="655.77" data-end="658.92">streams over synchronous HTTP you know</span> <span data-start="658.92" data-end="661.89">this is a really fancy name for long</span> <span data-start="661.89" data-end="666.24">polling so I don't know how many of you</span> <span data-start="666.24" data-end="668.04">guys know what long polling is</span> <span data-start="668.04" data-end="672.42">so a couple of you so this is what long</span> <span data-start="672.42" data-end="674.52">polling and normal polling look like in</span> <span data-start="674.52" data-end="676.86">the normal polling situation the top</span> <span data-start="676.86" data-end="679.62">line here with this red stuff the very</span> <span data-start="679.62" data-end="682.86">top of that is the client side so the</span> <span data-start="682.86" data-end="684.69">client makes a request since data to the</span> <span data-start="684.69" data-end="686.79">server hey is there anything new the</span> <span data-start="686.79" data-end="688.02">server responds immediately there's</span> <span data-start="688.02" data-end="689.67">nothing and then we wait for a while</span> <span data-start="689.67" data-end="691.71">maybe it's a minute then we send another</span> <span data-start="691.71" data-end="693.54">request hey is there anything new and</span> <span data-start="693.54" data-end="695.07">you can see this keeps happening over</span> <span data-start="695.07" data-end="697.77">and over and over long polling turns</span> <span data-start="697.77" data-end="699.87">this exactly around so now we send a</span> <span data-start="699.87" data-end="701.43">request to the server hey is there</span> <span data-start="701.43" data-end="703.62">anything new and now the server is smart</span> <span data-start="703.62" data-end="705.72">it says well there's nothing new but</span> <span data-start="705.72" data-end="707.46">there might be soon so I'm just going to</span> <span data-start="707.46" data-end="710.37">hang on to the result as long as I can</span> <span data-start="710.37" data-end="712.26">and that way if something new comes in</span> </p>
<p><span data-start="712.26" data-end="714.78">I'll just fire it back with the new data</span> <span data-start="714.78" data-end="717.48">if nothing new comes in after some time</span> <span data-start="717.48" data-end="719.76">like maybe a minute or so I'll just fire</span> <span data-start="719.76" data-end="721.65">it back empty and at that point the</span> <span data-start="721.65" data-end="723.57">client will re request and it'll sit</span> <span data-start="723.57" data-end="725.34">there so in long polling you have these</span> <span data-start="725.34" data-end="727.44">long periods where the request is on the</span> <span data-start="727.44" data-end="729.54">server end waiting for a response and</span> <span data-start="729.54" data-end="730.83">this allows you to do two-way</span> <span data-start="730.83" data-end="732.75">communication pretty efficiently about</span> <span data-start="732.75" data-end="734.25">as efficiently as you can do anything</span> <span data-start="734.25" data-end="739.62">over HTTP like this and it's the clients</span> <span data-start="739.62" data-end="741.87">responsibility so for instance if you</span> <span data-start="741.87" data-end="744.48">send a request and you wait for a while</span> <span data-start="744.48" data-end="746.34">and now you need to send data to the</span> <span data-start="746.34" data-end="749.4">server when you send the new request the</span> <span data-start="749.4" data-end="751.41">server will release the old one because</span> <span data-start="751.41" data-end="752.82">you only have two requests available in</span> <span data-start="752.82" data-end="754.65">most browsers so we have to you know</span> <span data-start="754.65" data-end="756.65">keep jumping back and forth between them</span> <span data-start="756.65" data-end="759.99">so boss uses this this this bottom</span> <span data-start="759.99" data-end="762">version of it — to enable it to have</span> <span data-start="762" data-end="766.23">two-way low latency communication and</span> <span data-start="766.23" data-end="769.47">now we get to Stroeve so so before is</span> <span data-start="769.47" data-end="774.459">there a question okay</span> <span data-start="774.459" data-end="786.38">before we get to what comments oh yeah</span> <span data-start="786.38" data-end="790.399">it's like comet yeah sorry um comet and</span> </p>
<p><span data-start="790.399" data-end="793.1">Bosh are are similar technologies and</span> <span data-start="793.1" data-end="794.509">people have written long Polar's that</span> <span data-start="794.509" data-end="796.91">don't do comment or Bosh they'd use</span> <span data-start="796.91" data-end="800.269">custom protocols cut the CouchDB team is</span> <span data-start="800.269" data-end="803.87">working on such a thing for instance so</span> <span data-start="803.87" data-end="806.149">here's some examples of things this is a</span> <span data-start="806.149" data-end="807.92">group chat application that my team</span> <span data-start="807.92" data-end="811.009">wrote that uses this i hope i'm still</span> <span data-start="811.009" data-end="813.079">logged in but you know you can see I can</span> <span data-start="813.079" data-end="817.43">type stuff and it appears instantly we</span> <span data-start="817.43" data-end="819.47">can log in and do all that kind of stuff</span> <span data-start="819.47" data-end="821.63">this is my presence up here these are</span> <span data-start="821.63" data-end="824.18">the other people in the room so they can</span> <span data-start="824.18" data-end="828.86">talk back so you can see the latency is</span> <span data-start="828.86" data-end="830.209">pretty low because I'm actually waiting</span> <span data-start="830.209" data-end="831.829">for the server to reset to send me the</span> <span data-start="831.829" data-end="833.569">message that I just typed to show it on</span> <span data-start="833.569" data-end="836.06">the screen this is another application</span> <span data-start="836.06" data-end="838.189">we wrote chess park where you can play</span> <span data-start="838.189" data-end="840.949">chess games the most popular speed of</span> <span data-start="840.949" data-end="842.99">game on this service is all the moves in</span> <span data-start="842.99" data-end="845.54">one minute per side so we had to get it</span> <span data-start="845.54" data-end="847.25">extremely low latency for this to work</span> <span data-start="847.25" data-end="849.769">at all and maybe I'll give it a second</span> <span data-start="849.769" data-end="853.88">to see if it loads up really fast so you</span> <span data-start="853.88" data-end="855.769">can sort of see the how dynamic the</span> <span data-start="855.769" data-end="859.85">initial interface is so this actually</span> <span data-start="859.85" data-end="862.73">just this is a full XMPP client we have</span> <span data-start="862.73" data-end="867.23">a the roster over here on the left the</span> <span data-start="867.23" data-end="869.269">private chats and group chats will load</span> <span data-start="869.269" data-end="871.399">here on the right this middle list is</span> <span data-start="871.399" data-end="872.689">games that people are actively looking</span> <span data-start="872.689" data-end="874.1">for and it will be changing the whole</span> <span data-start="874.1" data-end="875.72">time we're looking at this page like</span> <span data-start="875.72" data-end="877.1">there's two just disappeared because</span> <span data-start="877.1" data-end="879.259">they started we can watch games and all</span> <span data-start="879.259" data-end="880.639">kinds of stuff like that so this site is</span> <span data-start="880.639" data-end="883.009">incredibly dynamic and it's using the</span> <span data-start="883.009" data-end="885.11">api's that is using our XMPP right in</span> <span data-start="885.11" data-end="886.85">the JavaScript so we're building XMPP</span> <span data-start="886.85" data-end="889.009">protocol messages we're sending them</span> <span data-start="889.009" data-end="890.87">it has latency characteristics similar</span> <span data-start="890.87" data-end="893.959">to a desktop client and its end as far</span> <span data-start="893.959" data-end="895.37">as the developers are concerned they're</span> <span data-start="895.37" data-end="898.579">not that they don't ever see the you</span> <span data-start="898.579" data-end="899.959">know the long polling bits of it it</span> <span data-start="899.959" data-end="902.36">looks like a real stateful XMPP</span> <span data-start="902.36" data-end="905.38">connection to them</span> <span data-start="905.39" data-end="908.99">and so I'll get into the strophe so</span> <span data-start="908.99" data-end="910.579">strophe is the library I wrote the</span> </p>
<p><span data-start="910.579" data-end="912.23">JavaScript library I wrote them to make</span> <span data-start="912.23" data-end="916.1">XMPP in the web browsers possible it is</span> <span data-start="916.1" data-end="919.22">mostly for writing XMPP clients you you</span> <span data-start="919.22" data-end="921.67">can't really write a server with Bosh</span> <span data-start="921.67" data-end="924.41">and in the browser's well I don't know</span> <span data-start="924.41" data-end="925.67">why you would want to but even if you</span> <span data-start="925.67" data-end="927.079">wanted to it's not really possible with</span> <span data-start="927.079" data-end="929.959">the protocol it's it's in pure</span> <span data-start="929.959" data-end="931.67">JavaScript although I'll probably</span> <span data-start="931.67" data-end="934.399">integrate your project over there</span> <span data-start="934.399" data-end="935.779">fliends so there might be in the visible</span> <span data-start="935.779" data-end="937.69">flash thing so we can do cross domain</span> <span data-start="937.69" data-end="940.22">stuff really easily and we made it to</span> <span data-start="940.22" data-end="941.959">power real-time web applications where</span> <span data-start="941.959" data-end="944.269">there's you know lots of collaboration</span> <span data-start="944.269" data-end="947.63">and dynamicism it's fully documented the</span> <span data-start="947.63" data-end="949.25">whole library has documents even for</span> <span data-start="949.25" data-end="950.959">internal structures so if you're not</span> <span data-start="950.959" data-end="952.25">sure how something works you can just</span> <span data-start="952.25" data-end="955.579">look it up and it's highly optimized and</span> <span data-start="955.579" data-end="957.23">what I mean by this is not necessarily</span> <span data-start="957.23" data-end="958.94">that this is the fastest xhr</span> <span data-start="958.94" data-end="961.01">implementation on earth I mean that</span> <span data-start="961.01" data-end="963.47">there's a lot of edge cases in xhr when</span> <span data-start="963.47" data-end="965.93">you're doing lots and XML HTTP requests</span> <span data-start="965.93" data-end="968.209">when you're doing lots of these requests</span> </p>
<p><span data-start="968.209" data-end="972.41">I mean the the xhr object only</span> <span data-start="972.41" data-end="974.959">understands HTTP error codes for</span> <span data-start="974.959" data-end="977.39">instance so it knows if you get a 404 it</span> <span data-start="977.39" data-end="979.459">knows if you get a 500 error if your</span> <span data-start="979.459" data-end="981.32">proxy server drops the request and never</span> <span data-start="981.32" data-end="983.12">returns any data it doesn't know what to</span> <span data-start="983.12" data-end="985.1">do about that if the server never</span> <span data-start="985.1" data-end="986.779">returns anything it doesn't know what to</span> <span data-start="986.779" data-end="987.44">do about that</span> <span data-start="987.44" data-end="989.6">so strophe is highly optimized in the</span> <span data-start="989.6" data-end="991.82">sense that it will detect if we were</span> <span data-start="991.82" data-end="994.18">supposed to get data back and didn't</span> <span data-start="994.18" data-end="997.55">because if you if you don't time out and</span> <span data-start="997.55" data-end="1000.01">do fancy stuff like that you're you're</span> <span data-start="1000.01" data-end="1001.93">low latency dreams will be smashed to</span> <span data-start="1001.93" data-end="1004.029">bits because you'll be waiting like nine</span> <span data-start="1004.029" data-end="1005.769">minutes for the proxy server to timeout</span> <span data-start="1005.769" data-end="1007.42">on the request response and the whole</span> <span data-start="1007.42" data-end="1008.92">time the user can't do anything so</span> <span data-start="1008.92" data-end="1012.91">there's a like most of the grueling</span> <span data-start="1012.91" data-end="1015.399">parts of strophe are all error handling</span> <span data-start="1015.399" data-end="1018.19">of xhr stuff and it's been well tested</span> <span data-start="1018.19" data-end="1020.019">we've used it on chess Park for about</span> <span data-start="1020.019" data-end="1021.85">three and a half years now</span> <span data-start="1021.85" data-end="1023.62">it works on the Wii it works on the</span> <span data-start="1023.62" data-end="1025.959">iPhone I mean it literally works pretty</span> <span data-start="1025.959" data-end="1028.87">much anywhere there's a couple people</span> <span data-start="1028.87" data-end="1031.209">now on doing Adobe AIR apps that that</span> <span data-start="1031.209" data-end="1034.75">use the same that you strop we built it</span> <span data-start="1034.75" data-end="1036.52">for chess park but it's an open source</span> <span data-start="1036.52" data-end="1038.319">project</span> <span data-start="1038.319" data-end="1040.809">we use it to power stanczyk which is now</span> <span data-start="1040.809" data-end="1042.37">collective which is a real-time search</span> <span data-start="1042.37" data-end="1044.02">engine that I work on and speak which is</span> <span data-start="1044.02" data-end="1045.939">the group application I showed you guys</span> <span data-start="1045.939" data-end="1048.189">and and a bunch of different companies</span> <span data-start="1048.189" data-end="1050.23">use it neuro so st uses it to put in</span> <span data-start="1050.23" data-end="1053.08">chat where the subtitles go and TV shows</span> <span data-start="1053.08" data-end="1055.03">so you can chat with all other people</span> <span data-start="1055.03" data-end="1057.01">you know who have Neuros OSD boxes which</span> <span data-start="1057.01" data-end="1060.01">is probably not very many so let's let's</span> <span data-start="1060.01" data-end="1061.96">like actually build something or or at</span> <span data-start="1061.96" data-end="1063.19">least see how something is built with</span> <span data-start="1063.19" data-end="1065.679">this library so first we have to manage</span> <span data-start="1065.679" data-end="1068.35">the connection because each XMPP think</span> <span data-start="1068.35" data-end="1070.21">has a connection and we have to do a</span> <span data-start="1070.21" data-end="1072.7">connection so we just do VAR connection</span> <span data-start="1072.7" data-end="1074.53">equals new stroke connection and this</span> </p>
<p><span data-start="1074.53" data-end="1076.36">URL is going to be the URL of the Boche</span> <span data-start="1076.36" data-end="1079.27">connection manager and normally this is</span> <span data-start="1079.27" data-end="1081.52">you know just someone will tell you what</span> <span data-start="1081.52" data-end="1083.08">this URL is or you'll set up a Bosch</span> <span data-start="1083.08" data-end="1085.33">connection manager and you'll give it</span> <span data-start="1085.33" data-end="1088.12">the URL for that once you have this</span> <span data-start="1088.12" data-end="1089.5">connection object you can call the</span> <span data-start="1089.5" data-end="1090.73">connect function and pass it the</span> <span data-start="1090.73" data-end="1093.039">username and password and there's also a</span> <span data-start="1093.039" data-end="1094.78">callback and the callback will get</span> <span data-start="1094.78" data-end="1096.669">called whenever the connection state</span> <span data-start="1096.669" data-end="1099.94">changes if you pass in a username like</span> <span data-start="1099.94" data-end="1102.039">user at domain then the server will give</span> <span data-start="1102.039" data-end="1104.559">you a resource we saw those earlier so</span> <span data-start="1104.559" data-end="1106.03">every every connection has one of these</span> <span data-start="1106.03" data-end="1108.25">you can pass in a resource and it'll use</span> <span data-start="1108.25" data-end="1112.33">that one or you can do what's called</span> <span data-start="1112.33" data-end="1114.429">sass all anonymous authentication which</span> <span data-start="1114.429" data-end="1116.44">means you sort of login as a guest you</span> <span data-start="1116.44" data-end="1118.24">have no authentication credentials</span> <span data-start="1118.24" data-end="1119.98">you don't need a username and password</span> <span data-start="1119.98" data-end="1122.289">you just login with the server or the</span> <span data-start="1122.289" data-end="1124.48">server and the resource and you'll get</span> <span data-start="1124.48" data-end="1126.159">an account and you can interact with the</span> <span data-start="1126.159" data-end="1128.53">server we use this for for applications</span> <span data-start="1128.53" data-end="1130.929">which don't that we don't have user</span> <span data-start="1130.929" data-end="1132.789">credentials for or for instance on speak</span> <span data-start="1132.789" data-end="1135.039">if you first come to the site we log you</span> <span data-start="1135.039" data-end="1136.6">in anonymously and let you use the</span> <span data-start="1136.6" data-end="1138.19">service without having you sign up and</span> <span data-start="1138.19" data-end="1140.53">then later if you sign up we you can</span> <span data-start="1140.53" data-end="1142.45">upgrade your your connection to an</span> <span data-start="1142.45" data-end="1145.809">authenticated one the connection</span> <span data-start="1145.809" data-end="1148.09">callback just reports the status so</span> <span data-start="1148.09" data-end="1150.52">whenever Stroeve it will attempt to</span> <span data-start="1150.52" data-end="1151.84">connect it will attempt to authenticate</span> <span data-start="1151.84" data-end="1154.27">it'll and it'll have connection errors</span> <span data-start="1154.27" data-end="1155.919">and each time one of these states</span> <span data-start="1155.919" data-end="1157.929">happens you'll get the callback will get</span> <span data-start="1157.929" data-end="1161.23">notified that it happened it's all the</span> <span data-start="1161.23" data-end="1163.24">normal stuff that you would expect the</span> <span data-start="1163.24" data-end="1165.429">main one that you want to work with is</span> <span data-start="1165.429" data-end="1166.78">you you're sitting around waiting for</span> <span data-start="1166.78" data-end="1168.22">the connected state and then you can</span> <span data-start="1168.22" data-end="1170.8">actually do some stuff</span> <span data-start="1170.8" data-end="1172.45">and this is how you would do that so</span> <span data-start="1172.45" data-end="1175.24">this is the callback handler for that I</span> <span data-start="1175.24" data-end="1177.16">would pass to connect and this one's</span> <span data-start="1177.16" data-end="1178.87">really simple it just waits until I get</span> <span data-start="1178.87" data-end="1181.12">the status connected and then it does</span> <span data-start="1181.12" data-end="1183.25">some stuff and I don't have the stuff</span> <span data-start="1183.25" data-end="1185.8">that it does in here right now but</span> <span data-start="1185.8" data-end="1187.18">usually you would set an initial</span> <span data-start="1187.18" data-end="1188.8">presence to the server so you would tell</span> <span data-start="1188.8" data-end="1190.66">a server server like hey I'm actually</span> <span data-start="1190.66" data-end="1192.46">here and you would do queries for your</span> <span data-start="1192.46" data-end="1193.72">roster and stuff like that if you were</span> <span data-start="1193.72" data-end="1196.66">writing an IM type client and then we</span> <span data-start="1196.66" data-end="1199.6">need to be able to send data once we're</span> <span data-start="1199.6" data-end="1200.95">connected and now we can just call</span> <span data-start="1200.95" data-end="1202.57">connection send and we have to send it</span> </p>
<p><span data-start="1202.57" data-end="1204.88">XML and the reason we send it these are</span> <span data-start="1204.88" data-end="1206.86">actually Dom objects and the reason we</span> <span data-start="1206.86" data-end="1210.04">do that is if we send invalid XML for</span> <span data-start="1210.04" data-end="1211.42">instance if we craft it by hand and</span> <span data-start="1211.42" data-end="1214.42">forget to escape something then X and PP</span> <span data-start="1214.42" data-end="1215.89">will just drop the connection so we</span> <span data-start="1215.89" data-end="1217.39">don't allow the user to do that we make</span> <span data-start="1217.39" data-end="1219.85">them give us nice XML and that way we</span> <span data-start="1219.85" data-end="1221.86">don't have anything to worry about and</span> </p>
<p><span data-start="1221.86" data-end="1223.36">I'll talk about some about building that</span> <span data-start="1223.36" data-end="1225.22">later and then disconnecting is really</span> <span data-start="1225.22" data-end="1229.54">easy we just call disconnect so that's</span> <span data-start="1229.54" data-end="1231.1">pretty much all of it except for</span> <span data-start="1231.1" data-end="1234.34">handling events so XMPP is all about</span> <span data-start="1234.34" data-end="1236.22">being event-driven</span> <span data-start="1236.22" data-end="1239.92">just like most UI code and we have</span> <span data-start="1239.92" data-end="1242.74">interaction events we have stamp timed</span> <span data-start="1242.74" data-end="1246.1">events and we have stanza events now</span> <span data-start="1246.1" data-end="1248.5">interaction events are sort of like when</span> <span data-start="1248.5" data-end="1250.39">a user clicks on a button then you need</span> <span data-start="1250.39" data-end="1252.16">to do something to it so for instance if</span> <span data-start="1252.16" data-end="1254.11">we have a send button the interaction</span> <span data-start="1254.11" data-end="1256.45">event gets called and and you know this</span> <span data-start="1256.45" data-end="1258.16">is just I'm using jQuery here as an</span> <span data-start="1258.16" data-end="1259.75">example but this is possible in any of</span> <span data-start="1259.75" data-end="1262.33">the libraries pretty much you build a</span> <span data-start="1262.33" data-end="1264.07">message stanza send a message for it for</span> <span data-start="1264.07" data-end="1271.45">instance if you have stanza events that</span> <span data-start="1271.45" data-end="1273.25">means that you set up a hand you you</span> <span data-start="1273.25" data-end="1274.81">call this function add handler and you</span> <span data-start="1274.81" data-end="1276.7">tell what kind of stanzas you're looking</span> <span data-start="1276.7" data-end="1278.59">for so here we're looking for a message</span> <span data-start="1278.59" data-end="1281.95">stanza of type chat and when that when</span> <span data-start="1281.95" data-end="1283.57">we whenever the connection sees one of</span> <span data-start="1283.57" data-end="1285.31">those it's going to call on message</span> <span data-start="1285.31" data-end="1289.27">which is a just a callback function and</span> <span data-start="1289.27" data-end="1290.53">this is what that callback function</span> <span data-start="1290.53" data-end="1292.03">might look like it gets passed in the</span> <span data-start="1292.03" data-end="1294.43">message Dom element and we can and we</span> <span data-start="1294.43" data-end="1295.81">can do whatever we want with that</span> <span data-start="1295.81" data-end="1298.24">message like for instance extracting out</span> <span data-start="1298.24" data-end="1300.37">the message body and displaying it on</span> <span data-start="1300.37" data-end="1302.83">screen and then we return true which</span> <span data-start="1302.83" data-end="1303.9">means that this handler will</span> <span data-start="1303.9" data-end="1305.55">keep getting called back if we return</span> <span data-start="1305.55" data-end="1306.99">false here then the handler will sort of</span> <span data-start="1306.99" data-end="1307.7">disappear</span> <span data-start="1307.7" data-end="1310.02">so if you were doing a one-off handler</span> <span data-start="1310.02" data-end="1311.58">or something that needed chaining you</span> <span data-start="1311.58" data-end="1313.73">might return a different value there and</span> <span data-start="1313.73" data-end="1316.92">then IQ stans's which we talked about</span> <span data-start="1316.92" data-end="1320.79">which have to have results Oh another</span> <span data-start="1320.79" data-end="1322.65">good example of when you would have a</span> <span data-start="1322.65" data-end="1326.1">stands a handler if you're answering it</span> <span data-start="1326.1" data-end="1328.74">is if someone sends you an IQ stanza</span> <span data-start="1328.74" data-end="1330.69">you're required to return a result and</span> <span data-start="1330.69" data-end="1334.5">the way you would do that is you would</span> <span data-start="1334.5" data-end="1337.26">just listen for IQ stanzas so for</span> <span data-start="1337.26" data-end="1339.6">instance here is type equals get and the</span> <span data-start="1339.6" data-end="1342.18">the sort of the extension protocol thing</span> <span data-start="1342.18" data-end="1344.25">they're using is jabber IQ version which</span> <span data-start="1344.25" data-end="1345.72">is actually the thing that you use to</span> <span data-start="1345.72" data-end="1347.04">say like what version of the client</span> <span data-start="1347.04" data-end="1349.35">software are you running so someone</span> <span data-start="1349.35" data-end="1350.67">might send you this just to see what</span> <span data-start="1350.67" data-end="1353.85">kind of features you support and then</span> <span data-start="1353.85" data-end="1355.74">the other side is you might you'll send</span> <span data-start="1355.74" data-end="1357.75">an IQ and you're going to expect a</span> <span data-start="1357.75" data-end="1359.34">response that you have to watch for and</span> <span data-start="1359.34" data-end="1361.74">so here we we're still watching for IQ</span> <span data-start="1361.74" data-end="1363.66">messages we don't care about what the</span> <span data-start="1363.66" data-end="1365.28">type is because remember this might be</span> <span data-start="1365.28" data-end="1367.2">result it might be error and we're going</span> <span data-start="1367.2" data-end="1369.06">to handle both of them here and we know</span> <span data-start="1369.06" data-end="1370.92">that we want to handle this disco one</span> <span data-start="1370.92" data-end="1373.44">because we normally what will happen is</span> <span data-start="1373.44" data-end="1375.48">you'll you'll create a unique ID you'll</span> <span data-start="1375.48" data-end="1377.16">send out an IQ stanza and then you'll</span> <span data-start="1377.16" data-end="1378.87">use that unique ID here and the handler</span> <span data-start="1378.87" data-end="1383.19">to handle the message and then timed</span> <span data-start="1383.19" data-end="1385.26">handlers are just this is just a silly</span> <span data-start="1385.26" data-end="1387.51">wrapper around set timeout so that</span> <span data-start="1387.51" data-end="1390.84">everything is consistent and you guys</span> <span data-start="1390.84" data-end="1392.58">can use that one or you can use jquery's</span> <span data-start="1392.58" data-end="1394.53">or whatever at the time that I</span> <span data-start="1394.53" data-end="1395.88">originally wrote stuff there wasn't a</span> <span data-start="1395.88" data-end="1397.8">jQuery so that's why some of this stuff</span> <span data-start="1397.8" data-end="1400.98">ended up in here and in building stanzas</span> <span data-start="1400.98" data-end="1403.08">is sort of the last bit so I made this</span> <span data-start="1403.08" data-end="1404.49">thing called strophe builder because</span> <span data-start="1404.49" data-end="1406.29">working with the Dom API is sort of</span> <span data-start="1406.29" data-end="1410.73">gnarly and this is inspired by jQuery it</span> <span data-start="1410.73" data-end="1413.31">always returns a surf builder or almost</span> <span data-start="1413.31" data-end="1415.17">always so you can do this chaining like</span> <span data-start="1415.17" data-end="1418.71">people are familiar with with jQuery and</span> <span data-start="1418.71" data-end="1420.96">this is what it looks like at the basic</span> <span data-start="1420.96" data-end="1423.48">level so you have a stanza and you call</span> <span data-start="1423.48" data-end="1425.28">stroke builder you say message you pass</span> <span data-start="1425.28" data-end="1427.11">it some attributes and that'll build you</span> <span data-start="1427.11" data-end="1430.74">a message and all the methods are</span> <span data-start="1430.74" data-end="1432.63">chainable like I said so for instance</span> <span data-start="1432.63" data-end="1434.97">you can add a child</span> <span data-start="1434.97" data-end="1436.71">to the Dom with the name and attributes</span> <span data-start="1436.71" data-end="1439.38">just like we did there we can add a text</span> <span data-start="1439.38" data-end="1442.98">node very easily we can add pre-made</span> <span data-start="1442.98" data-end="1444.48">children so for instance if you have an</span> <span data-start="1444.48" data-end="1445.83">element already that you receive then</span> <span data-start="1445.83" data-end="1447.36">you're just you know plucking out some</span> <span data-start="1447.36" data-end="1448.799">bit of it and putting it back in you can</span> <span data-start="1448.799" data-end="1452.1">use C node and you can modify the</span> <span data-start="1452.1" data-end="1453.75">attributes this is really useful if you</span> <span data-start="1453.75" data-end="1455.33">have something that builds basic</span> <span data-start="1455.33" data-end="1457.62">attribute you know stanzas and you just</span> <span data-start="1457.62" data-end="1459.87">have to put a new two attribute on it or</span> <span data-start="1459.87" data-end="1462.78">something like that and we have a thing</span> <span data-start="1462.78" data-end="1464.64">that traverses up the tree so when you</span> <span data-start="1464.64" data-end="1466.35">add a child the next child will be a</span> <span data-start="1466.35" data-end="1468.27">child of that child so it sort of goes</span> <span data-start="1468.27" data-end="1470.159">downwards so you need a function to sort</span> <span data-start="1470.159" data-end="1471.63">of go back up the stack so you can make</span> <span data-start="1471.63" data-end="1474.03">siblings and here's some examples of how</span> <span data-start="1474.03" data-end="1477.24">it works this is building a message very</span> <span data-start="1477.24" data-end="1478.62">similar to the long that we saw earlier</span> <span data-start="1478.62" data-end="1481.59">so we create a message we send it to</span> <span data-start="1481.59" data-end="1484.049">somebody it's type equals chat we create</span> <span data-start="1484.049" data-end="1486.21">a child of type body and within that</span> <span data-start="1486.21" data-end="1488.85">child we create a text node of hello</span> <span data-start="1488.85" data-end="1492.809">world here's a slightly more complicated</span> <span data-start="1492.809" data-end="1493.289">one</span> <span data-start="1493.289" data-end="1494.76">this one is the same as the one we just</span> <span data-start="1494.76" data-end="1497.22">saw except that I go back up the stack</span> <span data-start="1497.22" data-end="1500.52">and I make an HTML child which uses the</span> </p>
<p><span data-start="1500.52" data-end="1502.83">XHTML I am specification which is a way</span> <span data-start="1502.83" data-end="1507.21">to send HTML messages over in your XMPP</span> <span data-start="1507.21" data-end="1509.76">messages and then I make a body tag and</span> <span data-start="1509.76" data-end="1513.36">Pia and have hi and then there's a bunch</span> <span data-start="1513.36" data-end="1514.95">of convenience functions for stroke</span> <span data-start="1514.95" data-end="1516.45">builders because typing new stroke</span> <span data-start="1516.45" data-end="1518.429">builder is pretty long thing to type so</span> <span data-start="1518.429" data-end="1519.99">we have dollar sign press dollar sign</span> <span data-start="1519.99" data-end="1522.86">message dollar sign IQ these will make</span> <span data-start="1522.86" data-end="1527.07">the three basic XMPP stanzas along with</span> <span data-start="1527.07" data-end="1528.84">their attributes without having to do</span> <span data-start="1528.84" data-end="1531.36">any extra work so this is the shortest</span> <span data-start="1531.36" data-end="1533.13">stroke builder thing that you can do</span> <span data-start="1533.13" data-end="1536.07">dollar sign pres parens and that's the</span> <span data-start="1536.07" data-end="1539.039">shortest valid XMPP message you can also</span> <span data-start="1539.039" data-end="1542.13">send here's the same message that we</span> <span data-start="1542.13" data-end="1543.809">originally saw like the hello world one</span> <span data-start="1543.809" data-end="1546.299">with the body and XMPP rocks but with</span> <span data-start="1546.299" data-end="1549.929">this convenience function and now we get</span> <span data-start="1549.929" data-end="1551.669">to the unchangeable methods and there's</span> <span data-start="1551.669" data-end="1553.23">just a couple of these we have two</span> <span data-start="1553.23" data-end="1555.659">string which serializes the Dom element</span> <span data-start="1555.659" data-end="1557.46">to a string so you can see what it looks</span> <span data-start="1557.46" data-end="1559.2">like or printed out somewhere</span> <span data-start="1559.2" data-end="1562.59">we have dot tree which will return it's</span> <span data-start="1562.59" data-end="1564.33">sort of like jquery's get it just</span> <span data-start="1564.33" data-end="1568.669">returns us the actual top-level Dom tree</span> <span data-start="1568.669" data-end="1570.109">and those that's it for the untrainable</span> <span data-start="1570.109" data-end="1571.999">ones so let's look at an actual</span> <span data-start="1571.999" data-end="1574.6">application that uses this stuff and</span> <span data-start="1574.6" data-end="1577.45">first I'm just going to show you the</span> <span data-start="1577.45" data-end="1581.69">application so what this application</span> <span data-start="1581.69" data-end="1583.519">does is I'm going to type a server</span> <span data-start="1583.519" data-end="1585.59">address in here it's going to connect to</span> <span data-start="1585.59" data-end="1588.98">the XMPP server it's going to ask it</span> <span data-start="1588.98" data-end="1591.739">what stuff it supports and then it's</span> <span data-start="1591.739" data-end="1593.269">going to print it all out to us and</span> <span data-start="1593.269" data-end="1594.83">we'll get to see what that looks like so</span> </p>
<p><span data-start="1594.83" data-end="1596.6">I have an XMPP server running on</span> <span data-start="1596.6" data-end="1602.629">localhost hit connect and here it is</span> <span data-start="1602.629" data-end="1605.509">here's the answer so it's pretty simple</span> <span data-start="1605.509" data-end="1606.889">this is just a list of features that it</span> <span data-start="1606.889" data-end="1610.129">supports it's got a lot of pubsub stuff</span> <span data-start="1610.129" data-end="1612.049">on it and stuff it's an easy birdie</span> <span data-start="1612.049" data-end="1614.84">server and then this log tab shows us</span> <span data-start="1614.84" data-end="1617.539">the actual bosh protocol that got sent</span> <span data-start="1617.539" data-end="1619.97">so for instance this one right here is</span> <span data-start="1619.97" data-end="1622.009">the Boche is the initial Bosch thing</span> <span data-start="1622.009" data-end="1624.23">that sets up the connection and then</span> <span data-start="1624.23" data-end="1625.039">there's a bunch of stuff for</span> <span data-start="1625.039" data-end="1626.239">authentication that's not really that</span> <span data-start="1626.239" data-end="1630.169">interesting and then down here you can</span> <span data-start="1630.169" data-end="1632.98">see the IQ stands that we created right</span> <span data-start="1632.98" data-end="1637.009">there a get request to localhost with</span> <span data-start="1637.009" data-end="1639.679">the Disco info and then this next one is</span> <span data-start="1639.679" data-end="1643.399">the server's response and as soon as we</span> <span data-start="1643.399" data-end="1644.539">get the server's response we</span> <span data-start="1644.539" data-end="1646.279">disconnected and you can see it</span> <span data-start="1646.279" data-end="1648.139">disconnected and then the code for this</span> <span data-start="1648.139" data-end="1655.38">is really simple as well</span> <span data-start="1655.39" data-end="1658.03">so this is the the code for this</span> <span data-start="1658.03" data-end="1660.549">function so this is all using jQuery so</span> <span data-start="1660.549" data-end="1663.1">in the in the ready function I use</span> <span data-start="1663.1" data-end="1665.35">jQuery UI to setup the tabs and then I</span> <span data-start="1665.35" data-end="1667.809">hook up the connect button the connect</span> <span data-start="1667.809" data-end="1669.85">function is is right here can everybody</span> <span data-start="1669.85" data-end="1673.21">read this is it big enough okay so we</span> <span data-start="1673.21" data-end="1674.74">prevent the default events we create a</span> <span data-start="1674.74" data-end="1676.54">new strove connection with this raw</span> <span data-start="1676.54" data-end="1678.28">input and raw output or logging</span> <span data-start="1678.28" data-end="1680.38">functions so that's what generated that</span> </p>
<p><span data-start="1680.38" data-end="1682.059">XML strophe will call this whenever it</span> <span data-start="1682.059" data-end="1683.62">sends or receives anything over the wire</span> <span data-start="1683.62" data-end="1686.19">so you can use it for protocol debugging</span> <span data-start="1686.19" data-end="1688.48">we grab the server out of the forum</span> <span data-start="1688.48" data-end="1690.91">field and then we call here's the</span> <span data-start="1690.91" data-end="1693.1">connection connect function since we're</span> <span data-start="1693.1" data-end="1695.86">just making an anonymous connection we</span> <span data-start="1695.86" data-end="1697.179">don't need a password so that's why</span> <span data-start="1697.179" data-end="1699.7">that's null and it uses on connect event</span> <span data-start="1699.7" data-end="1703.15">for the callback on connect event is</span> <span data-start="1703.15" data-end="1707.23">right here and here it's very simple we</span> <span data-start="1707.23" data-end="1708.91">only handle two states connected and</span> <span data-start="1708.91" data-end="1711.1">disconnected and all and and</span> <span data-start="1711.1" data-end="1712.66">disconnected all we do is print out some</span> <span data-start="1712.66" data-end="1715.679">stuff and connected we add a handler for</span> <span data-start="1715.679" data-end="1718.679">this IQ result that we're looking for</span> <span data-start="1718.679" data-end="1721.54">and you can see here that I don't</span> <span data-start="1721.54" data-end="1723.64">actually say IQ anywhere because we know</span> <span data-start="1723.64" data-end="1725.89">it's going to come back with the ID so</span> <span data-start="1725.89" data-end="1727.66">all we really need to check for is the</span> </p>
<p><span data-start="1727.66" data-end="1729.7">ID and here you can see I'm looking for</span> <span data-start="1729.7" data-end="1731.83">the result so the error case is totally</span> <span data-start="1731.83" data-end="1733.75">not being handled you might have a</span> <span data-start="1733.75" data-end="1735.309">second handler for the error case to the</span> <span data-start="1735.309" data-end="1736.809">logic simpler or you might do them both</span> <span data-start="1736.809" data-end="1739.24">in the same handler I find it's usually</span> <span data-start="1739.24" data-end="1740.98">better to get as specific as possible</span> <span data-start="1740.98" data-end="1743.23">with the handlers and then I build the</span> <span data-start="1743.23" data-end="1747.85">IQ stanza and then I send it out and so</span> <span data-start="1747.85" data-end="1749.799">once the result comes back if an error</span> <span data-start="1749.799" data-end="1751.15">comes back nothing will happen if a</span> <span data-start="1751.15" data-end="1752.62">result comes back this on result</span> <span data-start="1752.62" data-end="1755.41">callback will get called which is right</span> <span data-start="1755.41" data-end="1757.059">here which is the longest function in</span> <span data-start="1757.059" data-end="1759.28">here and this basically just writes a</span> <span data-start="1759.28" data-end="1763.75">bunch of stuff to a special div here</span> <span data-start="1763.75" data-end="1765.73">where I'm using jQuery to parse out I'm</span> <span data-start="1765.73" data-end="1767.23">getting a Dom object back from the</span> <span data-start="1767.23" data-end="1769.929">handler of the IQ and jQuery makes it</span> <span data-start="1769.929" data-end="1771.52">really easy to chop this thing up and</span> <span data-start="1771.52" data-end="1774.04">rip stuff out of it so I grab all the</span> <span data-start="1774.04" data-end="1776.35">identity nodes which are one of the</span> <span data-start="1776.35" data-end="1777.669">things that returns in service discovery</span> </p>
<p><span data-start="1777.669" data-end="1779.71">I build this little table which has a</span> <span data-start="1779.71" data-end="1783.16">bunch of that stuff here I find all the</span> <span data-start="1783.16" data-end="1784.929">feature elements in that return that</span> <span data-start="1784.929" data-end="1787.38">result and I build a little list of</span> <span data-start="1787.38" data-end="1789.13">feature elements and</span> <span data-start="1789.13" data-end="1790.45">I call connection disconnect and we</span> <span data-start="1790.45" data-end="1798.49">disconnect which which we all saw does</span> <span data-start="1798.49" data-end="1808.14">anybody have any questions on that</span> <span data-start="1808.15" data-end="1810.5">yeah when you when you see their IQ</span> <span data-start="1810.5" data-end="1811.88">response this this function gets called</span> <span data-start="1811.88" data-end="1814.039">and and and it's really easy I mean all</span> </p>
<p><span data-start="1814.039" data-end="1815.72">I do is use jQuery to pick stuff out of</span> <span data-start="1815.72" data-end="1817.22">the Dom element that gets returned and</span> <span data-start="1817.22" data-end="1819.039">then I write a bunch of HTML there um</span> <span data-start="1819.039" data-end="1821.419">obviously if you are having like the the</span> <span data-start="1821.419" data-end="1822.89">chest park stuff has a lot of different</span> <span data-start="1822.89" data-end="1824.84">handlers for different cases so we have</span> <span data-start="1824.84" data-end="1826.4">handlers for women or private messages</span> <span data-start="1826.4" data-end="1828.32">receive from one a group chat messages</span> <span data-start="1828.32" data-end="1830.419">received for when game moves are sent</span> <span data-start="1830.419" data-end="1832.46">from when you send game moves and all</span> <span data-start="1832.46" data-end="1835.039">kinds of stuff like that so the and so</span> <span data-start="1835.039" data-end="1836.48">the handlers you'll have a bunch of them</span> <span data-start="1836.48" data-end="1839">and some of them will only use ones like</span> <span data-start="1839" data-end="1841.46">for instance this this IQ handler right</span> <span data-start="1841.46" data-end="1844.76">here we only use it once so here it</span> <span data-start="1844.76" data-end="1846.59">returns null which is a sort of</span> <span data-start="1846.59" data-end="1848.33">equivalent to false and this handler</span> <span data-start="1848.33" data-end="1851.179">will go away afterwards because we're</span> <span data-start="1851.179" data-end="1852.74">never going to get another IQ result</span> <span data-start="1852.74" data-end="1854.21">that matches this because it's going to</span> <span data-start="1854.21" data-end="1858.32">the new IQs have to have unique IDs so</span> <span data-start="1858.32" data-end="1867.5">they'll never be another one</span> <span data-start="1867.51" data-end="1872.53">so plugins one of the things about XMPP</span> <span data-start="1872.53" data-end="1874.96">it's very extensible you can write new</span> <span data-start="1874.96" data-end="1877.81">bits of stanzas and just stick them in</span> <span data-start="1877.81" data-end="1879.7">there so for instance at chess Park when</span> <span data-start="1879.7" data-end="1881.14">we want to chess moves in there we just</span> <span data-start="1881.14" data-end="1883.36">made a special namespace for for our</span> <span data-start="1883.36" data-end="1885.22">chess stanzas and then we put them in</span> <span data-start="1885.22" data-end="1888.64">messages there's a lot of extensions</span> <span data-start="1888.64" data-end="1890.89">defined already just to just to show you</span> <span data-start="1890.89" data-end="1893.53">guys the number here which hopefully</span> <span data-start="1893.53" data-end="1896.62">won't scare you you know that there's a</span> <span data-start="1896.62" data-end="1897.88">there's a couple hundred of these</span> <span data-start="1897.88" data-end="1900.45">extensions and for all kinds of things</span> <span data-start="1900.45" data-end="1903.73">some of these are used a lot like for</span> <span data-start="1903.73" data-end="1905.56">instance multi-user chat is one that's</span> <span data-start="1905.56" data-end="1907.24">use a lot service discovery is used a</span> <span data-start="1907.24" data-end="1908.53">lot and there's some that are almost</span> <span data-start="1908.53" data-end="1910.93">never used like soap over XMPP only a</span> <span data-start="1910.93" data-end="1913.48">few crazy people are using that but this</span> <span data-start="1913.48" data-end="1916.21">list keeps going so so for instance I</span> <span data-start="1916.21" data-end="1918.13">mean there's stuff in here like jingle</span> <span data-start="1918.13" data-end="1920.47">is is for multimedia conferencing with</span> <span data-start="1920.47" data-end="1923.89">sip one of the nice things about XMPP if</span> <span data-start="1923.89" data-end="1925.9">you have some crazy use case you don't</span> <span data-start="1925.9" data-end="1927.55">actually have to design all the protocol</span> <span data-start="1927.55" data-end="1929.05">you might have to write the code that</span> <span data-start="1929.05" data-end="1930.43">supports this protocol but you don't</span> <span data-start="1930.43" data-end="1931.84">have to think of all the edge cases that</span> <span data-start="1931.84" data-end="1933.58">can happen because there's a giant group</span> <span data-start="1933.58" data-end="1935.65">of people that sort of works these out</span> <span data-start="1935.65" data-end="1941.17">for you so in order to support all that</span> <span data-start="1941.17" data-end="1943.24">stuff like strophe is very simple you've</span> <span data-start="1943.24" data-end="1944.71">seen that it only has like half a dozen</span> <span data-start="1944.71" data-end="1946.69">functions and yet there's this whole</span> <span data-start="1946.69" data-end="1948.91">page full of extensions that that people</span> <span data-start="1948.91" data-end="1950.56">do so I wanted to have a way for people</span> <span data-start="1950.56" data-end="1952.78">to do plugins and the plugins would be</span> <span data-start="1952.78" data-end="1954.64">things like it would handle the soap</span> <span data-start="1954.64" data-end="1957.19">over XMPP stuff and it would just give</span> <span data-start="1957.19" data-end="1960.43">you a simple function to call to do that</span> <span data-start="1960.43" data-end="1962.41">like soaps and or with publish/subscribe</span> <span data-start="1962.41" data-end="1963.94">you would want to just do subscribe you</span> <span data-start="1963.94" data-end="1965.2">don't actually want to have to build the</span> </p>
<p><span data-start="1965.2" data-end="1966.73">IQ message that gets sent to the server</span> <span data-start="1966.73" data-end="1968.92">that does the subscription and handle</span> <span data-start="1968.92" data-end="1971.95">the error cases and so the plug-in</span> <span data-start="1971.95" data-end="1973.99">infrastructure just has two functions</span> <span data-start="1973.99" data-end="1977.11">you can add namespaces these are these</span> <span data-start="1977.11" data-end="1979.69">are as I said these are the things that</span> <span data-start="1979.69" data-end="1982.39">sort of define the extensions so each</span> <span data-start="1982.39" data-end="1984.01">extension has to have be name spaced</span> <span data-start="1984.01" data-end="1987.85">this is for instance the xtml XHTML IM</span> <span data-start="1987.85" data-end="1989.68">namespace and that's actually the full</span> <span data-start="1989.68" data-end="1992.44">namespace there so your plug-in can add</span> <span data-start="1992.44" data-end="1994.99">new namespaces that you can use so you</span> <span data-start="1994.99" data-end="1996.31">don't have to keep writing on and it has</span> </p>
<p><span data-start="1996.31" data-end="1998.35">ADD connection plug-in and you have the</span> <span data-start="1998.35" data-end="1999.7">name of the plug-in and you just</span> <span data-start="1999.7" data-end="2001.5">pass in an object and what will happen</span> <span data-start="2001.5" data-end="2003.649">is your connection object will get a new</span> <span data-start="2003.649" data-end="2006.99">attribute which is would be my plugin in</span> <span data-start="2006.99" data-end="2008.669">this case which will get initialized</span> <span data-start="2008.669" data-end="2010.59">whenever your connection is initialized</span> <span data-start="2010.59" data-end="2012.57">and so you can have all of your fancy</span> <span data-start="2012.57" data-end="2014.25">functions like subscribe and stuff in</span> <span data-start="2014.25" data-end="2018.2">this object and I wrote a little</span> <span data-start="2018.2" data-end="2020.46">identical who here is familiar with</span> <span data-start="2020.46" data-end="2024.45">identica so identica has an XMPP bot</span> <span data-start="2024.45" data-end="2025.769">that will send you micro blogging</span> <span data-start="2025.769" data-end="2027.389">messages just like Twitter used to have</span> <span data-start="2027.389" data-end="2029.49">and got rid of so I wrote a little</span> <span data-start="2029.49" data-end="2031.58">plug-in to show you guys that did</span> <span data-start="2031.58" data-end="2035.76">essentially is an identical client very</span> <span data-start="2035.76" data-end="2045.899">simple one and here I have two I'm going</span> <span data-start="2045.899" data-end="2047.7">to use my gmail credentials to login to</span> </p>
<p><span data-start="2047.7" data-end="2051.45">Gmail because that's where all my</span> <span data-start="2051.45" data-end="2054.06">identical messages go and you have to</span> <span data-start="2054.06" data-end="2055.44">forgive me because I'm typing my long</span> <span data-start="2055.44" data-end="2061.649">password with one hand here so we</span> <span data-start="2061.649" data-end="2063.24">connect and it'll take a second because</span> <span data-start="2063.24" data-end="2064.74">the wireless is a little slow here and</span> <span data-start="2064.74" data-end="2066.929">then it'll say it'll switch to waiting</span> <span data-start="2066.929" data-end="2068.909">for messages and then there's a handler</span> <span data-start="2068.909" data-end="2070.71">here and whenever an identical message</span> <span data-start="2070.71" data-end="2073.169">comes in it will add it to this list</span> <span data-start="2073.169" data-end="2076.74">here okay so we can look at the log file</span> <span data-start="2076.74" data-end="2079.319">and see what it's doing so we can see</span> <span data-start="2079.319" data-end="2080.22">that it's still going through the</span> <span data-start="2080.22" data-end="2081.389">connection stuff they are finally</span> <span data-start="2081.389" data-end="2084.03">connected and here's a bunch of stuff</span> <span data-start="2084.03" data-end="2086.04">that happens when you log in this is all</span> <span data-start="2086.04" data-end="2087.72">of the people in my roster sending me</span> <span data-start="2087.72" data-end="2091.29">their capabilities so that I can see if</span> <span data-start="2091.29" data-end="2092.76">they have music information they want to</span> <span data-start="2092.76" data-end="2094.29">share with me and stuff and so now it's</span> <span data-start="2094.29" data-end="2096.089">waiting for messages so now if I go to</span> <span data-start="2096.089" data-end="2103.89">identica and I type something</span> <span data-start="2103.9" data-end="2120.32">even this is slow</span> <span data-start="2120.33" data-end="2123.99">so in any case it will appear in there</span> <span data-start="2123.99" data-end="2125.55">you'll have to trust me I guess because</span> <span data-start="2125.55" data-end="2127.62">the Wi-Fi is not not behaving we can</span> <span data-start="2127.62" data-end="2129.18">also send messages from here like those</span> <span data-start="2129.18" data-end="2130.82">interaction events I talked about before</span> <span data-start="2130.82" data-end="2133.29">and we hit Send it'll actually build the</span> <span data-start="2133.29" data-end="2135.63">stanza and send it and of course it</span> <span data-start="2135.63" data-end="2137.34">since identicos apparently being really</span> <span data-start="2137.34" data-end="2138.78">slow right now it'll take a while to</span> <span data-start="2138.78" data-end="2141.57">show up and I can show you the code for</span> <span data-start="2141.57" data-end="2146.55">this oh there it is so it shows up there</span> <span data-start="2146.55" data-end="2148.92">and this is actually using XHTML I M so</span> <span data-start="2148.92" data-end="2150.75">this is actually a clickable link that</span> <span data-start="2150.75" data-end="2154.71">will go to my profile page and the code</span> <span data-start="2154.71" data-end="2157.23">for this is just barely more complicated</span> <span data-start="2157.23" data-end="2164.07">than the code I just showed you so we</span> <span data-start="2164.07" data-end="2167.31">have almost the same on the connect</span> <span data-start="2167.31" data-end="2169.56">function so when we call connect we set</span> <span data-start="2169.56" data-end="2171.15">up the connection in the same way except</span> <span data-start="2171.15" data-end="2172.65">now we have a full username and password</span> <span data-start="2172.65" data-end="2174.96">we call on connect event is the callback</span> <span data-start="2174.96" data-end="2178.14">when we connect we send initial presence</span> <span data-start="2178.14" data-end="2182.55">and then when we write that waiting for</span> <span data-start="2182.55" data-end="2188.28">messages thing and we have there's a</span> <span data-start="2188.28" data-end="2190.53">missing handler here that I accidentally</span> <span data-start="2190.53" data-end="2193.62">deleted so we there's a in this on</span> <span data-start="2193.62" data-end="2194.79">connect the first thing we would have to</span> <span data-start="2194.79" data-end="2196.32">do is set up the handler that handles</span> <span data-start="2196.32" data-end="2198.81">messages coming in and for some reason I</span> <span data-start="2198.81" data-end="2200.19">deleted that right before I walked up</span> <span data-start="2200.19" data-end="2204.03">here which is crazy but and then here's</span> <span data-start="2204.03" data-end="2205.98">the stuff that happens when when the</span> <span data-start="2205.98" data-end="2208.77">handler would have gotten called wait a</span> <span data-start="2208.77" data-end="2215.31">minute okay somehow I munched two</span> <span data-start="2215.31" data-end="2217.34">different files oh here it is down here</span> <span data-start="2217.34" data-end="2220.77">so here's the send so you can see us</span> <span data-start="2220.77" data-end="2221.91">building the message and we call</span> <span data-start="2221.91" data-end="2225.84">connection send and send it out I'm not</span> <span data-start="2225.84" data-end="2229.58">sure what happened to the to the handler</span> <span data-start="2229.58" data-end="2231.93">but essentially whenever the body comes</span> <span data-start="2231.93" data-end="2233.82">in all I did was find the div with</span> <span data-start="2233.82" data-end="2237.33">jQuery and and and extract the HTML I am</span> <span data-start="2237.33" data-end="2243.66">body and just throw it back in there</span> <span data-start="2243.67" data-end="2252.539">yep</span> <span data-start="2252.549" data-end="2256.069">so the authentication so you can do sass</span> <span data-start="2256.069" data-end="2257.96">little anonymous you can do digest md5</span> <span data-start="2257.96" data-end="2261.38">you can do text plane all those some</span> <span data-start="2261.38" data-end="2263.119">server supports ass'll external so you</span> <span data-start="2263.119" data-end="2264.14">can do things like Kerberos</span> <span data-start="2264.14" data-end="2266.059">authentication Google uses it for token</span> <span data-start="2266.059" data-end="2267.829">authentication with with their own</span> <span data-start="2267.829" data-end="2270.619">instant messaging stuff so pretty much</span> <span data-start="2270.619" data-end="2273.819">all the SAS whole stuff you can do there</span> <span data-start="2273.819" data-end="2276.619">now what's coming in the future I want</span> <span data-start="2276.619" data-end="2277.97">to do XPath matching with strophe</span> <span data-start="2277.97" data-end="2279.589">because the add handler thing has like</span> <span data-start="2279.589" data-end="2281.119">four or five parameters and they're</span> <span data-start="2281.119" data-end="2283.46">really restrictive and I want to just be</span> <span data-start="2283.46" data-end="2285.559">able to write XPath queries to be very</span> <span data-start="2285.559" data-end="2287.779">precise with what kind of stanzas I want</span> <span data-start="2287.779" data-end="2289.489">and this is what it'll look like when it</span> <span data-start="2289.489" data-end="2291.41">gets done so this would be the message</span> <span data-start="2291.41" data-end="2294.079">handler for you if you calm and type</span> <span data-start="2294.079" data-end="2297.229">equals chat so that's that's much better</span> <span data-start="2297.229" data-end="2300.079">because not only do you get to write</span> <span data-start="2300.079" data-end="2301.789">this very specific query but it's also</span> <span data-start="2301.789" data-end="2303.44">sort of error checking it as well right</span> <span data-start="2303.44" data-end="2305.539">so you can write a really specific query</span> <span data-start="2305.539" data-end="2307.099">and then random messages won't match</span> <span data-start="2307.099" data-end="2308.719">whereas with the handler code we have</span> <span data-start="2308.719" data-end="2310.4">now you have to sort of get all messages</span> <span data-start="2310.4" data-end="2314.539">from from of a particular type this is</span> <span data-start="2314.539" data-end="2316.039">actually taking me longer than I wanted</span> <span data-start="2316.039" data-end="2317.749">because none of the normal Dom XPath</span> <span data-start="2317.749" data-end="2320.21">stuff works on partial Dom elements that</span> <span data-start="2320.21" data-end="2323.45">don't already exist in a tree and then</span> <span data-start="2323.45" data-end="2325.88">there's the multi session problem that</span> <span data-start="2325.88" data-end="2329.39">some people are having in that uh if</span> <span data-start="2329.39" data-end="2331.219">you're if you're running an XMPP</span> <span data-start="2331.219" data-end="2332.9">connection in one tab and you open a new</span> <span data-start="2332.9" data-end="2335.66">tab now you have to XMPP connection and</span> <span data-start="2335.66" data-end="2337.43">you have to sort of keep them in sync so</span> <span data-start="2337.43" data-end="2339.799">we're working on extending bosh with the</span> <span data-start="2339.799" data-end="2341.809">thing for that so that all of the tabs</span> <span data-start="2341.809" data-end="2343.64">sort of have the same state without</span> <span data-start="2343.64" data-end="2347.809">doing any horrible hacks and the code is</span> <span data-start="2347.809" data-end="2349.67">available at code dot stands EECOM slash</span> </p>
<p><span data-start="2349.67" data-end="2352.67">Stroeve um the second link is my blog I</span> <span data-start="2352.67" data-end="2353.989">write about this stuff a lot there's</span> <span data-start="2353.989" data-end="2357.17">more tutorials there on various XMPP</span> <span data-start="2357.17" data-end="2359.539">topics and and things like that and my</span> <span data-start="2359.539" data-end="2360.799">email address if you need to get ahold</span> <span data-start="2360.799" data-end="2364.549">of me as jacket collector are there any</span> <span data-start="2364.549" data-end="2370.369">questions all this is true for the boss</span> <span data-start="2370.369" data-end="2371.74">you're</span> <span data-start="2371.74" data-end="2373.51">to Duke's level differences between</span> <span data-start="2373.51" data-end="2376.69">which you just covered it in comedy so</span> <span data-start="2376.69" data-end="2378.31">comment is only publish/subscribe</span> <span data-start="2378.31" data-end="2381.58">semantics so that they're very similar</span> <span data-start="2381.58" data-end="2383.11">in that they both allow you to a low</span> <span data-start="2383.11" data-end="2386.08">latency communication comment defines</span> <span data-start="2386.08" data-end="2388.27">the semantics of the communication as</span> <span data-start="2388.27" data-end="2391.06">subscribing to some path and then you</span> <span data-start="2391.06" data-end="2393.25">get events for that path that's possible</span> <span data-start="2393.25" data-end="2395.05">an XMPP through pub/sub and also</span> <span data-start="2395.05" data-end="2396.64">presence works like that but you can</span> <span data-start="2396.64" data-end="2398.89">also do many many other things in</span> <span data-start="2398.89" data-end="2401.44">extensions over X and P P so for</span> <span data-start="2401.44" data-end="2404.2">instance we can do io data we can do</span> <span data-start="2404.2" data-end="2406.39">file transfers we can do lots of the</span> <span data-start="2406.39" data-end="2408.25">stuff that's already baked into X and P</span> </p>
<p><span data-start="2408.25" data-end="2409.45">P because people have worked on these</span> <span data-start="2409.45" data-end="2411.16">extensions where as well comment you</span> <span data-start="2411.16" data-end="2412.6">would have to sort of make a new</span> <span data-start="2412.6" data-end="2414.22">protocol over the publish/subscribe</span> <span data-start="2414.22" data-end="2415.63">semantics to accomplish the same thing</span> <span data-start="2415.63" data-end="2417.1">so if you're if you're looking for</span> <span data-start="2417.1" data-end="2419.41">something really really simple and you</span> <span data-start="2419.41" data-end="2422.14">all you need is pub/sub then comment</span> <span data-start="2422.14" data-end="2425.5">works great I found that what happens is</span> <span data-start="2425.5" data-end="2426.61">people start with something really</span> <span data-start="2426.61" data-end="2428.35">really simple and then all of a sudden</span> <span data-start="2428.35" data-end="2430.15">they want file transfers and now they're</span> <span data-start="2430.15" data-end="2432.22">designing protocols and so it's easier</span> <span data-start="2432.22" data-end="2433.75">to start with this because you already</span> <span data-start="2433.75" data-end="2435.19">have all the protocols design because</span> <span data-start="2435.19" data-end="2437.05">that's the hard work implementing a</span> <span data-start="2437.05" data-end="2441.88">protocol is not too bad yeah so for</span> <span data-start="2441.88" data-end="2443.38">instance the Major League Baseball chat</span> <span data-start="2443.38" data-end="2445.21">which has millions of concurrent users</span> <span data-start="2445.21" data-end="2449.7">is backed by a Jeopardy XMPP server so</span> <span data-start="2449.7" data-end="2452.95">it scales pretty well yes it and and</span> <span data-start="2452.95" data-end="2454.869">just the other scaling of topic as</span> <span data-start="2454.869" data-end="2456.91">google talk has millions of concurrent</span> <span data-start="2456.91" data-end="2465.43">users as well and that's XMPP so so</span> </p>
<p><span data-start="2465.43" data-end="2467.23">Bosh's is essentially it's kind of like</span> <span data-start="2467.23" data-end="2469.72">a web proxy server except a web request</span> <span data-start="2469.72" data-end="2472.66">comes in it makes a TCP connection to an</span> <span data-start="2472.66" data-end="2475.03">XMPP server a two-way one and holds it</span> <span data-start="2475.03" data-end="2476.859">open and then does the long polling</span> <span data-start="2476.859" data-end="2479.41">translation between stanzas so for</span> <span data-start="2479.41" data-end="2482.77">instance like you can you can see what</span> <span data-start="2482.77" data-end="2485.47">this looks like in the log here so the</span> <span data-start="2485.47" data-end="2488.77">Boche wraps it in this body tag so</span> <span data-start="2488.77" data-end="2490.21">here's this body there's an empty body</span> <span data-start="2490.21" data-end="2492.73">tag but somebody find one so here's a</span> <span data-start="2492.73" data-end="2494.71">body tag with stuff in it right and this</span> <span data-start="2494.71" data-end="2496.84">body tag is just a simple wrapper so the</span> <span data-start="2496.84" data-end="2499.3">so the Boche server will get will get</span> <span data-start="2499.3" data-end="2502.9">this XML element it will strip off the</span> <span data-start="2502.9" data-end="2505.15">body out it takes the body tag checks to</span> <span data-start="2505.15" data-end="2505.52">make sure</span> <span data-start="2505.52" data-end="2507.2">that some of the security stuff matches</span> <span data-start="2507.2" data-end="2509.09">so you can't spoof the connections and</span> <span data-start="2509.09" data-end="2510.8">stuff and then the stuff that's inside</span> <span data-start="2510.8" data-end="2512.93">the body tag it forwards over the TCP</span> <span data-start="2512.93" data-end="2515.18">connection to the XMPP server and then</span> <span data-start="2515.18" data-end="2516.68">when stuff comes back it just sends it</span> <span data-start="2516.68" data-end="2519.02">to you when it has waiting requests to</span> <span data-start="2519.02" data-end="2526.7">fulfill so it's just you can do any of</span> <span data-start="2526.7" data-end="2528.5">those things so because of the same</span> <span data-start="2528.5" data-end="2530.18">domain policy you usually have to</span> <span data-start="2530.18" data-end="2532.73">reverse proxy a Bosch connection manager</span> <span data-start="2532.73" data-end="2534.56">under the URL where you're serving index</span> <span data-start="2534.56" data-end="2536.45">dot HTML or wherever your app lives and</span> <span data-start="2536.45" data-end="2539.18">with something like flensed you can do</span> <span data-start="2539.18" data-end="2542.6">cross domain by using the same XML HTTP</span> <span data-start="2542.6" data-end="2544.64">request API but using Flash's cross</span> <span data-start="2544.64" data-end="2549.05">domain stuff and there are so far for</span> <span data-start="2549.05" data-end="2550.52">our applications we run our own Bosch</span> <span data-start="2550.52" data-end="2552.53">servers we proxy them under the an</span> <span data-start="2552.53" data-end="2555.02">engine X and which serves static content</span> <span data-start="2555.02" data-end="2560.18">and we do that that way the comment</span> <span data-start="2560.18" data-end="2562.46">requires the same thing you have a comet</span> <span data-start="2562.46" data-end="2565.13">comet D running that is equivalent to</span> <span data-start="2565.13" data-end="2566.81">sort of the Boche connection manager it</span> <span data-start="2566.81" data-end="2569.84">translates your incoming stuff into more</span> <span data-start="2569.84" data-end="2577.31">stateful stuff on the server side yes</span> <span data-start="2577.31" data-end="2578.9">that's a great question</span> <span data-start="2578.9" data-end="2581.72">so locally you don't have to have an</span> </p>
<p><span data-start="2581.72" data-end="2583.97">XMPP server locally because because the</span> <span data-start="2583.97" data-end="2586.25">connection manager if you run one that's</span> <span data-start="2586.25" data-end="2587.99">not built into an XMPP server can</span> <span data-start="2587.99" data-end="2589.82">connect to any XMPP server you saw me I</span> <span data-start="2589.82" data-end="2591.95">just connected to Gmail for instance so</span> <span data-start="2591.95" data-end="2593.24">I have a connection manager running on</span> <span data-start="2593.24" data-end="2594.86">this local machine and what I do for</span> <span data-start="2594.86" data-end="2596.57">local development is I wrote a simple</span> <span data-start="2596.57" data-end="2599.09">utility that will serve the current</span> <span data-start="2599.09" data-end="2602.27">directory over HTTP but also keep</span> <span data-start="2602.27" data-end="2604.28">reverse proxy configurations and I have</span> <span data-start="2604.28" data-end="2606.56">a little text file in there that has a</span> <span data-start="2606.56" data-end="2608.03">little configuration for where the</span> <span data-start="2608.03" data-end="2610.04">reverse proxies are which reverse proxy</span> <span data-start="2610.04" data-end="2611.78">is the bossy so I just type tape in a</span> <span data-start="2611.78" data-end="2614.54">directory and it sets up a local HTTP</span> <span data-start="2614.54" data-end="2617.48">server just that I short-lived that</span> <span data-start="2617.48" data-end="2619.34">serves the directory handles the Boche</span> <span data-start="2619.34" data-end="2620.48">stuff and that's how I do local</span> <span data-start="2620.48" data-end="2622.31">development and we deploy it there's</span> <span data-start="2622.31" data-end="2624.08">usually an engine ax thing reverse</span> <span data-start="2624.08" data-end="2626">proxying the Boche server and serving</span> <span data-start="2626" data-end="2628.01">static files or in the case of chess</span> <span data-start="2628.01" data-end="2630.44">park there's a django app just wash</span> <span data-start="2630.44" data-end="2632.569">server</span> <span data-start="2632.569" data-end="2635.749">on the Bosch server I use and the guy on</span> <span data-start="2635.749" data-end="2637.549">my team wrote is called Punjab and you</span> <span data-start="2637.549" data-end="2639.829">can find it it yeah yeah so code dot</span> </p>
<p><span data-start="2639.829" data-end="2642.109">Sanjay Khan flash strophe is the is this</span> <span data-start="2642.109" data-end="2644.449">library but slash Punjab is our Bosch</span> <span data-start="2644.449" data-end="2646.789">server and the speak site which I showed</span> <span data-start="2646.789" data-end="2648.499">you guys is also open source and that's</span> <span data-start="2648.499" data-end="2653.569">available at the same site huh you</span> <span data-start="2653.569" data-end="2657.319">should've bought this game had a grenade</span> <span data-start="2657.319" data-end="2660.049">and have synchronous that mean that the</span> <span data-start="2660.049" data-end="2663.739">behavior is called is literally no no</span> <span data-start="2663.739" data-end="2665.689">that it's still an asynchronous Ajax</span> <span data-start="2665.689" data-end="2668.569">call I'm sure they put synchronous in</span> <span data-start="2668.569" data-end="2670.4">there because it made the acronym nice</span> <span data-start="2670.4" data-end="2673.369">sounding and but but it is synchronous</span> <span data-start="2673.369" data-end="2674.869">in a way that your the long polling is</span> <span data-start="2674.869" data-end="2675.89">synchronous right you're leaving a</span> <span data-start="2675.89" data-end="2677.209">connection out there on the server and</span> <span data-start="2677.209" data-end="2678.589">you're waiting for a response to come</span> <span data-start="2678.589" data-end="2681.739">back but but that that's wrapped up for</span> <span data-start="2681.739" data-end="2683.599">you in Stroeve so strophe presents you a</span> <span data-start="2683.599" data-end="2685.819">completely asynchronous API you define</span> <span data-start="2685.819" data-end="2687.799">event handlers stanzas come in and match</span> <span data-start="2687.799" data-end="2691.599">and then they trigger events yes Pierre</span> </p>
<p><span data-start="2691.599" data-end="2694.759">Bossier shows yes most of the jabber</span> <span data-start="2694.759" data-end="2696.829">servers include their own Bosh servers</span> <span data-start="2696.829" data-end="2700.009">the difference is there's a good side</span> <span data-start="2700.009" data-end="2702.259">and a bad side to that the good sizes is</span> <span data-start="2702.259" data-end="2704.869">you have no serialization overhead the</span> <span data-start="2704.869" data-end="2707.419">xml comes in it gets serialized for the</span> <span data-start="2707.419" data-end="2708.979">server and it goes all through the</span> <span data-start="2708.979" data-end="2711.349">server and it only gets to realize when</span> <span data-start="2711.349" data-end="2713.119">it comes back out to you with a normal</span> <span data-start="2713.119" data-end="2715.009">box server you serialize it to the boss</span> </p>
<p><span data-start="2715.009" data-end="2717.529">Bosh connection it realizes it to the</span> <span data-start="2717.529" data-end="2719.329">TCP connection to go to the server and</span> <span data-start="2719.329" data-end="2721.099">so there's an extra serialization step</span> <span data-start="2721.099" data-end="2723.439">what you lose is you can't connect to</span> <span data-start="2723.439" data-end="2725.869">arbitrary X and P P servers so if I used</span> <span data-start="2725.869" data-end="2728.029">I can switch it to the into my eg</span> <span data-start="2728.029" data-end="2729.859">Birdy's Bosh server here by just</span> <span data-start="2729.859" data-end="2732.559">switching the URL but what but I'll only</span> <span data-start="2732.559" data-end="2734.839">be able to connect locally to that eg</span> <span data-start="2734.839" data-end="2736.249">Bertie server I won't be able to make a</span> <span data-start="2736.249" data-end="2739.699">connection to Gmail for instance and it</span> <span data-start="2739.699" data-end="2741.109">depends on the application which of</span> <span data-start="2741.109" data-end="2743.659">these is right for you if you if you</span> <span data-start="2743.659" data-end="2745.459">want to support the federated network of</span> </p>
<p><span data-start="2745.459" data-end="2747.439">XMPP users so for instance on the speak</span> <span data-start="2747.439" data-end="2749.39">site this is a requirement because we</span> <span data-start="2749.39" data-end="2750.589">want people to be able to log in with</span> <span data-start="2750.589" data-end="2753.319">their Gmail credentials and access their</span> <span data-start="2753.319" data-end="2755.089">own Google Talk stuff we don't need want</span> <span data-start="2755.089" data-end="2756.65">you to have to have a speak comm account</span> <span data-start="2756.65" data-end="2759.319">but for other services I drop a oh and</span> </p>
<p><span data-start="2759.319" data-end="2761.209">Yammer and stuff they use anonymous</span> <span data-start="2761.209" data-end="2763.609">connections and they just and they do</span> <span data-start="2763.609" data-end="2765.47">the authentication at a lower layer</span> <span data-start="2765.47" data-end="2770.569">or a higher layer I guess yes</span> <span data-start="2770.569" data-end="2771.95">last question back in the picture</span> <span data-start="2771.95" data-end="2774.14">everything silk is asynchronous</span> <span data-start="2774.14" data-end="2777.23">are you getting partial responses back</span> <span data-start="2777.23" data-end="2780.14">from the screen what is every stanza it</span> <span data-start="2780.14" data-end="2783.2">someone for us you can send multiple</span> <span data-start="2783.2" data-end="2784.76">stanzas but you'll never get a partial</span> <span data-start="2784.76" data-end="2787.369">stanza the Bosch connection manager will</span> <span data-start="2787.369" data-end="2790.25">only ever send you a complete stanza and</span> <span data-start="2790.25" data-end="2792.5">and you can only send complete stanzas</span> <span data-start="2792.5" data-end="2793.73">but you can send as many as you want</span> <span data-start="2793.73" data-end="2796.76">there's also some neat functions inside</span> </p>
<p><span data-start="2796.76" data-end="2798.319">Stroeve if you know you're going to be</span> <span data-start="2798.319" data-end="2801.2">sending just a bunch of data from say a</span> <span data-start="2801.2" data-end="2803.06">bunch of different pieces of code for</span> <span data-start="2803.06" data-end="2805.01">instance that connections start up which</span> <span data-start="2805.01" data-end="2806.63">is pretty common you can tell it to</span> <span data-start="2806.63" data-end="2808.7">pause it will queue up all of that stuff</span> <span data-start="2808.7" data-end="2810.38">and then when you hit start it will send</span> <span data-start="2810.38" data-end="2812.48">it all in one request so you can sort of</span> <span data-start="2812.48" data-end="2818.16">bootstrap the initialization stuff yes</span> <span data-start="2818.17" data-end="2822.26">so you could the thing that XML really</span> <span data-start="2822.26" data-end="2825.13">buys you here is that there's no way to</span> <span data-start="2825.13" data-end="2830.93">extend a JSON array so say you have say</span> <span data-start="2830.93" data-end="2833.78">that this was all Jason and I had a</span> <span data-start="2833.78" data-end="2836.089">message stanza and the two is a string</span> <span data-start="2836.089" data-end="2841.819">the in XML I can extend attributes by</span> <span data-start="2841.819" data-end="2844.21">name spacing them and I can extend any</span> <span data-start="2844.21" data-end="2849.47">any tag by putting a child in it and</span> <span data-start="2849.47" data-end="2851.42">name spacing that but you can only do</span> <span data-start="2851.42" data-end="2853.28">that in parts of JSON so you would have</span> <span data-start="2853.28" data-end="2855.319">to have sort of a complicated extensible</span> </p>
<p><span data-start="2855.319" data-end="2858.5">JSON format that you would use so you</span> <span data-start="2858.5" data-end="2859.849">would lose some of the simplicity I</span> <span data-start="2859.849" data-end="2861.64">think of JSON if you went that way</span> <span data-start="2861.64" data-end="2863.869">because it's really nice to be able to</span> <span data-start="2863.869" data-end="2865.339">send those messages that are bodies</span> <span data-start="2865.339" data-end="2867.619">that's standardized write the body tag</span> <span data-start="2867.619" data-end="2869.39">is not namespaced but when I send a</span> <span data-start="2869.39" data-end="2872.329">chess move for instance it'll be you</span> <span data-start="2872.329" data-end="2875.03">know move and they'll have xmlns just</span> </p>
<p><span data-start="2875.03" data-end="2876.859">Park / move or something like that and</span> <span data-start="2876.859" data-end="2878.599">then I can put whatever I want in there</span> <span data-start="2878.599" data-end="2880.369">and the nice thing is the server's if</span> <span data-start="2880.369" data-end="2881.78">they don't understand what the data is</span> <span data-start="2881.78" data-end="2883.579">they just won't look at it and they'll</span> <span data-start="2883.579" data-end="2886.099">pass it all the way to the clients so</span> <span data-start="2886.099" data-end="2888.17">with so with JSON you would have to sort</span> <span data-start="2888.17" data-end="2890.839">of I'm not sure how you would extend</span> <span data-start="2890.839" data-end="2893.78">JSON in the same way unless you decided</span> <span data-start="2893.78" data-end="2901.06">to use all objects and no little</span> <span data-start="2901.07" data-end="2906.45">any other questions okay thank you very</span> <span data-start="2906.45" data-end="2916.3">much</span> </p>
</section>