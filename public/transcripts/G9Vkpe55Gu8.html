<section>
<p><span data-start="0.18" data-end="14.23">[Music]</span> <span data-start="14.24" data-end="18.48">so my not process don't fire yes this</span> <span data-start="18.48" data-end="20.07">talk is about what to do when your note</span> <span data-start="20.07" data-end="22.73">application is it's not behaving okay</span> </p>
<p><span data-start="22.73" data-end="25.619">I'm not talking about literally burning</span> <span data-start="25.619" data-end="28.289">IOT devices no I've done that doing that</span> <span data-start="28.289" data-end="32.07">I'm not doing that anymore stay so I</span> <span data-start="32.07" data-end="34.17">don't know how many of you I mean how</span> <span data-start="34.17" data-end="36.18">much I don't know how many times</span> <span data-start="36.18" data-end="38.55">happened to all of you to be woken up by</span> <span data-start="38.55" data-end="42.27">an alarm on Sunday morning because your</span> <span data-start="42.27" data-end="43.77">application you spend so much time</span> <span data-start="43.77" data-end="45.93">developing was not behaving correctly</span> <span data-start="45.93" data-end="49.5">and user were disappointed so while it</span> <span data-start="49.5" data-end="52.949">happened to me several times in fact so</span> <span data-start="52.949" data-end="55.23">what you do well typically you login</span> <span data-start="55.23" data-end="58.53">into your cloud servers cloud provider</span> <span data-start="58.53" data-end="60.42">accounts whatever look at what's going</span> <span data-start="60.42" data-end="62.94">on and you know you have a bunch number</span> <span data-start="62.94" data-end="64.799">maximum number of servers in your auto</span> <span data-start="64.799" data-end="66.36">scaling group which you should use all</span> <span data-start="66.36" data-end="70.32">the time and applications still not</span> <span data-start="70.32" data-end="73.26">behaving so you log in ESS H in the Box</span> </p>
<p><span data-start="73.26" data-end="75.38">I don't know you tweak some stuff and</span> <span data-start="75.38" data-end="77.97">after a while everything gets back to</span> <span data-start="77.97" data-end="81.689">normal and you need a hotfix as as we</span> <span data-start="81.689" data-end="85.979">call it now this type of performance</span> <span data-start="85.979" data-end="88.56">problem are are very important to solve</span> <span data-start="88.56" data-end="91.32">and to prevent so whenever you have you</span> <span data-start="91.32" data-end="93.03">have a performance issue or a production</span> <span data-start="93.03" data-end="95.25">issue you should really do run a</span> <span data-start="95.25" data-end="98.939">post-mortem so after the morning on</span> </p>
<p><span data-start="98.939" data-end="100.97">Monday morning you come back to work and</span> <span data-start="100.97" data-end="105.81">you you check oh well what happened okay</span> <span data-start="105.81" data-end="107.67">and this is the question you ask what</span> <span data-start="107.67" data-end="110.52">happen but more importantly you should</span> <span data-start="110.52" data-end="113.369">check you should ask yourself how to fix</span> <span data-start="113.369" data-end="115.5">this so this is the road to fix things</span> <span data-start="115.5" data-end="117.57">in production is first of all gather</span> <span data-start="117.57" data-end="121.439">Diagnostics data and evidence so again</span> <span data-start="121.439" data-end="123.479">if you have set up some some logging</span> <span data-start="123.479" data-end="127.56">infrastructure some monitoring cloud</span> <span data-start="127.56" data-end="129.3">watch one of those whatever you want to</span> <span data-start="129.3" data-end="131.459">use a lot of services in there at the</span> <span data-start="131.459" data-end="132.78">APM area</span> <span data-start="132.78" data-end="135">and with this diagnostic you need to be</span> <span data-start="135" data-end="138.29">able to reproduce the problem in a</span> <span data-start="138.29" data-end="140.7">non-production live environment so you</span> <span data-start="140.7" data-end="142.47">can really produce the problem yes and</span> <span data-start="142.47" data-end="144.27">after you can reproduce it as it is</span> <span data-start="144.27" data-end="146.37">still on a cloud environment and after</span> <span data-start="146.37" data-end="148.44">you are able to do that then you can try</span> <span data-start="148.44" data-end="150.09">and reproduce in the problem on you on</span> <span data-start="150.09" data-end="151.47">your box now where pollution is the</span> <span data-start="151.47" data-end="153.06">problem on your box is important because</span> <span data-start="153.06" data-end="154.86">it means it's very easy then to work on</span> <span data-start="154.86" data-end="158.31">this stuff on there and gather some more</span> <span data-start="158.31" data-end="159.989">diagnostic and evidence the type of</span> <span data-start="159.989" data-end="161.73">diagnostics and evidence you can gather</span> <span data-start="161.73" data-end="164.25">from your box are way more detailed than</span> <span data-start="164.25" data-end="166.26">what you can get on the cloud because</span> <span data-start="166.26" data-end="167.88">you are not limited by the hover head of</span> <span data-start="167.88" data-end="171.019">fire off of the tools you want to use so</span> <span data-start="171.019" data-end="173.73">then you try to fix the problem several</span> <span data-start="173.73" data-end="177.35">times several times several times and</span> <span data-start="177.35" data-end="179.73">you if it's not fixed and you go back</span> <span data-start="179.73" data-end="184.23">and you try again and more Diagnostics</span> <span data-start="184.23" data-end="187.489">fix it whatever so how do we fix things</span> <span data-start="187.489" data-end="190.739">the most important bit it's establishing</span> <span data-start="190.739" data-end="192.75">a measurable goal and I will get back to</span> <span data-start="192.75" data-end="196.86">this later on and then you measure so</span> <span data-start="196.86" data-end="199.5">how you get good measurements and then</span> <span data-start="199.5" data-end="200.79">we find what we call the bottleneck</span> <span data-start="200.79" data-end="202.26">which is what is lowing down your</span> <span data-start="202.26" data-end="204.209">application and then we fix the</span> <span data-start="204.209" data-end="206.579">bottleneck we remove that bottleneck and</span> <span data-start="206.579" data-end="208.44">ideally that will show another</span> <span data-start="208.44" data-end="212.13">bottleneck and and so on and we measure</span> <span data-start="212.13" data-end="215.31">again and if it's not fixed we go back</span> <span data-start="215.31" data-end="219.57">and find a new bottleneck optimize</span> <span data-start="219.57" data-end="222.39">measure all over again up until our</span> <span data-start="222.39" data-end="224.76">measurable goal is solved now how do we</span> <span data-start="224.76" data-end="226.739">establish a measurable goal well</span> <span data-start="226.739" data-end="228.78">typically you can talk to your boss and</span> <span data-start="228.78" data-end="230.87">get something like this from him</span> <span data-start="230.87" data-end="234.06">whatever this means what's something</span> <span data-start="234.06" data-end="235.829">that's valuable for your application</span> <span data-start="235.829" data-end="237.75">okay how many concurrent user per</span> <span data-start="237.75" data-end="239.13">servers you want to achieve you want to</span> <span data-start="239.13" data-end="241.14">reach what's the maximum latency you</span> <span data-start="241.14" data-end="244.23">need to have those are very important</span> <span data-start="244.23" data-end="246.359">numbers whatever it is this is very</span> <span data-start="246.359" data-end="249.48">generic things that you can pick take</span> <span data-start="249.48" data-end="251.97">and use it okay but every application</span> <span data-start="251.97" data-end="255.239">has its own business requirements when</span> <span data-start="255.239" data-end="257.13">developing nodejs application you need</span> <span data-start="257.13" data-end="258.539">to remember that latency and throughput</span> <span data-start="258.539" data-end="262.109">are connected to each other and because</span> <span data-start="262.109" data-end="265.32">node is single threaded however</span> <span data-start="265.32" data-end="267.78">and this means that multiple ru action</span> <span data-start="267.78" data-end="269.28">running parallel but one single</span> </p>
<p><span data-start="269.28" data-end="273.09">JavaScript function it can execute and</span> <span data-start="273.09" data-end="274.86">when multiple are you are in parallel</span> <span data-start="274.86" data-end="276.21">like for example multiple database</span> <span data-start="276.21" data-end="278.67">connections you know you have an</span> <span data-start="278.67" data-end="281.52">increased concurrency and if the latency</span> <span data-start="281.52" data-end="284.52">of those u action gets higher because</span> <span data-start="284.52" data-end="286.11">you might have a database problem for</span> <span data-start="286.11" data-end="288.87">example you having typically the</span> <span data-start="288.87" data-end="291.3">concurrency increases but that when that</span> <span data-start="291.3" data-end="295.56">happened memory usage spikes and when</span> <span data-start="295.56" data-end="297.99">memory uses spikes this increased the</span> <span data-start="297.99" data-end="300.63">garbage collection activity so when all</span> <span data-start="300.63" data-end="303.45">of these are connected it means that the</span> <span data-start="303.45" data-end="304.83">garbage collection activity impact your</span> </p>
<p><span data-start="304.83" data-end="307.17">CPU cycles and the execution of your</span> <span data-start="307.17" data-end="309.12">JavaScript functions so all of these</span> <span data-start="309.12" data-end="311.88">things are all interconnected 2000 imita</span> <span data-start="311.88" data-end="314.31">resources that your CPU has your your</span> <span data-start="314.31" data-end="319.53">processes so in order to establish a</span> <span data-start="319.53" data-end="321.75">good measure we can use this to call out</span> <span data-start="321.75" data-end="324.87">to cannon is an HTTP load tester runs on</span> <span data-start="324.87" data-end="326.58">Mac Windows Linux very trivial</span> <span data-start="326.58" data-end="328.38">installation you don't have to compile</span> <span data-start="328.38" data-end="330.09">anything it just comes out it you have</span> <span data-start="330.09" data-end="331.92">it will compile something but we are</span> <span data-start="331.92" data-end="333.69">getting rid of that Italy sooner rather</span> <span data-start="333.69" data-end="336.48">than later how do you use it you start</span> <span data-start="336.48" data-end="338.13">your node server then you start out ok</span> <span data-start="338.13" data-end="339.6">now specifying the number of connections</span> <span data-start="339.6" data-end="341.58">the duration some other parameters and</span> <span data-start="341.58" data-end="343.71">it gets you some statistics including</span> <span data-start="343.71" data-end="346.92">the latency so how do we find the</span> <span data-start="346.92" data-end="350.16">bottleneck well you need to gather some</span> <span data-start="350.16" data-end="350.97">more Diagnostics</span> <span data-start="350.97" data-end="352.71">now we have a Mac we have measure we</span> <span data-start="352.71" data-end="355.32">know our standard goal we can compute a</span> <span data-start="355.32" data-end="357.87">gap between the two and we need to</span> <span data-start="357.87" data-end="360.06">gather some more some more Diagnostics</span> <span data-start="360.06" data-end="361.98">we can use this new tool that we have</span> <span data-start="361.98" data-end="363.87">just released called node clinic</span> <span data-start="363.87" data-end="365.76">you can NPM install clinic if you want</span> <span data-start="365.76" data-end="369.63">to and what you need this tool has two</span> <span data-start="369.63" data-end="371.55">comments inside one is called dr. and</span> <span data-start="371.55" data-end="372.84">one is called flame and then we show</span> <span data-start="372.84" data-end="373.59">them in a moment</span> <span data-start="373.59" data-end="376.14">the first one is doctor it's nice logo I</span> <span data-start="376.14" data-end="377.4">don't know if you like it but I hope so</span> <span data-start="377.4" data-end="381.45">a friendly doctor and you can literally</span> <span data-start="381.45" data-end="382.32">type</span> <span data-start="382.32" data-end="384.9">clinic doctor note server these stalls a</span> <span data-start="384.9" data-end="387.03">bunch of things probes ensure your not</span> <span data-start="387.03" data-end="389.82">server into your server and it can</span> <span data-start="389.82" data-end="391.65">generate some some useful statistics out</span> <span data-start="391.65" data-end="394.47">of it let's do that so here it is</span> </p>
<p><span data-start="394.47" data-end="397.919">OOP this went up can use OPI hopefully</span> <span data-start="397.919" data-end="399.15">you can see this okay</span> <span data-start="399.15" data-end="404.01">so what you do you do clinic doctor — -</span> <span data-start="404.01" data-end="407.49">no demons is my demo code so as you see</span> <span data-start="407.49" data-end="411.72">is spinning up the it's using its using</span> <span data-start="411.72" data-end="414.389">trace events to gather together some</span> <span data-start="414.389" data-end="416.1">most advanced statistics this is still</span> <span data-start="416.1" data-end="418.949">an experimental feature in no date so we</span> <span data-start="418.949" data-end="421.62">run the stuff and after turn with</span> <span data-start="421.62" data-end="422.94">control C on the server</span> <span data-start="422.94" data-end="425.82">and you generate this type of diagram so</span> <span data-start="425.82" data-end="427.199">in this diagram it can tell you some</span> <span data-start="427.199" data-end="429.3">some very nice things for example you</span> <span data-start="429.3" data-end="430.71">can tell you that we have detected the</span> <span data-start="430.71" data-end="433.02">potential event loop issue and how we</span> <span data-start="433.02" data-end="434.58">can do that well you can see here that</span> <span data-start="434.58" data-end="437.699">you can that this process the event loop</span> <span data-start="437.699" data-end="440.46">delay it keeps growing okay up to almost</span> <span data-start="440.46" data-end="441.09">three seconds</span> <span data-start="441.09" data-end="442.949">well it's buggy okay it's a demo of some</span> <span data-start="442.949" data-end="445.71">code you should never write and we can</span> <span data-start="445.71" data-end="448.41">also track a memory usage but the very</span> <span data-start="448.41" data-end="450.3">nice thing about this tool it's it has a</span> <span data-start="450.3" data-end="452.1">recommendation panel which it tells you</span> <span data-start="452.1" data-end="453.3">what to do when you have this type of</span> <span data-start="453.3" data-end="456.18">issues so in this thing you can press</span> <span data-start="456.18" data-end="458.729">ample implement HTTP 503 event loop</span> <span data-start="458.729" data-end="460.919">protection it's a very important thing</span> <span data-start="460.919" data-end="462.3">you should have in your application but</span> <span data-start="462.3" data-end="463.59">you can also recommend you to use a tool</span> <span data-start="463.59" data-end="466.169">called clinic flame to discover the CPU</span> <span data-start="466.169" data-end="468.9">intensive functions and there's a lot of</span> <span data-start="468.9" data-end="470.55">explanation of all of this so stuff to</span> <span data-start="470.55" data-end="472.74">follow we also have brought other</span> <span data-start="472.74" data-end="475.26">undetected issues so you can also read</span> <span data-start="475.26" data-end="477.18">the guide for example on how to solve</span> <span data-start="477.18" data-end="479.039">your problems or garbage collection</span> <span data-start="479.039" data-end="480.93">problems which are not memory leaks are</span> <span data-start="480.93" data-end="482.16">more problems where the garbage</span> <span data-start="482.16" data-end="483.599">collection is interacting with your</span> <span data-start="483.599" data-end="488.63">application in and not so nice way so</span> <span data-start="488.63" data-end="491.46">this is it this was my fault back then</span> <span data-start="491.46" data-end="493.05">the other tool is called clinic flame</span> <span data-start="493.05" data-end="495.15">and this is based on another thing</span> <span data-start="495.15" data-end="496.38">called zero acts it's using it</span> <span data-start="496.38" data-end="497.88">internally that we've developed before</span> <span data-start="497.88" data-end="501.15">and how to use it again similar pattern</span> <span data-start="501.15" data-end="504.389">clinic flame — - note server so what we</span> <span data-start="504.389" data-end="508.199">do is we run it this way clinic flame -</span> <span data-start="508.199" data-end="512.729">- no demo and this requires your root</span> <span data-start="512.729" data-end="514.38">password because it needs to use some</span> <span data-start="514.38" data-end="517.14">low level</span> </p>
<p><span data-start="517.14" data-end="519.589">Institute to use some low level</span> <span data-start="519.589" data-end="523.229">diagnostic tools called D traced on mac</span> <span data-start="523.229" data-end="526.95">and prof on linux okay now we have run</span> <span data-start="526.95" data-end="530.04">this then we eat ctrl C and all of these</span> <span data-start="530.04" data-end="532.08">crunching stuff of course takes</span> <span data-start="532.08" data-end="534.24">time all of these arguments are very</span> <span data-start="534.24" data-end="537">complicated now let me zoom in because</span> <span data-start="537" data-end="539.58">of course what you can see it generates</span> <span data-start="539.58" data-end="541.77">this type of diagram where this a very</span> <span data-start="541.77" data-end="544.56">odd function called sleep now I hope all</span> <span data-start="544.56" data-end="546.39">of you guess what the type of code that</span> <span data-start="546.39" data-end="548.49">I have written for this demo which is</span> <span data-start="548.49" data-end="551.13">very simple which is this thing it has a</span> <span data-start="551.13" data-end="553.65">slip function that just actively wait</span> <span data-start="553.65" data-end="556.02">for something to happen very trivial</span> <span data-start="556.02" data-end="557.49">okay you should never write this type of</span> <span data-start="557.49" data-end="559.7">simple function in your code base okay</span> <span data-start="559.7" data-end="562.77">but you can detect some very complicated</span> <span data-start="562.77" data-end="567.42">code in there as well for example so I</span> <span data-start="567.42" data-end="569.28">want to go through I want to just say</span> <span data-start="569.28" data-end="573.98">that tomorrow and then I am I'm doing a</span> <span data-start="573.98" data-end="577.77">performance worship with my colleague</span> </p>
<p><span data-start="577.77" data-end="582.84">Josh and in which we will get lost in</span> <span data-start="582.84" data-end="586.29">the rabbit hole of performance so in</span> <span data-start="586.29" data-end="589.71">this in this workshop we will go through</span> <span data-start="589.71" data-end="591.15">how to diagnose a performance problem</span> <span data-start="591.15" data-end="593.99">using clinic but also using other things</span> <span data-start="593.99" data-end="595.98">for example how to use the node</span> <span data-start="595.98" data-end="599.37">inspector and other stuff like that we</span> <span data-start="599.37" data-end="601.41">will also use frame graphs to know where</span> <span data-start="601.41" data-end="603.3">is the problem okay as I showed there</span> <span data-start="603.3" data-end="606.75">that was very simple and trivial but the</span> <span data-start="606.75" data-end="608.64">probe what we will see what we'll see</span> <span data-start="608.64" data-end="609.06">tomorrow</span> <span data-start="609.06" data-end="610.77">it's way more complicated and way more</span> <span data-start="610.77" data-end="615.66">deep and then we will dig deep into v8</span> <span data-start="615.66" data-end="619.65">flags to understand what is happening if</span> <span data-start="619.65" data-end="622.71">you'd go into we have been talked with</span> <span data-start="622.71" data-end="625.71">fluckey before that there is a thing</span> <span data-start="625.71" data-end="628.8">called inlining okay and we will dig</span> <span data-start="628.8" data-end="630.69">deep into the wall optimization cycle</span> <span data-start="630.69" data-end="632.25">and the optimization and the</span> <span data-start="632.25" data-end="635.06">optimization cycle art of v8 and</span> <span data-start="635.06" data-end="639.3">turbofan and and we what we use to do</span> <span data-start="639.3" data-end="642.63">this is as low is this low rest API so</span> <span data-start="642.63" data-end="645.51">as low what we mean is I provide you a</span> <span data-start="645.51" data-end="650.43">nice application and you can do that you</span> <span data-start="650.43" data-end="652.74">should so this wall talk was about</span> <span data-start="652.74" data-end="654.66">performance optimization but I want to</span> <span data-start="654.66" data-end="657.84">spend 30 seconds saying that you don't</span> <span data-start="657.84" data-end="661.2">need to over optimize your code so the</span> <span data-start="661.2" data-end="663.18">important part about optimizing ojs</span> <span data-start="663.18" data-end="666.29">applications is only about</span> <span data-start="666.29" data-end="670.679">doing this when it's needed okay and and</span> <span data-start="670.679" data-end="674.009">to meet your business goals so over</span> <span data-start="674.009" data-end="675.809">optimizing the code is most most of the</span> <span data-start="675.809" data-end="677.419">time not a good idea</span> <span data-start="677.419" data-end="681.72">please remember this and do not do not</span> <span data-start="681.72" data-end="685.019">fall in the trap okay I want to thank</span> <span data-start="685.019" data-end="687.72">near front while building this tool it's</span> <span data-start="687.72" data-end="689.369">open source so you can download it now</span> <span data-start="689.369" data-end="691.379">this is a couple of block big blog post</span> <span data-start="691.379" data-end="694.739">coming out in about this I would also</span> <span data-start="694.739" data-end="696.48">want to thank the team that helped</span> <span data-start="696.48" data-end="700.85">building this tool and Reyes joy corner</span> <span data-start="700.85" data-end="704.579">matheus Allen and Camille this</span> <span data-start="704.579" data-end="705.929">presentation is available a couple of</span> <span data-start="705.929" data-end="708.029">places these and this it's you can take</span> <span data-start="708.029" data-end="709.98">a picture if you want that's the best</span> <span data-start="709.98" data-end="714.389">way to get this content and I am on time</span> <span data-start="714.389" data-end="717.059">so even a little bit early but that's</span> <span data-start="717.059" data-end="722.429">fine so this is me hi I am a police Jeep</span> <span data-start="722.429" data-end="724.679">allocated at near four and I'm also a</span> <span data-start="724.679" data-end="726.089">member of the technical steering</span> <span data-start="726.089" data-end="729.119">committee of the of nodejs so I help</span> <span data-start="729.119" data-end="733.559">maintain the nodes AES runtime so if you</span> <span data-start="733.559" data-end="735.329">have any questions about not a yes come</span> <span data-start="735.329" data-end="738.089">and ask me okay I also write a lot of</span> <span data-start="738.089" data-end="743.73">code as you can see and thank you folks</span> </p>
</section>