<section>
<p><span data-start="13.19" data-end="17.94">hi I'm Felipe I'm a lead developer at</span> <span data-start="17.94" data-end="19.71">Spotify I'm based in Stockholm Sweden</span> <span data-start="19.71" data-end="23.7">and I work in the team responsible for</span> <span data-start="23.7" data-end="25.4">the infrastructure of our desktop</span> <span data-start="25.4" data-end="28.169">application and today I'm going to talk</span> <span data-start="28.169" data-end="30.27">about how we've been using javascript in</span> <span data-start="30.27" data-end="32.279">our client and I'll be sharing some of</span> <span data-start="32.279" data-end="35.28">our architectural details and a bit of</span> <span data-start="35.28" data-end="37.14">the of the stories of the thing that we</span> <span data-start="37.14" data-end="38.79">tried and worked for us things that we</span> <span data-start="38.79" data-end="40.05">tried and didn't work for us</span> <span data-start="40.05" data-end="44.85">and what we learned from them so I've</span> <span data-start="44.85" data-end="45.96">been chatting with some people here at</span> <span data-start="45.96" data-end="47.16">the conference and I realize a lot of</span> <span data-start="47.16" data-end="49.41">people don't know that Spotify for</span> <span data-start="49.41" data-end="51.239">desktop is based on that technologies</span> <span data-start="51.239" data-end="56.34">but it is and right now we do have a lot</span> <span data-start="56.34" data-end="59.039">of native code but the whole UI is</span> <span data-start="59.039" data-end="62.879">web-based so the the goal of this talks</span> <span data-start="62.879" data-end="65.37">to present the story of how I got there</span> <span data-start="65.37" data-end="69.5">and everything we learn in this process</span> <span data-start="69.5" data-end="72.63">but before getting into where we are</span> <span data-start="72.63" data-end="74.549">today I'd like to go back to the</span> <span data-start="74.549" data-end="76.38">beginning of the Spotify history and</span> <span data-start="76.38" data-end="78.6">describe the journey until now like the</span> <span data-start="78.6" data-end="80.13">devolution of the dis oft where how it</span> <span data-start="80.13" data-end="83.13">started and how it is right now so it</span> <span data-start="83.13" data-end="84.6">all started like 10 years ago this is</span> <span data-start="84.6" data-end="87.42">the first sketch of the idea in 2006 two</span> <span data-start="87.42" data-end="90.39">guys in Sweden had this idea that we</span> <span data-start="90.39" data-end="91.56">needed to change the music market</span> <span data-start="91.56" data-end="94.079">because piracy was taking over we needed</span> <span data-start="94.079" data-end="96.18">something that would allow people to</span> <span data-start="96.18" data-end="98.329">consume music that would be just</span> <span data-start="98.329" data-end="101.13">convenient that they could use all the</span> <span data-start="101.13" data-end="102.6">music they could listen to all the music</span> <span data-start="102.6" data-end="105.24">in the world and there to just look like</span> <span data-start="105.24" data-end="108.509">they were using their own library and it</span> <span data-start="108.509" data-end="110.189">should be an alternative to piracy it</span> <span data-start="110.189" data-end="111.96">should be convenient safe to use and</span> <span data-start="111.96" data-end="115.289">free and fair to the artists so they get</span> <span data-start="115.289" data-end="122.369">paid by by their music and however that</span> <span data-start="122.369" data-end="125.31">idea came in 2006 but what if I was just</span> <span data-start="125.31" data-end="128.07">really released to user 2008 and the</span> <span data-start="128.07" data-end="129.3">reason for that was not just the</span> <span data-start="129.3" data-end="131.49">technological challenges but mostly the</span> <span data-start="131.49" data-end="133.47">business challenges around that because</span> <span data-start="133.47" data-end="135.6">what was disrupt in a market and it's a</span> <span data-start="135.6" data-end="137.7">really traditional and big market where</span> <span data-start="137.7" data-end="139.47">they have really conservative ideas of</span> <span data-start="139.47" data-end="142.69">how things should work so it was a long</span> <span data-start="142.69" data-end="145.36">journey of negotiations and contracts</span> <span data-start="145.36" data-end="147.73">with record labels and trying to get the</span> <span data-start="147.73" data-end="151.06">idea that this model should work and</span> <span data-start="151.06" data-end="153.84">then this was 2008 more or less and</span> <span data-start="153.84" data-end="158.05">around 2011 but if I had already grew a</span> <span data-start="158.05" data-end="161.41">lot it it was mostly in Europe had just</span> <span data-start="161.41" data-end="165.25">opened in the US and then there was a</span> <span data-start="165.25" data-end="167.41">need both from Spotify and from other</span> <span data-start="167.41" data-end="170.26">developers to build the community so</span> </p>
<p><span data-start="170.26" data-end="172.03">Spotify really is a platform where</span> <span data-start="172.03" data-end="173.83">third-party developers could write their</span> <span data-start="173.83" data-end="178.78">apps and run them inside fortify so you</span> <span data-start="178.78" data-end="180.79">could have things such as last.fm for</span> <span data-start="180.79" data-end="182.23">example you could use their</span> <span data-start="182.23" data-end="183.61">recommendations inside this part if a</span> <span data-start="183.61" data-end="185.44">client I think like that this platform</span> <span data-start="185.44" data-end="187.51">is no longer available but it is very</span> <span data-start="187.51" data-end="188.77">important to the story I'm gonna wanna</span> <span data-start="188.77" data-end="191.29">tell today we change the approach to</span> <span data-start="191.29" data-end="193.66">have third-party developers that for</span> <span data-start="193.66" data-end="195.55">another model that works better for them</span> <span data-start="195.55" data-end="198.25">and for us that's exposing SDKs that</span> <span data-start="198.25" data-end="200.26">they can use in their absence of having</span> <span data-start="200.26" data-end="203.55">their code running sorry all right and</span> <span data-start="203.55" data-end="206.709">in order to make that that platform work</span> <span data-start="206.709" data-end="208.45">and has something that other developers</span> <span data-start="208.45" data-end="210.82">could work with we started having web</span> <span data-start="210.82" data-end="213.73">build inside the client and for that we</span> <span data-start="213.73" data-end="217.57">use Seth Seth stands for chromium</span> <span data-start="217.57" data-end="220.9">embedded framework and it's not a</span> <span data-start="220.9" data-end="223.57">spoiler as electron or node WebKit but</span> <span data-start="223.57" data-end="227.14">it's older than Windows and what it does</span> <span data-start="227.14" data-end="229.57">is basically the same but it requires a</span> <span data-start="229.57" data-end="234.97">bit more of C++ code to integrate and</span> <span data-start="234.97" data-end="237.91">then it allows us to embed some web</span> <span data-start="237.91" data-end="241.57">build inside the client and it is an</span> <span data-start="241.57" data-end="244.84">open source project that is used mostly</span> <span data-start="244.84" data-end="247.84">by Spotify but also for steam they gave</span> <span data-start="247.84" data-end="250.6">me a platform and there's some projects</span> <span data-start="250.6" data-end="252.73">made by Adobe and of course some smaller</span> <span data-start="252.73" data-end="258.359">projects as well so at the time we had</span> <span data-start="258.359" data-end="261.64">this describe that was mostly C++ but we</span> <span data-start="261.64" data-end="264.58">had this web bills that were just a</span> <span data-start="264.58" data-end="268.44">regular web pages and in those web pages</span> <span data-start="268.44" data-end="271.9">everything was sent both so from the</span> <span data-start="271.9" data-end="274.33">developer perspective they day on the</span> <span data-start="274.33" data-end="275.26">whole document</span> <span data-start="275.26" data-end="277.96">don was belong to to their app they had</span> <span data-start="277.96" data-end="280.06">the global scope for JavaScript and they</span> <span data-start="280.06" data-end="281.89">could use a JavaScript API to talk to</span> <span data-start="281.89" data-end="283.69">this modify functionality such as</span> <span data-start="283.69" data-end="286.12">playback control or fetching the user</span> <span data-start="286.12" data-end="287.59">playlist anything like that there was an</span> </p>
<p><span data-start="287.59" data-end="289.27">API that they could use for that and</span> <span data-start="289.27" data-end="292.33">then we started dogfooding this platform</span> <span data-start="292.33" data-end="294.85">internally and changing over our</span> <span data-start="294.85" data-end="297.13">internal reveals in the client to use</span> <span data-start="297.13" data-end="299.53">this apps platform and that's how I'm</span> <span data-start="299.53" data-end="301.21">gonna call those deals from now on their</span> <span data-start="301.21" data-end="303.67">apps so for example they are this video</span> <span data-start="303.67" data-end="305.17">in the clients now in a have just like a</span> <span data-start="305.17" data-end="307.87">third-party app that is what HTML</span> </p>
<p><span data-start="307.87" data-end="313.2">Javascript and CSS and use the same API</span> <span data-start="313.21" data-end="317.23">two years later 2011 2013 it's what if I</span> <span data-start="317.23" data-end="320.58">went to it for its first big UI change</span> <span data-start="320.58" data-end="323.05">Spotify went black it was great and</span> <span data-start="323.05" data-end="327.01">black and then replacing all the C++ UI</span> <span data-start="327.01" data-end="330.85">components was painful mostly because we</span> <span data-start="330.85" data-end="333.79">use some custom C++ libraries built</span> <span data-start="333.79" data-end="338.13">in-house and that's usually not fun and</span> <span data-start="338.13" data-end="341.59">also at this time the first laptops with</span> <span data-start="341.59" data-end="343.63">high DPI screens or the retina screens</span> <span data-start="343.63" data-end="345.43">as they're called starting popping up in</span> <span data-start="345.43" data-end="348.01">the market and you could start seeing</span> <span data-start="348.01" data-end="349.24">differences when you open the client in</span> <span data-start="349.24" data-end="351.76">a retina screen that there were bills</span> <span data-start="351.76" data-end="354.34">had support for that out of the box but</span> <span data-start="354.34" data-end="357.28">our our C++ UI components didn't so it</span> <span data-start="357.28" data-end="359.95">could see some blurry text 2012 C++ view</span> <span data-start="359.95" data-end="362.8">and a really nice that rendered tax it</span> <span data-start="362.8" data-end="366.25">was a web view so it was a bit</span> <span data-start="366.25" data-end="368.71">complicated and what we kept this this</span> <span data-start="368.71" data-end="372.61">hybrid approach at this time and then</span> <span data-start="372.61" data-end="373.93">one year later there was another</span> <span data-start="373.93" data-end="376.42">iteration of the client well we still</span> <span data-start="376.42" data-end="378.58">had a very similar UI but we had a</span> <span data-start="378.58" data-end="381.4">really big difference in terms of of the</span> <span data-start="381.4" data-end="386.02">stack we went full web so all the UI</span> <span data-start="386.02" data-end="388.33">code that was before in C++ was removed</span> <span data-start="388.33" data-end="393.28">and replaced by by HTML and JavaScript</span> <span data-start="393.28" data-end="396.52">and things that were done as regular C++</span> <span data-start="396.52" data-end="399.91">method calls became api's exposed to the</span> </p>
<p><span data-start="399.91" data-end="401.38">JavaScript layer that could be called</span> <span data-start="401.38" data-end="405.79">from there so now we have this client</span> <span data-start="405.79" data-end="408.61">that's fully fully web-based</span> <span data-start="408.61" data-end="411.159">and for us developers there was a big</span> <span data-start="411.159" data-end="413.199">advantage of that because it's of course</span> <span data-start="413.199" data-end="415.599">much faster and easier to develop on it</span> <span data-start="415.599" data-end="418.33">and we gained some things for free by by</span> <span data-start="418.33" data-end="420.969">using this deck such as the the retina</span> <span data-start="420.969" data-end="423.669">support as I said before but also it's</span> <span data-start="423.669" data-end="425.8">better for accessibility because you can</span> <span data-start="425.8" data-end="427.09">integrate better screen readers for</span> <span data-start="427.09" data-end="432.159">users with visual impairment and other</span> <span data-start="432.159" data-end="436.03">accessibility issues but then to get</span> <span data-start="436.03" data-end="437.949">them into a big dilemma that I think</span> <span data-start="437.949" data-end="439.96">most developers in this room and outside</span> <span data-start="439.96" data-end="442.629">this room have been through so you have</span> <span data-start="442.629" data-end="445.75">this big codebase that works and it</span> <span data-start="445.75" data-end="447.43">attends your needs but it's really hard</span> <span data-start="447.43" data-end="450.069">to work with should we actually rewrite</span> <span data-start="450.069" data-end="452.56">that code it's usually an anti-pattern</span> <span data-start="452.56" data-end="454.689">you were replacing something that work</span> <span data-start="454.689" data-end="457.449">works and in risks too it can introduce</span> <span data-start="457.449" data-end="461.139">new bugs and all of that and then also</span> <span data-start="461.139" data-end="464.529">in this case we had gonna replace this</span> <span data-start="464.529" data-end="467.71">new this big chunk of code but there is</span> <span data-start="467.71" data-end="472.21">no really any visible visual any visible</span> <span data-start="472.21" data-end="473.949">gain for the users at least short term</span> <span data-start="473.949" data-end="477.55">so it's kind of questionable if it's</span> <span data-start="477.55" data-end="480.49">actually worth it and then like the old</span> <span data-start="480.49" data-end="482.529">code we had the C++ code that had been</span> <span data-start="482.529" data-end="484.839">around for several years it said has</span> <span data-start="484.839" data-end="486.669">been tested a lot we knew that it worked</span> <span data-start="486.669" data-end="489.339">well if we just replace it before a new</span> <span data-start="489.339" data-end="491.05">code base could be introducing a lot of</span> <span data-start="491.05" data-end="493.599">new bugs and it was of course the</span> <span data-start="493.599" data-end="496.12">opportunity cost so it will be right not</span> <span data-start="496.12" data-end="497.949">cold and then you were missing the</span> <span data-start="497.949" data-end="499.449">opportunity to build new new features</span> <span data-start="499.449" data-end="501.189">and you can also block the development</span> <span data-start="501.189" data-end="502.419">of new features because we're rewriting</span> <span data-start="502.419" data-end="504.58">a toad code so there are several</span> <span data-start="504.58" data-end="507.87">arguments not to rewrite code that works</span> <span data-start="507.87" data-end="510.789">so and when when you discuss in the team</span> <span data-start="510.789" data-end="512.349">about rewrites</span> <span data-start="512.349" data-end="513.76">those discussions can be really</span> <span data-start="513.76" data-end="516.37">emotionally charged because people got</span> <span data-start="516.37" data-end="518.169">can get attached to their the code they</span> <span data-start="518.169" data-end="522.779">wrote and some people can also have a</span> <span data-start="522.779" data-end="524.709">can kind of hate</span> <span data-start="524.709" data-end="526.18">code that they didn't work because they</span> <span data-start="526.18" data-end="529.54">don't understand because writing code is</span> <span data-start="529.54" data-end="531.19">easy but reading code is hard and then</span> <span data-start="531.19" data-end="532.36">sometimes when you got someone else's</span> <span data-start="532.36" data-end="534.64">code you can just throw it away and</span> <span data-start="534.64" data-end="536.92">build it yourself but you have to be</span> <span data-start="536.92" data-end="538.24">pragmatic when I think about these</span> <span data-start="538.24" data-end="541.51">things and then we try to apply a bit of</span> </p>
<p><span data-start="541.51" data-end="544.18">Janene thinking on that and I when I say</span> <span data-start="544.18" data-end="546.64">engineer thinking I mean that engineers</span> <span data-start="546.64" data-end="548.71">should analyze trade-offs they should</span> <span data-start="548.71" data-end="551.89">look for optimizations and it should</span> <span data-start="551.89" data-end="554.44">look for improving the efficiency of the</span> <span data-start="554.44" data-end="555.94">product and processes they're working on</span> <span data-start="555.94" data-end="558.19">so how how could it do that in a way</span> <span data-start="558.19" data-end="561.28">that we would be pragmatic about the</span> <span data-start="561.28" data-end="563.65">trade-offs and try to optimize the cost</span> <span data-start="563.65" data-end="566.17">and benefits gonna take all of it so we</span> <span data-start="566.17" data-end="568.72">thought that we would be if you take</span> <span data-start="568.72" data-end="571.21">this path and rewrite this C++ code in</span> </p>
<p><span data-start="571.21" data-end="573.73">JavaScript we will be adding value by</span> <span data-start="573.73" data-end="575.74">allowing us to iterate faster in the</span> <span data-start="575.74" data-end="578.71">future and experiment with things in the</span> <span data-start="578.71" data-end="580.21">UI that because you have a much more</span> <span data-start="580.21" data-end="583.81">easier code to work with and then as a</span> <span data-start="583.81" data-end="585.67">as a data driven company it's really</span> <span data-start="585.67" data-end="587.32">important for us to do a/b testing and</span> <span data-start="587.32" data-end="589.3">then it's nice if you have a code base</span> <span data-start="589.3" data-end="590.41">that allows you to do that easily</span> <span data-start="590.41" data-end="593.47">because you can iterate much faster and</span> <span data-start="593.47" data-end="594.94">on the downside you had a really high</span> <span data-start="594.94" data-end="597.01">implementation cost because I have to</span> <span data-start="597.01" data-end="599.56">rewrite this whole code base but we we</span> <span data-start="599.56" data-end="601.54">thought that it pay off over time</span> <span data-start="601.54" data-end="603.1">because the maintenance cost will be</span> <span data-start="603.1" data-end="606.01">much slower much much lower so we went</span> <span data-start="606.01" data-end="607.84">ahead and thought that yeah let's do</span> <span data-start="607.84" data-end="611.5">this and what I'm going to talk about is</span> <span data-start="611.5" data-end="613.45">a bit of the architecture how we</span> <span data-start="613.45" data-end="615.94">structured our our layers and our</span> <span data-start="615.94" data-end="617.35">architecture in order to achieve this</span> <span data-start="617.35" data-end="621.94">this go so I'm gonna describe it</span> <span data-start="621.94" data-end="625.03">architecture but I'm not starting from</span> <span data-start="625.03" data-end="629.17">the lowest layer so under everything</span> <span data-start="629.17" data-end="630.52">there is what we call the client core</span> <span data-start="630.52" data-end="632.74">and clients core is a hybrid that's</span> <span data-start="632.74" data-end="634.96">habit Spotify that's the c++ library</span> <span data-start="634.96" data-end="638.08">lets shared among all the main platforms</span> <span data-start="638.08" data-end="640.09">so it's the same code base for Android</span> <span data-start="640.09" data-end="642.67">iOS and that's top and what this library</span> <span data-start="642.67" data-end="645.22">does is basically them the lower level</span> <span data-start="645.22" data-end="646.42">things like it's just much before the</span> <span data-start="646.42" data-end="648.37">streaming the code in playback audio</span> <span data-start="648.37" data-end="650.65">drivers talk to the back and offline</span> <span data-start="650.65" data-end="652.06">syncing and all those things that are</span> <span data-start="652.06" data-end="653.86">common between those platforms in a more</span> <span data-start="653.86" data-end="657.67">integrated in a lower level and above</span> <span data-start="657.67" data-end="660.19">that so and then also like this client</span> <span data-start="660.19" data-end="662.83">core is as it's used by several</span> <span data-start="662.83" data-end="665.56">platforms the ownership is also shared</span> <span data-start="665.56" data-end="667.69">by those teams so the infrastructure</span> <span data-start="667.69" data-end="670.42">teams of those those platforms work</span> <span data-start="670.42" data-end="672.14">together in this library</span> <span data-start="672.14" data-end="675.51">above that had the client desktop layer</span> <span data-start="675.51" data-end="680.16">what that what that is is basically the</span> <span data-start="680.16" data-end="681.48">integration with operating systems with</span> </p>
<p><span data-start="681.48" data-end="683.61">Windows and Mac and Linux limited Linux</span> <span data-start="683.61" data-end="686.9">is kind of not officially supported and</span> <span data-start="686.9" data-end="689.28">what it does also is to glue together</span> <span data-start="689.28" data-end="692.76">the core and expose things to the web</span> <span data-start="692.76" data-end="696.68">layer that's safe there is above it so</span> <span data-start="696.68" data-end="699.36">that's what the client desktop does and</span> <span data-start="699.36" data-end="701.55">if you were yesterday in that really</span> <span data-start="701.55" data-end="703.92">nice talk about electron she talked</span> <span data-start="703.92" data-end="707.13">about two processes the main process and</span> <span data-start="707.13" data-end="708.81">the rendering process here is pretty</span> <span data-start="708.81" data-end="711.03">much the same the two layers the bottom</span> <span data-start="711.03" data-end="712.56">are the main process so we don't have</span> <span data-start="712.56" data-end="713.88">any JavaScript running the main process</span> <span data-start="713.88" data-end="717.23">but the render process are the rest</span> <span data-start="717.23" data-end="719.73">so we have like the chromium embedded</span> <span data-start="719.73" data-end="722.25">framework that basically just renders</span> <span data-start="722.25" data-end="726.81">the our web views and the client desktop</span> <span data-start="726.81" data-end="729.24">exposed some API through chromium added</span> <span data-start="729.24" data-end="732.33">framework so we can talk to the core and</span> <span data-start="732.33" data-end="733.77">then we have two two layers of</span> </p>
<p><span data-start="733.77" data-end="736.62">JavaScript where JS container is more</span> <span data-start="736.62" data-end="738.93">like a logic layer where we manage like</span> <span data-start="738.93" data-end="741.33">navigation and playback state and things</span> <span data-start="741.33" data-end="743.7">like that for more the container of the</span> <span data-start="743.7" data-end="746.19">UI of the of the of the UI and the</span> <span data-start="746.19" data-end="748.56">little boxes in the top are the actual</span> <span data-start="748.56" data-end="750.57">videos the actual what we call the apps</span> <span data-start="750.57" data-end="753.93">that are owned by different teams so for</span> <span data-start="753.93" data-end="756.45">example have the Browse view or the the</span> <span data-start="756.45" data-end="758.22">search playlist the artists they're all</span> <span data-start="758.22" data-end="760.92">like their own little boxes that belong</span> <span data-start="760.92" data-end="764.46">to different teams so if you want a more</span> <span data-start="764.46" data-end="768.15">visual understand that of these</span> </p>
<p><span data-start="768.15" data-end="769.98">JavaScript layers more or less like this</span> <span data-start="769.98" data-end="774.8">our visualize and then we kept the same</span> <span data-start="774.8" data-end="776.88">architecture for the apps as we did for</span> <span data-start="776.88" data-end="778.86">the third-party developers a few years</span> <span data-start="778.86" data-end="779.37">back</span> <span data-start="779.37" data-end="782.58">and so the container is the main Chrome</span> <span data-start="782.58" data-end="784.86">and the application it manages out that</span> <span data-start="784.86" data-end="787.86">the apps inside it and that's our</span> <span data-start="787.86" data-end="790.26">sandbox as I said before so they they</span> <span data-start="790.26" data-end="792.03">only document they own the global scope</span> <span data-start="792.03" data-end="794.37">and the way to do that was to use</span> <span data-start="794.37" data-end="795.3">iframes</span> <span data-start="795.3" data-end="797.31">and then some people might be a bit</span> <span data-start="797.31" data-end="799.74">surprised like come on it's 2016 you're</span> <span data-start="799.74" data-end="802.83">still using iframes and of course it's</span> <span data-start="802.83" data-end="805.77">not idea what life is a trade-off</span> <span data-start="805.77" data-end="807.93">right and then here's iframes was a</span> <span data-start="807.93" data-end="809.57">really pragmatic decision at the time</span> <span data-start="809.57" data-end="812.97">because iframes are relative abstraction</span> <span data-start="812.97" data-end="816.63">for sandboxing on the web so we could</span> <span data-start="816.63" data-end="819.33">guarantee for some level of guarantee</span> <span data-start="819.33" data-end="821.4">that things are running there before</span> <span data-start="821.4" data-end="823.92">their own environment that really leak</span> <span data-start="823.92" data-end="827.76">things to other to other things and it's</span> <span data-start="827.76" data-end="831.81">not our negative because imagine that it</span> </p>
<p><span data-start="831.81" data-end="835.11">Spotify is not really like most web</span> <span data-start="835.11" data-end="836.52">applications that people run on the</span> <span data-start="836.52" data-end="838.32">browser and they close once in a while</span> <span data-start="838.32" data-end="839.82">or like after a few hours or something</span> <span data-start="839.82" data-end="841.62">something that people can leave the</span> <span data-start="841.62" data-end="843">client open in the background for weeks</span> <span data-start="843" data-end="846.15">and then newer leaks can be a big a big</span> <span data-start="846.15" data-end="849.96">thing there in the client side and with</span> <span data-start="849.96" data-end="850.71">iframes</span> <span data-start="850.71" data-end="853.83">we can even though the iframe itself has</span> <span data-start="853.83" data-end="857.1">a higher memory footprint we can just</span> <span data-start="857.1" data-end="858.42">kill iframes and then release that</span> <span data-start="858.42" data-end="860.94">memory much much more easier so the the</span> <span data-start="860.94" data-end="862.35">feature developer got to work inside</span> <span data-start="862.35" data-end="864.3">that iframe they don't need to care too</span> <span data-start="864.3" data-end="866.25">much about that the video that they</span> <span data-start="866.25" data-end="867.66">should care but not too much because the</span> <span data-start="867.66" data-end="869.73">container can kind of manage okay this</span> <span data-start="869.73" data-end="871.71">iframe has been idle yes let's just kill</span> <span data-start="871.71" data-end="873.03">it to release the memory anything like</span> <span data-start="873.03" data-end="873.45">that</span> <span data-start="873.45" data-end="876.96">and keeping iframes when we did this</span> <span data-start="876.96" data-end="880.53">rewrite reduce the risk of the rewrite</span> <span data-start="880.53" data-end="883.41">because the rewrites didn't affect the</span> <span data-start="883.41" data-end="886.44">apps themselves so it like the people</span> <span data-start="886.44" data-end="887.97">who are working in the artist view</span> <span data-start="887.97" data-end="890.04">weren't affect at all by the process</span> <span data-start="890.04" data-end="891.21">that we meant by replacing</span> <span data-start="891.21" data-end="893.13">infrastructure because they still kept</span> <span data-start="893.13" data-end="895.17">their sandbox environment so it's</span> <span data-start="895.17" data-end="897.06">something that we used to reduce reduce</span> <span data-start="897.06" data-end="899.25">risk and it's migration period and you</span> <span data-start="899.25" data-end="904.53">can iterate on it afterwards so based on</span> <span data-start="904.53" data-end="907.32">what I said so far of the having these</span> <span data-start="907.32" data-end="909.48">two layers of JavaScript a lot of custom</span> <span data-start="909.48" data-end="912.51">custom libraries and tools how do we</span> <span data-start="912.51" data-end="915">actually organize our code and then this</span> <span data-start="915" data-end="918.93">is something that we did and seems</span> <span data-start="918.93" data-end="923.34">really standard so we had the autos app</span> <span data-start="923.34" data-end="925.98">so had one repository per app</span> <span data-start="925.98" data-end="927.33">plane his browser I think their own</span> <span data-start="927.33" data-end="929.67">repository had one repository per</span> <span data-start="929.67" data-end="931.44">library so we had some libraries</span> <span data-start="931.44" data-end="932.19">internally</span> <span data-start="932.19" data-end="937.71">such as our UI library that has CSS and</span> <span data-start="937.71" data-end="938.72">how buttons look</span> </p>
<p><span data-start="938.72" data-end="939.829">I can templates and things like that</span> <span data-start="939.829" data-end="942.139">have another library that does the</span> <span data-start="942.139" data-end="943.759">Parsee no Spotify internal you are</span> <span data-start="943.759" data-end="946.009">either things like that and we had we</span> <span data-start="946.009" data-end="947.629">had an instance of an internal in game</span> <span data-start="947.629" data-end="950.149">registry to distribute this libraries so</span> <span data-start="950.149" data-end="952.31">it seems pretty standard but no didn't</span> <span data-start="952.31" data-end="953.06">work for us</span> <span data-start="953.06" data-end="956.389">which is also can be surprising for some</span> <span data-start="956.389" data-end="962.089">people and why didn't it work it's like</span> <span data-start="962.089" data-end="964.1">everything had their their little things</span> <span data-start="964.1" data-end="964.939">they're organized</span> <span data-start="964.939" data-end="966.98">everything seems really encapsulated but</span> <span data-start="966.98" data-end="970.31">why didn't it work it was really hard to</span> <span data-start="970.31" data-end="972.709">coordinate horizontal changes and when I</span> <span data-start="972.709" data-end="974.389">mean horizontal changes like a change</span> <span data-start="974.389" data-end="976.43">that affects affect many views so</span> <span data-start="976.43" data-end="979.129">suppose you were working in the generic</span> </p>
<p><span data-start="979.129" data-end="982.43">UI library for Spotify and then you want</span> <span data-start="982.43" data-end="984.829">to change the shade of green</span> <span data-start="984.829" data-end="987.139">that that's a display or the behavior of</span> <span data-start="987.139" data-end="989.75">the play button that is everywhere in</span> <span data-start="989.75" data-end="994.37">the client so you had to make the change</span> <span data-start="994.37" data-end="997.55">in a library and make sure all the apps</span> <span data-start="997.55" data-end="999.829">have new builds that fetch on your</span> <span data-start="999.829" data-end="1001.66">change and so it involved a lot of</span> <span data-start="1001.66" data-end="1003.399">communication and syncing between teams</span> <span data-start="1003.399" data-end="1006.67">and especially stressful before releases</span> <span data-start="1006.67" data-end="1010.3">it's a bit hard to coordinate and that</span> <span data-start="1010.3" data-end="1012.49">could also cause some cascade effect on</span> <span data-start="1012.49" data-end="1014.829">library updates so imagine you are</span> <span data-start="1014.829" data-end="1016.66">changing a really basic library that</span> <span data-start="1016.66" data-end="1018.04">there is another library depends on it</span> <span data-start="1018.04" data-end="1019.569">and another library and an app that</span> <span data-start="1019.569" data-end="1021.399">depends on it to make sure that all the</span> <span data-start="1021.399" data-end="1022.75">versions were bumped and dependencies</span> <span data-start="1022.75" data-end="1024.669">are not I think they're active so the</span> <span data-start="1024.669" data-end="1026.47">the communication overhead was really</span> <span data-start="1026.47" data-end="1031.419">really high with this model it also</span> <span data-start="1031.419" data-end="1032.549">complicated continuous integration</span> <span data-start="1032.549" data-end="1036.01">that's the billeting standardization it</span> <span data-start="1036.01" data-end="1037.419">complicated continues integration</span> <span data-start="1037.419" data-end="1040.03">because the builds need the bit</span> <span data-start="1040.03" data-end="1041.77">pipelines needs to be changed somehow</span> <span data-start="1041.77" data-end="1043.72">so we wanted to make sure that if I</span> <span data-start="1043.72" data-end="1047.439">change something and after it builds I</span> <span data-start="1047.439" data-end="1048.58">want to also build the things that</span> <span data-start="1048.58" data-end="1049.72">depend on it because I have to keep</span> <span data-start="1049.72" data-end="1051.88">consistency my product even though some</span> <span data-start="1051.88" data-end="1054.909">semver is is a good idea it might might</span> <span data-start="1054.909" data-end="1058.03">have something that we need to to force</span> <span data-start="1058.03" data-end="1060.19">glaber's to be updated so we need to</span> <span data-start="1060.19" data-end="1062.409">trigger new builds of things that depend</span> <span data-start="1062.409" data-end="1065.83">on my library so we if you actually need</span> <span data-start="1065.83" data-end="1067.39">it to work I will need to create a</span> <span data-start="1067.39" data-end="1069.669">really complex graph of dependencies in</span> <span data-start="1069.669" data-end="1070.87">the bill wipe lines</span> <span data-start="1070.87" data-end="1072.1">it's not something that you wanna do</span> <span data-start="1072.1" data-end="1075.76">and for Standardization it's also hard</span> <span data-start="1075.76" data-end="1079.39">because evacuating silos so different</span> <span data-start="1079.39" data-end="1080.83">teams will build things in different</span> <span data-start="1080.83" data-end="1085.12">ways and use different tools and that's</span> <span data-start="1085.12" data-end="1088.9">a bit it goes a bit with autonomy that</span> <span data-start="1088.9" data-end="1090.37">autonomy is usually good but you need</span> <span data-start="1090.37" data-end="1093.43">some alignment and then it these</span> <span data-start="1093.43" data-end="1096.4">architecture it makes a language more</span> <span data-start="1096.4" data-end="1100.06">difficult so little how it looked like</span> <span data-start="1100.06" data-end="1102.31">so suppose like you have like the</span> <span data-start="1102.31" data-end="1104.89">playlist step the radio app they depend</span> <span data-start="1104.89" data-end="1107.23">on the same libraries but they depend on</span> <span data-start="1107.23" data-end="1109.38">separate versions because they are in</span> <span data-start="1109.38" data-end="1112.95">repositories their separate modules so</span> <span data-start="1112.95" data-end="1116.04">you have those things and then average</span> <span data-start="1116.04" data-end="1118.57">every every app had their own build</span> <span data-start="1118.57" data-end="1121.24">pipeline so when you build you generate</span> <span data-start="1121.24" data-end="1122.47">the artifacts and you could for example</span> <span data-start="1122.47" data-end="1125.41">have playlists with a different style</span> <span data-start="1125.41" data-end="1127.96">for the tracklist then in radio for</span> <span data-start="1127.96" data-end="1130.3">example or a different sheet of green in</span> <span data-start="1130.3" data-end="1131.44">the same release and that's not</span> <span data-start="1131.44" data-end="1134.76">something we want to have so we started</span> <span data-start="1134.76" data-end="1139.15">investigating into it how could we avoid</span> <span data-start="1139.15" data-end="1142.75">this kind of problem so we checked out</span> <span data-start="1142.75" data-end="1144.73">how other other companies were have been</span> <span data-start="1144.73" data-end="1147.91">doing how to merge repositories and</span> <span data-start="1147.91" data-end="1150.67">things like that so how could you</span> <span data-start="1150.67" data-end="1152.77">mitigate those problems so basically</span> <span data-start="1152.77" data-end="1154.72">what I did is we jumped into the mono</span> <span data-start="1154.72" data-end="1158.86">repo we had a most of our repositories</span> <span data-start="1158.86" data-end="1161.71">in a single one and it automatically</span> <span data-start="1161.71" data-end="1163.45">addressed a lot of the issues that we</span> <span data-start="1163.45" data-end="1168.01">had before it simplified a lot the</span> <span data-start="1168.01" data-end="1169.39">continuous integration because we just</span> <span data-start="1169.39" data-end="1171.64">have one build pipeline you change the</span> <span data-start="1171.64" data-end="1173.2">repository you build everything and it's</span> <span data-start="1173.2" data-end="1176.74">fine it's always like it always works as</span> <span data-start="1176.74" data-end="1179.23">it should be and it's easier to test the</span> <span data-start="1179.23" data-end="1181.72">impact of your changes so if you're</span> <span data-start="1181.72" data-end="1183.07">making changes in the library you can</span> <span data-start="1183.07" data-end="1185.74">just grab and see what it's been used</span> <span data-start="1185.74" data-end="1187.84">and just fix it there and because of</span> <span data-start="1187.84" data-end="1189.34">that you don't need to care about</span> <span data-start="1189.34" data-end="1191.74">backwards compatibility which makes the</span> <span data-start="1191.74" data-end="1192.64">code much simpler</span> <span data-start="1192.64" data-end="1194.44">you don't need to keep old code there</span> <span data-start="1194.44" data-end="1196.48">just make a change change whatever it's</span> <span data-start="1196.48" data-end="1199">being used it's fine and you can do that</span> <span data-start="1199" data-end="1201.82">in an atomic way so it can make a change</span> <span data-start="1201.82" data-end="1204.13">in a library and the code that depends</span> <span data-start="1204.13" data-end="1204.809">on it in a thing</span> <span data-start="1204.809" data-end="1207.509">commit which makes it much easier to to</span> <span data-start="1207.509" data-end="1210.139">go back and forth and roll back and</span> <span data-start="1210.139" data-end="1213.45">everything so it is much easier for</span> <span data-start="1213.45" data-end="1216.629">refactoring the code and it promotes</span> <span data-start="1216.629" data-end="1218.85">some consistency in its narration across</span> <span data-start="1218.85" data-end="1220.98">the board because the articles in a</span> <span data-start="1220.98" data-end="1223.249">single place</span> <span data-start="1223.249" data-end="1226.379">so now we had like this single posit Ori</span> <span data-start="1226.379" data-end="1228.36">the single build pipeline and we could</span> <span data-start="1228.36" data-end="1229.71">have consistency that dependencies</span> <span data-start="1229.71" data-end="1231.149">because they're all searching the same</span> <span data-start="1231.149" data-end="1237.149">dependencies so yeah now things are much</span> <span data-start="1237.149" data-end="1239.759">simpler than before I'll have the other</span> <span data-start="1239.759" data-end="1241.71">code in the same place they are</span> <span data-start="1241.71" data-end="1243.6">affecting the same dependencies but</span> <span data-start="1243.6" data-end="1245.549">there is still a lot of entropy and the</span> <span data-start="1245.549" data-end="1248.159">reason for that is we had many teams</span> <span data-start="1248.159" data-end="1251.129">working in this layer of repositories</span> <span data-start="1251.129" data-end="1253.019">they're kind of siloed in their own</span> <span data-start="1253.019" data-end="1256.169">world so in order to escape our</span> <span data-start="1256.169" data-end="1258.21">development and our teams we gave them</span> <span data-start="1258.21" data-end="1260.909">an autonomy to to pick their tools to</span> <span data-start="1260.909" data-end="1263.34">pick their technologies and then we</span> <span data-start="1263.34" data-end="1264.869">start putting things together with so</span> <span data-start="1264.869" data-end="1267.24">many things are different so some teams</span> <span data-start="1267.24" data-end="1270.48">used to write unit testing framework a</span> <span data-start="1270.48" data-end="1273.299">the another teams framework B and we're</span> <span data-start="1273.299" data-end="1274.559">cite like putting everything together in</span> <span data-start="1274.559" data-end="1277.47">the same field pipeline come on we need</span> <span data-start="1277.47" data-end="1279.21">to we need to fix this we need to find a</span> <span data-start="1279.21" data-end="1283.169">way to standardize our practices so we</span> <span data-start="1283.169" data-end="1285.84">came up with the idea of the Golden Path</span> <span data-start="1285.84" data-end="1289.169">and the Golden Path what it is is a set</span> <span data-start="1289.169" data-end="1291.179">of recommendation recommended practices</span> <span data-start="1291.179" data-end="1293.639">tools and libraries that are fully</span> <span data-start="1293.639" data-end="1295.679">supporting it that recommended things</span> <span data-start="1295.679" data-end="1297.69">that people should use it doesn't mean</span> <span data-start="1297.69" data-end="1300.179">that they are forced to use but if they</span> <span data-start="1300.179" data-end="1301.86">do they get all the support from the</span> <span data-start="1301.86" data-end="1303.629">infrastructure team all the tooling they</span> <span data-start="1303.629" data-end="1305.249">just they can just focus on building</span> <span data-start="1305.249" data-end="1307.32">their feature did not need to focus on</span> <span data-start="1307.32" data-end="1309.899">spending time in tooling tooling is</span> <span data-start="1309.899" data-end="1311.639">there just use it and build your feature</span> <span data-start="1311.639" data-end="1313.649">of course you can still go crazy and</span> <span data-start="1313.649" data-end="1315.84">doing other things but it's not</span> <span data-start="1315.84" data-end="1319.169">something that would really like so the</span> <span data-start="1319.169" data-end="1321.179">way we came up the way we started</span> <span data-start="1321.179" data-end="1324.21">working in a Golden Path I was to put</span> <span data-start="1324.21" data-end="1326.399">together put together a standardization</span> <span data-start="1326.399" data-end="1328.71">work group and the way we did this we</span> <span data-start="1328.71" data-end="1330.299">got like one representative from each</span> <span data-start="1330.299" data-end="1334.23">team and the this world would get</span> <span data-start="1334.23" data-end="1337.049">together and analyze different things</span> <span data-start="1337.049" data-end="1337.77">that</span> <span data-start="1337.77" data-end="1341.46">so let's check all the testing libraries</span> <span data-start="1341.46" data-end="1344.58">that we are using so to make we're using</span> <span data-start="1344.58" data-end="1346.62">for example look at the unit testing</span> <span data-start="1346.62" data-end="1348.27">like and some some apps are you can</span> <span data-start="1348.27" data-end="1351.39">expect some I apply using assert some</span> <span data-start="1351.39" data-end="1355.47">apps are using whatever and then so how</span> <span data-start="1355.47" data-end="1357.45">can we turn it back on something so you</span> <span data-start="1357.45" data-end="1359.67">can go into our test and understand how</span> <span data-start="1359.67" data-end="1361.92">they work and things like that so this</span> <span data-start="1361.92" data-end="1363.929">what this workgroup goal was to actually</span> <span data-start="1363.929" data-end="1366">do this kind of analysis and come up</span> <span data-start="1366" data-end="1367.41">with solutions and proposals for that</span> <span data-start="1367.41" data-end="1370.74">and when I started analyzing and</span> <span data-start="1370.74" data-end="1374.1">building this golden path documentation</span> <span data-start="1374.1" data-end="1376.37">we start seeing some de facto standards</span> <span data-start="1376.37" data-end="1378.99">that were easy to standardize on because</span> <span data-start="1378.99" data-end="1380.37">that's what most people are already</span> <span data-start="1380.37" data-end="1384.15">using so we just went ahead okay 80% of</span> <span data-start="1384.15" data-end="1385.92">our code base already does it this way</span> <span data-start="1385.92" data-end="1389.19">so let's just do it for the rest and so</span> <span data-start="1389.19" data-end="1390.63">if that would be taking the path of</span> <span data-start="1390.63" data-end="1392.1">least resistance and so it would be</span> <span data-start="1392.1" data-end="1394.74">easier to to make every one line in the</span> <span data-start="1394.74" data-end="1399.69">same thing and we try to make those</span> <span data-start="1399.69" data-end="1402.42">decisions based on actual data so we</span> <span data-start="1402.42" data-end="1404.61">don't really want to go for wishful</span> <span data-start="1404.61" data-end="1406.83">thinking we actually want so much more</span> <span data-start="1406.83" data-end="1409.11">experimentation around some some</span> <span data-start="1409.11" data-end="1410.58">technique or some — and then see okay</span> <span data-start="1410.58" data-end="1412.44">that works for that team maybe we should</span> <span data-start="1412.44" data-end="1416.87">actually adopt in other teams as well so</span> <span data-start="1416.87" data-end="1418.98">there were some lessons we learned in</span> <span data-start="1418.98" data-end="1421.29">this process so I'm going to just recap</span> </p>
<p><span data-start="1421.29" data-end="1424.679">I think that III said before and think</span> <span data-start="1424.679" data-end="1427.23">that we learn when we go to this stage</span> <span data-start="1427.23" data-end="1428.94">that's that stage where right now you're</span> <span data-start="1428.94" data-end="1432.42">aligning teams in in same practices so</span> <span data-start="1432.42" data-end="1434.04">we can move forward they maybe rethink</span> <span data-start="1434.04" data-end="1436.2">the iframes thing because once the code</span> <span data-start="1436.2" data-end="1438">is more standard it's easier to remove</span> <span data-start="1438" data-end="1439.32">those kind of sandboxing at the inner</span> <span data-start="1439.32" data-end="1442.59">gates so what the first thing that that</span> <span data-start="1442.59" data-end="1445.53">is very important is to what in your</span> <span data-start="1445.53" data-end="1447.21">projects always always try to evolve</span> <span data-start="1447.21" data-end="1449.58">things incrementally and what that means</span> <span data-start="1449.58" data-end="1450.78">is that don't try to solve all the</span> <span data-start="1450.78" data-end="1455.04">problems at once try to fail fast and</span> <span data-start="1455.04" data-end="1458.64">validate your hypothesis and don't ya</span> <span data-start="1458.64" data-end="1460.5">try to release as fast as possible so</span> <span data-start="1460.5" data-end="1462.63">you can see that the impact that they</span> <span data-start="1462.63" data-end="1466.8">were creating and also like many</span> <span data-start="1466.8" data-end="1468.179">companies have done an infra ting</span> <span data-start="1468.179" data-end="1469.58">marketing my work</span> <span data-start="1469.58" data-end="1473.15">and in some companies in for teams are</span> <span data-start="1473.15" data-end="1475.73">usually kind of dictators that okay we</span> <span data-start="1475.73" data-end="1477.44">built this thing everyone should use it</span> <span data-start="1477.44" data-end="1481.67">this way and for us having more empathy</span> <span data-start="1481.67" data-end="1483.32">as we saw yesterday and more connections</span> <span data-start="1483.32" data-end="1485.75">with the other developers make things</span> <span data-start="1485.75" data-end="1487.28">work much better have a much better</span> <span data-start="1487.28" data-end="1489.92">relationship with feature teams and we</span> <span data-start="1489.92" data-end="1491.27">can get things with much higher quality</span> <span data-start="1491.27" data-end="1493.46">so having an infra team let's pour in</span> <span data-start="1493.46" data-end="1495.23">touch with other developers and</span> <span data-start="1495.23" data-end="1497.09">listening to them and having other</span> <span data-start="1497.09" data-end="1498.68">developers participating and the</span> <span data-start="1498.68" data-end="1500.27">decisions have really improved us I</span> <span data-start="1500.27" data-end="1503.48">proved the our flow to get things</span> <span data-start="1503.48" data-end="1507.05">working and when we merge repositories</span> <span data-start="1507.05" data-end="1509.84">we noticed that the way we structure our</span> <span data-start="1509.84" data-end="1513.91">repositories shouldn't dictate your your</span> <span data-start="1513.91" data-end="1515.69">architecture so that's why for us</span> <span data-start="1515.69" data-end="1518.09">merging them was a good idea because it</span> <span data-start="1518.09" data-end="1520.49">gave us a lot of flexibility on how we</span> <span data-start="1520.49" data-end="1522.32">want things to change in the future</span> <span data-start="1522.32" data-end="1526.49">and last but not least like consistency</span> <span data-start="1526.49" data-end="1528.11">is really important in a codebase</span> <span data-start="1528.11" data-end="1530.06">specially in a big project it's more</span> <span data-start="1530.06" data-end="1531.47">important to have one single way of</span> <span data-start="1531.47" data-end="1533.48">doing things then and then doing like</span> <span data-start="1533.48" data-end="1534.5">the coolest thing ever</span> <span data-start="1534.5" data-end="1536.39">because when you have a consistent way</span> <span data-start="1536.39" data-end="1538.01">of doing things people are more</span> <span data-start="1538.01" data-end="1539.54">productive people can understand better</span> <span data-start="1539.54" data-end="1540.8">the code you can navigate through the</span> <span data-start="1540.8" data-end="1542.24">code and see okay this is how you do it</span> <span data-start="1542.24" data-end="1545.87">and there's how it's been done but if</span> <span data-start="1545.87" data-end="1547.64">you're just focusing on trying like this</span> <span data-start="1547.64" data-end="1549.26">new thing and make it the coolest</span> <span data-start="1549.26" data-end="1550.64">possible and then everything is</span> <span data-start="1550.64" data-end="1551.78">different different parts of the code</span> <span data-start="1551.78" data-end="1554">base it really makes it hard for people</span> <span data-start="1554" data-end="1556.7">to understand their code and to first if</span> </p>
<p><span data-start="1556.7" data-end="1558.32">I know got a new hire in a company's</span> <span data-start="1558.32" data-end="1560.21">growing you need to have oh okay this is</span> <span data-start="1560.21" data-end="1561.8">how you do things and then this person</span> <span data-start="1561.8" data-end="1562.94">is gonna be able to spin much faster</span> <span data-start="1562.94" data-end="1565.67">than you have like such a heterogeneous</span> <span data-start="1565.67" data-end="1570.62">code base and yeah I couldn't miss the</span> <span data-start="1570.62" data-end="1571.85">opportunity with so many good people</span> <span data-start="1571.85" data-end="1574.88">here say that we are high so with me to</span> <span data-start="1574.88" data-end="1576.44">a lot of challenges have a lot of</span> <span data-start="1576.44" data-end="1578.57">challenges ahead so I recommend this</span> <span data-start="1578.57" data-end="1581.84">take a look at our jobs page and the the</span> <span data-start="1581.84" data-end="1583.7">job ads there are usually a pretty vague</span> <span data-start="1583.7" data-end="1585.32">and open but if you need more detail you</span> <span data-start="1585.32" data-end="1587.36">can just grab me and I can can give you</span> <span data-start="1587.36" data-end="1592.38">more more details and that's it for me</span> </p>
</section>