<section>
<p><span data-start="13.97" data-end="16.65">so you all see this big link on here</span> <span data-start="16.65" data-end="17.91">hopefully you can see it in the back of</span> <span data-start="17.91" data-end="19.8">the room this is just a gotomeeting that</span> <span data-start="19.8" data-end="22.43">will show you guys the code and the</span> <span data-start="22.43" data-end="24.18">slides and stuff that I will be going</span> <span data-start="24.18" data-end="25.59">through this is so you all can hopefully</span> <span data-start="25.59" data-end="27.21">see it because I'm going to be in them</span> <span data-start="27.21" data-end="30.18">for about 25 minutes of this and it</span> <span data-start="30.18" data-end="31.23">might be a little bit on the small side</span> <span data-start="31.23" data-end="32.579">so if you're having trouble seeing the</span> <span data-start="32.579" data-end="34.62">screens feel free to hop into this its</span> <span data-start="34.62" data-end="38.37">tiny URL com / you to dash can dash</span> <span data-start="38.37" data-end="40.05">believe it's gotomeeting just put it in</span> <span data-start="40.05" data-end="42.03">your name and it will pop up go to</span> <span data-start="42.03" data-end="43.8">meeting some of your web developers and</span> <span data-start="43.8" data-end="44.64">saying I don't want to install</span> <span data-start="44.64" data-end="46.59">gotomeeting that's okay I understand</span> <span data-start="46.59" data-end="48.39">that just if you don't mind straining</span> <span data-start="48.39" data-end="50.82">your eyes so thanks for coming out to my</span> <span data-start="50.82" data-end="54.33">talk where I hope that with this one</span> <span data-start="54.33" data-end="56.73">weird way to rewrite closures I can</span> <span data-start="56.73" data-end="59.19">restore your faith in native JavaScript</span> <span data-start="59.19" data-end="62.31">closures the rest of this time don't</span> <span data-start="62.31" data-end="63.96">believe anything I say that is my only</span> <span data-start="63.96" data-end="66.27">caveat so with that before we get into</span> <span data-start="66.27" data-end="67.29">the mind blowing business I'll tell you</span> <span data-start="67.29" data-end="69.15">just a quick little bit about myself I'm</span> </p>
<p><span data-start="69.15" data-end="70.979">Jonathan Martin I work at the big nerd</span> <span data-start="70.979" data-end="73.92">ranch up in Atlanta Georgia and I work</span> <span data-start="73.92" data-end="75.99">as a backing in front end developer and</span> <span data-start="75.99" data-end="77.64">also as an instructor if you happen to</span> <span data-start="77.64" data-end="79.47">be up near the Atlanta campus we'd love</span> <span data-start="79.47" data-end="81.03">to have you we probably have some swag</span> <span data-start="81.03" data-end="83.82">at the end of this talk Todd in myself</span> <span data-start="83.82" data-end="86.22">who also works at big nerd ranch at the</span> <span data-start="86.22" data-end="87.93">front table we will be out at one of the</span> <span data-start="87.93" data-end="89.7">booths or tables out there if you're</span> <span data-start="89.7" data-end="91.409">interested in getting any koozies or</span> <span data-start="91.409" data-end="93.63">nerdy glasses any of that stuff we have</span> <span data-start="93.63" data-end="96.45">it all so everyone nowadays when they</span> <span data-start="96.45" data-end="97.8">talk about JavaScript they talk about</span> <span data-start="97.8" data-end="99.81">scopes and closures as being the big</span> <span data-start="99.81" data-end="101.58">thing that make JavaScript so powerful</span> <span data-start="101.58" data-end="103.409">but really for years people have</span> <span data-start="103.409" data-end="105.09">survived without this memory intensive</span> <span data-start="105.09" data-end="106.94">complication on the JavaScript runtime</span> <span data-start="106.94" data-end="109.5">anytime you need to avoid variable name</span> <span data-start="109.5" data-end="112.11">shadowing or global or any kind of</span> <span data-start="112.11" data-end="114.06">variable name collisions all you needed</span> <span data-start="114.06" data-end="115.86">to do was use unique global variable</span> <span data-start="115.86" data-end="118.26">names maybe you prefix your variable</span> <span data-start="118.26" data-end="120.93">names with some unknown unheard-of</span> <span data-start="120.93" data-end="122.64">function name there's all kinds of</span> <span data-start="122.64" data-end="124.86">techniques people used so the example I</span> <span data-start="124.86" data-end="127.83">give first of all his Fortran Fortran</span> <span data-start="127.83" data-end="130.229">introduced in 1957 that was back when a</span> <span data-start="130.229" data-end="132.06">corrupted computer program probably</span> <span data-start="132.06" data-end="134.159">meant you got mustard or something on</span> <span data-start="134.159" data-end="136.26">your punch card Oh nowadays we don't</span> <span data-start="136.26" data-end="137.849">have that excuse for corrupted program</span> <span data-start="137.849" data-end="140.7">but considering that we still to this</span> <span data-start="140.7" data-end="142.53">day rely on all these super optimized</span> <span data-start="142.53" data-end="145">mouth algorithms that are written in</span> </p>
<p><span data-start="145" data-end="146.5">Tran I'd say they did pretty well</span> <span data-start="146.5" data-end="148.84">without any sort of local variables or</span> <span data-start="148.84" data-end="152.71">closures then x86 assembly 1978 in my</span> <span data-start="152.71" data-end="154.27">opinion one of the first real languages</span> <span data-start="154.27" data-end="155.86">because you could write hello world and</span> <span data-start="155.86" data-end="157.36">other insignificant things like</span> <span data-start="157.36" data-end="159.46">operating systems in it they did all</span> <span data-start="159.46" data-end="161.83">this just fine without any concept of</span> <span data-start="161.83" data-end="163.81">closures or local variables all that's</span> <span data-start="163.81" data-end="165.61">just kind of modern propaganda that gets</span> <span data-start="165.61" data-end="168.76">thrown at us all day even ruby ruby was</span> <span data-start="168.76" data-end="170.92">introduced in 1995 and we all know it</span> <span data-start="170.92" data-end="172.39">really just came as a last ditch effort</span> <span data-start="172.39" data-end="174.58">to save object-oriented programming in</span> <span data-start="174.58" data-end="176.35">the wake of the closure craze well</span> <span data-start="176.35" data-end="178.06">thanks to Ruby object-oriented</span> <span data-start="178.06" data-end="179.83">programming apparently lives on and</span> <span data-start="179.83" data-end="181.959">people still right things with classes</span> <span data-start="181.959" data-end="184.36">instead of closures which is totally the</span> <span data-start="184.36" data-end="186.82">way to do it nowadays but apparently</span> <span data-start="186.82" data-end="189.28">that's frowned upon by Twitter so to the</span> <span data-start="189.28" data-end="190.9">point you don't actually need closures</span> <span data-start="190.9" data-end="192.28">or local variables or any of that</span> <span data-start="192.28" data-end="195.73">nonsense however closures 10 because</span> <span data-start="195.73" data-end="197.23">they were attacked on at the last minute</span> <span data-start="197.23" data-end="198.97">into JavaScript they're slower than a</span> <span data-start="198.97" data-end="201.16">java GUI so we spend most of our time</span> <span data-start="201.16" data-end="203.68">waiting for closures to execute we have</span> <span data-start="203.68" data-end="205.239">the sink called function overhead</span> <span data-start="205.239" data-end="206.709">because it's got to initialize all these</span> <span data-start="206.709" data-end="208.87">variables on a stack all this nonsense</span> <span data-start="208.87" data-end="211.06">attached the functions when really it</span> <span data-start="211.06" data-end="212.29">would be so much faster if we could do</span> <span data-start="212.29" data-end="213.94">this all on the heat all at runtime</span> <span data-start="213.94" data-end="218.14">dynamically so typically when we want to</span> <span data-start="218.14" data-end="219.85">improve these sorts of things we rewrite</span> <span data-start="219.85" data-end="222.13">them so reacts virtual Dom comes to mind</span> <span data-start="222.13" data-end="223.989">it completely rewrote the DOM and</span> <span data-start="223.989" data-end="225.73">completely replaces it so you don't need</span> <span data-start="225.73" data-end="227.769">the Dom anymore and it makes everything</span> <span data-start="227.769" data-end="230.86">so much faster well what if we did the</span> <span data-start="230.86" data-end="232.93">same thing with closures because who</span> <span data-start="232.93" data-end="237.489">here has used the closure who here has</span> <span data-start="237.489" data-end="241.42">used local variables so you guys are</span> <span data-start="241.42" data-end="242.709">probably plaguing ninety-nine point nine</span> <span data-start="242.709" data-end="244.66">percent of your code with this memory</span> <span data-start="244.66" data-end="246.28">intensive complication on the runtime</span> <span data-start="246.28" data-end="248.29">engine it's all nonsense back in the day</span> <span data-start="248.29" data-end="249.76">we just use global variables which</span> <span data-start="249.76" data-end="252.61">really just registers registers are</span> <span data-start="252.61" data-end="253.87">about as fast as you can get it's only</span> <span data-start="253.87" data-end="255.79">one or two machine instructions away so</span> <span data-start="255.79" data-end="257.41">to address the underlying performance</span> <span data-start="257.41" data-end="259.6">problems in JavaScript we just need to</span> <span data-start="259.6" data-end="262.6">replace it entirely ourselves and we're</span> <span data-start="262.6" data-end="264.13">going to rewrite it all by yourself and</span> <span data-start="264.13" data-end="265.69">by the way this will also give us a</span> <span data-start="265.69" data-end="267.61">chance to completely redo the syntax</span> <span data-start="267.61" data-end="269.89">because I mean really who remembers the</span> </p>
<p><span data-start="269.89" data-end="272.35">VAR keyword every time without days</span> <span data-start="272.35" data-end="274.69">hence not-so-subtle products so in the</span> <span data-start="274.69" data-end="277.27">spirit of IE compatibility modes we are</span> <span data-start="277.27" data-end="278.56">going to develop our own</span> <span data-start="278.56" data-end="280">we fill for those clouds your closure</span> <span data-start="280" data-end="282.7">bounds developer friends of ours who are</span> <span data-start="282.7" data-end="284.169">still stuck in all this pure function</span> <span data-start="284.169" data-end="286.419">and Y Combinator propaganda who knows</span> <span data-start="286.419" data-end="287.77">where it came from and we're going to</span> <span data-start="287.77" data-end="290.2">bring them back to the simplicity of</span> <span data-start="290.2" data-end="293.02">global variables and registers all in</span> </p>
<p><span data-start="293.02" data-end="295.18">JavaScript now before we go on this</span> <span data-start="295.18" data-end="296.77">little journey we do have some rules we</span> <span data-start="296.77" data-end="298.12">have to follow otherwise it would just</span> <span data-start="298.12" data-end="300.55">be a free-for-all so any code that is</span> <span data-start="300.55" data-end="302.65">going to be using this polyfill has to</span> <span data-start="302.65" data-end="304.99">do five things first off it is not</span> <span data-start="304.99" data-end="307.24">allowed to use any native local</span> <span data-start="307.24" data-end="309.31">variables it is not allowed to use</span> <span data-start="309.31" data-end="311.26">native local variable assignment or</span> <span data-start="311.26" data-end="314.86">create functions with parameters or any</span> <span data-start="314.86" data-end="316.72">sort arguments now those of you who are</span> <span data-start="316.72" data-end="318.729">used to doing parameters it's really</span> <span data-start="318.729" data-end="320.65">just local variables after all inside</span> <span data-start="320.65" data-end="322.15">the function that get bound to some</span> <span data-start="322.15" data-end="324.55">value so that's the local variable in</span> <span data-start="324.55" data-end="326.11">and of itself will still have slow</span> <span data-start="326.11" data-end="328.15">functions so we're going to nuke all of</span> <span data-start="328.15" data-end="330.729">that you can't do any of that in your</span> <span data-start="330.729" data-end="333.1">coat however the implementation as we</span> <span data-start="333.1" data-end="335.61">will see is allowed to use some of those</span> <span data-start="335.61" data-end="338.41">second you may not attach any data</span> <span data-start="338.41" data-end="341.229">directly to a function object know sort</span> <span data-start="341.229" data-end="343.63">of memoization no cache objects none of</span> <span data-start="343.63" data-end="346.69">that functions are going to be a music</span> <span data-start="346.69" data-end="349.15">or the terminology we'll see as a music</span> <span data-start="349.15" data-end="351.7">function body we are allowed to do a few</span> <span data-start="351.7" data-end="354.19">things we are allowed to access that one</span> <span data-start="354.19" data-end="357.49">weird global variable and then we can</span> <span data-start="357.49" data-end="359.35">use a music function bodies just to wrap</span> <span data-start="359.35" data-end="361.36">around buckets of code again these</span> <span data-start="361.36" data-end="362.919">buckets of code are not allowed to use</span> <span data-start="362.919" data-end="364.51">local variables of any sort or</span> <span data-start="364.51" data-end="366.49">parameters so I call them in music</span> <span data-start="366.49" data-end="367.81">because they don't remember anything</span> <span data-start="367.81" data-end="369.52">about their scoping rules which are</span> <span data-start="369.52" data-end="370.9">built into JavaScript they're not</span> <span data-start="370.9" data-end="373">allowed to do any of that so they will</span> <span data-start="373" data-end="375.07">be a music just buckets of statements</span> <span data-start="375.07" data-end="377.41">and then finally just to make things a</span> <span data-start="377.41" data-end="379.09">little bit shorter for demo you are</span> <span data-start="379.09" data-end="381.01">allowed to use shortcut local variables</span> <span data-start="381.01" data-end="382.84">that will give you access to a few</span> <span data-start="382.84" data-end="384.82">functions as we will see later on</span> <span data-start="384.82" data-end="386.65">because they could just be expanded to</span> <span data-start="386.65" data-end="388.33">the full global variable name some of</span> <span data-start="388.33" data-end="389.77">you may remember this convention if you</span> <span data-start="389.77" data-end="391.78">watch programming with nothing you</span> <span data-start="391.78" data-end="392.889">mentioned at the beginning of the talk</span> <span data-start="392.889" data-end="395.02">so that takes a similar convention where</span> <span data-start="395.02" data-end="397.389">you can use constants just to simplify</span> <span data-start="397.389" data-end="399.01">the code but at the end it can all be</span> <span data-start="399.01" data-end="401.289">collapsed and not even use any sort of</span> <span data-start="401.289" data-end="403.479">local variable names so we're going to</span> <span data-start="403.479" data-end="405.52">do all that so with these rules we're</span> <span data-start="405.52" data-end="406.81">going to make substitutions like this</span> <span data-start="406.81" data-end="409">the first line you see is VAR local</span> <span data-start="409" data-end="411.13">equals some value this is going to be</span> <span data-start="411.13" data-end="412.36">replaced with</span> <span data-start="412.36" data-end="415.06">mysterious function called s as for set</span> <span data-start="415.06" data-end="416.71">it will take in the name of a local</span> <span data-start="416.71" data-end="418.689">variable to which we want to assign and</span> <span data-start="418.689" data-end="422.229">then that value so s will exactly</span> <span data-start="422.229" data-end="423.879">replace the variable assignment we're</span> <span data-start="423.879" data-end="425.8">used to anytime we want to do a lookup</span> <span data-start="425.8" data-end="429.009">we call g which is 4g forget which takes</span> <span data-start="429.009" data-end="430.33">in the name of the local variable and</span> <span data-start="430.33" data-end="432.25">just returns the value in the current</span> <span data-start="432.25" data-end="434.139">scope exactly the same as variable look</span> <span data-start="434.139" data-end="436.12">up and anytime we have a function</span> <span data-start="436.12" data-end="438.34">expression assigned to a variable we</span> <span data-start="438.34" data-end="439.87">will replace all of that with a call to</span> </p>
<p><span data-start="439.87" data-end="442.389">F F takes in the name of the local</span> <span data-start="442.389" data-end="444.009">variable to which we would be assigning</span> <span data-start="444.009" data-end="446.169">this function the list of parameters as</span> <span data-start="446.169" data-end="448.24">an array and then that amnesic function</span> <span data-start="448.24" data-end="450.4">body notice that the function body has</span> <span data-start="450.4" data-end="452.529">no parameters it's not allowed to do</span> <span data-start="452.529" data-end="454.689">this we're just using functions as a way</span> <span data-start="454.689" data-end="458.919">to wrap around a bunch of code so with</span> <span data-start="458.919" data-end="459.969">this in mind we're going to take an</span> <span data-start="459.969" data-end="461.8">example that looks like this this is a</span> <span data-start="461.8" data-end="464.11">canonical example of how closures work</span> <span data-start="464.11" data-end="466.36">in JavaScript in this case we have an</span> <span data-start="466.36" data-end="467.74">outer function which when invoked</span> <span data-start="467.74" data-end="469.509">returns an inner function which when</span> <span data-start="469.509" data-end="472.539">invoked prints out the values of x y and</span> <span data-start="472.539" data-end="475.27">z now the prudent among you will notice</span> <span data-start="475.27" data-end="478.12">that the inner function shadows the x</span> <span data-start="478.12" data-end="480.19">variable of the outer one so if you were</span> <span data-start="480.19" data-end="481.93">to evaluate what that bottom statement</span> <span data-start="481.93" data-end="484.12">would run it would execute outer passing</span> <span data-start="484.12" data-end="486.49">in 1 and 2 and inner passing in three</span> <span data-start="486.49" data-end="488.169">and four and you should get an output of</span> <span data-start="488.169" data-end="491.05">3 comma 2 comma 4 because it prints out</span> </p>
<p><span data-start="491.05" data-end="494.229">X and X is shadowed so the second time</span> <span data-start="494.229" data-end="497.289">we pass in the value of x into the inner</span> <span data-start="497.289" data-end="498.94">function that's going to be what gets</span> <span data-start="498.94" data-end="501.189">printed so remember the output of this</span> <span data-start="501.189" data-end="504.639">should be 3 comma 2 comma 4 and with our</span> <span data-start="504.639" data-end="505.99">little transformation we saw in the last</span> <span data-start="505.99" data-end="507.58">slide we're going to make this look so</span> <span data-start="507.58" data-end="509.08">much better we're going to replace it</span> <span data-start="509.08" data-end="512.74">with this will call our f function or g</span> <span data-start="512.74" data-end="515.589">function in our s function so notice in</span> <span data-start="515.589" data-end="517.149">here there is no reference to native</span> <span data-start="517.149" data-end="518.919">local variables or functions with</span> <span data-start="518.919" data-end="521.409">parameters all we have are those three</span> <span data-start="521.409" data-end="523.69">setter getter and function helpers so</span> <span data-start="523.69" data-end="525.519">bear this in mind as we start developing</span> <span data-start="525.519" data-end="528.22">it because the next step is to in 70</span> <span data-start="528.22" data-end="529.69">lines of code we're going to</span> <span data-start="529.69" data-end="531.55">re-implement this and all will be</span> <span data-start="531.55" data-end="535.24">exposing our that s f and g functions so</span> <span data-start="535.24" data-end="536.26">at this point i'm going to move to</span> <span data-start="536.26" data-end="538.06">something very risky we're going to live</span> <span data-start="538.06" data-end="543.519">code this in them</span> <span data-start="543.529" data-end="545.939">first difficulty we will face is getting</span> <span data-start="545.939" data-end="556.29">this large enough to see I need another</span> <span data-start="556.29" data-end="558.809">screen so if you guys can't read this</span> <span data-start="558.809" data-end="561.24">especially as you get back a few rows go</span> <span data-start="561.24" data-end="562.889">ahead and go a launch up that</span> <span data-start="562.889" data-end="564.839">gotomeeting I know it's a plug-in who</span> <span data-start="564.839" data-end="567.029">wants a plug-in but WebRTC won't work on</span> <span data-start="567.029" data-end="569.309">these firewalls unfortunately so you</span> <span data-start="569.309" data-end="571.41">should be able to follow along then so</span> </p>
<p><span data-start="571.41" data-end="572.819">I'm going to be taking a test driven</span> <span data-start="572.819" data-end="574.86">approach to doing all this which means</span> <span data-start="574.86" data-end="576.629">I've cheated before hand I've written</span> <span data-start="576.629" data-end="578.73">out all these specs which describe this</span> <span data-start="578.73" data-end="580.529">behavior that I want out of this i'm</span> <span data-start="580.529" data-end="583.41">using mocha and chai okay i have not yet</span> <span data-start="583.41" data-end="584.37">been instructed on the proper</span> <span data-start="584.37" data-end="586.649">pronunciation so first off we're going</span> <span data-start="586.649" data-end="588.36">to look at how a scope should work for a</span> <span data-start="588.36" data-end="590.339">global context so whenever you think</span> <span data-start="590.339" data-end="591.99">about scopes we're thinking about local</span> <span data-start="591.99" data-end="594.54">variables back in the days of x86 and</span> <span data-start="594.54" data-end="596.61">fortran all you had was the global scope</span> <span data-start="596.61" data-end="598.199">variables that can be accessed from</span> <span data-start="598.199" data-end="600.48">anywhere in your program so it's very</span> <span data-start="600.48" data-end="602.249">easy to describe these so let me walk</span> <span data-start="602.249" data-end="604.199">you through it first off we have a</span> <span data-start="604.199" data-end="605.55">little bit of setup functionality for</span> <span data-start="605.55" data-end="608.49">every test we create a scope object this</span> <span data-start="608.49" data-end="610.23">scope object is going to be responsible</span> <span data-start="610.23" data-end="611.85">for keeping track of local variables</span> <span data-start="611.85" data-end="614.22">that have been created along with the</span> <span data-start="614.22" data-end="617.1">values that are set to now again here</span> <span data-start="617.1" data-end="619.259">are our shortcut functions which is just</span> <span data-start="619.259" data-end="621.87">mapping s to the set function on scope</span> <span data-start="621.87" data-end="624.48">and G to the get function on scope these</span> <span data-start="624.48" data-end="626.069">are just shortcuts so we're not</span> <span data-start="626.069" data-end="627.72">violating that rule we're taking</span> <span data-start="627.72" data-end="630.209">advantage of rule 5 then our first test</span> <span data-start="630.209" data-end="633.54">which instance it's that a scope which</span> <span data-start="633.54" data-end="635.49">works like a global context should be</span> <span data-start="635.49" data-end="638.1">able to set a variable in this case the</span> <span data-start="638.1" data-end="640.439">variable X to 1 and then with we go to</span> <span data-start="640.439" data-end="642.12">look it up with the G function it should</span> <span data-start="642.12" data-end="644.04">return that same value and if we try to</span> <span data-start="644.04" data-end="645.99">look up a variable that did not exist we</span> <span data-start="645.99" data-end="648.48">should get  back so in fact if</span> <span data-start="648.48" data-end="650.879">we run this spec we should see that it</span> <span data-start="650.879" data-end="652.74">fails well first off it says that scope</span> <span data-start="652.74" data-end="654.749">isn't even defined so first thing we</span> <span data-start="654.749" data-end="657.12">need to do we need to go to find this so</span> <span data-start="657.12" data-end="659.069">let's go over to this other file and I'm</span> <span data-start="659.069" data-end="660.36">just going to use the revealing module</span> <span data-start="660.36" data-end="662.939">pattern to keep things clean so I'm</span> <span data-start="662.939" data-end="666.569">going to create a scoping object and the</span> <span data-start="666.569" data-end="668.819">scope object it's going to expose it so</span> <span data-start="668.819" data-end="669.6">well</span> <span data-start="669.6" data-end="671.19">it's going to expose a constructor</span> <span data-start="671.19" data-end="673.38">called scope and this constructor isn't</span> <span data-start="673.38" data-end="674.67">really going to do anything it's only</span> <span data-start="674.67" data-end="677.04">going to create one instance variable</span> <span data-start="677.04" data-end="678.54">which is going to be underscored dick</span> <span data-start="678.54" data-end="681.6">dick for dictionary so this dictionary</span> <span data-start="681.6" data-end="684.089">is going to map from all local variable</span> <span data-start="684.089" data-end="686.31">names we know about to their values in</span> <span data-start="686.31" data-end="688.709">this particular scope this represents</span> <span data-start="688.709" data-end="691.829">just one scope so we've got that set up</span> <span data-start="691.829" data-end="693.569">let's run the specs now and see what</span> <span data-start="693.569" data-end="697.139">happens now we moved a little bit</span> <span data-start="697.139" data-end="698.639">further cannot read property bind of</span> <span data-start="698.639" data-end="700.139">it's because we don't yet have</span> <span data-start="700.139" data-end="702.839">those get and set functions so let's</span> <span data-start="702.839" data-end="704.459">just go ahead and write those those are</span> <span data-start="704.459" data-end="706.98">pretty easy to write so get as you will</span> <span data-start="706.98" data-end="708.48">recall takes in the name of the local</span> <span data-start="708.48" data-end="710.1">variable we want to look up and returns</span> <span data-start="710.1" data-end="712.829">it so this is a simple property lookup</span> <span data-start="712.829" data-end="714.899">will look up in the dictionary the value</span> <span data-start="714.899" data-end="717.42">by the name of key and set is going to</span> <span data-start="717.42" data-end="720.329">be almost exactly the same set is going</span> <span data-start="720.329" data-end="722.42">to take an icky as well as a value and</span> <span data-start="722.42" data-end="724.47">then instead of returning it it's going</span> <span data-start="724.47" data-end="727.829">to set it to it nothing too unusual here</span> <span data-start="727.829" data-end="730.259">if we run this spec and I keep going to</span> <span data-start="730.259" data-end="732.63">the wrong window if I run it we now see</span> <span data-start="732.63" data-end="735.089">that our first spec which is a scope</span> <span data-start="735.089" data-end="736.8">that works as a global context should</span> <span data-start="736.8" data-end="739.17">work so awesome we have our first spec</span> <span data-start="739.17" data-end="740.639">passing and we have the concept of</span> <span data-start="740.639" data-end="742.17">global context which is not really</span> <span data-start="742.17" data-end="744.3">groundbreaking we've had that since x86</span> </p>
<p><span data-start="744.3" data-end="746.25">Fortran name any other language we had</span> <span data-start="746.25" data-end="749.04">this with registers so let's go a little</span> <span data-start="749.04" data-end="750.81">bit further we'll go to our next set of</span> <span data-start="750.81" data-end="755.79">specs so that was for global context now</span> <span data-start="755.79" data-end="756.99">we're going to enable this for what I</span> <span data-start="756.99" data-end="759.029">call a context so some of you may have</span> <span data-start="759.029" data-end="760.949">done some graphics programming before in</span> <span data-start="760.949" data-end="762.6">graphics programming whenever you want</span> <span data-start="762.6" data-end="765.029">to paint something you typically push on</span> <span data-start="765.029" data-end="766.949">a context you change the stroke maybe</span> <span data-start="766.949" data-end="768.75">the width the color a few other</span> <span data-start="768.75" data-end="771">properties and then you do some work and</span> <span data-start="771" data-end="772.8">then when you're done doing that work</span> <span data-start="772.8" data-end="775.23">you pop the context you do this so that</span> <span data-start="775.23" data-end="776.91">way the parent function that called you</span> <span data-start="776.91" data-end="779.009">doesn't get into any side effects</span> <span data-start="779.009" data-end="780.72">because of all the work that you wanted</span> <span data-start="780.72" data-end="782.639">to do in your own little function so</span> <span data-start="782.639" data-end="784.5">push and pop very often in graphics</span> <span data-start="784.5" data-end="785.759">programming would be called at the</span> <span data-start="785.759" data-end="787.589">boundaries of a function well in</span> </p>
<p><span data-start="787.589" data-end="789.449">JavaScript our functions do exactly that</span> <span data-start="789.449" data-end="792.509">functions act as boundaries between</span> <span data-start="792.509" data-end="795.029">different scopes so before we get to</span> <span data-start="795.029" data-end="796.079">that point we're just going to go ahead</span> <span data-start="796.079" data-end="798.209">and create push and pop functions so</span> <span data-start="798.209" data-end="800.42">notice we have two new aliases here and</span> <span data-start="800.42" data-end="803.37">let's go over and implement those</span> <span data-start="803.37" data-end="805.98">so hopefully now that we've enabled</span> <span data-start="805.98" data-end="807.36">these we should see that we have some</span> <span data-start="807.36" data-end="810">failing specs so it says scope for</span> <span data-start="810" data-end="812.01">context first off it says it cannot read</span> <span data-start="812.01" data-end="813.96">property bind this means that we haven't</span> <span data-start="813.96" data-end="815.46">defined those push and pop methods at</span> <span data-start="815.46" data-end="819.029">all yet so let's fix this will define a</span> <span data-start="819.029" data-end="820.41">push we're not even going to fill out</span> <span data-start="820.41" data-end="822.3">its implementation yet like all good</span> <span data-start="822.3" data-end="823.71">test German developers we want to make</span> <span data-start="823.71" data-end="825.66">sure our tests fail first and take it</span> <span data-start="825.66" data-end="828.18">one step at a time so now that we've got</span> <span data-start="828.18" data-end="831.029">push and pop we should see that some of</span> <span data-start="831.029" data-end="832.2">these tests look a little bit more</span> <span data-start="832.2" data-end="834.3">detailed now because now our setup law</span> <span data-start="834.3" data-end="838.77">can actually run and we have 12 tests</span> <span data-start="838.77" data-end="841.83">passing the first test is that the scope</span> <span data-start="841.83" data-end="843.48">should inherit variables from outer</span> <span data-start="843.48" data-end="846.3">contact sees well obviously at this</span> <span data-start="846.3" data-end="847.62">point we've only done global contact</span> <span data-start="847.62" data-end="849.06">sees so if you were to create a new</span> <span data-start="849.06" data-end="852.24">scope by doing a push that pushes and no</span> <span data-start="852.24" data-end="854.04">op so we're still in the global context</span> <span data-start="854.04" data-end="855.57">so of course we inherit variables from</span> <span data-start="855.57" data-end="858.12">outer contact seas and the last one is a</span> <span data-start="858.12" data-end="859.62">little bit more related to something</span> <span data-start="859.62" data-end="861.63">later on but will want to make sure that</span> <span data-start="861.63" data-end="863.94">one passes as well the first and third</span> <span data-start="863.94" data-end="865.74">tests are failing though it says that it</span> <span data-start="865.74" data-end="867.45">should be able to isolate variables from</span> <span data-start="867.45" data-end="869.55">outer context which means that whenever</span> <span data-start="869.55" data-end="872.79">we supposedly push a new context we're</span> <span data-start="872.79" data-end="875.07">leaking data into the external</span> <span data-start="875.07" data-end="876.93">environment because this at this point</span> <span data-start="876.93" data-end="878.58">we're only dealing with global contacts</span> <span data-start="878.58" data-end="879.99">sees we haven't implemented local</span> <span data-start="879.99" data-end="881.73">contacts ease and then the final one</span> <span data-start="881.73" data-end="883.83">variable shadowing this says that if we</span> <span data-start="883.83" data-end="885.839">have two variables of the same name that</span> <span data-start="885.839" data-end="888.75">if we set the variable by the same name</span> <span data-start="888.75" data-end="890.73">in the interscope it should not override</span> <span data-start="890.73" data-end="892.98">that when we go back to the outer scope</span> <span data-start="892.98" data-end="896.64">this is the isolation part so both of</span> <span data-start="896.64" data-end="899.16">these tests fail so let's go back and</span> <span data-start="899.16" data-end="901.92">actually make these sort of pass we're</span> <span data-start="901.92" data-end="903.839">going to set this dictionary which again</span> <span data-start="903.839" data-end="905.52">is a map from all the local variables in</span> <span data-start="905.52" data-end="907.38">the scope to its value and set it to a</span> <span data-start="907.38" data-end="909.69">brand new object and I'm going to cheat</span> <span data-start="909.69" data-end="911.49">here any time we go to pop of context</span> <span data-start="911.49" data-end="912.93">we'll just set it to a brand new object</span> <span data-start="912.93" data-end="916.56">as well let's see what happens now so we</span> <span data-start="916.56" data-end="918.42">have our first spec passing variables</span> <span data-start="918.42" data-end="920.7">are now isolated but we broke everything</span> <span data-start="920.7" data-end="923.339">else so we've taken a step backwards so</span> <span data-start="923.339" data-end="924.81">at this point we actually have to get</span> <span data-start="924.81" data-end="927.209">into the meat of this whole talk which</span> <span data-start="927.209" data-end="928.86">is going to be how are we going to make</span> <span data-start="928.86" data-end="932.13">scopes that can inherit variables from</span> <span data-start="932.13" data-end="934.11">other scopes because this is essentially</span> <span data-start="934.11" data-end="936.3">what happens enclosures a closure gets a</span> <span data-start="936.3" data-end="937.26">scope and that's go</span> <span data-start="937.26" data-end="939.42">has default values from the external</span> <span data-start="939.42" data-end="941.61">environment but if we go to override it</span> <span data-start="941.61" data-end="944.1">then we don't override the parents value</span> <span data-start="944.1" data-end="945.66">we actually create a new variable in</span> <span data-start="945.66" data-end="948.81">that scope so I use the word inheritance</span> <span data-start="948.81" data-end="950.91">on purpose that should trigger a certain</span> </p>
<p><span data-start="950.91" data-end="952.44">JavaScript concept in our minds and</span> <span data-start="952.44" data-end="953.88">here's where we get to the buzzword</span> <span data-start="953.88" data-end="957.06">prototypes what we want to do is we want</span> <span data-start="957.06" data-end="959.73">to create an object which inherits all</span> <span data-start="959.73" data-end="961.77">the default values from the parent scope</span> <span data-start="961.77" data-end="964.14">or the parent context at this point but</span> <span data-start="964.14" data-end="965.22">be able to override those without</span> <span data-start="965.22" data-end="967.38">influencing the parent the best way to</span> <span data-start="967.38" data-end="969.54">do this is we're going to use Douglas</span> </p>
<p><span data-start="969.54" data-end="970.86">Crockford method of prototypical</span> <span data-start="970.86" data-end="973.65">inheritance so whenever we go to push on</span> <span data-start="973.65" data-end="975.33">a new context instead of setting it to a</span> <span data-start="975.33" data-end="977.01">new object we are going to call a</span> <span data-start="977.01" data-end="978.66">mysterious method we will define called</span> <span data-start="978.66" data-end="981.45">fork dicked this fork dick method will</span> <span data-start="981.45" data-end="983.43">take the current dictionary of local</span> <span data-start="983.43" data-end="985.65">variables and create an object which</span> <span data-start="985.65" data-end="987.42">inherits from it through the prototype</span> <span data-start="987.42" data-end="989.4">chain which means at any time we try to</span> <span data-start="989.4" data-end="992.13">do a lookup for a variable of a name</span> <span data-start="992.13" data-end="993.81">that was in a parent context we'll get</span> <span data-start="993.81" data-end="996.63">it but if we try to set it then we'll</span> <span data-start="996.63" data-end="998.76">get a completely new variable without</span> <span data-start="998.76" data-end="1002.54">changing the parent so now that we're</span> <span data-start="1002.54" data-end="1004.31">calling for dick we should also probably</span> <span data-start="1004.31" data-end="1005.87">do something about pop because right now</span> <span data-start="1005.87" data-end="1007.76">pop is just creating a new object the</span> <span data-start="1007.76" data-end="1009.44">way we'll get around this is we'll take</span> <span data-start="1009.44" data-end="1011.06">a look at the current dictionary and</span> <span data-start="1011.06" data-end="1013.52">then we'll keep track later on with add</span> <span data-start="1013.52" data-end="1015.89">underscore parent will see exactly what</span> <span data-start="1015.89" data-end="1017.66">that means but dunder parent is going to</span> <span data-start="1017.66" data-end="1020.72">remember the object that will existed</span> <span data-start="1020.72" data-end="1023.51">before we pushed so let's go implement</span> <span data-start="1023.51" data-end="1025.64">that method will do it as a private</span> <span data-start="1025.64" data-end="1027.41">looking method so we'll do underscore</span> <span data-start="1027.41" data-end="1029.9">for dick it'll take in no arguments and</span> <span data-start="1029.9" data-end="1031.88">at this point a lot of you may gloss</span> <span data-start="1031.88" data-end="1034.52">over or some of you may be like oh I</span> <span data-start="1034.52" data-end="1036.05">know this pattern it's Douglas Crockford</span> <span data-start="1036.05" data-end="1038">method of prototypical inheritance with</span> <span data-start="1038" data-end="1040.28">a little bit of salt thrown in so we're</span> <span data-start="1040.28" data-end="1041.48">going to create a local variable here</span> <span data-start="1041.48" data-end="1042.8">and just assign it to the current</span> <span data-start="1042.8" data-end="1044.93">dictionary of local variables and then</span> <span data-start="1044.93" data-end="1046.82">we're going to start doing the pattern</span> <span data-start="1046.82" data-end="1049.25">which is we create a donor constructor</span> <span data-start="1049.25" data-end="1051.2">function we're just using this for the</span> <span data-start="1051.2" data-end="1053.27">prototypal chain this function will</span> <span data-start="1053.27" data-end="1055.31">never actually be invoked and then we're</span> <span data-start="1055.31" data-end="1057.02">going to set the prototype property on</span> <span data-start="1057.02" data-end="1059.21">this function to do this we'll use an</span> <span data-start="1059.21" data-end="1061.43">es5 feature which is object or creates</span> <span data-start="1061.43" data-end="1063.38">this does kind of another level of</span> <span data-start="1063.38" data-end="1065.12">inheritance but you could cut this all</span> <span data-start="1065.12" data-end="1067.55">as well it's just this saves me a little</span> <span data-start="1067.55" data-end="1069.74">bit of time so let's call object i'll</span> <span data-start="1069.74" data-end="1070.58">create dick</span> <span data-start="1070.58" data-end="1072.35">we'll set the functions prototype to</span> <span data-start="1072.35" data-end="1075.559">that now we need to set a few methods on</span> <span data-start="1075.559" data-end="1077.39">the prototype let's set the constructor</span> <span data-start="1077.39" data-end="1078.799">just because we're going to be nice</span> <span data-start="1078.799" data-end="1084.679">let's see instructor equals F and then f</span> <span data-start="1084.679" data-end="1086.63">dot prototype we need a way to keep</span> <span data-start="1086.63" data-end="1088.46">track of what the previous dictionary or</span> <span data-start="1088.46" data-end="1090.679">the previous scope was so we're going to</span> <span data-start="1090.679" data-end="1093.019">set that Dunder parent variable to</span> <span data-start="1093.019" data-end="1095.45">dicked that way later on when we go to</span> <span data-start="1095.45" data-end="1097.07">pop we can go back to the previous</span> <span data-start="1097.07" data-end="1100.309">context and then to finish off Douglas</span> </p>
<p><span data-start="1100.309" data-end="1101.6">Crawford's pattern we just need to</span> <span data-start="1101.6" data-end="1103.7">return a function created by that</span> <span data-start="1103.7" data-end="1106.519">constructor so that was quite a lot</span> <span data-start="1106.519" data-end="1107.72">happening let's see if this actually</span> <span data-start="1107.72" data-end="1111.59">works which is why we have specs yes so</span> <span data-start="1111.59" data-end="1113.63">now we have our scope object and it</span> <span data-start="1113.63" data-end="1115.49">works like local contact sees kind of</span> <span data-start="1115.49" data-end="1117.47">like in the graphics idea a push and pop</span> <span data-start="1117.47" data-end="1120.5">now nowhere in your JavaScript code do</span> <span data-start="1120.5" data-end="1122.539">you see calls to push and pop you see</span> <span data-start="1122.539" data-end="1124.97">functions being created so now we're</span> <span data-start="1124.97" data-end="1127.01">going to actually implement that f</span> <span data-start="1127.01" data-end="1128.69">function we saw in the slides earlier</span> <span data-start="1128.69" data-end="1130.789">which will create a function expression</span> <span data-start="1130.789" data-end="1132.86">and assign it to a local variable so</span> <span data-start="1132.86" data-end="1135.409">let's go to our next set of specs will</span> <span data-start="1135.409" data-end="1137.96">disable those for now and we'll go down</span> <span data-start="1137.96" data-end="1141.019">to the next set just down here will call</span> <span data-start="1141.019" data-end="1142.88">these wolf call scopes that act like</span> <span data-start="1142.88" data-end="1145.76">this nested if ease so nested-if is if</span> <span data-start="1145.76" data-end="1147.08">you think about it our whole lot like</span> <span data-start="1147.08" data-end="1149.059">calling push and pop whenever you enter</span> <span data-start="1149.059" data-end="1151.309">a function you immediately get a new</span> <span data-start="1151.309" data-end="1153.139">scope which inherits from its previous</span> <span data-start="1153.139" data-end="1155.149">scope and as soon as you finish</span> <span data-start="1155.149" data-end="1156.889">executing that function and pop up the</span> <span data-start="1156.889" data-end="1159.62">stack then you get the previous scope</span> <span data-start="1159.62" data-end="1162.08">and that's like calling pop so in this</span> <span data-start="1162.08" data-end="1163.669">case we just want to use nicer syntax</span> <span data-start="1163.669" data-end="1165.23">notice that we found rid of push and pop</span> <span data-start="1165.23" data-end="1168.529">and we just have s G and F F is going to</span> <span data-start="1168.529" data-end="1170.21">be a new helper will write called funk</span> <span data-start="1170.21" data-end="1172.22">and then we have a bunch of specs</span> <span data-start="1172.22" data-end="1173.929">describing how this should work let's</span> <span data-start="1173.929" data-end="1175.279">see if this even works to begin with</span> <span data-start="1175.279" data-end="1177.529">well not at all it says cannot read</span> <span data-start="1177.529" data-end="1179.09">property bind we haven't even written</span> <span data-start="1179.09" data-end="1181.49">the funk helper so let's go give this a</span> <span data-start="1181.49" data-end="1187.519">try so recall that the funk helper or F</span> <span data-start="1187.519" data-end="1190.34">for the shorthand is supposed to take in</span> <span data-start="1190.34" data-end="1191.75">the name of the local variable to which</span> <span data-start="1191.75" data-end="1193.34">we want to assign this new function</span> <span data-start="1193.34" data-end="1195.26">expression it takes in a list of the</span> <span data-start="1195.26" data-end="1196.88">parameters by name that normally we</span> <span data-start="1196.88" data-end="1198.26">would put in the function and then in</span> <span data-start="1198.26" data-end="1200.029">between the parentheses and then it</span> <span data-start="1200.029" data-end="1201.83">takes that amnesic function body i'm</span> <span data-start="1201.83" data-end="1203.57">going to call it body here just so it's</span> <span data-start="1203.57" data-end="1204.47">obvious</span> <span data-start="1204.47" data-end="1206.299">that it doesn't have any memory of</span> <span data-start="1206.299" data-end="1208.64">anything else we're basically just using</span> <span data-start="1208.64" data-end="1211.159">functions as a way to get some code into</span> <span data-start="1211.159" data-end="1212.45">this environment but it doesn't remember</span> <span data-start="1212.45" data-end="1214.25">anything about its environment or where</span> <span data-start="1214.25" data-end="1216.59">it was created as it pertains to the</span> <span data-start="1216.59" data-end="1219.409">native scoping mechanism so in here only</span> <span data-start="1219.409" data-end="1221.539">to do a few things first off I know I'm</span> <span data-start="1221.539" data-end="1222.77">going to need to save the value of this</span> <span data-start="1222.77" data-end="1224.419">because we're going to call some methods</span> <span data-start="1224.419" data-end="1227.72">and then what I want to do is I want to</span> <span data-start="1227.72" data-end="1229.61">expose this function that's being</span> <span data-start="1229.61" data-end="1232.039">created as a local variable so I'm</span> <span data-start="1232.039" data-end="1234.5">calling this set and I'll set it to the</span> <span data-start="1234.5" data-end="1236.99">name that was passed in and then I'm</span> <span data-start="1236.99" data-end="1238.94">going to pass it in the function that I</span> <span data-start="1238.94" data-end="1241.22">want to set this local variable to now I</span> <span data-start="1241.22" data-end="1243.409">can't just pass in body if I pass in</span> <span data-start="1243.409" data-end="1245.78">body at this point body doesn't even</span> </p>
<p><span data-start="1245.78" data-end="1247.4">Remember Who its parameters are it</span> <span data-start="1247.4" data-end="1248.539">doesn't remember anything about its</span> <span data-start="1248.539" data-end="1250.22">scope what I really need to be able to</span> <span data-start="1250.22" data-end="1251.809">do is do a little bit of setup</span> <span data-start="1251.809" data-end="1253.88">functionality first in a wrapper</span> <span data-start="1253.88" data-end="1255.799">function and have that wrapper function</span> <span data-start="1255.799" data-end="1258.59">then call our amnesic function body so</span> <span data-start="1258.59" data-end="1260.15">will do exactly that will create a</span> <span data-start="1260.15" data-end="1262.49">function wrapper and in here we're going</span> <span data-start="1262.49" data-end="1264.289">to need to do a few things first off we</span> <span data-start="1264.289" data-end="1266.21">know we'll need to invoke body because</span> <span data-start="1266.21" data-end="1267.83">otherwise our code would never get run</span> <span data-start="1267.83" data-end="1269.84">but then we also need to deal with the</span> <span data-start="1269.84" data-end="1271.94">contacts sees we need to call push to</span> <span data-start="1271.94" data-end="1274.58">get a new workspace and then just below</span> <span data-start="1274.58" data-end="1277.07">it we need to do a pop now for this to</span> <span data-start="1277.07" data-end="1278.63">be really useful we need return values</span> <span data-start="1278.63" data-end="1280.22">so we're going to save off whatever the</span> <span data-start="1280.22" data-end="1282.679">body returned and at the very end return</span> <span data-start="1282.679" data-end="1285.62">that result this is pretty much it</span> <span data-start="1285.62" data-end="1287.299">there's one last thing we haven't done</span> <span data-start="1287.299" data-end="1289.429">though which is params notice we're not</span> <span data-start="1289.429" data-end="1291.89">using it anywhere params gives us that</span> <span data-start="1291.89" data-end="1294.77">list of local variables which get passed</span> <span data-start="1294.77" data-end="1297.44">into a function that's essentially</span> <span data-start="1297.44" data-end="1298.49">function parameters are just a</span> <span data-start="1298.49" data-end="1301.4">convenience on top of it well we want</span> <span data-start="1301.4" data-end="1303.2">that convenience so what we'd like to do</span> <span data-start="1303.2" data-end="1305.09">is after we've gotten a brand new</span> <span data-start="1305.09" data-end="1307.4">context we want to go over every</span> <span data-start="1307.4" data-end="1309.53">parameter and look in the JavaScript</span> <span data-start="1309.53" data-end="1311.27">arguments object that was passed into</span> <span data-start="1311.27" data-end="1313.97">this function rapper oops let's go back</span> <span data-start="1313.97" data-end="1316.309">where we were we want to set every</span> <span data-start="1316.309" data-end="1318.08">single local variable in this new scope</span> <span data-start="1318.08" data-end="1319.82">to all the values that were passing as</span> <span data-start="1319.82" data-end="1321.38">parameters that's going to be a lot of</span> <span data-start="1321.38" data-end="1322.7">code to type here though so I'm going to</span> <span data-start="1322.7" data-end="1324.289">create a little funk a little helper</span> <span data-start="1324.289" data-end="1325.909">this helper will take in an array of</span> <span data-start="1325.909" data-end="1327.83">params and a corresponding array of</span> <span data-start="1327.83" data-end="1329.78">parameter values which is going to be</span> <span data-start="1329.78" data-end="1331.49">arguments and I'm going to use the</span> <span data-start="1331.49" data-end="1333.08">arguments object here that JavaScript</span> <span data-start="1333.08" data-end="1335.419">provides to every function very</span> <span data-start="1335.419" data-end="1337.22">performant I assure you let's go a</span> <span data-start="1337.22" data-end="1338.179">little bit further</span> <span data-start="1338.179" data-end="1340.94">and let's go implement this arts helper</span> <span data-start="1340.94" data-end="1344.33">so we'll do proto scope args and it</span> <span data-start="1344.33" data-end="1345.919">takes in the names of local variables</span> <span data-start="1345.919" data-end="1348.74">along with their values and this is just</span> <span data-start="1348.74" data-end="1350.539">essentially a mass assignment operation</span> <span data-start="1350.539" data-end="1352.039">so we're just going to for loop over all</span> <span data-start="1352.039" data-end="1355.73">the names and then we're going to call</span> <span data-start="1355.73" data-end="1357.35">this thought set for every single one of</span> <span data-start="1357.35" data-end="1361.72">them so I'll names I and then values I</span> <span data-start="1361.72" data-end="1364.07">that was a lot of typing let's see if</span> <span data-start="1364.07" data-end="1368.72">any of this works it passes so now we</span> <span data-start="1368.72" data-end="1371.149">have our closure implementation working</span> <span data-start="1371.149" data-end="1375.139">whenever we build nested-if ease but we</span> <span data-start="1375.139" data-end="1377.029">have one last class and this is probably</span> <span data-start="1377.029" data-end="1378.44">the hardest class to deal with because</span> <span data-start="1378.44" data-end="1379.879">it will completely change our code and</span> <span data-start="1379.879" data-end="1383.09">break all of our assumptions so let's go</span> <span data-start="1383.09" data-end="1386.679">down here to the bottom to the last set</span> <span data-start="1386.679" data-end="1388.7">now if you look in here we've got the</span> <span data-start="1388.7" data-end="1390.289">same SF and G but you'll notice that</span> <span data-start="1390.289" data-end="1393.169">example that I wrote earlier which is</span> <span data-start="1393.169" data-end="1395.36">we're doing in outer function which</span> <span data-start="1395.36" data-end="1396.529">returns an inner function which returns</span> <span data-start="1396.529" data-end="1399.32">the values of x y and z and then we</span> <span data-start="1399.32" data-end="1402.289">invoke that function outside of its</span> <span data-start="1402.289" data-end="1404.029">definition contacts this is where</span> </p>
<p><span data-start="1404.029" data-end="1406.309">JavaScript's idea of closures becomes</span> <span data-start="1406.309" data-end="1408.529">very powerful is a closure remembers its</span> <span data-start="1408.529" data-end="1410.96">definition time scope not at execution</span> <span data-start="1410.96" data-end="1416.299">scope so let's see if this runs it says</span> <span data-start="1416.299" data-end="1418.58">it fails it says that it expected to get</span> <span data-start="1418.58" data-end="1421.909">3 comma 2 comma 4 but instead it got</span> <span data-start="1421.909" data-end="1425.21">three  for so this means that</span> <span data-start="1425.21" data-end="1428.029">somewhere we were accessing a scope we</span> <span data-start="1428.029" data-end="1429.86">didn't expect at least if we were</span> <span data-start="1429.86" data-end="1431.389">thinking this as regular JavaScript in</span> <span data-start="1431.389" data-end="1434.24">fact we made this error earlier if we go</span> <span data-start="1434.24" data-end="1437.36">back to funk look at where this dot push</span> <span data-start="1437.36" data-end="1439.58">is being called we're calling it inside</span> <span data-start="1439.58" data-end="1441.409">the function wrapper which means that</span> <span data-start="1441.409" data-end="1443.96">we're calling this stop push at the same</span> <span data-start="1443.96" data-end="1447.169">time we invoke this body not at the time</span> <span data-start="1447.169" data-end="1449.389">we define this function well recall that</span> <span data-start="1449.389" data-end="1451.19">this stop push is going to look at the</span> <span data-start="1451.19" data-end="1454.909">current scope and pork off of it so this</span> <span data-start="1454.909" data-end="1456.98">means that we're not actually keeping</span> <span data-start="1456.98" data-end="1459.259">track of the scope from when this</span> <span data-start="1459.259" data-end="1460.97">function was defined we're actually</span> <span data-start="1460.97" data-end="1462.919">looking at the scope and forking off of</span> <span data-start="1462.919" data-end="1464.539">it at the time the function is invoked</span> <span data-start="1464.539" data-end="1466.519">this is not at all how javascript</span> <span data-start="1466.519" data-end="1468.98">closures work in javascript it's based</span> <span data-start="1468.98" data-end="1471.19">on where you define the function</span> <span data-start="1471.19" data-end="1474.25">not where it's executed so to fix this</span> <span data-start="1474.25" data-end="1476.59">we kind of the this stop push statement</span> <span data-start="1476.59" data-end="1478.54">up a level we need to move it to the</span> <span data-start="1478.54" data-end="1480.25">time that we call our helper to define</span> <span data-start="1480.25" data-end="1481.96">this function but that's not quite it</span> <span data-start="1481.96" data-end="1483.34">either because as soon as we call this</span> <span data-start="1483.34" data-end="1485.8">not push it will change scope and we</span> <span data-start="1485.8" data-end="1487.48">don't want to change scope until we</span> <span data-start="1487.48" data-end="1489.37">actually execute the code so what we</span> <span data-start="1489.37" data-end="1491.26">really need is a way to keep track of</span> <span data-start="1491.26" data-end="1493.81">what the current scope is at the time</span> <span data-start="1493.81" data-end="1496.48">we're defining this function pre fork it</span> <span data-start="1496.48" data-end="1498.85">and then let that rest for a while you</span> <span data-start="1498.85" data-end="1500.2">need to save it off somewhere so that</span> <span data-start="1500.2" data-end="1501.91">way when this function does it get</span> <span data-start="1501.91" data-end="1504.52">executed it can resurrect that scope by</span> <span data-start="1504.52" data-end="1508.3">doing a scope push well let's just a</span> <span data-start="1508.3" data-end="1510.4">pseudocode this for a little bit will do</span> <span data-start="1510.4" data-end="1513.13">this and we'll suppose that we have some</span> <span data-start="1513.13" data-end="1514.72">way to get the scope for the current</span> <span data-start="1514.72" data-end="1519.4">closure and assuming that we get that</span> <span data-start="1519.4" data-end="1521.2">scope back which is going to be a scope</span> <span data-start="1521.2" data-end="1523.15">object will do fork which is just going</span> <span data-start="1523.15" data-end="1525.55">to be an inheritance now does anyone</span> <span data-start="1525.55" data-end="1526.99">start to feel a little bit uncomfortable</span> <span data-start="1526.99" data-end="1529.9">we're at 50 lines of code we don't have</span> <span data-start="1529.9" data-end="1532.12">this actually working yet and we have a</span> <span data-start="1532.12" data-end="1533.65">lot of functionality in this one scope</span> <span data-start="1533.65" data-end="1536.2">class or revealing module pattern if you</span> <span data-start="1536.2" data-end="1538.69">prefer this makes me uncomfortable we</span> <span data-start="1538.69" data-end="1540.04">have the idea of a scope which is</span> <span data-start="1540.04" data-end="1542.68">supposed to represent just one scope but</span> <span data-start="1542.68" data-end="1543.94">somehow we're supposed to keep track of</span> <span data-start="1543.94" data-end="1545.74">all the Scopes in memory so we can</span> <span data-start="1545.74" data-end="1547.42">assign it to functions that sounds more</span> <span data-start="1547.42" data-end="1550.39">like we need another class maybe so in</span> <span data-start="1550.39" data-end="1553.17">fact let's do that back in our tests I</span> <span data-start="1553.17" data-end="1556.06">preemptively did this we're going to</span> <span data-start="1556.06" data-end="1558.25">create a closure registry this closure</span> <span data-start="1558.25" data-end="1560.11">registry is going to keep track of all</span> <span data-start="1560.11" data-end="1561.97">the scope objects we create any time we</span> <span data-start="1561.97" data-end="1564.52">do a function it will collaborate with</span> <span data-start="1564.52" data-end="1567.19">all these different objects so at the</span> <span data-start="1567.19" data-end="1570.1">very top of our current file we're going</span> <span data-start="1570.1" data-end="1571.87">to create a closure regstrate will use</span> <span data-start="1571.87" data-end="1576.37">the same revealing model pattern so we</span> <span data-start="1576.37" data-end="1578.52">need to return the closure registry and</span> <span data-start="1578.52" data-end="1581.4">then we need to create our constructor</span> <span data-start="1581.4" data-end="1583.51">now this constructor won't take in</span> <span data-start="1583.51" data-end="1585.43">anything right now but it does need to</span> <span data-start="1585.43" data-end="1588.34">keep a registry this registry is going</span> <span data-start="1588.34" data-end="1590.95">to be essentially the entire environment</span> <span data-start="1590.95" data-end="1593.11">of our JavaScript runtime it's going to</span> <span data-start="1593.11" data-end="1595.27">map from all of the current functions</span> <span data-start="1595.27" data-end="1596.65">that have been created to their</span> <span data-start="1596.65" data-end="1598.72">corresponding scope some of you are</span> <span data-start="1598.72" data-end="1599.8">already thinking how are we going to do</span> <span data-start="1599.8" data-end="1601.51">that you can't use a function as a key</span> <span data-start="1601.51" data-end="1604.27">into a variable bear with me so we'll</span> <span data-start="1604.27" data-end="1605.03">set this up</span> <span data-start="1605.03" data-end="1606.56">and we'll need a way to keep track of</span> <span data-start="1606.56" data-end="1608.8">what closure is currently executing</span> <span data-start="1608.8" data-end="1612.68">we'll see just why in a moment so now we</span> <span data-start="1612.68" data-end="1614.36">can start moving some functionality</span> <span data-start="1614.36" data-end="1617.09">around push pop and funk really don't</span> <span data-start="1617.09" data-end="1618.71">belong here they really belong in a</span> <span data-start="1618.71" data-end="1620.24">closure registry because they all deal</span> <span data-start="1620.24" data-end="1624.41">with creating new scopes so let's put</span> <span data-start="1624.41" data-end="1626.78">that up here we don't really know how</span> <span data-start="1626.78" data-end="1628.16">push and pop are going to work in this</span> <span data-start="1628.16" data-end="1631.4">new context yet but we do know how the</span> <span data-start="1631.4" data-end="1633.17">function helper is going to work we'll</span> <span data-start="1633.17" data-end="1634.58">just change this out so its closure</span> <span data-start="1634.58" data-end="1637.82">registry and what we would like to do is</span> <span data-start="1637.82" data-end="1640.04">to implement this scope for current</span> <span data-start="1640.04" data-end="1642.53">closure method and then when we call</span> <span data-start="1642.53" data-end="1644.78">push instead of letting it fork off a</span> <span data-start="1644.78" data-end="1647.21">new scope at runtime we're going to pass</span> <span data-start="1647.21" data-end="1649.19">it in now some of you may be thinking</span> <span data-start="1649.19" data-end="1651.2">he's cheating he's using local variables</span> <span data-start="1651.2" data-end="1653.12">yes you can use local variables in the</span> <span data-start="1653.12" data-end="1655.01">implementation just not in your</span> <span data-start="1655.01" data-end="1657.32">consuming code that would be quite a bit</span> <span data-start="1657.32" data-end="1659.36">more difficult admittedly if not</span> <span data-start="1659.36" data-end="1661.73">impossible i have yet to explore that so</span> <span data-start="1661.73" data-end="1664.04">when we call this stop push will push in</span> <span data-start="1664.04" data-end="1665.74">that scope that we calculated at</span> <span data-start="1665.74" data-end="1667.76">definition time when we call the f</span> <span data-start="1667.76" data-end="1671.24">helper so we've got quite a few things</span> <span data-start="1671.24" data-end="1672.77">we don't really know about we don't know</span> <span data-start="1672.77" data-end="1674.84">how we're going to implement this scope</span> <span data-start="1674.84" data-end="1678.05">for a current closure we don't really</span> <span data-start="1678.05" data-end="1680.15">know how that's going to work yet and we</span> <span data-start="1680.15" data-end="1681.56">don't know how push and pop are going to</span> <span data-start="1681.56" data-end="1684.65">work so now is where we get a chance to</span> <span data-start="1684.65" data-end="1687.05">make a fun little observation whenever</span> <span data-start="1687.05" data-end="1688.76">our javascript is executing there's only</span> <span data-start="1688.76" data-end="1691.49">one scope active at any given time this</span> <span data-start="1691.49" data-end="1693.23">is a single threaded language so</span> <span data-start="1693.23" data-end="1695.48">whenever we enter a function we are</span> <span data-start="1695.48" data-end="1699.02">using the scope for that function seems</span> <span data-start="1699.02" data-end="1701.09">pretty simple so that means that</span> <span data-start="1701.09" data-end="1704.33">whenever we start a new function we push</span> <span data-start="1704.33" data-end="1706.4">on the active scope kind of like</span> <span data-start="1706.4" data-end="1707.96">contacts ease and as soon as that</span> <span data-start="1707.96" data-end="1710.63">function finishes we pop it off what do</span> <span data-start="1710.63" data-end="1713.15">we pop off back to whatever the previous</span> <span data-start="1713.15" data-end="1714.83">function was that called this function</span> <span data-start="1714.83" data-end="1716.63">we can guarantee this because we no</span> <span data-start="1716.63" data-end="1718.4">longer let people arbitrarily call push</span> <span data-start="1718.4" data-end="1720.62">and pop we always ensure that every</span> <span data-start="1720.62" data-end="1722.24">function calls push at the beginning and</span> <span data-start="1722.24" data-end="1724.7">pop at the end that means that we</span> <span data-start="1724.7" data-end="1726.46">actually don't need to keep track of</span> <span data-start="1726.46" data-end="1728.75">every function we've ever created and</span> <span data-start="1728.75" data-end="1731.12">map it to a scope we really just need a</span> <span data-start="1731.12" data-end="1733.52">stack of scopes so I'm going to turn</span> <span data-start="1733.52" data-end="1735.83">registry into an object or excuse me</span> <span data-start="1735.83" data-end="1738.47">into an array and this array is going</span> <span data-start="1738.47" data-end="1740.24">to keep track of what the current scope</span> <span data-start="1740.24" data-end="1743.48">is and all previous scopes at execution</span> <span data-start="1743.48" data-end="1746.78">time so that actually makes some of this</span> <span data-start="1746.78" data-end="1749.48">code a lot easier for example we know</span> <span data-start="1749.48" data-end="1752.63">that with a stack the current item is</span> <span data-start="1752.63" data-end="1754.94">going to be the last item so we'll just</span> <span data-start="1754.94" data-end="1757.64">index into whatever the current scope is</span> <span data-start="1757.64" data-end="1759.799">we'll look at the last item on top and</span> <span data-start="1759.799" data-end="1762.23">return it so now we have scope for</span> <span data-start="1762.23" data-end="1764.72">current closure defined now maybe we can</span> <span data-start="1764.72" data-end="1766.88">go right these push and pop methods</span> <span data-start="1766.88" data-end="1769.34">because push and pop will need to push a</span> <span data-start="1769.34" data-end="1773.12">brand new scope at execution time so</span> <span data-start="1773.12" data-end="1775.85">nowadays push is going to be taking in</span> <span data-start="1775.85" data-end="1778.159">the exact scope so we actually don't</span> <span data-start="1778.159" data-end="1779.6">need all this complicated fort dick</span> <span data-start="1779.6" data-end="1782.059">logic that's all going to be below and</span> <span data-start="1782.059" data-end="1784.46">we don't really need pop you know</span> <span data-start="1784.46" data-end="1786.559">someone might recognize these method</span> <span data-start="1786.559" data-end="1788.39">names and notice that I kind of saved us</span> <span data-start="1788.39" data-end="1790.37">a step push and pop these are methods on</span> <span data-start="1790.37" data-end="1792.08">a standard JavaScript array and they do</span> <span data-start="1792.08" data-end="1794.059">exactly the same thing as what we've</span> <span data-start="1794.059" data-end="1796.19">written here except that push pit takes</span> <span data-start="1796.19" data-end="1799.64">in an item to push so we could write all</span> <span data-start="1799.64" data-end="1800.84">these out in to be a lot of boilerplate</span> <span data-start="1800.84" data-end="1802.909">code but we can actually save ourselves</span> <span data-start="1802.909" data-end="1804.95">a few steps I've written a little helper</span> <span data-start="1804.95" data-end="1806.45">you can go check out the repo which i'll</span> <span data-start="1806.45" data-end="1808.76">post up later which is called delegate</span> <span data-start="1808.76" data-end="1811.19">it takes in a list of functions that</span> <span data-start="1811.19" data-end="1812.75">we'd like to create on the closure</span> <span data-start="1812.75" data-end="1815.809">registry prototype so that excuse me not</span> <span data-start="1815.809" data-end="1822.47">get set push and pop and then it takes</span> <span data-start="1822.47" data-end="1824.78">in a few other arguments it lets us say</span> <span data-start="1824.78" data-end="1827.299">we're to create these functions so i'm</span> <span data-start="1827.299" data-end="1829.94">going to say on the closure registry</span> <span data-start="1829.94" data-end="1832.039">prototype so it's just going to add</span> <span data-start="1832.039" data-end="1834.679">these and then I want it to delegate any</span> <span data-start="1834.679" data-end="1837.049">calls to those straight on to whatever</span> <span data-start="1837.049" data-end="1838.82">the current closure excuse me to</span> <span data-start="1838.82" data-end="1840.89">whatever the current scope is so call</span> <span data-start="1840.89" data-end="1844.37">this dot scope for current closure and</span> <span data-start="1844.37" data-end="1846.71">return that so again delegate is</span> <span data-start="1846.71" data-end="1848.299">basically just creating push and pop</span> <span data-start="1848.299" data-end="1850.159">methods for us on the closure registry</span> <span data-start="1850.159" data-end="1851.9">prototype but it just delegates to</span> <span data-start="1851.9" data-end="1853.94">whatever the current scope is which is</span> <span data-start="1853.94" data-end="1856.52">what is on top of the registry now</span> <span data-start="1856.52" data-end="1857.72">there's one other thing we haven't done</span> <span data-start="1857.72" data-end="1859.4">here we're still in our funk</span> <span data-start="1859.4" data-end="1861.5">implementation we're calling set and</span> <span data-start="1861.5" data-end="1864.62">args we're calling it on this which is</span> <span data-start="1864.62" data-end="1866.419">the closure registry it doesn't actually</span> <span data-start="1866.419" data-end="1868.309">have access to these methods yet they're</span> <span data-start="1868.309" data-end="1870.47">back on the scope well instead of</span> <span data-start="1870.47" data-end="1871.97">copying those over</span> <span data-start="1871.97" data-end="1873.35">be running an implementation here i'm</span> <span data-start="1873.35" data-end="1874.76">going to make use of my little delegate</span> <span data-start="1874.76" data-end="1877.22">helper again i'm going to delegate any</span> <span data-start="1877.22" data-end="1883.1">calls to get set and args straight on to</span> <span data-start="1883.1" data-end="1887.84">the registry and that should work so now</span> <span data-start="1887.84" data-end="1889.85">whenever someone in close your registry</span> <span data-start="1889.85" data-end="1891.95">tries to call get set or args it'll just</span> </p>
<p><span data-start="1891.95" data-end="1893.57">Selig eight straight on to whatever the</span> <span data-start="1893.57" data-end="1898.04">current closure is so this looks really</span> <span data-start="1898.04" data-end="1901.54">really close let's see if it runs now</span> <span data-start="1901.54" data-end="1903.89">cannot read property fork of</span> <span data-start="1903.89" data-end="1905.9">well we had one other thing we forgot to</span> <span data-start="1905.9" data-end="1907.97">do so this means that scope for current</span> <span data-start="1907.97" data-end="1909.68">closure is at some point returning</span> <span data-start="1909.68" data-end="1911.51">when we invoke it we don't</span> <span data-start="1911.51" data-end="1913.1">want that that's going to be problematic</span> <span data-start="1913.1" data-end="1915.62">that's because we start out our idea of</span> <span data-start="1915.62" data-end="1918.44">scopes and closures without a global</span> <span data-start="1918.44" data-end="1920.96">scope notice that the registry stack</span> <span data-start="1920.96" data-end="1922.97">step starts out empty what we need to</span> <span data-start="1922.97" data-end="1925.19">fix that all we need to do then is a day</span> <span data-start="1925.19" data-end="1927.05">starting condition which is going to be</span> <span data-start="1927.05" data-end="1929.42">to create a brand new scope and this is</span> <span data-start="1929.42" data-end="1931.94">going to be our global scope just to</span> <span data-start="1931.94" data-end="1933.95">start things off so we have a place to</span> <span data-start="1933.95" data-end="1935.45">attach all these function bodies later</span> <span data-start="1935.45" data-end="1937.7">on so we look really close to being done</span> <span data-start="1937.7" data-end="1940.07">but well we kind of reference this fork</span> <span data-start="1940.07" data-end="1941.54">function without defining it somehow I</span> <span data-start="1941.54" data-end="1943.46">think that's going to be problematic so</span> <span data-start="1943.46" data-end="1944.93">let's go on a little bit further and</span> <span data-start="1944.93" data-end="1947.51">just write this last method scope for</span> <span data-start="1947.51" data-end="1949.67">takes in no arguments and all it will do</span> <span data-start="1949.67" data-end="1951.29">is it's going to create a brand new</span> <span data-start="1951.29" data-end="1953.18">scope object so it is a constructor</span> <span data-start="1953.18" data-end="1957.95">absorbs and initialize it to a</span> <span data-start="1957.95" data-end="1960.56">dictionary using fork dicked so this</span> <span data-start="1960.56" data-end="1962.84">just returns a brand new scope object</span> <span data-start="1962.84" data-end="1965.21">whose dictionary of local variables</span> <span data-start="1965.21" data-end="1968.84">inherits from this current scope but of</span> <span data-start="1968.84" data-end="1970.37">course our scope instructor doesn't take</span> <span data-start="1970.37" data-end="1972.77">in a default dictionary so we'll have to</span> <span data-start="1972.77" data-end="1973.97">do something like this so it can be</span> <span data-start="1973.97" data-end="1976.16">taken in that was a lot of code let's</span> <span data-start="1976.16" data-end="1983">see if it works nope not quite yet let's</span> <span data-start="1983" data-end="1986.03">see what we did wrong this dot</span> <span data-start="1986.03" data-end="1992.93">underscore registry dot length thank you</span> <span data-start="1992.94" data-end="1994.9">alright let's see what's going on now</span> <span data-start="1994.9" data-end="1997.33">cannot read property apply of</span> <span data-start="1997.33" data-end="2001.02">let's see where our other issue is no</span> <span data-start="2001.02" data-end="2004.26">changes there do this Scott registry</span> <span data-start="2004.26" data-end="2007.92">that looks correct let's go for current</span> <span data-start="2007.92" data-end="2011.64">closure that looks fine when in doubt</span> <span data-start="2011.64" data-end="2024.18">check get</span> <span data-start="2024.19" data-end="2027.19">there's the issue</span> </p>
<p><span data-start="2027.2" data-end="2035.84">I swap these up a little bit</span> <span data-start="2035.85" data-end="2039.48">it runs so in let's see how many lines</span> <span data-start="2039.48" data-end="2044.4">of code this was 68 lines of code so in</span> <span data-start="2044.4" data-end="2047.46">less than 70 in 68 lines of code and you</span> <span data-start="2047.46" data-end="2049.59">can actually trim this down to 67 we</span> <span data-start="2049.59" data-end="2051.09">have our own implementation of local</span> <span data-start="2051.09" data-end="2053.7">variables enclosures in JavaScript so</span> <span data-start="2053.7" data-end="2055.98">you too can do this now some of you may</span> <span data-start="2055.98" data-end="2058.23">be asking can I actually use this where</span> <span data-start="2058.23" data-end="2059.639">would I go to use this and how can I</span> <span data-start="2059.639" data-end="2061.679">mass convert all my code over to use</span> <span data-start="2061.679" data-end="2063.179">this much more performant version of</span> <span data-start="2063.179" data-end="2065.159">closures well there's a transpiler for</span> <span data-start="2065.159" data-end="2067.8">it go to github github.com / nibbler</span> <span data-start="2067.8" data-end="2070.98">that's six continents / closures and you</span> <span data-start="2070.98" data-end="2073.47">can go try this particular demo online</span> <span data-start="2073.47" data-end="2075.33">where you drop in any code that use</span> <span data-start="2075.33" data-end="2077.22">variable assignments and lookups or</span> <span data-start="2077.22" data-end="2078.75">function assignments and we'll convert</span> <span data-start="2078.75" data-end="2081.09">it over to the appropriate code which</span> <span data-start="2081.09" data-end="2083.85">uses f SN g yes this is a transpiler it</span> <span data-start="2083.85" data-end="2086.34">is not doing regular expression math</span> <span data-start="2086.34" data-end="2088.5">substitutions so this should generate</span> <span data-start="2088.5" data-end="2090.69">usable code if you don't hit any of the</span> <span data-start="2090.69" data-end="2092.46">edge conditions that i explicitly mark</span> <span data-start="2092.46" data-end="2095.07">out so your next question may be should</span> <span data-start="2095.07" data-end="2097.38">i actually use this well javascript and</span> <span data-start="2097.38" data-end="2098.91">java script is a great way to get</span> <span data-start="2098.91" data-end="2100.38">brownie points with your next employer</span> <span data-start="2100.38" data-end="2101.7">so next time you're thinking about</span> <span data-start="2101.7" data-end="2103.56">writing some uninteresting legacy code</span> <span data-start="2103.56" data-end="2105.63">at your next job just so you can flee</span> <span data-start="2105.63" data-end="2107.82">from it later on drop in your own</span> <span data-start="2107.82" data-end="2109.53">implementation of closures and you'll</span> <span data-start="2109.53" data-end="2113.25">have guaranteed job security and then</span> <span data-start="2113.25" data-end="2114.78">your final question may really be is</span> <span data-start="2114.78" data-end="2116.16">this the future of performance</span> </p>
<p><span data-start="2116.16" data-end="2118.38">JavaScript and this is the first step</span> <span data-start="2118.38" data-end="2119.73">the next step is going to be to</span> <span data-start="2119.73" data-end="2121.98">re-implement prototypes with closures at</span> <span data-start="2121.98" data-end="2124.2">which point we'll get an even faster</span> <span data-start="2124.2" data-end="2127.35">tick in our benchmarks and the idea is</span> <span data-start="2127.35" data-end="2130.56">to use eval scripts to get this working</span> <span data-start="2130.56" data-end="2133.25">and I think the other one was to</span> <span data-start="2133.25" data-end="2135.57">completely drop out prototypes and we're</span> <span data-start="2135.57" data-end="2136.74">going to do that which is plain old</span> <span data-start="2136.74" data-end="2138.27">closures which are evaluating a script</span> <span data-start="2138.27" data-end="2140.25">so totally we're just going to swap out</span> <span data-start="2140.25" data-end="2141.75">these two concepts because prototypes</span> <span data-start="2141.75" data-end="2143.22">are faster closures and closures are</span> <span data-start="2143.22" data-end="2145.53">faster at prototypes so with that I</span> <span data-start="2145.53" data-end="2147.359">think you have all you need to make your</span> <span data-start="2147.359" data-end="2177.89">code much more performant thanks guys</span> </p>
</section>