<section>
<p><span data-start="34.57" data-end="37.45">or just exciting thing about gaming it</span> <span data-start="37.45" data-end="39.01">was really fun so we're going to keep</span> <span data-start="39.01" data-end="40.87">the fun rolling with an in-depth look at</span> <span data-start="40.87" data-end="41.92">part of the web application</span> <span data-start="41.92" data-end="44.5">specification so I'm just going to dive</span> <span data-start="44.5" data-end="47.68">straight into that so back in the days</span> <span data-start="47.68" data-end="49.78">of dial-up we were at peace with the</span> <span data-start="49.78" data-end="50.949">internet being this temporary thing</span> <span data-start="50.949" data-end="53.559">right we would log in we would check our</span> <span data-start="53.559" data-end="55.39">email and we would log out and we were</span> <span data-start="55.39" data-end="57.16">cool with that but now we're almost</span> <span data-start="57.16" data-end="59.98">always online we carry devices with us</span> <span data-start="59.98" data-end="61.629">that I've always have an internet</span> <span data-start="61.629" data-end="63.85">connection and because of that that that</span> <span data-start="63.85" data-end="65.379">means being with outer connection</span> <span data-start="65.379" data-end="67.27">becomes a much more of a deal in it than</span> <span data-start="67.27" data-end="69.07">it used to be our speaking to a few</span> <span data-start="69.07" data-end="70.63">people who are not from the states and</span> <span data-start="70.63" data-end="72.759">they don't have mobile data here an L</span> <span data-start="72.759" data-end="74.86">know what I'm all about when I'm data</span> <span data-start="74.86" data-end="77.38">roaming I feel like a like a gambling</span> <span data-start="77.38" data-end="79.78">addict I know every time I connect that</span> </p>
<p><span data-start="79.78" data-end="82.42">I'm hemorrhaging money but I can't help</span> <span data-start="82.42" data-end="84.19">myself I'm kind of worrying what the</span> <span data-start="84.19" data-end="85.42">Internet's doing behind my back like</span> <span data-start="85.42" data-end="87.1">it's some kind of untrustworthy partner</span> <span data-start="87.1" data-end="90.22">or a party that I'm not invited to I but</span> <span data-start="90.22" data-end="91.869">my phone makes this little beeping sound</span> <span data-start="91.869" data-end="93.429">when I date a room is a kind of warning</span> <span data-start="93.429" data-end="95.08">but I almost don't need it because I can</span> <span data-start="95.08" data-end="96.789">almost hear the champagne corks popping</span> <span data-start="96.789" data-end="98.44">in the tmobile offices with every</span> <span data-start="98.44" data-end="100.509">megabyte I eat like I connect to the</span> <span data-start="100.509" data-end="102.759">internet they go out and buy a car I'm</span> <span data-start="102.759" data-end="105.13">I'm disgusted by my own dependency on</span> <span data-start="105.13" data-end="107.74">data where I a place i used to work this</span> <span data-start="107.74" data-end="110.38">happened about six months ago I needed</span> <span data-start="110.38" data-end="112.75">to go to the toilet for a dump which is</span> <span data-start="112.75" data-end="114.7">a thing I do now there were five</span> <span data-start="114.7" data-end="116.71">cubicles to choose from and that this</span> <span data-start="116.71" data-end="119.14">one instance the first four were</span> <span data-start="119.14" data-end="122.2">occupied that's usually okay because I</span> <span data-start="122.2" data-end="124.09">tend to only use one toilet at a time in</span> <span data-start="124.09" data-end="126.729">this as an extreme circumstances by knew</span> <span data-start="126.729" data-end="128.92">from personal experience that the office</span> </p>
<p><span data-start="128.92" data-end="131.26">Wi-Fi only stretched to the first floor</span> <span data-start="131.26" data-end="132.94">cubicles</span> <span data-start="132.94" data-end="135.25">and there's no mobile data there either</span> <span data-start="135.25" data-end="137.79">and I fought for a moment in the sport</span> <span data-start="137.79" data-end="141.46">no not good enough I find this totally</span> <span data-start="141.46" data-end="143.05">unacceptable and I turned around and I</span> <span data-start="143.05" data-end="144.31">went back to my desk and I sat down and</span> <span data-start="144.31" data-end="146.17">I waited until later and that's when it</span> <span data-start="146.17" data-end="148">dawned on me that I have now become a</span> <span data-start="148" data-end="150.04">human being that requires an internet</span> <span data-start="150.04" data-end="154.72">connection to go to the toilet what can</span> <span data-start="154.72" data-end="155.86">we do to fix this well obviously we</span> <span data-start="155.86" data-end="157.33">can't create data out of nowhere but we</span> <span data-start="157.33" data-end="159.76">can't make our sites work offline and</span> <span data-start="159.76" data-end="161.05">let users use pre downloaded a</span> <span data-start="161.05" data-end="165.07">downloaded data in new ways browsers</span> <span data-start="165.07" data-end="167.68">have historically required an internet</span> <span data-start="167.68" data-end="169.21">connection to work they've had a cache</span> <span data-start="169.21" data-end="171.4">they've had a cash for like forever but</span> <span data-start="171.4" data-end="173.41">maybe the user or the developer has</span> <span data-start="173.41" data-end="175.12">enough control over that cash to create</span> <span data-start="175.12" data-end="177.07">a reliable offline experience Google</span> <span data-start="177.07" data-end="178.24">weren't happy with this and they created</span> <span data-start="178.24" data-end="179.8">local server as part of the gears API</span> <span data-start="179.8" data-end="182.26">that let you create stores of data heat</span> <span data-start="182.26" data-end="183.64">against URLs and that would be available</span> <span data-start="183.64" data-end="186.13">offline as you can see that's no longer</span> <span data-start="186.13" data-end="187.75">available Google gears is no longer</span> <span data-start="187.75" data-end="188.95">active that's because most of the ideas</span> <span data-start="188.95" data-end="190.72">were taken on by the web applications</span> <span data-start="190.72" data-end="192.46">group the offline stuff was reimagined</span> <span data-start="192.46" data-end="195.19">as offline web applications and therein</span> <span data-start="195.19" data-end="196.78">lies the application cache and that's</span> <span data-start="196.78" data-end="198.61">going to be a sort of anti hero of this</span> <span data-start="198.61" data-end="201.489">talk now the application cache is like a</span> <span data-start="201.489" data-end="204.01">candidate from The Apprentice now I</span> <span data-start="204.01" data-end="205.3">don't know if you guys get the UK</span> <span data-start="205.3" data-end="206.83">version here if not you're probably</span> <span data-start="206.83" data-end="207.82">wondering why I've shown you a picture</span> <span data-start="207.82" data-end="210.58">of a shaved head hog who looks like he's</span> <span data-start="210.58" data-end="212.14">suffering from ingrowing spines this is</span> <span data-start="212.14" data-end="213.76">this is Sir Alan Sugar he's a boss in</span> <span data-start="213.76" data-end="216.04">the UK version of The Apprentice the US</span> <span data-start="216.04" data-end="218.35">tends to do TV better than UK but I</span> <span data-start="218.35" data-end="219.76">promise you that this this man is much</span> <span data-start="219.76" data-end="221.769">more bearable than the u.s. equivalent</span> </p>
<p><span data-start="221.769" data-end="224.98">Donald Trump whose hair along just looks</span> <span data-start="224.98" data-end="226.81">like a cloud of piss that's lodged</span> <span data-start="226.81" data-end="229.12">itself the top of a ragged sex doll you</span> <span data-start="229.12" data-end="232.3">know but the application cache is more</span> <span data-start="232.3" data-end="234.91">like one of the candidates of the</span> <span data-start="234.91" data-end="236.29">apprentice you know that when they're</span> <span data-start="236.29" data-end="237.459">interviewed they are incredibly</span> <span data-start="237.459" data-end="239.14">confident they're really good at selling</span> <span data-start="239.14" data-end="240.97">themselves they'll turn to the camera</span> <span data-start="240.97" data-end="242.5">look at directly in the lens and they'll</span> <span data-start="242.5" data-end="244.15">say I'm going to turn your offline</span> <span data-start="244.15" data-end="247.209">experience from sucks ass to success and</span> <span data-start="247.209" data-end="249.82">and when they're given the task they'll</span> <span data-start="249.82" data-end="251.29">definitely try and take over the</span> <span data-start="251.29" data-end="252.94">operation trampling over everything else</span> <span data-start="252.94" data-end="254.739">just to try and get noticed they'll get</span> <span data-start="254.739" data-end="257.049">the job done in a manner of speaking but</span> <span data-start="257.049" data-end="259.269">you're left with this loud horrible</span> <span data-start="259.269" data-end="261.4">business douchebag at the sensor at all</span> <span data-start="261.4" data-end="263.47">and we have to be very careful as</span> <span data-start="263.47" data-end="264.729">developers to hide all of that</span> <span data-start="264.729" data-end="266.32">douchebaggery from the end-user I'm</span> <span data-start="266.32" data-end="266.72">going to</span> <span data-start="266.72" data-end="270.05">how you go about doing that when you</span> <span data-start="270.05" data-end="271.25">make a site work offline with</span> <span data-start="271.25" data-end="273.29">application cache how you do it depends</span> <span data-start="273.29" data-end="275.3">on the kind of site it is and the two</span> <span data-start="275.3" data-end="276.23">extremes we're going to look at our</span> <span data-start="276.23" data-end="278.24">sites that tend towards doing stuff with</span> <span data-start="278.24" data-end="279.92">content insights that tend towards</span> <span data-start="279.92" data-end="283.22">getting content in terms of get stuff</span> <span data-start="283.22" data-end="285.59">sites things like Wikipedia travel site</span> </p>
<p><span data-start="285.59" data-end="288.68">YouTube Twitter these are sites with a</span> <span data-start="288.68" data-end="290.69">lot of content and as the user you'll go</span> <span data-start="290.69" data-end="293.03">and find a bit of content and look at it</span> <span data-start="293.03" data-end="294.77">the heavy lifting tends to be done on</span> <span data-start="294.77" data-end="297.23">the server and they should have lots of</span> <span data-start="297.23" data-end="300.02">hopefully meaningful URLs not all of</span> <span data-start="300.02" data-end="302.66">these do alternatively do stuff sites</span> <span data-start="302.66" data-end="305.15">things like Google Docs linters and</span> <span data-start="305.15" data-end="308.48">validators games online IDs these sites</span> <span data-start="308.48" data-end="310.22">offer a relatively small amount of</span> <span data-start="310.22" data-end="311.57">content themselves but you can do a lot</span> <span data-start="311.57" data-end="313.16">with that content or you can use them to</span> <span data-start="313.16" data-end="314.78">create your own content the heavy</span> <span data-start="314.78" data-end="316.67">lifting in these cases tends to be done</span> <span data-start="316.67" data-end="317.93">on the clients or could be done on the</span> <span data-start="317.93" data-end="320.18">client and they tend to have fewer URLs</span> <span data-start="320.18" data-end="322.16">this is the case that app cache was</span> <span data-start="322.16" data-end="324.56">designed for but as well see the app</span> <span data-start="324.56" data-end="326.09">cache specification is like an onion</span> <span data-start="326.09" data-end="328.13">peeling through it can reduce a grown</span> <span data-start="328.13" data-end="329.87">developer to tears or at least that's</span> <span data-start="329.87" data-end="332">what happened to me we're going to look</span> <span data-start="332" data-end="334.34">at off lining a do stuff sites like to</span> <span data-start="334.34" data-end="336.53">start with now I realize I've just taken</span> <span data-start="336.53" data-end="340.25">the word offline and verb ified it in in</span> <span data-start="340.25" data-end="341.69">fact I just took the word verb and verba</span> <span data-start="341.69" data-end="344.03">find it and the problem here is it's not</span> <span data-start="344.03" data-end="345.86">really a good verb for making a site</span> <span data-start="345.86" data-end="347.54">work offline so I've taken some verbal</span> <span data-start="347.54" data-end="349.22">shortcut but I'm told that it's good to</span> <span data-start="349.22" data-end="350.87">try and explain something using your own</span> <span data-start="350.87" data-end="352.82">words and these ones aren't even in the</span> <span data-start="352.82" data-end="354.14">dictionary so I should get bonus points</span> </p>
<p><span data-start="354.14" data-end="356.21">I think so with that in mind we're gonna</span> <span data-start="356.21" data-end="358.66">look at offline arising sprite Cal com</span> <span data-start="358.66" data-end="362.39">which is a sprite cows the only useful</span> <span data-start="362.39" data-end="364.25">thing I ever built I'm not like Remy and</span> <span data-start="364.25" data-end="365.54">check out a new thing every couple of</span> <span data-start="365.54" data-end="368.75">months what you do is you give it a CSS</span> <span data-start="368.75" data-end="370.94">sprite sheet you load that in this it's</span> <span data-start="370.94" data-end="372.74">just a test image you click a bit of it</span> <span data-start="372.74" data-end="375.32">it gives you the CSS for that that part</span> <span data-start="375.32" data-end="377.81">of the image it's one HTML page all the</span> <span data-start="377.81" data-end="379.34">processing is done client-side all the</span> <span data-start="379.34" data-end="381.2">server does this serve the assets this</span> <span data-start="381.2" data-end="383.3">is a live demo running inside Chrome so</span> <span data-start="383.3" data-end="386.05">if I were to cut the connection and</span> <span data-start="386.05" data-end="389.66">refresh the page it doesn't work we get</span> <span data-start="389.66" data-end="391.01">some of the files and not all of them</span> <span data-start="391.01" data-end="392.33">and that's because they we can't rely on</span> <span data-start="392.33" data-end="393.86">the cash that's a shame cuz it'd be nice</span> <span data-start="393.86" data-end="395.12">to be able to use sprite cow on the</span> <span data-start="395.12" data-end="397.19">plane on the train I I shouldn't need an</span> <span data-start="397.19" data-end="398.51">interconnect internet connection to make</span> <span data-start="398.51" data-end="399.919">it work so let's let's go about fixing</span> <span data-start="399.919" data-end="400.99">that</span> <span data-start="400.99" data-end="403.58">to make this site work offline we take</span> <span data-start="403.58" data-end="405.319">the HTML element to the page and we</span> <span data-start="405.319" data-end="406.88">point out a manifest using this this</span> <span data-start="406.88" data-end="409.13">manifest attribute now fortunately this</span> <span data-start="409.13" data-end="411.319">is at the manifest file it's not XML</span> <span data-start="411.319" data-end="412.729">we've managed to get over that whole</span> <span data-start="412.729" data-end="415.22">thing unfortunately it's a custom baked</span> <span data-start="415.22" data-end="418.009">format it starts off with cache manifest</span> <span data-start="418.009" data-end="420.11">in huge capital letters which is kind of</span> <span data-start="420.11" data-end="421.699">warning sign because that's the you're</span> <span data-start="421.699" data-end="423.229">quite a douchebag thing to do to shout</span> <span data-start="423.229" data-end="426.11">your own name in capital letters but but</span> <span data-start="426.11" data-end="427.789">but after that just list the files that</span> <span data-start="427.789" data-end="429.44">you want that form part of your site</span> <span data-start="429.44" data-end="432.139">your co CSS your JavaScript any of your</span> <span data-start="432.139" data-end="433.91">assets images fonts favicon on all of</span> <span data-start="433.91" data-end="436.16">those things all these URLs are relative</span> <span data-start="436.16" data-end="438.02">to the manifest itself but you can also</span> <span data-start="438.02" data-end="440.539">include absolute URLs make that the rule</span> <span data-start="440.539" data-end="442.37">is you can't cross the schemes if your</span> <span data-start="442.37" data-end="445.16">page is https you can only include HTTPS</span> </p>
<p><span data-start="445.16" data-end="447.53">URLs you'll notice like the HTML page</span> <span data-start="447.53" data-end="449.419">itself isn't listed here that's because</span> <span data-start="449.419" data-end="451.22">any page that points out and manifest</span> <span data-start="451.22" data-end="453.5">implicitly becomes part of that cash and</span> <span data-start="453.5" data-end="455.18">you need to make sure you serve the</span> <span data-start="455.18" data-end="457.159">manifest with the content-type text /</span> <span data-start="457.159" data-end="459.229">cache manifest that's that is going to</span> <span data-start="459.229" data-end="460.37">be dropped from the specification that</span> <span data-start="460.37" data-end="462.47">decided that shouldn't really matter but</span> <span data-start="462.47" data-end="464.03">the current implementations require it</span> <span data-start="464.03" data-end="466.789">so you need that for the moment and with</span> <span data-start="466.789" data-end="469.31">that small little change I can now go</span> <span data-start="469.31" data-end="471.83">and cut the connection and refresh</span> <span data-start="471.83" data-end="473.84">refresh the patient but it still works</span> <span data-start="473.84" data-end="475.34">so that now works without without a</span> <span data-start="475.34" data-end="478.36">connection and that was relatively easy</span> <span data-start="478.36" data-end="480.53">the browser support for that is really</span> <span data-start="480.53" data-end="482.57">good as well so the desktop browsers</span> <span data-start="482.57" data-end="484.039">they've supported it for a while all</span> <span data-start="484.039" data-end="485.75">that transitions not working Paul Irish</span> <span data-start="485.75" data-end="487.07">needs to fix chrome wherever he is</span> <span data-start="487.07" data-end="489.71">anyway the mobile device we were hearing</span> <span data-start="489.71" data-end="490.789">before that it doesn't work on some</span> <span data-start="490.789" data-end="492.05">mobile devices that's not being my</span> <span data-start="492.05" data-end="494.18">experience it's the be support for quite</span> <span data-start="494.18" data-end="496.669">a while ironing out the bugs the the bug</span> <span data-start="496.669" data-end="498.949">that you heard about there with airplane</span> <span data-start="498.949" data-end="501.259">mode I've seen that but oddly enough it</span> <span data-start="501.259" data-end="502.909">seems to only exist in airplane mode a</span> <span data-start="502.909" data-end="504.53">lot of these things will work offline</span> <span data-start="504.53" data-end="505.699">when the phone just doesn't have a</span> <span data-start="505.699" data-end="507.289">connection or sometimes after a couple</span> <span data-start="507.289" data-end="508.82">of refreshes they'll pick it up tend to</span> <span data-start="508.82" data-end="510.229">see that on all the blackberries I am</span> </p>
<p><span data-start="510.229" data-end="512.27">Android my android phone it works fine</span> <span data-start="512.27" data-end="513.919">on the Android ahead before it works</span> <span data-start="513.919" data-end="516.409">fine unfortunately there's no support in</span> <span data-start="516.409" data-end="518.81">internet explorer and that means no</span> <span data-start="518.81" data-end="520.61">support windows mobile either although</span> <span data-start="520.61" data-end="523.52">it does work in IE 10 platform preview</span> <span data-start="523.52" data-end="525.62">whatever it was so there's a good chance</span> <span data-start="525.62" data-end="526.459">that it's going to be there when it</span> <span data-start="526.459" data-end="528.98">fully launches all these browsers let</span> <span data-start="528.98" data-end="530.6">you use the application cache</span> <span data-start="530.6" data-end="531.8">transparently if the exception of</span> <span data-start="531.8" data-end="533.449">Firefox which will put a message up and</span> <span data-start="533.449" data-end="533.96">user has</span> <span data-start="533.96" data-end="537.29">click allow to make it work it can seem</span> <span data-start="537.29" data-end="539.57">at first like this was a small piece of</span> <span data-start="539.57" data-end="541.73">progressive enhancement but watch this</span> <span data-start="541.73" data-end="544.13">time he'll go to an editor and I'm going</span> <span data-start="544.13" data-end="545.48">to change just that the title of the</span> <span data-start="545.48" data-end="550.22">page there from sprite cow to yay j/s</span> <span data-start="550.22" data-end="553.97">conf and say that out so now back in the</span> <span data-start="553.97" data-end="556.4">page I'm going to refresh refresh</span> <span data-start="556.4" data-end="561.41">refresh no change oh wow hello the</span> <span data-start="561.41" data-end="563.18">behavior of the site has significantly</span> <span data-start="563.18" data-end="565.64">changed to what we would expect and this</span> <span data-start="565.64" data-end="566.87">is the first piece of douchebaggery are</span> <span data-start="566.87" data-end="568.7">going to look at the application cache</span> <span data-start="568.7" data-end="571.06">completely takes over the operation</span> <span data-start="571.06" data-end="573.26">let's try some of what's happening here</span> <span data-start="573.26" data-end="574.94">the first time you load a page it's</span> <span data-start="574.94" data-end="576.95">requested normally and if we get an HTML</span> <span data-start="576.95" data-end="579.41">page and that points at a manifest file</span> <span data-start="579.41" data-end="581.87">the manifest file is downloaded and then</span> <span data-start="581.87" data-end="582.65">the browser will go through that</span> <span data-start="582.65" data-end="584.21">manifest file and download all the files</span> <span data-start="584.21" data-end="586.22">inside it and if they all download fine</span> <span data-start="586.22" data-end="589.49">they form a cash if any file that you</span> <span data-start="589.49" data-end="592.16">list for all fours 500 anything like</span> <span data-start="592.16" data-end="593.81">that the whole caching process fails</span> </p>
<p><span data-start="593.81" data-end="596.33">I've seen this described as a gotcha but</span> <span data-start="596.33" data-end="597.44">no this is actually a really good thing</span> <span data-start="597.44" data-end="599.12">because it gives us two states who can</span> <span data-start="599.12" data-end="600.65">rely upon can I've rely upon the cash</span> <span data-start="600.65" data-end="603.14">being entirely there or not there at all</span> <span data-start="603.14" data-end="604.64">and that's what makes it better than the</span> <span data-start="604.64" data-end="606.92">current browser cache where some files</span> <span data-start="606.92" data-end="609.19">will disappear another ones will stay</span> <span data-start="609.19" data-end="611.09">subsequent requests will go differently</span> <span data-start="611.09" data-end="614.75">if a file is in the application cache it</span> <span data-start="614.75" data-end="616.28">will be served from the application</span> <span data-start="616.28" data-end="618.17">cache otherwise things will carry on</span> <span data-start="618.17" data-end="620.63">down the same path we saw before a lot</span> <span data-start="620.63" data-end="621.92">of blog posts and speakers on the</span> <span data-start="621.92" data-end="623.15">subject they make the assumption that</span> <span data-start="623.15" data-end="625.01">the cached version is only used if</span> <span data-start="625.01" data-end="626.78">you're offline and that's not true</span> <span data-start="626.78" data-end="628.49">connectivity doesn't factor into it at</span> <span data-start="628.49" data-end="630.47">all the version will be served from the</span> <span data-start="630.47" data-end="633.53">cash if it's there always the plus the</span> <span data-start="633.53" data-end="635.51">reason they do this is because what is</span> <span data-start="635.51" data-end="637.4">offline what does offline mean offline</span> <span data-start="637.4" data-end="640.07">could mean you don't have anything a</span> <span data-start="640.07" data-end="642.29">wire plugged into your machine it could</span> <span data-start="642.29" data-end="643.4">mean that the roofie you are connected</span> <span data-start="643.4" data-end="644.33">to doesn't have an internet connection</span> <span data-start="644.33" data-end="646.22">it could mean that you you know have a</span> <span data-start="646.22" data-end="648.35">dns problem a proxy problem the site is</span> <span data-start="648.35" data-end="650.42">down there's no fast way to detect any</span> <span data-start="650.42" data-end="652.07">of this so it makes it come straight</span> <span data-start="652.07" data-end="653.6">from the cash straight away and that</span> <span data-start="653.6" data-end="657.47">means you get the site quickly but it</span> <span data-start="657.47" data-end="658.76">still checks the manifest in the</span> <span data-start="658.76" data-end="660.02">background when it comes on the cash to</span> <span data-start="660.02" data-end="661.76">look for updates but if it's looking for</span> <span data-start="661.76" data-end="663.38">updates then then why are we not getting</span> <span data-start="663.38" data-end="665.12">the heading not changing why is it still</span> <span data-start="665.12" data-end="667.04">so sprite cow unfortunately this is</span> <span data-start="667.04" data-end="667.699">another piece of</span> <span data-start="667.699" data-end="670.579">magarri there's another layer of cash</span> <span data-start="670.579" data-end="673.879">validation it has its own system see the</span> <span data-start="673.879" data-end="676.22">application cache it won't update unless</span> <span data-start="676.22" data-end="678.709">the manifest file has changed in some</span> <span data-start="678.709" data-end="681.739">way and I mean that in any way at all so</span> <span data-start="681.739" data-end="683.179">anything that makes it not bite</span> <span data-start="683.179" data-end="685.04">identical so here's a list of files we</span> <span data-start="685.04" data-end="686.6">had before you'll notice that a lot of</span> <span data-start="686.6" data-end="687.889">files have version numbers that's</span> <span data-start="687.889" data-end="690.109">because they're all far future cached so</span> <span data-start="690.109" data-end="692.569">changing them involves changing URL like</span> <span data-start="692.569" data-end="694.669">that version 2 and that's also changing</span> <span data-start="694.669" data-end="695.899">the manifest everything just kind of</span> <span data-start="695.899" data-end="698.749">works and that's fine for the CSS and</span> </p>
<p><span data-start="698.749" data-end="700.459">JavaScript but we changed the HTML and</span> <span data-start="700.459" data-end="702.079">that's not listed here and even if it</span> <span data-start="702.079" data-end="705.679">was it's not going to change URL so a</span> <span data-start="705.679" data-end="707.239">common way to get round that is to add a</span> <span data-start="707.239" data-end="708.679">comment into the manifest file something</span> <span data-start="708.679" data-end="710.839">like this comment start with a hash</span> <span data-start="710.839" data-end="712.79">symbol and although it's a comment that</span> <span data-start="712.79" data-end="714.529">still counts as a change to the manifest</span> <span data-start="714.529" data-end="716.359">and that will trigger an update here</span> <span data-start="716.359" data-end="718.16">I've just used a single digit you could</span> <span data-start="718.16" data-end="720.079">use some kind of build system to combine</span> <span data-start="720.079" data-end="721.639">things like e tags or something like</span> <span data-start="721.639" data-end="723.41">that this is the biggest ball ache when</span> <span data-start="723.41" data-end="725.749">developing an app cache site every time</span> <span data-start="725.749" data-end="728.179">you change any of a file you have to</span> <span data-start="728.179" data-end="729.619">change the manifest as well and you</span> <span data-start="729.619" data-end="731.059">can't just use some kind of random</span> <span data-start="731.059" data-end="732.829">number generator because when when the</span> <span data-start="732.829" data-end="734.66">application cache updates the manifest</span> <span data-start="734.66" data-end="736.399">it downloads the manifest at the start</span> <span data-start="736.399" data-end="738.47">of an update and at the end and if the</span> <span data-start="738.47" data-end="740.269">manifest has changed during the update</span> <span data-start="740.269" data-end="742.549">the caching process will fail because it</span> <span data-start="742.549" data-end="743.689">will assume right I've downloaded these</span> <span data-start="743.689" data-end="745.519">five files but the manifest changed at</span> <span data-start="745.519" data-end="747.559">some point during that these files could</span> <span data-start="747.559" data-end="749.48">be from two different versions so it</span> <span data-start="749.48" data-end="753.589">fails it the cache won't settle this is</span> <span data-start="753.589" data-end="755.059">something that catches a lot of people</span> <span data-start="755.059" data-end="755.989">aren't going to start playing with</span> <span data-start="755.989" data-end="759.199">appcache the byte for byte identical</span> <span data-start="759.199" data-end="760.97">check thing this is additional to the</span> <span data-start="760.97" data-end="762.949">normal browser caching app caches is</span> <span data-start="762.949" data-end="764.629">separate to the normal caching layer it</span> <span data-start="764.629" data-end="766.879">doesn't replace it it sits on top of it</span> <span data-start="766.879" data-end="768.679">and it shouldn't be used as a</span> <span data-start="768.679" data-end="769.91">replacement that might seem obvious but</span> <span data-start="769.91" data-end="771.289">this is what catches people out because</span> <span data-start="771.289" data-end="772.669">they'll update a file will update the</span> <span data-start="772.669" data-end="774.199">manifest and they still won't get</span> <span data-start="774.199" data-end="776.66">changes to the file and this is because</span> <span data-start="776.66" data-end="777.589">they're playing around on the local</span> <span data-start="777.589" data-end="779.209">apache server and they're not using</span> <span data-start="779.209" data-end="782.959">caching headers so basically he's got</span> <span data-start="782.959" data-end="784.22">the first I'll cash instructions right</span> <span data-start="784.22" data-end="786.379">we can say don't cache this or check</span> <span data-start="786.379" data-end="787.97">back for the server or assume this file</span> <span data-start="787.97" data-end="790.129">is good for you that's fine but without</span> <span data-start="790.129" data-end="791.899">one of these the application cache takes</span> <span data-start="791.899" data-end="793.309">a file to the networking layer and says</span> <span data-start="793.309" data-end="795.799">update this file and the networking rate</span> <span data-start="795.799" data-end="797.959">goes no but this doesn't have any</span> <span data-start="797.959" data-end="800.149">caching instructions how should I update</span> <span data-start="800.149" data-end="801.12">it</span> <span data-start="801.12" data-end="804.54">oh yeah however I want and browsers try</span> <span data-start="804.54" data-end="805.68">and be as fast as possible and that</span> <span data-start="805.68" data-end="807.51">involves doing as little as possible so</span> <span data-start="807.51" data-end="810.18">quite often the caching layer will just</span> <span data-start="810.18" data-end="812.58">send the file back and say it's probably</span> <span data-start="812.58" data-end="814.62">okay the application cache will</span> <span data-start="814.62" data-end="817.08">unwittingly update itself with a stale</span> <span data-start="817.08" data-end="818.61">version from the standard browser cache</span> <span data-start="818.61" data-end="820.74">if you don't tell it otherwise and that</span> <span data-start="820.74" data-end="822.06">kind of copying can be really good when</span> <span data-start="822.06" data-end="823.26">it's under your control when you're</span> <span data-start="823.26" data-end="824.1">controlling it with cache headers</span> <span data-start="824.1" data-end="825.9">because you can save HTTP requests with</span> <span data-start="825.9" data-end="828.81">far future caching but out of control</span> <span data-start="828.81" data-end="831.27">caching has awful results out of control</span> <span data-start="831.27" data-end="833.49">copying that that took street fighter</span> <span data-start="833.49" data-end="834.779">and turned into street fight of the</span> <span data-start="834.779" data-end="838.17">movie and turned it into street fight at</span> <span data-start="838.17" data-end="840.87">the movie the game this this is a thing</span> <span data-start="840.87" data-end="845.31">that actually happened I assume at this</span> <span data-start="845.31" data-end="846.839">point someone had to step in and reboot</span> </p>
<p><span data-start="846.839" data-end="848.25">Hollywood in the games industry before</span> <span data-start="848.25" data-end="851.52">it just got itself in a complete loop so</span> <span data-start="851.52" data-end="853.11">in terms of your manifest you'll you</span> <span data-start="853.11" data-end="855.3">know far future cash things that change</span> <span data-start="855.3" data-end="858.24">not on every request and then make sure</span> <span data-start="858.24" data-end="859.8">they change your own when they do so if</span> <span data-start="859.8" data-end="861.839">it can change your world and do it for</span> <span data-start="861.839" data-end="863.43">content that can't change URL but</span> <span data-start="863.43" data-end="866.49">updates relatively frequently use a no</span> <span data-start="866.49" data-end="868.65">cash header or must-revalidate but make</span> <span data-start="868.65" data-end="870.029">sure you change a comment in the file as</span> <span data-start="870.029" data-end="873.69">well now following that advice you might</span> <span data-start="873.69" data-end="875.49">think I'll hang on I could do the same</span> <span data-start="875.49" data-end="877.589">to the manifest file itself I can put a</span> <span data-start="877.589" data-end="879.57">version number in there offline v1 and</span> <span data-start="879.57" data-end="882.209">far future cash it and save on that HTTP</span> <span data-start="882.209" data-end="883.35">request that's going to happen on every</span> <span data-start="883.35" data-end="884.61">page and then when you want to make a</span> <span data-start="884.61" data-end="886.68">change change the url same as you do if</span> <span data-start="886.68" data-end="889.44">the javascript and CSS you must never</span> <span data-start="889.44" data-end="892.44">ever do this the specification will</span> <span data-start="892.44" data-end="895.709">punish you for doing this what actually</span> <span data-start="895.709" data-end="897.57">happens here is where does the browser</span> <span data-start="897.57" data-end="901.23">find out about the updated manifest well</span> <span data-start="901.23" data-end="903.72">it finds out from the new HTML file but</span> <span data-start="903.72" data-end="904.8">where does it find out about the new</span> </p>
<p><span data-start="904.8" data-end="909.81">HTML file from the new manifest I did</span> <span data-start="909.81" data-end="911.76">this with sprite cow and I did it my</span> <span data-start="911.76" data-end="913.529">deploy decided it was about 20 minutes</span> <span data-start="913.529" data-end="914.94">before I just a little for entered my</span> <span data-start="914.94" data-end="917.37">head and I oh oh gods and I went back</span> <span data-start="917.37" data-end="918.839">and changed it looking at Google</span> <span data-start="918.839" data-end="920.76">Analytics 30 people visit the site in</span> <span data-start="920.76" data-end="923.01">that window those 20 users will never</span> <span data-start="923.01" data-end="926.209">get an update to the site ever again and</span> <span data-start="926.209" data-end="928.709">unless they clear their browser cache or</span> <span data-start="928.709" data-end="931.56">you know get a new browser that they now</span> <span data-start="931.56" data-end="933.15">live the life of blackberry customers</span> <span data-start="933.15" data-end="933.98">everyone's</span> <span data-start="933.98" data-end="935.66">shiny new stuff but they're getting the</span> <span data-start="935.66" data-end="937.55">same whole thing again and again and</span> <span data-start="937.55" data-end="942.95">again so before we move on why do we</span> <span data-start="942.95" data-end="944.63">have this extra level of cash validation</span> <span data-start="944.63" data-end="945.86">why do we have to change the manifest</span> <span data-start="945.86" data-end="947.99">file I think it's really stupid but this</span> <span data-start="947.99" data-end="949.49">is the reason imagine how to manifest</span> <span data-start="949.49" data-end="951.74">like this you know 50 HTML files date</span> </p>
<p><span data-start="951.74" data-end="953.99">URLs don't change updating this manifest</span> <span data-start="953.99" data-end="956.93">is 50 HTTP requests 52 if you count the</span> <span data-start="956.93" data-end="959.27">manifest on either side the text</span> <span data-start="959.27" data-end="961.13">changing trick is to avoid that</span> <span data-start="961.13" data-end="963.14">happening on every page load it really</span> <span data-start="963.14" data-end="964.79">just puts the problem back in your hands</span> <span data-start="964.79" data-end="966.29">as a developer you have to decide when</span> <span data-start="966.29" data-end="967.79">it happens and it is just a</span> <span data-start="967.79" data-end="969.65">specification just clearing itself of</span> <span data-start="969.65" data-end="971.99">any blame in my opinion but let's prove</span> <span data-start="971.99" data-end="973.58">a point let's get this heading change so</span> </p>
<p><span data-start="973.58" data-end="977.03">I'm going to go into my manifest file</span> <span data-start="977.03" data-end="981.23">and add just version to something like</span> <span data-start="981.23" data-end="984.17">that okay so now i'm going to refresh</span> <span data-start="984.17" data-end="986.93">the page no change refresh the page</span> <span data-start="986.93" data-end="990.08">again and yay ok so the contents changed</span> <span data-start="990.08" data-end="991.67">but we saw something important there end</span> <span data-start="991.67" data-end="993.86">of a piece of douchebaggery it took us</span> <span data-start="993.86" data-end="995.75">to refreshes to actually get the content</span> <span data-start="995.75" data-end="997.58">and that's that's kind of a side effect</span> <span data-start="997.58" data-end="1000.04">of the flow of the application cache we</span> <span data-start="1000.04" data-end="1001.63">saw before that the the version comes</span> <span data-start="1001.63" data-end="1003.18">from the cash if it's in the cache and</span> <span data-start="1003.18" data-end="1006.13">then the manifest is updated afterwards</span> <span data-start="1006.13" data-end="1007.99">but by that point the users still</span> <span data-start="1007.99" data-end="1009.25">looking at the old version so even if</span> <span data-start="1009.25" data-end="1010.81">they get a new version they're not going</span> <span data-start="1010.81" data-end="1012.16">to see it until the next time they load</span> <span data-start="1012.16" data-end="1014.98">the page there's a JavaScript event at</span> <span data-start="1014.98" data-end="1017.29">this point that you can use to do</span> <span data-start="1017.29" data-end="1019.12">something and that's an update ready</span> <span data-start="1019.12" data-end="1021.37">that happens when the this browser</span> <span data-start="1021.37" data-end="1022.93">downloads a manifest there's a change</span> <span data-start="1022.93" data-end="1024.91">and it downloads all the files within</span> <span data-start="1024.91" data-end="1026.11">and all those files download</span> <span data-start="1026.11" data-end="1028.51">successfully in form of cash at this</span> <span data-start="1028.51" data-end="1030.34">point you can call swap cash and what</span> <span data-start="1030.34" data-end="1031.81">that does that starts using the new cash</span> <span data-start="1031.81" data-end="1034.63">immediately for subsequent requests but</span> <span data-start="1034.63" data-end="1035.71">by that point the horse is already</span> <span data-start="1035.71" data-end="1037.39">bolted you know the users already</span> <span data-start="1037.39" data-end="1040.45">downloaded the page swap cash is</span> <span data-start="1040.45" data-end="1041.56">actually pretty useless I don't</span> <span data-start="1041.56" data-end="1042.88">understand why it made it into the</span> <span data-start="1042.88" data-end="1045.76">specification over a load of glaring</span> <span data-start="1045.76" data-end="1047.86">omissions there's very few use cases for</span> <span data-start="1047.86" data-end="1049.84">swap cash you could just force a reload</span> <span data-start="1049.84" data-end="1052.12">of the page and that we on the user will</span> <span data-start="1052.12" data-end="1054.7">get a new version but this is a bad user</span> <span data-start="1054.7" data-end="1055.75">experience because these are might have</span> <span data-start="1055.75" data-end="1056.98">already started interacting if the page</span> <span data-start="1056.98" data-end="1058.21">imagine you'll be using Gmail you</span> <span data-start="1058.21" data-end="1059.62">started composing an email and it just</span> <span data-start="1059.62" data-end="1060.79">refreshed on you because there's an</span> <span data-start="1060.79" data-end="1063.49">update that's not great as a compromise</span> <span data-start="1063.49" data-end="1065.44">just within your app show some kind of</span> <span data-start="1065.44" data-end="1067.63">message saying hey there's an update</span> <span data-start="1067.63" data-end="1068.77">refresh at your leisure and you'll see</span> <span data-start="1068.77" data-end="1071.56">this on various Google Sites another</span> <span data-start="1071.56" data-end="1073.33">compromise it just to not care and</span> <span data-start="1073.33" data-end="1075.19">that's what i did a spike how I mean so</span> <span data-start="1075.19" data-end="1077.14">what if people are on a version before</span> <span data-start="1077.14" data-end="1079.45">for one viewing in terms of breakout</span> <span data-start="1079.45" data-end="1080.71">it's not a big deal people aren't going</span> <span data-start="1080.71" data-end="1083.74">to be on that site for a long time so</span> <span data-start="1083.74" data-end="1085.96">this is the simple example are we done</span> <span data-start="1085.96" data-end="1088.84">yet it looks like we're done but a nasty</span> <span data-start="1088.84" data-end="1091.21">buggers crept in our analytics to stop</span> <span data-start="1091.21" data-end="1092.53">working you'd only spot this if you were</span> <span data-start="1092.53" data-end="1094.12">looking at web inspector or fire bug or</span> <span data-start="1094.12" data-end="1096.64">something so why are these connections</span> <span data-start="1096.64" data-end="1098.05">failing well let's have a look at a more</span> <span data-start="1098.05" data-end="1100.18">visual example so this page here users</span> <span data-start="1100.18" data-end="1101.83">are manifest but in the manifest it only</span> <span data-start="1101.83" data-end="1104.44">points at the CSS file and obviously the</span> </p>
<p><span data-start="1104.44" data-end="1106.99">HTML file is implicitly cached so even</span> <span data-start="1106.99" data-end="1109.38">though that we have a connection here i</span> <span data-start="1109.38" data-end="1111.94">refresh the page and the images suddenly</span> <span data-start="1111.94" data-end="1114.25">fail of course this is another piece of</span> <span data-start="1114.25" data-end="1115.69">douchebaggery the application cache</span> <span data-start="1115.69" data-end="1117.73">doesn't like stuff that isn't in the app</span> <span data-start="1117.73" data-end="1119.59">cache the first time we saw the page it</span> <span data-start="1119.59" data-end="1121.54">wasn't cashed we refreshed got the</span> <span data-start="1121.54" data-end="1123.31">version from the cache everything Oh</span> <span data-start="1123.31" data-end="1126.31">Liam just stopped loading to explain it</span> <span data-start="1126.31" data-end="1127.45">some afraid we have to go back to the</span> <span data-start="1127.45" data-end="1130">diagram unfortunately we've missed some</span> <span data-start="1130" data-end="1132.7">detail from the top once the browser</span> <span data-start="1132.7" data-end="1135.13">makes a get request to a URL it looks to</span> <span data-start="1135.13" data-end="1136.57">see if its associated with manifest and</span> <span data-start="1136.57" data-end="1138.37">if it is associated with manifest it</span> <span data-start="1138.37" data-end="1140.83">uses it and things continue as we've</span> <span data-start="1140.83" data-end="1143.56">already seen if the URL isn't associated</span> <span data-start="1143.56" data-end="1146.17">with manifest things just request</span> <span data-start="1146.17" data-end="1147.67">normally as they normally would without</span> <span data-start="1147.67" data-end="1148.99">a manifest now that just sounds like a</span> <span data-start="1148.99" data-end="1150.43">complicated way of saying what we've</span> <span data-start="1150.43" data-end="1151.8">already said but here's the difference</span> <span data-start="1151.8" data-end="1154.03">every request that's triggered by a</span> <span data-start="1154.03" data-end="1157.63">cached page your j/s CSS your images as</span> <span data-start="1157.63" data-end="1160.09">before they go back through the same</span> <span data-start="1160.09" data-end="1161.83">system but they don't reselect a</span> <span data-start="1161.83" data-end="1163.45">manifest they'll use the manifest of the</span> <span data-start="1163.45" data-end="1166.12">host page now that's fine if the image</span> <span data-start="1166.12" data-end="1167.32">is in the cache it will come from the</span> <span data-start="1167.32" data-end="1171.1">cash otherwise the connection fails and</span> <span data-start="1171.1" data-end="1172.63">that's what we saw if those images it's</span> <span data-start="1172.63" data-end="1174.13">no coincidence that this part of the</span> <span data-start="1174.13" data-end="1185.91">specification is in section 666</span> <span data-start="1185.92" data-end="1188.15">this is the specification of the beast</span> <span data-start="1188.15" data-end="1189.98">this is where all the really gnarly</span> <span data-start="1189.98" data-end="1194.45">stuff is so this is that's what's</span> <span data-start="1194.45" data-end="1195.29">happening here that's why those images</span> <span data-start="1195.29" data-end="1197.78">are failing we can fix that by using the</span> <span data-start="1197.78" data-end="1199.79">network section of the manifest and we</span> <span data-start="1199.79" data-end="1202.49">can list full paths or we can use a star</span> <span data-start="1202.49" data-end="1204.83">and that makes things work the reason</span> <span data-start="1204.83" data-end="1206.63">that makes things work is if the URL</span> <span data-start="1206.63" data-end="1208.37">isn't cached but it's listed in the</span> <span data-start="1208.37" data-end="1210.32">network section it's requested normally</span> <span data-start="1210.32" data-end="1212.12">otherwise if there's a star in the</span> <span data-start="1212.12" data-end="1214.22">network section then the files requested</span> <span data-start="1214.22" data-end="1216.32">normally otherwise it fails so that's</span> <span data-start="1216.32" data-end="1217.64">how you bring things back those files</span> <span data-start="1217.64" data-end="1218.99">that you list a network they won't be</span> <span data-start="1218.99" data-end="1220.34">cached they will fail when you're</span> <span data-start="1220.34" data-end="1222.98">offline but they will work when you're</span> <span data-start="1222.98" data-end="1224.09">online so you need to make sure your</span> <span data-start="1224.09" data-end="1225.77">online only stuff such as analytics that</span> <span data-start="1225.77" data-end="1227.12">they're taken care of by one of these</span> <span data-start="1227.12" data-end="1229.64">two network rules well that's it really</span> <span data-start="1229.64" data-end="1233">that's the simple example all done and</span> <span data-start="1233" data-end="1234.41">it was at this point that I wanted to</span> <span data-start="1234.41" data-end="1235.85">lock myself in the bathroom and wait</span> <span data-start="1235.85" data-end="1237.53">until the internet had gone away maybe</span> <span data-start="1237.53" data-end="1239.93">even in the end cubicle at work where</span> <span data-start="1239.93" data-end="1242.33">the internet can't get me but but this</span> <span data-start="1242.33" data-end="1244.25">is jess conf we're not afraid of peeling</span> <span data-start="1244.25" data-end="1245.93">the appcache onion a little bit further</span> <span data-start="1245.93" data-end="1247.82">so we'll look at a different kind of</span> <span data-start="1247.82" data-end="1251.27">site will look at a get stuff site and</span> <span data-start="1251.27" data-end="1253.37">i'm going to use em lanyard calm as an</span> <span data-start="1253.37" data-end="1255.34">example for this is something we built</span> <span data-start="1255.34" data-end="1257.45">we found on your comm you can look up</span> <span data-start="1257.45" data-end="1259.67">future conferences you can get details</span> <span data-start="1259.67" data-end="1261.8">on events that you're tracking or</span> <span data-start="1261.8" data-end="1263.72">attending and you can get information</span> <span data-start="1263.72" data-end="1264.92">about a particular conference so it says</span> </p>
<p><span data-start="1264.92" data-end="1266.66">Jess conf because that's got the</span> <span data-start="1266.66" data-end="1267.83">scheduling things it would be great if</span> <span data-start="1267.83" data-end="1269.45">this worked offline so I can look it up</span> <span data-start="1269.45" data-end="1271.01">and I was on a plane or in a different</span> <span data-start="1271.01" data-end="1272.69">country wherever but there's too much</span> <span data-start="1272.69" data-end="1274.28">data and lanyard to offline afuck ate</span> <span data-start="1274.28" data-end="1275.93">everything right but users are only</span> <span data-start="1275.93" data-end="1277.76">interested in a subset of the data that</span> <span data-start="1277.76" data-end="1280.91">that language has marked pilgrims dive</span> <span data-start="1280.91" data-end="1282.77">into html5 that had a decent section on</span> <span data-start="1282.77" data-end="1284.15">the application cache and it offered up</span> <span data-start="1284.15" data-end="1286.28">a solution to offline ur eyes wikipedia</span> <span data-start="1286.28" data-end="1288.4">which is maybe something we could use it</span> <span data-start="1288.4" data-end="1291.71">worked by having every page pointing at</span> <span data-start="1291.71" data-end="1294.02">our manifest every page and that</span> <span data-start="1294.02" data-end="1295.49">manifest just had like the JavaScript</span> </p>
<p><span data-start="1295.49" data-end="1299.33">CSS usual stuff because page is pointing</span> <span data-start="1299.33" data-end="1300.98">our manifest are implicitly cached as</span> <span data-start="1300.98" data-end="1303.17">you kind of get lost in the Wikipedia</span> <span data-start="1303.17" data-end="1305.15">labyrinth more and more of the site is</span> <span data-start="1305.15" data-end="1307.67">becoming available to you offline dead</span> <span data-start="1307.67" data-end="1309.11">simple it doesn't even require</span> <span data-start="1309.11" data-end="1311.63">javascript but also as a solution it's</span> <span data-start="1311.63" data-end="1313.82">just not good enough reason it's not</span> <span data-start="1313.82" data-end="1314.78">good enough is there's no indication</span> <span data-start="1314.78" data-end="1316.31">which page is going to be available</span> <span data-start="1316.31" data-end="1317.299">offline do you</span> <span data-start="1317.299" data-end="1318.619">doesn't know that one of the major</span> <span data-start="1318.619" data-end="1320.179">oversights in the spec is there's no way</span> <span data-start="1320.179" data-end="1322.1">with JavaScript to ask the browser</span> <span data-start="1322.1" data-end="1325.07">what's cached there's nothing there so</span> <span data-start="1325.07" data-end="1326.57">we can't we can't provide like a UI to</span> <span data-start="1326.57" data-end="1327.86">show the user what they can expect to</span> <span data-start="1327.86" data-end="1329.509">work and it's near impossible to manage</span> <span data-start="1329.509" data-end="1331.58">update those cached files are only going</span> <span data-start="1331.58" data-end="1333.32">to update when the manifest file changes</span> <span data-start="1333.32" data-end="1335.96">but when do we change the manifest every</span> <span data-start="1335.96" data-end="1337.85">time a page on Wikipedia changes that's</span> <span data-start="1337.85" data-end="1340.46">going to be far too frequently and those</span> <span data-start="1340.46" data-end="1341.659">updates are going to be heavy as well</span> <span data-start="1341.659" data-end="1343.399">imagine you look at 100 pages on</span> </p>
<p><span data-start="1343.399" data-end="1345.529">Wikipedia which is you know probably a</span> <span data-start="1345.529" data-end="1347.84">conservative number you have 100 pages</span> <span data-start="1347.84" data-end="1350.57">cached when a manifest changes that's a</span> <span data-start="1350.57" data-end="1352.039">hundred pages for you to download and</span> <span data-start="1352.039" data-end="1353.059">we've already decided that that's going</span> <span data-start="1353.059" data-end="1355.19">to happen every page load pretty much</span> <span data-start="1355.19" data-end="1356.96">latinum was only going to get bigger and</span> <span data-start="1356.96" data-end="1357.919">bigger and bigger as you browse around</span> <span data-start="1357.919" data-end="1359.33">the site more because we have no cleanup</span> <span data-start="1359.33" data-end="1361.58">mechanism got no way of expiring those</span> <span data-start="1361.58" data-end="1363.499">pages from the cache the cash will</span> <span data-start="1363.499" data-end="1364.94">eventually hit it's allowed limit and</span> <span data-start="1364.94" data-end="1367.22">then things will start failing so not</span> <span data-start="1367.22" data-end="1369.289">good enough ideally we want to be</span> <span data-start="1369.289" data-end="1370.549">showing up to that content to the user</span> <span data-start="1370.549" data-end="1373.759">while they're online and in control with</span> </p>
<p><span data-start="1373.759" data-end="1375.259">JavaScript which content is going to be</span> <span data-start="1375.259" data-end="1376.609">cached and what isn't and defer that</span> <span data-start="1376.609" data-end="1378.889">content to the user so maybe in the form</span> <span data-start="1378.889" data-end="1380.84">of a save offline or read later button</span> <span data-start="1380.84" data-end="1383.989">and indicate which content is available</span> <span data-start="1383.989" data-end="1385.399">offline and maybe change the link color</span> <span data-start="1385.399" data-end="1386.6">do something there so the user knows</span> <span data-start="1386.6" data-end="1388.759">what they can expect it to work for them</span> <span data-start="1388.759" data-end="1389.869">when they don't have a connection and</span> <span data-start="1389.869" data-end="1391.7">this should be set up with a single view</span> <span data-start="1391.7" data-end="1393.409">to any page on the site we can't say to</span> <span data-start="1393.409" data-end="1394.609">the user oh if you want the offline</span> <span data-start="1394.609" data-end="1396.859">stuff go to slash offline as any page</span> <span data-start="1396.859" data-end="1399.769">should make this all work app cache</span> <span data-start="1399.769" data-end="1402.619">makes this really really difficult so</span> <span data-start="1402.619" data-end="1405.649">when I was a kid we had a sandbox in the</span> <span data-start="1405.649" data-end="1407.179">garden not metaphorical sandbox an</span> <span data-start="1407.179" data-end="1409.46">actual sandbox with sandy and I'd go</span> <span data-start="1409.46" data-end="1411.71">there to play and build stuff you know</span> <span data-start="1411.71" data-end="1413.529">it was a real creative outlet for me</span> <span data-start="1413.529" data-end="1416.45">unfortunately the family cats they also</span> <span data-start="1416.45" data-end="1418.909">used the sound box for a completely</span> <span data-start="1418.909" data-end="1421.999">different kind of outlet turns out you</span> <span data-start="1421.999" data-end="1424.6">can't build sandcastles a catch it I</span> <span data-start="1424.6" data-end="1427.48">made some stunning catch it castles oh</span> <span data-start="1427.48" data-end="1430.46">but fast forward 20 years and Here I am</span> <span data-start="1430.46" data-end="1432.139">them in the same situation again but</span> <span data-start="1432.139" data-end="1433.549">this time it's the idiot someone else is</span> <span data-start="1433.549" data-end="1434.84">crapping in my sandbox it's the</span> <span data-start="1434.84" data-end="1437.029">application cache putting a manifest</span> <span data-start="1437.029" data-end="1438.98">attribute on HTML element means the app</span> <span data-start="1438.98" data-end="1441.83">cache moves in and takes over to solve</span> <span data-start="1441.83" data-end="1443.269">this we need to take the application</span> <span data-start="1443.269" data-end="1447.139">cache and pop him in a box where he can</span> <span data-start="1447.139" data-end="1449.299">be Schrodinger's douche bag and we can</span> <span data-start="1449.299" data-end="1450.95">leave in there until we care if he's</span> <span data-start="1450.95" data-end="1451.13">dead</span> <span data-start="1451.13" data-end="1455.15">alive to do this we're going to put the</span> <span data-start="1455.15" data-end="1457.4">manifest on one page only just one page</span> <span data-start="1457.4" data-end="1460.22">offline stuff to HTML or whatever but</span> <span data-start="1460.22" data-end="1461.57">going to make sure that every other page</span> <span data-start="1461.57" data-end="1464.12">knows about it by having a little hidden</span> <span data-start="1464.12" data-end="1465.92">iframe point into that page so not</span> <span data-start="1465.92" data-end="1467.24">matter what page you visit is going to</span> <span data-start="1467.24" data-end="1468.59">pick up this cached page and its</span> <span data-start="1468.59" data-end="1470.57">manifest the manifest is going to be the</span> <span data-start="1470.57" data-end="1472.07">same as you know what we've seen before</span> </p>
<p><span data-start="1472.07" data-end="1474.2">CSS JavaScript network rules whatever</span> <span data-start="1474.2" data-end="1477.62">but a new rule fall back a fallback rule</span> <span data-start="1477.62" data-end="1480.83">has two parts a URL prefix and then a</span> <span data-start="1480.83" data-end="1482.57">full relative path to some file to cash</span> <span data-start="1482.57" data-end="1484.04">this is the point where they should have</span> <span data-start="1484.04" data-end="1485.27">been using JSON or something because</span> <span data-start="1485.27" data-end="1486.83">it's getting complicated Google gears</span> <span data-start="1486.83" data-end="1489.74">use Jason and it was much more readable</span> <span data-start="1489.74" data-end="1492.97">in my opinion so what does fall by 2 ok</span> <span data-start="1492.97" data-end="1496.67">so if the URL isn't specifically listed</span> <span data-start="1496.67" data-end="1498.86">in the network section it scans all of</span> <span data-start="1498.86" data-end="1501.17">these fallback prefixes and it looks for</span> <span data-start="1501.17" data-end="1502.76">the largest one that matches the current</span> <span data-start="1502.76" data-end="1505.4">URL if any and if there is a match it</span> <span data-start="1505.4" data-end="1507.56">will request it normally and if that</span> <span data-start="1507.56" data-end="1511.01">request goes ok then it uses it and then</span> <span data-start="1511.01" data-end="1512.27">things will continue as if the manifest</span> <span data-start="1512.27" data-end="1514.1">wasn't there at all but if the request</span> <span data-start="1514.1" data-end="1516.08">fails they'll use the second part the</span> <span data-start="1516.08" data-end="1517.46">cache partner will show the cached</span> <span data-start="1517.46" data-end="1520.25">version instead and that's really good</span> <span data-start="1520.25" data-end="1522.14">because we can we can use that to create</span> <span data-start="1522.14" data-end="1523.85">pages that act normally while the user</span> <span data-start="1523.85" data-end="1526.61">is online such as this but if we disable</span> <span data-start="1526.61" data-end="1529.73">the connection and refresh the page we</span> <span data-start="1529.73" data-end="1531.35">get completely different page but the</span> </p>
<p><span data-start="1531.35" data-end="1534.11">URL stays the same it's just it's like a</span> <span data-start="1534.11" data-end="1535.64">it's more of a rewrite than other than a</span> <span data-start="1535.64" data-end="1538.22">redirect so when I bring the connection</span> <span data-start="1538.22" data-end="1540.95">back and refresh the page we get the the</span> <span data-start="1540.95" data-end="1545.12">online version again unfortunately thank</span> <span data-start="1545.12" data-end="1547.94">you I invented that I didn't</span> <span data-start="1547.94" data-end="1549.5">unfortunately this gets us into some</span> <span data-start="1549.5" data-end="1551.87">browser troubles by using fall back we</span> <span data-start="1551.87" data-end="1555.23">wave goodbye to opera support we have</span> <span data-start="1555.23" data-end="1556.94">cold like this on lanyard unfortunately</span> <span data-start="1556.94" data-end="1558.92">and it's not great but I haven't found a</span> <span data-start="1558.92" data-end="1560.96">reliable way of feature detecting fall</span> <span data-start="1560.96" data-end="1563.96">back we've got too many false positives</span> <span data-start="1563.96" data-end="1566">it didn't work i'm looking forward to</span> <span data-start="1566" data-end="1569.51">removing this one's or prefix is that so</span> <span data-start="1569.51" data-end="1571.22">we're using the manifest for static</span> <span data-start="1571.22" data-end="1572.81">content only and every user's going to</span> <span data-start="1572.81" data-end="1575.81">get the same manifest thank God so where</span> <span data-start="1575.81" data-end="1576.98">do we store this the date of that a</span> <span data-start="1576.98" data-end="1578.48">particular user wants cached offline</span> <span data-start="1578.48" data-end="1580.76">over that we're going to use local</span> <span data-start="1580.76" data-end="1582.6">storage and I've flown together</span> <span data-start="1582.6" data-end="1585.24">demo of this so you can see from this</span> <span data-start="1585.24" data-end="1588.9">page that I have to test articles one of</span> <span data-start="1588.9" data-end="1590.789">my test articles is bigger than you have</span> <span data-start="1590.789" data-end="1597.12">a test article but that's okay but thank</span> <span data-start="1597.12" data-end="1601.559">you sometimes people don't get that joke</span> <span data-start="1601.559" data-end="1603.48">okay I just put it in there for my own</span> <span data-start="1603.48" data-end="1605.76">entertainment really but as you can see</span> <span data-start="1605.76" data-end="1607.41">it's got this save for offline access</span> <span data-start="1607.41" data-end="1610.679">button so I'm going to hit that so what</span> <span data-start="1610.679" data-end="1613.98">happened when when I press that when i</span> <span data-start="1613.98" data-end="1616.049">click that button it looks at the the</span> </p>
<p><span data-start="1616.049" data-end="1618.45">URL for the page and gets the HTML</span> <span data-start="1618.45" data-end="1620.039">because the URL doesn't change remember</span> <span data-start="1620.039" data-end="1623.25">so and then it's going to stall at HTML</span> <span data-start="1623.25" data-end="1625.2">into local storage using the pathname of</span> <span data-start="1625.2" data-end="1627.51">the URL as a key and we update an index</span> <span data-start="1627.51" data-end="1628.74">op object as well so it goes to</span> <span data-start="1628.74" data-end="1629.909">something that we can quickly look for</span> <span data-start="1629.909" data-end="1632.039">pages available offline on that this</span> <span data-start="1632.039" data-end="1633.33">code runs every time the user hits the</span> <span data-start="1633.33" data-end="1635.52">cash later button or if they visit the</span> <span data-start="1635.52" data-end="1636.809">page later and they've already decided I</span> <span data-start="1636.809" data-end="1638.61">want to cash it will run that code again</span> <span data-start="1638.61" data-end="1639.809">anyway to make sure that the version in</span> <span data-start="1639.809" data-end="1641.52">local storage is as fresh as that the</span> <span data-start="1641.52" data-end="1643.5">last version the user saw so if i</span> <span data-start="1643.5" data-end="1647.69">disable the connection and hit refresh</span> <span data-start="1647.69" data-end="1650.88">write the content comes back but under</span> <span data-start="1650.88" data-end="1652.14">the hood it's actually gone to this</span> <span data-start="1652.14" data-end="1653.549">completely different fall back page and</span> <span data-start="1653.549" data-end="1655.62">what the fall back page does is looks at</span> <span data-start="1655.62" data-end="1657.33">the URL because the URL doesn't change</span> <span data-start="1657.33" data-end="1659.549">and it looks to see in local storage if</span> <span data-start="1659.549" data-end="1661.049">there's content for that URL and if</span> <span data-start="1661.049" data-end="1662.73">there is it just repopulate stu page</span> <span data-start="1662.73" data-end="1665.429">with it so this is a simplification</span> <span data-start="1665.429" data-end="1667.2">you'll also want to catch your l's that</span> <span data-start="1667.2" data-end="1669.48">you don't have content for and you know</span> <span data-start="1669.48" data-end="1671.34">do more error detection around putting</span> <span data-start="1671.34" data-end="1673.77">stuff into local storage but having that</span> <span data-start="1673.77" data-end="1675.059">index object is really handy because it</span> <span data-start="1675.059" data-end="1676.14">means when we go back to the index we</span> <span data-start="1676.14" data-end="1677.309">can just we've got a little piece of</span> </p>
<p><span data-start="1677.309" data-end="1680.01">JavaScript I can just go is this your L</span> <span data-start="1680.01" data-end="1682.14">cached and we can get a true or false</span> <span data-start="1682.14" data-end="1683.76">value and we can show that to the user</span> <span data-start="1683.76" data-end="1685.08">so the user knows what they can rely</span> <span data-start="1685.08" data-end="1687.02">upon being there when they're offline</span> <span data-start="1687.02" data-end="1689.34">this is the same mechanism as we use on</span> </p>
<p><span data-start="1689.34" data-end="1692.58">MDOT language comm with a few minor</span> <span data-start="1692.58" data-end="1694.65">alterations we store Jason rather than</span> <span data-start="1694.65" data-end="1695.97">HTML because it's a more efficient use</span> <span data-start="1695.97" data-end="1698.28">of the local storage and we render that</span> <span data-start="1698.28" data-end="1700.86">Jason using mustache templates we use</span> <span data-start="1700.86" data-end="1702.03">the same mustache templates on the</span> <span data-start="1702.03" data-end="1703.35">server as we do on the client so there's</span> <span data-start="1703.35" data-end="1705.72">no repetition there and the server</span> <span data-start="1705.72" data-end="1707.669">remembers what the user wants cash is we</span> <span data-start="1707.669" data-end="1709.71">catch things when you click the attend</span> <span data-start="1709.71" data-end="1711.299">but another track button because that</span> <span data-start="1711.299" data-end="1712.799">data stored on the server if you lose</span> <span data-start="1712.799" data-end="1714.809">your cash or change phone we can quickly</span> <span data-start="1714.809" data-end="1716.96">repopulate the</span> <span data-start="1716.96" data-end="1719.16">and we expire all day as well when a</span> <span data-start="1719.16" data-end="1720.99">conference goes into the into the past</span> <span data-start="1720.99" data-end="1723.03">then we get rid of it we assume you need</span> <span data-start="1723.03" data-end="1724.71">anymore MDOT Langer calm is is mainly</span> <span data-start="1724.71" data-end="1726.75">for current and future conferences the</span> <span data-start="1726.75" data-end="1728.7">main sites for the ones in the past and</span> <span data-start="1728.7" data-end="1730.2">we do more error detection as well is</span> <span data-start="1730.2" data-end="1733.26">the system perfect no now there's a</span> <span data-start="1733.26" data-end="1735.6">introduces a few new problems when you</span> <span data-start="1735.6" data-end="1737.58">navigate around the site online use that</span> <span data-start="1737.58" data-end="1740.52">page is fix fetch bio xhr and we saw</span> <span data-start="1740.52" data-end="1742.59">that in asynchronously we change the URL</span> <span data-start="1742.59" data-end="1744.57">with push date we do this to avoid</span> <span data-start="1744.57" data-end="1745.95">passing some JavaScript you get a minor</span> <span data-start="1745.95" data-end="1747.42">performance benefit but it's mainly</span> <span data-start="1747.42" data-end="1749.49">about giving a more of an application</span> <span data-start="1749.49" data-end="1752.37">like feel to the site app cache screws</span> <span data-start="1752.37" data-end="1753.78">is over unfortunately when we do this</span> <span data-start="1753.78" data-end="1755.64">and really sorry gonna have to go back</span> <span data-start="1755.64" data-end="1758.09">to the diagram earlier we found out that</span> </p>
<p><span data-start="1758.09" data-end="1760.35">HTTP requests triggered by a cache page</span> <span data-start="1760.35" data-end="1762.15">will always use the manifest of the host</span> <span data-start="1762.15" data-end="1764.16">page which is fine however if the</span> <span data-start="1764.16" data-end="1766.29">request happens normally then any</span> <span data-start="1766.29" data-end="1768">requests triggered by that page will</span> <span data-start="1768" data-end="1771.33">also happen just normally app cache</span> <span data-start="1771.33" data-end="1772.98">wants no part of it that means if your</span> <span data-start="1772.98" data-end="1774.99">user requests a page when they're online</span> <span data-start="1774.99" data-end="1777.06">and it loads fine but then they go</span> <span data-start="1777.06" data-end="1778.62">offline like that driving through a</span> <span data-start="1778.62" data-end="1782.1">tunnel or whatever new requests like hxh</span> <span data-start="1782.1" data-end="1783.57">our JavaScript whatever they will fail</span> <span data-start="1783.57" data-end="1785.4">even if they're part of the application</span> <span data-start="1785.4" data-end="1787.44">cache even if they're covered by a</span> <span data-start="1787.44" data-end="1789.41">fallback rule they will just plain fail</span> <span data-start="1789.41" data-end="1791.49">so what we do online your diff a piece</span> <span data-start="1791.49" data-end="1794.7">of xhr navigation fails we just set</span> <span data-start="1794.7" data-end="1796.92">window.location to whatever the original</span> <span data-start="1796.92" data-end="1798.24">request was and that throws things back</span> <span data-start="1798.24" data-end="1799.68">to the top of the diagram and the user</span> <span data-start="1799.68" data-end="1802.14">barely notices another drawback to this</span> <span data-start="1802.14" data-end="1804.36">method is the fall by technique gives us</span> <span data-start="1804.36" data-end="1806.01">problems with error feedback to the user</span> </p>
<p><span data-start="1806.01" data-end="1809.28">I mentioned before that yo D the</span> <span data-start="1809.28" data-end="1811.2">fallback version is is used if the</span> <span data-start="1811.2" data-end="1813.6">request habit goes okay but what does ok</span> <span data-start="1813.6" data-end="1816.15">mean the request is considered to be</span> <span data-start="1816.15" data-end="1818.01">failed if this is some kind of</span> <span data-start="1818.01" data-end="1820.35">networking error the HTTP code is for</span> <span data-start="1820.35" data-end="1821.49">something something 5 something</span> <span data-start="1821.49" data-end="1822.99">something or there's a redirect to</span> <span data-start="1822.99" data-end="1825.21">another server that last one can seem a</span> <span data-start="1825.21" data-end="1827.13">bit odd the reason for it is this these</span> <span data-start="1827.13" data-end="1829.32">things these captive portals so you</span> <span data-start="1829.32" data-end="1830.64">request something in it redirects you to</span> <span data-start="1830.64" data-end="1832.5">some kind of Wi-Fi thing that wants your</span> <span data-start="1832.5" data-end="1834.66">data or wants you to pay for it app</span> <span data-start="1834.66" data-end="1836.22">cache is kind of clever here and it</span> <span data-start="1836.22" data-end="1837.78">assumes that that counts as no</span> <span data-start="1837.78" data-end="1839.22">connection and it will get the version</span> <span data-start="1839.22" data-end="1841.53">from the cash if it's there but it also</span> <span data-start="1841.53" data-end="1843.15">means you can't legitimately do a server</span> <span data-start="1843.15" data-end="1845.1">redirects if you're using app cache so</span> <span data-start="1845.1" data-end="1846.96">that means you can make redirect to</span> </p>
<p><span data-start="1846.96" data-end="1848.76">Twitter or Facebook for logins instead</span> <span data-start="1848.76" data-end="1849.539">you'll need provider</span> <span data-start="1849.539" data-end="1850.889">for the user to click on to do that</span> <span data-start="1850.889" data-end="1852.57">otherwise your it will count as a failed</span> <span data-start="1852.57" data-end="1855.33">request unfortunately when the the</span> <span data-start="1855.33" data-end="1857.639">fallback is used we're not told why</span> <span data-start="1857.639" data-end="1859.019">there's nothing the API it tells us why</span> <span data-start="1859.019" data-end="1860.22">that happened we can't tell the</span> <span data-start="1860.22" data-end="1862.83">difference between a mistyped URL and a</span> <span data-start="1862.83" data-end="1864.84">URL that the the user just doesn't have</span> <span data-start="1864.84" data-end="1866.609">cached offline and that makes our error</span> <span data-start="1866.609" data-end="1869.609">messages a little bit vague but that's</span> <span data-start="1869.609" data-end="1871.289">it really we've covered all of the</span> <span data-start="1871.289" data-end="1873.179">gotchas and it turns what's night offers</span> <span data-start="1873.179" data-end="1875.279">a very simple diagram into this big</span> <span data-start="1875.279" data-end="1878.429">horrible sprawling Christmas tree I</span> <span data-start="1878.429" data-end="1881.789">think of other diagram well the point</span> </p>
<p><span data-start="1881.789" data-end="1882.989">I've been trying to make a guess in in</span> <span data-start="1882.989" data-end="1884.7">the last 30 minutes is the application</span> <span data-start="1884.7" data-end="1887.249">cache is a douche bag as part of my</span> <span data-start="1887.249" data-end="1890.039">personal therapy at work I have a</span> <span data-start="1890.039" data-end="1891.649">selection of post-it notes on the wall I</span> <span data-start="1891.649" data-end="1895.259">have one for each browser and the theory</span> <span data-start="1895.259" data-end="1896.909">is I could draw a little against a</span> <span data-start="1896.909" data-end="1905.4">browser if it made my day unpleasant</span> <span data-start="1905.41" data-end="1907.69">but I had to create one just for the</span> <span data-start="1907.69" data-end="1909.31">application cache and it became what</span> <span data-start="1909.31" data-end="1911.2">could only be described as riddled with</span> <span data-start="1911.2" data-end="1917.11">very quickly but the application</span> <span data-start="1917.11" data-end="1918.28">very quickly but the application cache is actually extremely useful it</span> <span data-start="1918.28" data-end="1920.14">does stuff he does stuff like no other</span> <span data-start="1920.14" data-end="1921.7">feature can so we need to learn how to</span> <span data-start="1921.7" data-end="1923.53">work with him here's me a presence on a</span> <span data-start="1923.53" data-end="1924.85">page will change the behavior of the</span> <span data-start="1924.85" data-end="1926.5">site it's not really progressive</span> <span data-start="1926.5" data-end="1928.18">enhancement you need to build your whole</span> <span data-start="1928.18" data-end="1929.8">site around it which can be okay with</span> <span data-start="1929.8" data-end="1930.85">something like sprite cat which is</span> <span data-start="1930.85" data-end="1932.62">pretty small but for you know a big</span> <span data-start="1932.62" data-end="1934.57">slide such as lanyard you need to</span> <span data-start="1934.57" data-end="1937.57">sandbox sandboxing use the iframe trick</span> <span data-start="1937.57" data-end="1939.97">so you're only using the app cache of</span> <span data-start="1939.97" data-end="1941.74">the connection fails use the app cache</span> <span data-start="1941.74" data-end="1943.42">just for static files and then use</span> <span data-start="1943.42" data-end="1944.77">something like local storage for</span> <span data-start="1944.77" data-end="1946.39">anything optional probably in the future</span> <span data-start="1946.39" data-end="1948.1">you're going to use index DB instead for</span> <span data-start="1948.1" data-end="1949.83">because that'll be an asynchronous API</span> <span data-start="1949.83" data-end="1953.29">and that's it really oh thank you very</span> <span data-start="1953.29" data-end="1955.09">much my email address is there if you're</span> <span data-start="1955.09" data-end="1956.29">makassar just ask me questions in the</span> <span data-start="1956.29" data-end="1958.06">break whatever i'm on twitter a lot of</span> <span data-start="1958.06" data-end="1959.89">the demos and stuff or up on github and</span> <span data-start="1959.89" data-end="1962.88">the slides are online on language so</span> </p>
</section>