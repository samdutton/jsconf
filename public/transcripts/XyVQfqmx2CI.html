<section>
<p><span data-start="0.32" data-end="2.07">[Music]</span> <span data-start="2.07" data-end="3.84">[Applause]</span> <span data-start="3.84" data-end="5.66">[Music]</span> <span data-start="5.66" data-end="7.41">[Applause]</span> <span data-start="7.41" data-end="9.28">[Music]</span> <span data-start="9.28" data-end="11.02">[Applause]</span> <span data-start="11.02" data-end="12.78">[Music]</span> <span data-start="12.78" data-end="16.86">[Applause]</span> <span data-start="16.87" data-end="23.08">[Music]</span> <span data-start="23.08" data-end="25.77">[Applause]</span> <span data-start="25.77" data-end="27.16">well great</span> <span data-start="27.16" data-end="29.079">hello everyone I'm Christopher Baxter</span> <span data-start="29.079" data-end="31.27">and I'm multiple we're going to talk</span> <span data-start="31.27" data-end="33.28">about concurrency in JavaScript with a</span> <span data-start="33.28" data-end="35.649">particular focus on the Dom now</span> <span data-start="35.649" data-end="37.42">concurrency is a big topic it's maybe a</span> <span data-start="37.42" data-end="39.46">complicated topic so let's look at some</span> <span data-start="39.46" data-end="43">of the basics behind it currency is</span> <span data-start="43" data-end="44.65">really it's just a technical word for</span> <span data-start="44.65" data-end="46.09">multiple parts of a computer program</span> <span data-start="46.09" data-end="49.78">running at the same time now if your</span> <span data-start="49.78" data-end="52.72">computer or phone has more than one core</span> <span data-start="52.72" data-end="55.03">which it does or you have more than one</span> <span data-start="55.03" data-end="57.399">computer which the cloud does then this</span> <span data-start="57.399" data-end="59.91">can make things get done much faster</span> <span data-start="59.91" data-end="62.38">however it generally also makes things</span> <span data-start="62.38" data-end="64.439">way more complicated</span> <span data-start="64.439" data-end="67.149">speaking of concurrency you always kind</span> <span data-start="67.149" data-end="68.259">of have to talk about like the</span> <span data-start="68.259" data-end="69.79">difference between parallelism and</span> <span data-start="69.79" data-end="72.189">concurrency they're just the same thing</span> <span data-start="72.189" data-end="74.5">but someone in the 80s took away the</span> <span data-start="74.5" data-end="76.47">awesome word which is parallelism and</span> <span data-start="76.47" data-end="78.46">made it means something very specific</span> <span data-start="78.46" data-end="80.409">but that doesn't matter are we gonna say</span> <span data-start="80.409" data-end="81.37">parallelism and concurrency</span> <span data-start="81.37" data-end="84.52">interchangeable who cares so another</span> <span data-start="84.52" data-end="87.729">important concept are threats they're</span> <span data-start="87.729" data-end="90">just programs that run on a computer and</span> <span data-start="90" data-end="93.07">there can be more than one threat active</span> <span data-start="93.07" data-end="94.75">at any given time</span> <span data-start="94.75" data-end="98.56">now concurrency doesn't require multiple</span> <span data-start="98.56" data-end="101.5">threats for example network requests can</span> <span data-start="101.5" data-end="104.409">happen while your main thread is running</span> <span data-start="104.409" data-end="107.53">and so that's still a concurrent program</span> <span data-start="107.53" data-end="110.11">but if you have only one thread and your</span> <span data-start="110.11" data-end="112.689">program can only do one thing at a time</span> <span data-start="112.689" data-end="115.42">on a given device so we saw call such a</span> <span data-start="115.42" data-end="115.93">program</span> <span data-start="115.93" data-end="117.549">single threaded and that's an important</span> <span data-start="117.549" data-end="119.619">term because web browsers which we're</span> <span data-start="119.619" data-end="121.27">talking about today are traditionally</span> <span data-start="121.27" data-end="123.43">single threaded now today they're like</span> <span data-start="123.43" data-end="125.59">these complicated beasts and they do</span> <span data-start="125.59" data-end="127.6">many things at the same time but they</span> <span data-start="127.6" data-end="129.759">very much still behave as if there were</span> <span data-start="129.759" data-end="131.769">a single threaded so it's a good model</span> <span data-start="131.769" data-end="134.29">to have in your head the single thread</span> <span data-start="134.29" data-end="136.42">we call the main thread and very</span> <span data-start="136.42" data-end="137.829">important is this Jess confit your</span> </p>
<p><span data-start="137.829" data-end="140.38">JavaScript runs on the main threat by</span> <span data-start="140.38" data-end="142.72">default so if you write some JavaScript</span> <span data-start="142.72" data-end="144.58">and it's still running</span> <span data-start="144.58" data-end="146.59">your browser cannot do anything at the</span> <span data-start="146.59" data-end="149.53">same time which might be bad because oh</span> <span data-start="149.53" data-end="152.26">my god we have to achieve 60 frames per</span> <span data-start="152.26" data-end="154.93">second all the time where does his</span> <span data-start="154.93" data-end="155.68">number come from</span> <span data-start="155.68" data-end="157.36">that's basically the fundamental</span> <span data-start="157.36" data-end="160.57">constant of runtime performance</span> <span data-start="160.57" data-end="164.47">it's how often on a normal device your</span> <span data-start="164.47" data-end="166.66">graphics card would like to push pixels</span> <span data-start="166.66" data-end="170.92">to the screen now humans don't you know</span> <span data-start="170.92" data-end="172.87">bias to this particular framework frame</span> <span data-start="172.87" data-end="175.27">rate for example movies traditionally</span> <span data-start="175.27" data-end="176.68">run in the 24 frames per second</span> <span data-start="176.68" data-end="178.96">important is that they always run 24</span> <span data-start="178.96" data-end="181.06">frames per second humans are really good</span> <span data-start="181.06" data-end="184.15">at recognizing changes in frame rate if</span> <span data-start="184.15" data-end="186.37">frame rate isn't stable we call that</span> </p>
<p><span data-start="186.37" data-end="189.67">Jack and jank is really bad because it</span> <span data-start="189.67" data-end="195.22">makes our you know brains go wild now 60</span> <span data-start="195.22" data-end="196.87">frames per second leads to another magic</span> <span data-start="196.87" data-end="198.79">number which is 60 milliseconds that's</span> <span data-start="198.79" data-end="201.25">just 1,000 milliseconds in a second</span> <span data-start="201.25" data-end="204.28">divided by 60 which is what do you have</span> <span data-start="204.28" data-end="206.7">to update the screen right well</span> <span data-start="206.7" data-end="208.69">unfortunately it's more complicated so</span> <span data-start="208.69" data-end="211.51">there's you and then there is stuff the</span> <span data-start="211.51" data-end="212.92">browser does which is a layout style</span> <span data-start="212.92" data-end="214.63">calculation painting compositing</span> <span data-start="214.63" data-end="217.51">actually physically flipping the pixels</span> <span data-start="217.51" data-end="220.78">on the screen and everything in that 60</span> <span data-start="220.78" data-end="223.09">milliseconds has to fit into that kind</span> <span data-start="223.09" data-end="226.33">of budget great so let's break that down</span> <span data-start="226.33" data-end="228.34">a little bit because it's pretty darn</span> <span data-start="228.34" data-end="230.68">complicated you've got 16 milliseconds a</span> <span data-start="230.68" data-end="232.42">lot of code to execute and you're trying</span> <span data-start="232.42" data-end="233.68">to get it all done within this time</span> <span data-start="233.68" data-end="235.51">frame the important thing to remember</span> <span data-start="235.51" data-end="238.03">though is that's not just your code your</span> <span data-start="238.03" data-end="239.41">code runs for a certain amount of time</span> <span data-start="239.41" data-end="241.09">and the browser needs to respond to the</span> <span data-start="241.09" data-end="243.37">changes that you asked it to do as well</span> <span data-start="243.37" data-end="246.13">in that time frame and sometimes we</span> <span data-start="246.13" data-end="247.78">think about this as breaking it into two</span> <span data-start="247.78" data-end="250.3">eight millisecond segments the reason is</span> <span data-start="250.3" data-end="252.37">that the time that the browser needs is</span> <span data-start="252.37" data-end="254.14">kind of arbitrary we don't know that in</span> <span data-start="254.14" data-end="256.269">advance and so we shoot for pretty much</span> <span data-start="256.269" data-end="259.419">the worst case so what happens in this</span> <span data-start="259.419" data-end="261.94">eight milliseconds we have a lot of</span> <span data-start="261.94" data-end="264.13">stuff to do and let's hope it's not too</span> <span data-start="264.13" data-end="266.44">expensive we get a click event that</span> <span data-start="266.44" data-end="269.08">lands in our UI and after we get that</span> <span data-start="269.08" data-end="270.72">click event we need to process the event</span> <span data-start="270.72" data-end="273.28">now many traditional water and</span> <span data-start="273.28" data-end="275.41">frameworks will then do a state change</span> <span data-start="275.41" data-end="278.11">at this point so we need to determine</span> <span data-start="278.11" data-end="280.42">what that new state is going to be that</span> <span data-start="280.42" data-end="283.18">takes some time after we've created a</span> <span data-start="283.18" data-end="285.25">new state you need to respond to that</span> <span data-start="285.25" data-end="288.13">state so this response may be a virtual</span> </p>
<p><span data-start="288.13" data-end="290.8">Dom diff in some libraries or it may be</span> <span data-start="290.8" data-end="293.4">a direct mutation of elements and others</span> <span data-start="293.4" data-end="296.71">later we have to issue the direct Dom</span> <span data-start="296.71" data-end="299.77">updates it's a lot of work to fit in 8</span> <span data-start="299.77" data-end="301.87">milliseconds and we don't always make it</span> <span data-start="301.87" data-end="304.84">so what happens when we don't well we</span> <span data-start="304.84" data-end="307.6">push everything out so now instead of</span> <span data-start="307.6" data-end="309.16">being 8 milliseconds we're at 10</span> <span data-start="309.16" data-end="310.87">milliseconds in this example because my</span> <span data-start="310.87" data-end="312.94">state change process took two</span> <span data-start="312.94" data-end="315.73">milliseconds longer what does this mean</span> <span data-start="315.73" data-end="317.44">for the end user it's not that big of a</span> <span data-start="317.44" data-end="320.44">deal right what means that we went past</span> <span data-start="320.44" data-end="322.57">our frame budget because we took 10</span> <span data-start="322.57" data-end="324.73">milliseconds the browser really needs 8</span> <span data-start="324.73" data-end="328.36">we're now at 18 congratulations we've</span> <span data-start="328.36" data-end="330.4">unintentionally and produced a little</span> <span data-start="330.4" data-end="334.21">bit jank now don't feel bad we all do</span> <span data-start="334.21" data-end="336.25">this it's common it happens to all of</span> <span data-start="336.25" data-end="338.02">our applications just don't let it</span> <span data-start="338.02" data-end="341.14">happen too much right however it's hard</span> <span data-start="341.14" data-end="343.3">to keep this going and hard to make this</span> <span data-start="343.3" data-end="345.73">work well across all devices because you</span> <span data-start="345.73" data-end="347.62">can target the devices that you know but</span> <span data-start="347.62" data-end="348.97">you don't know the performance of your</span> <span data-start="348.97" data-end="353.35">application on unknown devices why well</span> <span data-start="353.35" data-end="355.48">because not all mobile devices are</span> <span data-start="355.48" data-end="356.35">created equal</span> <span data-start="356.35" data-end="358.36">we've got a plethora of devices that are</span> <span data-start="358.36" data-end="360.4">out in the world things from low-end</span> <span data-start="360.4" data-end="363.7">devices that are sold for $80 brand-new</span> <span data-start="363.7" data-end="366.85">to high-end devices at $1,000 per unit</span> <span data-start="366.85" data-end="369.55">and sometimes people hold on devices for</span> <span data-start="369.55" data-end="371.17">way longer than you would expect a</span> <span data-start="371.17" data-end="374.11">person buying a phone in 2016 is</span> <span data-start="374.11" data-end="375.55">probably still holding on to that phone</span> <span data-start="375.55" data-end="377.35">and the performance of that device has</span> <span data-start="377.35" data-end="379.65">not improved in fact it's gotten worse</span> <span data-start="379.65" data-end="382">so it's important to remember that the</span> <span data-start="382" data-end="383.44">things that you see are not everything</span> <span data-start="383.44" data-end="385.63">is not everything that a person using</span> <span data-start="385.63" data-end="389.68">your application sees so let's go into</span> <span data-start="389.68" data-end="392.56">this a little bit more in depth pretend</span> <span data-start="392.56" data-end="394.66">we're walking into a brand new big store</span> <span data-start="394.66" data-end="396.22">like a Best Buy and we're gonna buy a</span> <span data-start="396.22" data-end="399.31">new device today it's helpful to think</span> <span data-start="399.31" data-end="401.05">about a device that you're purchasing as</span> <span data-start="401.05" data-end="403.12">breaking down into one of three segments</span> <span data-start="403.12" data-end="405.58">the first segment the first the 15th</span> <span data-start="405.58" data-end="408.73">percentile is roughly around $80 so if</span> <span data-start="408.73" data-end="410.17">you were walking in today and you wanted</span> <span data-start="410.17" data-end="411.15">to spend around 80</span> <span data-start="411.15" data-end="412.74">you could afford a device in this</span> <span data-start="412.74" data-end="415.89">specific segment of the market the</span> <span data-start="415.89" data-end="418.11">second segment is around 75th percentile</span> <span data-start="418.11" data-end="419.61">where you're looking at spending close</span> <span data-start="419.61" data-end="422.52">to $600 that's a really large increase</span> <span data-start="422.52" data-end="425.76">and the third segment is the special</span> <span data-start="425.76" data-end="428.73">segment I would say because you're able</span> <span data-start="428.73" data-end="430.47">to spend a thousand dollars on this</span> <span data-start="430.47" data-end="432.72">device one device a thousand dollars</span> <span data-start="432.72" data-end="435.36">now this gamut of price is not normally</span> <span data-start="435.36" data-end="437.07">reflected in our metrics we tend to look</span> <span data-start="437.07" data-end="439.59">at things as a whole however if you</span> <span data-start="439.59" data-end="441.27">break things down into these segments</span> <span data-start="441.27" data-end="445.23">patterns start to emerge so let's look</span> <span data-start="445.23" data-end="446.84">at single core performance over time</span> <span data-start="446.84" data-end="449.25">this is a chart of all single core</span> <span data-start="449.25" data-end="451.95">performance of modern devices from 2011</span> <span data-start="451.95" data-end="453">to 2018</span> <span data-start="453" data-end="455.76">now the segment's are again highlighted</span> <span data-start="455.76" data-end="458.82">here so blue is the 15th percentile you</span> <span data-start="458.82" data-end="460.59">might notice that this trend line is not</span> <span data-start="460.59" data-end="462.99">going up and there's a reason for that</span> <span data-start="462.99" data-end="465.51">these devices are not becoming faster</span> <span data-start="465.51" data-end="467.31">they're becoming cheaper and more</span> <span data-start="467.31" data-end="469.83">accessible and more prolific across the</span> <span data-start="469.83" data-end="473.04">world these devices are not improving at</span> <span data-start="473.04" data-end="474.45">the rate that you would expect with</span> </p>
<p><span data-start="474.45" data-end="479.07">Moore's law the second category is that</span> <span data-start="479.07" data-end="481.41">75th percentile and this is a pretty</span> <span data-start="481.41" data-end="483.12">close approximation to what you would</span> <span data-start="483.12" data-end="485.34">expect from Moore's Law we're seeing an</span> <span data-start="485.34" data-end="487.32">improvement in performance over time and</span> <span data-start="487.32" data-end="489.66">these devices can even have specialized</span> <span data-start="489.66" data-end="491.94">hardware like a pixel does that allows</span> <span data-start="491.94" data-end="493.5">you to do say machine learning on the</span> <span data-start="493.5" data-end="497.52">device our third category is worth</span> <span data-start="497.52" data-end="499.62">talking about as well credit where</span> <span data-start="499.62" data-end="501.6">credit is due the a-series processors</span> <span data-start="501.6" data-end="505.11">are fantastic these things outperform</span> <span data-start="505.11" data-end="508.11">Moore's law by a dramatic amount but it</span> <span data-start="508.11" data-end="510.36">creates a very large problem for our</span> <span data-start="510.36" data-end="512.76">industry as a whole the problem is that</span> <span data-start="512.76" data-end="514.53">we take out the devices that we have in</span> <span data-start="514.53" data-end="517.05">our pockets and we test the things that</span> <span data-start="517.05" data-end="519.78">we build on these devices these devices</span> <span data-start="519.78" data-end="521.76">are not representation are not an</span> <span data-start="521.76" data-end="523.17">accurate representation of what's</span> <span data-start="523.17" data-end="525.27">available in the world or what many</span> <span data-start="525.27" data-end="528.84">people have so this particular gap hurts</span> <span data-start="528.84" data-end="531.45">end-users significantly and it's</span> <span data-start="531.45" data-end="533.61">important to remember this very large</span> <span data-start="533.61" data-end="536.15">performance gap this gap is increasing</span> <span data-start="536.15" data-end="540.14">not decreasing</span> <span data-start="540.15" data-end="542.94">there's to be some good news right we</span> <span data-start="542.94" data-end="544.44">wouldn't be talking about concurrency if</span> <span data-start="544.44" data-end="546.96">there wasn't some very small light at</span> <span data-start="546.96" data-end="548.85">the tunnel maybe at the end of the</span> <span data-start="548.85" data-end="549.27">tunnel</span> <span data-start="549.27" data-end="551.07">so what's multi-core performance look</span> <span data-start="551.07" data-end="553.02">like let's look at those same devices in</span> <span data-start="553.02" data-end="555.09">this first category the 15th percentile</span> <span data-start="555.09" data-end="557.19">you can see that the green trend line is</span> <span data-start="557.19" data-end="559.68">slightly improving compared to single</span> <span data-start="559.68" data-end="562.29">core performance there is one noticeable</span> <span data-start="562.29" data-end="564.12">exception at the very end of this line</span> <span data-start="564.12" data-end="566.55">the nokia — it's worth calling out</span> <span data-start="566.55" data-end="568.17">because there's a very popular phone</span> <span data-start="568.17" data-end="570.84">that you can buy for $80 in the United</span> </p>
<p><span data-start="570.84" data-end="574.74">States and it is selling like crazy but</span> <span data-start="574.74" data-end="579.36">it can't be that bad right I want you to</span> <span data-start="579.36" data-end="581.49">bear with me we're about to watch a very</span> <span data-start="581.49" data-end="586.23">long video but it's worth the time here</span> <span data-start="586.23" data-end="588.99">I have two devices an iPhone on the left</span> <span data-start="588.99" data-end="591.72">and an unnamed device on the right you</span> <span data-start="591.72" data-end="596.01">name it it's a Nokia — this test the</span> </p>
<p><span data-start="596.01" data-end="598.92">Ares 6 test tests modern JavaScript</span> <span data-start="598.92" data-end="600.84">features for instance one of the things</span> <span data-start="600.84" data-end="602.73">that it runs is a Babel transpilation on</span> <span data-start="602.73" data-end="606.18">the device you might criticize that test</span> <span data-start="606.18" data-end="607.71">by saying no one will run Babel on a</span> <span data-start="607.71" data-end="609.12">mobile phone and you're right for</span> <span data-start="609.12" data-end="611.58">criticizing it however it is a good</span> <span data-start="611.58" data-end="613.74">representation of what runtime</span> <span data-start="613.74" data-end="615.78">performance is like there's no load</span> <span data-start="615.78" data-end="618">involved there's no network involved</span> <span data-start="618" data-end="620.61">it's pure capabilities of the local</span> <span data-start="620.61" data-end="623.73">device and it's entirely single core</span> <span data-start="623.73" data-end="627.06">focused so we've got the iPhone here on</span> <span data-start="627.06" data-end="628.62">the Left it's gonna finish this test</span> <span data-start="628.62" data-end="631.23">pretty soon all six passes of the test</span> <span data-start="631.23" data-end="633.53">are gonna finish at roughly 48 seconds</span> <span data-start="633.53" data-end="636.12">now I'm going to speed it up a little</span> <span data-start="636.12" data-end="638.73">bit because it's a bit painful the nokia</span> <span data-start="638.73" data-end="640.77">2 is gonna be running this test for a</span> <span data-start="640.77" data-end="643.02">while longer and we're just gonna wait a</span> <span data-start="643.02" data-end="650.55">couple minutes okay now sped it up eight</span> <span data-start="650.55" data-end="656.25">times we still haven't finished one pass</span> <span data-start="656.25" data-end="661.89">of six or six classes</span> <span data-start="661.9" data-end="672.79">it hasn't crashed I promise a-alright</span> <span data-start="672.79" data-end="676.51">five minutes and 19 seconds for one of</span> <span data-start="676.51" data-end="680.77">six passes that's pretty bad</span> <span data-start="680.77" data-end="682.33">but that's what a lot of people's</span> <span data-start="682.33" data-end="683.98">devices are like and that's all what a</span> <span data-start="683.98" data-end="686.02">lot of people are entering the internet</span> <span data-start="686.02" data-end="689.83">using for the first time all right so</span> <span data-start="689.83" data-end="692.14">what I kind of took out of these graphs</span> <span data-start="692.14" data-end="695.38">is performance is not evenly distributed</span> <span data-start="695.38" data-end="697.87">but there is a chance to get a little</span> <span data-start="697.87" data-end="699.67">bit more of the devices but taking</span> <span data-start="699.67" data-end="702.31">advantage of their multiple cores so how</span> <span data-start="702.31" data-end="705.13">do we do that in JavaScript well super</span> <span data-start="705.13" data-end="707.05">excited to announce super amazing new</span> </p>
<p><span data-start="707.05" data-end="709.78">API on it called the web worker which</span> <span data-start="709.78" data-end="714.61">has actually been around since 2009 do</span> <span data-start="714.61" data-end="720.59">folks remember Ajax Ian</span> <span data-start="720.6" data-end="723.4">if the Ajax iam wrote about something</span> <span data-start="723.4" data-end="724.69">you have to check whether it's still</span> <span data-start="724.69" data-end="726.25">supported not where the browser supports</span> <span data-start="726.25" data-end="728.98">it this is this API is in every browser</span> <span data-start="728.98" data-end="730.03">it's in ie8</span> <span data-start="730.03" data-end="732.1">it's not a 96 all right so it's not in</span> <span data-start="732.1" data-end="734.02">every browser but it is in every browser</span> <span data-start="734.02" data-end="735.88">you care about we can really take</span> <span data-start="735.88" data-end="738.1">advantage of it so what are they they</span> <span data-start="738.1" data-end="740.68">are a way to write multivariate</span> </p>
<p><span data-start="740.68" data-end="743.05">JavaScript in web browsers now you've</span> <span data-start="743.05" data-end="744.34">probably heard that multi-threading can</span> <span data-start="744.34" data-end="746.68">be like dangerous and memory unsafe so</span> <span data-start="746.68" data-end="748.69">this is not the case here workers share</span> <span data-start="748.69" data-end="752.08">no state at all with each other or the</span> <span data-start="752.08" data-end="756.37">main threat they have only access to</span> <span data-start="756.37" data-end="758.95">very limited set of API so they can't do</span> <span data-start="758.95" data-end="760.57">everything you can do on the main thread</span> <span data-start="760.57" data-end="763.06">and and it's very important for this</span> <span data-start="763.06" data-end="765.46">presentation they do not have access to</span> <span data-start="765.46" data-end="767.26">the Dom and we're talking about</span> <span data-start="767.26" data-end="771.1">concurrency in the Dom so sad face let's</span> <span data-start="771.1" data-end="773.14">take a look at how that API looks like</span> <span data-start="773.14" data-end="775.12">the worker you know you just make a</span> <span data-start="775.12" data-end="776.74">worker or you give it a Java file and</span> <span data-start="776.74" data-end="779.14">then it runs and you can send it</span> <span data-start="779.14" data-end="782.05">messages this post message this kind of</span> <span data-start="782.05" data-end="783.31">usually looks like this you know you get</span> <span data-start="783.31" data-end="784.96">some event you send a message to the</span> <span data-start="784.96" data-end="786.82">worker the worker receives a message</span> <span data-start="786.82" data-end="789.28">does some computation sense us back we</span> <span data-start="789.28" data-end="791.41">receive it back we have to compute it I</span> <span data-start="791.41" data-end="794.77">think one of the main things here is we</span> <span data-start="794.77" data-end="795.63">have to</span> <span data-start="795.63" data-end="798.09">be very conscience the right coat like</span> <span data-start="798.09" data-end="800.19">this we have to measure that we have to</span> <span data-start="800.19" data-end="804.09">we have to you know do the work ten</span> <span data-start="804.09" data-end="805.95">years of adoption have shown that this</span> <span data-start="805.95" data-end="807.66">is not something we do very often right</span> <span data-start="807.66" data-end="808.8">so there's a problem with this</span> <span data-start="808.8" data-end="812.31">programming model so the primitives to</span> <span data-start="812.31" data-end="814.47">low level is there something a bit more</span> <span data-start="814.47" data-end="817.23">abstracted perhaps usable in comparison</span> </p>
<p><span data-start="817.23" data-end="819.21">I'd like to go over a few things that</span> <span data-start="819.21" data-end="821.18">are showing some progress in this space</span> <span data-start="821.18" data-end="823.74">first ones called Cluny it's made by the</span> <span data-start="823.74" data-end="826.8">chrome team the way that it works is the</span> <span data-start="826.8" data-end="828.54">JavaScript you want to run in a separate</span> <span data-start="828.54" data-end="830.67">thread is actually loaded with your main</span> <span data-start="830.67" data-end="833.22">thread JavaScript so in this case we</span> <span data-start="833.22" data-end="835.02">have a class that exists within the main</span> <span data-start="835.02" data-end="837.15">thread but using Cluny were able to</span> <span data-start="837.15" data-end="839.91">spawn an instance of that that class</span> <span data-start="839.91" data-end="842.67">that runs entirely in the worker so what</span> <span data-start="842.67" data-end="844.32">happens is Cluny underneath the hood</span> <span data-start="844.32" data-end="846.96">creates a web worker for you sends over</span> <span data-start="846.96" data-end="848.46">the JavaScript that it needs to be able</span> <span data-start="848.46" data-end="849.87">to execute in the worker and you can</span> <span data-start="849.87" data-end="854.31">just await its response but it would be</span> <span data-start="854.31" data-end="856.23">great if this was actually in the</span> <span data-start="856.23" data-end="858.48">browser itself right this is something</span> <span data-start="858.48" data-end="859.62">that feels like it should be an echo</span> <span data-start="859.62" data-end="862.02">echo script level spec so there's a few</span> <span data-start="862.02" data-end="863.55">specification outs that are that are</span> <span data-start="863.55" data-end="866.1">trying to bring this to Ahmed script the</span> <span data-start="866.1" data-end="867.57">one that I think is the most interesting</span> <span data-start="867.57" data-end="870.33">is called Jas blocks but it has an M lot</span> <span data-start="870.33" data-end="872.28">above the O so I don't know how to guess</span> <span data-start="872.28" data-end="877.83">blex ducts whatever he said so the way</span> <span data-start="877.83" data-end="879.63">that this one works is very similar to</span> <span data-start="879.63" data-end="881.88">the last example in the sense that the</span> <span data-start="881.88" data-end="883.8">block that we're defining here that has</span> <span data-start="883.8" data-end="886.37">this additional straight lines is</span> <span data-start="886.37" data-end="888.87">indicates that this piece specific piece</span> <span data-start="888.87" data-end="891.78">of code can run in any thread it may run</span> <span data-start="891.78" data-end="893.19">in the main thread and may run in a</span> <span data-start="893.19" data-end="894.57">different thread it's up to the browser</span> <span data-start="894.57" data-end="896.52">runtime or the JavaScript runtime in</span> <span data-start="896.52" data-end="898.95">this case to determine based on system</span> <span data-start="898.95" data-end="901.65">resources where this should run but this</span> <span data-start="901.65" data-end="903.12">presents a pretty big problem in</span> </p>
<p><span data-start="903.12" data-end="905.31">JavaScript because this thing wouldn't</span> <span data-start="905.31" data-end="907.83">have access to lexical scope it only</span> <span data-start="907.83" data-end="909.87">knows about the scope of its current</span> <span data-start="909.87" data-end="911.37">block it can't know about anything</span> <span data-start="911.37" data-end="913.08">outside of it because it may not run in</span> <span data-start="913.08" data-end="915.63">the same thread well the proposal</span> <span data-start="915.63" data-end="917.64">provides some syntax to allow you to</span> <span data-start="917.64" data-end="919.35">specify the things that you would like</span> <span data-start="919.35" data-end="921.33">to ensure are available in that within</span> <span data-start="921.33" data-end="923.37">that specific block in this case</span> <span data-start="923.37" data-end="924.93">something that looks a little bit like</span> <span data-start="924.93" data-end="928.39">typescript is included so you can say</span> <span data-start="928.39" data-end="930.13">for this specific worker instance I'd</span> <span data-start="930.13" data-end="932.17">like to make sure the end point dogs are</span> <span data-start="932.17" data-end="936.519">best is passed along let's look at</span> <span data-start="936.519" data-end="938.62">something a little bit more easy to use</span> <span data-start="938.62" data-end="940.54">straightforward applies to many of our</span> <span data-start="940.54" data-end="943.12">applications today many of us use redux</span> <span data-start="943.12" data-end="945.01">in this room and many of us across the</span> <span data-start="945.01" data-end="947.05">globe use it from really great earlier</span> <span data-start="947.05" data-end="951.37">talk today so redux is pretty powerful</span> <span data-start="951.37" data-end="953.8">but it runs in the main thread so what</span> <span data-start="953.8" data-end="955.48">happens in that earlier model is we</span> <span data-start="955.48" data-end="957.37">would need to run our entire Redux store</span> <span data-start="957.37" data-end="959.709">and reducers for all of those actions in</span> <span data-start="959.709" data-end="962.019">the main thread stockroom from Jason</span> </p>
<p><span data-start="962.019" data-end="964.12">Miller is very similar to redux except</span> <span data-start="964.12" data-end="966.79">that it runs in a worker so your main</span> <span data-start="966.79" data-end="969.25">thread code subscribes to updates that</span> <span data-start="969.25" data-end="971.23">come from your Redux store but your</span> <span data-start="971.23" data-end="974.769">networking requests and your redux kind</span> <span data-start="974.769" data-end="976.839">of massaging of data happens entirely</span> <span data-start="976.839" data-end="979.24">off the main thread this can free up a</span> <span data-start="979.24" data-end="980.86">significant amount of your time and a</span> <span data-start="980.86" data-end="985.029">web app that uses redux heavily but I</span> <span data-start="985.029" data-end="987.19">thought this talk was about the Dom you</span> <span data-start="987.19" data-end="989.35">are absolutely right</span> <span data-start="989.35" data-end="993.43">so Malta yeah so as I said earlier the</span> <span data-start="993.43" data-end="995.85">workers cannot have access to the Dom</span> <span data-start="995.85" data-end="998.05">which is said and so I'm super excited</span> <span data-start="998.05" data-end="999.459">to announce that we're releasing a</span> <span data-start="999.459" data-end="1002.82">library called worker Dom which exposed</span> <span data-start="1002.82" data-end="1004.829">the same Dom API that you know love to</span> <span data-start="1004.829" data-end="1007.49">you and the frameworks in a web worker</span> <span data-start="1007.49" data-end="1009.899">let's take a look at the original</span> <span data-start="1009.899" data-end="1013.17">requirements when we went about kind of</span> <span data-start="1013.17" data-end="1014.82">building this library I was like hey</span> </p>
<p><span data-start="1014.82" data-end="1016.949">Chris can you make it said react works</span> <span data-start="1016.949" data-end="1018.81">in the web worker and that was really</span> <span data-start="1018.81" data-end="1024.209">all I wanted but I think grace was yeah</span> <span data-start="1024.209" data-end="1026.79">you know first the fun of that let's do</span> <span data-start="1026.79" data-end="1028.199">something more abstract let's do</span> <span data-start="1028.199" data-end="1029.91">something that supports the whole</span> <span data-start="1029.91" data-end="1032.549">variety of web programming so what is</span> <span data-start="1032.549" data-end="1036.11">worker DOM and makes the full Dom API</span> <span data-start="1036.11" data-end="1039.209">available to what worker effectively</span> <span data-start="1039.209" data-end="1040.709">this means that you can use your</span> <span data-start="1040.709" data-end="1043.049">existing web app and run in the web</span> <span data-start="1043.049" data-end="1046.47">worker and it just works with some terms</span> <span data-start="1046.47" data-end="1048.99">and conditions obviously</span> <span data-start="1048.99" data-end="1051.97">but you know we'll go in there let's</span> <span data-start="1051.97" data-end="1053.35">look at the use cases you can use this</span> <span data-start="1053.35" data-end="1056.4">to speed up your existing yep app yay</span> <span data-start="1056.4" data-end="1059.2">framework authors can use it to speed up</span> <span data-start="1059.2" data-end="1060.94">their existing framework with making</span> <span data-start="1060.94" data-end="1064.09">minor changes and one particular use</span> <span data-start="1064.09" data-end="1066.01">case done I'm very excited about you've</span> <span data-start="1066.01" data-end="1067.6">probably heard that third-party</span> </p>
<p><span data-start="1067.6" data-end="1069.88">JavaScript other people JavaScript like</span> <span data-start="1069.88" data-end="1072.46">your analytics framework that's you know</span> <span data-start="1072.46" data-end="1073.96">they're a problem for your site because</span> <span data-start="1073.96" data-end="1075.52">you can control them and they might do</span> <span data-start="1075.52" data-end="1077.53">bad things wouldn't be nice if you just</span> <span data-start="1077.53" data-end="1079.42">ran them on a worker and they kind of</span> <span data-start="1079.42" data-end="1081.07">did their own thing but they couldn't</span> <span data-start="1081.07" data-end="1083.2">touch your code I think this is an</span> <span data-start="1083.2" data-end="1085.12">amazing use case where this library</span> <span data-start="1085.12" data-end="1087.61">could be super powerful all right let's</span> <span data-start="1087.61" data-end="1089.97">take a look what it does to your program</span> <span data-start="1089.97" data-end="1092.86">coming back to this example that Chris</span> <span data-start="1092.86" data-end="1095.65">introduced earlier so you know we have</span> <span data-start="1095.65" data-end="1097.18">this main thread and we're doing event</span> <span data-start="1097.18" data-end="1098.77">processing state determination</span> <span data-start="1098.77" data-end="1100.99">processing dumb issues the browser</span> <span data-start="1100.99" data-end="1103.78">doesn't work and those things they added</span> <span data-start="1103.78" data-end="1106.63">up to 18 milliseconds there's a second</span> <span data-start="1106.63" data-end="1108.13">number there it was just the latency</span> <span data-start="1108.13" data-end="1110.53">which is 80 milliseconds took 18</span> <span data-start="1110.53" data-end="1112.51">milliseconds to react to a user action</span> <span data-start="1112.51" data-end="1114.85">that's yellow because that is actually</span> <span data-start="1114.85" data-end="1116.56">okay if you're familiar with the rails</span> <span data-start="1116.56" data-end="1118.3">model for example actually gives us 50</span> <span data-start="1118.3" data-end="1120.49">milliseconds to react to the user so</span> <span data-start="1120.49" data-end="1123.67">that's kind of cool right so but we're</span> <span data-start="1123.67" data-end="1127.39">janky so let's introduce worker Dom the</span> <span data-start="1127.39" data-end="1128.65">first three steps a free application</span> <span data-start="1128.65" data-end="1130.69">without changing them go into a</span> <span data-start="1130.69" data-end="1133">background thread now the whole thing</span> <span data-start="1133" data-end="1135.25">still takes 18 milliseconds no change</span> <span data-start="1135.25" data-end="1138.52">there but the stuff that actually is on</span> <span data-start="1138.52" data-end="1140.86">the main thread is now massively reduced</span> <span data-start="1140.86" data-end="1142.99">we're now at 10 milliseconds which is</span> <span data-start="1142.99" data-end="1145.81">silky smooth and I think the important</span> <span data-start="1145.81" data-end="1148.57">part here is that we're now far away</span> <span data-start="1148.57" data-end="1152.2">from breaking through the barrier of 60</span> <span data-start="1152.2" data-end="1154.42">milliseconds right so now we can run on</span> <span data-start="1154.42" data-end="1156.25">a slower device and we still have a lot</span> <span data-start="1156.25" data-end="1158.5">of budget to go to make it there right</span> <span data-start="1158.5" data-end="1160.09">if we're if we're just about like</span> <span data-start="1160.09" data-end="1162.28">scraping against that 16 m/s on an</span> <span data-start="1162.28" data-end="1165.82">iPhone X it's not gonna go well and then</span> <span data-start="1165.82" data-end="1167.44">in the wild so I think this is really</span> <span data-start="1167.44" data-end="1169.81">like a very promising way of building up</span> <span data-start="1169.81" data-end="1171.19">vacation I'm excited to see how that's</span> <span data-start="1171.19" data-end="1175.09">going to go out let's look at those</span> <span data-start="1175.09" data-end="1178.45">terms and conditions really quick now</span> <span data-start="1178.45" data-end="1180.04">the library isn't like hundreds and done</span> <span data-start="1180.04" data-end="1182.44">so some Dom API design implement</span> <span data-start="1182.44" data-end="1184.57">that's cool because you know we can just</span> <span data-start="1184.57" data-end="1187.96">do it there are a small number of dumb</span> </p>
<p><span data-start="1187.96" data-end="1190.33">API is that cannot be implemented but</span> <span data-start="1190.33" data-end="1191.8">there are there are alternatives</span> <span data-start="1191.8" data-end="1194.53">provided and then there's a smaller</span> <span data-start="1194.53" data-end="1196.09">number of Dom API which can't be</span> <span data-start="1196.09" data-end="1198.73">implemented and worker Dom can't really</span> <span data-start="1198.73" data-end="1201.01">work with them at all so let's take a</span> <span data-start="1201.01" data-end="1202.65">quick look at those last two categories</span> <span data-start="1202.65" data-end="1205.99">first of all there unimplemented but</span> <span data-start="1205.99" data-end="1207.73">there is an alternative these are</span> <span data-start="1207.73" data-end="1209.98">primarily dumb api's that provide</span> <span data-start="1209.98" data-end="1211.93">synchronous access to stuff like</span> <span data-start="1211.93" data-end="1213.94">completed layout of a page so for</span> <span data-start="1213.94" data-end="1216.46">example API many of you will be familiar</span> <span data-start="1216.46" data-end="1219.01">with it compounding client rekt so like</span> <span data-start="1219.01" data-end="1221.26">hey browser how big is this diff right</span> <span data-start="1221.26" data-end="1224.32">when you call that function in the main</span> <span data-start="1224.32" data-end="1225.94">thread what the browser will do is will</span> <span data-start="1225.94" data-end="1228.43">go run its entire layout pipeline if</span> <span data-start="1228.43" data-end="1230.98">that's necessary and it's good like full</span> <span data-start="1230.98" data-end="1232.18">in the browser go all the way back and</span> <span data-start="1232.18" data-end="1235.39">that's all synchronous that's not</span> <span data-start="1235.39" data-end="1236.83">implementable in a worker because</span> <span data-start="1236.83" data-end="1239.77">there's no sink access to the Dom so</span> <span data-start="1239.77" data-end="1241.78">what we do instead we provide</span> <span data-start="1241.78" data-end="1243.49">alternatives they all have a async</span> <span data-start="1243.49" data-end="1245.77">suffix so like get burning client direct</span> <span data-start="1245.77" data-end="1248.38">async and the returns a promise now you</span> <span data-start="1248.38" data-end="1249.58">don't have to change your program much</span> <span data-start="1249.58" data-end="1252.01">you just at the async suffix add an</span> <span data-start="1252.01" data-end="1254.5">evade before you're using a single way</span> <span data-start="1254.5" data-end="1257.05">you should and your program works again</span> <span data-start="1257.05" data-end="1258.91">all right so it's a minor change and</span> <span data-start="1258.91" data-end="1261.82">there's an important side benefit if you</span> <span data-start="1261.82" data-end="1264.04">go and optimize the application one of</span> <span data-start="1264.04" data-end="1265.33">the things you're looking out for is</span> <span data-start="1265.33" data-end="1267.88">that you don't make these sync layout</span> <span data-start="1267.88" data-end="1270.31">calls more than once in a given frame</span> <span data-start="1270.31" data-end="1272.95">see if you've make that call it changed</span> <span data-start="1272.95" data-end="1274.03">something make a call again you pay a</span> <span data-start="1274.03" data-end="1276.73">choice if you order syncs the right way</span> <span data-start="1276.73" data-end="1279.55">you only pay it once so by switching to</span> <span data-start="1279.55" data-end="1281.59">this async model the framework can</span> <span data-start="1281.59" data-end="1283">actually schedule stuff at the right</span> <span data-start="1283" data-end="1284.74">time without you having to worry about</span> <span data-start="1284.74" data-end="1286.54">it which is a much more scalable problem</span> <span data-start="1286.54" data-end="1287.53">so I think this is the right direction</span> <span data-start="1287.53" data-end="1290.59">for the Dom to go anyway these old</span> <span data-start="1290.59" data-end="1292.78">synchronous API is from in 1990 it's</span> <span data-start="1292.78" data-end="1295.36">just not the right way to do it all</span> <span data-start="1295.36" data-end="1295.57">right</span> </p>
<p><span data-start="1295.57" data-end="1298.11">I'm implementable without an alternative</span> <span data-start="1298.11" data-end="1300.73">these are primarily synchronous methods</span> <span data-start="1300.73" data-end="1302.68">on the event like prevent default and</span> <span data-start="1302.68" data-end="1305.38">stop propagation now the browser's event</span> <span data-start="1305.38" data-end="1307.09">processing model is inherently</span> <span data-start="1307.09" data-end="1309.82">synchronous and that means by the time</span> <span data-start="1309.82" data-end="1311.31">the worker learns about the click event</span> <span data-start="1311.31" data-end="1313.73">entire browser eventually</span> <span data-start="1313.73" data-end="1316.039">and that means that you you know you</span> <span data-start="1316.039" data-end="1317.779">might call stop propagation but that</span> <span data-start="1317.779" data-end="1319.279">doesn't do anything because you know</span> <span data-start="1319.279" data-end="1320.899">event processing already rents mean</span> <span data-start="1320.899" data-end="1323.21">nothing you can do there's actually</span> <span data-start="1323.21" data-end="1324.11">light at the end of the tunnel</span> <span data-start="1324.11" data-end="1325.88">transferable events are a thing that</span> <span data-start="1325.88" data-end="1327.95">might come to browser soon and that</span> <span data-start="1327.95" data-end="1329.929">would kind of fix this situation but for</span> <span data-start="1329.929" data-end="1331.73">now basically what it means if you need</span> <span data-start="1331.73" data-end="1333.769">these api's and think you know about</span> <span data-start="1333.769" data-end="1335.419">your last application how often you</span> <span data-start="1335.419" data-end="1336.529">actually call them it's not that much</span> <span data-start="1336.529" data-end="1338.36">you have to run that a little bit of a</span> <span data-start="1338.36" data-end="1340.85">code on the main thread to make sure</span> <span data-start="1340.85" data-end="1344.029">it's the work speaking of working how</span> <span data-start="1344.029" data-end="1346.61">does this library actually work so we</span> <span data-start="1346.61" data-end="1347.96">don't need to understand all of the guts</span> <span data-start="1347.96" data-end="1349.37">of this thing but I thought it'd be</span> <span data-start="1349.37" data-end="1350.659">helpful to go over the kind of the</span> <span data-start="1350.659" data-end="1352.13">high-level as well as some of the</span> <span data-start="1352.13" data-end="1353.57">details that I thought were particularly</span> <span data-start="1353.57" data-end="1356.149">interesting during the implementation so</span> <span data-start="1356.149" data-end="1358.49">let's start with a high-level we start</span> <span data-start="1358.49" data-end="1359.72">off with a main thread in a worker</span> <span data-start="1359.72" data-end="1361.46">thread on the main thread we have a</span> <span data-start="1361.46" data-end="1363.289">runtime roughly one kilobyte of</span> </p>
<p><span data-start="1363.289" data-end="1365.809">JavaScript and this runtime is able to</span> <span data-start="1365.809" data-end="1367.85">look at what the DOM is on the current</span> <span data-start="1367.85" data-end="1370.07">page in this case we have an element an</span> <span data-start="1370.07" data-end="1371.389">HTML element that we would like to</span> <span data-start="1371.389" data-end="1373.549">upgrade to run in within the worker</span> <span data-start="1373.549" data-end="1375.559">context and inside of that just a single</span> <span data-start="1375.559" data-end="1378.289">dip just to make things simple so the</span> <span data-start="1378.289" data-end="1380.33">first thing that happens is the runtime</span> <span data-start="1380.33" data-end="1383.45">will create a worker for you and load</span> <span data-start="1383.45" data-end="1386.57">your JavaScript within that worker now</span> <span data-start="1386.57" data-end="1388.669">worker Dom exists within the worker</span> <span data-start="1388.669" data-end="1390.529">thread and is able to start processing</span> <span data-start="1390.529" data-end="1393.83">your code at this point your code will</span> <span data-start="1393.83" data-end="1395.48">create the Dom structure that it would</span> <span data-start="1395.48" data-end="1397.7">like to have in the document so we have</span> <span data-start="1397.7" data-end="1400.19">a document with our HTML div element and</span> <span data-start="1400.19" data-end="1402.74">then there's a lull your code is</span> <span data-start="1402.74" data-end="1405.38">finished performing an update to the Dom</span> <span data-start="1405.38" data-end="1408.35">in this case we consider hydration so we</span> <span data-start="1408.35" data-end="1409.82">might we make sure that that message is</span> <span data-start="1409.82" data-end="1411.59">passed along over and applied to the</span> <span data-start="1411.59" data-end="1414.11">main thread later as you have input</span> <span data-start="1414.11" data-end="1416.09">events or things that need to you take</span> <span data-start="1416.09" data-end="1418.909">the Dom like click handlers you will</span> <span data-start="1418.909" data-end="1421.82">allow mutations to occur this is very</span> <span data-start="1421.82" data-end="1423.649">simple high level and kind of explains</span> <span data-start="1423.649" data-end="1425.44">what worker Dom does and how it operates</span> <span data-start="1425.44" data-end="1427.669">but let's dive in a little bit more on</span> <span data-start="1427.669" data-end="1430.76">hydration so what is hydration hydration</span> <span data-start="1430.76" data-end="1433.73">is the conversion of string markup into</span> <span data-start="1433.73" data-end="1435.83">usable Dom nodes a helpful way to</span> <span data-start="1435.83" data-end="1437.24">understand this is to look at how the</span> <span data-start="1437.24" data-end="1439.159">browser actually does this with its</span> <span data-start="1439.159" data-end="1440.95">tokenizer</span> <span data-start="1440.95" data-end="1443.24">pretend that we have a section element</span> <span data-start="1443.24" data-end="1445.01">and in this case because we're using</span> <span data-start="1445.01" data-end="1447.65">worker Dom it has an attribute source</span> <span data-start="1447.65" data-end="1449.45">that points to the javascript file of</span> <span data-start="1449.45" data-end="1452.33">your JavaScript that is actually</span> <span data-start="1452.33" data-end="1453.92">represented in the Dom as an HTML</span> <span data-start="1453.92" data-end="1457.1">section element inside that we have a</span> </p>
<p><span data-start="1457.1" data-end="1459.26">HTML div element because I'm pretty bad</span> <span data-start="1459.26" data-end="1461.93">at semantic markup and inside of here</span> <span data-start="1461.93" data-end="1464.06">we'll have three child nodes a text node</span> <span data-start="1464.06" data-end="1467.3">that says hello world followed by a span</span> <span data-start="1467.3" data-end="1469.61">HTML span element with some text inside</span> <span data-start="1469.61" data-end="1473.11">of it that says spanner and lastly an</span> <span data-start="1473.11" data-end="1477.02">HTML input element so this is how the</span> <span data-start="1477.02" data-end="1478.88">browser would tokenize these specific</span> <span data-start="1478.88" data-end="1481.25">elements into Dom structures worker Dom</span> <span data-start="1481.25" data-end="1484.46">does roughly the same thing however we</span> <span data-start="1484.46" data-end="1485.69">need to be able to transmit these</span> <span data-start="1485.69" data-end="1487.82">objects between threads so we need a</span> <span data-start="1487.82" data-end="1490.07">single interface that makes it easy to</span> <span data-start="1490.07" data-end="1492.26">transmit this information that we so we</span> <span data-start="1492.26" data-end="1493.37">don't have to have all of these</span> <span data-start="1493.37" data-end="1495.74">different class types to understand</span> <span data-start="1495.74" data-end="1498.02">between threads so in this case our div</span> <span data-start="1498.02" data-end="1500">can be represented as a hydrate Abul</span> <span data-start="1500" data-end="1502.28">node it's got an element type of note</span> <span data-start="1502.28" data-end="1505.34">the node type is an element node the tag</span> <span data-start="1505.34" data-end="1507.83">name is div we need a unique identifier</span> <span data-start="1507.83" data-end="1509.6">so we can reference that node on both</span> <span data-start="1509.6" data-end="1511.49">sides of the bridge and whether or not</span> <span data-start="1511.49" data-end="1512.78">it's been transferred is actually</span> <span data-start="1512.78" data-end="1514.88">incredibly important because once it's</span> <span data-start="1514.88" data-end="1517.04">been transferred the format doesn't need</span> <span data-start="1517.04" data-end="1519.17">to be as verbose we only need to send a</span> <span data-start="1519.17" data-end="1520.73">very small amount of information once</span> <span data-start="1520.73" data-end="1525.65">we've transferred it once so we are able</span> <span data-start="1525.65" data-end="1527.24">to convert that div element over to a</span> <span data-start="1527.24" data-end="1529.01">hydrate able node and you can see how we</span> <span data-start="1529.01" data-end="1530.63">could take the same pattern and apply it</span> <span data-start="1530.63" data-end="1533.09">to the rest of this Dom structure so now</span> <span data-start="1533.09" data-end="1534.74">we're looking at a tree of entirely</span> <span data-start="1534.74" data-end="1537.44">hydrate Abul nodes this structure is</span> <span data-start="1537.44" data-end="1539.48">transferable between threads and allows</span> <span data-start="1539.48" data-end="1541.07">us to send the information in an</span> <span data-start="1541.07" data-end="1545.66">efficient way so let's look at an actual</span> <span data-start="1545.66" data-end="1547.94">example here's a JSON representation of</span> <span data-start="1547.94" data-end="1550.28">that interface I've got the node type</span> <span data-start="1550.28" data-end="1552.65">here the node name child nodes that</span> <span data-start="1552.65" data-end="1554.59">there's only a single child in this case</span> <span data-start="1554.59" data-end="1557.48">and that unique identifier our index and</span> <span data-start="1557.48" data-end="1559.91">transferred false so something we've</span> <span data-start="1559.91" data-end="1561.95">learned about web workers in this is</span> <span data-start="1561.95" data-end="1563.99">that given the same complexity of your</span> <span data-start="1563.99" data-end="1567.02">messages a smaller size transmits faster</span> <span data-start="1567.02" data-end="1569.15">and is more responsive to end user input</span> <span data-start="1569.15" data-end="1571.58">so we need to do some work too this</span> <span data-start="1571.58" data-end="1573.29">means this format to ensure that it</span> <span data-start="1573.29" data-end="1575.27">remains small independent of the number</span> <span data-start="1575.27" data-end="1578.09">of nodes that you give it so we apply a</span> <span data-start="1578.09" data-end="1580.22">substitution cipher which is just a</span> <span data-start="1580.22" data-end="1580.98">fancy term for</span> <span data-start="1580.98" data-end="1584.34">replacement to no name node the node</span> <span data-start="1584.34" data-end="1586.919">type child nodes index and transferred</span> <span data-start="1586.919" data-end="1588.99">these are all static keys that we</span> <span data-start="1588.99" data-end="1591.72">restore and allow us to trim to convert</span> <span data-start="1591.72" data-end="1594.059">over our object structure into keys</span> <span data-start="1594.059" data-end="1598.98">based on the index of those strings next</span> <span data-start="1598.98" data-end="1600.63">we have some false and throughs as</span> <span data-start="1600.63" data-end="1603.03">values well those can be represented as</span> <span data-start="1603.03" data-end="1605.22">zeros and ones so let's go ahead and do</span> <span data-start="1605.22" data-end="1609.21">that and lastly we have now something we</span> <span data-start="1609.21" data-end="1611.16">can't do at build time so all those</span> <span data-start="1611.16" data-end="1612.84">other transformations could be done at</span> <span data-start="1612.84" data-end="1614.82">build time because we know both sides of</span> <span data-start="1614.82" data-end="1618.45">the equation at all times but your</span> <span data-start="1618.45" data-end="1620.76">markup has different text in it your</span> <span data-start="1620.76" data-end="1622.41">markup has different Dom nodes in it</span> <span data-start="1622.41" data-end="1624.21">we can't bake in all of the possible</span> <span data-start="1624.21" data-end="1626.01">string permutations that your code use</span> <span data-start="1626.01" data-end="1628.5">so we create a string pool that will</span> <span data-start="1628.5" data-end="1629.91">contain all of the strings that are</span> <span data-start="1629.91" data-end="1631.95">needed for your application as you use</span> <span data-start="1631.95" data-end="1633.78">them and we only transmit the parts of</span> <span data-start="1633.78" data-end="1635.76">the pool that have not yet been received</span> <span data-start="1635.76" data-end="1637.62">on both sides of the thread both sides</span> <span data-start="1637.62" data-end="1642.03">of the threads so now we're able to</span> <span data-start="1642.03" data-end="1644.04">represent this format in a fairly</span> <span data-start="1644.04" data-end="1646.559">succinct way and you can see that we're</span> <span data-start="1646.559" data-end="1648.39">getting closer and closer and closer to</span> <span data-start="1648.39" data-end="1650.549">a pure integer representation of this</span> <span data-start="1650.549" data-end="1652.95">structure in the future we'll be able to</span> <span data-start="1652.95" data-end="1655.11">move this entirely to a typed array and</span> <span data-start="1655.11" data-end="1657.63">that's where we will end up but for now</span> <span data-start="1657.63" data-end="1659.7">we've got a fairly efficient format that</span> <span data-start="1659.7" data-end="1665.07">has been very little overhead so now</span> <span data-start="1665.07" data-end="1666.09">that we've got this format for</span> <span data-start="1666.09" data-end="1668.22">individual hydrator we'll nodes we need</span> <span data-start="1668.22" data-end="1669.929">to be able to look at what the interface</span> <span data-start="1669.929" data-end="1673.02">for hydration itself looks like a little</span> <span data-start="1673.02" data-end="1674.52">bit more complex and that we have to</span> <span data-start="1674.52" data-end="1679.04">pass that string pull over next mutation</span> <span data-start="1679.04" data-end="1681.45">static document would be extremely</span> <span data-start="1681.45" data-end="1683.94">boring if that was all we could do we</span> <span data-start="1683.94" data-end="1685.11">need to be able to respond to those</span> <span data-start="1685.11" data-end="1690.84">input events here we have a span that we</span> <span data-start="1690.84" data-end="1692.7">created and a click event listener</span> <span data-start="1692.7" data-end="1693.57">that's attached to it</span> <span data-start="1693.57" data-end="1695.64">when that happens we were able to then</span> <span data-start="1695.64" data-end="1697.919">use the classlist Dom token list method</span> <span data-start="1697.919" data-end="1701.669">to toggle a class name as well as change</span> <span data-start="1701.669" data-end="1703.679">the style of a different div that is not</span> <span data-start="1703.679" data-end="1706.65">defined in this example how does this</span> <span data-start="1706.65" data-end="1709.22">work well we use a mutation observer and</span> <span data-start="1709.22" data-end="1711.659">because we built the Dom implementation</span> <span data-start="1711.659" data-end="1713.19">we could build our own mutation observer</span> <span data-start="1713.19" data-end="1714.67">which has super powers</span> <span data-start="1714.67" data-end="1716.5">so instead of just being able to modify</span> <span data-start="1716.5" data-end="1719.14">things like attribute changes or changes</span> <span data-start="1719.14" data-end="1720.73">to the tree structure we can also</span> <span data-start="1720.73" data-end="1724.48">observe things like value changes so we</span> <span data-start="1724.48" data-end="1725.95">know property changes not just</span> <span data-start="1725.95" data-end="1730.3">attributes there was a lot of</span> <span data-start="1730.3" data-end="1732.04">information so we had to steal Laurie's</span> <span data-start="1732.04" data-end="1737.71">joke we're not actually gonna do it</span> <span data-start="1737.71" data-end="1739.84">because Laurie did it I just wanted to</span> <span data-start="1739.84" data-end="1743.49">emphasize I just want to emphasize that</span> <span data-start="1743.49" data-end="1745.48">we talked about how it works because</span> <span data-start="1745.48" data-end="1747.88">it's interesting but one of the magical</span> <span data-start="1747.88" data-end="1749.26">things about work Radames I was like</span> <span data-start="1749.26" data-end="1750.49">looking at the readme and like where's</span> <span data-start="1750.49" data-end="1753.25">the usage statement and it doesn't have</span> <span data-start="1753.25" data-end="1757">one right like the you just make a</span> <span data-start="1757" data-end="1758.11">worker and then you say like</span> <span data-start="1758.11" data-end="1759.82">document.getelementbyid e or you make</span> <span data-start="1759.82" data-end="1761.68">your react component right like it's it</span> <span data-start="1761.68" data-end="1763.3">doesn't have an API because it's just</span> <span data-start="1763.3" data-end="1765.31">the Dom API and the web worker so I</span> <span data-start="1765.31" data-end="1766.98">think that's actually kind of cool</span> <span data-start="1766.98" data-end="1769.6">speaking of which do we want to like</span> <span data-start="1769.6" data-end="1777.31">show a demo so we're kind of short on</span> <span data-start="1777.31" data-end="1780.78">time and so what I'm gonna do is</span> <span data-start="1780.78" data-end="1783.91">something akin to this meme I love this</span> <span data-start="1783.91" data-end="1786.04">one we're gonna start with the left and</span> <span data-start="1786.04" data-end="1789.91">we're gonna move to the owl quickly all</span> <span data-start="1789.91" data-end="1791.62">right I've got some demos here so the</span> <span data-start="1791.62" data-end="1793.54">first one that we'll go into is a</span> <span data-start="1793.54" data-end="1796.06">vanilla Dom implementation so this is</span> <span data-start="1796.06" data-end="1797.29">actually the example we talked about</span> <span data-start="1797.29" data-end="1799.39">during the slides so we've got hello</span> <span data-start="1799.39" data-end="1801.4">world as a text node a span with some</span> <span data-start="1801.4" data-end="1802.69">text inside of it and an input element</span> <span data-start="1802.69" data-end="1805.3">as I click here you can see changes</span> <span data-start="1805.3" data-end="1806.86">occurring this is the least glamorous</span> <span data-start="1806.86" data-end="1809.41">demo ever however believe me all of this</span> <span data-start="1809.41" data-end="1812.35">is happening in a worker now if I come</span> <span data-start="1812.35" data-end="1814.69">here I can type remove and we'll remove</span> <span data-start="1814.69" data-end="1819.52">a node next demo that wasn't very</span> <span data-start="1819.52" data-end="1822.64">impressive this can't possibly be fast</span> <span data-start="1822.64" data-end="1824.53">right we're having to serialize up a</span> <span data-start="1824.53" data-end="1826.21">bunch of information transfer between</span> <span data-start="1826.21" data-end="1826.78">threads</span> </p>
<p><span data-start="1826.78" data-end="1828.85">I thought we'd show something that kind</span> <span data-start="1828.85" data-end="1830.5">of pushes the boundaries of what right</span> <span data-start="1830.5" data-end="1832.63">performance of the web would be like so</span> <span data-start="1832.63" data-end="1835.03">we built a DB Mon implementation if</span> <span data-start="1835.03" data-end="1837.13">you're familiar with like which'll Dom</span> <span data-start="1837.13" data-end="1839.5">frameworks they all implement DB Mon to</span> <span data-start="1839.5" data-end="1840.93">like show how awesome and fast they are</span> <span data-start="1840.93" data-end="1843.61">I don't know if this is fast or not</span> <span data-start="1843.61" data-end="1845.59">compared to some other frameworks but it</span> <span data-start="1845.59" data-end="1847.18">certainly seems to work well on low-end</span> <span data-start="1847.18" data-end="1848">devices</span> <span data-start="1848" data-end="1850.28">and just to show that this is not</span> <span data-start="1850.28" data-end="1853.3">cheating we'll do a little record and</span> <span data-start="1853.3" data-end="1856.07">let's sneak in at the actual snapshot at</span> <span data-start="1856.07" data-end="1858.29">work you can see we're fairly close to</span> <span data-start="1858.29" data-end="1860.12">60 frames per second across the board</span> <span data-start="1860.12" data-end="1862.82">and the code is split directly across</span> <span data-start="1862.82" data-end="1865.19">the main thread here and the worker</span> <span data-start="1865.19" data-end="1866.66">thread the worker thread is running the</span> <span data-start="1866.66" data-end="1868.52">entirety of our JavaScript framework in</span> <span data-start="1868.52" data-end="1870.26">this case and that's highlighted by</span> <span data-start="1870.26" data-end="1873.14">these kind of light pink categorizations</span> <span data-start="1873.14" data-end="1875.3">and the browser is doing its work in the</span> <span data-start="1875.3" data-end="1876.47">main thread and you can see that by</span> <span data-start="1876.47" data-end="1882.33">these large purple and green streaks</span> <span data-start="1882.34" data-end="1885.62">fantastic so we wanted to ensure that</span> <span data-start="1885.62" data-end="1886.79">this framework earned that this</span> <span data-start="1886.79" data-end="1888.14">technology would work with many</span> <span data-start="1888.14" data-end="1889.76">different frameworks not just one or the</span> <span data-start="1889.76" data-end="1891.95">other so we implemented the exact same</span> <span data-start="1891.95" data-end="1893.93">application and both pre act and react</span> <span data-start="1893.93" data-end="1897.86">this is a fake mapping diagram from some</span> <span data-start="1897.86" data-end="1899.72">data that I found on the internet a very</span> <span data-start="1899.72" data-end="1903.95">abstract map and this is an SVG so as we</span> <span data-start="1903.95" data-end="1906.74">modify this we're able to make mutations</span> <span data-start="1906.74" data-end="1910.07">to the to the SVG graphic across the</span> <span data-start="1910.07" data-end="1911.81">bridge and that example is running</span> <span data-start="1911.81" data-end="1912.38">pre-act</span> <span data-start="1912.38" data-end="1914.75">let's do the same example but in react</span> <span data-start="1914.75" data-end="1917.75">and everything seems to still work by</span> <span data-start="1917.75" data-end="1918.56">the way this is running the latest</span> <span data-start="1918.56" data-end="1921.98">version of react I'm certain there's</span> <span data-start="1921.98" data-end="1923.27">some new things there that I were</span> <span data-start="1923.27" data-end="1926.39">supposed to be pretty cool lastly I</span> <span data-start="1926.39" data-end="1928.43">thought I'd do an example of to do MVC</span> <span data-start="1928.43" data-end="1929.87">since that seems to be the canonical</span> <span data-start="1929.87" data-end="1931.52">thing people show when they are</span> <span data-start="1931.52" data-end="1934.04">demonstrating a new technology this to</span> <span data-start="1934.04" data-end="1936.68">do MVC implementation works pretty well</span> <span data-start="1936.68" data-end="1941.9">if I can actually type and this is like</span> <span data-start="1941.9" data-end="1944.57">not to video to do MVC written for</span> <span data-start="1944.57" data-end="1947.66">worker Dom is just to do MVC running</span> <span data-start="1947.66" data-end="1950.09">inside a worker Dom and I can go ahead</span> <span data-start="1950.09" data-end="1952.4">and remove an item and you very barely</span> <span data-start="1952.4" data-end="1954.62">see that there is the item count is</span> <span data-start="1954.62" data-end="1957.79">updating and Dom nodes are being removed</span> <span data-start="1957.79" data-end="1964.76">okay great all right so can can you try</span> <span data-start="1964.76" data-end="1965.32">this</span> <span data-start="1965.32" data-end="1968.9">yes worker Dom we just became available</span> <span data-start="1968.9" data-end="1978.42">on github and NPM a few minutes ago</span> <span data-start="1978.43" data-end="1983.63">it is still very alpha s software he</span> <span data-start="1983.63" data-end="1986.66">goes I think our main goal is not so</span> <span data-start="1986.66" data-end="1989.6">like all of you go run and use this in</span> <span data-start="1989.6" data-end="1991.21">your production application please don't</span> <span data-start="1991.21" data-end="1995.06">eventually do especially and I know lots</span> <span data-start="1995.06" data-end="1996.35">of you are here if you maintain a</span> <span data-start="1996.35" data-end="1997.85">framework of build tool we really want</span> <span data-start="1997.85" data-end="1999.98">to make sure that they work together</span> <span data-start="1999.98" data-end="2001.48">with worker Dom that there's no missing</span> <span data-start="2001.48" data-end="2003.16">features and but you know some of the</span> <span data-start="2003.16" data-end="2006.46">problems might be might be solved I also</span> <span data-start="2006.46" data-end="2007.72">want to talk about the quick I still</span> <span data-start="2007.72" data-end="2010.12">like why we like personally building</span> <span data-start="2010.12" data-end="2014.26">this so we are working on project or</span> <span data-start="2014.26" data-end="2017.35">vocal amp and our goal with worker Dom</span> <span data-start="2017.35" data-end="2019.93">is to allow authors of M documents to</span> <span data-start="2019.93" data-end="2022.15">run their own JavaScript in amp</span> <span data-start="2022.15" data-end="2023.89">documents which he currently can't and</span> <span data-start="2023.89" data-end="2026.38">that's terrible it's not like JavaScript</span> <span data-start="2026.38" data-end="2029.23">and so we all use worker down to do this</span> <span data-start="2029.23" data-end="2030.85">and I think this is important for an</span> <span data-start="2030.85" data-end="2032.62">open source project so because it's</span> <span data-start="2032.62" data-end="2034.93">alpha today but we will make it rock</span> <span data-start="2034.93" data-end="2038.02">solid for this use case and so it's</span> <span data-start="2038.02" data-end="2040.27">usable for everyone else's and there are</span> <span data-start="2040.27" data-end="2042.91">non amp webpages as well yeah and that's</span> <span data-start="2042.91" data-end="2044.17">really all we had thank you very much</span> <span data-start="2044.17" data-end="2046.69">here's the link to github the slides a</span> <span data-start="2046.69" data-end="2048.36">blog post the Christopher</span> </p>
</section>