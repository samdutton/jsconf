<section>
<p><span data-start="1.64" data-end="24.189">Hi, my name is Sergii and I work at Mic Company.</span> <span data-start="24.189" data-end="31.96">It is about server side javascript.</span> <span data-start="31.96" data-end="38.37">One second.</span> <span data-start="38.37" data-end="40.96">This talk is about server side Javascript.</span> <span data-start="40.96" data-end="45.28">It includes low level technical details.</span> </p>
<p><span data-start="45.28" data-end="49.059">It also is about open source project.</span> <span data-start="49.059" data-end="51.329">Runtime Js.</span> <span data-start="51.329" data-end="57.91">And Runtime.Js is an operating system kernel built on V8 engine.</span> <span data-start="57.91" data-end="68.36">Which means that this system boots directly on hardware and it uses V8 engine by Google.</span> <span data-start="68.36" data-end="71.659">As a core component of the system.</span> <span data-start="71.659" data-end="78.36">And it is basically the system is the one that optimized to run JavaScript applications.</span> <span data-start="78.36" data-end="81.18">Can execute javascript only.</span> <span data-start="81.18" data-end="82.96">Doesn't support binaries.</span> <span data-start="82.96" data-end="91.95">And it has non blocking and asynchronous IO model from the ground up.</span> <span data-start="91.95" data-end="94.259">It is built from scratch.</span> <span data-start="94.259" data-end="96.5">And support X86-64.</span> <span data-start="96.5" data-end="105.789">What is the problem with the existing system?</span> <span data-start="105.789" data-end="111.65">When we use them to run Javascript applications?</span> <span data-start="111.65" data-end="120.539">And I think that mainstream operating systems are not the most efficient platforms for Javascript</span> <span data-start="120.539" data-end="122.63">applications.</span> </p>
<p><span data-start="122.63" data-end="129.28">And the reason for that is because they designed to solve different problems.</span> <span data-start="129.28" data-end="138.31">They designed to run compiled binaries and not just Javascript code that runs in VM.</span> <span data-start="138.31" data-end="141.73">They are also too complex.</span> <span data-start="141.73" data-end="144.59">Too many architecture layers.</span> <span data-start="144.59" data-end="149.819">And provide inefficient Api's.</span> <span data-start="149.819" data-end="151.709">And most system calls block.</span> <span data-start="151.709" data-end="154.81">Which is a problem when we use Javascript.</span> <span data-start="154.81" data-end="158.36">We want everything non blocking.</span> <span data-start="158.36" data-end="169.43">And, another problem is that event notifications require some very complex mechanism like polling.</span> <span data-start="169.43" data-end="175.84">When we need to call a kernel in a loop to get the new data.</span> <span data-start="175.84" data-end="185.959">There is no central mechanism that lets us to be notified of any kind of event.</span> <span data-start="185.959" data-end="191.28">Because of that each application is to implement the own system.</span> <span data-start="191.28" data-end="195.15">And use file descriptors to get the data.</span> <span data-start="195.15" data-end="199.03">It uses some unsafe C language at the core.</span> <span data-start="199.03" data-end="202.41">It is a security issue.</span> </p>
<p><span data-start="202.41" data-end="208.069">And buffer overflows is a serious problem that compromise the system.</span> <span data-start="208.069" data-end="213.54">They are written by C pro pgrammers to run C programs.</span> <span data-start="213.54" data-end="221.629">It means that if we want to run Javascript, we need to convert between C stkuctures and</span> <span data-start="221.629" data-end="222.629">Javascript.</span> <span data-start="222.629" data-end="230.06">There is another layer between those 2 for it to work.</span> <span data-start="230.06" data-end="234.129">Let's see how the software stack looks like.</span> <span data-start="234.129" data-end="237.86">When we run Node on Linux.</span> <span data-start="237.86" data-end="241.78">ON the bottom we have hardware.</span> <span data-start="241.78" data-end="246.03">On top, kernel, it is Linux for example.</span> </p>
<p><span data-start="246.03" data-end="249.709">Linux provides us with system call Api.</span> <span data-start="249.709" data-end="253.23">On top the process, node.</span> <span data-start="253.23" data-end="257.18">And node uses libuv and thread pool.</span> <span data-start="257.18" data-end="262.71">For asynchronous Api on the main thread.</span> <span data-start="262.71" data-end="267.43">We have an event loop on the mainthread.</span> </p>
<p><span data-start="267.43" data-end="269.11">We also run an isolate.</span> <span data-start="269.11" data-end="273.86">Which is VM, V8 instance.</span> <span data-start="273.86" data-end="277.51">Which has its own heap and garbage collector.</span> <span data-start="277.51" data-end="282.19">And javascript application on top.</span> <span data-start="282.19" data-end="288.73">These 3 layers are here to provide some kind of isolation.</span> <span data-start="288.73" data-end="295.39">For example, system call Api isolates kernel from the user space application.</span> <span data-start="295.39" data-end="298.53">They cannot break the system.</span> <span data-start="298.53" data-end="302.45">And cannot directly talk to hardware.</span> <span data-start="302.45" data-end="307.67">And the process isolates applications from eachother.</span> <span data-start="307.67" data-end="314.66">For example, node application cannot directly access other applications memory.</span> <span data-start="314.66" data-end="316.48">And then we have an isolate.</span> <span data-start="316.48" data-end="320.94">Which isolates javascript applications from the rest of the system.</span> </p>
<p><span data-start="320.94" data-end="333.37">These two components, libuv and thread pol, provide us with asynchronous Api.</span> <span data-start="333.37" data-end="335.69">Let's see what process isolation is.</span> <span data-start="335.69" data-end="340.6">A system that protects kernel from applications.</span> <span data-start="340.6" data-end="343.03">Applications from eachother.</span> <span data-start="343.03" data-end="346.33">It requires uses an address space for every process.</span> <span data-start="346.33" data-end="354.05">It is a range of memory that processes can access.</span> <span data-start="354.05" data-end="357.6">And this requires to use context switches.</span> <span data-start="357.6" data-end="359.08">We have multiple address switches.</span> <span data-start="359.08" data-end="364.93">We need to switch between them when we do multitasking.</span> <span data-start="364.93" data-end="368.25">We need to between usermode and kernelmode.</span> <span data-start="368.25" data-end="375.86">This adds additional overhead zozer We also need to use system calls.</span> <span data-start="375.86" data-end="381.96">Because kernel is isolated from user space application.</span> <span data-start="381.96" data-end="385.14">Let's see what is VM isolation.</span> <span data-start="385.14" data-end="387.22">Because javascript is a safe language.</span> </p>
<p><span data-start="387.22" data-end="391.55">V8 compiles Javascript into trusted native code.</span> <span data-start="391.55" data-end="394.35">That is guaranteed to be correct.</span> <span data-start="394.35" data-end="402.43">It will not access random memory and modify some internals of the system.</span> <span data-start="402.43" data-end="410.46">Because it guarantees that you can do this from Javascript directly.</span> <span data-start="410.46" data-end="419.45">Because it creates a sandbox where VM controls, everything that program is allowed to do.</span> <span data-start="419.45" data-end="421.59">And it is often called software isolation.</span> <span data-start="421.59" data-end="432.89">Because it doesn't use hardware mechanisms to enforce those memory restriction rules.</span> <span data-start="432.89" data-end="434.61">And so what is the difference?</span> <span data-start="434.61" data-end="439.25">We have 2 mechanisms that we use.</span> <span data-start="439.25" data-end="444.5">And you pay twice when we use both of them.</span> </p>
<p><span data-start="444.5" data-end="450.97">Javascript VM provides everything that process isolation can offer us.</span> <span data-start="450.97" data-end="457.87">We generally don't worry that when we run two tabs in the browser.</span> <span data-start="457.87" data-end="462.9">One tab cannot break or change data in another.</span> <span data-start="462.9" data-end="466.64">Even if they run in the same process.</span> <span data-start="466.64" data-end="472.06">So, VM can provide this isolation.</span> <span data-start="472.06" data-end="483.43">And we basically don't need the processes to restrict the system from the kernel.</span> <span data-start="483.43" data-end="487.62">It is required only for native untrusted code.</span> <span data-start="487.62" data-end="492.65">The runtime.Js is a kernel optimized to run javascript.</span> <span data-start="492.65" data-end="503.49">First of all, it is a Vm isolation protection system.</span> <span data-start="503.49" data-end="508.02">That general purpose kernels use processes instead.</span> <span data-start="508.02" data-end="513.84">We can also provide Js optimized kernel interface.</span> <span data-start="513.84" data-end="519">That basically you can pass code back to the kernel.</span> <span data-start="519" data-end="521.11">And ask to call it.</span> <span data-start="521.11" data-end="524.18">It will work just like that.</span> <span data-start="524.18" data-end="532.64">And we can also add communication between applications, using Js objects.</span> <span data-start="532.64" data-end="537.05">We can transfer buffers.</span> </p>
<p><span data-start="537.05" data-end="539.68">Like passing the pointer two applications.</span> <span data-start="539.68" data-end="547.67">It is much faster operation when we don't have process isolation.</span> <span data-start="547.67" data-end="551.75">And, kernel notifications can use event loop.</span> <span data-start="551.75" data-end="554.41">Built in into the system.</span> <span data-start="554.41" data-end="557.33">And we can also write some kernel side javascript.</span> <span data-start="557.33" data-end="561.06">It might be useful in some cases.</span> <span data-start="561.06" data-end="564.13">How does it look like?</span> <span data-start="564.13" data-end="570.55">There is no binary support, no processes, no process isolation, we no longer need.</span> </p>
<p><span data-start="570.55" data-end="573.67">No Posix interfaces.</span> <span data-start="573.67" data-end="575.92">And no system calls.</span> <span data-start="575.92" data-end="584.7">But instead, the system has software isolated applications, isolates.</span> <span data-start="584.7" data-end="587.01">Everything runs in a single address space.</span> </p>
<p><span data-start="587.01" data-end="590.42">It has a builtin V8 engine.</span> <span data-start="590.42" data-end="593.59">And all IO is non-blocking and asynchronous.</span> <span data-start="593.59" data-end="599.97">The system has built in global event loop for the whole system.</span> <span data-start="599.97" data-end="604.19">There is a lightweight threads for multitasking.</span> <span data-start="604.19" data-end="609.22">Let's see how software stack looks like.</span> </p>
<p><span data-start="609.22" data-end="613.25">We have hardware, on top we have a kernel.</span> <span data-start="613.25" data-end="617">Then we run a system event loop.</span> <span data-start="617" data-end="622.8">And on top of it we have isolate VM instance.</span> <span data-start="622.8" data-end="629.25">Already provides all the security guarantees that our Javascript application cannot touch</span> <span data-start="629.25" data-end="632.61">hardware or break the system.</span> <span data-start="632.61" data-end="640.36">This is how architecture looks like.</span> <span data-start="640.36" data-end="645.08">Some native code that implements the kernel services.</span> <span data-start="645.08" data-end="648.19">It is also V8 engine.</span> </p>
<p><span data-start="648.19" data-end="651.71">Exposed kernel Api's.</span> <span data-start="651.71" data-end="661.24">And low level services, something like memory management, IO, interrupt timers.</span> <span data-start="661.24" data-end="665.44">Schedule, etc.</span> <span data-start="665.44" data-end="669.4">And everything else is built on top using Javascript.</span> <span data-start="669.4" data-end="675.3">High level kernel services include device drivers.</span> <span data-start="675.3" data-end="683.6">And system services like network stack, and ofcourse applications.</span> <span data-start="683.6" data-end="686.75">Why would I use Javascript for those tasks?</span> <span data-start="686.75" data-end="690.14">Hit is already bytecode of the web.</span> <span data-start="690.14" data-end="692.29">We can compile everything to javascript.</span> <span data-start="692.29" data-end="702.82">It is well tested, runs everywhere zozer And easy way to write asynchronous IT code.</span> <span data-start="702.82" data-end="705.84">It is powerful enough to write system components.</span> </p>
<p><span data-start="705.84" data-end="707.761">We have typed array.</span> <span data-start="707.761" data-end="717.07">And array buffers that are very useful for handling binary data.</span> <span data-start="717.07" data-end="719.12">And it is safe and secure.</span> <span data-start="719.12" data-end="722.19">It is built in in the language.</span> <span data-start="722.19" data-end="728.08">It doesn't provide a way to access random memory locations.</span> <span data-start="728.08" data-end="733.12">So we are very safe with this.</span> <span data-start="733.12" data-end="737.43">And can use it for writing drivers.</span> <span data-start="737.43" data-end="739.69">And other applications.</span> </p>
<p><span data-start="739.69" data-end="746.39">And actually the device drivers are the software, basically does IO code.</span> <span data-start="746.39" data-end="752.32">Basically, it reads from a network and passes it to the applications.</span> <span data-start="752.32" data-end="757.26">It is a very IO heavy applications.</span> <span data-start="757.26" data-end="761.88">Perfectly reasonably to write in Javascript.</span> </p>
<p><span data-start="761.88" data-end="765.47">So, the software isolated applications.</span> <span data-start="765.47" data-end="769.21">We don't have processes, just isolates.</span> <span data-start="769.21" data-end="772.38">Each program runs in its own isolate.</span> <span data-start="772.38" data-end="778.94">Each has its own garbage collector and heap.</span> <span data-start="778.94" data-end="786.18">We have an inter isolate communication, using Rpc.</span> <span data-start="786.18" data-end="789.35">Global event loop in the system.</span> <span data-start="789.35" data-end="793.56">There is just 1 event loop for the whole system.</span> <span data-start="793.56" data-end="799.42">And at the same time, each isolate has its own execution stack.</span> <span data-start="799.42" data-end="802.68">It is like threads.</span> <span data-start="802.68" data-end="805.01">Event loops switches between stacks.</span> <span data-start="805.01" data-end="809.95">It is possible to interrupt long running Javascript code.</span> <span data-start="809.95" data-end="814.41">The function foo can block the system.</span> <span data-start="814.41" data-end="821.279">If we use a stack for each application, we can just interrupt this.</span> <span data-start="821.279" data-end="825.04">And continue with other applications.</span> <span data-start="825.04" data-end="827.16">So this is how it works.</span> <span data-start="827.16" data-end="830.86">For example, we have 3 isolates.</span> </p>
<p><span data-start="830.86" data-end="832.91">Each one has an event queue.</span> <span data-start="832.91" data-end="833.91">And isolate stack.</span> <span data-start="833.91" data-end="839.32">The system starts executing callbacks from the isolate 1.</span> <span data-start="839.32" data-end="843.83">Callback 1, 2, 3.</span> <span data-start="843.83" data-end="848.98">Then, it switches the stack to isolate 2 stack.</span> <span data-start="848.98" data-end="851.55">And executes those 2 callbacks.</span> <span data-start="851.55" data-end="859.87">If callback 2 takes too much time, we can switch the stack and continue the callbacks</span> <span data-start="859.87" data-end="862.7">from isolate 3.</span> <span data-start="862.7" data-end="867.93">And, there is inter isolate communication.</span> </p>
<p><span data-start="867.93" data-end="872.95">Implemented as remote procedure calls.</span> <span data-start="872.95" data-end="874.73">functions across asolates.</span> <span data-start="874.73" data-end="882.74">This is the example of how this works.</span> <span data-start="882.74" data-end="885.99">For example, we have function add.</span> <span data-start="885.99" data-end="888.15">We can call it from the other isolate.</span> <span data-start="888.15" data-end="893.87">And it will return promise.</span> <span data-start="893.87" data-end="897.74">We need asynchronous call.</span> <span data-start="897.74" data-end="900.63">Another example is asynchronous function call.</span> <span data-start="900.63" data-end="908.97">In this example, we resolve promise in 2 seconds an return it.</span> <span data-start="908.97" data-end="915.779">When other isolates call this function, it can use this promise to output Hello World</span> <span data-start="915.779" data-end="919.17">after 2 seconds.</span> <span data-start="919.17" data-end="924.81">Another example is zero copy arraybuffer transfer.</span> </p>
<p><span data-start="924.81" data-end="930.77">We can just pass the arraybuffer without any copying.</span> <span data-start="930.77" data-end="932.089">It is useful.</span> <span data-start="932.089" data-end="938.46">When we want to get data from a network device.</span> <span data-start="938.46" data-end="945.41">It can just pass the same buffer that a network card writes to.</span> </p>
<p><span data-start="945.41" data-end="946.52">To the application.</span> <span data-start="946.52" data-end="950.87">It is much more efficient system.</span> <span data-start="950.87" data-end="959.53">And we can also pass functions that will return promise on the other side.</span> <span data-start="959.53" data-end="962.04">There is also an isolate Api.</span> <span data-start="962.04" data-end="968.07">That every isolate can access zozer It is a data environment.</span> <span data-start="968.07" data-end="969.73">Some system services.</span> <span data-start="969.73" data-end="972.41">There are functions.</span> <span data-start="972.41" data-end="974.92">Like exit log.</span> <span data-start="974.92" data-end="976.529">And okay.</span> <span data-start="976.529" data-end="977.63">There is a demo.</span> </p>
<p><span data-start="977.63" data-end="980.99">I'd like to show.</span> <span data-start="980.99" data-end="986.67">Let's boot this system.</span> <span data-start="986.67" data-end="990.72">So, it loads.</span> <span data-start="990.72" data-end="994.73">You can see it.</span> <span data-start="994.73" data-end="997.44">This is the system, it boots into terminal.</span> <span data-start="997.44" data-end="1000.97">We can type commands.</span> <span data-start="1000.97" data-end="1005.14">It outputs the list of the files.</span> <span data-start="1005.14" data-end="1009.029">Af you can see, those are js applications.</span> <span data-start="1009.029" data-end="1013.21">It is a simple application.</span> <span data-start="1013.21" data-end="1016.5">We can do like echo hello.</span> <span data-start="1016.5" data-end="1019.69">To output our string.</span> <span data-start="1019.69" data-end="1024.01">We can do some other tasks.</span> <span data-start="1024.01" data-end="1026.78">Like for example eval.</span> <span data-start="1026.78" data-end="1029.53">And here we can evaluate some javascript.</span> </p>
<p><span data-start="1029.53" data-end="1031.47">It all runs on virtualiser.</span> <span data-start="1031.47" data-end="1040.11">You can type exit.</span> <span data-start="1040.11" data-end="1043.25">There is also some network support.</span> <span data-start="1043.25" data-end="1047.25">We can resolve hostnames.</span> <span data-start="1047.25" data-end="1052.89">Let's do host.</span> <span data-start="1052.89" data-end="1055.47">It resolves hostname.</span> <span data-start="1055.47" data-end="1057.03">This network stack.</span> <span data-start="1057.03" data-end="1072.8">And device driver are implemented in Javascript.</span> <span data-start="1072.8" data-end="1078.86">So, what else?</span> <span data-start="1078.86" data-end="1083.87">We can see the devices.</span> <span data-start="1083.87" data-end="1088.55">On our system.</span> <span data-start="1088.55" data-end="1098.03">And, let's exit.</span> </p>
<p><span data-start="1098.03" data-end="1103.6">Poweroff.</span> <span data-start="1103.6" data-end="1109.16">(applause)</span> <span data-start="1109.16" data-end="1112.85">i hosted runtime.Js on a server.</span> <span data-start="1112.85" data-end="1118.6">You should be able to connect, respond with Udp packets.</span> <span data-start="1118.6" data-end="1128.76">If you try it.D and type some text.</span> <span data-start="1128.76" data-end="1134.8">And it should return this information.</span> <span data-start="1134.8" data-end="1142.03">Let me see.</span> <span data-start="1142.03" data-end="1144.44">Hello.</span> </p>
<p><span data-start="1144.44" data-end="1149.26">Hello message.</span> <span data-start="1149.26" data-end="1156.25">It shows my Ip address and source port.</span> <span data-start="1156.25" data-end="1162.17">Now I can ssh to the server.</span> <span data-start="1162.17" data-end="1168.61">Open screen.</span> <span data-start="1168.61" data-end="1173.09">You should be able to see your own message.</span> <span data-start="1173.09" data-end="1179.09">It works!</span> </p>
<p><span data-start="1179.09" data-end="1185.09">I think.</span> <span data-start="1185.09" data-end="1192.07">So, let's continue with the presentation.</span> <span data-start="1192.07" data-end="1193.99">So the project status.</span> <span data-start="1193.99" data-end="1196.05">It is experimental project.</span> <span data-start="1196.05" data-end="1198.08">And it is in development.</span> </p>
<p><span data-start="1198.08" data-end="1200.04">It is not ready to use.</span> <span data-start="1200.04" data-end="1205.54">It lacks many important features zozer Most Api's will probably change.</span> <span data-start="1205.54" data-end="1208.04">Right now it targets mainly Kvm.</span> <span data-start="1208.04" data-end="1215.07">It is easier to support its device driver.</span> <span data-start="1215.07" data-end="1218.65">And we can run it on top of Linux.</span> <span data-start="1218.65" data-end="1227.309">For the best efficiency, we would like to implement maybe native, hardware drivers.</span> <span data-start="1227.309" data-end="1228.58">Not native.</span> <span data-start="1228.58" data-end="1232.06">Real hardware drivers.</span> <span data-start="1232.06" data-end="1234.71">And so, why would you use this system?</span> <span data-start="1234.71" data-end="1238.28">Because it is network-first server system.</span> <span data-start="1238.28" data-end="1241.95">It provides safe environment.</span> <span data-start="1241.95" data-end="1244.93">It has a sandboxed applications.</span> <span data-start="1244.93" data-end="1247.7">It uses asynchronous IO everywhere.</span> </p>
<p><span data-start="1247.7" data-end="1249.61">Full hackable Javascript.</span> <span data-start="1249.61" data-end="1252.88">Full control over everything.</span> <span data-start="1252.88" data-end="1258.61">If you would like to implement your own file system or network protocol, you can do it</span> <span data-start="1258.61" data-end="1259.96">in Javascript.</span> <span data-start="1259.96" data-end="1264.24">It is easier to work with it.</span> <span data-start="1264.24" data-end="1265.48">And it is pretty small.</span> <span data-start="1265.48" data-end="1266.87">Less than 10 MB.</span> <span data-start="1266.87" data-end="1271.799">It is actually around 8.</span> <span data-start="1271.799" data-end="1274.79">And V8 is 7 Mb.</span> </p>
<p><span data-start="1274.79" data-end="1281.88">I think, the future work would be to support Tcp/http protocols.</span> <span data-start="1281.88" data-end="1285.549">Add file system support.</span> <span data-start="1285.549" data-end="1288.78">Right now it is read only file system.</span> <span data-start="1288.78" data-end="1293.25">And optimize internal structures.</span> <span data-start="1293.25" data-end="1298.88">And maybe at some point lock Api's and support Xen.</span> <span data-start="1298.88" data-end="1300.85">So we can run it on Amazon.</span> <span data-start="1300.85" data-end="1304.61">And about Node.</span> <span data-start="1304.61" data-end="1307.84">It is not compatible with Node.</span> <span data-start="1307.84" data-end="1312.21">It provides a lower level Api than Node.</span> </p>
<p><span data-start="1312.21" data-end="1316.74">It might be possible to port Node on top of it.</span> <span data-start="1316.74" data-end="1321.42">But, Node uses really unique Cpi's.</span> <span data-start="1321.42" data-end="1327.45">There needs to be an additional layer to convert the calls.</span> <span data-start="1327.45" data-end="1331.56">We can use an Npm as system package manager.</span> <span data-start="1331.56" data-end="1344.86">So, there are the links zozer You can find the projiect on github.</span> <span data-start="1344.86" data-end="1348.99">Thanks Mic for supporting the project.</span> <span data-start="1348.99" data-end="1351.35">Thank you everyone.</span> </p>
</section>