<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>fWc3Zu6A3Ws</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/fWc3Zu6A3Ws?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0" data-end="3.519">[Applause]</span> <span data-start="3.529" data-end="15.21">we are anxiously waiting I mean oh the</span> <span data-start="15.21" data-end="16.41">other way it's giveaway it's always the</span> <span data-start="16.41" data-end="19.56">other way right yeah we good I think</span> <span data-start="19.56" data-end="21.96">we're good press press the have to think</span> <span data-start="21.96" data-end="23.279">right okay okay oh the full screen yeah</span> <span data-start="23.279" data-end="25.099">yeah yeah</span> <span data-start="25.099" data-end="30.15">f4 full screen there we go yeah oh okay</span> <span data-start="30.15" data-end="34.079">right ah so earlier this year a few of</span> <span data-start="34.079" data-end="35.76">us went on a fact-finding mission to</span> </p>
<p><span data-start="35.76" data-end="37.53">India to see how folks use the in turn</span> <span data-start="37.53" data-end="39">out there and one thing stood out to us</span> <span data-start="39" data-end="41.52">and that is that feature phones are back</span> <span data-start="41.52" data-end="43.8">yeah the future phone market doubled in</span> <span data-start="43.8" data-end="45.989">2018 in India and the sale of</span> <span data-start="45.989" data-end="48.329">smartphones by kind of flattened out and</span> <span data-start="48.329" data-end="50.219">at the current rate to this projected</span> <span data-start="50.219" data-end="53.43">that 400 million feature phones will be</span> <span data-start="53.43" data-end="55.829">sold in India this year alone yes and</span> <span data-start="55.829" data-end="57.84">the one on the right over there the very</span> <span data-start="57.84" data-end="59.94">far end that is a geophone which is the</span> <span data-start="59.94" data-end="62.699">most popular brand and it costs just 15</span> <span data-start="62.699" data-end="65.159">pounds and I compared to all the phones</span> <span data-start="65.159" data-end="67.979">you all have here everything about all</span> <span data-start="67.979" data-end="70.25">of these phones is extremely it's</span> <span data-start="70.25" data-end="73.11">240 pixels wide it's single pixel</span> <span data-start="73.11" data-end="75.9">density there is no touchscreen and the</span> </p>
<p><span data-start="75.9" data-end="77.96">CPU is god-awful</span> <span data-start="77.96" data-end="81.509">but it's 15 quid and that allows people</span> <span data-start="81.509" data-end="83.88">to be on the internet that previously</span> <span data-start="83.88" data-end="86.28">couldn't afford to be there yes and also</span> <span data-start="86.28" data-end="87.659">the geophone on the end there this is a</span> <span data-start="87.659" data-end="90">web-based phone that is running Kai OS</span> <span data-start="90" data-end="92.729">which is a fork of the old Firefox OS so</span> <span data-start="92.729" data-end="94.29">this phone is kind of is running Firefox</span> <span data-start="94.29" data-end="96.63">42 for pretty much everything so a</span> <span data-start="96.63" data-end="97.53">little team of us got together</span> <span data-start="97.53" data-end="105.94">consisting of Surma Jake and Mary Coe</span> <span data-start="105.95" data-end="108.689">she's in America Mike Mike is in America</span> </p>
<p><span data-start="108.689" data-end="109.71">America is that way</span> <span data-start="109.71" data-end="111.99">if you actually think it's quicker to go</span> <span data-start="111.99" data-end="114.689">that way that way yeah either way if you</span> <span data-start="114.689" data-end="118.38">just keep your phone so yeah what we</span> <span data-start="118.38" data-end="119.85">wanted to see if it could we build an</span> <span data-start="119.85" data-end="122.579">interactive web experience that would</span> <span data-start="122.579" data-end="125.399">run on devices like this but you know</span> <span data-start="125.399" data-end="127.56">with responsive design and progressive</span> <span data-start="127.56" data-end="130.679">enhancement and enabling it to also</span> <span data-start="130.679" data-end="133.06">scale up to something that looks</span> <span data-start="133.06" data-end="135.25">on a desktop yes and that thing became</span> <span data-start="135.25" data-end="138.58">procs it is a game if you like</span> <span data-start="138.58" data-end="140.709">minesweeper you will like procs because</span> <span data-start="140.709" data-end="143.55">it's the same play it now on proxy a p — </span> <span data-start="143.55" data-end="145.93">so here's on desktop and as you can tell</span> <span data-start="145.93" data-end="148">like we through all the animations at it</span> <span data-start="148" data-end="150.25">and like make it fancy but keep in mind</span> <span data-start="150.25" data-end="152.739">this entire thing scales down nicely and</span> <span data-start="152.739" data-end="155.38">is playable on one of these 15 quid</span> <span data-start="155.38" data-end="157.84">feature phones with the exact same code</span> <span data-start="157.84" data-end="159.4">base yeah so we put a lot of effort into</span> <span data-start="159.4" data-end="161.2">making it run really fast so we figured</span> <span data-start="161.2" data-end="162.28">we'd go through some of the tricks and</span> <span data-start="162.28" data-end="163.989">techniques that we use because none of</span> <span data-start="163.989" data-end="166">its really unique to this particular web</span> <span data-start="166" data-end="167.62">app it's stuff that you can apply to any</span> <span data-start="167.62" data-end="170.44">site or all right but before we dive in</span> </p>
<p><span data-start="170.44" data-end="172.33">I think it's important that we address a</span> <span data-start="172.33" data-end="174.67">question that we still often see on</span> <span data-start="174.67" data-end="178.81">Twitter yes should I care about</span> <span data-start="178.81" data-end="181.39">performance should I care about</span> <span data-start="181.39" data-end="184.239">performance should I care about</span> <span data-start="184.239" data-end="192.25">performance I'll go to article 4 this is</span> <span data-start="192.25" data-end="195.22">this one on web fundamentals there by</span> <span data-start="195.22" data-end="198.1">Jeremy Jeremy where are you where is it</span> <span data-start="198.1" data-end="201.16">he's actually here is he here he's</span> <span data-start="201.16" data-end="203.23">supposed to be here the guy said to me</span> <span data-start="203.23" data-end="204.489">last night really looking forward to</span> <span data-start="204.489" data-end="208.329">your talk Jake where are you man it's</span> <span data-start="208.329" data-end="210.519">just rude fine</span> <span data-start="210.519" data-end="212.35">well okay well if you want to read</span> </p>
<p><span data-start="212.35" data-end="215.11">Jeremy's article whatever you can find</span> <span data-start="215.11" data-end="217.63">it at this bitly link it's like your</span> <span data-start="217.63" data-end="219.43">points to all these web performance</span> <span data-start="219.43" data-end="221.079">studies carried out by a variety of</span> <span data-start="221.079" data-end="224.519">companies such as Pinterest who reduced</span> <span data-start="224.519" data-end="227.859">their perceived wait times by 40% and so</span> <span data-start="227.859" data-end="230.829">on increase by 15% in signups or cookie</span> <span data-start="230.829" data-end="232.09">reduced a load time by under 50</span> <span data-start="232.09" data-end="233.2">milliseconds and saw an increase in</span> <span data-start="233.2" data-end="234.459">conversions on session time or the BBC</span> <span data-start="234.459" data-end="235.81">velocity initial times of users and</span> <span data-start="235.81" data-end="236.769">everything that's how they paid it to</span> <span data-start="236.769" data-end="238.09">load or also anything huge is playful</span> <span data-start="238.09" data-end="239.799">time by half and some boost in sales</span> <span data-start="239.799" data-end="242.38">well no but responded by 250 seconds</span> <span data-start="242.38" data-end="244.359">terms ignition supply right although</span> <span data-start="244.359" data-end="246.22">that's a large variety of sites like</span> <span data-start="246.22" data-end="248.32">we'd still see folks saying like mmm</span> <span data-start="248.32" data-end="250.239">this yeah it's all very interesting but</span> <span data-start="250.239" data-end="252.22">it doesn't apply to my sites because</span> <span data-start="252.22" data-end="254.14">like my site is somehow different yeah</span> <span data-start="254.14" data-end="255.79">they sound like one aspect in the study</span> <span data-start="255.79" data-end="257.41">that they feel like their own site</span> <span data-start="257.41" data-end="258.789">doesn't match too and therefore the</span> <span data-start="258.789" data-end="261.729">entire evidence provided is invalid we</span> <span data-start="261.729" data-end="264.88">don't buy that now I think everyone in</span> <span data-start="264.88" data-end="266.1">this room right is a you</span> <span data-start="266.1" data-end="268.35">of software we know how frustrating it</span> <span data-start="268.35" data-end="270.69">is when something performs badly and low</span> <span data-start="270.69" data-end="272.79">time is just such a big part that the</span> <span data-start="272.79" data-end="274.11">performance optimizations if you're</span> <span data-start="274.11" data-end="275.73">going to talk about in this talk are</span> <span data-start="275.73" data-end="278.79">pretty simple dead easy literally two</span> <span data-start="278.79" data-end="282.21">minutes on paper but when you've got a</span> <span data-start="282.21" data-end="284.34">build system wrapped around your project</span> <span data-start="284.34" data-end="286.53">as most of us do just adding something</span> <span data-start="286.53" data-end="288.45">like a tag to a page can become like a</span> <span data-start="288.45" data-end="289.65">real pain so we're going to take a look</span> <span data-start="289.65" data-end="291.45">at that side of things as well so let's</span> <span data-start="291.45" data-end="294.18">rewind to the first alpha version of</span> <span data-start="294.18" data-end="296.73">trucks before we had done any of our</span> <span data-start="296.73" data-end="298.38">performance work yes this is totally the</span> <span data-start="298.38" data-end="299.91">real alpha version not a version we just</span> <span data-start="299.91" data-end="301.49">retrofitted for the sake of the shut up</span> <span data-start="301.49" data-end="304.71">you're ruining the illusion I'm sorry so</span> <span data-start="304.71" data-end="307.38">aside from being a bit slow it wasn't</span> <span data-start="307.38" data-end="309.72">really all that different from your</span> <span data-start="309.72" data-end="311.85">average everyday JavaScript driven app</span> <span data-start="311.85" data-end="314.46">yeah so HTML was pretty basic right it</span> <span data-start="314.46" data-end="315.5">content a little bit of metadata</span> </p>
<p><span data-start="315.5" data-end="317.22">JavaScript file that took care of</span> <span data-start="317.22" data-end="319.11">populating the page we've got a style</span> <span data-start="319.11" data-end="320.67">sheet there that star sheet is just for</span> <span data-start="320.67" data-end="323.34">a web font the rest of our CSS was</span> <span data-start="323.34" data-end="325.43">embedded in our JavaScript via post CSS</span> <span data-start="325.43" data-end="328.32">the notable difference from most web</span> <span data-start="328.32" data-end="331.2">apps I think is that we used pre-act</span> <span data-start="331.2" data-end="335.01">instead of react react is 33k pre-act is</span> <span data-start="335.01" data-end="338.25">3k react can do much more but none of</span> <span data-start="338.25" data-end="339.87">the things that it can do more we</span> <span data-start="339.87" data-end="341.97">actually needed so for us was really</span> <span data-start="341.97" data-end="344.52">like a no-brainer to be able to save 30k</span> <span data-start="344.52" data-end="345.93">it's straight out the start yes</span> <span data-start="345.93" data-end="347.13">absolutely any other difference is we</span> <span data-start="347.13" data-end="349.38">used roll-up basically because we wanted</span> <span data-start="349.38" data-end="350.94">to give it a try like we'd use roll-up</span> <span data-start="350.94" data-end="352.47">in before for like libraries and stuff</span> <span data-start="352.47" data-end="355.14">but but not for full web apps so if the</span> <span data-start="355.14" data-end="356.76">last year we build a web app called</span> <span data-start="356.76" data-end="360.15">sploosh and to build swoosh we used web</span> <span data-start="360.15" data-end="363.18">hack and when I say we I really mean our</span> <span data-start="363.18" data-end="367.5">colleague Jason handle the back side of</span> <span data-start="367.5" data-end="373.74">things and he basically had to make use</span> <span data-start="373.74" data-end="376.92">of lots of undocumented and internal web</span> <span data-start="376.92" data-end="380.73">pack api's just to achieve basic stuff</span> <span data-start="380.73" data-end="383.79">and he has years of web pack experiences</span> <span data-start="383.79" data-end="385.65">really comfortable with it the two of us</span> <span data-start="385.65" data-end="388.65">on the other hand don't yes so as a</span> <span data-start="388.65" data-end="389.73">result like we didn't understand the</span> <span data-start="389.73" data-end="391.83">project build system if something went</span> <span data-start="391.83" data-end="394.14">wrong that was non-trivial which most of</span> <span data-start="394.14" data-end="395.61">it was non-trivial</span> <span data-start="395.61" data-end="397.38">we were kind of helpless until Jason</span> <span data-start="397.38" data-end="398.5">woke up on the other side of the</span> <span data-start="398.5" data-end="400.69">and talking to some other teams</span> <span data-start="400.69" data-end="403.03">internally and exhale we hear similar</span> <span data-start="403.03" data-end="404.68">stories there's like one or two people</span> <span data-start="404.68" data-end="406.09">who are considered the webpack</span> <span data-start="406.09" data-end="407.83">whisperers on the team it's their sole</span> <span data-start="407.83" data-end="409.78">job to like maintain the built system</span> <span data-start="409.78" data-end="412.27">and nobody else actually really dares to</span> <span data-start="412.27" data-end="414.25">touch it and maybe this sounds too</span> <span data-start="414.25" data-end="415.63">familiar to some of the people here in</span> <span data-start="415.63" data-end="418.84">the room yes so when I use webpack I</span> <span data-start="418.84" data-end="420.97">don't feel like I'm using JavaScript I</span> <span data-start="420.97" data-end="423.1">feel like I'm switching like pulling</span> <span data-start="423.1" data-end="424.36">levers switching switches and I get</span> <span data-start="424.36" data-end="426.7">massive config objects like and herding</span> <span data-start="426.7" data-end="428.47">lots of plugins around a varying quality</span> <span data-start="428.47" data-end="429.73">that often don't really play well</span> <span data-start="429.73" data-end="431.83">together yeah and so we tried roll up</span> <span data-start="431.83" data-end="434.02">and we found lots of plugins of varying</span> <span data-start="434.02" data-end="435.4">quality that don't really play well</span> <span data-start="435.4" data-end="438.4">together but the big difference is mere</span> <span data-start="438.4" data-end="440.08">mortals can write their own plugins roll</span> <span data-start="440.08" data-end="441.82">up has this simple well-documented</span> <span data-start="441.82" data-end="443.38">plug-in system so it's easy to get</span> <span data-start="443.38" data-end="445">involved in the innards of the build now</span> <span data-start="445" data-end="446.53">if you know enough JavaScript to wrangle</span> <span data-start="446.53" data-end="448.51">a web pack config you know more than</span> <span data-start="448.51" data-end="450.43">enough to write a rollup plug-in and we</span> <span data-start="450.43" data-end="452.169">knew we were going to do unusual stuff</span> <span data-start="452.169" data-end="454.36">if it was clear to us and on these super</span> <span data-start="454.36" data-end="456.73">low end feature phones it's gonna be</span> <span data-start="456.73" data-end="458.35">hard to have everything on the main</span> <span data-start="458.35" data-end="461.41">thread so we wanted to make workers core</span> <span data-start="461.41" data-end="463.27">part of our architecture straight from</span> <span data-start="463.27" data-end="463.72">the start</span> <span data-start="463.72" data-end="466.18">yes and there's you know the problem is</span> <span data-start="466.18" data-end="468.22">that we now have multiple threads and</span> <span data-start="468.22" data-end="469.84">the problem is that there's often shared</span> <span data-start="469.84" data-end="472">dependencies between these multiple</span> <span data-start="472" data-end="473.86">plant fats so to solve that we use</span> <span data-start="473.86" data-end="475.12">common link and that facilitates the</span> <span data-start="475.12" data-end="476.5">communication between workers the main</span> <span data-start="476.5" data-end="479.2">thread library that you wrote but that</span> <span data-start="479.2" data-end="480.79">means that library needs to appear you</span> <span data-start="480.79" data-end="482.32">know on all of the workers and on the</span> <span data-start="482.32" data-end="484.24">main thread now web pack can't share</span> <span data-start="484.24" data-end="485.71">chunks between workers and the main</span> <span data-start="485.71" data-end="487.39">thread so news would end up downloading</span> <span data-start="487.39" data-end="489.58">it well at least twice once for every</span> <span data-start="489.58" data-end="491.5">worker plus one and this would happen</span> <span data-start="491.5" data-end="493.479">for each additional shared dependency</span> <span data-start="493.479" data-end="495.91">and the roll-up kind of handles this for</span> <span data-start="495.91" data-end="497.53">free out of the box because at least the</span> <span data-start="497.53" data-end="500.41">choice of format up to you yeah it</span> <span data-start="500.41" data-end="501.669">wasn't just JavaScript needed handle</span> <span data-start="501.669" data-end="503.59">either because you know we needed HTML</span> <span data-start="503.59" data-end="506.59">as well and there is what plugin for you</span> <span data-start="506.59" data-end="511.21">to create HTML for your project but here</span> <span data-start="511.21" data-end="514.27">is the code for that plugin and its</span> <span data-start="514.27" data-end="517.03">massive and again it relies on loads of</span> <span data-start="517.03" data-end="519.789">internal and undocumented parts of web</span> <span data-start="519.789" data-end="521.56">pack yeah this booking is so big it has</span> <span data-start="521.56" data-end="524.53">its own plug-in ecosystem as well and</span> <span data-start="524.53" data-end="526">it's kind of the way it works it doesn't</span> <span data-start="526" data-end="528.07">really want you touching the HTML itself</span> <span data-start="528.07" data-end="529.51">instead it wants you to learn the</span> <span data-start="529.51" data-end="530.81">configuration options and</span> <span data-start="530.81" data-end="532.759">you know all of that and learn all of</span> <span data-start="532.759" data-end="535.129">their quirks as well like it turns out</span> <span data-start="535.129" data-end="537.019">that your skills in HTML which I imagine</span> <span data-start="537.019" data-end="538.43">even many of us already have they are</span> <span data-start="538.43" data-end="540.139">completely useless when you're using</span> <span data-start="540.139" data-end="541.939">this plugin so we try to find the</span> <span data-start="541.939" data-end="543.259">equivalent plugin for roll-up and</span> <span data-start="543.259" data-end="544.79">couldn't find one to make us comparison</span> <span data-start="544.79" data-end="548.209">fair so we decided to write our own so</span> <span data-start="548.209" data-end="550.579">roller plugins are just functions that</span> <span data-start="550.579" data-end="552.829">return objects and that object has a</span> <span data-start="552.829" data-end="554.54">name key just so that your plugin can</span> <span data-start="554.54" data-end="556.399">have a name and Rob can generate nice</span> <span data-start="556.399" data-end="558.11">error messages and debug messages and</span> <span data-start="558.11" data-end="559.85">the rest of his object are just</span> <span data-start="559.85" data-end="562.97">callbacks for the various stages of the</span> <span data-start="562.97" data-end="564.459">build and these are all very</span> <span data-start="564.459" data-end="566.54">well-documented yeah so the one we're</span> <span data-start="566.54" data-end="567.68">gonna use for this one so we're gonna</span> <span data-start="567.68" data-end="569.899">use the generate bundle hook and this is</span> <span data-start="569.899" data-end="571.639">called just before it writes everything</span> <span data-start="571.639" data-end="573.74">to disk you get the options that roll-up</span> <span data-start="573.74" data-end="575.389">was called with there and you also get</span> <span data-start="575.389" data-end="577.449">this bundle object which looks like this</span> <span data-start="577.449" data-end="580.04">this tells you everything about the the</span> <span data-start="580.04" data-end="582.529">build you know so so as for the</span> </p>
<p><span data-start="582.529" data-end="583.97">JavaScript files for example you get the</span> <span data-start="583.97" data-end="585.92">initial path the path the source file</span> <span data-start="585.92" data-end="588.079">you get the output filename which has</span> <span data-start="588.079" data-end="590.93">been hashed for long paths which are</span> <span data-start="590.93" data-end="593.149">caching and but it also loads of other</span> <span data-start="593.149" data-end="596.089">data like dependencies and which exports</span> <span data-start="596.089" data-end="600.05">it has and JavaScript files you do get a</span> <span data-start="600.05" data-end="602.449">subset of this kind of information did I</span> <span data-start="602.449" data-end="604.04">go too fast through my bit and not keep</span> <span data-start="604.04" data-end="605.329">time to open the bottle I'm sorry is</span> <span data-start="605.329" data-end="606.559">that the fizzy water or the still water</span> </p>
<p><span data-start="606.559" data-end="608.3">I feel very strongly about this stuff</span> <span data-start="608.3" data-end="614.089">which will that still okay right yes so</span> <span data-start="614.089" data-end="615.92">this is the whole build config tells us</span> <span data-start="615.92" data-end="617.389">everything about what's going on inside</span> <span data-start="617.389" data-end="619.819">roll ups little world but we can use</span> <span data-start="619.819" data-end="622.189">this to create our HTML so what we're</span> <span data-start="622.189" data-end="623.12">going to do is we're going to load an</span> <span data-start="623.12" data-end="626.149">ejs templates and compile it and now you</span> <span data-start="626.149" data-end="627.589">know we're just using a GS as an example</span> <span data-start="627.589" data-end="629.209">well it's the one we use but you can use</span> <span data-start="629.209" data-end="631.04">any templating language you want like</span> <span data-start="631.04" data-end="633.679">roll up doesn't care all we all it cares</span> <span data-start="633.679" data-end="635.179">about is it wants to know about this</span> <span data-start="635.179" data-end="636.829">HTML and it wants to know where to write</span> <span data-start="636.829" data-end="638.72">it to so we're going to use roll-ups</span> <span data-start="638.72" data-end="641.3">Amit file method there you tell it's an</span> <span data-start="641.3" data-end="642.949">asset and you give it a file name and</span> <span data-start="642.949" data-end="644.509">you give it the source of the HTML and</span> <span data-start="644.509" data-end="646.22">now roll up will write that file along</span> <span data-start="646.22" data-end="648.709">with everything else so here's our</span> <span data-start="648.709" data-end="650.209">template now we've got a placeholder</span> <span data-start="650.209" data-end="653.089">here for the JavaScript file name which</span> <span data-start="653.089" data-end="654.829">we don't know ahead of time because as I</span> <span data-start="654.829" data-end="657.199">said roll up will add a hash to the file</span> <span data-start="657.199" data-end="659.899">name so we need to pass in that final</span> <span data-start="659.899" data-end="661.91">file name into our templating engine</span> <span data-start="661.91" data-end="662.81">after half</span> <span data-start="662.81" data-end="665.6">and we can get this as I said from the</span> <span data-start="665.6" data-end="667.49">bundle object since it tells us both the</span> <span data-start="667.49" data-end="669.29">input path in the output path so we</span> <span data-start="669.29" data-end="671.69">create little helper here called get J s</span> <span data-start="671.69" data-end="673.46">which we just goes to the bundle and</span> <span data-start="673.46" data-end="676.55">finds the corresponding file yes so now</span> <span data-start="676.55" data-end="678.68">all we need to do is add that new</span> <span data-start="678.68" data-end="680.03">plug-in into our rule of config and</span> <span data-start="680.03" data-end="681.77">that's it we're done</span> <span data-start="681.77" data-end="683.39">now you know everything you need to know</span> <span data-start="683.39" data-end="686.78">to write a rollup plug-in and I realized</span> <span data-start="686.78" data-end="688.52">that you know that it's a pretty quick</span> <span data-start="688.52" data-end="690.62">introduction just throw at you but again</span> <span data-start="690.62" data-end="693.17">compare it to the web pack version and</span> </p>
<p><span data-start="693.17" data-end="696.02">I'd argue that what we wrote is simpler</span> <span data-start="696.02" data-end="698.54">just a little bit and and the good thing</span> <span data-start="698.54" data-end="699.92">is that everyone on our team I think</span> <span data-start="699.92" data-end="701.54">felt like they were comfortable with</span> <span data-start="701.54" data-end="703.19">touching that piece of code and</span> <span data-start="703.19" data-end="705.41">adjusting the plugin if it needed any</span> <span data-start="705.41" data-end="707.6">kind of changing and even better like</span> <span data-start="707.6" data-end="709.22">we're writing code to do what we want</span> <span data-start="709.22" data-end="711.32">rather than wrangling config so if we</span> <span data-start="711.32" data-end="712.64">wanted our HTML to be a slightly</span> <span data-start="712.64" data-end="714.17">different shape we could just go into</span> <span data-start="714.17" data-end="715.52">the template and change it on to add a</span> <span data-start="715.52" data-end="717.79">new tag rearrange things it's just HTML</span> <span data-start="717.79" data-end="720.68">but what do we actually need to change</span> <span data-start="720.68" data-end="722.42">to make things faster so I was slow on</span> <span data-start="722.42" data-end="724.31">the slow end on the flow and phones but</span> <span data-start="724.31" data-end="726.11">we need to figure out where procs was</span> <span data-start="726.11" data-end="728.24">actually using performance our tool of</span> <span data-start="728.24" data-end="731.78">choice for testing websites in as real</span> <span data-start="731.78" data-end="733.22">world conditions as possible</span> <span data-start="733.22" data-end="736.07">it's webpagetest.org it lets you run</span> <span data-start="736.07" data-end="738.5">tests on real devices which makes a big</span> <span data-start="738.5" data-end="740.24">difference and also has an excellent</span> <span data-start="740.24" data-end="743.06">emulation of worse network connections</span> <span data-start="743.06" data-end="745.07">yeah I always like to test on a moto G</span> <span data-start="745.07" data-end="748.22">for this is a fairly old now phone it</span> <span data-start="748.22" data-end="749.42">was a mid-range phone even when it came</span> <span data-start="749.42" data-end="750.92">out but it's not dissimilar to the kind</span> <span data-start="750.92" data-end="752.33">of phones that a lot of people have in</span> <span data-start="752.33" data-end="754.19">the world we're also going to test on a</span> <span data-start="754.19" data-end="756.17">3G connection and 3G is actually a</span> <span data-start="756.17" data-end="757.4">really good speed to measure I know</span> <span data-start="757.4" data-end="759.95">we're mostly used to here to like 4G and</span> </p>
<p><span data-start="759.95" data-end="763.07">LTE and maybe even 5g soon but you know</span> <span data-start="763.07" data-end="764.96">often due to signal strength and</span> <span data-start="764.96" data-end="766.67">contention you will be experiencing</span> <span data-start="766.67" data-end="768.5">speeds closer to 3G and sometimes even</span> <span data-start="768.5" data-end="770.69">worse so here's the results for the very</span> <span data-start="770.69" data-end="773.39">first version of procs before we'd</span> <span data-start="773.39" data-end="774.92">optimized it and whenever I look at</span> <span data-start="774.92" data-end="776.24">webpagetest the first thing I look at is</span> <span data-start="776.24" data-end="777.65">this film strip along the top because</span> <span data-start="777.65" data-end="779.39">there that shows us what the user sees</span> <span data-start="779.39" data-end="782.36">as the site is downloading yeah so let's</span> <span data-start="782.36" data-end="785.87">break that down for the first 4.2 second</span> <span data-start="785.87" data-end="791.27">the user sees absolutely nothing that's</span> <span data-start="791.27" data-end="793.91">what nothing looks like quite literally</span> <span data-start="793.91" data-end="796.2">no things totally Finglas</span> <span data-start="796.2" data-end="799.26">but out of nothing emerges our first</span> <span data-start="799.26" data-end="802.829">render that's our first render we can't</span> <span data-start="802.829" data-end="804.6">really count it as interactive though</span> <span data-start="804.6" data-end="807">until let the user sees the full UI with</span> <span data-start="807" data-end="808.74">with all of the interactivity and the</span> <span data-start="808.74" data-end="810.24">user doesn't get that until they have</span> <span data-start="810.24" data-end="811.829">been waiting five point one seconds so</span> <span data-start="811.829" data-end="813.12">we're well over that three-second mark</span> <span data-start="813.12" data-end="814.949">that causes fifty percent of people to</span> <span data-start="814.949" data-end="817.35">abandon according to some studies but</span> <span data-start="817.35" data-end="819.81">like we said we are targeting these 15</span> <span data-start="819.81" data-end="821.279">dollar feature phones in these fifteen</span> <span data-start="821.279" data-end="822.87">dollar feature phones are most popular</span> <span data-start="822.87" data-end="825.029">in emerging markets like India and their</span> <span data-start="825.029" data-end="828.209">speeds like 2g are much more on a daily</span> <span data-start="828.209" data-end="831.17">basis happening so on 2g the user gets</span> <span data-start="831.17" data-end="833.91">8.1 seconds of absolutely nothing than a</span> <span data-start="833.91" data-end="836.37">pretty useless render and in total it</span> <span data-start="836.37" data-end="838.829">takes almost 11 seconds until the user</span> <span data-start="838.829" data-end="841.56">can actually start playing the game 11</span> <span data-start="841.56" data-end="842.48">seconds let's put that into perspective</span> </p>
<p><span data-start="842.48" data-end="845.279">Usain Bolt can run 100 meters quicker</span> <span data-start="845.279" data-end="846.87">than it takes to load our dumb game</span> <span data-start="846.87" data-end="849.779">right so so all in all the user had to</span> <span data-start="849.779" data-end="852.839">load 62 kilobytes before the site was</span> <span data-start="852.839" data-end="855.93">actually interactive surely we can do</span> <span data-start="855.93" data-end="858.269">better but what is a realistic goal for</span> <span data-start="858.269" data-end="860.67">us here and that's what I asked Jake to</span> <span data-start="860.67" data-end="862.199">figure out yeah so I went and did some</span> <span data-start="862.199" data-end="864.839">competitor analysis and here it is so</span> <span data-start="864.839" data-end="867.48">this is a graph of the size of Windows</span> <span data-start="867.48" data-end="870.269">minesweeper over time it starts off at</span> <span data-start="870.269" data-end="873.36">11 kilobytes in windows 3.11 that's</span> <span data-start="873.36" data-end="875.04">pretty small it actually gets smaller</span> <span data-start="875.04" data-end="876.75">which is kind of amazing like 9.3</span> <span data-start="876.75" data-end="877.98">kilobytes and Windows 95</span> <span data-start="877.98" data-end="880.17">much smaller than procs the piece of</span> <span data-start="880.17" data-end="881.37">we made right like they're doing</span> <span data-start="881.37" data-end="884.82">we made right like they're doing really well but then in Windows 2000 it</span> <span data-start="884.82" data-end="887.43">became bigger seven times bigger in fact</span> <span data-start="887.43" data-end="890.04">70 K now this is now bigger than procs</span> <span data-start="890.04" data-end="892.56">the site's crept up again in Windows XP</span> <span data-start="892.56" data-end="897.57">there so it's up to 80k but then BAM it</span> <span data-start="897.57" data-end="899.699">became 50 times bigger three point eight</span> <span data-start="899.699" data-end="903.329">four megabytes in Windows Vista roughly</span> <span data-start="903.329" data-end="909.36">the same size in Windows 7 but then BAM</span> <span data-start="909.36" data-end="911.91">it became 25 times bigger still it's a</span> <span data-start="911.91" data-end="913.98">hundred and four megabytes in Windows 10</span> <span data-start="913.98" data-end="915.72">absolutely seriously minesweeper is</span> <span data-start="915.72" data-end="917.16">growing so fast we have to switch the</span> <span data-start="917.16" data-end="920.31">graph to a logarithmic scale if you</span> <span data-start="920.31" data-end="921.959">sometimes wake up at night and worrying</span> <span data-start="921.959" data-end="923.76">about how you CSS code base is growing</span> <span data-start="923.76" data-end="925.29">on proportion don't worry you're still</span> <span data-start="925.29" data-end="928.529">doing better than Microsoft yeah and if</span> <span data-start="928.529" data-end="930.72">you analyze this trend which we did by</span> <span data-start="930.72" data-end="935.31">2025 — people would be 2 terabytes by</span> <span data-start="935.31" data-end="937.05">2030 we predict two thirds of the</span> <span data-start="937.05" data-end="938.19">planet's surface will be covered by a</span> <span data-start="938.19" data-end="940.23">single hard drive containing one copy of</span> </p>
<p><span data-start="940.23" data-end="941.19">Windows minesweeper</span> <span data-start="941.19" data-end="951.6">I mean Rotenberg is doing some great</span> <span data-start="951.6" data-end="952.86">outreach of raising awareness with</span> <span data-start="952.86" data-end="954.449">climate change but really should be</span> <span data-start="954.449" data-end="955.439">worrying about the biggest threat to</span> <span data-start="955.439" data-end="957.39">mankind which is Microsoft minesweeper</span> <span data-start="957.39" data-end="959.85">absolutely so you have my conclusion is</span> <span data-start="959.85" data-end="964.529">really that procs is 62k not really</span> <span data-start="964.529" data-end="966.6">doing that badly so there you go thank</span> <span data-start="966.6" data-end="967.949">you good night thank you for this</span> <span data-start="967.949" data-end="971.13">insightful report so but on the other</span> <span data-start="971.13" data-end="973.5">hand we do know that my super can be</span> <span data-start="973.5" data-end="976.589">done in like 11k 10k that kind of</span> <span data-start="976.589" data-end="979.14">territory and so admittedly our version</span> <span data-start="979.14" data-end="981.36">has a bit more going on graphically but</span> <span data-start="981.36" data-end="984.6">still 62 kilobytes to interactive we</span> <span data-start="984.6" data-end="986.91">should probably reduce that yeah we</span> <span data-start="986.91" data-end="988.11">probably should so if you want to</span> <span data-start="988.11" data-end="989.61">improve the performance of your site and</span> <span data-start="989.61" data-end="990.839">you only have like a few minutes to</span> <span data-start="990.839" data-end="991.23">spare</span> <span data-start="991.23" data-end="992.97">identify the important resources that</span> <span data-start="992.97" data-end="995.85">start loading too late and so we're</span> <span data-start="995.85" data-end="996.87">looking at the timeline here we're</span> <span data-start="996.87" data-end="998.31">getting stuff we're getting this render</span> <span data-start="998.31" data-end="1000.74">it like 4.2 seconds and our JavaScript</span> <span data-start="1000.74" data-end="1002.149">is loaded at that point so the site is</span> <span data-start="1002.149" data-end="1004.6">completely ready to go but it is useless</span> <span data-start="1004.6" data-end="1007.699">because the text is not rendering you</span> <span data-start="1007.699" data-end="1009.98">guessed it we are using a web font a web</span> <span data-start="1009.98" data-end="1012.05">form so we're using space mono from</span> <span data-start="1012.05" data-end="1013.819">google fonts both the normal and the</span> <span data-start="1013.819" data-end="1016.399">bold version and they're about 10k each</span> <span data-start="1016.399" data-end="1018.74">which as far as web fonts go is it</span> <span data-start="1018.74" data-end="1020.569">actually not that bad so why are they</span> <span data-start="1020.569" data-end="1022.699">giving us so much trouble yes and find</span> <span data-start="1022.699" data-end="1024.14">out we need to dive into the network</span> <span data-start="1024.14" data-end="1026.72">panel of webpagetest or in dev tools it</span> <span data-start="1026.72" data-end="1028.549">gives you the same information and</span> <span data-start="1028.549" data-end="1029.54">here's the pattern that we were seeing</span> <span data-start="1029.54" data-end="1032.24">first off the HTML downloads the filler</span> <span data-start="1032.24" data-end="1033.53">line here is a convention that both</span> <span data-start="1033.53" data-end="1034.939">webpagetest and chrome dev tools</span> <span data-start="1034.939" data-end="1037.37">actually use it means it's setting up a</span> <span data-start="1037.37" data-end="1039.89">new HTTP connection and the thicker line</span> <span data-start="1039.89" data-end="1041.51">is then the time it takes for</span> <span data-start="1041.51" data-end="1043.64">request and response yes and once that's</span> <span data-start="1043.64" data-end="1045.89">done it will download the CSS and then</span> <span data-start="1045.89" data-end="1047.959">it downloads the actual fonts now when</span> <span data-start="1047.959" data-end="1049.22">you're looking at these sort of diagrams</span> <span data-start="1049.22" data-end="1050.57">especially compared to rendering it's</span> <span data-start="1050.57" data-end="1052.13">worth noting that they don't always</span> <span data-start="1052.13" data-end="1053.93">exactly align and that's because once</span> <span data-start="1053.93" data-end="1055.49">the browser is downloaded something it</span> <span data-start="1055.49" data-end="1057.41">then needs to parse and execute it and</span> <span data-start="1057.41" data-end="1059.09">then paint it which takes time so</span> <span data-start="1059.09" data-end="1061.01">there's like an offset compared to you</span> <span data-start="1061.01" data-end="1062.54">know actual painted things on the screen</span> <span data-start="1062.54" data-end="1064.43">anyway the red flag here is that both</span> <span data-start="1064.43" data-end="1066.41">the CSS and the font files have their</span> <span data-start="1066.41" data-end="1068.96">own thin line meaning there's a TP</span> <span data-start="1068.96" data-end="1070.97">connection being set up and this is</span> <span data-start="1070.97" data-end="1073.46">because the CSS is actually on another</span> <span data-start="1073.46" data-end="1075.47">server it's on Fahnestock Google API</span> <span data-start="1075.47" data-end="1077.54">it's calm and so it has to start a new</span> <span data-start="1077.54" data-end="1078.71">connection to actually be able to</span> <span data-start="1078.71" data-end="1080.81">download that file yes but if we look</span> <span data-start="1080.81" data-end="1082.64">inside the actual CSS we can see the</span> <span data-start="1082.64" data-end="1084.56">fonts are actually hosted on yet another</span> <span data-start="1084.56" data-end="1086.9">server so this is fonts G static com so</span> <span data-start="1086.9" data-end="1088.79">that's yet another connection and the</span> <span data-start="1088.79" data-end="1090.68">quick fix here is to copy the CSS in the</span> <span data-start="1090.68" data-end="1093.05">fonts to our own server that way the</span> <span data-start="1093.05" data-end="1095.06">browser can reuse the already existing</span> <span data-start="1095.06" data-end="1096.98">connection and in theory we feel safe</span> <span data-start="1096.98" data-end="1099.44">around a second but wait you can't just</span> <span data-start="1099.44" data-end="1101.24">do that fonts are protected by various</span> <span data-start="1101.24" data-end="1102.98">intellectual property laws including</span> <span data-start="1102.98" data-end="1104.6">trademarks copyrights and design patents</span> </p>
<p><span data-start="1104.6" data-end="1106.58">Cottenham to your own server may violate</span> <span data-start="1106.58" data-end="1109.49">the policy of the rights holder valid</span> <span data-start="1109.49" data-end="1111.8">concerned but doesn't apply when you use</span> <span data-start="1111.8" data-end="1113.51">Google phones all the phones on Google</span> <span data-start="1113.51" data-end="1114.74">phones are open source and have</span> <span data-start="1114.74" data-end="1116.3">permissive licenses that you can just</span> <span data-start="1116.3" data-end="1118.88">copy to your own server Oh disaster</span> <span data-start="1118.88" data-end="1119.57">averted</span> </p>
<p><span data-start="1119.57" data-end="1122.21">I for one will sleep tonight in fact the</span> <span data-start="1122.21" data-end="1123.83">CSS turns out to be so small that we</span> <span data-start="1123.83" data-end="1126.2">might as well just inline it into our</span> <span data-start="1126.2" data-end="1128.93">HTML all about these fonts now the</span> <span data-start="1128.93" data-end="1130.49">browser tries to be smart here when it</span> <span data-start="1130.49" data-end="1131.66">comes to font downloading it won't</span> <span data-start="1131.66" data-end="1133.19">download fonts until it finds something</span> <span data-start="1133.19" data-end="1135.02">on the page that actually needs them so</span> <span data-start="1135.02" data-end="1136.85">that means it waits for the CSS to be</span> <span data-start="1136.85" data-end="1139.34">loaded and then an element appearing on</span> <span data-start="1139.34" data-end="1142.19">it in the dom that contains text that</span> <span data-start="1142.19" data-end="1143.6">needs that font and this is good in some</span> <span data-start="1143.6" data-end="1145.34">ways because it means the browser going</span> <span data-start="1145.34" data-end="1146.66">to avoid downloading fonts it doesn't</span> <span data-start="1146.66" data-end="1149.78">need but in this case we know it needs</span> <span data-start="1149.78" data-end="1151.28">both of those fonts from the very start</span> <span data-start="1151.28" data-end="1154.43">and the answer is a link rel preload tag</span> <span data-start="1154.43" data-end="1156.32">in the head of the document these tags</span> <span data-start="1156.32" data-end="1157.64">basically allow you to tell the browser</span> <span data-start="1157.64" data-end="1159.98">that it should download a thing and keep</span> <span data-start="1159.98" data-end="1161.57">it in memory until it's actually being</span> <span data-start="1161.57" data-end="1163.22">requested by the page and then it's</span> <span data-start="1163.22" data-end="1165.53">already there and with those small</span> <span data-start="1165.53" data-end="1167.48">changes we should see the yellow line</span> <span data-start="1167.48" data-end="1169.07">shrink when we pass it through</span> <span data-start="1169.07" data-end="1171.68">webpagetest the next time that's dude so</span> <span data-start="1171.68" data-end="1172.89">note that</span> </p>
<p><span data-start="1172.89" data-end="1177.38">Wow let's go back let's do it again hey</span> <span data-start="1177.38" data-end="1179.97">don't run Chrome Canary for your slides</span> <span data-start="1179.97" data-end="1185.22">I should know this by now okay have some</span> <span data-start="1185.22" data-end="1187.76">Atari yeah yeah I should have learned oh</span> <span data-start="1187.76" data-end="1191.25">so in theory we should be saving a good</span> <span data-start="1191.25" data-end="1193.65">amount of time here right but we have to</span> <span data-start="1193.65" data-end="1195.21">get it working within the build tools we</span> <span data-start="1195.21" data-end="1197.429">have so this is the plugin we saw before</span> <span data-start="1197.429" data-end="1199.77">the one that creates the HTML what we</span> <span data-start="1199.77" data-end="1201.66">need to do is inline the CSS for our</span> <span data-start="1201.66" data-end="1203.46">fonts and we need to add a preload tag</span> <span data-start="1203.46" data-end="1204.929">for each of them now</span> </p>
<p><span data-start="1204.929" data-end="1206.04">I'm not gonna go for it step by step</span> <span data-start="1206.04" data-end="1207.84">we've only got like 30 minutes or</span> <span data-start="1207.84" data-end="1209.28">whatever but it looks a little bit like</span> <span data-start="1209.28" data-end="1212.25">this whoo there it goes so at the start</span> <span data-start="1212.25" data-end="1214.95">of the build we use roll-ups Amit method</span> <span data-start="1214.95" data-end="1217.11">to bring the fun files into our build so</span> <span data-start="1217.11" data-end="1218.64">now roll-up is aware of these files and</span> <span data-start="1218.64" data-end="1220.29">we'll add hashes to the file name and</span> <span data-start="1220.29" data-end="1221.669">put it into the output folder all these</span> <span data-start="1221.669" data-end="1223.08">little things and when it comes to</span> <span data-start="1223.08" data-end="1225.66">generating our HTML we pass that data</span> <span data-start="1225.66" data-end="1228.21">into our template now so that we can</span> <span data-start="1228.21" data-end="1229.77">where this helper will actually give us</span> <span data-start="1229.77" data-end="1232.26">the final URL off the font files yes</span> <span data-start="1232.26" data-end="1233.88">that means we need to go back into our</span> <span data-start="1233.88" data-end="1235.74">template and we need to loop over that</span> <span data-start="1235.74" data-end="1238.169">font data and output a style tag that</span> <span data-start="1238.169" data-end="1239.79">defines the font and this is just all</span> <span data-start="1239.79" data-end="1240.99">the stuff we passed into the template</span> <span data-start="1240.99" data-end="1243">before there's the weight there's the</span> <span data-start="1243" data-end="1244.74">source and then we're gonna add a</span> <span data-start="1244.74" data-end="1246.03">preload type for each of those as well</span> <span data-start="1246.03" data-end="1247.83">so what I really like about this that</span> <span data-start="1247.83" data-end="1250.08">the roller plugin handles all the</span> <span data-start="1250.08" data-end="1252.6">roll-up specific stuff like making it</span> <span data-start="1252.6" data-end="1254.19">aware of the files putting them into the</span> <span data-start="1254.19" data-end="1255.87">build pipeline and adding hashes blah</span> <span data-start="1255.87" data-end="1257.669">blah blah blah blah but then for the</span> </p>
<p><span data-start="1257.669" data-end="1261.45">HTML part we use our HTML skills there's</span> <span data-start="1261.45" data-end="1263.49">nothing specific to roll up about this</span> <span data-start="1263.49" data-end="1265.2">template so roll up isn't preventing us</span> <span data-start="1265.2" data-end="1267.84">from rearranging or even adding new HTML</span> <span data-start="1267.84" data-end="1270.419">tags to our markup but we are not done</span> <span data-start="1270.419" data-end="1272.28">yet the fonts aren't the only asset that</span> <span data-start="1272.28" data-end="1273.78">is loading too late at the same time</span> <span data-start="1273.78" data-end="1275.52">like our main script loads and it also</span> <span data-start="1275.52" data-end="1277.14">will load to the other scripts it needs</span> <span data-start="1277.14" data-end="1278.669">so this is the code splitting thing we</span> <span data-start="1278.669" data-end="1279.179">saw before</span> <span data-start="1279.179" data-end="1280.799">because we're sharing scripts between</span> <span data-start="1280.799" data-end="1283.32">the the main thread and workers they sit</span> <span data-start="1283.32" data-end="1286.74">in different files but you know we know</span> <span data-start="1286.74" data-end="1288.72">once again that the main page will</span> <span data-start="1288.72" data-end="1290.61">always need all three of these scripts</span> <span data-start="1290.61" data-end="1292.59">so we should be pre loading those as</span> <span data-start="1292.59" data-end="1294.69">well yeah but the question is what what</span> <span data-start="1294.69" data-end="1296.28">faults should be pre loading we know</span> <span data-start="1296.28" data-end="1297.66">there are dependencies but what are</span> <span data-start="1297.66" data-end="1300.03">their actual names and luckily the role</span> <span data-start="1300.03" data-end="1302.01">of bundle object gives us the answer as</span> </p>
<p><span data-start="1302.01" data-end="1304.26">I said for each JavaScript piece of</span> <span data-start="1304.26" data-end="1305.23">output that we have</span> <span data-start="1305.23" data-end="1307.24">it will list give us an array of files</span> <span data-start="1307.24" data-end="1309.76">that are being directly or statically</span> <span data-start="1309.76" data-end="1313.21">imported so in this case we pass that</span> <span data-start="1313.21" data-end="1315.519">data into our template engine by just</span> <span data-start="1315.519" data-end="1318.21">looking at the dot imports property and</span> <span data-start="1318.21" data-end="1320.95">back over an hour EGS template we can</span> <span data-start="1320.95" data-end="1322.75">now just loop over these dependencies</span> <span data-start="1322.75" data-end="1325.269">and generate a preload tag for each of</span> <span data-start="1325.269" data-end="1326.769">them yeah just like that</span> <span data-start="1326.769" data-end="1328.48">so we've now moved our fonts onto our</span> <span data-start="1328.48" data-end="1330.46">own server we've added some preload tags</span> <span data-start="1330.46" data-end="1331.84">for them and for our scripts as well</span> <span data-start="1331.84" data-end="1334.48">better in theory but what does</span> <span data-start="1334.48" data-end="1336.19">webpagetest tell us about the real-world</span> <span data-start="1336.19" data-end="1339.13">impact well we have eliminated the know</span> <span data-start="1339.13" data-end="1341.049">fonts for I know the second anything is</span> <span data-start="1341.049" data-end="1343.45">on screen its interactive and good to go</span> <span data-start="1343.45" data-end="1345.429">and it's a one-second improvement on 3G</span> <span data-start="1345.429" data-end="1347.169">and a massive three second improvement</span> <span data-start="1347.169" data-end="1350.5">on 2g we haven't really impacted the red</span> <span data-start="1350.5" data-end="1352.419">bar though the time where the user sees</span> <span data-start="1352.419" data-end="1355.12">absolutely nothing yeah and four seconds</span> <span data-start="1355.12" data-end="1355.929">that's a lot of nothing</span> <span data-start="1355.929" data-end="1358.929">eight seconds is a lot a lot of nothing</span> <span data-start="1358.929" data-end="1360.789">this is the part where the user is just</span> <span data-start="1360.789" data-end="1362.049">staring at a white screen they don't</span> <span data-start="1362.049" data-end="1364.899">even know if the server is even think</span> <span data-start="1364.899" data-end="1366.7">about sending them a response so looking</span> <span data-start="1366.7" data-end="1368.61">at webpage tests network waterfall</span> <span data-start="1368.61" data-end="1371.169">confirms that we achieve what we set out</span> <span data-start="1371.169" data-end="1373.24">to do everything that's important is now</span> <span data-start="1373.24" data-end="1376.659">loading in parallel it's just taking too</span> <span data-start="1376.659" data-end="1378.46">long yeah so we have two options here</span> <span data-start="1378.46" data-end="1379.63">like we can have a try and make this</span> <span data-start="1379.63" data-end="1383.889">just shorter by shipping less code or we</span> <span data-start="1383.889" data-end="1386.38">can just make it matter less yep so</span> <span data-start="1386.38" data-end="1388.84">right now we are fully reliant on Java</span> </p>
<p><span data-start="1388.84" data-end="1391.899">Script to put anything on the screen so</span> <span data-start="1391.899" data-end="1394.769">let's put a stop to that let's use</span> <span data-start="1394.769" data-end="1397.36">server-side rendering but at build time</span> <span data-start="1397.36" data-end="1399.34">and that's often called a pre render or</span> <span data-start="1399.34" data-end="1401.74">a static render yeah so we want used to</span> <span data-start="1401.74" data-end="1403.63">see something like this like it's not</span> <span data-start="1403.63" data-end="1404.98">interactive at this stage so we've</span> <span data-start="1404.98" data-end="1406.51">removed all of the the buttons that</span> <span data-start="1406.51" data-end="1408.49">depend on JavaScript but this can appear</span> <span data-start="1408.49" data-end="1410.559">while the JavaScript is loading and this</span> <span data-start="1410.559" data-end="1411.94">really improves the perception of</span> <span data-start="1411.94" data-end="1413.35">performance because the user sees that</span> <span data-start="1413.35" data-end="1415.48">something is happening and then once the</span> </p>
<p><span data-start="1415.48" data-end="1416.83">JavaScript loads it can sort of lazily</span> <span data-start="1416.83" data-end="1420.159">enhance the page and there are a few</span> <span data-start="1420.159" data-end="1422.559">ways to actually do this every Dom</span> <span data-start="1422.559" data-end="1424.179">orchestration framework that is we're</span> <span data-start="1424.179" data-end="1425.95">talking about has a way to generate an</span> <span data-start="1425.95" data-end="1428.769">HTML string from its components and imp</span> <span data-start="1428.769" data-end="1430.96">react and react land that is called</span> <span data-start="1430.96" data-end="1433.84">render to string this is pretty fast</span> <span data-start="1433.84" data-end="1435.46">it's not as fast as a general-purpose</span> <span data-start="1435.46" data-end="1437.769">templating engine but pretty close to</span> <span data-start="1437.769" data-end="1438.85">the point where actually</span> <span data-start="1438.85" data-end="1441.84">people do run this on every request</span> <span data-start="1441.84" data-end="1444.34">although we only want to use its built</span> <span data-start="1444.34" data-end="1446.47">time so super high performance is not as</span> <span data-start="1446.47" data-end="1448.51">big of a requirement for us in this</span> <span data-start="1448.51" data-end="1452.38">particular use case however render to</span> <span data-start="1452.38" data-end="1454.57">string runs an ode and we actually see</span> <span data-start="1454.57" data-end="1456.49">that as kind of a downside because if</span> <span data-start="1456.49" data-end="1458.98">you have any codes in your components</span> <span data-start="1458.98" data-end="1459.97">that assumes to be running in the</span> <span data-start="1459.97" data-end="1462.28">browser which usually is a fair</span> <span data-start="1462.28" data-end="1464.44">assumption to make that will break and</span> <span data-start="1464.44" data-end="1466.75">not so we had a component with index DB</span> <span data-start="1466.75" data-end="1470.2">and that would just break we could fix</span> <span data-start="1470.2" data-end="1472.21">that by adding like code branches for</span> <span data-start="1472.21" data-end="1474.22">node versus browser but that will get</span> <span data-start="1474.22" data-end="1477.91">really messy over time over all ready to</span> <span data-start="1477.91" data-end="1480.13">string is probably ideal if you can bend</span> <span data-start="1480.13" data-end="1482.11">your components that way it's not what</span> <span data-start="1482.11" data-end="1484.3">we ended up using though no we looked at</span> </p>
<p><span data-start="1484.3" data-end="1486.13">JSON which is kind of like a browser</span> <span data-start="1486.13" data-end="1488.74">environment but it runs inside node the</span> <span data-start="1488.74" data-end="1490.9">problem there is the word kind of like</span> <span data-start="1490.9" data-end="1492.55">jest um it's like an entirely new</span> <span data-start="1492.55" data-end="1493.78">browser that you end up having to</span> <span data-start="1493.78" data-end="1495.31">support and we try to use it this is</span> <span data-start="1495.31" data-end="1496.39">what we thought we were going to settle</span> <span data-start="1496.39" data-end="1498.58">on but then we hit all these kind of</span> <span data-start="1498.58" data-end="1501.01">weird quirks like as part of our</span> <span data-start="1501.01" data-end="1502.48">inlining process we had some inline</span> </p>
<p><span data-start="1502.48" data-end="1504.31">Styles and we resource some of those</span> <span data-start="1504.31" data-end="1506.86">just going missing and it turns out that</span> <span data-start="1506.86" data-end="1510.01">JSON doesn't understand linear gradients</span> <span data-start="1510.01" data-end="1512.05">so it's just getting rid of them and</span> <span data-start="1512.05" data-end="1513.01">this is the right thing for it to do</span> <span data-start="1513.01" data-end="1514.75">this is what the the spec says the spec</span> <span data-start="1514.75" data-end="1516.1">says if there's an inline style you</span> <span data-start="1516.1" data-end="1518.05">don't understand it just just discard it</span> <span data-start="1518.05" data-end="1520.45">and JSON was dutifully behaving like a</span> <span data-start="1520.45" data-end="1522.31">browser according to that spec just it</span> <span data-start="1522.31" data-end="1523.66">was a browser that doesn't understand</span> <span data-start="1523.66" data-end="1527.05">linear gradients and also 4x12 is slower</span> <span data-start="1527.05" data-end="1528.85">than render to string so it's not</span> <span data-start="1528.85" data-end="1529.84">something you would want to be running</span> <span data-start="1529.84" data-end="1531.22">on every request but it's really matter</span> <span data-start="1531.22" data-end="1533.92">to us so in the end we ended up with</span> <span data-start="1533.92" data-end="1536.65">puppeteer babbity launches a headless</span> <span data-start="1536.65" data-end="1539.08">version of drone that you get to remote</span> <span data-start="1539.08" data-end="1540.76">control you can load pages you can</span> <span data-start="1540.76" data-end="1542.35">inject JavaScript you can inspect the</span> </p>
<p><span data-start="1542.35" data-end="1544.69">Dom it can read back any results and so</span> <span data-start="1544.69" data-end="1547.48">your code is running in an actual Chrome</span> <span data-start="1547.48" data-end="1549.19">so you don't have to it's not a new</span> <span data-start="1549.19" data-end="1551.5">browser for you to support it is however</span> <span data-start="1551.5" data-end="1553.72">obviously slower than render to string</span> <span data-start="1553.72" data-end="1557.14">it is also slower than j/s Dom but</span> <span data-start="1557.14" data-end="1559.62">actually surprisingly only by a tiny bit</span> <span data-start="1559.62" data-end="1562.48">but as I said we only to run it once per</span> <span data-start="1562.48" data-end="1564.46">build so it's not really that big a deal</span> <span data-start="1564.46" data-end="1566.92">it is really easy to install to you so</span> <span data-start="1566.92" data-end="1568.57">if you haven't done that yet take a look</span> <span data-start="1568.57" data-end="1570.16">at it and tell us what you think but</span> <span data-start="1570.16" data-end="1572.44">let's be honest adding an entire</span> <span data-start="1572.44" data-end="1574.78">from to your build setup is a pretty big</span> <span data-start="1574.78" data-end="1577.06">jump in complexity it is what we ended</span> <span data-start="1577.06" data-end="1578.92">up doing for procs though and it wasn't</span> <span data-start="1578.92" data-end="1580.89">about yeah so how did we get it working</span> <span data-start="1580.89" data-end="1583.36">well we wrote another plugin didn't we</span> <span data-start="1583.36" data-end="1586">here it is I'm not gonna go through it</span> <span data-start="1586" data-end="1587.2">line by line just wanting to show you</span> <span data-start="1587.2" data-end="1588.9">it's a relatively small chunk of code</span> <span data-start="1588.9" data-end="1591.28">puppeteer lets us launch this invisible</span> <span data-start="1591.28" data-end="1593.29">version of Chrome we run our JavaScript</span> <span data-start="1593.29" data-end="1594.7">and we collect the HTML that it</span> <span data-start="1594.7" data-end="1598.27">generates as a nice bonus like since our</span> </p>
<p><span data-start="1598.27" data-end="1600.43">CSS was inside our JavaScript it was</span> <span data-start="1600.43" data-end="1601.81">creating style tags for all of the</span> <span data-start="1601.81" data-end="1603.16">components that were used in that first</span> <span data-start="1603.16" data-end="1605.17">render so we sort of got CSS inlining</span> <span data-start="1605.17" data-end="1606.55">just for free yep</span> <span data-start="1606.55" data-end="1608.68">so one thing we haven't covered is how</span> <span data-start="1608.68" data-end="1611.5">do we prevent the pre renderer from</span> <span data-start="1611.5" data-end="1613.41">rendering components that aren't</span> <span data-start="1613.41" data-end="1616.93">interactive yet so we want this landing</span> <span data-start="1616.93" data-end="1619.18">stream to actually look a bit more like</span> <span data-start="1619.18" data-end="1622.36">this yeah so the simplest solution to</span> <span data-start="1622.36" data-end="1624.01">get that is you know give a little bit</span> <span data-start="1624.01" data-end="1625.84">of code to puppeteer just before we end</span> <span data-start="1625.84" data-end="1627.64">it the rest of our script and that means</span> <span data-start="1627.64" data-end="1629.71">in our app we can branch on that in an</span> <span data-start="1629.71" data-end="1631.63">if statement and do stuff like you know</span> <span data-start="1631.63" data-end="1633.31">hide buttons you know rearrange things</span> <span data-start="1633.31" data-end="1635.29">whatever and since that is only ever</span> <span data-start="1635.29" data-end="1637.06">going to be true in puppeteer land it</span> <span data-start="1637.06" data-end="1640.3">won't run those steps for real users but</span> <span data-start="1640.3" data-end="1641.68">it doesn't mean that you're shipping</span> <span data-start="1641.68" data-end="1643.81">code to real users that they don't</span> <span data-start="1643.81" data-end="1646.69">actually need but then again it's</span> <span data-start="1646.69" data-end="1648.88">probably not a lot of code and it's</span> <span data-start="1648.88" data-end="1650.71">probably not worth putting in the effort</span> <span data-start="1650.71" data-end="1654.73">to strip it all out can we fix this</span> <span data-start="1654.73" data-end="1658.24">please can we fix this all right so our</span> <span data-start="1658.24" data-end="1660.31">aim is to remove this kind of code to</span> <span data-start="1660.31" data-end="1662.53">ever-reaching the production bundle that</span> <span data-start="1662.53" data-end="1665.86">is being shipped to use this here's our</span> <span data-start="1665.86" data-end="1668.2">current set of plugins can you guess</span> <span data-start="1668.2" data-end="1670.51">what we are gonna do now I don't know</span> <span data-start="1670.51" data-end="1671.98">but I'm excited about it we are gonna</span> <span data-start="1671.98" data-end="1674.38">write a plugin out yes so the plugin</span> <span data-start="1674.38" data-end="1677.02">means that we can write code like this</span> <span data-start="1677.02" data-end="1679.9">and the value of this pre-render will be</span> <span data-start="1679.9" data-end="1682.18">exactly what the value of pre-render in</span> <span data-start="1682.18" data-end="1685.84">our roll-up config script is yeah the</span> <span data-start="1685.84" data-end="1687.19">plug-in like this is great for all kinds</span> <span data-start="1687.19" data-end="1688.54">of constants like passing in late</span> <span data-start="1688.54" data-end="1690.25">version numbers of things or different</span> <span data-start="1690.25" data-end="1692.26">kinds of flags now I've seen similar</span> <span data-start="1692.26" data-end="1694.36">plugins that do this they don't require</span> <span data-start="1694.36" data-end="1696.19">the import statement they just go</span> <span data-start="1696.19" data-end="1697.96">through your code and replace a variable</span> <span data-start="1697.96" data-end="1699.73">of a given name with a particular value</span> <span data-start="1699.73" data-end="1702.07">but I don't know I kind of hate that</span> <span data-start="1702.07" data-end="1704.02">because to me it's not obvious on the</span> <span data-start="1704.02" data-end="1706.119">source code that some build magic is</span> <span data-start="1706.119" data-end="1708.189">going to happen where it's like here you</span> <span data-start="1708.189" data-end="1709.779">look at that and you go well this import</span> <span data-start="1709.779" data-end="1711.819">is not normal this is not how imports</span> <span data-start="1711.819" data-end="1714.129">normally look so you can do a quick code</span> <span data-start="1714.129" data-end="1715.959">search for like the start of that string</span> <span data-start="1715.959" data-end="1717.999">the Const call on bit and then you'll</span> <span data-start="1717.999" data-end="1720.009">find the the bill tool that's actually</span> <span data-start="1720.009" data-end="1721.419">doing that it's really easy to discover</span> <span data-start="1721.419" data-end="1724.569">and also roll up it's really smart here</span> <span data-start="1724.569" data-end="1727.149">so if you do a build where preload is</span> <span data-start="1727.149" data-end="1729.519">true it will actually optimize it to</span> <span data-start="1729.519" data-end="1732.219">this and if you do a build where it is</span> <span data-start="1732.219" data-end="1735.609">false it will optimize it to this and so</span> <span data-start="1735.609" data-end="1738.069">that's what we did we created two builds</span> <span data-start="1738.069" data-end="1740.799">one for the user and one for puppeteer</span> <span data-start="1740.799" data-end="1743.859">so let's take a look this is legit the</span> <span data-start="1743.859" data-end="1746.499">entire plugin the plugin only does</span> <span data-start="1746.499" data-end="1748.989">anything when the import statement</span> <span data-start="1748.989" data-end="1751.179">starts with Const school and if it does</span> <span data-start="1751.179" data-end="1753.609">it just generates a string of JavaScript</span> <span data-start="1753.609" data-end="1755.529">on the fly containing the value that is</span> <span data-start="1755.529" data-end="1760.329">being imported that's it that's all yeah</span> <span data-start="1760.329" data-end="1762.219">here is the comparable webpack plugin</span> <span data-start="1762.219" data-end="1763.749">that does the same thing if you want to</span> <span data-start="1763.749" data-end="1766.359">have the dead code elimination again</span> <span data-start="1766.359" data-end="1767.259">it's not something I would feel</span> <span data-start="1767.259" data-end="1770.289">comfortable hacking around with and you</span> <span data-start="1770.289" data-end="1771.789">might feel like we're you know kicking</span> <span data-start="1771.789" data-end="1774.939">web pack a lot here you were right we</span> <span data-start="1774.939" data-end="1776.559">are but the honest truth is like the</span> <span data-start="1776.559" data-end="1777.939">difference that we felt between working</span> <span data-start="1777.939" data-end="1779.409">on a project with web pack and working</span> <span data-start="1779.409" data-end="1780.639">on a project with roll-up was really</span> <span data-start="1780.639" data-end="1782.859">really night and day for us like not</span> <span data-start="1782.859" data-end="1784.269">only did we feel like we understood what</span> <span data-start="1784.269" data-end="1785.859">was happening we felt capable of</span> <span data-start="1785.859" data-end="1787.149">changing what was happening if we needed</span> <span data-start="1787.149" data-end="1787.389">to</span> <span data-start="1787.389" data-end="1789.759">especially with less Jordan past like</span> <span data-start="1789.759" data-end="1791.739">you know making work as a core part of</span> <span data-start="1791.739" data-end="1793.899">your architecture it was incredibly</span> <span data-start="1793.899" data-end="1795.429">valuable to be able to go in and just</span> <span data-start="1795.429" data-end="1797.679">change how roll-up handled these kind of</span> <span data-start="1797.679" data-end="1801.399">things yes ok now we have an optimized</span> <span data-start="1801.399" data-end="1803.349">server render what do we win what is the</span> <span data-start="1803.349" data-end="1806.199">real world impacts let's take a look so</span> <span data-start="1806.199" data-end="1807.819">we have pushed that read nothing</span> <span data-start="1807.819" data-end="1809.439">rendered time right back we've put it to</span> <span data-start="1809.439" data-end="1811.569">almost two seconds of white screen on 3G</span> <span data-start="1811.569" data-end="1814.299">we've cut it by three seconds on 2g this</span> <span data-start="1814.299" data-end="1815.979">is a massive improvement to the</span> <span data-start="1815.979" data-end="1817.899">perception of performance so the yellow</span> <span data-start="1817.899" data-end="1819.549">area represents where we have something</span> <span data-start="1819.549" data-end="1821.709">on screen but the app isn't really</span> <span data-start="1821.709" data-end="1823.989">interactive yet because the JavaScript</span> <span data-start="1823.989" data-end="1826.359">hasn't loaded but at least the user is</span> <span data-start="1826.359" data-end="1827.859">seeing something to feel like they're</span> <span data-start="1827.859" data-end="1829.629">being informed about the progress of the</span> <span data-start="1829.629" data-end="1833.259">app loading so what can we do next well</span> <span data-start="1833.259" data-end="1835.449">looking at the network waterfall to</span> <span data-start="1835.449" data-end="1837.489">remind you the thin blog is the setting</span> <span data-start="1837.489" data-end="1838.989">of a connection and the stake block is</span> <span data-start="1838.989" data-end="1839.72">the time it's</span> <span data-start="1839.72" data-end="1841.58">for the request and the response to go</span> <span data-start="1841.58" data-end="1843.71">with a wire but there's another feature</span> <span data-start="1843.71" data-end="1845.24">of network waterfalls that we can look</span> <span data-start="1845.24" data-end="1846.559">at here and that's the time to first</span> <span data-start="1846.559" data-end="1846.889">byte</span> <span data-start="1846.889" data-end="1848.929">now both webpagetest and chrome dev</span> <span data-start="1848.929" data-end="1851.69">tools they highlight the area before the</span> <span data-start="1851.69" data-end="1853.399">first byte of the responses received so</span> <span data-start="1853.399" data-end="1854.87">this is the time taken up by the request</span> <span data-start="1854.87" data-end="1856.909">and waiting for the server to start</span> <span data-start="1856.909" data-end="1858.799">sending the response and as you can see</span> <span data-start="1858.799" data-end="1860.769">there is a pretty big gap between</span> <span data-start="1860.769" data-end="1863.779">receiving all of the HTML and receiving</span> <span data-start="1863.779" data-end="1866.179">the first byte of any of the resources</span> <span data-start="1866.179" data-end="1869">used in the HTML it's about 400</span> <span data-start="1869" data-end="1871.61">milliseconds on 3G and about a second on</span> <span data-start="1871.61" data-end="1874.49">2g there are two solutions to this one</span> <span data-start="1874.49" data-end="1877.94">is HTTP to server push No</span> <span data-start="1877.94" data-end="1879.59">so how achieved approach turned out to</span> <span data-start="1879.59" data-end="1882.139">be incredibly difficult to get right we</span> <span data-start="1882.139" data-end="1883.549">have seen a couple of teams with a good</span> <span data-start="1883.549" data-end="1885.679">number of like networking experts try to</span> <span data-start="1885.679" data-end="1887.899">use it and they struggle to just break</span> <span data-start="1887.899" data-end="1890.75">even in terms of performance yeah so the</span> <span data-start="1890.75" data-end="1892.61">alternative then is inlining like we</span> <span data-start="1892.61" data-end="1894.11">take these assets and we just put them</span> <span data-start="1894.11" data-end="1896.21">straight into our HTML so first up let's</span> <span data-start="1896.21" data-end="1899.12">do that with our fonts aligning both</span> </p>
<p><span data-start="1899.12" data-end="1901.58">ARRA funds would add about 20 kilobytes</span> <span data-start="1901.58" data-end="1904.009">to our HTML which honestly is kind of a</span> <span data-start="1904.009" data-end="1905.96">lot yeah that's why I took a look inside</span> <span data-start="1905.96" data-end="1907.61">these font files and I found some</span> <span data-start="1907.61" data-end="1908.98">interesting stuff</span> <span data-start="1908.98" data-end="1912.44">3/4 an upside-down question mark and</span> <span data-start="1912.44" data-end="1916.61">indecisive vowel the surprised face no</span> <span data-start="1916.61" data-end="1918.799">one knows what this is that's an asset</span> <span data-start="1918.799" data-end="1921.47">so what sorry it's an s10 no one knows</span> <span data-start="1921.47" data-end="1924.59">what this is fine if you want a P and a</span> </p>
<p><span data-start="1924.59" data-end="1926.779">B at the same time Scott you saw it and</span> <span data-start="1926.779" data-end="1929.6">this which it kinda looks like a rotated</span> <span data-start="1929.6" data-end="1931.22">elephants I think that's what that is</span> <span data-start="1931.22" data-end="1933.71">for the point is that none of these</span> <span data-start="1933.71" data-end="1936.2">characters are in this set which is the</span> <span data-start="1936.2" data-end="1937.61">set of characters that we are actually</span> <span data-start="1937.61" data-end="1941.75">using on our landing page so we figured</span> <span data-start="1941.75" data-end="1944.21">we just inline the characters that we</span> <span data-start="1944.21" data-end="1946.789">actually need which are these characters</span> <span data-start="1946.789" data-end="1947.899">and that's you know it's kind of like</span> <span data-start="1947.899" data-end="1949.909">tree shaking but for phones and for</span> <span data-start="1949.909" data-end="1952.549">funds its called sub settings and there</span> <span data-start="1952.549" data-end="1954.169">are command line tools that do this for</span> <span data-start="1954.169" data-end="1955.669">you but they're written in Python and I</span> <span data-start="1955.669" data-end="1961.25">kind of loathe Python and so — so</span> <span data-start="1961.25" data-end="1962.72">there's a little feature about about</span> <span data-start="1962.72" data-end="1966.5">google fonts the URL for the CSS of your</span> <span data-start="1966.5" data-end="1968.929">font actually takes a parameter which</span> <span data-start="1968.929" data-end="1970.82">looks like this but it was the first</span> <span data-start="1970.82" data-end="1972.12">language I learned I know</span> <span data-start="1972.12" data-end="1975.87">move on here so if you include this text</span> <span data-start="1975.87" data-end="1978.09">parameter the CSS will contain a URL to</span> <span data-start="1978.09" data-end="1980.279">a new font file which is specifically</span> <span data-start="1980.279" data-end="1982.08">generated to just contain the characters</span> <span data-start="1982.08" data-end="1984">that you are using in this text</span> <span data-start="1984" data-end="1987.029">parameter yeah I still have — anyway so</span> <span data-start="1987.029" data-end="1988.83">we used build script to go into these</span> <span data-start="1988.83" data-end="1990.299">files we generated and open them and</span> <span data-start="1990.299" data-end="1992.22">spit them into our template as base64</span> </p>
<p><span data-start="1992.22" data-end="1994.83">URLs and this only added 4.5 k to the</span> <span data-start="1994.83" data-end="1997.35">HTML which is much better than the 20k</span> <span data-start="1997.35" data-end="1999.63">for the full fonts we do still load the</span> <span data-start="1999.63" data-end="2001.159">full fonts because the future screens</span> <span data-start="2001.159" data-end="2002.51">will have more than just that initial</span> <span data-start="2002.51" data-end="2004.789">set of characters but you know they're</span> <span data-start="2004.789" data-end="2006.86">an interactive 40 away so we can wait</span> <span data-start="2006.86" data-end="2008.24">for like you know you load those lazily</span> <span data-start="2008.24" data-end="2010.429">in the background so how do we do this</span> <span data-start="2010.429" data-end="2013.669">well back to our create HTML plugin or</span> <span data-start="2013.669" data-end="2016.61">at least the part that feeds data into</span> <span data-start="2016.61" data-end="2018.59">our templating engine for each font</span> <span data-start="2018.59" data-end="2020.84">we're passing in the weight and the URL</span> <span data-start="2020.84" data-end="2022.97">but you're also going to pass in the</span> <span data-start="2022.97" data-end="2026">inline fund as a base64 encoded string</span> <span data-start="2026" data-end="2027.289">yeah and this is just using built-in</span> <span data-start="2027.289" data-end="2029.659">node API is nothing special but we're</span> <span data-start="2029.659" data-end="2031.549">also going to pass in the Unicode range</span> <span data-start="2031.549" data-end="2033.049">for each font now if you've used web</span> <span data-start="2033.049" data-end="2034.399">fonts before you'll have seen that you</span> <span data-start="2034.399" data-end="2035.99">need to specify the Unicode range to</span> <span data-start="2035.99" data-end="2037.85">tell the browser exactly what's inside</span> <span data-start="2037.85" data-end="2039.529">the font there we use this little</span> <span data-start="2039.529" data-end="2041.809">library from NPM which just takes a lot</span> <span data-start="2041.809" data-end="2043.82">of characters and will give you a valid</span> </p>
<p><span data-start="2043.82" data-end="2046.34">CSS unicode range for all of those so</span> <span data-start="2046.34" data-end="2047.659">now we're passing everything into the</span> <span data-start="2047.659" data-end="2049.97">template that we need to in the font but</span> <span data-start="2049.97" data-end="2053.69">what about our JavaScript yeah so here's</span> <span data-start="2053.69" data-end="2055.28">where we're getting the file name you</span> <span data-start="2055.28" data-end="2056.45">know that we're passing into the</span> <span data-start="2056.45" data-end="2059.24">template but roll up instead could just</span> <span data-start="2059.24" data-end="2062.839">give us the entire code job done we're</span> <span data-start="2062.839" data-end="2063.95">also passing in the file names for all</span> <span data-start="2063.95" data-end="2065.089">the dependencies as we talked about</span> <span data-start="2065.089" data-end="2067.399">earlier so instead we'll map over those</span> <span data-start="2067.399" data-end="2070.58">and return the code for those instead so</span> <span data-start="2070.58" data-end="2072.08">we had to change the HTML template as a</span> <span data-start="2072.08" data-end="2073.669">result to handle that but again this is</span> <span data-start="2073.669" data-end="2075.53">using our skills in HTML nothing plug-in</span> <span data-start="2075.53" data-end="2077.27">specific so here's where we're doing the</span> <span data-start="2077.27" data-end="2079.04">inline font there as part of the base64</span> </p>
<p><span data-start="2079.04" data-end="2081.649">URL we can add the Unicode range there</span> <span data-start="2081.649" data-end="2084.649">and there is the the inline script so</span> <span data-start="2084.649" data-end="2086.96">we're done in theory but how does this</span> <span data-start="2086.96" data-end="2090.02">impact our real-world performance we've</span> <span data-start="2090.02" data-end="2091.73">already improved things a lot but with</span> <span data-start="2091.73" data-end="2094.22">inlining we've reduced our interactive</span> <span data-start="2094.22" data-end="2096.649">time by half a second on 3G and by about</span> <span data-start="2096.649" data-end="2099.92">a second on 2g but we're not done yet</span> <span data-start="2099.92" data-end="2102.44">now this javascript is inlined as well</span> <span data-start="2102.44" data-end="2103.58">we've reached the point where the only</span> <span data-start="2103.58" data-end="2105.51">thing that matters for first interactive</span> <span data-start="2105.51" data-end="2107.1">everything that's inside of the HTML</span> <span data-start="2107.1" data-end="2109.56">file like we've come a long way so even</span> <span data-start="2109.56" data-end="2111.09">over 2g we're now interactive and just</span> <span data-start="2111.09" data-end="2113.91">under six seconds not too bad but we can</span> <span data-start="2113.91" data-end="2114.24">do better</span> <span data-start="2114.24" data-end="2116.64">yeah like looking at our HTML file or</span> <span data-start="2116.64" data-end="2121.26">index.html file it's 43 kilobytes and 32</span> <span data-start="2121.26" data-end="2123.36">kilobytes of that our JavaScript and</span> <span data-start="2123.36" data-end="2127.53">that is the code for everything it's all</span> <span data-start="2127.53" data-end="2129.6">the fancy animations it's our rendering</span> <span data-start="2129.6" data-end="2131.7">engines the WebGL bits it's the end</span> <span data-start="2131.7" data-end="2133.74">screen and the user duty doesn't need</span> <span data-start="2133.74" data-end="2136.14">the end screen at the start of the game</span> <span data-start="2136.14" data-end="2138.21">yeah what we've done here is we've we've</span> <span data-start="2138.21" data-end="2140.43">done a Photoshop right sure you've</span> <span data-start="2140.43" data-end="2141.51">experienced this before where you're</span> <span data-start="2141.51" data-end="2143.52">staring at this screen while it loads</span> <span data-start="2143.52" data-end="2145.53">like a hundred plugins even though like</span> <span data-start="2145.53" data-end="2147.12">the first interaction all you can really</span> <span data-start="2147.12" data-end="2150.45">do when it when it starts up is create a</span> <span data-start="2150.45" data-end="2152.73">new image or load an existing image you</span> <span data-start="2152.73" data-end="2154.47">don't need all of those plugins until</span> <span data-start="2154.47" data-end="2156.78">sometime later on yeah my my my favorite</span> <span data-start="2156.78" data-end="2159.3">plugin is halida bottlenecks like series</span> <span data-start="2159.3" data-end="2160.68">when you first showed me this I thought</span> <span data-start="2160.68" data-end="2162.09">like well ironically I thought you'd</span> </p>
<p><span data-start="2162.09" data-end="2163.68">Photoshop just a silly name in there</span> <span data-start="2163.68" data-end="2165.15">like a poem oh I wasn't getting but this</span> <span data-start="2165.15" data-end="2167.34">is a real it's a real pile of this it</span> <span data-start="2167.34" data-end="2168.93">sounds like a Swedish folk singer like</span> <span data-start="2168.93" data-end="2172.14">highlight the bottlenecks yeah so let's</span> <span data-start="2172.14" data-end="2174.57">not load everything before the user can</span> <span data-start="2174.57" data-end="2177.57">do anything let's prioritize the code to</span> <span data-start="2177.57" data-end="2180.6">do this the first interaction is</span> <span data-start="2180.6" data-end="2182.73">basically the user picking what kind of</span> <span data-start="2182.73" data-end="2185.13">game they want to play and the only</span> <span data-start="2185.13" data-end="2187.32">thing we to react to is the user hitting</span> <span data-start="2187.32" data-end="2189.42">the start button and if for some reason</span> <span data-start="2189.42" data-end="2191.07">the user manages to press the start</span> <span data-start="2191.07" data-end="2193.2">button before our game logic has loaded</span> <span data-start="2193.2" data-end="2195.06">that's when we can spin up a loading</span> <span data-start="2195.06" data-end="2198.21">screen everything else can really just</span> </p>
<p><span data-start="2198.21" data-end="2199.62">Louis liking later it won't really</span> <span data-start="2199.62" data-end="2202.35">matter yes so this is where we need to</span> <span data-start="2202.35" data-end="2203.94">code split at this point because this is</span> <span data-start="2203.94" data-end="2205.47">our first interactive bit we don't have</span> <span data-start="2205.47" data-end="2207.27">the fancy animated background or the</span> <span data-start="2207.27" data-end="2208.8">logo that you know that stuff is</span> <span data-start="2208.8" data-end="2211.35">non-essential really Co splitting in</span> <span data-start="2211.35" data-end="2212.91">roll up works much the same as it does</span> <span data-start="2212.91" data-end="2215.66">in WebKit and web pack and parcel</span> <span data-start="2215.66" data-end="2217.59">imports like this this will cause</span> <span data-start="2217.59" data-end="2220.17">whatever dot J's to be bundled into the</span> <span data-start="2220.17" data-end="2222.69">same file if you want to be code split</span> <span data-start="2222.69" data-end="2226.08">instead you'll use a dynamic import and</span> <span data-start="2226.08" data-end="2228.09">this will return a promise so if you</span> <span data-start="2228.09" data-end="2229.47">want to use that module sometimes later</span> <span data-start="2229.47" data-end="2232.35">you will have to await it just in the</span> <span data-start="2232.35" data-end="2233.04">usual way</span> <span data-start="2233.04" data-end="2234.72">so the difference now is that whatever</span> <span data-start="2234.72" data-end="2236.52">dot J's is not going to be bundled in it</span> <span data-start="2236.52" data-end="2238.69">is going to be put into another chunk</span> <span data-start="2238.69" data-end="2241.089">and that makes it a sink which can bring</span> <span data-start="2241.089" data-end="2243.01">its own problems for example most of the</span> </p>
<p><span data-start="2243.01" data-end="2244.66">UI framework we are using nowadays</span> <span data-start="2244.66" data-end="2247.03">expect rendering to be synchronous and</span> <span data-start="2247.03" data-end="2249.79">can't really handle promises so react</span> <span data-start="2249.79" data-end="2251.859">suspense is aiming to change that by</span> <span data-start="2251.859" data-end="2254.079">allowing you to lazy load components but</span> <span data-start="2254.079" data-end="2256.69">pre-act doesn't have suspense so of</span> <span data-start="2256.69" data-end="2259.92">course we wrote it ourselves in 20 lines</span> <span data-start="2259.92" data-end="2262.78">seems like it obviously it can all half</span> <span data-start="2262.78" data-end="2265.15">of the things of that react suspense can</span> <span data-start="2265.15" data-end="2266.98">do but it can do everything that we need</span> <span data-start="2266.98" data-end="2269.47">it that we needed to do so really well</span> <span data-start="2269.47" data-end="2270.94">does if you give it a promise of a</span> <span data-start="2270.94" data-end="2272.89">component it wrapped it and returns you</span> <span data-start="2272.89" data-end="2275.349">a real component synchronously and you</span> <span data-start="2275.349" data-end="2277.359">can use that component as a placeholder</span> <span data-start="2277.359" data-end="2279.579">with two parameter spacing it will take</span> <span data-start="2279.579" data-end="2281.98">a loading function which will read</span> <span data-start="2281.98" data-end="2283.54">people used for rendering a placeholder</span> <span data-start="2283.54" data-end="2286.06">until the underlying component is ready</span> <span data-start="2286.06" data-end="2287.71">and at that point just switches over and</span> <span data-start="2287.71" data-end="2290.079">uses the other function like for aura</span> <span data-start="2290.079" data-end="2293.17">nebula yes so with that we moved all of</span> <span data-start="2293.17" data-end="2295.15">our components to a lazy model except</span> <span data-start="2295.15" data-end="2296.23">the ones that we needed for the first</span> <span data-start="2296.23" data-end="2299.109">render and this cut off over 20k</span> <span data-start="2299.109" data-end="2301.21">of the HTML that the JavaScript is now</span> <span data-start="2301.21" data-end="2303.94">down to just 11 K now I mean honestly I</span> <span data-start="2303.94" data-end="2305.8">think 11 K is a lot of JavaScript for</span> <span data-start="2305.8" data-end="2307.569">but is basically just a simple form on a</span> <span data-start="2307.569" data-end="2309.79">button but you know it's it's done its</span> <span data-start="2309.79" data-end="2311.5">job it's given us like that really quick</span> <span data-start="2311.5" data-end="2315.16">first bits of interactivity but you know</span> <span data-start="2315.16" data-end="2316.42">you're going to develop this app you're</span> <span data-start="2316.42" data-end="2318.369">gonna add stuff fix bugs how do we stop</span> <span data-start="2318.369" data-end="2320.38">this creeping up over time and this</span> <span data-start="2320.38" data-end="2321.55">turned out to be quite hard quite</span> <span data-start="2321.55" data-end="2323.53">interesting so you know you're sitting</span> <span data-start="2323.53" data-end="2324.94">there you write a new comp or you want</span> <span data-start="2324.94" data-end="2326.92">to add a new feature to the app and you</span> <span data-start="2326.92" data-end="2328.15">do everything right you think about</span> <span data-start="2328.15" data-end="2329.56">performance you think about file size</span> <span data-start="2329.56" data-end="2331.96">and it's Friday afternoon and none of</span> <span data-start="2331.96" data-end="2334.119">your colleagues are looking and then and</span> <span data-start="2334.119" data-end="2336.16">you have a weak moment and then you do</span> <span data-start="2336.16" data-end="2339.01">it you use vias code autocomplete and</span> <span data-start="2339.01" data-end="2341.53">bam suddenly you have a static import it</span> <span data-start="2341.53" data-end="2344.17">pulls in 200k of more code and that that</span> <span data-start="2344.17" data-end="2346.21">exactly is how Microsoft minesweeper</span> <span data-start="2346.21" data-end="2347.9">happens</span> <span data-start="2347.9" data-end="2351.109">yeah so we tried to know about how ways</span> <span data-start="2351.109" data-end="2352.7">ways we could fix this we tried the</span> <span data-start="2352.7" data-end="2354.079">comment system where we just put a</span> <span data-start="2354.079" data-end="2357.349">warning in files that we should encode -</span> <span data-start="2357.349" data-end="2358.13">yeah</span> <span data-start="2358.13" data-end="2360.859">bulletproof isn't it it did help a</span> <span data-start="2360.859" data-end="2363.529">little bit it was acted as a reminder it</span> <span data-start="2363.529" data-end="2364.999">was something we'd look at and in diffs</span> <span data-start="2364.999" data-end="2366.68">but yes we know it wasn't the best</span> <span data-start="2366.68" data-end="2369.529">solution your tools not rules so we felt</span> <span data-start="2369.529" data-end="2371.809">a little thing this hooks up to Travis</span> </p>
<p><span data-start="2371.809" data-end="2373.789">CI and so on each build it will go and</span> <span data-start="2373.789" data-end="2374.839">look at everything in the dist folder</span> <span data-start="2374.839" data-end="2376.609">and it will record the sizes of it and</span> <span data-start="2376.609" data-end="2378.41">that means when you create a PR it will</span> <span data-start="2378.41" data-end="2380.839">compare that against master so it'll</span> <span data-start="2380.839" data-end="2382.579">give us the Delta for all of the files</span> <span data-start="2382.579" data-end="2384.41">and so that means for every PR we just</span> <span data-start="2384.41" data-end="2386.329">go into this we have a look and you know</span> <span data-start="2386.329" data-end="2388.13">we'll be able to see if that index.html</span> <span data-start="2388.13" data-end="2390.289">file it's ballooning in a way that we</span> <span data-start="2390.289" data-end="2392.359">didn't expect this this works for all</span> <span data-start="2392.359" data-end="2394.309">projects that use Travis so you know</span> <span data-start="2394.309" data-end="2396.41">feel free to give it a go so what do we</span> <span data-start="2396.41" data-end="2398.15">win what do we gain since this is our</span> <span data-start="2398.15" data-end="2400.249">last optimization let's rewind all the</span> <span data-start="2400.249" data-end="2401.839">way back to the start to see where we</span> <span data-start="2401.839" data-end="2404.029">started yeah we started at like five</span> <span data-start="2404.029" data-end="2406.789">seconds until ready on 3G and 11 seconds</span> <span data-start="2406.789" data-end="2409.099">already on 2g we moved upon since we're</span> <span data-start="2409.099" data-end="2410.66">on server we pre-loaded the fonts and</span> <span data-start="2410.66" data-end="2411.92">the scripts and that improved the time</span> <span data-start="2411.92" data-end="2414.529">to interactive we added aesthetic render</span> <span data-start="2414.529" data-end="2415.91">improving perceived loading performance</span> <span data-start="2415.91" data-end="2418.73">and getting pixels on the screen earlier</span> <span data-start="2418.73" data-end="2420.89">and then we aligned our scripts and</span> <span data-start="2420.89" data-end="2422.299">subsided the fonts bringing down the</span> <span data-start="2422.299" data-end="2424.16">time to interactive again and then we</span> <span data-start="2424.16" data-end="2426.17">split the code we focus on the code that</span> <span data-start="2426.17" data-end="2428.809">we needed for interactivity and split</span> <span data-start="2428.809" data-end="2430.999">off everything else and that slashed the</span> <span data-start="2430.999" data-end="2433.519">time to interactive by over a second on</span> <span data-start="2433.519" data-end="2436.7">3G and by two seconds on 2g yeah so from</span> <span data-start="2436.7" data-end="2438.799">the stying point we've like half the</span> <span data-start="2438.799" data-end="2440.509">time to interactive and so let's</span> <span data-start="2440.509" data-end="2442.19">actually feel what that difference is</span> <span data-start="2442.19" data-end="2443.809">so here on the left is the original</span> <span data-start="2443.809" data-end="2445.73">alpha version and on the right is the</span> <span data-start="2445.73" data-end="2448.039">latest version this is loading over a 2g</span> <span data-start="2448.039" data-end="2449.66">connection so it's all got a bit of a</span> <span data-start="2449.66" data-end="2450.89">delay at the start because I think</span> <span data-start="2450.89" data-end="2452.39">setting up connections but then our</span> <span data-start="2452.39" data-end="2453.589">optimized version there it is and now</span> <span data-start="2453.589" data-end="2455.359">it's interactive the user can use it the</span> <span data-start="2455.359" data-end="2457.16">old version it gets there but come on</span> <span data-start="2457.16" data-end="2458.72">it's like still not interactive because</span> <span data-start="2458.72" data-end="2460.579">of the fonts and finally it's like so</span> <span data-start="2460.579" data-end="2463.67">much later remember when you are at a</span> <span data-start="2463.67" data-end="2466.97">festival or on a train on conference</span> <span data-start="2466.97" data-end="2469.67">like here or you just on vacation and</span> <span data-start="2469.67" data-end="2471.739">using roaming you will be experiencing</span> <span data-start="2471.739" data-end="2473.45">speech like speeds that closer than 3G</span> <span data-start="2473.45" data-end="2477.2">or even 2g sometimes yeah I also once</span> <span data-start="2477.2" data-end="2478.4">they're playing the game we install the</span> <span data-start="2478.4" data-end="2479.779">serviceworker because you know I'm not</span> <span data-start="2479.779" data-end="2480.859">allowed to ship anything that doesn't</span> <span data-start="2480.859" data-end="2481.91">have a</span> <span data-start="2481.91" data-end="2483.65">and that means like it's going to work</span> <span data-start="2483.65" data-end="2485.33">offline first but you know as a side</span> <span data-start="2485.33" data-end="2487.609">effect it means it cuts down the timing</span> <span data-start="2487.609" data-end="2489.53">to like well pretty much instantly just</span> <span data-start="2489.53" data-end="2491.42">a second for all caches to split so you</span> <span data-start="2491.42" data-end="2492.92">might be wondering where did we end up</span> <span data-start="2492.92" data-end="2494.66">with our plugin counter well to be</span> <span data-start="2494.66" data-end="2496.19">honest ii wrote way more plugins than we</span> <span data-start="2496.19" data-end="2500.359">talked about in this talk so this is</span> <span data-start="2500.359" data-end="2502.849">what our roller plugin looked like in</span> <span data-start="2502.849" data-end="2504.5">the end it's probably easier to me to</span> <span data-start="2504.5" data-end="2506.3">highlight the plugins that we did not</span> <span data-start="2506.3" data-end="2509.54">write which is these and so in total</span> <span data-start="2509.54" data-end="2516.53">that brings us to 16 plugins it's not a</span> <span data-start="2516.53" data-end="2518.54">bad thing I don't know I'm not so sure</span> </p>
<p><span data-start="2518.54" data-end="2520.67">I prefer wrangling code than I do</span> <span data-start="2520.67" data-end="2522.23">wrangling come to give someone else's</span> <span data-start="2522.23" data-end="2523.67">code I think it's really empowering to</span> <span data-start="2523.67" data-end="2525.5">be able to go in and just fix stuff</span> <span data-start="2525.5" data-end="2527.42">without spending days learning a new DSL</span> <span data-start="2527.42" data-end="2530.27">or something like that we're not asking</span> <span data-start="2530.27" data-end="2531.95">you to use our plugins absolutely not</span> <span data-start="2531.95" data-end="2533.17">because they're kind of dependent</span> <span data-start="2533.17" data-end="2535.73">interdependent and unique to procs but</span> <span data-start="2535.73" data-end="2537.59">we're saying like write your own cuz it</span> <span data-start="2537.59" data-end="2539.119">probably be quicker than using someone</span> <span data-start="2539.119" data-end="2540.859">else's plugin for especially for a lot</span> <span data-start="2540.859" data-end="2542.69">of fairly trivial stuff and if your</span> <span data-start="2542.69" data-end="2544.369">current build system is in the way of</span> <span data-start="2544.369" data-end="2545.3">shipping features that improve</span> <span data-start="2545.3" data-end="2547.58">performance for your users get a better</span> <span data-start="2547.58" data-end="2555.41">built system by right</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
