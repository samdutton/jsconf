<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>h_M_uscOKJM</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/h_M_uscOKJM?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="14.88" data-end="15.88">That was a very kind introduction.</span> <span data-start="15.88" data-end="16.88">Thank you very much.</span> <span data-start="16.88" data-end="17.88">So how is everyone doing at JSConf?</span> <span data-start="17.88" data-end="18.88">I heard I have no competition at the beach.</span> <span data-start="18.88" data-end="19.88">Everyone is here.</span> <span data-start="19.88" data-end="20.88">Full house.</span> <span data-start="20.88" data-end="21.88">Thank you for coming by.</span> <span data-start="21.88" data-end="22.88">So yeah.</span> <span data-start="22.88" data-end="23.88">Like I said, I want to talk to you about concurrency and</span> <span data-start="23.88" data-end="24.88">parallelism in JavaScript.</span> <span data-start="24.88" data-end="25.88">Maybe a brief introduction is warranted.</span> <span data-start="25.88" data-end="26.88">I do lead the JS team, and for the last several years, we've been thinking about</span> <span data-start="26.88" data-end="30.59">this, these problems in JavaScript, and how we can address that.</span> <span data-start="30.59" data-end="35.18">I would like to share some of the ways we've come around to improving concurrency</span> <span data-start="35.18" data-end="36.29">and parallelism in JS.</span> </p>
<p><span data-start="36.29" data-end="37.29">But before we..</span> <span data-start="37.29" data-end="40.27">The string is a little tight.</span> <span data-start="40.27" data-end="44.89">Before we go down that road, let's actually talk about some definitions.</span> <span data-start="44.89" data-end="49.36">Concurrency and parallelism often come up together but they're not the same thing.</span> <span data-start="49.36" data-end="52.16">The way I think about it is..</span> <span data-start="52.16" data-end="55.19">Concurrency is how do you make an application more usable?</span> </p>
<p><span data-start="55.19" data-end="59.4">And here we have two queues of people and a single revolving</span> <span data-start="59.4" data-end="60.62">door.</span> <span data-start="60.62" data-end="65.239">You can come up with some logic to have them take turns going through</span> <span data-start="65.239" data-end="67.009">there, but it doesn't matter what you do.</span> <span data-start="67.009" data-end="70.69">You have one whole queue go through first or have them take turns</span> <span data-start="70.69" data-end="76.6">like that  —  some sort of multitasking to utilize the resource and make sure</span> <span data-start="76.6" data-end="77.6">everything happens.</span> <span data-start="77.6" data-end="81.299">And examples inside the running the program or</span> <span data-start="81.299" data-end="87.74">application might be pre-emptive multitasking, Windows 95, or async</span> <span data-start="87.74" data-end="90.799">programming that we're very familiar with.</span> </p>
<p><span data-start="90.799" data-end="97.1">Parallelism is all about how you can be faster by leveraging or exploiting</span> <span data-start="97.1" data-end="98.939">hardware availability.</span> <span data-start="98.939" data-end="102.51">So in this case, we now have two revolving doors,</span> <span data-start="102.51" data-end="106.179">and we can theoretically hopefully go twice as fast, because there's</span> <span data-start="106.179" data-end="108.84">no contention and complex in my examples.</span> <span data-start="108.84" data-end="110.78">But the real world is not like that.</span> <span data-start="110.78" data-end="113.679">The real world has complexity, and the reason why concurrency</span> <span data-start="113.679" data-end="119.009">and parallelism are often mixed together is because in the real world, it's</span> <span data-start="119.009" data-end="122.85">really hard to separate the different aspects.</span> <span data-start="122.85" data-end="125.409">And you have to be very sensitive to the way you take care of your</span> <span data-start="125.409" data-end="128.929">application to avoid deadlocks and races.</span> <span data-start="128.929" data-end="133.87">So now that we talked about those definitions, I want to explain why improving</span> <span data-start="133.87" data-end="135.48">this is actually important in JavaScript.</span> </p>
<p><span data-start="135.48" data-end="138.9">And to do that, let's talk about the evolution of the web</span> <span data-start="138.9" data-end="139.9">application.</span> <span data-start="139.9" data-end="144.78">Back in the day, not quite the '80s, but way, way back, we all</span> <span data-start="144.78" data-end="147.15">had a homepage that looked something like this.</span> </p>
<p><span data-start="147.15" data-end="148.15">I'm sorry.</span> <span data-start="148.15" data-end="150.44">Mine is under construction at the moment, but maybe it will</span> <span data-start="150.44" data-end="152.5">evolve a little.</span> <span data-start="152.5" data-end="156.06">Static html and GIFs can only take us so far.</span> <span data-start="156.06" data-end="158.25">In 1995, though, something really big happened.</span> <span data-start="158.25" data-end="161.83">I think most of us know what this is?</span> <span data-start="161.83" data-end="164.73">Any guesses?</span> <span data-start="164.73" data-end="166.21">I think I heard it.</span> <span data-start="166.21" data-end="167.21">Yes.</span> <span data-start="167.21" data-end="169.27">JavaScript was invented, and it was good.</span> <span data-start="169.27" data-end="170.4">The universe of..</span> <span data-start="170.4" data-end="174.25">I think I came to the right venue to make that</span> <span data-start="174.25" data-end="175.42">comment.</span> </p>
<p><span data-start="175.42" data-end="179.64">The universe of the modern interactive web was really born.</span> <span data-start="179.64" data-end="184.45">And homepages were never the same again.</span> <span data-start="184.45" data-end="188.9">So in the next 20 years, I think the home pages and websites</span> <span data-start="188.9" data-end="191.85">have evolved past Windows alert.</span> <span data-start="191.85" data-end="197.12">And now you have desktop applications that have actually gone non-native.</span> <span data-start="197.12" data-end="202.49">Here we have an example of Excel, and most of the Microsoft Office suite is now available</span> <span data-start="202.49" data-end="205.04">as a web application.</span> <span data-start="205.04" data-end="209.26">JavaScript and the web platform is actually capable of supporting even</span> <span data-start="209.26" data-end="210.92">virtual reality technology.</span> </p>
<p><span data-start="210.92" data-end="214.12">Here we have a frame or a couple of frames from</span> <span data-start="214.12" data-end="220.62">the Polar Sea Project that MozVR is working on.</span> <span data-start="220.62" data-end="225.69">So today's JavaScript is really vast.</span> <span data-start="225.69" data-end="229.19">We track most of the modern browsers, their performance, and how</span> <span data-start="229.19" data-end="230.41">they're doing over time.</span> <span data-start="230.41" data-end="234.02">And here you can see that we're all getting a lot</span> <span data-start="234.02" data-end="237.43">faster.</span> <span data-start="237.43" data-end="240.061">And that's continued to be true for other factors as well, because</span> <span data-start="240.061" data-end="244.19">we're inventing other technologies, like (inaudible), that allow us</span> <span data-start="244.19" data-end="248.5">to bypass some of the inherent bottle necks in regular JavaScript.</span> <span data-start="248.5" data-end="251.65">In this slide..</span> <span data-start="251.65" data-end="254.04">The bottom line is native.</span> </p>
<p><span data-start="254.04" data-end="256.07">C++ compiled code.</span> <span data-start="256.07" data-end="260.13">And JS running on Firefox is only 2X of that.</span> <span data-start="260.13" data-end="262.039">We have techniques in certain workloads that can</span> <span data-start="262.039" data-end="264.58">get much closer to native.</span> <span data-start="264.58" data-end="265.94">1.5X.</span> <span data-start="265.94" data-end="269.66">So if JavaScript is so fast, why do we have a problem?</span> <span data-start="269.66" data-end="276.75">Well, to illustrate that, I have a snapshot here of my Windows desktop.</span> <span data-start="276.75" data-end="282.25">Right now you can see that the desktop doesn't seem to be doing a whole</span> <span data-start="282.25" data-end="283.25">lot.</span> <span data-start="283.25" data-end="287.44">We're running at 5% CPU utilization, and I have a ton of applications</span> <span data-start="287.44" data-end="292.44">open, including Firefox with, I believe, at the moment, 30 tabs.</span> <span data-start="292.44" data-end="295.68">So I open one more tab with a really intensive JavaScript</span> <span data-start="295.68" data-end="297.18">application.</span> <span data-start="297.18" data-end="303.69">And you'll see that the PerfMon seems to be indicating something.</span> <span data-start="303.69" data-end="306.9">Those of you who are not familiar with Windows and PerfMon, each of</span> <span data-start="306.9" data-end="314.09">these squares represents a CPU core and how much work it's doing.</span> </p>
<p><span data-start="314.09" data-end="319.919">In this illustration, cores three and four  —  they're virtual cores, but we'll</span> <span data-start="319.919" data-end="324.78">not worry about that detail  —  cores three and four are doing a lot of work,</span> <span data-start="324.78" data-end="328.78">but the rest of the CPU is mostly just sitting there, and overall utilization</span> <span data-start="328.78" data-end="332">is at 24%.</span> <span data-start="332" data-end="333">Out of a possible 100.</span> <span data-start="333" data-end="334">Right?</span> <span data-start="334" data-end="337.59">So the computer is still 75% idle.</span> </p>
<p><span data-start="337.59" data-end="339.13">Why does this matter?</span> <span data-start="339.13" data-end="343.27">Well, the gigahertz race is effectively at an end.</span> <span data-start="343.27" data-end="346.49">It's hard to make CPUs faster than they are now.</span> <span data-start="346.49" data-end="350.33">Power and heat have stopped our ability to innovate there.</span> <span data-start="350.33" data-end="353.74">So for future hardware, the way we're scaling is</span> <span data-start="353.74" data-end="357.389">by adding additional cores or execution units.</span> <span data-start="357.389" data-end="360.419">Your modern smartphone typically has two cores.</span> <span data-start="360.419" data-end="364.04">Some of them are even quad-core enabled.</span> <span data-start="364.04" data-end="369.919">Laptops and desktops have four to eight virtual course and workstations can have 4 to 20 cores</span> <span data-start="369.919" data-end="374.66">per CPU, and they may have multiple CPUs on their motherboards.</span> <span data-start="374.66" data-end="379.59">So right here I've only talked about the parallelism aspect, how to do work at the</span> <span data-start="379.59" data-end="381.02">same time.</span> <span data-start="381.02" data-end="383.49">But concurrency has its issues too.</span> <span data-start="383.49" data-end="387.139">We're always waiting on something in a JavaScript application.</span> <span data-start="387.139" data-end="391.35">Waiting on events, on the user, on the cache, and of course</span> <span data-start="391.35" data-end="395.11">always waiting on the internet to do something.</span> </p>
<p><span data-start="395.11" data-end="400.66">So improving parallelism and improving concurrency can really make a big</span> <span data-start="400.66" data-end="403.17">difference to a host of applications.</span> <span data-start="403.17" data-end="408.73">Some of the application types are of course games, AI, rendering, code generation,</span> <span data-start="408.73" data-end="413.199">and each of these specific application types have their own domain-specific</span> <span data-start="413.199" data-end="416.29">way of dealing with these constructs.</span> </p>
<p><span data-start="416.29" data-end="419.35">But something that  —  if we do solve this problem, we want to</span> <span data-start="419.35" data-end="423.18">preserve it, if possible.</span> <span data-start="423.18" data-end="428.21">While looking at this problem and investigating different ways to deal with it, web workers</span> <span data-start="428.21" data-end="429.21">are around.</span> <span data-start="429.21" data-end="430.53">Web workers do promote parallelism.</span> <span data-start="430.53" data-end="432.28">You can do something on a thread.</span> <span data-start="432.28" data-end="435.11">They tend to be very heavy threads.</span> <span data-start="435.11" data-end="436.229">But it works.</span> </p>
<p><span data-start="436.229" data-end="441.16">The real issue for saturating a core doesn't seem to be spinning up another thread.</span> <span data-start="441.16" data-end="442.92">It's communication between that.</span> <span data-start="442.92" data-end="446.32">And coordination is really about concurrency.</span> <span data-start="446.32" data-end="448.28">But concurrency does exist on the web today.</span> <span data-start="448.28" data-end="451.13">Exists in JavaScript.</span> <span data-start="451.13" data-end="456.01">We've had at this point parallel JavaScript  —  post message</span> <span data-start="456.01" data-end="457.01">will always be around.</span> <span data-start="457.01" data-end="458.389">It's very useful.</span> <span data-start="458.389" data-end="461.95">And then the buffered transfer semantics.</span> </p>
<p><span data-start="461.95" data-end="464.26">So let's dive into each one of these and see where they</span> <span data-start="464.26" data-end="465.8">may have some limitations.</span> <span data-start="465.8" data-end="471.6">Parallel JS, for those who are not familiar with it, it was an experimental</span> <span data-start="471.6" data-end="475.33">effort to see if we can bring some of the semantics of MapReduce to</span> <span data-start="475.33" data-end="481.139">JavaScript, and enable a whole slew of application types.</span> <span data-start="481.139" data-end="483.699">It was a casual API, but it really took some sophistication to</span> <span data-start="483.699" data-end="487.301">use it, so the average programmer couldn't make that much out of it, and it</span> <span data-start="487.301" data-end="490.77">had some really high implementation costs in the engine, so it was hard to support</span> <span data-start="490.77" data-end="493.36">going forward.</span> <span data-start="493.36" data-end="495.65">PostMessage obviously..</span> <span data-start="495.65" data-end="497.05">Around and incredibly useful.</span> </p>
<p><span data-start="497.05" data-end="501.169">But it also has its own set of issues.</span> <span data-start="501.169" data-end="502.389">Dependent on the event loop.</span> <span data-start="502.389" data-end="506.99">The performance, which we'll go into a little bit more later, just isn't there,</span> <span data-start="506.99" data-end="508.39">and you cannot share state.</span> <span data-start="508.39" data-end="510.99">You're transferring state over.</span> <span data-start="510.99" data-end="512.05">Really one at a time.</span> <span data-start="512.05" data-end="515.95">And if you care about the response, you have to transfer a new state back.</span> <span data-start="515.95" data-end="519.63">It's possible with postMessage to transfer a buffer entirely by</span> <span data-start="519.63" data-end="525.009">reference, and that solves some subsets of problems, but you still</span> <span data-start="525.009" data-end="527.65">can't work on the same data at the same time.</span> </p>
<p><span data-start="527.65" data-end="532.19">This really is a bottleneck, a coordination bottleneck, and it's something</span> <span data-start="532.19" data-end="534.72">that we want to address.</span> <span data-start="534.72" data-end="537.149">So while looking at different possible ways of</span> <span data-start="537.149" data-end="541.61">handling this, it sort of became apparent that obviously native has</span> <span data-start="541.61" data-end="543.149">handled this already.</span> <span data-start="543.149" data-end="547.56">The operating system libraries have a slew of constructs</span> <span data-start="547.56" data-end="550.69">that allow us to solve concurrent problems.</span> </p>
<p><span data-start="550.69" data-end="551.69">Solve them well.</span> <span data-start="551.69" data-end="555.85">And solve them in ways that each individual application can tailor for its</span> <span data-start="555.85" data-end="557.19">own needs.</span> <span data-start="557.19" data-end="561.63">So that helped us come up with some design considerations for what our</span> <span data-start="561.63" data-end="563.36">ideal solution may look like.</span> <span data-start="563.36" data-end="565.58">Of course, we want native-like performance.</span> <span data-start="565.58" data-end="567.56">That's the Holy Grail benchmark.</span> <span data-start="567.56" data-end="569.43">Let's be as fast as we can be.</span> <span data-start="569.43" data-end="573.06">We don't want to be dependent on the main event loop, if</span> <span data-start="573.06" data-end="574.39">possible.</span> <span data-start="574.39" data-end="578.66">Because everyone uses the event loop, and that  —  as Simon</span> <span data-start="578.66" data-end="582.31">pointed out, can lead to some jankiness.</span> <span data-start="582.31" data-end="583.63">Implementation versatility.</span> <span data-start="583.63" data-end="585.81">What I mean by that is..</span> <span data-start="585.81" data-end="590.95">Every problem has probably an ideal answer.</span> </p>
<p><span data-start="590.95" data-end="593.49">And so you want to allow the developer to come</span> <span data-start="593.49" data-end="596.76">up with an answer that makes the most sense for them, instead of being</span> <span data-start="596.76" data-end="602.01">constrained by a really high level set of utilities that force them</span> <span data-start="602.01" data-end="606.32">to talk in a particular vocabulary.</span> <span data-start="606.32" data-end="610.76">We want to support  —  this one may seem a little arbitrary, but we'll</span> <span data-start="610.76" data-end="615.36">explain more in the future  —  we want to support the algorithms and</span> <span data-start="615.36" data-end="618.25">applications that are based on threads and pthreads.</span> <span data-start="618.25" data-end="621.74">For a long time, threads have been around, and there's a lot</span> <span data-start="621.74" data-end="624">of good computer science research on them.</span> <span data-start="624" data-end="625.06">How to use them really effectively.</span> <span data-start="625.06" data-end="627.67">And all those algorithms have a lot of value.</span> <span data-start="627.67" data-end="632.899">Not every single application, not every single problem can benefit from those algorithms.</span> <span data-start="632.899" data-end="636.12">But it is possible to directly apply them with minimal changes.</span> </p>
<p><span data-start="636.12" data-end="638.48">It does seem like a win for the user.</span> <span data-start="638.48" data-end="640.72">So it's something that we would like to support.</span> <span data-start="640.72" data-end="645.45">And finally, support the extensible web philosophy.</span> <span data-start="645.45" data-end="649.89">Anyone out there familiar with the extensible web philosophy?</span> <span data-start="649.89" data-end="652.19">Or have read the extensible web manifesto?</span> </p>
<p><span data-start="652.19" data-end="653.56">A couple of people?</span> <span data-start="653.56" data-end="657.2">It's worth explaining a little bit here.</span> <span data-start="657.2" data-end="659.271">I'm sure every single person will have their own take on it,</span> <span data-start="659.271" data-end="664.529">and I certainly invite you to go to the extensible web manifesto website, to</span> <span data-start="664.529" data-end="666.38">read about it in more detail.</span> <span data-start="666.38" data-end="670.649">But at a high level, it's thought that the best</span> <span data-start="670.649" data-end="674.23">innovation is going to come from developers, come from you guys.</span> <span data-start="674.23" data-end="678.65">Sometimes standards bodies and browser developers can</span> <span data-start="678.65" data-end="683.43">spend too much time iterating an idea, trying to come up with something perfect,</span> <span data-start="683.43" data-end="687.75">and by the time it comes out to where the developers can use it, we</span> <span data-start="687.75" data-end="689.399">didn't really hit the mark.</span> <span data-start="689.399" data-end="692.18">So it seems like it's a better model for us to provide</span> <span data-start="692.18" data-end="696.58">low level primitives that you can then generate and iterate on quickly</span> <span data-start="696.58" data-end="701.6">in JS, instead of for us to provide rich high level implementations that</span> <span data-start="701.6" data-end="706.75">are surfaced, and then you don't have a lot of flexibility to tailor</span> <span data-start="706.75" data-end="711.04">that to the way you want to do work.</span> </p>
<p><span data-start="711.04" data-end="715.55">So taking all this together, we came up with shared memory for</span> <span data-start="715.55" data-end="717.17">JavaScript.</span> <span data-start="717.17" data-end="719.88">And it looks something like this.</span> <span data-start="719.88" data-end="723.39">So this font might be a little bit small for some of the people in the back</span> <span data-start="723.39" data-end="724.39">to read.</span> <span data-start="724.39" data-end="727.02">I know you guys in the front can only read the first line.</span> <span data-start="727.02" data-end="732.36">So I would like to thank Lars Hanson for actually putting this document together.</span> <span data-start="732.36" data-end="736.17">Obviously it's incredibly detailed, and there's a link at the end, so</span> <span data-start="736.17" data-end="738.17">you can take a look at it yourself.</span> <span data-start="738.17" data-end="740.95">But I think this might be one of those times where an example</span> <span data-start="740.95" data-end="744.36">might be more beneficial than going through all the pages.</span> <span data-start="744.36" data-end="746.029">So what I would like to do is..</span> <span data-start="746.029" data-end="748.69">Build an example.</span> <span data-start="748.69" data-end="750.709">The incrementing worker.</span> <span data-start="750.709" data-end="753.41">And what I want to do here is implement that same</span> <span data-start="753.41" data-end="755.8">example in a couple of different ways.</span> </p>
<p><span data-start="755.8" data-end="759.04">First with postMessage, and then with using the shared</span> <span data-start="759.04" data-end="763.17">memory techniques that we just came up with, and you can get an idea of what</span> <span data-start="763.17" data-end="767.23">that work flow would look like, and what the trade-offs might be.</span> <span data-start="767.23" data-end="768.74">So..</span> <span data-start="768.74" data-end="770.88">First we're going to do this with postMessage, and what I did</span> <span data-start="770.88" data-end="773.649">here was build a sequence diagram so you can really understand exactly</span> <span data-start="773.649" data-end="776.89">what I'm trying to do.</span> <span data-start="776.89" data-end="777.89">Create a worker.</span> <span data-start="777.89" data-end="782.69">Brief that worker to tell us it's ready, and then we'll start working.</span> <span data-start="782.69" data-end="788.33">And the goal of this incrementing worker  —  really all it's going to do is talk in</span> <span data-start="788.33" data-end="793.37">some kind of mechanism channel back to the master or the thread, passing</span> <span data-start="793.37" data-end="796.55">an integer each time and incrementing it when it gets an integer from</span> <span data-start="796.55" data-end="797.83">the master.</span> </p>
<p><span data-start="797.83" data-end="802.209">They're going to reach some count, in this case I used 100,000,</span> <span data-start="802.209" data-end="808.55">and when that message passing is done, the master will display some results.</span> <span data-start="808.55" data-end="811.23">So the simplest scenario here is..</span> <span data-start="811.23" data-end="813.07">The master says  —  hey, start at zero.</span> <span data-start="813.07" data-end="814.51">Go for 100,000 times.</span> <span data-start="814.51" data-end="817.37">At the end, the worker will  —  and the master will</span> <span data-start="817.37" data-end="819.34">have a variable that says 100,000.</span> <span data-start="819.34" data-end="822.75">Not rocket science, but hopefully enough to illustrate some points.</span> </p>
<p><span data-start="822.75" data-end="826.35">Here's an implementation of the master side.</span> <span data-start="826.35" data-end="831.24">It's code and it's small, and I think it's worth calling out some lines here.</span> <span data-start="831.24" data-end="839.81">So we agree on 100,000 iterations, and the master posts to the worker to</span> <span data-start="839.81" data-end="842.04">start at zero.</span> <span data-start="842.04" data-end="846">The worker and the master will talk inside this callback, and</span> <span data-start="846" data-end="848.08">the worker's date is going to come back as event data.</span> <span data-start="848.08" data-end="851.05">It's going to be unpackaged.</span> <span data-start="851.05" data-end="854.46">When some condition has met the terminal condition, it will</span> <span data-start="854.46" data-end="855.46">end.</span> <span data-start="855.46" data-end="860.13">Otherwise the master will pass the integer right back to the worker.</span> <span data-start="860.13" data-end="862.7">On the worker's side, it's even simpler.</span> <span data-start="862.7" data-end="867.54">The worker  —  all it does is unpack the master's integer, increments it,</span> <span data-start="867.54" data-end="870.61">and sends it right back on its way.</span> </p>
<p><span data-start="870.61" data-end="872.209">So how does that work?</span> <span data-start="872.209" data-end="873.3">How fast does that work?</span> <span data-start="873.3" data-end="877.86">Well, for postMessage in this implementation on this laptop, I get</span> <span data-start="877.86" data-end="880.709">about 54,000 messages per second.</span> <span data-start="880.709" data-end="882.85">I think the example is pretty simple.</span> <span data-start="882.85" data-end="887.779">There's probably a variety of these that you use all the time just for solving</span> <span data-start="887.779" data-end="891.39">message passing techniques between the worker and the master.</span> <span data-start="891.39" data-end="898.49">Let's do that again, using shared memory, specifically using shared Int32 array.</span> <span data-start="898.49" data-end="903.99">So there's going to be some new constructs here, coming out of the shared</span> <span data-start="903.99" data-end="908.07">memory document that I would like to call out.</span> </p>
<p><span data-start="908.07" data-end="910.339">This is actually too small for even me to read.</span> <span data-start="910.339" data-end="911.61">Make that bigger.</span> <span data-start="911.61" data-end="914.72">Going to make sure I'm on the same page with all of you.</span> <span data-start="914.72" data-end="916.39">So the first line I'm highlighting here is shared</span> <span data-start="916.39" data-end="917.39">array buffer.</span> <span data-start="917.39" data-end="924.579">This is one of the core pieces of the concurrency technique that</span> <span data-start="924.579" data-end="925.66">we've come up with.</span> <span data-start="925.66" data-end="930.529">Which allows us to share memory.</span> <span data-start="930.529" data-end="932.05">Basically you specify a side.</span> <span data-start="932.05" data-end="938.24">And here is a syncretic object that's actually layered on top of what actually exists</span> <span data-start="938.24" data-end="939.589">in the spec.</span> </p>
<p><span data-start="939.589" data-end="942.95">But what's in the spec is a little too low level to cleanly</span> <span data-start="942.95" data-end="945.85">show it in a presentation.</span> <span data-start="945.85" data-end="947.6">The purpose of this is basically  —  it's a waitable</span> <span data-start="947.6" data-end="948.6">object.</span> <span data-start="948.6" data-end="954.26">It's going to allow for the master and the worker to coordinate.</span> <span data-start="954.26" data-end="958.62">Using postMessage, the only use of postMessage in this example, we're passing</span> <span data-start="958.62" data-end="962.66">the shared buffer to the worker, but because it's a shared buffer,</span> <span data-start="962.66" data-end="966.34">the master will be able to use it as well.</span> </p>
<p><span data-start="966.34" data-end="969.77">So this is a shared Int32 array.</span> <span data-start="969.77" data-end="973.35">That's a view on the shared buffer.</span> <span data-start="973.35" data-end="976.16">We're basically saying  —  at this address, inside the shared memory</span> <span data-start="976.16" data-end="977.38">region, it's an integer.</span> <span data-start="977.38" data-end="978.66">Treat it like an integer.</span> <span data-start="978.66" data-end="982.019">Give me integer semantics on it.</span> <span data-start="982.019" data-end="986.9">And here, inside the callback, using the syncretic, the master is</span> <span data-start="986.9" data-end="991.22">saying, after incrementing the buffer, the master is saying  —  all right, I'm</span> <span data-start="991.22" data-end="992.22">done.</span> <span data-start="992.22" data-end="993.389">So the worker will wake up.</span> <span data-start="993.389" data-end="998.25">Now, in this example, unlike the example from before, the master is also incrementing</span> <span data-start="998.25" data-end="999.94">the counts.</span> <span data-start="999.94" data-end="1004.18">The only real reason for doing that is  —  this loop, the</span> <span data-start="1004.18" data-end="1007.06">master will do nothing other than saying I'm done, without doing any real work.</span> <span data-start="1007.06" data-end="1010.481">So I wanted him to do something to justify the existence of that loop, other</span> <span data-start="1010.481" data-end="1013.43">than the wall for the worker to continue.</span> </p>
<p><span data-start="1013.43" data-end="1018.11">Otherwise the worker would count to 1,000 instantly and be done</span> <span data-start="1018.11" data-end="1022.269">without the master and the worker going back and forth.</span> <span data-start="1022.269" data-end="1026.089">So here on the worker side we have once again that waitable</span> <span data-start="1026.089" data-end="1034.04">object, the syncretic, and the shared Int32 view on the shared array</span> <span data-start="1034.04" data-end="1035.04">buffer.</span> <span data-start="1035.04" data-end="1041.63">And on the loop side, we wait for the master to be done, increment the buffer,</span> <span data-start="1041.63" data-end="1043.63">and then say we're done.</span> </p>
<p><span data-start="1043.63" data-end="1048.87">So it looks nothing like the postMessage version.</span> <span data-start="1048.87" data-end="1052.42">It's incredibly specific to integer-only.</span> <span data-start="1052.42" data-end="1055.66">PostMessage you can pass in anything.</span> <span data-start="1055.66" data-end="1059.33">But it does function, and it functions incredibly fast.</span> <span data-start="1059.33" data-end="1062.23">Where before we had 54,000 messages per second,</span> <span data-start="1062.23" data-end="1064.46">this time we have 6 million.</span> <span data-start="1064.46" data-end="1066.2">Over 6 million messages per second.</span> <span data-start="1066.2" data-end="1068.42">I think we can all agree that I cheated a little bit.</span> <span data-start="1068.42" data-end="1069.42">Right?</span> <span data-start="1069.42" data-end="1071.5">So unlike the postMessage model, where I can pass</span> <span data-start="1071.5" data-end="1077.57">anything in and do anything I want with it, where it's synchronized for me,</span> <span data-start="1077.57" data-end="1080.89">and where I have constructs where I don't have to worry about locking, all</span> <span data-start="1080.89" data-end="1084.13">that sort of nitty-gritty low level stuff was exposed in the shared</span> <span data-start="1084.13" data-end="1087.13">memory version, so it's not really a drop-in replacement for</span> <span data-start="1087.13" data-end="1088.13">postMessage.</span> </p>
<p><span data-start="1088.13" data-end="1090.26">I think I can do better, and I'm going to try to do better</span> <span data-start="1090.26" data-end="1091.68">in this second version.</span> <span data-start="1091.68" data-end="1094.43">Once again, because performance isn't everything.</span> <span data-start="1094.43" data-end="1098.51">Sometimes ergonomics of the implementation matter.</span> <span data-start="1098.51" data-end="1102.611">So here what I do is  —  and I'm hiding a lot of the details, but what I do</span> <span data-start="1102.611" data-end="1108.22">differently here is I'm creating a new object that wraps a sender and</span> <span data-start="1108.22" data-end="1112.33">receiver, a channel sender and a channel receiver, and all this is built on</span> <span data-start="1112.33" data-end="1115.549">top of the same primitives that you saw before.</span> <span data-start="1115.549" data-end="1118.84">And if we look inside our loop now, it's a lot clearer.</span> </p>
<p><span data-start="1118.84" data-end="1121.05">And it maps much, much more directly, one to</span> <span data-start="1121.05" data-end="1122.669">one, with postMessage.</span> <span data-start="1122.669" data-end="1127.01">We can basically treat the send like the post to the</span> <span data-start="1127.01" data-end="1130.64">worker, and the receive like the post from the worker.</span> </p>
<p><span data-start="1130.64" data-end="1132.169">There's no locks exposed here.</span> <span data-start="1132.169" data-end="1135.481">There's no waitable objects that you can screw up, by</span> <span data-start="1135.481" data-end="1138.79">signaling at the wrong time.</span> <span data-start="1138.79" data-end="1142.36">And the worker side is just as clean, just as</span> <span data-start="1142.36" data-end="1143.36">simple.</span> <span data-start="1143.36" data-end="1144.36">And I think very, very easy to read.</span> <span data-start="1144.36" data-end="1150.89">Arguably even easier to read than the native postMessage implementation.</span> <span data-start="1150.89" data-end="1153.83">With receive, increment, and send.</span> </p>
<p><span data-start="1153.83" data-end="1155.93">So how does this perform?</span> <span data-start="1155.93" data-end="1157.84">Still a lot better than postMessage.</span> <span data-start="1157.84" data-end="1166.49">And it's a huge trade-off for using these high level constructs, versus</span> <span data-start="1166.49" data-end="1168.76">shared Int32 array.</span> <span data-start="1168.76" data-end="1169.76">But the choice is yours.</span> <span data-start="1169.76" data-end="1170.76">Right?</span> <span data-start="1170.76" data-end="1173.03">The choice for having high level constructs or low level</span> <span data-start="1173.03" data-end="1177.25">performance is something that this implementation allows you to have.</span> <span data-start="1177.25" data-end="1180.04">So going back to our design criteria, let's see how we did.</span> <span data-start="1180.04" data-end="1181.89">Did we get native — like performance?</span> <span data-start="1181.89" data-end="1185.38">Well, I didn't directly compare it against native</span> <span data-start="1185.38" data-end="1192.37">C++, but we're 5X faster than postMessage.</span> <span data-start="1192.37" data-end="1193.929">I think we did pretty well there.</span> <span data-start="1193.929" data-end="1196.26">We'll come back to that later.</span> <span data-start="1196.26" data-end="1199.13">How about not dependent on the main thread event loop?</span> </p>
<p><span data-start="1199.13" data-end="1204.83">Aside from the shared array buffer, we're not dependent</span> <span data-start="1204.83" data-end="1208.679">on the event loop at all.</span> <span data-start="1208.679" data-end="1210.2">Versatility, I give myself a check.</span> <span data-start="1210.2" data-end="1212.78">We have two implementations, one really fast and really</span> <span data-start="1212.78" data-end="1217.44">specific and one general purpose that's still reasonably fast.</span> </p>
<p><span data-start="1217.44" data-end="1221.25">Do we support the extensible web philosophy?</span> <span data-start="1221.25" data-end="1224.33">The fact that you can have these multiple implementations</span> <span data-start="1224.33" data-end="1228.32">and our iterations were done in JavaScript instead of rebuilding the browser</span> <span data-start="1228.32" data-end="1231.82">each time, I think I can give myself a check for that as well.</span> </p>
<p><span data-start="1231.82" data-end="1234.59">And the final one is  —  do you support applications and</span> <span data-start="1234.59" data-end="1236.87">algorithms based on threads and pthreads?</span> <span data-start="1236.87" data-end="1239.17">We didn't really talk about that at all here, so I'm going to</span> <span data-start="1239.17" data-end="1242.35">table that again for a little bit later in the discussion.</span> <span data-start="1242.35" data-end="1245.82">So we agree at least on three of five?</span> <span data-start="1245.82" data-end="1248.5">Maybe three and a half of five?</span> <span data-start="1248.5" data-end="1250.36">Anyone?</span> <span data-start="1250.36" data-end="1252.23">Okay.</span> <span data-start="1252.23" data-end="1253.68">Hard graders out there in the audience.</span> </p>
<p><span data-start="1253.68" data-end="1254.68">Okay.</span> <span data-start="1254.68" data-end="1255.68">So..</span> <span data-start="1255.68" data-end="1260.789">I have a couple of demos, and they're live demos.</span> <span data-start="1260.789" data-end="1262.41">So we'll see how that goes.</span> <span data-start="1262.41" data-end="1266.15">This is against a version of Nightly with one private patch</span> <span data-start="1266.15" data-end="1267.15">applied.</span> <span data-start="1267.15" data-end="1272.09">So one of these demos will work as is, in a Nightly version</span> <span data-start="1272.09" data-end="1273.46">of Firefox.</span> <span data-start="1273.46" data-end="1275.87">The other one is not quite ready yet.</span> <span data-start="1275.87" data-end="1278.669">The first one that I would like to show you is..</span> </p>
<p><span data-start="1278.669" data-end="1282.76">An implementation of the Mandelbrot algorithm,</span> <span data-start="1282.76" data-end="1285.21">visualized in JavaScript.</span> <span data-start="1285.21" data-end="1287.08">Let's go out to my Nightly.</span> <span data-start="1287.08" data-end="1295.25">I don't know why that's here, but we'll ignore it.</span> <span data-start="1295.25" data-end="1301.1">So here we have Mandelbrot in JS.</span> <span data-start="1301.1" data-end="1302.59">And you're going to do the usual thing.</span> </p>
<p><span data-start="1302.59" data-end="1303.59">Zoom around.</span> <span data-start="1303.59" data-end="1305.07">By the way, this is the first demo that I ever</span> <span data-start="1305.07" data-end="1307.32">showed my wife, who's in the audience.</span> <span data-start="1307.32" data-end="1311.14">Something that I actually made possible on the web.</span> <span data-start="1311.14" data-end="1314.24">So she was so excited to see this, thinking now she's</span> <span data-start="1314.24" data-end="1315.83">going to understand what I do for work.</span> </p>
<p><span data-start="1315.83" data-end="1320.26">After I was done showing her this, she has absolutely no idea what I do for work.</span> <span data-start="1320.26" data-end="1324.67">So hopefully this will go over a little bit better for everybody else.</span> <span data-start="1324.67" data-end="1327.47">Right now the default on this is to use one to four threads.</span> <span data-start="1327.47" data-end="1330.429">I'm going to reduce it to one thread, and just show</span> <span data-start="1330.429" data-end="1335.12">that our CPU utilization is..</span> <span data-start="1335.12" data-end="1337.16">That number is..</span> <span data-start="1337.16" data-end="1338.16">Not exactly right.</span> <span data-start="1338.16" data-end="1340.19">What it's showing is out of 800..</span> <span data-start="1340.19" data-end="1341.57">8 cores.</span> <span data-start="1341.57" data-end="1345.65">So 100% would be full utilization of one core.</span> <span data-start="1345.65" data-end="1348.02">So to show that a little bit more clearly, let's actually go</span> <span data-start="1348.02" data-end="1350.48">to this, which I have running in the background.</span> <span data-start="1350.48" data-end="1353.799">I don't know how familiar you are with the htop application.</span> <span data-start="1353.799" data-end="1355.84">It's similar to the Perfmon I was using on Windows.</span> </p>
<p><span data-start="1355.84" data-end="1362.429">You can see in the top left corner there are eight effective CPU</span> <span data-start="1362.429" data-end="1366.48">cores on this machine, and right now it looks like four of them are kind of</span> <span data-start="1366.48" data-end="1370.68">doing something, and overall CPU utilization is around 100% out of a</span> <span data-start="1370.68" data-end="1373.75">possible 800%.</span> <span data-start="1373.75" data-end="1375.15">So back to our demo.</span> <span data-start="1375.15" data-end="1380.299">Let's change this to use four threads and increase the number of times that</span> <span data-start="1380.299" data-end="1383.64">this thing updates from 50 to 500.</span> <span data-start="1383.64" data-end="1389.95">Now, my frame rates are dropping, because of the update interval, but increasing, because</span> <span data-start="1389.95" data-end="1390.98">I added more threads.</span> <span data-start="1390.98" data-end="1394.4">What I really want to show here is..</span> <span data-start="1394.4" data-end="1401.34">That it's possible for us to really make this computer come to a halt.</span> <span data-start="1401.34" data-end="1406.721">So it's not very often that you can run a JavaScript application that pegs the CPU on</span> <span data-start="1406.721" data-end="1408.22">a modern computer.</span> <span data-start="1408.22" data-end="1412.56">And if you were up here, and I don't know if we can pick</span> <span data-start="1412.56" data-end="1413.66">this up..</span> </p>
<p><span data-start="1413.66" data-end="1417.75">The fans on this laptop are now at 100%.</span> <span data-start="1417.75" data-end="1420.93">So yay!</span> <span data-start="1420.93" data-end="1424.539">I came up with the most inefficient heater in</span> <span data-start="1424.539" data-end="1428.99">the whole world.</span> <span data-start="1428.99" data-end="1430">Hopefully this thing will..</span> <span data-start="1430" data-end="1431">Shut down politely.</span> <span data-start="1431" data-end="1432.07">I really don't know what that is.</span> <span data-start="1432.07" data-end="1433.73">I'm just going to ignore it.</span> </p>
<p><span data-start="1433.73" data-end="1437.4">Ask you to do the same.</span> <span data-start="1437.4" data-end="1443.39">Go back to our presentation.</span> <span data-start="1443.39" data-end="1448.28">On a different machine, with 16 effective cores, I actually captured the performance</span> <span data-start="1448.28" data-end="1450.7">of that demo, so I could illustrate it here.</span> <span data-start="1450.7" data-end="1454.66">And in that capture, I actually enabled something called SIMD,</span> <span data-start="1454.66" data-end="1455.66">which had a blue bar.</span> <span data-start="1455.66" data-end="1456.66">So just ignore that right now.</span> <span data-start="1456.66" data-end="1459.58">If you guys are really interested in that, you can find me afterwards</span> <span data-start="1459.58" data-end="1461.6">and we can talk more about SIMD.</span> <span data-start="1461.6" data-end="1466.23">But the grey bars are the performance normalized against one core</span> <span data-start="1466.23" data-end="1469.9">performance on that Mandelbrot example.</span> <span data-start="1469.9" data-end="1476.5">You can see we have perfect CPU scaling across all 16 cores.</span> <span data-start="1476.5" data-end="1482.23">Adding a core added about 70% more processing power, and that's processing that we could</span> <span data-start="1482.23" data-end="1486.919">use for really awesome game demos like we saw in the presentations prior to</span> <span data-start="1486.919" data-end="1490.47">this one.</span> </p>
<p><span data-start="1490.47" data-end="1493.87">So the next demo I would like to show..</span> <span data-start="1493.87" data-end="1496.559">Something I'm really, really excited by.</span> <span data-start="1496.559" data-end="1499.02">And in fact, something we only just got completed.</span> <span data-start="1499.02" data-end="1500.659">So hopefully this works.</span> <span data-start="1500.659" data-end="1505.95">Like I said, I'm running a private build of Firefox.</span> <span data-start="1505.95" data-end="1510.6">So I'll take a sip of water for good luck.</span> <span data-start="1510.6" data-end="1513.59">This is the Unity WebGL benchmark.</span> <span data-start="1513.59" data-end="1519.81">People out there familiar with Unity technology as a company?</span> <span data-start="1519.81" data-end="1521.98">Pretty good percentage of the audience.</span> <span data-start="1521.98" data-end="1524.669">For those who are not, Unity technologies makes a</span> <span data-start="1524.669" data-end="1527.11">3D game engine called Unity.</span> <span data-start="1527.11" data-end="1533.47">It's one of the most popular licensed 3D game engines in the world, if not the most popular</span> <span data-start="1533.47" data-end="1538.58">one, and it's a company that I think does really, really exciting things.</span> <span data-start="1538.58" data-end="1544.62">So for us to be able to work with them on enabling their benchmark, using our</span> <span data-start="1544.62" data-end="1547.3">shared memory, was really exciting.</span> </p>
<p><span data-start="1547.3" data-end="1551.01">Like I said, it's something we only got done Friday of last week.</span> <span data-start="1551.01" data-end="1552.94">So we'll see how that goes.</span> <span data-start="1552.94" data-end="1555.06">Back to my nightly.</span> <span data-start="1555.06" data-end="1558.96">And let's start this up.</span> </p>
<p><span data-start="1558.96" data-end="1565.49">These are default four cores.</span> <span data-start="1565.49" data-end="1567.76">So..</span> <span data-start="1567.76" data-end="1572.85">As you can see right away, we have a text rendering bug on the first</span> <span data-start="1572.85" data-end="1575.049">screen, which we'll ignore.</span> <span data-start="1575.049" data-end="1579.65">I'm also going to uncheck the first two demos, because they're graphically maybe not</span> <span data-start="1579.65" data-end="1581.07">as interesting as some of the other ones.</span> <span data-start="1581.07" data-end="1582.47">Let this go.</span> <span data-start="1582.47" data-end="1588.34">So this benchmark is much, much more than a WebGL benchmark.</span> <span data-start="1588.34" data-end="1592.68">What it is, actually, is testing the entire Unity 3D engine, and</span> <span data-start="1592.68" data-end="1595.32">it's all running in the browser.</span> </p>
<p><span data-start="1595.32" data-end="1600.18">Basically automatically ported from C++, very minimal changes on the Unity side.</span> <span data-start="1600.18" data-end="1604.85">All the changes were in our shared memory and in Firefox itself.</span> <span data-start="1604.85" data-end="1606.69">Here we have a bunch of dancing bears.</span> <span data-start="1606.69" data-end="1610.169">And what's more exciting than skinned dancing bears?</span> <span data-start="1610.169" data-end="1612.69">So like I said, it's much more than WebGL.</span> <span data-start="1612.69" data-end="1615.65">They have AI running.</span> <span data-start="1615.65" data-end="1616.98">Physics.</span> <span data-start="1616.98" data-end="1618.299">Particles.</span> <span data-start="1618.299" data-end="1619.63">Skinning.</span> <span data-start="1619.63" data-end="1625.13">And also their job system, which allows for execution</span> <span data-start="1625.13" data-end="1626.37">of threads.</span> <span data-start="1626.37" data-end="1627.97">Threaded content.</span> </p>
<p><span data-start="1627.97" data-end="1632.159">I think it was much prettier than any demo I</span> <span data-start="1632.159" data-end="1633.159">could write.</span> <span data-start="1633.159" data-end="1635.669">I'll let it go one more..</span> <span data-start="1635.669" data-end="1640.03">Oh, yes, have to wait for the snowman in the middle of the flurries.</span> </p>
<p><span data-start="1640.03" data-end="1646.83">Like I said, the reason why I'm really excited by this is..</span> <span data-start="1646.83" data-end="1650.82">The Unity 3D engine is a massive code base.</span> <span data-start="1650.82" data-end="1655.471">Enabling that  —  basically automatically ported over directly from C++ on</span> <span data-start="1655.471" data-end="1661.82">top of this is an incredible validation of the technology we put together.</span> <span data-start="1661.82" data-end="1665.21">And that it's working at all is amazing.</span> <span data-start="1665.21" data-end="1666.21">But I think..</span> <span data-start="1666.21" data-end="1667.21">I'll show here..</span> <span data-start="1667.21" data-end="1669.47">Let me stop this.</span> <span data-start="1669.47" data-end="1671.789">Oops.</span> <span data-start="1671.789" data-end="1676.44">Too many.</span> <span data-start="1676.44" data-end="1677.871">The performance is really quite good too.</span> <span data-start="1677.871" data-end="1681.799">I'm going to focus on just the top half of the slide.</span> <span data-start="1681.799" data-end="1683.96">Those are all the tests that I was running on the</span> <span data-start="1683.96" data-end="1684.96">left side.</span> <span data-start="1684.96" data-end="1688.07">And what we had is the blue bar is native performance.</span> </p>
<p><span data-start="1688.07" data-end="1690.48">We seem to have an anomaly on the first test.</span> <span data-start="1690.48" data-end="1693.52">The blue bar is shorter than anything running in JavaScript.</span> <span data-start="1693.52" data-end="1695.58">So I'm sure it's something I did.</span> <span data-start="1695.58" data-end="1697.27">And we'll look at that later.</span> <span data-start="1697.27" data-end="1701.169">But for all the other tests, green is normalized against one core</span> <span data-start="1701.169" data-end="1702.21">performance.</span> </p>
<p><span data-start="1702.21" data-end="1704.36">Yellow is four cores.</span> <span data-start="1704.36" data-end="1706.809">And then eight  —  red is eight.</span> <span data-start="1706.809" data-end="1708">Reddish-orange.</span> <span data-start="1708" data-end="1711.39">So you can see as we added four and then eight cores, we</span> <span data-start="1711.39" data-end="1717.09">came much closer to native performance on a bunch of these tests.</span> <span data-start="1717.09" data-end="1720.48">We're still behind on some of the other ones.</span> <span data-start="1720.48" data-end="1722.179">Obviously there's always going to be work to do.</span> <span data-start="1722.179" data-end="1727.27">And not everything is going to scale as well in JS on cores as</span> <span data-start="1727.27" data-end="1729.36">other tests.</span> <span data-start="1729.36" data-end="1732.75">So I've covered this a little bit, but yeah, this is actually</span> <span data-start="1732.75" data-end="1733.75">design criteria.</span> <span data-start="1733.75" data-end="1734.75">How we did.</span> <span data-start="1734.75" data-end="1735.89">We talked about native-like performance.</span> <span data-start="1735.89" data-end="1737.799">Now we can say  —  yes, check.</span> <span data-start="1737.799" data-end="1739.159">We do have native-like performance.</span> <span data-start="1739.159" data-end="1741.37">Especially on certain work loads.</span> </p>
<p><span data-start="1741.37" data-end="1747.42">We're almost where we are in native, on the Unity benchmark.</span> <span data-start="1747.42" data-end="1749.93">Support algorithms and applications on pthreads.</span> <span data-start="1749.93" data-end="1754.46">It's a direct port of the pthread implementation of Unity.</span> <span data-start="1754.46" data-end="1757.5">And we were able to make it with almost no changes to the code</span> <span data-start="1757.5" data-end="1758.5">base.</span> <span data-start="1758.5" data-end="1760.15">I'd like to give myself a pat on the back.</span> <span data-start="1760.15" data-end="1764.31">Think I deserve it?</span> </p>
<p><span data-start="1764.31" data-end="1766.39">Thank you.</span> <span data-start="1766.39" data-end="1770.84">So I talked about some of the reasons why the Unity test</span> <span data-start="1770.84" data-end="1772.36">is significant.</span> <span data-start="1772.36" data-end="1775.23">Not everyone is a game dev, not everyone cares that much</span> <span data-start="1775.23" data-end="1776.23">about games.</span> <span data-start="1776.23" data-end="1777.32">I personally love them.</span> <span data-start="1777.32" data-end="1780.58">I think they're not just fun to play.</span> <span data-start="1780.58" data-end="1785.35">They're fun to develop, and they really challenge software developers and hardware</span> <span data-start="1785.35" data-end="1786.35">developers.</span> <span data-start="1786.35" data-end="1789.45">So I think it's a fantastic test of any infrastructure.</span> <span data-start="1789.45" data-end="1794.1">And we were able to make all this work  —  the benchmark is not just functional.</span> <span data-start="1794.1" data-end="1797.41">But we were able to make it work fast.</span> <span data-start="1797.41" data-end="1803.76">So Yuca Yolanki did most of the implementation work on</span> <span data-start="1803.76" data-end="1807.86">making the Unity benchmark functional.</span> <span data-start="1807.86" data-end="1812.6">He worked on the (inaudible) side, and he worked on the JS side.</span> <span data-start="1812.6" data-end="1814.1">He's a Mozillian.</span> </p>
<p><span data-start="1814.1" data-end="1818.82">I asked the team for why is this particular thing significant to them,</span> <span data-start="1818.82" data-end="1823.07">and he offered up this quote, which I would like to share with everyone.</span> <span data-start="1823.07" data-end="1826.46">With shared memory, the web lifts an important implementation with shared</span> <span data-start="1826.46" data-end="1833.1">execution that it had compared to native.</span> </p>
<p><span data-start="1833.1" data-end="1836.96">Shared memory is not comparable to a library call that can be emulated or polyfilled.</span> <span data-start="1836.96" data-end="1840.97">I'm sorry for all the people who are asking this question  —  can we polyfill this?</span> <span data-start="1840.97" data-end="1841.97">We cannot.</span> <span data-start="1841.97" data-end="1844.15">But it's a fundamental concept of parallel execution</span> <span data-start="1844.15" data-end="1845.15">architectures.</span> <span data-start="1845.15" data-end="1847.98">I'm not sure if it can get any bigger than this.</span> <span data-start="1847.98" data-end="1853.13">He's a very emphatic guy and he's very excited, but I think he really did capture</span> <span data-start="1853.13" data-end="1857.309">the significance of what we accomplished here.</span> <span data-start="1857.309" data-end="1860.7">So what's next for shared memory and for the work</span> <span data-start="1860.7" data-end="1861.7">that we've done here?</span> <span data-start="1861.7" data-end="1863.34">Well, shared memory is in Nightly right now.</span> <span data-start="1863.34" data-end="1866.94">As on JS, for those that are..</span> <span data-start="1866.94" data-end="1872.29">Can I get another show of hands  —  are people familiar with (inaudible)</span> <span data-start="1872.29" data-end="1873.29">JS?</span> </p>
<p><span data-start="1873.29" data-end="1875.08">Most of the room.</span> <span data-start="1875.08" data-end="1878.7">So it's a low level subset of JS that we put together</span> <span data-start="1878.7" data-end="1881.6">that you can really optimize for, and it's fantastic for certain</span> <span data-start="1881.6" data-end="1884.47">workloads, especially cross compilation ones.</span> </p>
<p><span data-start="1884.47" data-end="1891.97">So it's not going to move out of Nightly, until we standardize it.</span> <span data-start="1891.97" data-end="1893.85">But we are in talks to standardize it.</span> <span data-start="1893.85" data-end="1898.49">The API, the set of documents you saw that Lars put together, still subject</span> <span data-start="1898.49" data-end="1899.49">to change.</span> <span data-start="1899.49" data-end="1901.169">We're getting feedback from a lot of sources inside Mozilla and</span> <span data-start="1901.169" data-end="1902.169">out.</span> </p>
<p><span data-start="1902.169" data-end="1905.62">But the good news is Google has actually announced fairly recently</span> <span data-start="1905.62" data-end="1907.69">that they're going to start implementing this too.</span> <span data-start="1907.69" data-end="1911.11">So hopefully a year from now we're going to see this in applications</span> <span data-start="1911.11" data-end="1912.65">built against it everywhere.</span> <span data-start="1912.65" data-end="1916.57">I have a bunch of links that nobody can read,</span> <span data-start="1916.57" data-end="1924.09">but I think there'll be some opportunities to share this presentation later.</span> <span data-start="1924.09" data-end="1927.51">So hopefully you can catch up on any details here that you may have.</span> <span data-start="1927.51" data-end="1928.72">And you're always welcome to find me.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
