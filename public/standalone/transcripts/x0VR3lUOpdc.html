<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>x0VR3lUOpdc</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/x0VR3lUOpdc?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="19.77" data-end="22.26">hi everyone and welcome to Jack Buster's</span> <span data-start="22.26" data-end="25.08">I'm Tom will seus I'm a product manager</span> <span data-start="25.08" data-end="27.18">on the chrome graphics team yeah I'm</span> <span data-start="27.18" data-end="29.07">that I hack on the rendering system</span> <span data-start="29.07" data-end="31.38">where I could stuff like that and we're</span> <span data-start="31.38" data-end="33.6">here today to talk about jank on the web</span> <span data-start="33.6" data-end="36.9">what it is and and how to fight it yeah</span> <span data-start="36.9" data-end="39.3">so what we usually do when we talk about</span> <span data-start="39.3" data-end="40.86">Jang because we sort of start with like</span> <span data-start="40.86" data-end="43.2">what smoothness is right so you got a</span> <span data-start="43.2" data-end="44.52">screen in front of your a lot of you do</span> <span data-start="44.52" data-end="47.16">and the way that things working right is</span> <span data-start="47.16" data-end="48.989">it's tricking your eye and perceiving</span> <span data-start="48.989" data-end="51.449">motion when in fact what it's doing is</span> <span data-start="51.449" data-end="53.64">it's updating the screen those lcds</span> <span data-start="53.64" data-end="55.95">really really really fast once every</span> <span data-start="55.95" data-end="58.8">sixty sixtieth of a second now sometimes</span> <span data-start="58.8" data-end="60.68">it's like 50 Hertz sometimes it's 54</span> <span data-start="60.68" data-end="63.899">it's all over the map but the idea is</span> <span data-start="63.899" data-end="65.46">you've got to do it fast enough so your</span> <span data-start="65.46" data-end="67.8">eye perceives this as movement and if</span> <span data-start="67.8" data-end="70.71">you do so then it's smooth if you don't</span> <span data-start="70.71" data-end="73.68">then you get Jack yeah Jack comes in in</span> <span data-start="73.68" data-end="76.29">in a whole variety of formats we refer</span> <span data-start="76.29" data-end="78.509">to something as a hitch when you drop a</span> <span data-start="78.509" data-end="80.399">whole bunch of frames in a row so say</span> <span data-start="80.399" data-end="82.229">everything stops for 200 milliseconds or</span> <span data-start="82.229" data-end="84.149">a low frame rate is when maybe things</span> <span data-start="84.149" data-end="86.64">are still still happening routinely but</span> <span data-start="86.64" data-end="87.69">they're not having as often as they</span> <span data-start="87.69" data-end="89.49">should be so you only get a new frame up</span> <span data-start="89.49" data-end="91.74">every 50 milliseconds instead of every</span> <span data-start="91.74" data-end="93.179">16 milliseconds that kind of thing and</span> <span data-start="93.179" data-end="95.64">the worst is when these things combined</span> <span data-start="95.64" data-end="97.35">and you get you get a really variable</span> <span data-start="97.35" data-end="99.33">frame rate you get new frames coming up</span> <span data-start="99.33" data-end="100.83">on the screen at irregular intervals</span> <span data-start="100.83" data-end="103.679">your eye is really well it tuned to that</span> <span data-start="103.679" data-end="105.75">sort of irregularity because it's how we</span> <span data-start="105.75" data-end="108.569">notice motion and if you you look at</span> <span data-start="108.569" data-end="110.7">something that's supposed to stick to</span> <span data-start="110.7" data-end="112.679">your finger right like something like</span> <span data-start="112.679" data-end="114.42">say this div that's rolling up and down</span> <span data-start="114.42" data-end="116.34">it's pretty fast because this resolution</span> <span data-start="116.34" data-end="117.99">is a little smaller than the monitor I</span> <span data-start="117.99" data-end="120.45">try this on a high res device or a low</span> <span data-start="120.45" data-end="122.97">in computer for then then you'll see</span> <span data-start="122.97" data-end="124.74">that once that physical metaphor gets</span> <span data-start="124.74" data-end="127.259">broken of your finger moving and the</span> <span data-start="127.259" data-end="130.229">screen updating sort of correspondingly</span> <span data-start="130.229" data-end="132.15">then all the sudden things start to feel</span> <span data-start="132.15" data-end="133.83">really bad right and this is the</span> <span data-start="133.83" data-end="134.94">difference between something that feels</span> <span data-start="134.94" data-end="137.19">smooth and feels really nice and</span> <span data-start="137.19" data-end="139.44">responsive is something that feels janky</span> <span data-start="139.44" data-end="140.489">and this is what we're talking about</span> <span data-start="140.489" data-end="142.95">when we talk about Jack yeah I mean</span> <span data-start="142.95" data-end="145.23">basically you know we all talk about</span> <span data-start="145.23" data-end="147.09">it's all well well established right</span> <span data-start="147.09" data-end="148.56">you've got to optimize your lip you know</span> <span data-start="148.56" data-end="150.51">loads minify do this do that make sure</span> <span data-start="150.51" data-end="151.47">that your</span> <span data-start="151.47" data-end="152.52">you know doing the right request to your</span> <span data-start="152.52" data-end="154.14">network but there's the second class</span> <span data-start="154.14" data-end="155.55">citizen right which is the rendering</span> <span data-start="155.55" data-end="157.41">system which we haven't typically had to</span> <span data-start="157.41" data-end="158.97">think about because you know frankly the</span> <span data-start="158.97" data-end="161.61">old web pages of yesterday you move up</span> <span data-start="161.61" data-end="163.59">and down right and the browser can do</span> <span data-start="163.59" data-end="165.36">lots of tricks to make that just fast</span> <span data-start="165.36" data-end="167.85">but nowadays when you have you know</span> <span data-start="167.85" data-end="170.04">complex beautiful looking websites for</span> <span data-start="170.04" data-end="171.75">those to feel native for those to stick</span> <span data-start="171.75" data-end="173.94">to your finger the thing you have to do</span> <span data-start="173.94" data-end="175.95">is you have to run calculation of layout</span> <span data-start="175.95" data-end="177.78">you have to run JavaScript you might</span> <span data-start="177.78" data-end="179.58">garbage collect somewhere in there you</span> <span data-start="179.58" data-end="181.41">might have some animation that you have</span> <span data-start="181.41" data-end="183.45">to do you might accidentally query a</span> <span data-start="183.45" data-end="185.13">style select you want to interrupt yeah</span> <span data-start="185.13" data-end="186.78">right like say something where it's</span> <span data-start="186.78" data-end="188.34">really it's really hard right like</span> <span data-start="188.34" data-end="190.23">there's a lot that needs to go into that</span> <span data-start="190.23" data-end="192.81">16 milliseconds and that is rattling off</span> <span data-start="192.81" data-end="196.14">this list of things but it's it what</span> <span data-start="196.14" data-end="197.61">we're here today to talk about is the</span> <span data-start="197.61" data-end="199.92">stuff that I guess I would summarize as</span> <span data-start="199.92" data-end="202.32">the green bars in in chrome devtools</span> <span data-start="202.32" data-end="205.5">right so yes there are a whole wide</span> <span data-start="205.5" data-end="207.18">variety of things that you can think</span> <span data-start="207.18" data-end="207.98">about when you're thinking about</span> <span data-start="207.98" data-end="209.91">performance and that includes all the</span> <span data-start="209.91" data-end="211.41">the network latency stuff and that's</span> <span data-start="211.41" data-end="212.85">talking about it includes a lot of</span> </p>
<p><span data-start="212.85" data-end="215.28">JavaScript events but what we're here</span> <span data-start="215.28" data-end="217.38">today to discuss is what we call</span> <span data-start="217.38" data-end="218.61">rendering and that sort of breaks down</span> <span data-start="218.61" data-end="220.17">into painting compositing we're going to</span> <span data-start="220.17" data-end="222.06">talk about both and in fact there was a</span> <span data-start="222.06" data-end="224.37">really cool post by Paul Lewis just</span> <span data-start="224.37" data-end="226.86">today where he said I bet you that if</span> <span data-start="226.86" data-end="228.57">you go to your favorite website out</span> <span data-start="228.57" data-end="231.239">there you will see a whole lot of green</span> <span data-start="231.239" data-end="234.84">and purple in in the modern web and I</span> <span data-start="234.84" data-end="236.37">would encourage you to give that a try</span> <span data-start="236.37" data-end="237.87">and I think you'll find there's a lot of</span> <span data-start="237.87" data-end="239.34">websites out there that are basically</span> <span data-start="239.34" data-end="241.98">paint and this green bound that's what</span> <span data-start="241.98" data-end="243.269">we're here to talk to you about that's</span> <span data-start="243.269" data-end="246.209">jank busting yeah so how do you Jack</span> <span data-start="246.209" data-end="248.34">bust first step is you try to paint fast</span> <span data-start="248.34" data-end="249.87">right try to get those grain bars to be</span> <span data-start="249.87" data-end="251.16">as short as possible we're gonna talk a</span> <span data-start="251.16" data-end="252.69">little bit about how to do that but</span> <span data-start="252.69" data-end="253.709">better yet you're going to try not to</span> <span data-start="253.709" data-end="255">paint it all we're gonna talk about</span> <span data-start="255" data-end="257.489">about that in probably greater detail</span> <span data-start="257.489" data-end="259.739">and lastly we're going to go into a few</span> <span data-start="259.739" data-end="263.49">cases where because the platform is not</span> <span data-start="263.49" data-end="265.32">always as obvious as it might be you end</span> <span data-start="265.32" data-end="266.7">up painting when you really don't have</span> <span data-start="266.7" data-end="268.77">to and and you might not even be</span> <span data-start="268.77" data-end="270.54">noticing this kind of thing because it's</span> <span data-start="270.54" data-end="272.55">the sort of thing that you need to use</span> <span data-start="272.55" data-end="274.56">tools to sort of proactively look for</span> <span data-start="274.56" data-end="276">but we'll show you how to do that and</span> <span data-start="276" data-end="277.41">we'll show you how to hopefully get a</span> <span data-start="277.41" data-end="278.91">better glimpse into what's going on</span> <span data-start="278.91" data-end="279.56">under the</span> <span data-start="279.56" data-end="281.45">so you've heard us use the word paint</span> <span data-start="281.45" data-end="283.34">right and I think that's really the</span> <span data-start="283.34" data-end="284.63">building block here that we need to talk</span> <span data-start="284.63" data-end="286.61">a bit more about so you go to you know</span> <span data-start="286.61" data-end="290.72">goog and you you get this right which is</span> <span data-start="290.72" data-end="293.54">a blinking cursor right whoo</span> <span data-start="293.54" data-end="295.78">earth-shattering now what's going on</span> <span data-start="295.78" data-end="298.97">behind the scenes here is that Chrome</span> <span data-start="298.97" data-end="301.49">has the cursors a lie this is not the</span> <span data-start="301.49" data-end="303.23">operating system doing it chrome has</span> <span data-start="303.23" data-end="306.139">just a bitmap in memory just of RGB</span> <span data-start="306.139" data-end="309.29">colors and the cursor is just some dark</span> <span data-start="309.29" data-end="313.04">colors in that in that bitmap and link /</span> </p>
<p><span data-start="313.04" data-end="316.04">WebKit has book keeping it very</span> <span data-start="316.04" data-end="317.69">exhaustive bookkeeping that says who</span> <span data-start="317.69" data-end="320.27">this part of the shadow Dom changed I'm</span> <span data-start="320.27" data-end="324.59">going to repaint this part of the bitmap</span> <span data-start="324.59" data-end="326.57">because it's different now and I need to</span> <span data-start="326.57" data-end="328.46">put a cursor where there wasn't or I</span> <span data-start="328.46" data-end="330.62">need to remove a cursor that is called a</span> <span data-start="330.62" data-end="332.54">repaint and so it has a there's a</span> <span data-start="332.54" data-end="334.31">repaint rectangle you can imagine right</span> <span data-start="334.31" data-end="336.11">when something changes visually we have</span> <span data-start="336.11" data-end="338.36">to repaint it and you can sort of</span> <span data-start="338.36" data-end="340.13">imagine that the cost of a repaint is</span> <span data-start="340.13" data-end="342.169">you know to first order proportional to</span> <span data-start="342.169" data-end="343.46">how much you have to repaint so</span> <span data-start="343.46" data-end="345.26">certainly you know blinking that cursors</span> <span data-start="345.26" data-end="346.19">going to be a whole heck of a lot</span> <span data-start="346.19" data-end="348.68">cheaper than blinking say all of google</span> <span data-start="348.68" data-end="350.8">to black and white right back and forth</span> <span data-start="350.8" data-end="352.91">it's just sort of intuitive right you</span> <span data-start="352.91" data-end="354.77">have to touch more bits of memory but</span> <span data-start="354.77" data-end="356.18">you know of course that's not the whole</span> <span data-start="356.18" data-end="358.85">story we could all go home right the</span> <span data-start="358.85" data-end="360.5">other part of this is that not all</span> <span data-start="360.5" data-end="362.81">paints are going to be the same speed so</span> <span data-start="362.81" data-end="364.49">of course if we want to just fill in a</span> <span data-start="364.49" data-end="366.86">part of the page with white there's</span> <span data-start="366.86" data-end="368.9">gonna be a lot cheaper but if we go to</span> <span data-start="368.9" data-end="370.46">this I'm feeling lucky button and you</span> <span data-start="370.46" data-end="371.93">actually like really look at it and</span> <span data-start="371.93" data-end="373.88">actually i think this audience more than</span> <span data-start="373.88" data-end="377.539">anybody understands sort of the details</span> <span data-start="377.539" data-end="379.88">in some of these elements all of those</span> <span data-start="379.88" data-end="381.639">little effects you see the the</span> <span data-start="381.639" data-end="384.47">anti-aliasing on the text the rounded</span> <span data-start="384.47" data-end="388.22">corner the line being anti aliased all</span> <span data-start="388.22" data-end="390.919">of those things are costly and they're</span> <span data-start="390.919" data-end="393.2">costly in the sense that they eat CPU in</span> <span data-start="393.2" data-end="395.12">order to perform the computer you know</span> <span data-start="395.12" data-end="396.83">the CPU just has to sit there going oh</span> <span data-start="396.83" data-end="399.8">is this line on the pixel or halfway on</span> <span data-start="399.8" data-end="401.419">the pixel in it just you know noms away</span> <span data-start="401.419" data-end="403.94">at the CPU so the i'm feeling lucky</span> <span data-start="403.94" data-end="406.55">button is three or four times slower to</span> <span data-start="406.55" data-end="408.65">paint than just a white area and this</span> <span data-start="408.65" data-end="409.76">sort of makes sense and then if you go</span> <span data-start="409.76" data-end="411.74">to a low-end device like a phone it's</span> <span data-start="411.74" data-end="412.729">even more</span> <span data-start="412.729" data-end="414.62">or that that difference is even more</span> <span data-start="414.62" data-end="418.49">amplified so this is all sort of my</span> <span data-start="418.49" data-end="420.439">long-winded way of saying don't paint</span> <span data-start="420.439" data-end="423.77">right like don't do it and and in</span> <span data-start="423.77" data-end="425.21">particular if you're thinking about</span> <span data-start="425.21" data-end="429.05">mobile really really don't do it and to</span> <span data-start="429.05" data-end="432.05">help you with this we built into the</span> <span data-start="432.05" data-end="435.169">browser and not just we chrome pretty</span> <span data-start="435.169" data-end="436.699">much all browsers now have this concept</span> <span data-start="436.699" data-end="439.58">of a layer right the best way to think</span> <span data-start="439.58" data-end="441.62">about layers is we look at you know your</span> <span data-start="441.62" data-end="444.11">dom and we got this this thing is an</span> <span data-start="444.11" data-end="446.059">over scroll that like an overflow scroll</span> <span data-start="446.059" data-end="448.639">did you're probably going to move that</span> <span data-start="448.639" data-end="451.759">up and down right so hey let's let's</span> <span data-start="451.759" data-end="454.159">instead of instead of repainting in</span> <span data-start="454.159" data-end="455.479">order to make that scroll happen let's</span> <span data-start="455.479" data-end="456.949">take that thing and make it into sort of</span> <span data-start="456.949" data-end="458.749">like a Photoshop layer right and then we</span> <span data-start="458.749" data-end="460.939">can move the layer up and down right and</span> <span data-start="460.939" data-end="463.219">fake it out and then what we'll do is</span> <span data-start="463.219" data-end="464.839">we'll store the contents of that layer</span> <span data-start="464.839" data-end="468.77">on the GPU and then when we actually</span> <span data-start="468.77" data-end="470.719">just do an action on the page that moves</span> <span data-start="470.719" data-end="472.729">the document up and down like this all</span> <span data-start="472.729" data-end="475.279">that you have to do is ask the GPU to</span> <span data-start="475.279" data-end="477.979">composite so now in modern chrome you'll</span> <span data-start="477.979" data-end="480.229">see two steps in the in the timeline you</span> <span data-start="480.229" data-end="481.58">see paints which you don't want to do</span> <span data-start="481.58" data-end="484.639">and you see composites the composites</span> <span data-start="484.639" data-end="486.05">are us taking these layers and smashing</span> <span data-start="486.05" data-end="488.3">them down and if you do that chrome can</span> <span data-start="488.3" data-end="490.58">really hit some super super high smooth</span> <span data-start="490.58" data-end="493.009">frame rate 60 Hertz whatever it is if</span> <span data-start="493.009" data-end="495.409">you don't do it and you paint then</span> <span data-start="495.409" data-end="497.93">you're in trouble right so I'm going to</span> <span data-start="497.93" data-end="499.969">walk you through sort of an example of</span> <span data-start="499.969" data-end="503.86">that scrolling working well or not and</span> <span data-start="503.86" data-end="507.02">this is a site it's pretty simple a list</span> <span data-start="507.02" data-end="511.479">of 100 images and you can see that again</span> <span data-start="511.479" data-end="513.649">demos might be slightly off modulo the</span> <span data-start="513.649" data-end="516.05">the resolution being slightly smaller</span> <span data-start="516.05" data-end="518.209">than what's normally on this laptop but</span> <span data-start="518.209" data-end="520.49">this Scrolls pretty smoothly I can like</span> <span data-start="520.49" data-end="522.529">fling up and down in this area no</span> <span data-start="522.529" data-end="524.93">problem you can see the disc release ID</span> <span data-start="524.93" data-end="528.44">is updating like really nicely and I'm I</span> <span data-start="528.44" data-end="530.81">would not call this janky right but</span> <span data-start="530.81" data-end="531.889">you'll notice that as I'm doing this</span> </p>
<p><span data-start="531.889" data-end="533.48">I've got the mouse cursor sitting in the</span> <span data-start="533.48" data-end="535.37">gutter of the page and if I mouse over</span> <span data-start="535.37" data-end="537.91">one of these images I've got like a</span> <span data-start="537.91" data-end="540.319">simple animation effect that happens</span> <span data-start="540.319" data-end="542.449">just based on like the hover pseudo</span> <span data-start="542.449" data-end="545">pseudo class right and I got a little</span> <span data-start="545" data-end="546.499">bit of a drop shadow</span> <span data-start="546.499" data-end="548.299">right in the image a little bit nothing</span> <span data-start="548.299" data-end="550.819">nothing all that fancy but it is it is</span> <span data-start="550.819" data-end="552.979">an effect that changes things it's a you</span> <span data-start="552.979" data-end="554.869">know two or three lines of what you'll</span> <span data-start="554.869" data-end="557.479">see is very destructive CSS exactly and</span> <span data-start="557.479" data-end="559.519">you'll see that if I try to do that same</span> <span data-start="559.519" data-end="562.429">scroll haha it's pretty fast here if I</span> <span data-start="562.429" data-end="564.619">try to do that same scroll with the the</span> <span data-start="564.619" data-end="568.309">mouse an overlay images then all the</span> <span data-start="568.309" data-end="569.929">sudden things start to kind of fall</span> <span data-start="569.929" data-end="573.019">apart and the difference is something</span> <span data-start="573.019" data-end="574.399">that i'm going to show you right now if</span> <span data-start="574.399" data-end="575.779">you open up devtools and you turn on</span> <span data-start="575.779" data-end="578.329">show paint rectangles which is like our</span> <span data-start="578.329" data-end="581.479">beloved feature in devtools you can you</span> <span data-start="581.479" data-end="583.039">can see what the difference is the</span> <span data-start="583.039" data-end="583.969">difference is whether or not you're</span> <span data-start="583.969" data-end="586.849">painting during the scroll so if I just</span> <span data-start="586.849" data-end="589.819">move up and down now what's happening is</span> <span data-start="589.819" data-end="591.919">that crumbs pre-painted a little bit</span> <span data-start="591.919" data-end="593.809">behind the scenes and it can pre-paint</span> <span data-start="593.809" data-end="597.319">about fast enough that you don't</span> <span data-start="597.319" data-end="599.119">actually get paint operations that</span> <span data-start="599.119" data-end="600.919">happen when you actually need to show</span> <span data-start="600.919" data-end="602.809">new content on the screen and so that</span> <span data-start="602.809" data-end="604.129">means I can sit here scrolling up and</span> <span data-start="604.129" data-end="607.039">down and I don't get any red rectangles</span> <span data-start="607.039" data-end="609.319">which are the areas that are being</span> <span data-start="609.319" data-end="610.759">repainted just like the blinking cursor</span> <span data-start="610.759" data-end="612.949">from so this is that layer analogy right</span> <span data-start="612.949" data-end="614.749">then in this case the layer analogy is</span> <span data-start="614.749" data-end="616.669">working well right you're not seeing any</span> <span data-start="616.669" data-end="618.409">repaints it means that you're going nice</span> <span data-start="618.409" data-end="620.389">and fast you'll hit 60 Hertz in fact the</span> <span data-start="620.389" data-end="621.619">only thing repainting you'll notice is</span> <span data-start="621.619" data-end="622.97">the scroll bar on the right hand side</span> <span data-start="622.97" data-end="625.099">there and there's no helping that if I</span> <span data-start="625.099" data-end="627.739">mouse over one of these images you can</span> <span data-start="627.739" data-end="628.849">see the throughout the throughout the</span> <span data-start="628.849" data-end="631.97">course of that that hover effect I</span> <span data-start="631.97" data-end="635.269">animate in and out the classes i'm</span> <span data-start="635.269" data-end="637.159">changing and I'm getting repaints sort</span> <span data-start="637.159" data-end="639.799">of every frame of those of those effects</span> <span data-start="639.799" data-end="641.479">animating and that's that's really</span> <span data-start="641.479" data-end="643.369">really painful right not only is it</span> <span data-start="643.369" data-end="644.569">making the animation run a little bit</span> <span data-start="644.569" data-end="648.199">slow in theory if I invite you this and</span> <span data-start="648.199" data-end="650.149">scroll up and down all the sudden I'm</span> <span data-start="650.149" data-end="651.829">having all these red rectangles flash</span> <span data-start="651.829" data-end="654.679">during the scroll operation yeah we saw</span> <span data-start="654.679" data-end="657.739">this happen on a popular photo blogging</span> <span data-start="657.739" data-end="659.629">site thing where he can sort of guess</span> <span data-start="659.629" data-end="662.479">what it was we're basically they have</span> <span data-start="662.479" data-end="664.879">this nice hover effect and if you had</span> <span data-start="664.879" data-end="666.589">your cursor in the wrong place the site</span> <span data-start="666.589" data-end="668.779">was just completely unusable yeah and</span> <span data-start="668.779" data-end="671.809">and so I mean hover is something we're</span> <span data-start="671.809" data-end="673.519">picking on here but hover is actually</span> <span data-start="673.519" data-end="674.959">relatively simple to deal with it if</span> <span data-start="674.959" data-end="676.459">scrolling performance is important to</span> <span data-start="676.459" data-end="677.809">you you can turn off the hover effect</span> <span data-start="677.809" data-end="678.949">during scroll right like I'm going to</span> <span data-start="678.949" data-end="680.089">achieve that with a non scroll</span> <span data-start="680.089" data-end="682.249">handler on a timer and indeed if I do so</span> <span data-start="682.249" data-end="683.66">you'll know that I don't get the</span> <span data-start="683.66" data-end="686.839">repaints during the scroll but then as</span> <span data-start="686.839" data-end="688.699">soon as the scroll stops I sort of get</span> <span data-start="688.699" data-end="690.079">them again 200 milliseconds after the</span> <span data-start="690.079" data-end="692.029">last scroll event and that's great right</span> <span data-start="692.029" data-end="693.62">but it does change the UX of the site a</span> <span data-start="693.62" data-end="694.91">little bit and this is the kind of thing</span> <span data-start="694.91" data-end="695.99">that you need to start sort of</span> <span data-start="695.99" data-end="697.999">reorienting yourself re orienting</span> <span data-start="697.999" data-end="700.04">yourself to think about when you think</span> <span data-start="700.04" data-end="702.92">about design right because you can do</span> <span data-start="702.92" data-end="704.329">some really nice visual effects on the</span> <span data-start="704.329" data-end="706.16">web today but it's also really easy to</span> <span data-start="706.16" data-end="707.29">shoot yourself in the foot</span> <span data-start="707.29" data-end="710.36">performance-wise and I'm going to just</span> <span data-start="710.36" data-end="712.129">sort of assert that things like good</span> <span data-start="712.129" data-end="713.449">scrolling performance they're actually</span> <span data-start="713.449" data-end="716.3">just as critical to the design and feel</span> <span data-start="716.3" data-end="718.87">of your site as really nice visuals are</span> </p>
<p><span data-start="718.87" data-end="721.999">I'm going to assert that as well just to</span> <span data-start="721.999" data-end="724.999">be with him right so again i'm picking</span> <span data-start="724.999" data-end="727.009">on hover like the point here is not use</span> <span data-start="727.009" data-end="728.6">hover the point here is use dev tools to</span> <span data-start="728.6" data-end="730.61">see what's going on right so there there</span> <span data-start="730.61" data-end="732.41">are a wide variety of ways to get paints</span> <span data-start="732.41" data-end="734.24">that you don't necessarily need or want</span> <span data-start="734.24" data-end="736.16">during a stroll they include some of the</span> <span data-start="736.16" data-end="738.559">things on this list and if you do get</span> <span data-start="738.559" data-end="739.91">paints during a scroll it's not</span> <span data-start="739.91" data-end="741.499">necessarily a problem right like it's</span> <span data-start="741.499" data-end="742.999">entirely conceivable that the paint's</span> <span data-start="742.999" data-end="746.3">can be so fast that you can afford the</span> <span data-start="746.3" data-end="748.429">paint and the texture upload to the GPU</span> <span data-start="748.429" data-end="750.079">and the composite and whatever else goes</span> <span data-start="750.079" data-end="751.429">into the rendering pipeline but just</span> <span data-start="751.429" data-end="753.05">don't pay like don't get into a</span> <span data-start="753.05" data-end="754.819">dangerous situation just don't paint</span> <span data-start="754.819" data-end="756.11">because there are a lot of things that</span> <span data-start="756.11" data-end="757.519">can make make the paint's take a long</span> <span data-start="757.519" data-end="759.829">time right I'm like yeah the rounded</span> <span data-start="759.829" data-end="762.499">corners and drop shadows and the other</span> <span data-start="762.499" data-end="763.73">effects that we're all sort of familiar</span> <span data-start="763.73" data-end="765.47">with can play into this but there can be</span> <span data-start="765.47" data-end="766.61">a lot of other things that are a lot</span> <span data-start="766.61" data-end="768.889">more subtle are the bane of our</span> <span data-start="768.889" data-end="771.29">existence right now in in this category</span> <span data-start="771.29" data-end="773.839">is is definitely image decodes because</span> <span data-start="773.839" data-end="775.309">it's really possible especially on</span> <span data-start="775.309" data-end="777.439">high-resolution screens to blow a lot of</span> <span data-start="777.439" data-end="779.629">the internal image decode caches inside</span> <span data-start="779.629" data-end="780.98">of blank / WebKit and then like</span> <span data-start="780.98" data-end="783.41">everything so so this slide don't don't</span> <span data-start="783.41" data-end="784.67">sit there scrolling down you know</span> <span data-start="784.67" data-end="785.99">scribbling down this slide or like</span> <span data-start="785.99" data-end="787.699">whatever you know we're constantly</span> <span data-start="787.699" data-end="789.529">changing our minds and krumitz growing</span> <span data-start="789.529" data-end="791.029">up and chrome chrome has a very tiny</span> <span data-start="791.029" data-end="793.459">brain and it gets really confused really</span> <span data-start="793.459" data-end="795.679">easily so this is the current list of</span> <span data-start="795.679" data-end="798.949">bad things but the best thing to do is</span> <span data-start="798.949" data-end="800.569">to pay attention the techniques we're</span> <span data-start="800.569" data-end="802.79">showing you to measure the source of</span> </p>
<p><span data-start="802.79" data-end="804.319">Jack and then sort of deal with the</span> <span data-start="804.319" data-end="805.97">latest canary of whatever</span> <span data-start="805.97" data-end="809.329">the thing is at the time exactly and the</span> <span data-start="809.329" data-end="811.129">the layer model that we're talking about</span> <span data-start="811.129" data-end="812.899">that's so great for scrolling all of</span> <span data-start="812.899" data-end="814.43">this applies to other types of animation</span> <span data-start="814.43" data-end="816.8">too there's nothing sort of special</span> <span data-start="816.8" data-end="818.509">about scrolling other than that we've</span> <span data-start="818.509" data-end="820.639">put sort of an extraordinary amount of</span> <span data-start="820.639" data-end="822.35">work into trying to make that particular</span> <span data-start="822.35" data-end="824.42">kind of scroll a lot on the web yeah</span> <span data-start="824.42" data-end="826.129">because because it's so common but like</span> <span data-start="826.129" data-end="827.689">a lot of the same primitives or what we</span> <span data-start="827.689" data-end="829.399">use to try to make things like say CSS</span> <span data-start="829.399" data-end="832.54">animation also work well so if I open up</span> <span data-start="832.54" data-end="836.689">this demo this is super ugly we're not</span> <span data-start="836.689" data-end="840.079">designers but we're trying you'll see</span> <span data-start="840.079" data-end="841.759">that this is just a drawer right thus</span> <span data-start="841.759" data-end="843.47">animates in and out it's using CSS</span> <span data-start="843.47" data-end="845.509">animation so great right like I'm using</span> <span data-start="845.509" data-end="847.279">modern techniques I'm telling the</span> <span data-start="847.279" data-end="848.959">browser what I'm trying to be doing it</span> <span data-start="848.959" data-end="850.04">should just make things good for me</span> <span data-start="850.04" data-end="853.579">right well kind of but the way CSS</span> <span data-start="853.579" data-end="855.29">animation works you can actually you can</span> <span data-start="855.29" data-end="856.97">animate all sorts of stuff right and</span> <span data-start="856.97" data-end="857.75">there are things that you can animate</span> <span data-start="857.75" data-end="860.3">that don't play very well at all with</span> <span data-start="860.3" data-end="862.129">this notion of everything needing to fit</span> <span data-start="862.129" data-end="864.86">into 16 millisecond frames for instance</span> <span data-start="864.86" data-end="866.839">what if you need to do a lot of reflow</span> <span data-start="866.839" data-end="869.75">during during the animation right that</span> <span data-start="869.75" data-end="871.699">means that every time a new position</span> <span data-start="871.699" data-end="874.279">ticks out of this animation running</span> <span data-start="874.279" data-end="876.559">stuff could be like moving around and</span> <span data-start="876.559" data-end="878.809">that's the kind of thing that blank /</span> </p>
<p><span data-start="878.809" data-end="880.639">WebKit gets really really bad out really</span> <span data-start="880.639" data-end="887.24">fast so if I I was cool surprise if I</span> <span data-start="887.24" data-end="889.49">open up devtools again and I have show</span> <span data-start="889.49" data-end="891.709">paint rexin then you can see that during</span> <span data-start="891.709" data-end="893.24">this animation I'm actually painting</span> <span data-start="893.24" data-end="894.74">every single frame with it again that</span> <span data-start="894.74" data-end="897.379">red flash that means repaint and that's</span> <span data-start="897.379" data-end="900.709">bad that's really bad for animation and</span> <span data-start="900.709" data-end="902.209">you can even see that it's a little it's</span> <span data-start="902.209" data-end="904.309">a little jerky right all I'm animating</span> <span data-start="904.309" data-end="906.92">here is the left property and if I had</span> <span data-start="906.92" data-end="908.569">say text in the middle you would see it</span> <span data-start="908.569" data-end="911.149">reflow and stuff and and that reflow is</span> <span data-start="911.149" data-end="913.22">is really really negative for</span> <span data-start="913.22" data-end="914.959">performance if I open up the devtools</span> <span data-start="914.959" data-end="917.5">timeline I'd take a recording of that</span> <span data-start="917.5" data-end="920.87">animation running you can guess what</span> <span data-start="920.87" data-end="922.879">you're going to see but if i zoom in</span> <span data-start="922.879" data-end="925.1">here I get like style recalculation</span> <span data-start="925.1" data-end="927.829">re-layout paint operations composite</span> <span data-start="927.829" data-end="930.23">layer operations and on that paint thing</span> <span data-start="930.23" data-end="931.67">will basically if you take this to a</span> <span data-start="931.67" data-end="933.23">low-end machine that paint can balloon</span> <span data-start="933.23" data-end="936.019">to 30 40 50 60 milliseconds you know in</span> <span data-start="936.019" data-end="937.699">a blink of an eye you put an image on</span> <span data-start="937.699" data-end="938.449">there you</span> <span data-start="938.449" data-end="941.149">so shadow on there you put a border you</span> <span data-start="941.149" data-end="943.669">sneeze back there gives you 60</span> <span data-start="943.669" data-end="945.589">milliseconds and and you might be saying</span> <span data-start="945.589" data-end="947.149">like well the wouldn't it be great if</span> <span data-start="947.149" data-end="948.199">the browser could kind of make this</span> <span data-start="948.199" data-end="949.369">better for me but again there's</span> <span data-start="949.369" data-end="951.139">something kind of fundamental to the way</span> <span data-start="951.139" data-end="953.269">the left property works that makes that</span> <span data-start="953.269" data-end="955.489">hard because elements elements flow</span> <span data-start="955.489" data-end="957.619">right so instead if I use something like</span> <span data-start="957.619" data-end="959.299">a WebKit transform this is probably a</span> <span data-start="959.299" data-end="962.209">trick you've screwed my demo this is</span> <span data-start="962.209" data-end="963.379">probably a trick you've you've read</span> <span data-start="963.379" data-end="965.54">about online right like these transforms</span> <span data-start="965.54" data-end="968.029">promote things to their own layer so the</span> <span data-start="968.029" data-end="969.29">layers we're talking about for scrolling</span> <span data-start="969.29" data-end="972.769">earlier they apply here too and if I run</span> <span data-start="972.769" data-end="976.819">this animation using a translate X for</span> <span data-start="976.819" data-end="978.889">my transform instead of the left</span> <span data-start="978.889" data-end="981.23">property then all of a sudden those red</span> <span data-start="981.23" data-end="983.269">rectangles go away during the animation</span> <span data-start="983.269" data-end="985.069">and that's great right because that</span> <span data-start="985.069" data-end="986.299">means I'm not I'm not painting anymore</span> <span data-start="986.299" data-end="988.16">and indeed I can confirm this if i go</span> <span data-start="988.16" data-end="990.379">back to time line take a recording run</span> <span data-start="990.379" data-end="994.129">the animation stop it look at what's</span> <span data-start="994.129" data-end="995.569">going on here all i'm seeing or</span> <span data-start="995.569" data-end="997.309">composite layer operations and the</span> <span data-start="997.309" data-end="998.839">reason that we can get away with this is</span> <span data-start="998.839" data-end="1000.73">because the transform takes the element</span> <span data-start="1000.73" data-end="1003.639">out of out of flow right and and it lets</span> <span data-start="1003.639" data-end="1005.98">us sort of make some guarantees about</span> <span data-start="1005.98" data-end="1009.429">the thing inside the transform being</span> <span data-start="1009.429" data-end="1012.069">kind of independent from the the sort of</span> <span data-start="1012.069" data-end="1014.079">parent container and that's that's</span> <span data-start="1014.079" data-end="1016.989">really nice but you'll notice there's</span> <span data-start="1016.989" data-end="1019.629">not quite done yet right because i'm</span> <span data-start="1019.629" data-end="1020.919">still seeing these red flashes at the</span> <span data-start="1020.919" data-end="1022.269">beginning and end of the animation and</span> <span data-start="1022.269" data-end="1024.069">this is the kind of thing that if you're</span> <span data-start="1024.069" data-end="1026.079">thinking with 16 millisecond frames in</span> <span data-start="1026.079" data-end="1028.48">in sort of the forefront of your mind</span> <span data-start="1028.48" data-end="1030.669">should should stand out as potentially</span> <span data-start="1030.669" data-end="1032.019">problematic right because that means</span> <span data-start="1032.019" data-end="1033.579">that as soon as I click the button a</span> <span data-start="1033.579" data-end="1035.439">repaints going to happen and if that</span> <span data-start="1035.439" data-end="1037.329">repaint might be slow then all of a</span> <span data-start="1037.329" data-end="1038.98">sudden there's this lag when I click the</span> <span data-start="1038.98" data-end="1040.449">button right and that sucks that's</span> <span data-start="1040.449" data-end="1041.74">that's really bad that's not what you</span> <span data-start="1041.74" data-end="1043.36">want it all you want things to feel</span> <span data-start="1043.36" data-end="1044.709">really responsive you want them to</span> <span data-start="1044.709" data-end="1046.929">respond immediately as soon as the other</span> <span data-start="1046.929" data-end="1050.35">the other kind of responsive right and</span> <span data-start="1050.35" data-end="1053.23">so it it so happens that there's a</span> <span data-start="1053.23" data-end="1055.87">relatively easy way around this and that</span> <span data-start="1055.87" data-end="1057.37">if you use a translate 3d instead of a</span> <span data-start="1057.37" data-end="1059.32">translate X the thing gets promoted to a</span> <span data-start="1059.32" data-end="1062.049">wire all the time if I want to</span> <span data-start="1062.049" data-end="1065.11">illustrate this I can use a great</span> <span data-start="1065.11" data-end="1067.45">feature of devtools called show</span> <span data-start="1067.45" data-end="1070.659">composited layer borders and if I turn</span> <span data-start="1070.659" data-end="1072.11">that on you see this sort of cyan</span> <span data-start="1072.11" data-end="1074.179">grid the grid is not important what is</span> <span data-start="1074.179" data-end="1076.49">important is the sort of yellowish</span> <span data-start="1076.49" data-end="1078.65">orange border that goes around the</span> <span data-start="1078.65" data-end="1080.54">viewport in this case and that yellow</span> <span data-start="1080.54" data-end="1082.13">orange border it means everything inside</span> <span data-start="1082.13" data-end="1083.9">of this is in its own layer so these</span> <span data-start="1083.9" data-end="1085.37">layers that we keep talking about here's</span> <span data-start="1085.37" data-end="1087.47">a way to sort of visualize them and if</span> <span data-start="1087.47" data-end="1089.87">you look at what happens as I run that</span> <span data-start="1089.87" data-end="1092">animation you can kind of see again if i</span> <span data-start="1092" data-end="1095.36">zoom in that the drawer gets a yellow</span> <span data-start="1095.36" data-end="1097.309">orange border of its own throughout the</span> <span data-start="1097.309" data-end="1099.29">course of the animation but if I make</span> <span data-start="1099.29" data-end="1101.09">the red rec go away the repaint wreck go</span> <span data-start="1101.09" data-end="1103.16">away you'll notice that there isn't any</span> <span data-start="1103.16" data-end="1105.71">yellow orange border before or after the</span> <span data-start="1105.71" data-end="1107.96">animation and that's bad right and</span> <span data-start="1107.96" data-end="1109.91">that's the reason that you get those red</span> <span data-start="1109.91" data-end="1112.49">flashes the repaints right at the</span> <span data-start="1112.49" data-end="1114.02">beginning and right at the end because</span> <span data-start="1114.02" data-end="1116.059">what happens is that I start the</span> <span data-start="1116.059" data-end="1118.91">animation the drawer gets ripped out put</span> <span data-start="1118.91" data-end="1121.16">in its own layer this is a new layer so</span> <span data-start="1121.16" data-end="1123.53">now chrome needs to paint the thing that</span> <span data-start="1123.53" data-end="1125.559">didn't exist before right that takes</span> <span data-start="1125.559" data-end="1128.299">arbitrarily long and then weary</span> <span data-start="1128.299" data-end="1129.799">composite recompose 'try composite the</span> <span data-start="1129.799" data-end="1131.75">animation runs and then we smush the</span> <span data-start="1131.75" data-end="1133.01">drawer back into the base layer of the</span> <span data-start="1133.01" data-end="1134.809">page when we smush it back into the base</span> <span data-start="1134.809" data-end="1136.309">layer of the page we have to repaint</span> <span data-start="1136.309" data-end="1137.51">that area and that's why you get the</span> <span data-start="1137.51" data-end="1139.58">second red flash with the at the end if</span> </p>
<p><span data-start="1139.58" data-end="1141.26">I use the the translate 3d instead of</span> <span data-start="1141.26" data-end="1142.25">the translate X this is sort of</span> <span data-start="1142.25" data-end="1144.74">incidental but you you don't get those</span> <span data-start="1144.74" data-end="1149.299">root glastron you get yeah it has a tiny</span> <span data-start="1149.299" data-end="1152.419">brain so it gets confused right it's a</span> <span data-start="1152.419" data-end="1154.49">well-meaning brain you'll see that now</span> <span data-start="1154.49" data-end="1157.299">there's this sort of orange-ish border</span> <span data-start="1157.299" data-end="1159.38">even when the animation isn't running</span> <span data-start="1159.38" data-end="1161.059">this is what we call sometimes pre</span> <span data-start="1161.059" data-end="1163.85">promotion because the layer is promote</span> <span data-start="1163.85" data-end="1165.47">the gorge of its own layer at all times</span> <span data-start="1165.47" data-end="1167.419">so if you have something that you think</span> <span data-start="1167.419" data-end="1168.77">will move in the future you need to</span> <span data-start="1168.77" data-end="1170.66">start thinking about not giving it a</span> <span data-start="1170.66" data-end="1172.46">layer at the last second like in the on</span> <span data-start="1172.46" data-end="1174.559">click but having it have a layer well in</span> <span data-start="1174.559" data-end="1176.57">advance so that it's already primed up</span> <span data-start="1176.57" data-end="1178.309">and ready to go so that when you get</span> <span data-start="1178.309" data-end="1180.23">that on click it just starts moving and</span> <span data-start="1180.23" data-end="1182.51">okay means fast right and you might be</span> <span data-start="1182.51" data-end="1184.07">thinking this feels really happy and you</span> <span data-start="1184.07" data-end="1186.77">would be you'd be correct yeah this is</span> <span data-start="1186.77" data-end="1188.24">this is the platform right now and it</span> <span data-start="1188.24" data-end="1190.13">stinks so sorry but but it is summer</span> <span data-start="1190.13" data-end="1192.41">tomato so actively changing because for</span> <span data-start="1192.41" data-end="1194.75">instance the the translate example I</span> <span data-start="1194.75" data-end="1196.64">have in the latest canary is it actually</span> <span data-start="1196.64" data-end="1199.36">stopped working as a bad example because</span> <span data-start="1199.36" data-end="1201.95">when there's a WebKit transition or a</span> <span data-start="1201.95" data-end="1205.1">transition property on the</span> <span data-start="1205.1" data-end="1207.289">the drawer element we actually are now</span> <span data-start="1207.289" data-end="1209.86">teaching link to be smart enough to</span> <span data-start="1209.86" data-end="1212.39">actually creep on pre promote the thing</span> <span data-start="1212.39" data-end="1213.95">on its own but you need to think about</span> <span data-start="1213.95" data-end="1216.14">this because it's just you don't assume</span> <span data-start="1216.14" data-end="1217.64">that the platform will get it right yet</span> <span data-start="1217.64" data-end="1221.11">someday maybe but not yet exactly so</span> <span data-start="1221.11" data-end="1224.57">that is layers for animation but</span> <span data-start="1224.57" data-end="1225.86">sometimes you need to see more than that</span> <span data-start="1225.86" data-end="1227.21">and that's going to show you yeah I mean</span> <span data-start="1227.21" data-end="1229.28">we like giving you eye strain with the</span> <span data-start="1229.28" data-end="1230.809">yellow lines those thin little yellow</span> <span data-start="1230.809" data-end="1232.19">lines that are absolutely critical for</span> <span data-start="1232.19" data-end="1233.75">performance like that's really nice</span> <span data-start="1233.75" data-end="1237.65">right so what what we've done is we</span> <span data-start="1237.65" data-end="1241.76">built an internal tool this is quite a</span> <span data-start="1241.76" data-end="1246.89">bit more technical than say you know dev</span> <span data-start="1246.89" data-end="1248.87">tools but what it will do is it let you</span> <span data-start="1248.87" data-end="1250.52">see your layering so here I just have a</span> <span data-start="1250.52" data-end="1255.47">you know cats search and when you use</span> <span data-start="1255.47" data-end="1257.179">chrome frame viewer and you can google</span> <span data-start="1257.179" data-end="1260.12">it to find info on this what you get is</span> <span data-start="1260.12" data-end="1261.47">you get a list of frames that were drawn</span> <span data-start="1261.47" data-end="1264.95">by the by the compositor so for example</span> <span data-start="1264.95" data-end="1267.559">here and then what you can end up with</span> <span data-start="1267.559" data-end="1270.98">is this which if you remember my gmail</span> <span data-start="1270.98" data-end="1274.01">slide that showed the gmail layers well</span> <span data-start="1274.01" data-end="1276.799">this is this but for your site so these</span> <span data-start="1276.799" data-end="1278.75">are your layers in your site and just to</span> <span data-start="1278.75" data-end="1280.01">give you sort of a morgue you know</span> <span data-start="1280.01" data-end="1284.33">complex example we've got you know plus</span> <span data-start="1284.33" data-end="1286.22">and here's plus here and the interesting</span> <span data-start="1286.22" data-end="1289.73">thing here is as you scroll if the</span> <span data-start="1289.73" data-end="1293.23">viewport sticks there it is over there</span> <span data-start="1293.23" data-end="1295.7">you can see sort of there's a viewport</span> <span data-start="1295.7" data-end="1299.299">here up there right and then we've got</span> <span data-start="1299.299" data-end="1300.83">the content for everything below the</span> <span data-start="1300.83" data-end="1302.87">page and so in this case as you go</span> <span data-start="1302.87" data-end="1304.52">between your pages what you'll see is</span> <span data-start="1304.52" data-end="1306.98">the actual viewport moving you'll see</span> <span data-start="1306.98" data-end="1309.289">the layers stuff like that and this can</span> <span data-start="1309.289" data-end="1310.88">end up being very useful because you can</span> <span data-start="1310.88" data-end="1314.299">pull things out like why a layer was</span> <span data-start="1314.299" data-end="1318.169">created and you know how much GPU memory</span> <span data-start="1318.169" data-end="1319.76">it's using it's sort of advanced stuff</span> <span data-start="1319.76" data-end="1321.08">but if you really are going to try to</span> <span data-start="1321.08" data-end="1324.049">push your content to the limits of the</span> <span data-start="1324.049" data-end="1325.76">current platform you may want to check</span> <span data-start="1325.76" data-end="1327.71">this sort of thing out particularly on</span> <span data-start="1327.71" data-end="1329.419">mobile where you run into things like</span> <span data-start="1329.419" data-end="1330.89">memory memory constraints a lot more</span> <span data-start="1330.89" data-end="1333.29">readily yeah this is kind of what we're</span> <span data-start="1333.29" data-end="1335.059">gonna we're gonna be pretty brief on</span> <span data-start="1335.059" data-end="1336.89">that though a pretty low level tool but</span> <span data-start="1336.89" data-end="1338.36">grab us if you're yeah we're happy to</span> <span data-start="1338.36" data-end="1339.17">talk about it more</span> <span data-start="1339.17" data-end="1343.97">ya later on last category of stuff we</span> <span data-start="1343.97" data-end="1345.41">want to talk about which is which is</span> <span data-start="1345.41" data-end="1347.78">that there there are times when you can</span> <span data-start="1347.78" data-end="1350.15">get one of these these repaint flashes</span> <span data-start="1350.15" data-end="1353.03">even if it seems like you didn't deserve</span> <span data-start="1353.03" data-end="1355.4">it and this can happen in all sorts of</span> <span data-start="1355.4" data-end="1357.31">scenarios but I'll walk you through one</span> <span data-start="1357.31" data-end="1360.92">if I click this button I add a div to a</span> <span data-start="1360.92" data-end="1363.74">container pretty simple fantastic so 100</span> <span data-start="1363.74" data-end="1366.2">100 pics square nothing complicated at</span> <span data-start="1366.2" data-end="1369.14">all about this styling right and if I</span> <span data-start="1369.14" data-end="1371.09">open up devtools and I have the the</span> <span data-start="1371.09" data-end="1372.47">repaint wrecks on I'm going to turn off</span> <span data-start="1372.47" data-end="1374.78">the layer borders have the repaint</span> <span data-start="1374.78" data-end="1377.93">wrecks on as I as I click to add more</span> <span data-start="1377.93" data-end="1379.43">you can see that i'm sort of repainting</span> <span data-start="1379.43" data-end="1381.38">where the button is and I'm repainting</span> <span data-start="1381.38" data-end="1385.07">where the the new divs are and as I get</span> <span data-start="1385.07" data-end="1387.77">sort of off-screen adding more I can sit</span> <span data-start="1387.77" data-end="1389.66">here all day mashing this button and the</span> <span data-start="1389.66" data-end="1391.04">only thing that repaints is well the</span> <span data-start="1391.04" data-end="1393.65">scroll bar and the button right this is</span> <span data-start="1393.65" data-end="1395.6">great this kind of makes sense it's it's</span> <span data-start="1395.6" data-end="1397.46">intuitive to think that well if I'm</span> <span data-start="1397.46" data-end="1399.53">changing something in the Dom but it's</span> <span data-start="1399.53" data-end="1400.7">only affecting things that are</span> <span data-start="1400.7" data-end="1402.95">off-screen shouldn't need to repaint</span> <span data-start="1402.95" data-end="1405.95">right and that's great when it works but</span> <span data-start="1405.95" data-end="1408.62">unfortunately repaints don't only happen</span> <span data-start="1408.62" data-end="1410.63">when you make changes that end up with</span> <span data-start="1410.63" data-end="1413.45">visual impact it's entirely possible to</span> <span data-start="1413.45" data-end="1416.12">do something like say toggle the padding</span> <span data-start="1416.12" data-end="1418.7">on this container block that you can see</span> <span data-start="1418.7" data-end="1421.36">outlined in black and when you do that</span> <span data-start="1421.36" data-end="1423.5">you end up repainting the entire</span> <span data-start="1423.5" data-end="1425.54">container and again if you think about</span> <span data-start="1425.54" data-end="1426.95">it a little longer maybe this makes</span> <span data-start="1426.95" data-end="1429.17">sense again because from blinks</span> <span data-start="1429.17" data-end="1431.84">perspective what happened you added a</span> <span data-start="1431.84" data-end="1433.85">little bit of padding but potentially</span> <span data-start="1433.85" data-end="1435.77">everything inside refloat right this is</span> <span data-start="1435.77" data-end="1438.92">like the beauty of the web and when that</span> <span data-start="1438.92" data-end="1440.81">happens all bets are off about the</span> <span data-start="1440.81" data-end="1443.42">content inside of the container blink</span> <span data-start="1443.42" data-end="1444.89">needs to be very very conservative about</span> <span data-start="1444.89" data-end="1446.66">maintaining like what might be dirty</span> <span data-start="1446.66" data-end="1449.06">what might be out of date and we have to</span> <span data-start="1449.06" data-end="1451.13">repaint and when we repaint this is what</span> <span data-start="1451.13" data-end="1452.69">you get so it's really important to</span> <span data-start="1452.69" data-end="1455.27">think about this in terms of like you</span> <span data-start="1455.27" data-end="1456.98">can't blink and get confused and it gets</span> <span data-start="1456.98" data-end="1458.51">confused very easily so you have to</span> <span data-start="1458.51" data-end="1460.31">monitor this sort monitor for this sort</span> <span data-start="1460.31" data-end="1462.56">of thing during your development there</span> <span data-start="1462.56" data-end="1464.81">ways with chrome developer tools</span> <span data-start="1464.81" data-end="1467.9">protocol to get the paint stream out so</span> <span data-start="1467.9" data-end="1469.46">that you can monitor and test harnesses</span> <span data-start="1469.46" data-end="1471.92">for example but you need to keep an eye</span> <span data-start="1471.92" data-end="1472.88">on this sort of thing</span> <span data-start="1472.88" data-end="1474.47">because stupid and knock your stuff like</span> <span data-start="1474.47" data-end="1476.27">setting width to the same thing that it</span> <span data-start="1476.27" data-end="1478.6">used to be can sometimes cause this and</span> <span data-start="1478.6" data-end="1480.83">and then it'll you know ruin your day</span> <span data-start="1480.83" data-end="1482.39">and this is the kind of thing that again</span> <span data-start="1482.39" data-end="1483.32">we're trying to make better all the time</span> <span data-start="1483.32" data-end="1484.94">but there are always going to be</span> <span data-start="1484.94" data-end="1486.44">pitfalls like this so it's the kind of</span> <span data-start="1486.44" data-end="1488.15">thing you need to sort of watch out for</span> <span data-start="1488.15" data-end="1490.88">yeah but I mean ultimately there there</span> <span data-start="1490.88" data-end="1492.56">are just times when you do your best</span> <span data-start="1492.56" data-end="1494.99">you've got you know everything done as</span> <span data-start="1494.99" data-end="1496.61">well as you can but you do have to paint</span> <span data-start="1496.61" data-end="1498.44">sometimes that's you've added something</span> <span data-start="1498.44" data-end="1499.73">to the dominant you actually really do</span> <span data-start="1499.73" data-end="1501.38">need to paint it and sometimes it's just</span> <span data-start="1501.38" data-end="1502.76">an effect that you're just not willing</span> <span data-start="1502.76" data-end="1504.8">to compromise on you know there might be</span> <span data-start="1504.8" data-end="1506.99">the g-wiz thing that you've done you</span> <span data-start="1506.99" data-end="1508.28">know who knows what it is but it happens</span> <span data-start="1508.28" data-end="1512.21">so we we started off with with sort of</span> <span data-start="1512.21" data-end="1515.3">this this thing up right and it's a</span> <span data-start="1515.3" data-end="1516.92">little janky er when you go fullscreen</span> <span data-start="1516.92" data-end="1519.65">and blah blah blah so we're showing you</span> <span data-start="1519.65" data-end="1522.02">this is sort of an example of bad</span> <span data-start="1522.02" data-end="1524.3">content right chrome has a feature</span> <span data-start="1524.3" data-end="1526.61">called continuous repainting mode or</span> <span data-start="1526.61" data-end="1529.73">devtools does so if I check this button</span> <span data-start="1529.73" data-end="1533.39">here and go back now what chrome is</span> <span data-start="1533.39" data-end="1535.52">doing is it's constantly repainting so</span> <span data-start="1535.52" data-end="1537.23">it's a little hard to see but basically</span> <span data-start="1537.23" data-end="1539.03">they're the whole page has got a little</span> <span data-start="1539.03" data-end="1541.01">red and that's because it's got a big</span> <span data-start="1541.01" data-end="1542.6">repaint rectangle on all of it and</span> <span data-start="1542.6" data-end="1544.52">what's happening here is Chrome's</span> <span data-start="1544.52" data-end="1547.28">constantly re re repainting all the time</span> <span data-start="1547.28" data-end="1550.07">as fast as it can go and up here is the</span> <span data-start="1550.07" data-end="1552.98">number in the top right the the paint</span> <span data-start="1552.98" data-end="1554.78">speed that we're sustaining so this is</span> <span data-start="1554.78" data-end="1557.33">assuming that you've just do you confuse</span> <span data-start="1557.33" data-end="1559.88">blink and it's going horribly so when i</span> <span data-start="1559.88" data-end="1562.27">unplug projector here this goes at like</span> <span data-start="1562.27" data-end="1565.46">167 milliseconds the idea here though is</span> <span data-start="1565.46" data-end="1568.25">you can sit there now in devtools we're</span> <span data-start="1568.25" data-end="1569.87">going to play some window size</span> <span data-start="1569.87" data-end="1572.66">acrobatics here to get that up on the</span> <span data-start="1572.66" data-end="1576.73">screen okay so we have another piece of</span> <span data-start="1576.73" data-end="1579.02">you know feature addition to dev tools</span> <span data-start="1579.02" data-end="1581">which is at the H key on the element</span> <span data-start="1581" data-end="1582.77">panel super super you know the top</span> <span data-start="1582.77" data-end="1585.65">secret yeah we live in large so we've</span> <span data-start="1585.65" data-end="1587.09">got this H key and what it does is it</span> <span data-start="1587.09" data-end="1589.52">hides that element and everybody that</span> <span data-start="1589.52" data-end="1591.68">descends from it and if you watch that</span> <span data-start="1591.68" data-end="1593.48">number that's being reported we're going</span> <span data-start="1593.48" data-end="1595.28">from a big number to a really really</span> <span data-start="1595.28" data-end="1597.71">trivial number not 20 and that sort of</span> <span data-start="1597.71" data-end="1599.03">makes sense we've still got to set the</span> <span data-start="1599.03" data-end="1603.47">page to this lovely puse color right so</span> <span data-start="1603.47" data-end="1606.74">but it's it's cheaper so we can go well</span> <span data-start="1606.74" data-end="1608.48">clearly this tells us that the thing</span> <span data-start="1608.48" data-end="1611.3">that slow painting is inside my body no</span> <span data-start="1611.3" data-end="1614.99">boo so this is simple it's just a bunch</span> <span data-start="1614.99" data-end="1618.23">of image you know tag so I can do the</span> <span data-start="1618.23" data-end="1620.09">same trick with styles so I can hide the</span> <span data-start="1620.09" data-end="1622.49">box shadow and now we're really cranking</span> <span data-start="1622.49" data-end="1623.78">we're going at what like eight</span> <span data-start="1623.78" data-end="1626.42">milliseconds right so now we sorta have</span> <span data-start="1626.42" data-end="1628.13">this idea that well maybe 22 of those</span> <span data-start="1628.13" data-end="1631.07">milliseconds or watch me do math some</span> <span data-start="1631.07" data-end="1633.02">some amount of that is going to the drop</span> <span data-start="1633.02" data-end="1636.08">shadow right we can bring it back on and</span> <span data-start="1636.08" data-end="1637.64">turn off the border radius and you can</span> <span data-start="1637.64" data-end="1640.55">see that well hmm maybe it's that one</span> <span data-start="1640.55" data-end="1642.44">right now these don't always compose</span> <span data-start="1642.44" data-end="1644.36">sometimes you confuse chrome so like if</span> </p>
<p><span data-start="1644.36" data-end="1646.7">I remove both of them we're not really</span> <span data-start="1646.7" data-end="1648.89">going incrementally much faster so</span> <span data-start="1648.89" data-end="1650.12">what's happening here is you're hitting</span> <span data-start="1650.12" data-end="1652.1">a particular corner case in Chrome's</span> <span data-start="1652.1" data-end="1654.74">rendering system where the comp is the</span> <span data-start="1654.74" data-end="1656.12">composition of these two different</span> <span data-start="1656.12" data-end="1659.03">styles is particularly slow don't go</span> <span data-start="1659.03" data-end="1660.86">home and say hey this is this this is</span> <span data-start="1660.86" data-end="1662.48">one to avoid because we may fix this</span> <span data-start="1662.48" data-end="1665.6">tomorrow right we probably won't but we</span> <span data-start="1665.6" data-end="1670.4">might and again keep the technique in</span> <span data-start="1670.4" data-end="1672.44">mind we found a lot of sites where</span> <span data-start="1672.44" data-end="1674.66">there's one effect that's particularly</span> <span data-start="1674.66" data-end="1677.24">slow now not to rag on gmail but in</span> </p>
<p><span data-start="1677.24" data-end="1678.679">Gmail there's a little drop shadow</span> <span data-start="1678.679" data-end="1682.4">between the top bar and the message list</span> <span data-start="1682.4" data-end="1685.34">and the little drop shadow that's a like</span> <span data-start="1685.34" data-end="1688.37">a half pixel and that costs a third of</span> <span data-start="1688.37" data-end="1691.059">the rendering time of the entire page</span> <span data-start="1691.059" data-end="1693.65">this is important to factor into your</span> <span data-start="1693.65" data-end="1695.809">design discussions right this is a back</span> <span data-start="1695.809" data-end="1697.13">and forth that you need to be having</span> <span data-start="1697.13" data-end="1698.99">early on so that you don't get a week</span> <span data-start="1698.99" data-end="1700.91">away from ship and go oh my god we can't</span> <span data-start="1700.91" data-end="1703.19">we can't afford this oh my god we're up</span> <span data-start="1703.19" data-end="1705.41">a creek so continuous painting mode</span> <span data-start="1705.41" data-end="1707.15">definitely check it out we also have</span> <span data-start="1707.15" data-end="1709.429">more fanciness coming in that high-tech</span> <span data-start="1709.429" data-end="1710.9">tool some of you may have seen in the</span> <span data-start="1710.9" data-end="1713.78">blogsphere about skia debugger and some</span> <span data-start="1713.78" data-end="1715.4">magic you can play that will start</span> <span data-start="1715.4" data-end="1717.679">showing up in the frame viewer so more</span> <span data-start="1717.679" data-end="1722.54">coming that's right so to wrap up again</span> <span data-start="1722.54" data-end="1726.02">the main takeaway here is tools you want</span> <span data-start="1726.02" data-end="1727.37">to ask yourself a couple key questions</span> <span data-start="1727.37" data-end="1728.69">when you're debugging site performance</span> <span data-start="1728.69" data-end="1730.429">you want to ask yourself why you're</span> <span data-start="1730.429" data-end="1732.02">painting well first you want to notice</span> <span data-start="1732.02" data-end="1733.16">that you're painting using show paint</span> </p>
<p><span data-start="1733.16" data-end="1734.45">Rex you and then you want to ask</span> <span data-start="1734.45" data-end="1735.559">yourself why you want to see if you can</span> <span data-start="1735.559" data-end="1737.96">avoid it either through judicious use of</span> <span data-start="1737.96" data-end="1740.269">layers or by just trying to not touch</span> <span data-start="1740.269" data-end="1742.399">unnecessarily and if you really can't</span> <span data-start="1742.399" data-end="1743.359">avoid it then you want to make it as</span> <span data-start="1743.359" data-end="1745.129">fast as possible using tools like</span> <span data-start="1745.129" data-end="1746.869">continuous painting mode the necklace</span> <span data-start="1746.869" data-end="1748.099">and it's especially important because</span> </p>
<p><span data-start="1748.099" data-end="1751.309">Chrome's changing a lot so you know be</span> <span data-start="1751.309" data-end="1753.169">familiar with what currently is bad</span> <span data-start="1753.169" data-end="1755.479">because it'll change again and also keep</span> <span data-start="1755.479" data-end="1756.769">in mind that your computer that you're</span> <span data-start="1756.769" data-end="1758.389">probably developing on is a really good</span> <span data-start="1758.389" data-end="1760.159">one I see a lot of sort of good machines</span> <span data-start="1760.159" data-end="1762.83">out there right that is not what MA and</span> <span data-start="1762.83" data-end="1766.039">pas have and that is most of the web so</span> <span data-start="1766.039" data-end="1768.08">keep that in mind when you get something</span> <span data-start="1768.08" data-end="1769.369">going it you know seven or eight</span> <span data-start="1769.369" data-end="1771.469">milliseconds on your computer know that</span> <span data-start="1771.469" data-end="1772.579">that's two or three or eight times</span> <span data-start="1772.579" data-end="1775.94">slower out on the real world or like</span> <span data-start="1775.94" data-end="1778.7">also shrink it was or whatever and a</span> <span data-start="1778.7" data-end="1780.95">really good number to walk away from is</span> <span data-start="1780.95" data-end="1784.009">or walk away with is Wikipedia if you</span> <span data-start="1784.009" data-end="1785.929">just do like the cats page on Wikipedia</span> </p>
<p><span data-start="1785.929" data-end="1788.239">I think it takes about 150 milliseconds</span> <span data-start="1788.239" data-end="1793.489">to paint on a nexus 7 so that is not</span> <span data-start="1793.489" data-end="1796.279">Jang free right so you know keep this</span> <span data-start="1796.279" data-end="1800.209">stuff in mind exactly so with that I'm</span> <span data-start="1800.209" data-end="1801.82">not sure we have time for questions but</span> <span data-start="1801.82" data-end="1804.95">this talk and other sort of resources</span> <span data-start="1804.95" data-end="1807.169">just a bunch of bunch of links to two</span> <span data-start="1807.169" data-end="1809.119">similar content is all up on Jack free</span> <span data-start="1809.119" data-end="1812.239">org which is a site we maintain a lot of</span> <span data-start="1812.239" data-end="1814.279">that content actually lives on html5</span> <span data-start="1814.279" data-end="1815.719">rocks which is the chrome developer</span> <span data-start="1815.719" data-end="1818.299">relations website our contact infos up</span> <span data-start="1818.299" data-end="1820.789">here if you have thoughts on any of this</span> <span data-start="1820.789" data-end="1822.679">we're always happy to talk about it and</span> <span data-start="1822.679" data-end="1824.059">we like talking to develop shoulder to</span> <span data-start="1824.059" data-end="1826.19">cry on yeah we'll be around tonight too</span> <span data-start="1826.19" data-end="1828.139">if anyone has a site that's slow or</span> <span data-start="1828.139" data-end="1830.389">whatever we do we can take a look thank</span> <span data-start="1830.389" data-end="1834.019">you and thank you very much</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
