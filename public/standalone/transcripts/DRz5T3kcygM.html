<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DRz5T3kcygM</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/DRz5T3kcygM?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.62" data-end="25.52">hello, everyone, yes, I'm going to talk about real‑time in the browser, XMPP I'll try</span> <span data-start="25.52" data-end="30.99">to keep it quite light, if you feel like me, you're a bit frazzled and tired.</span> <span data-start="30.99" data-end="32.38">Okay, so ..</span> <span data-start="32.38" data-end="40.649">XMPP it's the externsble messaging and presence protocol.</span> </p>
<p><span data-start="40.649" data-end="43.649">And this was developed back in 1998.</span> <span data-start="43.649" data-end="52.96">A time when people had lots and lots of different IM clients you had AOL messenger, yahoo messenger,</span> <span data-start="52.96" data-end="60.269">ICQ and you would here Eh‑oo every couple of minutes.</span> <span data-start="60.269" data-end="66.16">It was a bit of rubbish situation, some friends on one, another set on another one, you'd</span> <span data-start="66.16" data-end="73.27">either have to run them all or ignore some friends\h‑‑ it was a bit of a crap situation.</span> <span data-start="73.27" data-end="78.62">So, some guys got together and they thought what we'll do and we'll build a system where</span> <span data-start="78.62" data-end="83.8">you can have lots and lots of different servers but they'll all be able to talk to each other.</span> <span data-start="83.8" data-end="91.03">It was originally built as an application called Jabba, but since it's changed to XMPP</span> <span data-start="91.03" data-end="93.57">when it became part of the ITF.</span> <span data-start="93.57" data-end="100.46">And it's not a single server or single piece of code, it's a set of standards, so anyone</span> <span data-start="100.46" data-end="104.54">can implement it, you can have proprietary servers, Open Source servers, and there's</span> <span data-start="104.54" data-end="107.16">lots and lots out there.</span> </p>
<p><span data-start="107.16" data-end="112.67">The big advantage of it is it's forked rated all the servers can talk to each other without</span> <span data-start="112.67" data-end="114.15">any extra coding.</span> <span data-start="114.15" data-end="122.31">(Fedder rated) who here uses the XMPP? Okay.</span> <span data-start="122.31" data-end="123.95">Keep your hands up.</span> <span data-start="123.95" data-end="124.95">That's not right.</span> <span data-start="124.95" data-end="125.95">Okay.</span> <span data-start="125.95" data-end="131.81">So, who of you here uses WhatsApp, yeah, that's a few more.</span> <span data-start="131.81" data-end="137.799">It's basically a hacked version of XMPP they just used some of the bad bits and not some</span> <span data-start="137.799" data-end="140.28">of the good bits.</span> </p>
<p><span data-start="140.28" data-end="145.53">Who here uses Facebook chat? Yeah, okay.</span> <span data-start="145.53" data-end="149.87">Who here uses Hip chat, okay,cool, so you're all using XMPP.</span> <span data-start="149.87" data-end="153.06">I think maybe two or three people that didn't put their hand up.</span> <span data-start="153.06" data-end="161.829">So who here has a smartphone? Yes, see you all use XMPP, you just don't know about it.</span> <span data-start="161.829" data-end="168.969">It's widely use in the areas of finance, government, a lot of messaging systems, companies that</span> <span data-start="168.969" data-end="171.049">do building management use it a lot.</span> <span data-start="171.049" data-end="178.409">My point is it's often not advertised that it's being used.</span> <span data-start="178.409" data-end="182.999">Why do I think XMPP is important? Well, we're seeing the continuing growth of real‑time</span> <span data-start="182.999" data-end="190.48">on the web, you see people bringing up new real‑time systems quite often and you watch</span> <span data-start="190.48" data-end="196.219">how it goes and they just keep making the same mistakes that were solved in XMPP about</span> <span data-start="196.219" data-end="201.209">twelve to fourteen years ago, you see them try to add things like it would be cool if</span> <span data-start="201.209" data-end="204.37">you could run it on multiple servers the and talk to each other and they do this hacky</span> <span data-start="204.37" data-end="210.639">piece of crap, these are problems already solved with XMPP.</span> <span data-start="210.639" data-end="216.54">People shouldn't keep making the same mistakes, the other area where it's quite interesting</span> <span data-start="216.54" data-end="223.439">as well is with the rise of webRTC, peer to peer sessions all greet, but there's no signal</span> <span data-start="223.439" data-end="230.62">in webRTC, how did you find each other? The way it's done currently people use meet me</span> </p>
<p><span data-start="230.62" data-end="237.879">URLs, you is to agree to some terms on a website, maybe tracked, maybe this system doesn't have</span> <span data-start="237.879" data-end="242.43">all the features you want, this one does, and your friends don't like that one, why</span> <span data-start="242.43" data-end="249.159">do that when you can both log into an account and share the details directly? And there's</span> <span data-start="249.159" data-end="257.889">also movement back towards this sort of decentralized web so the Snowden revelation, big targets</span> <span data-start="257.889" data-end="264.979">like Google, Apple Facebook, it's easy for people to request information.</span> </p>
<p><span data-start="264.979" data-end="270.33">If we're running smaller servers and smaller groups, actually to get information about</span> <span data-start="270.33" data-end="275.09">what you're up to is a lot more difficult.</span> <span data-start="275.09" data-end="280.53">And then the last point is, if you also use XMPP you don't just get some chat messaging</span> <span data-start="280.53" data-end="285.84">stuff, you get things like presence, which I'm available right now, I'm away, I'm busy,</span> <span data-start="285.84" data-end="291.699">you get address books, pubsub, you get peer to peer session seat up, you get tons and</span> <span data-start="291.699" data-end="296.08">tons of stuff for free without any extra work.</span> </p>
<p><span data-start="296.08" data-end="302.03">Lets quickly go through some of the fundamentals of XMPP.</span> <span data-start="302.03" data-end="315.13">Stanzas, they're just chunks of XML, there's three basic Stanzas, one of them is message,</span> <span data-start="315.13" data-end="319.35">which is just sort of chat messages, sending updates.</span> <span data-start="319.35" data-end="323.72">The second is presence, which is basically I'm on‑line, I'm off line, there's a really</span> <span data-start="323.72" data-end="328.52">cool feature called priority, which I'll talk about in a second, and the third one is IQ</span> <span data-start="328.52" data-end="334.72">or information query which has set and get, basically like you have very simple HTTP\h‑‑</span> <span data-start="334.72" data-end="344.389">then there's also the JID or the Jabber ID consists of three parts first you is your</span> <span data-start="344.389" data-end="350.159">server, so in this example it's example.org, I then log in as user@example.org.</span> </p>
<p><span data-start="350.159" data-end="358.3">And I then have this third thing on the end called a resource, which is really interesting,</span> <span data-start="358.3" data-end="367.379">even though this was designed back in 1998, it was designed with multiple devices in mind.</span> <span data-start="367.379" data-end="371.5">Going back to the presence Stanza I talked about a second ago.</span> <span data-start="371.5" data-end="378.61">I'm on my laptop work away my laptop has a presence priority of 5.</span> <span data-start="378.61" data-end="387.03">And when people send messages to my user@example.org, messages get routed through to my laptop.</span> <span data-start="387.03" data-end="391.66">When I walk away from my laptop and have my phone, which has been happily sitting there</span> <span data-start="391.66" data-end="397.56">at a priority of four, the laptop goes to sleep drops down to a priority of one, and</span> <span data-start="397.56" data-end="404.939">now it will get routed to me on my mobile phone, so you can always be sure the messages</span> <span data-start="404.939" data-end="410.89">get the device that the person is most likely to be using.</span> <span data-start="410.89" data-end="413.039">Clients.</span> </p>
<p><span data-start="413.039" data-end="418.65">What we say with XMPP is that your clients should be very, very light.</span> <span data-start="418.65" data-end="424.552">And this is really good for mobile phone usage because we don't expect the clients to do</span> <span data-start="424.552" data-end="426.04">any work whatsoever.</span> <span data-start="426.04" data-end="428.75">You save a lot of battery that way.</span> </p>
<p><span data-start="428.75" data-end="433.65">You connect to server in three different standard ways of connecting, one is just a standard</span> <span data-start="433.65" data-end="438.99">socket, the other one is a long poling set up and the new one is the web sockets.</span> <span data-start="438.99" data-end="447.31">And the other thing that's really good, unlike other systems which pole a server to do real‑time,</span> <span data-start="447.31" data-end="451.759">that's quite heavy on your server and your clients, setting up new connections is there</span> <span data-start="451.759" data-end="458.379">any information, no, thanks great! So it's very intensive, where as with XMPP data gets</span> <span data-start="458.379" data-end="464.031">pushed, so, if you imagine kids sat in the back of the car, are we there yet, are we</span> <span data-start="464.031" data-end="468.949">there yet? Are we there yet? In this case we say just shut up and I'll tell you when</span> <span data-start="468.949" data-end="470.47">we're there.</span> </p>
<p><span data-start="470.47" data-end="471.979">Very different.</span> <span data-start="471.979" data-end="478.139">Servers, all they're there for is to route messages, they set up these secure connections</span> <span data-start="478.139" data-end="483.31">between each other, and they handle the authentication.</span> <span data-start="483.31" data-end="487.8">And then the third part is the components which is pretty much where you develop is</span> <span data-start="487.8" data-end="494.93">going to to be held, so the server custom business logic, you can have standard components</span> <span data-start="494.93" data-end="498.069">or you could do something specific to your use case.</span> </p>
<p><span data-start="498.069" data-end="506.419">And a nice way to build components in JavaScript is to use node-xmpp-component. They're server</span> <span data-start="506.419" data-end="514.93">agnostic, so I could write my code in JavaScript and connect to a server in lua and then get</span> <span data-start="514.93" data-end="518.44">rid of the server and replace with Java server and I don't have to change anything about</span> <span data-start="518.44" data-end="520.09">my code.</span> <span data-start="520.09" data-end="528.09">All right, so why don't we see it being used by web developers? Well, the big advantage</span> <span data-start="528.09" data-end="535.15">X M L is the extensibility part but the big\h‑‑ in order to achieve that extensibility we</span> <span data-start="535.15" data-end="545.73">use XML, I don't know about you guys, my interactions with XML has been via soap, it's horrible,</span> <span data-start="545.73" data-end="550.24">not nice to deal with in the browser, it's slow you can sometimes lose data and things</span> <span data-start="550.24" data-end="551.67">like that.</span> </p>
<p><span data-start="551.67" data-end="556.7">And also when you compare it to JSON XML seems verbose, ugly, and old fashioned, it's just</span> <span data-start="556.7" data-end="558.14">Yuck.</span> <span data-start="558.14" data-end="567.76">So what I've done is created a library called XMPP for the web. It converts messages to</span> <span data-start="567.76" data-end="572.529">JSON on the server. And then send it down to your over web socket.</span> <span data-start="572.529" data-end="578.93">And this makes it much nicer to develop applications, using XMPP but not be exposed to any of the</span> <span data-start="578.93" data-end="584.55">nasty stuff as web developers we don't really like.</span> <span data-start="584.55" data-end="588.11">So what I'm going to do now is probably get this completely wrong, this will be the funny</span> <span data-start="588.11" data-end="589.97">part of the talk. .</span> <span data-start="589.97" data-end="595.18">I'm going to do a live demo and show you how easy it is to build an application.</span> <span data-start="595.18" data-end="609.32">I'm going to ask you to help me out, so it's a part participation exercise.</span> <span data-start="609.32" data-end="614.73">I'm going to write a little application here and what it's going to do is listen for incoming</span> <span data-start="614.73" data-end="619.72">chat messages, draw a little circle on the screen and allow you whys guys to move it</span> <span data-start="619.72" data-end="621.949">around.</span> </p>
<p><span data-start="621.949" data-end="626.93">But the interesting bit here is you're all going to connect on servers all around the</span> <span data-start="626.93" data-end="634.01">world and and they're going to talk to my server and perform the actions, so if you\h‑‑</span> <span data-start="634.01" data-end="644.459">that UL, in the meantime I will start coding up something (If you pop open that URL, in</span> <span data-start="644.459" data-end="659.7">the meantime I well start coding something) so I'm just going to drop this over here.</span> <span data-start="659.7" data-end="669.05">Okay, the first thing I need do is log into my server, so let's get that done.</span> <span data-start="669.05" data-end="673.98">So all I have in this, very much like the clients you'll be loading is an MD5 library</span> <span data-start="673.98" data-end="680.29">because a hash of a string is 0‑9 A‑F take the first six characters gives me a nice</span> <span data-start="680.29" data-end="687.24">Hex colour code, Jquery and web socket being delivered for XMPP for the web.</span> <span data-start="687.24" data-end="717.699">Okay, so</span> <span data-start="717.699" data-end="738.52">that's listening for my incoming connection, I'm going to ask it to log in for me.</span> <span data-start="738.52" data-end="744.37">For any of you about to get excited, Ha‑Ha‑Ha.</span> <span data-start="744.37" data-end="752.91">Okay, cool, all right, I'm on‑line, I'm connected.</span> <span data-start="752.91" data-end="756.67">I can start doing nice things, so when I was talking about the JID just now you'll see</span> <span data-start="756.67" data-end="765.88">that I'm connected as lloyd@buddycloud.org, I could ask for a specific resource but didn't.</span> <span data-start="765.88" data-end="772.209">Buddycloud is distributed social network that I work on. You should check it out, it's cool</span> <span data-start="772.209" data-end="773.899">to play with.</span> </p>
<p><span data-start="773.899" data-end="783.69">Okay, so, next thing, I need to draw circle on the screen when I get new connections,</span> <span data-start="783.69" data-end="807.61">What I'm going to do is hash the incoming JID.</span> <span data-start="807.61" data-end="818.029">Do‑Do‑Do.</span> <span data-start="818.029" data-end="832.6">So if I already have it, obviously I don't want to draw again ..</span> <span data-start="832.6" data-end="837.6">otherwise I'm just going to draw myself a nice little circle.</span> <span data-start="837.6" data-end="847.01">I also have some CSS which will handle the circle part.</span> </p>
<p><span data-start="847.01" data-end="866.42">And what I'll do in here as well is I'll draw up an identifier.</span> <span data-start="866.42" data-end="872.02">Okay, and what I'll do then, in order to show you the fact that you are connecting from</span> <span data-start="872.02" data-end="877">different domains, I'll change the border colour of the circle to a hash of the domain</span> <span data-start="877" data-end="882.269">that you're on.</span> <span data-start="882.269" data-end="887.269">Okay.</span> </p>
<p><span data-start="887.269" data-end="920.06">Sorry, I should of got some music for this really, shouldn't I ..</span> <span data-start="920.06" data-end="924.55">and lastly, actually I'll just leave that.</span> <span data-start="924.55" data-end="929.32">Cool, all right, so I have my draw function, next thing I'm going to listen for a chat</span> <span data-start="929.32" data-end="932.269">message, promise you won't be too much longer.</span> <span data-start="932.269" data-end="939.43">socket dot on\h‑‑ actually first of all, I need the tell the server I'm on‑line,</span> <span data-start="939.43" data-end="944.089">I may be connected but I haven't told it when I receive update .</span> <span data-start="944.089" data-end="959.8">Let's say to the server, I'm on‑line. Cool, I'm on‑line and I want to receive updates.</span> <span data-start="959.8" data-end="969.36">Okay, so socket.on XMPP.chat.message, this will pass through a nice message, which is</span> <span data-start="969.36" data-end="973.31">just the content and who sent it to me, so let's go ..</span> <span data-start="973.31" data-end="984.06">First of all we need to draw a circle ..</span> <span data-start="984.06" data-end="992.579">and then we just need to listen to what you've said to me and just shift your circle about,</span> <span data-start="992.579" data-end="1040.709">so if I create the hash again\h‑‑ okay\h‑‑ if we want to go up, we will pick up no, it's</span> <span data-start="1040.709" data-end="1055.94">minus equals and we'll just shift it by ten pixels.</span> <span data-start="1055.94" data-end="1062.71">Cool anyone actually logged into the client? Everyone logged in okay? Yep, cool.</span> <span data-start="1062.71" data-end="1063.71">Okay.</span> <span data-start="1063.71" data-end="1070.27">Up .. down. We'll just add ten Pixels.</span> </p>
<p><span data-start="1070.27" data-end="1091.62">We're going to right where right, head left\h‑‑ now, hopefully, Oooh, look, someone's already</span> <span data-start="1091.62" data-end="1093.67">there.</span> <span data-start="1093.67" data-end="1096.89">If you guys want to start shifting, I'm guessing it's not actually ..</span> <span data-start="1096.89" data-end="1105.77">I'm guessing I've got this wrong .. Okay, in the UK we have a show called Blue Peter</span> <span data-start="1105.77" data-end="1114.53">who if when they build something they always have the line "Here's something we made earlier".</span> <span data-start="1114.53" data-end="1120.77">There we go, that's moving on the screen if all the different servers, it may be a little</span> <span data-start="1120.77" data-end="1126.64">bit of lag because I am connected to a server on the east coast of the US that's connected</span> <span data-start="1126.64" data-end="1132.799">to my XMPP which is in Munich which is then connected to a server somewhere in the world</span> <span data-start="1132.799" data-end="1137.69">depending on which one you guy haves connected to that then connects to the server on the</span> <span data-start="1137.69" data-end="1143.34">east coast of the US then comes back to Berlin to talk to you, it's going a long way.</span> <span data-start="1143.34" data-end="1150.09">But as you can see, that's\h‑‑ throwing things from many different servers, Polish</span> <span data-start="1150.09" data-end="1155.37">servers, British servers, French servers, American servers but they're all talking to</span> <span data-start="1155.37" data-end="1161.84">my server in Munich without any additional code.</span> <span data-start="1161.84" data-end="1178.07">In summary, XMPP is a secure, scalable real‑time messaging system, it's scalable because when</span> <span data-start="1178.07" data-end="1183.821">you get a thousand users, rather\h‑‑ or tens of thousand users, you don't just, you</span> <span data-start="1183.821" data-end="1191.3">know, cluster or get more servers, you just create a new domain, so it's very scalable,</span> <span data-start="1191.3" data-end="1196.22">it's really\h‑‑ it's essentially really easy way to help rebuild a de‑centralized</span> <span data-start="1196.22" data-end="1199.13">web and you get a lot of extras for free.</span> </p>
<p><span data-start="1199.13" data-end="1203.49">Wanted to keep it very light, hope that was okay.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
