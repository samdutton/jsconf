<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>-4p_qLYjUDc</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/-4p_qLYjUDc?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="10.96" data-end="20.5">Thank you. Hello. How is everyone doing? I am I am actually superexcited to be here.</span> <span data-start="20.5" data-end="29.719">But I've also had very little sleep so it might not show through. But, yeah. Thanks</span> <span data-start="29.719" data-end="37.97">for coming. And thanks to JSConf for inviting me and thanks to everyone that has made this</span> <span data-start="37.97" data-end="44.08">event really awesome. It's super great to be here.</span> <span data-start="44.08" data-end="51.149">And I wanted to kind of just take a quick moment to say, like, happy anniversary, tenth</span> <span data-start="51.149" data-end="57.5">year of JSConf. Superexciting, but also a little bit sad since they're gonna take a</span> <span data-start="57.5" data-end="63.84">little break. But let's stay positive and be excited about the tenth year and I'm really</span> <span data-start="63.84" data-end="70.37">excited to see what happens next. There are some amazing people that are involved in this</span> <span data-start="70.37" data-end="76.31">whole effort. So, I look forward to seeing what they bring next. But also, happy birthday</span> <span data-start="76.31" data-end="85.299">to Node. I don't know if everyone knows that this is ten years of Node. Whoo!</span> <span data-start="85.299" data-end="95.24">[ Applause ] Ryan introduced Node here at JSConf in 2009.</span> </p>
<p><span data-start="95.24" data-end="105.13">Shoutout to Jenn Shiffer, 2009. Happy belated birthday from I/O JS. I couldn't find the</span> <span data-start="105.13" data-end="111.43">Node.js Tweet that said happy birthday, so I went with this one. I'm here to talk to</span> <span data-start="111.43" data-end="119.579">you about promises in Node Core. The Core APIs in Node and what state they are in terms</span> <span data-start="119.579" data-end="128.009">of being promisified. And I want to start with a little disclaim. I will try to make</span> <span data-start="128.009" data-end="133.78">as few puns as possible. I'm going for zero. And technically I don't think this is a pun.</span> </p>
<p><span data-start="133.78" data-end="143.75">And if you are keeping track, mark of zero. I'm Joe Sepi. My little Twitter handle's down</span> <span data-start="143.75" data-end="150">there. You can barely see it. But if you search, you'll find me. I'm an open source engineer.</span> <span data-start="150" data-end="157.72">I have the great fortune of being paid to work on open source exclusively pretty much.</span> <span data-start="157.72" data-end="163.86">And technically and in the community and as a part of the Foundation. Why does my phone</span> <span data-start="163.86" data-end="168.77">keep buzzing? I told them, leave me alone. Okay. It's not doing it. Anyway.</span> <span data-start="168.77" data-end="176.25">So, I'm superfortunate and it's great. I love it. I work if a lovely company called IBM.</span> </p>
<p><span data-start="176.25" data-end="183.29">We make typewriters and we have we have a cloud. But it's really just someone else's</span> <span data-start="183.29" data-end="191.48">computer. So, don't be fooled. Not to be confused with how so, you know, IBM. This is my lovely</span> <span data-start="191.48" data-end="196.05">family. [ Laughter ]</span> <span data-start="196.05" data-end="201.39">This is also my lovely family. This is what I do in my spare time. That's Pat and Stella,</span> <span data-start="201.39" data-end="207.56">and this is what I really enjoy doing. I play in another band, that's also Stella in the</span> <span data-start="207.56" data-end="213.81">background. That's me up there as well in the back. And I occasionally play in a Misfits</span> <span data-start="213.81" data-end="220.91">cover band. So, funny story. All of this was to lead up to, you know, karaoke tonight.</span> <span data-start="220.91" data-end="225.7">But then I realized that was my talk is after official karaoke.</span> <span data-start="225.7" data-end="232.01">However, I am always open for karaoke. So, if anyone wants to go, I'm here all week for</span> <span data-start="232.01" data-end="240.84">the TC39 meetings. Ping me. My DMs are open, let's go do karaoke. Okay. Cool. So, I digress.</span> </p>
<p><span data-start="240.84" data-end="244.81">Which I do often if you know me. I wanted to just quickly share a little bit</span> <span data-start="244.81" data-end="252.88">of personal context around Promises. I've worked at a company called The New York Times</span> <span data-start="252.88" data-end="258.28">a few years ago. And pretty much everywhere I've worked for the last I think almost every</span> <span data-start="258.28" data-end="264.949">job I've ever had I've done some form of developer advocacy formally or informally.</span> </p>
<p><span data-start="264.949" data-end="274.11">And I started this weekly JavaScript thing. Which I managed to do every single week. Largely</span> <span data-start="274.11" data-end="280.009">sourced by internal folks. Luckily at the Times we had so many great people like Jeremy</span> <span data-start="280.009" data-end="288.58">and David Nolan and Mike and lots of great people. But occasionally I would have some</span> <span data-start="288.58" data-end="296.93">outside folks come in and talk to us about cool stuff. So, this is in like 2012? 2013?</span> <span data-start="296.93" data-end="305.37">Tom Hughes came in, Rebecca Murphey. Spike came by and my old friend Dominik was there</span> <span data-start="305.37" data-end="315.08">too. So, Tom talked about sockets and streams in Node. What's the date on this again? Yeah,</span> <span data-start="315.08" data-end="320.57">2012. And so, I mean, Node was around for a few years. It was still pretty new, pretty</span> <span data-start="320.57" data-end="326.949">exciting. And the hockey stick had not really happened yet. Rebecca came and we had kind</span> <span data-start="326.949" data-end="331.349">of an informal discussion, you know, a group discussion. This was one of the things she</span> <span data-start="331.349" data-end="336.31">talked about. Shoutout to yayQuery. I mean, does anyone</span> <span data-start="336.31" data-end="344.28">know yayQuery? All right? Do some research. It's fantastic. Anyway. Spike came and talked</span> <span data-start="344.28" data-end="348.33">to us about Render which was this really cool isomorphic framework where you could bring</span> <span data-start="348.33" data-end="355.46">backbone app that would be frontend and backend with the same code. It was kind of revolutionary</span> <span data-start="355.46" data-end="361.009">at the same time. It was really cool. And Dominik came in to talk to us about this little</span> <span data-start="361.009" data-end="367.24">spec he was working on. And at the time there were a few libraries</span> <span data-start="367.24" data-end="373.759">that were implementing Promises. But everybody kind of had their own flavor. And so, Dominik</span> <span data-start="373.759" data-end="380.21">was working on, you know, developing a spec that would be something that the language</span> <span data-start="380.21" data-end="385.659">could implement. And fortunately, Dominik continues to be amazing work in the spec space.</span> </p>
<p><span data-start="385.659" data-end="391.22">Thank you, Dominik. It was also a great opportunity for me to say that wrote for the "New York</span> <span data-start="391.22" data-end="399.15">Times," which is pretty cool. I talked about callback hell in JavaScripts. And how we're</span> <span data-start="399.15" data-end="405.789">working on it using, you know, the Promises async flow.</span> <span data-start="405.789" data-end="410.48">And this looks bad, but it's not actually that bad. It's fairly linear. But when you're</span> <span data-start="410.48" data-end="416.21">nesting asynchronous flow in a variety of ways, they can get really, really, really</span> <span data-start="416.21" data-end="421.86">painful and hard to debug. And, you know, I think it was one of the quiz questions last</span> <span data-start="421.86" data-end="426.99">night, you know? Which of these async functions are gonna end first? If I'm not mistaken,</span> <span data-start="426.99" data-end="432.61">almost everyone got it wrong. Then I went to work for a company called Behance</span> <span data-start="432.61" data-end="438.59">which was a lot of fun. And there were really smart people there. And everything we did</span> <span data-start="438.59" data-end="443.71">there was kind of Promisebased and it kind of blew my mind for a few weeks or months.</span> <span data-start="443.71" data-end="452.069">But once I got a hang of it, writing almost all my code using Promises, it was just a</span> <span data-start="452.069" data-end="460.99">fantastic way to control your async flow. And you may know that Ryan was here last year</span> <span data-start="460.99" data-end="467.13">talking about regrets in Node. And one of the key things he talked about</span> <span data-start="467.13" data-end="474.31">was not sticking with Promises. And granted, this is really early on, 2009 to 2010. He</span> <span data-start="474.31" data-end="482.969">removed them in February. And as he says in the talk, you know, maybe it's okay that they</span> <span data-start="482.969" data-end="489.09">didn't remain in Promises. Because not having the implementation in there allowed the community</span> <span data-start="489.09" data-end="494">to kind of work through what might be the best implementation. There were a variety</span> <span data-start="494" data-end="502.839">of libraries like I said before, Q and R is SVP doing their own implementations of promises.</span> </p>
<p><span data-start="502.839" data-end="507.66">And it allowed the community to find the right abstraction and we could go from there. It's</span> <span data-start="507.66" data-end="514.49">a good model that I think we've used time and again in JavaScript.</span> <span data-start="514.49" data-end="522.93">But as he said, Node's many async APIs are aging pretty badly. And this is definitely</span> <span data-start="522.93" data-end="529.23">a pain point in writing Node which has a lot of callbackbased APIs, obviously. Async is</span> <span data-start="529.23" data-end="534.15">at the core. So, one tip, if you are really trying to get</span> <span data-start="534.15" data-end="540.25">your talk accepted at a conference is to reference one of the organizers in your talk proposal.</span> <span data-start="540.25" data-end="545.95">I don't know if it worked or not, but I'm here in front of you now. So, one of those</span> <span data-start="545.95" data-end="555.31">references is to this Tweet. And it really was kind much funny, but sad. LOL at Node.js</span> <span data-start="555.31" data-end="560.81">Core modules for still using the callback pattern. This is in November. And I have this</span> <span data-start="560.81" data-end="566.58">bad habit of maybe it's a good habit, actually of finding something interesting that I would</span> <span data-start="566.58" data-end="572.12">like to hear a talk about and submitting it. Whether I know a lot about it or not. But</span> <span data-start="572.12" data-end="577.28">this was really interesting to me and so I submitted a talk about how, you know, where</span> <span data-start="577.28" data-end="583.25">we are and where we're trying to get to. And how you may be able to help. And fortunately</span> <span data-start="583.25" data-end="590.41">for me, it got accepted. Here we are. So, one of the responses is Myles who is superactive</span> <span data-start="590.41" data-end="597.45">in the Node space, in a variety of spaces. I love Myles. And he shares with us that the</span> </p>
<p><span data-start="597.45" data-end="606.66">FS API already has an experimental promise implementation. And this is one of the problems.</span> <span data-start="606.66" data-end="613.9">It's not maybe the prettiest because we needed to figure out how to namespace, essentially,</span> <span data-start="613.9" data-end="618.97">Promise implementations of APIs. But he points this out and people are pretty excited about</span> <span data-start="618.97" data-end="624.32">it. And he shares that, you know, unfortunately there are only two that were implemented at</span> <span data-start="624.32" data-end="631.391">the time in late November. And it's FS and DNS and they're experimental. Now, there are</span> <span data-start="631.391" data-end="636.25">some puns on these slides. But I did not make them. So, I don't I still don't think they</span> <span data-start="636.25" data-end="644.08">count. Keep it zero, Donny. And then it was also pointed out that there's a utility in</span> <span data-start="644.08" data-end="654.12">the framework that you can basically wrap any callbackbased Node API using util.promisify.</span> <span data-start="654.12" data-end="663.08">As stated there, it's still a little bit horrible. But it gets somewhere. Why was it taken out</span> <span data-start="663.08" data-end="671.47">and then has not been just like brought back into Node? And this was something Matteo said</span> <span data-start="671.47" data-end="677.62">to me a couple of days ago at the Open JS Collaborator Summit which happened just before</span> <span data-start="677.62" data-end="683.11">JSConf. Is that it's an insanely hard problem that's been there forever. And that we've</span> <span data-start="683.11" data-end="689.35">never really been able to find a great way to solve and find consensus on what the implementation</span> <span data-start="689.35" data-end="694.72">is. For a variety of reasons. So, the big problem is that Promises were</span> <span data-start="694.72" data-end="701.7">primarily designed for browsers. And so, if you have, you know, something go wrong in</span> <span data-start="701.7" data-end="707.75">your promise in a browser for a user, you're only affecting one user, you know, one tab.</span> </p>
<p><span data-start="707.75" data-end="714.45">They might not even notice. They may think why is my Facebook reply not showing up or</span> <span data-start="714.45" data-end="718.82">something? And they view the console, they may see some sort of error. But it probably</span> <span data-start="718.82" data-end="723.17">doesn't even affect them that much in most cases.</span> <span data-start="723.17" data-end="728.52">But if something happens on the server, it could bring the whole server down. It likely</span> <span data-start="728.52" data-end="735.85">will. And that affects obviously way more than one user, right? So, this is one of the</span> <span data-start="735.85" data-end="742.24">big problems, the challenges that we face with Promises in Node Core. And here is an</span> <span data-start="742.24" data-end="748.48">example. So, we had a session at the collab summit on this very topic and we kind of worked</span> <span data-start="748.48" data-end="758.31">through some of these things as a group. And this is pretty basic pseudo code. But</span> <span data-start="758.31" data-end="765.28">the sum function call will anything, you know, beyond that resolve will essentially get swallowed.</span> </p>
<p><span data-start="765.28" data-end="772.13">And so, you could have code like this in and bunch of code after that, but if your promises</span> <span data-start="772.13" data-end="777.451">resolved, all of that code is essentially it's run. But if you have any errors, you</span> <span data-start="777.451" data-end="782.381">have very little I think no way of actually seeing what's going on there. Your app may</span> <span data-start="782.381" data-end="791.05">come down. You may have all sorts of problems. But you may never know that that's the issue.</span> <span data-start="791.05" data-end="798.5">And then this is another example. Essentially if you have a promise that never resolves</span> <span data-start="798.5" data-end="804.44">and the event loop finishes all of the things that it needs to do, you just have this promise</span> <span data-start="804.44" data-end="809.45">kind of hanging out out there, you don't really know that that's there because it never resolves</span> <span data-start="809.45" data-end="817.01">and it's sort of invisible as well. So, essentially this is all a debugging nightmare,</span> <span data-start="817.01" data-end="826.251">right? But the great news is that there has been progress. And things are happening. There's</span> <span data-start="826.251" data-end="834.27">a zero cost async stack traces were shipped not that long ago. And so, that can help us</span> <span data-start="834.27" data-end="840.56">get some insight into some of these issues. But here's another big one reason, right?</span> <span data-start="840.56" data-end="848.42">So, how do you promise event emitters that don't resolve once? They may have multiple</span> <span data-start="848.42" data-end="856.99">events coming back, right? So, what do we do there? Well, the and, you know, as I said</span> <span data-start="856.99" data-end="862.51">there are multiple responses. The tricky part too is that some of the key things that the</span> <span data-start="862.51" data-end="868.78">core APIs use event emitter under the hood, right? So, this is a daunting problem.</span> </p>
<p><span data-start="868.78" data-end="877.39">Well, the good news is, events.once, that one's kind of easy to solve. And I can't remember</span> <span data-start="877.39" data-end="886.61">if there's a PR. It may have already landed in Core. But events.on needs an async iterator.</span> <span data-start="886.61" data-end="895.02">This talk has been evolving minutebyminute, hourbyhour. We had the collab summit Thursday</span> <span data-start="895.02" data-end="900.76">and Friday of last week and this Tweet came through yesterday morning.</span> <span data-start="900.76" data-end="906.55">So, I'm like continually updating these slides. And they're also my talk notes. So, if they</span> <span data-start="906.55" data-end="912.58">come up and I haven't actually implemented a slide, don't blame me. I'm working on it.</span> <span data-start="912.58" data-end="921.51">But the great news is, there's a PR open by Matteo to implement async iterator for the</span> <span data-start="921.51" data-end="928.94">event emitter. So, stuff is happening. It's really, really exciting.</span> </p>
<p><span data-start="928.94" data-end="935.59">Sometimes this is thrown up as a bit of a road block. And, you know, obviously we do</span> <span data-start="935.59" data-end="941.2">need to be considering performance and the implementations that we're making. But I think</span> <span data-start="941.2" data-end="948.38">we need to make sure we balance them between the developer experience and delivering on</span> <span data-start="948.38" data-end="956.05">what is, you know, a modern interface for a modern platform, right?</span> <span data-start="956.05" data-end="961.74">So, like I'm kind of getting at, the good news is that things are getting better and</span> <span data-start="961.74" data-end="973.23">progress is being made on a very ongoing basis. Some APIs are already done. As I mentioned,</span> <span data-start="973.23" data-end="980.26">F S and DNS, events.once. There are a few others that are already implemented. Some</span> <span data-start="980.26" data-end="986.25">PRs are open like the one we just looked at for a second there. I have one I'm going to</span> <span data-start="986.25" data-end="993.8">open over the next few days that's around crypto. So, things things are definitely happening.</span> <span data-start="993.8" data-end="1000.49">And other development is in progress. And when I say that, I mean, this is from November</span> <span data-start="1000.49" data-end="1010.76">of that Tweet about lol at Node Core to now, there has been a real swell of activity.</span> <span data-start="1010.76" data-end="1017.9">And especially with the Summit session that we had. Like the people are focused on this</span> <span data-start="1017.9" data-end="1022.44">when we asked for volunteers. There were, you know, six or seven people that raised</span> <span data-start="1022.44" data-end="1027.28">their hands. And I'm trying to think about this too from like a something of a project</span> <span data-start="1027.28" data-end="1034.23">management standpoint and helping list out the APIs, see what state they're in. I'll</span> <span data-start="1034.23" data-end="1041.669">be opening some issues soon to catalog what APIs still need to be done. And we can start</span> <span data-start="1041.669" data-end="1045.539">to really track this effort in a holistic fashion.</span> </p>
<p><span data-start="1045.539" data-end="1052.769">So, we try to do everything in Node out in the open. You know, through issues and comments</span> <span data-start="1052.769" data-end="1059.73">and PRs and such. And so, this is an issue in the Summit repo for the recent Berlin Summit.</span> <span data-start="1059.73" data-end="1066.45">And so, as you can see here, one of the topics that we talked about was unhandled rejections.</span> <span data-start="1066.45" data-end="1072.44">So, when like I showed earlier, if you resolve your promise and you have a bunch of other</span> <span data-start="1072.44" data-end="1078.419">stuff happen and you get exceptions, how can we handle that and surface these errors so</span> <span data-start="1078.419" data-end="1082.49">that you know where they're coming from? We have a survey that we're working through,</span> <span data-start="1082.49" data-end="1088.669">if people are interested in. We're also if I were able to scroll down on the screenshot,</span> <span data-start="1088.669" data-end="1092.789">there's a link to user feedback survey that's I have been trying to get over the finish</span> <span data-start="1092.789" data-end="1097.669">line that would be more for end users, what their experiences are, how they're managing</span> <span data-start="1097.669" data-end="1103.87">promises and give us some more insight into what we may want to be considering in further</span> <span data-start="1103.87" data-end="1107.47">development here. And then that bottom link there is the list</span> <span data-start="1107.47" data-end="1111.97">of all the APIs and some notes on the current state of things.</span> </p>
<p><span data-start="1111.97" data-end="1120.11">So, as mentioned, there's a survey, primarily focused for implementers as to what we think</span> <span data-start="1120.11" data-end="1127.33">would be the best way to handle these rejections. This is that list of the APIs that I mentioned.</span> <span data-start="1127.33" data-end="1132.669">There are only 50 of them. And a bunch of them are not relevant. Some of them are already</span> <span data-start="1132.669" data-end="1138.03">done. But, you know, we're trying to get a real handle on the overall effort. But like</span> <span data-start="1138.03" data-end="1143.97">I said, the ground swell within the project is real. People are focused on this. It's</span> <span data-start="1143.97" data-end="1151.009">taken a little bit of time to get there. There are PRs open and there's work being done and</span> <span data-start="1151.009" data-end="1156.77">it's actually kind of exciting to think we may have some more modern interfaces for those</span> <span data-start="1156.77" data-end="1163.499">Core APIs. The kind of call to action here too is if you are at all interested, we always</span> <span data-start="1163.499" data-end="1167.86">welcome people to get involved. I know sometimes working on Node Core can</span> <span data-start="1167.86" data-end="1173.34">be a little daunting. But it's not that bad. You should talk to the folks involved, Joyee,</span> </p>
<p><span data-start="1173.34" data-end="1183.889">Fedor, any of the folks involved would be happy to share with you. It is a strategic</span> <span data-start="1183.889" data-end="1192.309">initiative for the technical steering committee, the TSE. Matteo is the champion. I'm trying</span> <span data-start="1192.309" data-end="1200.19">to help along with Ruben to Ruben Bridgewater to spearhead these things. Myles is doing</span> <span data-start="1200.19" data-end="1205.309">work. Everybody is doing work on these things. Benjamin is involved. A lot of people are</span> <span data-start="1205.309" data-end="1210.87">focused on this now. This is exciting. This is one of those slides that I should</span> <span data-start="1210.87" data-end="1218.309">have updated, but I haven't filed that initial PR. Once I did, there would be next to Matteo's</span> <span data-start="1218.309" data-end="1229.299">name a link to catalog where we are. And I promise you that we will resolve this problem.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
