<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Y1pCVajebpE</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/Y1pCVajebpE?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="9.38" data-end="13.29">so I'm a tranny i founded a company</span> <span data-start="13.29" data-end="15.059">called boxer we did this voice messaging</span> <span data-start="15.059" data-end="16.41">thing we had all know it on the back end</span> <span data-start="16.41" data-end="19.859">a lot of people may know me from doing</span> <span data-start="19.859" data-end="22.56">no dradis a lot of people using node</span> <span data-start="22.56" data-end="27.57">Vettes yay redis a ton of people have</span> <span data-start="27.57" data-end="30.06">talked to me in the last few days at</span> <span data-start="30.06" data-end="32.759">jazz camp here in no comp about node</span> <span data-start="32.759" data-end="35.13">Redis and it really reminds me like how</span> <span data-start="35.13" data-end="37.2">many contributions I got to help make</span> <span data-start="37.2" data-end="39.6">that work and like ton of people are</span> <span data-start="39.6" data-end="41.55">using an introduction and like we fixed</span> <span data-start="41.55" data-end="44.61">like a ton of bugs it wasn't just me who</span> <span data-start="44.61" data-end="47.52">made that thing like a whole lot of you</span> <span data-start="47.52" data-end="50.01">helped contribute so I just want to say</span> <span data-start="50.01" data-end="51.629">thanks for everybody who like try that</span> <span data-start="51.629" data-end="53.67">out and like you know pointed out bugs</span> <span data-start="53.67" data-end="55.59">and like gave it a shot because like I</span> <span data-start="55.59" data-end="57.48">think now we have we have a pretty good</span> </p>
<p><span data-start="57.48" data-end="60.27">Redis library it's like such a good fit</span> <span data-start="60.27" data-end="62.76">with node anyway just wanted to put that</span> <span data-start="62.76" data-end="64.799">out there thanks for the community and</span> <span data-start="64.799" data-end="68.369">support on on the rightest thing anyway</span> <span data-start="68.369" data-end="70.59">so I supposed to talk about a node</span> <span data-start="70.59" data-end="72.39">performance I've done some work with the</span> <span data-start="72.39" data-end="73.89">VA profile or and stuff like that and</span> <span data-start="73.89" data-end="76.799">found some interesting things but in in</span> <span data-start="76.799" data-end="80.25">the last few weeks I ran into some I</span> <span data-start="80.25" data-end="82.619">think even more interesting things as</span> <span data-start="82.619" data-end="84.54">voxer started to get more popular we</span> <span data-start="84.54" data-end="86.88">started adding more more capacity to our</span> <span data-start="86.88" data-end="88.74">system we're running all note on the</span> <span data-start="88.74" data-end="91.35">back end and it's it's raised a bunch of</span> <span data-start="91.35" data-end="93.18">kind of interesting issues that I wanted</span> <span data-start="93.18" data-end="97.29">to talk about and so before it before I</span> <span data-start="97.29" data-end="99.15">do that like just backing up a little</span> <span data-start="99.15" data-end="101.67">bit like we've always said like they've</span> <span data-start="101.67" data-end="102.6">been some things we've been saying about</span> <span data-start="102.6" data-end="105.899">node since like forever ago and I think</span> </p>
<p><span data-start="105.899" data-end="107.61">I think nodes been been kind of living</span> <span data-start="107.61" data-end="110.189">up to its initial promise like it works</span> <span data-start="110.189" data-end="111.57">it has very good performance on like a</span> <span data-start="111.57" data-end="115.17">single CPU core it's it it works really</span> <span data-start="115.17" data-end="117.09">well that way it's it's very inexpensive</span> <span data-start="117.09" data-end="119.009">to hold open a lot of network</span> <span data-start="119.009" data-end="121.53">connections and you get to write your</span> <span data-start="121.53" data-end="123.21">programs in JavaScript so it's like</span> <span data-start="123.21" data-end="125.46">those are like the key the key sort of</span> <span data-start="125.46" data-end="127.56">like tenets of like why note is good in</span> <span data-start="127.56" data-end="130.229">my opinion and and I think we've we've</span> <span data-start="130.229" data-end="132.51">done a pretty good job at that like it</span> <span data-start="132.51" data-end="133.77">really does deliver on all</span> <span data-start="133.77" data-end="135.96">those three things but there's always</span> <span data-start="135.96" data-end="137.85">the this sort of you know nagging</span> <span data-start="137.85" data-end="139.59">questions the the the people who are new</span> <span data-start="139.59" data-end="142.38">to note are like well geez what about</span> <span data-start="142.38" data-end="144.87">all my other cpus I mean isn't all like</span> <span data-start="144.87" data-end="146.79">modern software multi-threaded like I</span> <span data-start="146.79" data-end="148.32">have Java and like that does lots of</span> <span data-start="148.32" data-end="150.9">threads and surely in this era of</span> <span data-start="150.9" data-end="153.36">multi-core computing like you have a</span> <span data-start="153.36" data-end="156.15">good way of using more than one cpu core</span> </p>
<p><span data-start="156.15" data-end="159.66">I mean obviously and you know we</span> <span data-start="159.66" data-end="161.42">probably did ourselves a disservice a</span> <span data-start="161.42" data-end="165.15">lot of times in when descriptions of</span> <span data-start="165.15" data-end="167.04">node we would say oh it's more scalable</span> <span data-start="167.04" data-end="169.02">like we would throw this scalable word</span> <span data-start="169.02" data-end="172.85">out and add that was probably a mistake</span> <span data-start="172.85" data-end="176.85">it's at best misleading and at worst</span> <span data-start="176.85" data-end="180.15">totally wrong node doesn't do anything</span> <span data-start="180.15" data-end="183.57">about scalability all it does is those</span> <span data-start="183.57" data-end="185.19">three things it's very good performance</span> <span data-start="185.19" data-end="187.53">on a single CPU core it's easier to hold</span> <span data-start="187.53" data-end="189.42">open a lot of connections and you get to</span> <span data-start="189.42" data-end="191.09">write all your programs in JavaScript so</span> <span data-start="191.09" data-end="194.64">that's cool because you know event loops</span> <span data-start="194.64" data-end="196.8">are good they maximize the efficiency of</span> <span data-start="196.8" data-end="198.66">your resources and what we've always</span> <span data-start="198.66" data-end="200.91">been saying is okay listen if you run</span> <span data-start="200.91" data-end="203.73">out of one cpu like you really you got</span> <span data-start="203.73" data-end="205.62">this amazing benefit of being very</span> <span data-start="205.62" data-end="208.41">efficient on that cpu you're out just</span> <span data-start="208.41" data-end="210.33">get more node processes and they can be</span> <span data-start="210.33" data-end="212.67">on the same computer they can be on a</span> <span data-start="212.67" data-end="214.77">different computer but because we have</span> <span data-start="214.77" data-end="217.47">this amazing networking stack it's</span> <span data-start="217.47" data-end="220.35">really cheap to talk to other node</span> <span data-start="220.35" data-end="222.36">processes so like don't worry about it</span> <span data-start="222.36" data-end="225.03">like just get more node processes and</span> <span data-start="225.03" data-end="228.42">you know stop computing prime numbers in</span> </p>
<p><span data-start="228.42" data-end="232.23">JavaScript and so oh and you know by the</span> <span data-start="232.23" data-end="234.72">way like we've got unix sockets and</span> <span data-start="234.72" data-end="236.52">we'll do this send ft thing so you can</span> <span data-start="236.52" data-end="238.29">move file descriptors around and so fine</span> <span data-start="238.29" data-end="240.3">fine fine like on one computer like</span> <span data-start="240.3" data-end="241.77">we'll make it a little bit easier for</span> <span data-start="241.77" data-end="244.11">you to to sort of get a whole bunch of</span> <span data-start="244.11" data-end="247.41">no processes but still like event you</span> <span data-start="247.41" data-end="249.989">know get more node processes that's</span> <span data-start="249.989" data-end="253.7">that's the way to go unfortunately even</span> <span data-start="253.7" data-end="256.859">debugging a single note process is very</span> <span data-start="256.859" data-end="260.85">hard there are some tools for this there</span> <span data-start="260.85" data-end="262.62">is no to inspector which is super</span> <span data-start="262.62" data-end="264.36">awesome and if you're never using note</span> <span data-start="264.36" data-end="264.85">inspector</span> <span data-start="264.85" data-end="267.28">like write that down go check it out it</span> <span data-start="267.28" data-end="271.33">is awesome it's the the webkit you know</span> <span data-start="271.33" data-end="274">the dev tools you can plug it into note</span> <span data-start="274" data-end="277.87">it's it's super cool but even with a</span> <span data-start="277.87" data-end="279.66">great tool like note inspector like</span> <span data-start="279.66" data-end="282.25">debugging an actual server especially</span> <span data-start="282.25" data-end="284.26">like while it's running sort of</span> </p>
<p><span data-start="284.26" data-end="286.96">Impractical like you can't really sort</span> <span data-start="286.96" data-end="290.08">of step from asynccallback to other</span> <span data-start="290.08" data-end="291.64">asynccallback like you'd like to and</span> <span data-start="291.64" data-end="294.28">frankly if you have to stop it your</span> <span data-start="294.28" data-end="295.84">server stops working and it might not</span> <span data-start="295.84" data-end="299.56">actually be doing the same things if you</span> <span data-start="299.56" data-end="301.78">stopped it you know other people are</span> <span data-start="301.78" data-end="303.07">talking to it you're talking you making</span> <span data-start="303.07" data-end="304.36">outgoing connections those may timeout</span> <span data-start="304.36" data-end="306.88">or different states may be arrived at</span> <span data-start="306.88" data-end="309.55">and pausing a process is not always a</span> <span data-start="309.55" data-end="313.36">viable debugging node so man that's</span> <span data-start="313.36" data-end="317.05">really hard there's also a sort of a</span> <span data-start="317.05" data-end="318.79">command line e version of the same thing</span> <span data-start="318.79" data-end="320.86">in node if you like to do it that way</span> <span data-start="320.86" data-end="322.78">but still the same fundamental problem</span> <span data-start="322.78" data-end="324.76">like if you stop it then your server</span> <span data-start="324.76" data-end="326.56">stops working and that may actually not</span> <span data-start="326.56" data-end="328.12">reproduce the state that you're trying</span> <span data-start="328.12" data-end="330.76">to debug so you can do what most people</span> <span data-start="330.76" data-end="332.47">do which what I do which is you just log</span> <span data-start="332.47" data-end="335.26">a lot you're right all kinds of log</span> <span data-start="335.26" data-end="338.29">statements on on all sorts of things but</span> <span data-start="338.29" data-end="340.39">but remember remember you get all these</span> <span data-start="340.39" data-end="342.07">amazing benefits it's very efficient and</span> <span data-start="342.07" data-end="343.12">liqueur and you get to write it in</span> </p>
<p><span data-start="343.12" data-end="344.89">JavaScript and lots of connections and</span> <span data-start="344.89" data-end="347.19">all that so like don't give up hope like</span> <span data-start="347.19" data-end="349.06">there's a reason that we're all here</span> <span data-start="349.06" data-end="351.91">like it's cool but it's just this</span> <span data-start="351.91" data-end="355.3">debugging is kind of hard it's it's it</span> <span data-start="355.3" data-end="358.36">may be ugly but I mean you know you can</span> <span data-start="358.36" data-end="360.1">sort of you can sort of do it do</span> <span data-start="360.1" data-end="362.1">something with that so anyway like</span> <span data-start="362.1" data-end="364.18">here's what you usually start out with</span> <span data-start="364.18" data-end="366.28">like you start out and you're building</span> <span data-start="366.28" data-end="367.48">your you're building your note app and</span> <span data-start="367.48" data-end="369.28">you've got like you've got like one node</span> <span data-start="369.28" data-end="370.48">process and you know it's probably</span> <span data-start="370.48" data-end="372.07">talking to some kind of database and and</span> <span data-start="372.07" data-end="374.08">you're in this world I just talked about</span> <span data-start="374.08" data-end="375.61">a minute ago where you're like okay okay</span> <span data-start="375.61" data-end="378.49">sometimes it's complicated but like we</span> <span data-start="378.49" data-end="379.69">can figure it out we'll add a bunch of</span> <span data-start="379.69" data-end="382.87">logging and you know will will will</span> <span data-start="382.87" data-end="384.67">solve our bugs that way but then like</span> <span data-start="384.67" data-end="387.07">you you get some more you know you get</span> <span data-start="387.07" data-end="388.69">cluster or you get whatever you know</span> <span data-start="388.69" data-end="390.28">some way of getting a bunch more on</span> <span data-start="390.28" data-end="392.56">nodes on the same on the same machine</span> <span data-start="392.56" data-end="394.81">and then like okay it's getting a little</span> <span data-start="394.81" data-end="396.62">harder but maybe you get more clever law</span> <span data-start="396.62" data-end="397.88">and you figure out some way to filter it</span> <span data-start="397.88" data-end="399.83">down or whatever and and that's pretty</span> <span data-start="399.83" data-end="403.22">cool but then like man somewhere right</span> <span data-start="403.22" data-end="406.19">around here where you're like I guess we</span> <span data-start="406.19" data-end="409.52">need more computers and I got two</span> <span data-start="409.52" data-end="411.59">different kinds of places we're keeping</span> <span data-start="411.59" data-end="413.72">your data you maybe have like a Redis or</span> <span data-start="413.72" data-end="415.34">a memcache if you're someone other than</span> <span data-start="415.34" data-end="418.07">me and then like you know probably want</span> <span data-start="418.07" data-end="419.449">a real database in there too and like</span> <span data-start="419.449" data-end="421.639">jeez like everything's talking to</span> <span data-start="421.639" data-end="424.16">everything and like there are there are</span> <span data-start="424.16" data-end="425.9">multiple different states that things</span> <span data-start="425.9" data-end="427.4">can get into because you have all these</span> <span data-start="427.4" data-end="430.85">moving parts and man it's it's starting</span> <span data-start="430.85" data-end="432.889">to get really complicated now but then</span> <span data-start="432.889" data-end="435.08">like you're successful so like you're</span> <span data-start="435.08" data-end="436.07">getting a lot of traffic and you're</span> <span data-start="436.07" data-end="437.15">starting to have to separate your</span> <span data-start="437.15" data-end="439.789">components and what you know a pool of</span> <span data-start="439.789" data-end="442.22">identical node processes running out</span> <span data-start="442.22" data-end="443.389">three machines behind a single load</span> <span data-start="443.389" data-end="445.669">balancer starts to not cut it in like</span> <span data-start="445.669" data-end="448.91">holy crap now you've got like two steps</span> <span data-start="448.91" data-end="450.199">through two differently you know step</span> <span data-start="450.199" data-end="451.55">through two different load balancers and</span> <span data-start="451.55" data-end="452.75">different parts of your application or</span> <span data-start="452.75" data-end="453.83">running in different clusters all over</span> <span data-start="453.83" data-end="456.56">the place all these things are like yet</span> <span data-start="456.56" data-end="458.81">have this state that accumulates his new</span> <span data-start="458.81" data-end="462.71">traffic comes into it and wow like if</span> <span data-start="462.71" data-end="464.81">you thought debugging like a single node</span> <span data-start="464.81" data-end="468.01">process was hard like try getting like</span> <span data-start="468.01" data-end="471.139">something like this and it is a</span> <span data-start="471.139" data-end="477.26">challenge so as you might imagine so the</span> <span data-start="477.26" data-end="478.58">thing is like you may be thinking</span> <span data-start="478.58" data-end="480.53">yourself well look I'm a responsible</span> <span data-start="480.53" data-end="484.18">adult I have written a ton of tests and</span> </p>
<p><span data-start="484.18" data-end="488.81">I I test all my code and I've got a dev</span> <span data-start="488.81" data-end="490.639">environment you know and I got it I got</span> <span data-start="490.639" data-end="492.8">that all set up and you know and I got a</span> <span data-start="492.8" data-end="495.05">staging environment and I do i do I can</span> <span data-start="495.05" data-end="496.789">do my homework you know like I I read</span> <span data-start="496.789" data-end="498.59">all the best practices and I practice</span> <span data-start="498.59" data-end="501.11">various kinds of something driven</span> <span data-start="501.11" data-end="504.59">development behavior and and what have</span> <span data-start="504.59" data-end="507.38">you and so you your development is I</span> <span data-start="507.38" data-end="509.75">mean you're on it but the thing is like</span> <span data-start="509.75" data-end="513.68">you you can never exactly account for</span> <span data-start="513.68" data-end="515.69">all the differences like sure you may</span> <span data-start="515.69" data-end="518.029">build a dev environment but like are you</span> <span data-start="518.029" data-end="519.74">really going to have as many nodes in</span> <span data-start="519.74" data-end="520.94">your dev environment as you have in</span> <span data-start="520.94" data-end="522.86">production like are you really going to</span> <span data-start="522.86" data-end="525.26">commit that kind of hardware budget to</span> <span data-start="525.26" data-end="527.24">just so you can have the exact same</span> <span data-start="527.24" data-end="529.12">setup in dev I mean</span> <span data-start="529.12" data-end="530.89">not you're probably going to have like</span> <span data-start="530.89" data-end="532.3">one or two computers and you're going to</span> <span data-start="532.3" data-end="534.01">run a smaller version of your of your</span> <span data-start="534.01" data-end="536.35">whole set up there and yeah you meet you</span> <span data-start="536.35" data-end="538.63">may like simulate some load but like</span> <span data-start="538.63" data-end="539.8">you're never going to be able to</span> <span data-start="539.8" data-end="541.93">simulate like a real actual live</span> <span data-start="541.93" data-end="544.3">customer traffic like you'll blast some</span> <span data-start="544.3" data-end="547.15">kind of synthetic pattern of something</span> <span data-start="547.15" data-end="549.04">that seems reasonable and it's probably</span> <span data-start="549.04" data-end="551.83">the best you can do but like it's not</span> <span data-start="551.83" data-end="553.26">what happens when you go into production</span> <span data-start="553.26" data-end="557.38">there there's just no way to recreate</span> <span data-start="557.38" data-end="560.11">all of the conditions that a complicated</span> <span data-start="560.11" data-end="563.71">system like this can get into but we're</span> <span data-start="563.71" data-end="566.89">in a laboratory environment I mean I</span> <span data-start="566.89" data-end="568.3">don't know I guess I shouldn't say no</span> <span data-start="568.3" data-end="571.66">way but it's impractical from a cost</span> <span data-start="571.66" data-end="573.43">standpoint like you're just not going to</span> <span data-start="573.43" data-end="574.87">do it you're going to try it out you're</span> <span data-start="574.87" data-end="575.74">going to write your tests you can do a</span> <span data-start="575.74" data-end="576.79">simple low test and you can be like I</span> <span data-start="576.79" data-end="578.35">get good it seems like it works it works</span> <span data-start="578.35" data-end="580.24">when I try it it works from other people</span> <span data-start="580.24" data-end="582.4">try it throw it out there and see what</span> <span data-start="582.4" data-end="584.95">happens I mean I'm not saying that this</span> <span data-start="584.95" data-end="587.23">is bad i mean what else you gonna do</span> <span data-start="587.23" data-end="589.36">like you don't have time to build this</span> <span data-start="589.36" data-end="593.02">sort of perfect thing so anyway it's not</span> <span data-start="593.02" data-end="596.17">like these issues are unique to note</span> <span data-start="596.17" data-end="598.839">like this is a fundamental issue with</span> <span data-start="598.839" data-end="600.76">horizontal scaling systems in general</span> <span data-start="600.76" data-end="603.82">like you start running processes on</span> <span data-start="603.82" data-end="605.05">different computers that are all trying</span> <span data-start="605.05" data-end="606.49">to do the same thing and you add all</span> <span data-start="606.49" data-end="608.02">these moving parts like it doesn't</span> <span data-start="608.02" data-end="609.31">matter what environment it's written in</span> </p>
<p><span data-start="609.31" data-end="611.08">I mean it's can be Python processes or</span> <span data-start="611.08" data-end="613.42">or whatever like as soon as you start</span> <span data-start="613.42" data-end="614.8">having components on all these different</span> <span data-start="614.8" data-end="617.589">machines like it gets crazy the thing</span> <span data-start="617.589" data-end="619.779">that's I think uniquely note about this</span> <span data-start="619.779" data-end="622.47">is we have a few more moving parts</span> <span data-start="622.47" data-end="624.4">because we can only ever use one</span> <span data-start="624.4" data-end="627.339">processor so it forces you to confront</span> <span data-start="627.339" data-end="631.029">these issues when like maybe sooner than</span> <span data-start="631.029" data-end="633.55">you would need to otherwise I mean at</span> <span data-start="633.55" data-end="634.42">the end of the day it's probably a good</span> <span data-start="634.42" data-end="635.83">idea that we all confront them because</span> <span data-start="635.83" data-end="637.66">you know we all want to go big and have</span> <span data-start="637.66" data-end="641.56">gigantic traffic loads so like you just</span> <span data-start="641.56" data-end="644.83">because of that single CPU like you're</span> <span data-start="644.83" data-end="646.47">gonna have a lot of note instances so</span> <span data-start="646.47" data-end="650.41">this is going to come up and so I also I</span> <span data-start="650.41" data-end="651.73">don't want to give the idea like I'm</span> <span data-start="651.73" data-end="653.11">somehow like the world's expert on</span> <span data-start="653.11" data-end="654.64">building like scalable back-end systems</span> <span data-start="654.64" data-end="657.459">like there are people who have been</span> <span data-start="657.459" data-end="658.66">doing this for a lot longer than I have</span> <span data-start="658.66" data-end="661.66">but I just happen to have fought a</span> <span data-start="661.66" data-end="662.45">battle with this</span> <span data-start="662.45" data-end="665.03">for the past couple of months and so you</span> <span data-start="665.03" data-end="666.92">know much like Xena the warrior princess</span> <span data-start="666.92" data-end="669.5">these ideas are are forged in the heat</span> <span data-start="669.5" data-end="674.63">of battle so I mean uh like I have some</span> <span data-start="674.63" data-end="677.24">suggestions for like a couple of like</span> <span data-start="677.24" data-end="679.64">basic things that you want to do and you</span> <span data-start="679.64" data-end="681.08">know md you talked about these a little</span> <span data-start="681.08" data-end="682.52">bit like you know you want to you want</span> <span data-start="682.52" data-end="683.78">to get some good stats you want to use</span> <span data-start="683.78" data-end="685.7">that use that metrics thing like totally</span> <span data-start="685.7" data-end="687.8">do that log everything that you can</span> <span data-start="687.8" data-end="689.93">afford to log aggregate your logs like</span> <span data-start="689.93" data-end="690.86">you're going to want to do all this</span> <span data-start="690.86" data-end="694.34">stuff but um there's sort of there's</span> <span data-start="694.34" data-end="696.92">there's one aspect of you know building</span> <span data-start="696.92" data-end="699.65">these building a big cluster like this</span> <span data-start="699.65" data-end="701.36">that i don't hear people talking about</span> <span data-start="701.36" data-end="703.67">too much and it's a pretty neat tool and</span> <span data-start="703.67" data-end="706.67">it's something that we get to do we get</span> <span data-start="706.67" data-end="710.15">to do i say because we're doing this in</span> <span data-start="710.15" data-end="712.73">javascript we have a dynamic language</span> <span data-start="712.73" data-end="718.16">that can be fed new code on the fly so</span> <span data-start="718.16" data-end="721.54">like a problem a problem you have is you</span> <span data-start="721.54" data-end="723.89">run into some situation you like them it</span> <span data-start="723.89" data-end="725.57">seems to be weird this weird thing</span> <span data-start="725.57" data-end="727.31">happens like I'm not exactly sure how to</span> <span data-start="727.31" data-end="729.05">reproduce it but let's put some logging</span> <span data-start="729.05" data-end="730.85">around like you know before it happens</span> <span data-start="730.85" data-end="733.13">and after and we'll when it happens</span> <span data-start="733.13" data-end="734.75">again we'll look the logs and we'll see</span> <span data-start="734.75" data-end="735.74">we can figure out like what might have</span> <span data-start="735.74" data-end="737.54">caused that well like in order to do</span> <span data-start="737.54" data-end="739.88">that you have to push new code like you</span> <span data-start="739.88" data-end="742.73">have to add some new JavaScript you know</span> <span data-start="742.73" data-end="744.53">restart your thing you know you'll</span> <span data-start="744.53" data-end="745.97">hopefully have some clever way of doing</span> <span data-start="745.97" data-end="747.95">it so your users don't even notice but</span> <span data-start="747.95" data-end="749.42">still you have to like restart that</span> <span data-start="749.42" data-end="751.43">process and as soon as you restart the</span> <span data-start="751.43" data-end="754.15">process you initialize the state and</span> <span data-start="754.15" data-end="757.37">much of these bugs in my experience that</span> <span data-start="757.37" data-end="759.77">are really hard to track down are a</span> <span data-start="759.77" data-end="762.65">problem of sort of accumulated state in</span> <span data-start="762.65" data-end="764.48">this distributed environment that is</span> <span data-start="764.48" data-end="766.25">really like if you knew how to reproduce</span> <span data-start="766.25" data-end="767.63">it like you just do it on your laptop</span> <span data-start="767.63" data-end="769.85">but like there are problems because you</span> <span data-start="769.85" data-end="771.02">don't know how to reproduce them you</span> <span data-start="771.02" data-end="772.43">don't even know what causes them and</span> <span data-start="772.43" data-end="774.77">you're trying to track them down and so</span> <span data-start="774.77" data-end="776.9">like restarting your process to add</span> <span data-start="776.9" data-end="780.14">logging undoes the thing that caused it</span> <span data-start="780.14" data-end="782.06">in the first place so it kind of sucks</span> <span data-start="782.06" data-end="784.04">to have to just add you know restart to</span> <span data-start="784.04" data-end="786.92">add logging every time so anyway what</span> <span data-start="786.92" data-end="789.23">you can do that's pretty interesting is</span> <span data-start="789.23" data-end="791.27">you can just change your program you can</span> <span data-start="791.27" data-end="793.97">change your program on the fly as it's</span> <span data-start="793.97" data-end="795.68">running without restarting it</span> <span data-start="795.68" data-end="798.22">so I know that that sounds crazy but</span> <span data-start="798.22" data-end="801.11">when it is but I mean it's pretty cool</span> <span data-start="801.11" data-end="804.589">so what you can do is use this thing</span> <span data-start="804.589" data-end="807.05">called the repple that the read eval</span> <span data-start="807.05" data-end="810.85">print loop it's it's a way that you can</span> <span data-start="810.85" data-end="814.13">run more JavaScript on the fly in your</span> <span data-start="814.13" data-end="817.94">server so I've got a example of a server</span> <span data-start="817.94" data-end="824.63">that is modifiable and let me just get</span> <span data-start="824.63" data-end="834.06">that going here why is not that exiting</span> <span data-start="834.07" data-end="842.79">come on macbook there we go</span> <span data-start="842.8" data-end="845.68">now I'm gonna do and Hawkwind on over</span> <span data-start="845.68" data-end="858.83">here I'll cheese time to mirror</span> <span data-start="858.84" data-end="863.87">okay great</span> <span data-start="863.88" data-end="872.02">so let's just say you have a program</span> <span data-start="872.03" data-end="874.47">well that's pretty big I hope you can</span> <span data-start="874.47" data-end="876.45">see that so I wrote this little web</span> <span data-start="876.45" data-end="878.4">server it's this stupid simple example</span> <span data-start="878.4" data-end="880.53">but um it shows you how you can use a</span> <span data-start="880.53" data-end="884.52">rebel to to sort of turn on a feature in</span> <span data-start="884.52" data-end="888.42">a server that is not on all the time but</span> <span data-start="888.42" data-end="889.8">it's sort of sitting there waiting to be</span> <span data-start="889.8" data-end="891.6">turned on and then later you can turn it</span> <span data-start="891.6" data-end="893.49">off so an example of why you might want</span> <span data-start="893.49" data-end="894.81">to do this is you may want to turn on</span> <span data-start="894.81" data-end="897.15">like special tracing if something</span> <span data-start="897.15" data-end="899.19">matches a filter you know like a regular</span> <span data-start="899.19" data-end="901.53">expression of the user you know log all</span> <span data-start="901.53" data-end="903.06">the things that this user does or log</span> <span data-start="903.06" data-end="904.92">all things from this IP address or you</span> <span data-start="904.92" data-end="908.88">know something like that just some thing</span> <span data-start="908.88" data-end="909.99">that you want to do that you don't</span> <span data-start="909.99" data-end="911.52">always want to do but you don't know</span> <span data-start="911.52" data-end="913.89">that you want to do it until it's too</span> <span data-start="913.89" data-end="914.94">late and you would have to reach out the</span> <span data-start="914.94" data-end="916.92">process so so here's a really simple</span> <span data-start="916.92" data-end="919.23">little web server and let me show that</span> <span data-start="919.23" data-end="921.81">in a second but the kind of new new to</span> <span data-start="921.81" data-end="924.63">some people part is this rebel server so</span> <span data-start="924.63" data-end="927.95">this opens it listens on a unix socket</span> <span data-start="927.95" data-end="930.5">which is you know shows up as like a</span> <span data-start="930.5" data-end="933.24">special file in your file system you can</span> <span data-start="933.24" data-end="934.92">connect into it you can use a thing</span> <span data-start="934.92" data-end="937.95">called so cat you can make it a listen</span> <span data-start="937.95" data-end="939.21">on the network socket too if you want</span> <span data-start="939.21" data-end="940.98">but if you do it is a eunuch socket then</span> <span data-start="940.98" data-end="942.51">you're sure that you can only get to it</span> <span data-start="942.51" data-end="943.77">while with access from the local file</span> <span data-start="943.77" data-end="946.32">you know from the local computer so when</span> <span data-start="946.32" data-end="948.15">you you get this rebel started you</span> <span data-start="948.15" data-end="950.16">connect up to it you can just run java</span> <span data-start="950.16" data-end="953.1">script commands and the things that are</span> <span data-start="953.1" data-end="955.14">in your in the scope of this repple you</span> <span data-start="955.14" data-end="956.58">can't have to initialize it with this</span> <span data-start="956.58" data-end="959.28">context thing so I make a little object</span> <span data-start="959.28" data-end="960.75">and you can just sort of hang stuff off</span> <span data-start="960.75" data-end="962.82">it and so we made this little mjr object</span> <span data-start="962.82" data-end="964.65">and we stick it in the context and then</span> <span data-start="964.65" data-end="967.23">from the repple you can see anything</span> <span data-start="967.23" data-end="969.42">that's on smjr object so a little later</span> <span data-start="969.42" data-end="971.18">you know we have this counter and then</span> </p>
<p><span data-start="971.18" data-end="973.95">I've got a little a special handler here</span> <span data-start="973.95" data-end="977.96">called on rack and in the HTTP server</span> <span data-start="977.96" data-end="981.69">let's take a look at that every request</span> <span data-start="981.69" data-end="984.21">that comes in it checks to see if this</span> <span data-start="984.21" data-end="986.85">on rack is set to a function if it is</span> <span data-start="986.85" data-end="989.34">wrap it in a try-catch so you don't blow</span> <span data-start="989.34" data-end="990.87">up your web server if that thing screws</span> <span data-start="990.87" data-end="993.64">up and run it with with</span> <span data-start="993.64" data-end="996.73">a request and response object I just you</span> <span data-start="996.73" data-end="999.37">know super super simple example and so</span> <span data-start="999.37" data-end="1002.31">if we run that let's just kill run that</span> <span data-start="1002.31" data-end="1007.05">a second oh and you probably can't see</span> <span data-start="1007.05" data-end="1012.03">that can you that's too bad about this</span> <span data-start="1012.03" data-end="1024.319">one</span> <span data-start="1024.329" data-end="1033.36">okay oh come on do I have to do this to</span> <span data-start="1033.36" data-end="1038.01">get it to override the colors okay so</span> <span data-start="1038.01" data-end="1039.209">we've got our server here and it's</span> <span data-start="1039.209" data-end="1040.86">waiting for requests and you can sort of</span> <span data-start="1040.86" data-end="1044.819">you can see we hit it like that we get</span> <span data-start="1044.819" data-end="1046.049">this little we get the Scylla Jason</span> <span data-start="1046.049" data-end="1048.84">thing and okay great well you know</span> <span data-start="1048.84" data-end="1051.6">that's that's fine it's been</span> <span data-start="1051.6" data-end="1054.6">incrementing the the counter every time</span> <span data-start="1054.6" data-end="1056.25">we hit the request so we can talk to</span> <span data-start="1056.25" data-end="1059.37">this there's the socket here and this</span> <span data-start="1059.37" data-end="1061.139">little special file here and you can</span> <span data-start="1061.139" data-end="1062.75">talk to it with this thing called so cat</span> <span data-start="1062.75" data-end="1070.59">and so now we can dump that that that</span> <span data-start="1070.59" data-end="1073.19">mjr object we just type it in let's like</span> <span data-start="1073.19" data-end="1076.08">the current value of that has has these</span> <span data-start="1076.08" data-end="1078.029">things on it so you can run you know any</span> </p>
<p><span data-start="1078.029" data-end="1079.26">JavaScript your leg if you haven't</span> <span data-start="1079.26" data-end="1080.94">played with the repple like you totally</span> <span data-start="1080.94" data-end="1083.7">showed its it's amazing but so here we</span> <span data-start="1083.7" data-end="1085.529">can we can actually change one of these</span> <span data-start="1085.529" data-end="1087.21">node processes and like make it do</span> <span data-start="1087.21" data-end="1089.549">something else without taking it down so</span> <span data-start="1089.549" data-end="1093.299">we can set MJ r dot on rec equals MJ r</span> <span data-start="1093.299" data-end="1098.659">dot log wreck and then we have to go</span> <span data-start="1098.659" data-end="1101.37">curl that again so server is still up</span> <span data-start="1101.37" data-end="1104.669">and oh I made it throw an exception just</span> <span data-start="1104.669" data-end="1106.38">to show you that you needed to forgot to</span> <span data-start="1106.38" data-end="1112.799">put that back go back here they put the</span> <span data-start="1112.799" data-end="1114.96">hell yeah it's down here yeah I wanted</span> <span data-start="1114.96" data-end="1116.25">to see I wanted to make sure that if</span> <span data-start="1116.25" data-end="1118.32">that thing through that it wouldn't take</span> <span data-start="1118.32" data-end="1120.029">down the server or get you know screwed</span> <span data-start="1120.029" data-end="1122.88">up in any way so it does all right I</span> <span data-start="1122.88" data-end="1126.12">guess I should have tested that anyway</span> <span data-start="1126.12" data-end="1128.669">now I am actually going to restart the</span> <span data-start="1128.669" data-end="1129.72">server because it has to reread that</span> <span data-start="1129.72" data-end="1132.059">value that with no exception in it</span> <span data-start="1132.059" data-end="1135.69">anymore anyway so you get the idea like</span> <span data-start="1135.69" data-end="1137.639">you can you can modify your running</span> <span data-start="1137.639" data-end="1139.95">server I mean obviously you'd want to do</span> <span data-start="1139.95" data-end="1142.46">this in a more sophisticated way but</span> <span data-start="1142.46" data-end="1146.429">this this repple tool is a it's it's an</span> <span data-start="1146.429" data-end="1148.62">essential way of tracking down these</span> <span data-start="1148.62" data-end="1150.45">these crazy things that have accumulated</span> <span data-start="1150.45" data-end="1152.25">stage because of course you can also</span> <span data-start="1152.25" data-end="1154.23">just start poking around in objects you</span> <span data-start="1154.23" data-end="1155.76">just have to expose them to the repple</span> <span data-start="1155.76" data-end="1157.12">in advance like make</span> <span data-start="1157.12" data-end="1160.03">sure that you expose anything you know</span> <span data-start="1160.03" data-end="1162.43">most of where your app stores things all</span> <span data-start="1162.43" data-end="1163.45">the state you're going to want to look</span> <span data-start="1163.45" data-end="1165.79">at make sure it's exposed to the repple</span> <span data-start="1165.79" data-end="1167.23">because you never know like what you're</span> <span data-start="1167.23" data-end="1169.63">going to need later and you can when</span> <span data-start="1169.63" data-end="1171.1">weird things are happening you can bring</span> <span data-start="1171.1" data-end="1172.84">it up and you can just poke around and</span> <span data-start="1172.84" data-end="1175.09">just see what's going on in there anyway</span> <span data-start="1175.09" data-end="1183.47">that's all I have thanks</span> <span data-start="1183.48" data-end="1193.81">any questions so you got a cluster</span> <span data-start="1193.82" data-end="1197.19">sure something Thanks and something uh</span> <span data-start="1197.19" data-end="1200.16">something bizarre is happening how do</span> <span data-start="1200.16" data-end="1202.8">you on some requests how do you narrow</span> <span data-start="1202.8" data-end="1205.62">it down to one of the one process on one</span> <span data-start="1205.62" data-end="1207.42">machine too many techniques for that</span> <span data-start="1207.42" data-end="1210.45">yeah I mean it sort of depends on how</span> <span data-start="1210.45" data-end="1214.14">you found the problem to begin with I</span> <span data-start="1214.14" data-end="1218.49">mean what what we do is you know we have</span> <span data-start="1218.49" data-end="1222.18">the logs are aggregated and they're all</span> <span data-start="1222.18" data-end="1223.62">kind of stamped with all that</span> <span data-start="1223.62" data-end="1225.51">information so that the way in which you</span> <span data-start="1225.51" data-end="1227.16">would notice that there was a problem</span> <span data-start="1227.16" data-end="1229.59">was someone you know some log line came</span> <span data-start="1229.59" data-end="1230.94">through that's like this is weird and it</span> <span data-start="1230.94" data-end="1234.18">has the ID of the node that generated</span> <span data-start="1234.18" data-end="1237.3">that that bad thing and you can sort of</span> <span data-start="1237.3" data-end="1238.95">i think it's i think it's important by</span> <span data-start="1238.95" data-end="1240">the way when you get your logs</span> <span data-start="1240" data-end="1241.95">aggregated that you can see a unified</span> <span data-start="1241.95" data-end="1244.17">timeline so you have like you know 100</span> <span data-start="1244.17" data-end="1245.91">processes that are all kind of doing</span> <span data-start="1245.91" data-end="1248.82">stuff they'll if they all can feed into</span> <span data-start="1248.82" data-end="1250.92">at least a view you can filter it down</span> <span data-start="1250.92" data-end="1253.11">to a view where it's like node one did</span> <span data-start="1253.11" data-end="1255.09">this then no two did this you know like</span> <span data-start="1255.09" data-end="1257.52">that because almost always there's some</span> <span data-start="1257.52" data-end="1260.37">kind of weird interaction that you that</span> <span data-start="1260.37" data-end="1261.93">the order is actually important you know</span> <span data-start="1261.93" data-end="1264.21">like the timestamp in the node in order</span> <span data-start="1264.21" data-end="1266.52">is it's pretty important I mean I don't</span> <span data-start="1266.52" data-end="1269.76">know did that answer your question over</span> <span data-start="1269.76" data-end="1272.13">here on your right so besides debugging</span> <span data-start="1272.13" data-end="1273.57">a large cluster can you comment a little</span> <span data-start="1273.57" data-end="1277.56">bit about just performance stability and</span> <span data-start="1277.56" data-end="1279.45">what it's like to operate a large node</span> <span data-start="1279.45" data-end="1281.76">cluster I am sorry I can't really hear</span> <span data-start="1281.76" data-end="1283.35">that there's I really wait echo in here</span> <span data-start="1283.35" data-end="1284.88">that's making it hard for me to come can</span> <span data-start="1284.88" data-end="1287.13">you comment a little bit about stability</span> <span data-start="1287.13" data-end="1290.04">and what it's like to operate a large</span> <span data-start="1290.04" data-end="1292.32">node cluster compared to other sask</span> <span data-start="1292.32" data-end="1294.18">ability like what what aspect of</span> <span data-start="1294.18" data-end="1297.24">stability um memory do you find that</span> <span data-start="1297.24" data-end="1299.22">note instances crashed you have to</span> <span data-start="1299.22" data-end="1300.75">restart them periodically that kind of</span> <span data-start="1300.75" data-end="1304.17">thing um yeah that's um that's been</span> <span data-start="1304.17" data-end="1307.83">somewhat of an exciting adventure node</span> <span data-start="1307.83" data-end="1311.52">it generally is really really good but</span> <span data-start="1311.52" data-end="1313.92">it's very new and sometimes you find</span> <span data-start="1313.92" data-end="1317.04">rough edges and you know they're things</span> <span data-start="1317.04" data-end="1319.77">that don't show up under testing that</span> <span data-start="1319.77" data-end="1322.11">only show up with real live production</span> <span data-start="1322.11" data-end="1323">traffic</span> <span data-start="1323" data-end="1327.32">that are weird yeah but I mean generally</span> <span data-start="1327.32" data-end="1329.84">speaking like I'm still very optimistic</span> <span data-start="1329.84" data-end="1333.17">i mean note is very very fast and the</span> <span data-start="1333.17" data-end="1335.77">the programming model i think is is</span> <span data-start="1335.77" data-end="1338.57">worth putting up with sort of these</span> <span data-start="1338.57" data-end="1341.48">rough edges just to get all of that</span> <span data-start="1341.48" data-end="1344.75">other awesome stuff but I mean you know</span> <span data-start="1344.75" data-end="1347.21">generally speaking like it's no more</span> <span data-start="1347.21" data-end="1349.46">buggy than any way of any other way you</span> <span data-start="1349.46" data-end="1351.14">would write some server process like</span> <span data-start="1351.14" data-end="1353.75">writing server processes izzy is</span> <span data-start="1353.75" data-end="1356.39">difficult stuff you don't get to reload</span> <span data-start="1356.39" data-end="1358.22">your you know like a web page can leak</span> <span data-start="1358.22" data-end="1359.93">some memory or whatever but chances are</span> <span data-start="1359.93" data-end="1361.31">you're going to leave that page anyway</span> <span data-start="1361.31" data-end="1363.11">and it all gets cleaned up but a server</span> <span data-start="1363.11" data-end="1364.99">has to run for a long time and so</span> <span data-start="1364.99" data-end="1366.83">managing the resources in a long-running</span> <span data-start="1366.83" data-end="1369.59">process it's a challenge in any language</span> </p>
<p><span data-start="1369.59" data-end="1371.45">I mean I I think note does a pretty good</span> <span data-start="1371.45" data-end="1372.92">job I think javascript is a pretty good</span> <span data-start="1372.92" data-end="1374.87">choice the garbage collection say what</span> <span data-start="1374.87" data-end="1376.61">you will about it but it saves you from</span> <span data-start="1376.61" data-end="1379.55">from a lot of messes in in a</span> <span data-start="1379.55" data-end="1384.97">long-running process all right so um</span> <span data-start="1384.97" data-end="1387.86">we've been using a repeal to debug very</span> <span data-start="1387.86" data-end="1390.14">complex note systems as well and one of</span> <span data-start="1390.14" data-end="1392.42">the very cool tricks that I I found was</span> <span data-start="1392.42" data-end="1395.15">that you can actually make a little bit</span> <span data-start="1395.15" data-end="1397.13">of code that wraps a function and just</span> <span data-start="1397.13" data-end="1399.68">passes it through because all the</span> <span data-start="1399.68" data-end="1401.87">modules are global you can very easily</span> <span data-start="1401.87" data-end="1404.45">target a particular export of a module</span> <span data-start="1404.45" data-end="1407.06">and wrap it in a sort of like event call</span> <span data-start="1407.06" data-end="1408.89">back so then you can hook runtime all</span> <span data-start="1408.89" data-end="1410.3">these functions that you have in your</span> <span data-start="1410.3" data-end="1413.33">note code right which is really cool for</span> <span data-start="1413.33" data-end="1414.77">debugging because then you don't have to</span> <span data-start="1414.77" data-end="1417.08">be so much upfront with your assumptions</span> <span data-start="1417.08" data-end="1418.4">about what you exposed to the repple</span> <span data-start="1418.4" data-end="1420.26">because the module space is global you</span> <span data-start="1420.26" data-end="1423.4">can inspect it yeah yeah yeah I mean</span> <span data-start="1423.4" data-end="1425.6">managing your access to the to the</span> <span data-start="1425.6" data-end="1428.3">repple scope is pretty crucial like like</span> <span data-start="1428.3" data-end="1430.91">somehow you need to get everything in</span> <span data-start="1430.91" data-end="1432.86">there that you're going to need that you</span> <span data-start="1432.86" data-end="1435.68">think you might need later just you know</span> <span data-start="1435.68" data-end="1438.08">simply exposing it in there is nearly no</span> <span data-start="1438.08" data-end="1440.03">overhead but if you don't have a handle</span> <span data-start="1440.03" data-end="1443.36">to it you'll you will be sorry and yeah</span> <span data-start="1443.36" data-end="1444.71">except mean exposing the whole module</span> <span data-start="1444.71" data-end="1448.64">scope like great you get even access to</span> <span data-start="1448.64" data-end="1453.92">even more stuff that way Matt thank you</span> <span data-start="1453.92" data-end="1454.94">very much you're welcome</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
