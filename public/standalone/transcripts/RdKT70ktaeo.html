<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RdKT70ktaeo</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/RdKT70ktaeo?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="1.86" data-end="10.66">Sharing is Caring — Patterns for JavaScript Library Design</span> <span data-start="38.93" data-end="39.93">[Applause] MAGGIE: Hi, everybody.</span> <span data-start="39.93" data-end="40.93">How are you doing today?</span> <span data-start="40.93" data-end="41.93">You are hitting the end of the conference, it's like the tired part, but we are going</span> <span data-start="41.93" data-end="42.93">to be okay.</span> <span data-start="42.93" data-end="45.06">So I'm here to talk to you about API design for JavaScript libraries and how you can do</span> <span data-start="45.06" data-end="51.579">some sharing, so I will say up on the screen are my two kids and the oldest, Dalton, really</span> <span data-start="51.579" data-end="58.35">likes to tell you that caring is sharing when he wants to eat the food on your dinner plate.</span> </p>
<p><span data-start="58.35" data-end="59.861">So who am I?</span> <span data-start="59.861" data-end="67.5">I really think that you need know nothing other than semicolons, tabs, all the code</span> <span data-start="67.5" data-end="71.33">in the slide is semicolons, tabs.</span> <span data-start="71.33" data-end="77.31">In all seriousness I work for Microsoft, I'm a crisis management engineer, so if you are</span> <span data-start="77.31" data-end="83.15">hosted on Azure and your things are not working, I am the person who is on the phone being</span> <span data-start="83.15" data-end="87.94">like: everyone wake up!</span> <span data-start="87.94" data-end="91.601">I am a maintainer of Moment.js, there are two of us here today, I don't know if some</span> <span data-start="91.601" data-end="96.85">of you saw Matt's talk earlier, but I am a maintainer of Moment.js and in addition I</span> <span data-start="96.85" data-end="106.38">am the JS Foundation's representative to TC3 .. 9 and I represent the JS Foundation which</span> <span data-start="106.38" data-end="111.85">is awesome and supports JavaScript projects in the ecosystem.</span> </p>
<p><span data-start="111.85" data-end="120.33">I will tell you, if you have made a JavaScript commit to an open source project we represent</span> <span data-start="120.33" data-end="128.11">you so if you would like representation, we are your representation as an open source</span> <span data-start="128.11" data-end="134.32">committer, and on that note I am the champion of the date re-work proposal that was talked</span> <span data-start="134.32" data-end="139.12">about earlier, so if you are interested in what's happening in JavaScript date, I am</span> <span data-start="139.12" data-end="143.03">working on that, but today that is not what we are talking about.</span> <span data-start="143.03" data-end="145.68">Today what we are talking about is libraries.</span> <span data-start="145.68" data-end="148.09">Is anybody here besides me a library author?</span> <span data-start="148.09" data-end="149.95">Okay, all right.</span> <span data-start="149.95" data-end="154.47">I am going to bring up some libraries and if it's one of yours and I got it wrong, you</span> <span data-start="154.47" data-end="159.21">shout real loud: you got that library wrong, Maggie.</span> <span data-start="159.21" data-end="163.209">So what is a library?</span> <span data-start="163.209" data-end="167.8">There are a lot of definitions for the word library, but what I am going to go with is:</span> <span data-start="167.8" data-end="174.4">a library is a bit of code that's useful when it's packaged up and distributed to other</span> <span data-start="174.4" data-end="175.9">people.</span> <span data-start="175.9" data-end="183.12">This could be internal or external, so there are tons of external libraries that we know</span> <span data-start="183.12" data-end="191.37">about, like LoDash, jQuery, Request and I think everybody in the room nearly knows every</span> <span data-start="191.37" data-end="195.23">one of those, right?</span> </p>
<p><span data-start="195.23" data-end="197.019">Internally there's a tendency to make internal libraries.</span> <span data-start="197.019" data-end="201.83">I know at Microsoft we have millions of internal libraries for the purposes of logging and</span> <span data-start="201.83" data-end="202.83">analytics.</span> <span data-start="202.83" data-end="208.13">Oh my gosh, I add internal libraries to everything for that.</span> <span data-start="208.13" data-end="213.7">For the purpose of this talk I do want to define what is not a library.</span> <span data-start="213.7" data-end="221.409">I am going to say things like Express or Angular or webpack are not libraries for the purpose</span> <span data-start="221.409" data-end="223.069">of this talk.</span> <span data-start="223.069" data-end="228.129">Instead, Express or Angular would be a framework.</span> <span data-start="228.129" data-end="230.91">They do a whole lot more than provide some useful code.</span> <span data-start="230.91" data-end="233.33">They tell you how you should code.</span> <span data-start="233.33" data-end="238.02">Webpack on the other hand would be a full tool suite so I'm not going to consider those</span> <span data-start="238.02" data-end="239.39">things libraries.</span> </p>
<p><span data-start="239.39" data-end="244.98">One other thing I am going to mention about this talk is that I'm going to get out examples</span> <span data-start="244.98" data-end="249.489">of some of the libraries I have listed at the top, and we might think of those libraries</span> <span data-start="249.489" data-end="258.369">as like lame, like it's from 2007, guys, but the bottom line is these libraries have survived</span> <span data-start="258.369" data-end="261.119">a really long time.</span> <span data-start="261.119" data-end="266.21">So we are really into the new hotness in JavaScript but for the purposes of this talk I have stuck</span> <span data-start="266.21" data-end="276.02">to libraries that we are all npm installing several years later because longevity is good.</span> <span data-start="276.02" data-end="279.689">Call me lame, it's okay, I can live with it.</span> <span data-start="279.689" data-end="283.279">So here is what we think a library is like.</span> <span data-start="283.279" data-end="288.9">Whose kids behave like this all the time, like happy and playing?</span> <span data-start="288.9" data-end="294.169">All right, so here is what having a library is actually like.</span> <span data-start="294.169" data-end="296.4">Does anybody have this toy besides me?</span> <span data-start="296.4" data-end="298.259">This is a toy only a grandparent would give you.</span> <span data-start="298.259" data-end="302.71">There's two kids, some buttons and some whipped cream.</span> <span data-start="302.71" data-end="307.02">[Laughter] What is what having a library is like out</span> <span data-start="307.02" data-end="308.5">in the open source space.</span> </p>
<p><span data-start="308.5" data-end="311.469">Like that looked really fun, and then boom.</span> <span data-start="311.469" data-end="317.569">Kept in the open source space it actually looked leek this.</span> <span data-start="317.569" data-end="322.599">Tim Wood, awesome guy, he was like: I'm going to share, I am going to care — and here we</span> <span data-start="322.599" data-end="330.879">are four years later with 2,400 closed issues and 176 open.</span> <span data-start="330.879" data-end="333.43">That's what having a library is like.</span> <span data-start="333.43" data-end="338.879">And your best defence against that is making it well.</span> <span data-start="338.879" data-end="341.259">So what makes a library good?</span> </p>
<p><span data-start="341.259" data-end="342.629">Small size.</span> <span data-start="342.629" data-end="348.86">I never want to hear about it again.</span> <span data-start="348.86" data-end="350.93">Great code!</span> <span data-start="350.93" data-end="352.86">Your users don't use your code.</span> <span data-start="352.86" data-end="357.27">They are never going to look at it.</span> <span data-start="357.27" data-end="364.229">Encourages functional programming practices: it's big right now, isn't it?</span> <span data-start="364.229" data-end="372.58">Wait, wait, this is JavaScript, the amazing mocha .. tool chain that I spent 12 weeks</span> <span data-start="372.58" data-end="376.37">assembling, that made my library good.</span> <span data-start="376.37" data-end="382.53">Guys, ease of use.</span> <span data-start="382.53" data-end="384.5">Ease of use.</span> <span data-start="384.5" data-end="386.979">Nobody wants to learn your library.</span> <span data-start="386.979" data-end="388.169">They won't.</span> <span data-start="388.169" data-end="396.46">Those 2,400 odd GitHub issues, 50% of them are, "I didn't read your documentation".</span> <span data-start="396.46" data-end="399.039">It's okay to make it simple.</span> <span data-start="399.039" data-end="401.61">You don't have to get into fancy patterns.</span> <span data-start="401.61" data-end="404.099">Your users are just going to go: what's partial application?</span> </p>
<p><span data-start="404.099" data-end="412.55">So I am going to break this out into four areas.</span> <span data-start="412.55" data-end="414.379">One: invocation.</span> <span data-start="414.379" data-end="417.18">How do I invoke my library?</span> <span data-start="417.18" data-end="418.919">How do I actually call it?</span> <span data-start="418.919" data-end="420.909">Two, configuration.</span> <span data-start="420.909" data-end="424.979">This is a huge part of any library, it doesn't do what I want it to do unless it changes</span> <span data-start="424.979" data-end="427.18">its configuration this way.</span> </p>
<p><span data-start="427.18" data-end="428.949">Three, defaults.</span> <span data-start="428.949" data-end="431.819">What should the default behaviours of my library be?</span> <span data-start="431.819" data-end="438.959">And finally errors, which are no easy thing to deal with.</span> <span data-start="438.959" data-end="442.619">So invocation.</span> <span data-start="442.619" data-end="447.99">Basically for any library there's two kind of simple ways to invoke it.</span> <span data-start="447.99" data-end="450.69">One is static invocation, right?</span> <span data-start="450.69" data-end="452.869">You just call a function.</span> <span data-start="452.869" data-end="457.759">So here we have two great libraries that I think everyone here has probably touched,</span> <span data-start="457.759" data-end="462.77">a request from Node and this is aesthetic invocation, I want to get Google.com and I</span> <span data-start="462.77" data-end="463.83">get a call back.</span> </p>
<p><span data-start="463.83" data-end="465.21">It's just static.</span> <span data-start="465.21" data-end="473.099">Or good old 27 million downloads a month LoDash, who here hasn't used it — I am asking for</span> <span data-start="473.099" data-end="477.999">filter, and I get back a filtered list.</span> <span data-start="477.999" data-end="479.879">Awesome.</span> <span data-start="479.879" data-end="482.74">Static invocation is a great pattern.</span> <span data-start="482.74" data-end="484.349">I would not shy away from it.</span> <span data-start="484.349" data-end="487.699">For logging libraries this is the way to go.</span> <span data-start="487.699" data-end="491.729">It's easy, you just say dot log, dot error, it's easy for people to figure out, they don't</span> <span data-start="491.729" data-end="495.3">have to think too hard about what's going on so this is my go-to if I want to write</span> <span data-start="495.3" data-end="496.939">a simple library.</span> </p>
<p><span data-start="496.939" data-end="499.719">It has a drawback though.</span> <span data-start="499.719" data-end="503.369">Here is LoDash without using any of the chaining or functional features.</span> <span data-start="503.369" data-end="506.589">If I want to get the sum of some odd numbers doubled.</span> <span data-start="506.589" data-end="513">We are going down — like this almost looks like a Christmas tree but it's not, it's just</span> <span data-start="513" data-end="514.039">LoDash.</span> </p>
<p><span data-start="514.039" data-end="520.519">All right, so when you start getting into this kind of trap with your library then you</span> <span data-start="520.519" data-end="523.49">are probably going to move to doing something like a factory function.</span> <span data-start="523.49" data-end="528.019">Now, many libraries have done really well with the factory function.</span> <span data-start="528.019" data-end="532.8">Up here, I have Q — everybody has used Q, right?</span> <span data-start="532.8" data-end="535.47">Oh yes, it returns promises, doesn't it?</span> <span data-start="535.47" data-end="540.23">Q fundamentally is a library that makes promises, and then you can do what you will with those</span> <span data-start="540.23" data-end="541.23">promises.</span> </p>
<p><span data-start="541.23" data-end="544.97">JQuery, good old ubiquitous jQuery makes jQuery objects.</span> <span data-start="544.97" data-end="549.67">Who learnt that when they first started coding ten years ago?</span> <span data-start="549.67" data-end="551.05">And Moment, my library.</span> <span data-start="551.05" data-end="555.11">By the way, I am going to shred Moment in my examples.</span> <span data-start="555.11" data-end="557.029">I will tell you of my pain.</span> <span data-start="557.029" data-end="560.149">But Moment again is a factory library.</span> <span data-start="560.149" data-end="563.51">You invoke Moment and you get back a Moment object.</span> <span data-start="563.51" data-end="567.95">And these kinds of things allow for some really, really good patterns to happen.</span> <span data-start="567.95" data-end="572.56">A factory function is what's going to allow you to go into a chaining API or at least</span> <span data-start="572.56" data-end="578.54">is one very good way to do that, so here we can see Q, again we are doing F call, which</span> <span data-start="578.54" data-end="583.459">is going to give us a promise back, and then fundamentally we can chain on another promise</span> <span data-start="583.459" data-end="587.4">and chain on another promise because we just keep on getting promises all the way down,</span> <span data-start="587.4" data-end="592.5">so this is a super helpful way to invoke a library, to have it give an object back and</span> <span data-start="592.5" data-end="594.889">then have that give an object back.</span> <span data-start="594.889" data-end="600.31">There are some problems with chaining but on the whole it works well for a lot of people.</span> <span data-start="600.31" data-end="608.449">Here is chaining API, here I'm adding three days to the current time, then going to the</span> <span data-start="608.449" data-end="610.69">start, and then going to a year ago.</span> </p>
<p><span data-start="610.69" data-end="613.8">God knows why I would want to do that but people have.</span> <span data-start="613.8" data-end="620.35">It reads really easy, I'm not questioning where is this invocation in the world, I'm</span> <span data-start="620.35" data-end="622.82">just cruising along.</span> <span data-start="622.82" data-end="628.1">JQuery, again like for all that we like to rip on jQuery for the bad programming practices,</span> <span data-start="628.1" data-end="630.329">man does this get our work done?</span> <span data-start="630.329" data-end="637.24">I still bring in jQuery if I have a static ASVC web page.</span> </p>
<p><span data-start="637.24" data-end="640.329">Why not?</span> <span data-start="640.329" data-end="647.1">So the next set of patterns that I would like to look at are configuration patterns.</span> <span data-start="647.1" data-end="651.959">Almost every library in the world is going to need some form of configuration, and it</span> <span data-start="651.959" data-end="655.81">can get pretty difficult for people to figure out how to do.</span> <span data-start="655.81" data-end="659.689">So we will take a quick look at Moment.</span> <span data-start="659.689" data-end="661.53">This is Moment like circa 2012.</span> <span data-start="661.53" data-end="666.339">It was great.</span> </p>
<p><span data-start="666.339" data-end="670.71">You had a date string and you could either pass it into the Moment constructor and let</span> <span data-start="670.71" data-end="674.81">the Moment constructor deal with it or you could specify a format to make sure that the</span> <span data-start="674.81" data-end="677.399">constructor got the right thing.</span> <span data-start="677.399" data-end="678.79">This is beautiful.</span> <span data-start="678.79" data-end="681.8">This was easy.</span> <span data-start="681.8" data-end="683.75">Moment 2017.</span> <span data-start="683.75" data-end="685.55">Constructor.</span> <span data-start="685.55" data-end="691.139">Here, you can construct with an array, you can construct a Moment from another Moment</span> <span data-start="691.139" data-end="695.319">object that will give you a copy, you can construct a Moment from a date, I guess that</span> <span data-start="695.319" data-end="701.129">makes sense; you can do a date string with a format in the English language or any other</span> <span data-start="701.129" data-end="707.449">language; you can use strict mode which will force you to match the pattern that you are</span> <span data-start="707.449" data-end="713.019">supplying; you could combine language in strict mode, oh, multiple formats, maybe you are</span> <span data-start="713.019" data-end="717.199">expecting four or five formats, I am going to throw an array in there and I still need</span> <span data-start="717.199" data-end="720.74">to support language and strict mode.</span> </p>
<p><span data-start="720.74" data-end="721.74">Whoa!</span> <span data-start="721.74" data-end="725">Like that was intense.</span> <span data-start="725" data-end="730.8">By the way, having this overloaded constructor where your constructor is expecting like a</span> <span data-start="730.8" data-end="737.939">billion options, I think — so Moment uses ES6 modules and I think to actually parse</span> <span data-start="737.939" data-end="745.9">out this constructor it happens in about ten files that are all about 100 lines of code</span> <span data-start="745.9" data-end="751.33">each, just to parse this madness it's like type checking and then what does this actually</span> <span data-start="751.33" data-end="754.949">mean?</span> <span data-start="754.949" data-end="758.1">This isn't that great.</span> <span data-start="758.1" data-end="762.529">I am going to give some credit here to my colleagues on the ECMA402 Committee.</span> </p>
<p><span data-start="762.529" data-end="766.149">They have been putting together the new internationalisation API.</span> <span data-start="766.149" data-end="768.069">Has anybody used those?</span> <span data-start="768.069" data-end="774.829">Oh yeah, the international API so the standards said how are we going to do configuration</span> <span data-start="774.829" data-end="779.829">because localisation takes a heck of a lot of configuration and they came up with this</span> <span data-start="779.829" data-end="784.629">really simple paradigm, and for all that it isn't fancy, I love it.</span> <span data-start="784.629" data-end="788.399">I think it's really going to serve JavaScript's users over time, and it's this.</span> <span data-start="788.399" data-end="792.17">I am going to create a new date time format here.</span> <span data-start="792.17" data-end="794.97">I must know the locale for the format.</span> <span data-start="794.97" data-end="797.61">The locale is required, right?</span> <span data-start="797.61" data-end="801.63">So I put the required parameter here, and then everything else I need to know I put</span> <span data-start="801.63" data-end="802.63">in an options object.</span> <span data-start="802.63" data-end="807.79">Now, this is used the world over, in a million libraries, and it's used because it works.</span> <span data-start="807.79" data-end="813.129">I'm easily specifying hour, minute, second and time zone formats without having a mess</span> <span data-start="813.129" data-end="817.509">in my constructor, without having to chain defaults to the global object.</span> </p>
<p><span data-start="817.509" data-end="819.939">None of that is happening.</span> <span data-start="819.939" data-end="824.98">So options, objects, it seems simple, it seems almost stupid for me to say but they are going</span> <span data-start="824.98" data-end="829.3">to get you a long way in cleaning up constructors like I showed you with Moment.</span> <span data-start="829.3" data-end="834.13">The other thing they do and again good old jQuery, you are beautiful — you really were</span> <span data-start="834.13" data-end="837.519">- is they have simple business logic.</span> <span data-start="837.519" data-end="842.009">If you go into options object less than then say you want the user to be able to define</span> <span data-start="842.009" data-end="847.37">a behaviour in the library you are going to be able to do something like that with this,</span> <span data-start="847.37" data-end="859.279">here we have jQuery AJAX requests and if I want to file a 404 I can parse a custom function.</span> </p>
<p><span data-start="859.279" data-end="860.279">This is beautiful.</span> <span data-start="860.279" data-end="864.36">This is easy for the user.</span> <span data-start="864.36" data-end="870.819">So basically, when it comes to configuration, do required parameters at the beginning of</span> <span data-start="870.819" data-end="874.48">your constructor and then tie the options object to the end.</span> <span data-start="874.48" data-end="878.819">This is going to be the easiest way for anybody to invoke your library.</span> <span data-start="878.819" data-end="880.069">Defaults.</span> <span data-start="880.069" data-end="885.29">Now, defaults are a fascinating topic, and they are difficult to get right.</span> <span data-start="885.29" data-end="887.509">Let's look at this.</span> <span data-start="887.509" data-end="891.809">This is a clean HTTP request with a built in no JS APIs.</span> <span data-start="891.809" data-end="899.95">I assume a lot of people here have done this, the plain no library HTTP request and some</span> <span data-start="899.95" data-end="900.95">interesting stuff is going on.</span> </p>
<p><span data-start="900.95" data-end="908.23">What I want to do here is I want to get the Moment, so I am going to Tim R Wood/Moment,</span> <span data-start="908.23" data-end="916.209">okay, great, I assume I get requests and a few things get crazy here, I actually do like</span> <span data-start="916.209" data-end="925.41">continuous update stream, response body, but I want to call it this, I get a re-direct.</span> <span data-start="925.41" data-end="928.329">301, move permanently.</span> <span data-start="928.329" data-end="933.621">That's absolutely true because Tim moved the Moment repo to the Moment org years ago, but</span> <span data-start="933.621" data-end="939.99">now because I get a re-direct I am going to have to start this whole process again and</span> <span data-start="939.99" data-end="942.42">go look for the re-direct link that I got.</span> <span data-start="942.42" data-end="945.16">That's kind of a pain.</span> <span data-start="945.16" data-end="946.389">Request.</span> <span data-start="946.389" data-end="948.129">Anybody here a Request user?</span> <span data-start="948.129" data-end="953.559">This is a good library, it does a lot of good stuff for us but a big one is it will automatically</span> <span data-start="953.559" data-end="959.899">follow a re-direct so here when I kick off my request for Tim R Wood Moment, I actually</span> <span data-start="959.899" data-end="965.209">get back the repository I wanted with the data about it.</span> <span data-start="965.209" data-end="967.149">It just automatically followed the re-direct.</span> </p>
<p><span data-start="967.149" data-end="972.91">Now, what this is is best by default.</span> <span data-start="972.91" data-end="977.519">When was the last time that you got a re-direct link and didn't want to follow it?</span> <span data-start="977.519" data-end="978.519">Right.</span> <span data-start="978.519" data-end="985.1">I am sure it has happened and I am sure you can configure requests to not re-direct but</span> <span data-start="985.1" data-end="991.279">like seriously, this is like 95% of the time, 99% of the time, you are going to follow the</span> <span data-start="991.279" data-end="997.23">re-direct, so if there's an obvious right best answer like that's like well over 90%</span> <span data-start="997.23" data-end="999.319">case, then do it!</span> <span data-start="999.319" data-end="1000.319">Right?</span> <span data-start="1000.319" data-end="1005.579">But here is a flip side, I am going to go back to Moment, nothing like trashing the</span> <span data-start="1005.579" data-end="1009.25">library that I love so much.</span> <span data-start="1009.25" data-end="1015.98">Here I have Moment and I'm parsing in this date string, let's pan out 1025 and I get</span> <span data-start="1015.98" data-end="1018.199">out 1725.</span> <span data-start="1018.199" data-end="1019.959">Why?</span> <span data-start="1019.959" data-end="1031.78">So here is what is actually going on with Moment.</span> <span data-start="1031.78" data-end="1038">Time is complicated and when I parse in 1025 to the base Moment constructor I get back</span> <span data-start="1038" data-end="1046.19">1725 because it's converting it to local time, minus 5 here, and then I came to Berlin time,</span> <span data-start="1046.19" data-end="1047.19">right?</span> </p>
<p><span data-start="1047.19" data-end="1051.529">If, in fact, I had wanted UTC, I would use the UTC constructor.</span> <span data-start="1051.529" data-end="1055.48">If I had wanted to stay in minus 5 I would use parse zone.</span> <span data-start="1055.48" data-end="1059.23">If I had wanted a different time zone, for instance New York, then I would use the time</span> <span data-start="1059.23" data-end="1062.65">zone constructor.</span> <span data-start="1062.65" data-end="1067.4">There's no good default here.</span> <span data-start="1067.4" data-end="1073.43">Like, honestly, are any of those like the thing that you do all the time, are any of</span> <span data-start="1073.43" data-end="1076.75">those a 95% case?</span> <span data-start="1076.75" data-end="1077.77">No.</span> <span data-start="1077.77" data-end="1085.91">And this single API flaw has caused more support issues in Moment.js than any other thing by</span> <span data-start="1085.91" data-end="1087.74">about three orders of magnitude.</span> <span data-start="1087.74" data-end="1093.07">People are like: why isn't this the day that I thought it was going to be?</span> <span data-start="1093.07" data-end="1103.27">And all they really had to do was this: instead of having that default just Moment paren constructor,</span> <span data-start="1103.27" data-end="1113.299">if we had made people choose and made them say Moment.local, they would have gone, "Oh,</span> <span data-start="1113.299" data-end="1119.9">local time", and it would have saved us I don't know how many hours.</span> </p>
<p><span data-start="1119.9" data-end="1125.93">The next time we ran a major version for me to deprecate the major constructor will be</span> <span data-start="1125.93" data-end="1130.09">all of 30 minutes of work and it is happening.</span> <span data-start="1130.09" data-end="1134.01">We are not living like this anymore.</span> <span data-start="1134.01" data-end="1136.5">Get to update all the docs.</span> <span data-start="1136.5" data-end="1140.08">Then you get to update your code.</span> <span data-start="1140.08" data-end="1143.13">So default only when there is a best answer.</span> </p>
<p><span data-start="1143.13" data-end="1147.09">If there are several likely behaviours, don't lock yourself into the trap of answering support</span> <span data-start="1147.09" data-end="1148.779">requests on all of them.</span> <span data-start="1148.779" data-end="1154.35">So the last thing I want to talk about is errors.</span> <span data-start="1154.35" data-end="1159.76">So errors at one time in JavaScript, we were like in happy fun land, like we are on the</span> <span data-start="1159.76" data-end="1170.26">bus, we will just .. the browser and it will be really great, then we will hit F12 and</span> <span data-start="1170.26" data-end="1172.669">it will be great, then this happens.</span> </p>
<p><span data-start="1172.669" data-end="1175.46">This is directly out of the Node.js docs.</span> <span data-start="1175.46" data-end="1182.059">Exception must be handled or the no process will be handled immediately.</span> <span data-start="1182.059" data-end="1185.31">Who has had this happen?</span> <span data-start="1185.31" data-end="1187.39">Oh yeah.</span> <span data-start="1187.39" data-end="1192.5">So we were like: you are going to use it on a server and then the error is going to happen</span> <span data-start="1192.5" data-end="1194.03">and we are going to crash the server?</span> <span data-start="1194.03" data-end="1195.03">Oh God!</span> <span data-start="1195.03" data-end="1206.85">And  for a long time people got this idea that</span> <span data-start="1206.85" data-end="1208.96">libraries should never throw errors.</span> <span data-start="1208.96" data-end="1214.52">Never throw errors in a library, you will kill things.</span> <span data-start="1214.52" data-end="1219.15">But that's difficult too, so I actually like any good software engineer went to Twitter</span> <span data-start="1219.15" data-end="1224.94">and was like: does Node give any official guidance about this error thing several years</span> <span data-start="1224.94" data-end="1226.13">in?</span> </p>
<p><span data-start="1226.13" data-end="1232.929">And it exploded into a massive Twitter conversation that lasted like four hours.</span> <span data-start="1232.929" data-end="1237.58">And the only thing back I really got from Node is that Miles cares a lot about errors.</span> <span data-start="1237.58" data-end="1244.82">He wanted me to tell you, so Miles cares a lot about errors.</span> <span data-start="1244.82" data-end="1251.98">But the general consensus on the thread can be summed up as: throw an obvious developer</span> <span data-start="1251.98" data-end="1253.07">error.</span> <span data-start="1253.07" data-end="1254.57">So let's break that one down.</span> <span data-start="1254.57" data-end="1259.19">Here is Moment doing actually a pretty good job at its thing.</span> <span data-start="1259.19" data-end="1264.35">This is a date and it's probably user input, and user input is always potentially junk,</span> <span data-start="1264.35" data-end="1265.35">right?</span> <span data-start="1265.35" data-end="1270.779">So we don't want to every time a user enters a date, if that date isn't in the format that</span> <span data-start="1270.779" data-end="1276.47">we want, start exploding Node servers, so instead what happens is we very politely take</span> <span data-start="1276.47" data-end="1283.26">your input and we say: oh, you have tried to format this; invalid date.</span> </p>
<p><span data-start="1283.26" data-end="1286.38">And then maybe your one user with the bad input sees invalid date but at least we haven't</span> <span data-start="1286.38" data-end="1289.38">taken out your Node process.</span> <span data-start="1289.38" data-end="1291.38">So this is done.</span> <span data-start="1291.38" data-end="1293.269">Bad user input doesn't crash.</span> <span data-start="1293.269" data-end="1295.1">But then we have this other thing going on.</span> <span data-start="1295.1" data-end="1302.33">You need to get on Moment to get the hours date part, and this looks great, it gets us</span> <span data-start="1302.33" data-end="1309.91">back 13, and must be some time in the early afternoon that I ran this, but this is weird.</span> <span data-start="1309.91" data-end="1318.019">I misspell hours, I put in hurs, and I get back a Moment object.</span> <span data-start="1318.019" data-end="1327.85">I would completely expect to get a Moment object from that method invocation.</span> <span data-start="1327.85" data-end="1332.49">At the end of the day this wouldn't be deployed onto a server in production.</span> </p>
<p><span data-start="1332.49" data-end="1336.25">This is a developer time error.</span> <span data-start="1336.25" data-end="1339.529">And it's one that's potentially very difficult to find.</span> <span data-start="1339.529" data-end="1342.48">You will go digging through your code and you will be like: where is it?</span> <span data-start="1342.48" data-end="1345.61">Why do I see JSON where I should see a string?</span> <span data-start="1345.61" data-end="1347.13">What the heck?</span> <span data-start="1347.13" data-end="1353.71">And you will get all the way down to the library and you will be like: those people! [Laughter]</span> <span data-start="1353.71" data-end="1356.21">So let's see an example of this actually being really done well.</span> <span data-start="1356.21" data-end="1360.09">Who here — this is immutable, people used Immutable from Facebook?</span> </p>
<p><span data-start="1360.09" data-end="1361.09">Sure.</span> <span data-start="1361.09" data-end="1362.09">Good library.</span> <span data-start="1362.09" data-end="1365.279">What Immutable does is it makes collections.</span> <span data-start="1365.279" data-end="1368.85">Here we are going to make a map and any time we change this map it will make a new map</span> <span data-start="1368.85" data-end="1371.79">and this is this library doing it very well.</span> <span data-start="1371.79" data-end="1378.76">We are making a map, ABC, 123, then we set B and the first map still has 2 and the second</span> <span data-start="1378.76" data-end="1382.429">map has 50 so that's what it does.</span> <span data-start="1382.429" data-end="1384.409">Okay.</span> <span data-start="1384.409" data-end="1386.84">But it does something awesome here.</span> </p>
<p><span data-start="1386.84" data-end="1392.66">When I try to make a map of the number 1, which is like impossible, because like how</span> <span data-start="1392.66" data-end="1400.58">do you map the number 1, it actually tells me: hey, developer, we expected an array or</span> <span data-start="1400.58" data-end="1403.01">an iterable object.</span> <span data-start="1403.01" data-end="1406.71">Could you hand that over?</span> <span data-start="1406.71" data-end="1411.23">[Laughter] This is good.</span> <span data-start="1411.23" data-end="1417.58">When it comes to errors, if it's about the parser user input then you are going to want</span> <span data-start="1417.58" data-end="1424.72">to try to suppress as best you can for Node.js but if you can tell the dead fat finger something,</span> <span data-start="1424.72" data-end="1427.92">help them out and undo the fat finger.</span> <span data-start="1427.92" data-end="1432.96">In conclusion, just make stuff easy to use.</span> <span data-start="1432.96" data-end="1438.299">Don't get fancy, don't spend a lot of time thinking about: oh, what are the functional</span> <span data-start="1438.299" data-end="1443.14">paradigms I can use here and how beautiful can my code be and what tool chain can I have?</span> </p>
<p><span data-start="1443.14" data-end="1450.86">At the end of the day, some have lived for years not for anything other than the fact</span> <span data-start="1450.86" data-end="1454.85">that people picked them up and were able to use them quickly.</span> <span data-start="1454.85" data-end="1460.94">So put your investment as a library author, whether internal or external, right there.</span> <span data-start="1460.94" data-end="1463.049">For invocation, static your factory.</span> <span data-start="1463.049" data-end="1466.1">One of them is going to work out for you.</span> <span data-start="1466.1" data-end="1468.48">Chaining may really enhance your problem domain.</span> <span data-start="1468.48" data-end="1474.45">Objects for configuration, everybody knows them and they really do clean things up.</span> <span data-start="1474.45" data-end="1478.12">Defaults, careful, careful.</span> <span data-start="1478.12" data-end="1484.75">When there is an obvious right answer, then pick that to be your default, but don't pick</span> <span data-start="1484.75" data-end="1487.08">an arbitrary default.</span> </p>
<p><span data-start="1487.08" data-end="1489.95">Do not do it.</span> <span data-start="1489.95" data-end="1495.429">And finally, throw for those obvious developer areas that make it so your users aren't sitting</span> <span data-start="1495.429" data-end="1499.48">there complaining about how you are a horrible person and how they couldn't find this mysterious</span> <span data-start="1499.48" data-end="1501.26">bug in your code.</span> <span data-start="1501.26" data-end="1503.98">After that, just share.</span> <span data-start="1503.98" data-end="1510.71">Get out on GitHub, through your company get people contributing to your library internally</span> <span data-start="1510.71" data-end="1513.59">and be friendly and be open to new ideas.</span> </p>
<p><span data-start="1513.59" data-end="1518.049">All right, well, thanks, everybody.</span> <span data-start="1518.049" data-end="1524.5">I love questions, so .. [Applause] >> Wasn't that fantastic?</span> <span data-start="1524.5" data-end="1530.95">Come on, more rounds of applause, please.</span> <span data-start="1530.95" data-end="1531.95">Woo!</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
