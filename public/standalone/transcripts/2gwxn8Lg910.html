<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>2gwxn8Lg910</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/2gwxn8Lg910?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="9.53" data-end="12.599">so I made a bit of a silly application</span> <span data-start="12.599" data-end="14.94">really and there's a bit of a story</span> <span data-start="14.94" data-end="16.379">behind it and I've got a few practical</span> <span data-start="16.379" data-end="19.259">tips to share that might be useful if</span> <span data-start="19.259" data-end="20.55">you want to squeeze every single</span> <span data-start="20.55" data-end="23.84">millisecond out of your application a</span> <span data-start="23.84" data-end="25.92">couple of years ago I stumbled across</span> <span data-start="25.92" data-end="29.25">Matt Westcott's Jes Becky which was a</span> <span data-start="29.25" data-end="30.81">Sinclair spectrum emulator written in</span> <span data-start="30.81" data-end="33.059">JavaScript and I thought this was</span> <span data-start="33.059" data-end="34.86">awesome but I didn't really know any of</span> <span data-start="34.86" data-end="37.559">the spectrum games so I kind of wanted</span> <span data-start="37.559" data-end="39.23">to recreate it for one of my childhoods</span> <span data-start="39.23" data-end="41.28">consoles which was the Nintendo</span> </p>
<p><span data-start="41.28" data-end="45.239">Entertainment System and this was my</span> <span data-start="45.239" data-end="47.119">first big JavaScript project really</span> <span data-start="47.119" data-end="49.769">before I only done sort of little jQuery</span> <span data-start="49.769" data-end="53.879">hacks and you know done some closure sin</span> <span data-start="53.879" data-end="55.53">where you know I put millions of things</span> <span data-start="55.53" data-end="56.549">in the closures and I didn't really</span> <span data-start="56.549" data-end="58.879">understand how JavaScript really worked</span> <span data-start="58.879" data-end="60.57">but I suppose you've got to start</span> <span data-start="60.57" data-end="65.1">somewhere and I'd know how to make an</span> <span data-start="65.1" data-end="67.77">emulator so I thought I'd find an</span> <span data-start="67.77" data-end="69.63">existing one to pause or to at least get</span> <span data-start="69.63" data-end="72.06">some inspiration from unfortunately most</span> <span data-start="72.06" data-end="74.399">of the existing emulators are written in</span> </p>
<p><span data-start="74.399" data-end="77.31">C and they use loads of sort of pointer</span> <span data-start="77.31" data-end="80.64">magic to map bits of memory around now</span> <span data-start="80.64" data-end="81.89">this could be implemented in JavaScript</span> <span data-start="81.89" data-end="85.409">but it'd be incredibly inefficient so I</span> <span data-start="85.409" data-end="87.509">tried to look around for one that was in</span> <span data-start="87.509" data-end="90.119">a sort of higher level language luck</span> <span data-start="90.119" data-end="91.289">would have it someone had written one</span> <span data-start="91.289" data-end="93.479">and written in SML is written in Java</span> <span data-start="93.479" data-end="96.119">which was called Venus and it's</span> <span data-start="96.119" data-end="99.329">available at virtual maze comm where he</span> <span data-start="99.329" data-end="100.679">has a big library of games and it runs</span> <span data-start="100.679" data-end="105.06">inside the browser as an applet now the</span> <span data-start="105.06" data-end="107.729">nice thing about Java is that well the</span> <span data-start="107.729" data-end="109.859">syntax of Java is actually fairly</span> <span data-start="109.859" data-end="112.259">different but the semantics of the two</span> <span data-start="112.259" data-end="113.909">languages as in what the code actually</span> <span data-start="113.909" data-end="116.1">means is actually remarkably similar</span> <span data-start="116.1" data-end="118.35">and this makes translating Java to</span> </p>
<p><span data-start="118.35" data-end="122.34">JavaScript really straightforward for</span> <span data-start="122.34" data-end="126.53">example this is a class in Java with a</span> <span data-start="126.53" data-end="128.819">constructor function and this is</span> <span data-start="128.819" data-end="129.99">basically the same thing in JavaScript</span> <span data-start="129.99" data-end="132">we've just removed the remove the</span> <span data-start="132" data-end="133.56">constructor function and made it part of</span> <span data-start="133.56" data-end="134.91">the function which if you like is the</span> <span data-start="134.91" data-end="138.27">class this sort of thing which is a</span> <span data-start="138.27" data-end="141.03">class method I basically did this by</span> <span data-start="141.03" data-end="142.42">just writing a regex</span> <span data-start="142.42" data-end="146.11">it's really quite simple breathing as</span> <span data-start="146.11" data-end="155.91">Mike this sort of thing again thank you</span> <span data-start="155.91" data-end="160.03">this sort of thing which is class class</span> <span data-start="160.03" data-end="162.19">properties again it was basically a big</span> <span data-start="162.19" data-end="164.38">regex to go through and replace all the</span> <span data-start="164.38" data-end="166.84">sort of publicans with just VAR sorry</span> <span data-start="166.84" data-end="170.88">this dot because it's on a on a function</span> <span data-start="170.88" data-end="172.93">and there were a couple of semantic</span> <span data-start="172.93" data-end="174.58">differences like this sort of thing</span> <span data-start="174.58" data-end="176.8">where javascript doesn't have inter</span> <span data-start="176.8" data-end="179.17">digital division so you have to</span> <span data-start="179.17" data-end="180.549">explicitly say you wanted an integer</span> <span data-start="180.549" data-end="183.85">because in in java being just typecast</span> <span data-start="183.85" data-end="190.15">it as an integer now on top of this I</span> <span data-start="190.15" data-end="192.34">just had to write the pixel where the</span> <span data-start="192.34" data-end="195.37">pixel buffer to a canvas instead of some</span> </p>
<p><span data-start="195.37" data-end="197.95">Java applet thing and attach a few</span> <span data-start="197.95" data-end="199.84">keyboard events and add a set interval</span> <span data-start="199.84" data-end="203.2">to trigger the frame function sixty</span> <span data-start="203.2" data-end="205.299">times a second and that was pretty much</span> <span data-start="205.299" data-end="206.829">it I mean most of those bits I just</span> <span data-start="206.829" data-end="208.87">borrowed straight off Jess Becky because</span> <span data-start="208.87" data-end="211.78">it's the same kind of thing and within a</span> <span data-start="211.78" data-end="217">few days I had a working emulator now</span> <span data-start="217" data-end="220.93">Jeff spec he ran at full speed but from</span> <span data-start="220.93" data-end="222.37">the start I knew that the Menezes was</span> <span data-start="222.37" data-end="225.489">far more complicated for example the</span> <span data-start="225.489" data-end="226.93">spectrum doesn't have a dedicated</span> <span data-start="226.93" data-end="230.29">graphics chip but they the nez does to</span> <span data-start="230.29" data-end="233.049">generate sprites and stuff so I really</span> <span data-start="233.049" data-end="234.85">had no idea how fast it was going to run</span> <span data-start="234.85" data-end="237.25">and when I was writing it there was no</span> <span data-start="237.25" data-end="239.38">scientific process at all I was just</span> <span data-start="239.38" data-end="243.579">coding and praying say I've got it</span> <span data-start="243.579" data-end="246.73">running at the time I was developing on</span> </p>
<p><span data-start="246.73" data-end="249.519">Firefox 3 because at the time Firebug</span> <span data-start="249.519" data-end="253.239">was the best thing around and it kind of</span> <span data-start="253.239" data-end="259.359">works get married to move it kind of</span> <span data-start="259.359" data-end="262.03">works but it was a bit like Mario's on</span> <span data-start="262.03" data-end="265.139">the moon it wasn't really playable</span> <span data-start="265.139" data-end="267.46">this was supposed to be running at 60fps</span> <span data-start="267.46" data-end="270.46">and it was barely managing ten now</span> <span data-start="270.46" data-end="273.25">really interestingly actually it was</span> <span data-start="273.25" data-end="275.05">like this across all the browsers</span> <span data-start="275.05" data-end="276.819">although all the modern browsers at the</span> <span data-start="276.819" data-end="279.879">time anyway Safari and Chrome both ran</span> <span data-start="279.879" data-end="283.419">it about this feat and being just a</span> <span data-start="283.419" data-end="285.31">naive JavaScript developer I just</span> <span data-start="285.31" data-end="286.96">assumed that all JavaScript engines were</span> <span data-start="286.96" data-end="289.3">built equal and this was the fastest it</span> <span data-start="289.3" data-end="291.19">could run so I just sort of gave up I</span> <span data-start="291.19" data-end="292.449">actually didn't release it for six</span> <span data-start="292.449" data-end="293.47">months because I thought nobody would</span> <span data-start="293.47" data-end="301.659">want to play this but anyway so going</span> <span data-start="301.659" data-end="304.75">back in time a bit I first started this</span> <span data-start="304.75" data-end="307.03">in December 2008 and then I released it</span> <span data-start="307.03" data-end="311.83">onto the Internet in June last year and</span> <span data-start="311.83" data-end="313.24">then a few months later somebody I went</span> <span data-start="313.24" data-end="317.5">to uni with sent me a patch and all it</span> <span data-start="317.5" data-end="320.65">did was replaced this bit of code which</span> <span data-start="320.65" data-end="322.599">goes through every pixel in the buffer</span> <span data-start="322.599" data-end="325.419">and writes it to the canvas element and</span> <span data-start="325.419" data-end="329.83">see the screen is 256 by 240 pixels and</span> <span data-start="329.83" data-end="333.31">it replaced this with this which all</span> <span data-start="333.31" data-end="334.99">it's doing is exactly the same thing</span> <span data-start="334.99" data-end="336.789">except it remembers what the previous</span> <span data-start="336.789" data-end="339.219">buffer was and only writes pixels to the</span> <span data-start="339.219" data-end="342.3">buffer which have actually changed and</span> <span data-start="342.3" data-end="344.949">when you applied this patch and ran it</span> <span data-start="344.949" data-end="352.18">in Chrome it did this it was running at</span> <span data-start="352.18" data-end="358.17">full speed</span> <span data-start="358.18" data-end="360.669">and this is not the incredible bit I</span> <span data-start="360.669" data-end="362.35">mean this is with a frame limiter that</span> <span data-start="362.35" data-end="364.96">limits it to 60fps or almost 60 P FPS</span> <span data-start="364.96" data-end="368.53">anyway without the frame limiter on it</span> <span data-start="368.53" data-end="370.8">was always running double that speed I</span> <span data-start="370.8" data-end="373.33">had basically a ten times performance</span> <span data-start="373.33" data-end="377.81">increase just from this one tiny patch</span> <span data-start="377.82" data-end="379.87">and I mean initially I couldn't</span> <span data-start="379.87" data-end="382.09">understand what the hell was going on I</span> <span data-start="382.09" data-end="383.83">mean for starters my assumption that all</span> <span data-start="383.83" data-end="385.9">the JavaScript engines were built equal</span> <span data-start="385.9" data-end="388.81">was just wrong and not only that I</span> <span data-start="388.81" data-end="390.4">couldn't stand why chrome was the one</span> <span data-start="390.4" data-end="394.21">that when obscenely fast say with a</span> <span data-start="394.21" data-end="395.889">little help quite ironically from a</span> <span data-start="395.889" data-end="401.68">mozilla developer we basically found I'm</span> <span data-start="401.68" data-end="404.26">just gonna stop these we basically found</span> <span data-start="404.26" data-end="406.96">that chrome is just really really really</span> <span data-start="406.96" data-end="412.539">fast and at least at the time it was at</span> <span data-start="412.539" data-end="413.86">the time it was streets ahead of</span> <span data-start="413.86" data-end="418">everything else and the problem was that</span> <span data-start="418" data-end="420.28">chrome had a bug in writing stuff to the</span> <span data-start="420.28" data-end="423.099">canvas which is now fixed but</span> <span data-start="423.099" data-end="424.9">essentially by only changing what's</span> <span data-start="424.9" data-end="427.12">changed from the last buffer it was</span> <span data-start="427.12" data-end="428.889">minimizing the number of writes it made</span> <span data-start="428.889" data-end="430.78">to the canvas elements which essentially</span> <span data-start="430.78" data-end="432.7">worked around this bug that made the</span> <span data-start="432.7" data-end="434.62">canvas element really slow and let v8</span> <span data-start="434.62" data-end="436.72">just steam ahead and run at full speed</span> <span data-start="436.72" data-end="441.58">now these sort of micro optimize a these</span> <span data-start="441.58" data-end="442.81">sort of things are micro optimizations</span> <span data-start="442.81" data-end="445.78">so they usually don't really matter for</span> <span data-start="445.78" data-end="447.49">your applications but when you have</span> <span data-start="447.49" data-end="450.669">really really tight inner loops where</span> <span data-start="450.669" data-end="454.33">every optimization counts they really</span> <span data-start="454.33" data-end="455.77">make a big difference like for example</span> <span data-start="455.77" data-end="457.78">the nez runs at 60 frames a second and</span> <span data-start="457.78" data-end="460.57">for each frame it's emulating ten</span> <span data-start="460.57" data-end="465.01">thousands CPU instructions and you can</span> <span data-start="465.01" data-end="466.599">imagine how much that photo how many</span> <span data-start="466.599" data-end="468.25">times that function gets called almost</span> <span data-start="468.25" data-end="471.58">3/4 of a million times a second so that</span> <span data-start="471.58" data-end="472.96">function really has to be super</span> <span data-start="472.96" data-end="478.3">optimized now once it was actually</span> <span data-start="478.3" data-end="479.62">playable and it was aptly on the</span> <span data-start="479.62" data-end="481.389">internet it got a bit of attention on</span> </p>
<p><span data-start="481.389" data-end="483.43">Twitter and the blogosphere and stuff</span> <span data-start="483.43" data-end="486.07">like that and somebody from Apple came</span> <span data-start="486.07" data-end="488.229">along to try and figure out why it was</span> <span data-start="488.229" data-end="490.05">so slow in Safari</span> <span data-start="490.05" data-end="492.1">it turns out it was actually a really</span> <span data-start="492.1" data-end="494.59">simple problem safari had a problem</span> <span data-start="494.59" data-end="498.52">caching really large objects which Jess</span> <span data-start="498.52" data-end="501.01">knows was full of but I'm happy to say</span> <span data-start="501.01" data-end="504.19">that this is now fixed it's not quite as</span> <span data-start="504.19" data-end="506.44">fast as chrome but it's but it still</span> <span data-start="506.44" data-end="509.44">runs the emulator at full speed and a</span> <span data-start="509.44" data-end="510.82">few opera people have pointed out that</span> <span data-start="510.82" data-end="513.479">their browsers pretty fast too</span> <span data-start="513.479" data-end="517.36">but unfortunately Firefox is still</span> <span data-start="517.36" data-end="522.49">really slow and you saw how how fast it</span> <span data-start="522.49" data-end="524.95">ran in an old version earlier and it</span> <span data-start="524.95" data-end="526.72">isn't much better on a recent stable</span> <span data-start="526.72" data-end="529.63">version and it's basically a problem</span> <span data-start="529.63" data-end="535.75">with how Firefox traces code where it</span> <span data-start="535.75" data-end="537.55">tries to sort of tracing is where it</span> <span data-start="537.55" data-end="539.05">tries to figure out how a path of code</span> <span data-start="539.05" data-end="541.66">is going to run because with an emulator</span> <span data-start="541.66" data-end="543.34">there's so much branching where it</span> <span data-start="543.34" data-end="544.27">branches the different things for</span> <span data-start="544.27" data-end="545.89">different instructions you have what's</span> <span data-start="545.89" data-end="547.24">called I think it's a branching</span> <span data-start="547.24" data-end="548.53">explosion or something where it just</span> <span data-start="548.53" data-end="550.18">can't figure out what's going to happen</span> <span data-start="550.18" data-end="551.71">in these branches and then it just gives</span> <span data-start="551.71" data-end="553.54">up and falls back to interruption in the</span> <span data-start="553.54" data-end="555.73">instructions one by one that might be</span> <span data-start="555.73" data-end="558.09">wrong but that's the impression I got</span> <span data-start="558.09" data-end="560.17">but credit to them though they're trying</span> <span data-start="560.17" data-end="561.94">to fix this and on their jaegerman</span> <span data-start="561.94" data-end="563.68">creating the eager monkey engine this is</span> <span data-start="563.68" data-end="566.59">a recent build of it it actually at</span> <span data-start="566.59" data-end="568.03">least on my little laptop it's almost</span> <span data-start="568.03" data-end="569.59">full speed and I've heard it runs at</span> <span data-start="569.59" data-end="572.89">full speed on faster computers and</span> <span data-start="572.89" data-end="574.39">they've yet to improve on this I think</span> <span data-start="574.39" data-end="575.65">they're gonna merge two branches or</span> <span data-start="575.65" data-end="577.69">something to make it doubly fast but I'm</span> <span data-start="577.69" data-end="578.68">not sure what's going on but it's gonna</span> <span data-start="578.68" data-end="586.27">be really fast now I I did try it on</span> <span data-start="586.27" data-end="591.52">explorer 9 and it it did run but I left</span> <span data-start="591.52" data-end="593.17">it running for about an hour on my</span> <span data-start="593.17" data-end="596.2">benchmark and it just didn't do anything</span> <span data-start="596.2" data-end="597.91">so I'm not sure whether that's a problem</span> <span data-start="597.91" data-end="599.44">with Internet Explorer or my benchmark</span> <span data-start="599.44" data-end="600.97">can it be great to talk some people from</span> <span data-start="600.97" data-end="603.04">my class about this but in theory it</span> <span data-start="603.04" data-end="604.3">could work on in Explorer I'm just not</span> <span data-start="604.3" data-end="608.68">sure how fast it is now a useful perform</span> <span data-start="608.68" data-end="610.06">step which you probably already know</span> <span data-start="610.06" data-end="610.33">about</span> <span data-start="610.33" data-end="612.25">it's another micro optimization thing</span> <span data-start="612.25" data-end="616.87">which is using prototypes for example in</span> <span data-start="616.87" data-end="619.18">this top one every time that a new</span> <span data-start="619.18" data-end="621.7">instance of tile is braces it creates a</span> <span data-start="621.7" data-end="623.089">new render form</span> <span data-start="623.089" data-end="626.269">but this is in the second example it</span> <span data-start="626.269" data-end="627.829">always uses the same render function</span> <span data-start="627.829" data-end="629.54">from the prototype and this can be</span> <span data-start="629.54" data-end="630.74">significant faster when you're creating</span> <span data-start="630.74" data-end="633.999">loads and loads and loads of objects I</span> <span data-start="633.999" data-end="636.019">put this code up on the web sometime</span> <span data-start="636.019" data-end="637.16">afterwards if you want a copy and paste</span> <span data-start="637.16" data-end="640.249">code now when I was cleaning up my code</span> <span data-start="640.249" data-end="642.519">to put everything into prototypes I</span> <span data-start="642.519" data-end="646.61">stumbled on a really really annoying bug</span> <span data-start="646.61" data-end="649.55">in Chrome and this one took me days to</span> <span data-start="649.55" data-end="655.61">fix essentially as I sort of hangover</span> <span data-start="655.61" data-end="658.55">from the Java port I had a load of</span> <span data-start="658.55" data-end="662.269">variables declared in the constructor</span> <span data-start="662.269" data-end="665.059">like this and then I called a reset</span> <span data-start="665.059" data-end="666.379">function which actually assigned them a</span> <span data-start="666.379" data-end="669.29">value so I could reset the object</span> <span data-start="669.29" data-end="671.12">without having Theory instantiate it and</span> <span data-start="671.12" data-end="671.839">obviously this is a bit pointless</span> <span data-start="671.839" data-end="674.24">because I'm declaring those I'm defining</span> <span data-start="674.24" data-end="676.399">those properties anyway so surely I</span> <span data-start="676.399" data-end="679.009">might as well just take away those you</span> <span data-start="679.009" data-end="680.629">know properties that equal no and it'll</span> <span data-start="680.629" data-end="684.11">do exactly the same thing it doesn't at</span> <span data-start="684.11" data-end="687.62">all Chrome the forms in Chrome drops</span> <span data-start="687.62" data-end="691.399">around 20 fps just Chrome none of the</span> <span data-start="691.399" data-end="693.019">other browsers I mean even Safari ran at</span> <span data-start="693.019" data-end="696.949">full speed I'd somehow kill this bit of</span> <span data-start="696.949" data-end="698.809">magic that made chrome run really fast</span> <span data-start="698.809" data-end="700.639">because I was doing it as part of this</span> <span data-start="700.639" data-end="702.019">sort of big refactoring of the</span> <span data-start="702.019" data-end="703.579">prototypes I was convinced it was</span> <span data-start="703.579" data-end="704.6">something to do with this and I just</span> <span data-start="704.6" data-end="706.129">didn't like didn't consider removing</span> <span data-start="706.129" data-end="708.579">those nulls would actually do anything</span> <span data-start="708.579" data-end="711.199">and it turns out to do with how v8</span> <span data-start="711.199" data-end="717.889">represents objects objects in v8 are</span> <span data-start="717.889" data-end="719.509">backed by things called hidden classes</span> <span data-start="719.509" data-end="722.559">which are a bit like classes in Java</span> <span data-start="722.559" data-end="724.999">they essentially define what properties</span> <span data-start="724.999" data-end="727.91">are on an object so when you need to</span> <span data-start="727.91" data-end="730.309">look up a property in in from an</span> <span data-start="730.309" data-end="733.04">object's it knows the position of that</span> <span data-start="733.04" data-end="735.139">property from the start of the object in</span> <span data-start="735.139" data-end="736.97">memory and it can do a really fast</span> <span data-start="736.97" data-end="738.8">lookup like I think it's sort of three</span> <span data-start="738.8" data-end="742.639">lines of machine code or something but</span> </p>
<p><span data-start="742.639" data-end="744.679">Java scripts are dynamic language so you</span> <span data-start="744.679" data-end="746.99">can add remove properties any time so</span> <span data-start="746.99" data-end="749.449">when you add a property to an object in</span> <span data-start="749.449" data-end="752.149">v8 it takes away the hidden class that's</span> <span data-start="752.149" data-end="753.679">already on the object and a new hidden</span> <span data-start="753.679" data-end="756.519">class with that new property had it</span> <span data-start="756.519" data-end="759.709">so I'm guessing by not defining these</span> <span data-start="759.709" data-end="763.43">properties in the constructor it was</span> <span data-start="763.43" data-end="766.399">just sort of switching in and out hidden</span> <span data-start="766.399" data-end="768.25">classes and I had as I added extra</span> <span data-start="768.25" data-end="770.899">properties or maybe even wasn't using</span> <span data-start="770.899" data-end="772.1">hidden classes at all and just doing</span> <span data-start="772.1" data-end="773.329">slow lookups on the properties I don't</span> <span data-start="773.329" data-end="775.04">know but it was something to do that it</span> <span data-start="775.04" data-end="776.36">was something to do with Chrome's</span> <span data-start="776.36" data-end="779.449">hidden classes so the lesson is I</span> <span data-start="779.449" data-end="781.49">suppose always declare your properties</span> <span data-start="781.49" data-end="782.87">in the constructor otherwise Chrome</span> <span data-start="782.87" data-end="787.88">might do something weird you know</span> <span data-start="787.88" data-end="789.47">another neat thing which might be</span> <span data-start="789.47" data-end="794.87">helpful is a benchmark I wrote that it</span> <span data-start="794.87" data-end="797.75">essentially runs 50 frames of an open</span> <span data-start="797.75" data-end="800.48">source home Buriram and times it and</span> <span data-start="800.48" data-end="802.339">here are some completely unscientific</span> <span data-start="802.339" data-end="804.829">results that I put to get on the plane</span> <span data-start="804.829" data-end="808.31">here if some of the latest browsers you</span> <span data-start="808.31" data-end="810.199">can see Chrome on the left is really</span> <span data-start="810.199" data-end="810.74">really fast</span> </p>
<p><span data-start="810.74" data-end="813.259">I'm sorry slightly slower and they're</span> <span data-start="813.259" data-end="815.769">not pretend is about twice as slow as</span> <span data-start="815.769" data-end="819.199">Safari and then Firefox is a lot slower</span> <span data-start="819.199" data-end="820.67">but this is kind of unfair because</span> <span data-start="820.67" data-end="822.079">Firefox are going to improve their</span> <span data-start="822.079" data-end="823.399">engine a lot this is actually the latest</span> <span data-start="823.399" data-end="827.899">build the Egger monkey stuff but I think</span> <span data-start="827.899" data-end="829.19">they've yet to get this faster before</span> <span data-start="829.19" data-end="832.42">the actual official release of Firefox 4</span> <span data-start="832.42" data-end="834.76">this is available on my github account</span> <span data-start="834.76" data-end="836.839">and I think it's being used on the Yaga</span> <span data-start="836.839" data-end="838.399">magic monkey engine at the moment on</span> <span data-start="838.399" data-end="840.829">there are we fast yet calm or something</span> <span data-start="840.829" data-end="843.13">like that and if anybody else wants to</span> <span data-start="843.13" data-end="846.319">use it please see find me afterwards</span> <span data-start="846.319" data-end="847.579">because I'd love to make it you know</span> <span data-start="847.579" data-end="853.88">something that's useful one of the</span> <span data-start="853.88" data-end="855.5">things that was really really hard to</span> <span data-start="855.5" data-end="859.85">get right was accurate timing in Firefox</span> <span data-start="859.85" data-end="862.36">which is quite important for an emulator</span> <span data-start="862.36" data-end="864.17">originally I was just using a set</span> <span data-start="864.17" data-end="866.3">timeout that called the frame function</span> <span data-start="866.3" data-end="869.029">of like 60 times a second but this is</span> <span data-start="869.029" data-end="871.519">incredibly an accuracy and all the games</span> <span data-start="871.519" data-end="873.079">were just really jerky as the browser</span> <span data-start="873.079" data-end="875.06">you know sort of decided I'm going to</span> <span data-start="875.06" data-end="876.38">take up some more CPU time and the</span> <span data-start="876.38" data-end="877.699">emulator just sort of stalled for a</span> <span data-start="877.699" data-end="880.699">little bit the method I eventually</span> <span data-start="880.699" data-end="882.5">settled them after trying a few other</span> <span data-start="882.5" data-end="885.23">ones is using a set timeouts but making</span> <span data-start="885.23" data-end="887.839">it fire really early and then just</span> <span data-start="887.839" data-end="889.31">sitting in a while loop until</span> <span data-start="889.31" data-end="890.92">right time to display the function add</span> <span data-start="890.92" data-end="896.029">display the frame sorry it's really</span> <span data-start="896.029" data-end="899.14">really inefficient but it kind of works</span> <span data-start="899.14" data-end="902.35">it's incredibly accurate actually</span> <span data-start="902.35" data-end="904.07">essentially what it does is it renders</span> <span data-start="904.07" data-end="905.96">the frame and then waits until the right</span> <span data-start="905.96" data-end="907.7">time to actually display the frame then</span> <span data-start="907.7" data-end="909.44">writes it to the canvas and then</span> <span data-start="909.44" data-end="911.63">triggers the next frame sort of half the</span> <span data-start="911.63" data-end="913.01">time too early so it can render in the</span> <span data-start="913.01" data-end="915.77">next frame if somebody has a better</span> <span data-start="915.77" data-end="917.029">solution I'd really love to hear it</span> <span data-start="917.029" data-end="920.68">because I don't like the solution at all</span> <span data-start="920.68" data-end="922.73">one of the other shiny things I worked</span> <span data-start="922.73" data-end="926.69">on was sound and this is really cool for</span> <span data-start="926.69" data-end="928.13">a while you can write dynamically sound</span> <span data-start="928.13" data-end="930.05">dynamically generated sound to an audio</span> <span data-start="930.05" data-end="932.93">elements so I wrote a tiny little one</span> <span data-start="932.93" data-end="935.18">pixel flash application oh it's red a</span> <span data-start="935.18" data-end="937.19">buffer from JavaScript and then write it</span> <span data-start="937.19" data-end="940.06">and then wrote it out to the speakers</span> <span data-start="940.06" data-end="943.339">more recently Mozilla have developed</span> <span data-start="943.339" data-end="945.65">their audio data API which is only</span> <span data-start="945.65" data-end="946.79">supported in Firefox which is</span> <span data-start="946.79" data-end="949.7">frustrating but it lets you read and</span> <span data-start="949.7" data-end="952.61">write audio samples directly to the</span> <span data-start="952.61" data-end="954.29">audio elements as you do cool</span> <span data-start="954.29" data-end="956.06">visualizations and synthesizers and</span> <span data-start="956.06" data-end="959.18">stuff like that so I wrote this little</span> <span data-start="959.18" data-end="960.56">using the flash application I had</span> <span data-start="960.56" data-end="961.78">written before I wrote this little</span> <span data-start="961.78" data-end="966.41">library essentially it uses Firefox as</span> </p>
<p><span data-start="966.41" data-end="968.06">API if it's available but it falls back</span> <span data-start="968.06" data-end="970.37">to a flash little flash widget if it</span> <span data-start="970.37" data-end="970.7">needs to</span> <span data-start="970.7" data-end="973.12">so it's essentially backwards compatible</span> <span data-start="973.12" data-end="975.47">Baxter I haven't tested it back through</span> <span data-start="975.47" data-end="976.52">sort of Internet Explorer but it'll</span> <span data-start="976.52" data-end="980.42">probably work on really old versions and</span> <span data-start="980.42" data-end="983.48">that's pretty much it I suppose this</span> <span data-start="983.48" data-end="984.86">time the questions because Tobias can</span> <span data-start="984.86" data-end="994.9">make it</span> <span data-start="994.91" data-end="1006.28">yep</span> <span data-start="1006.29" data-end="1024.75">oh right oh that's interesting yeah I</span> <span data-start="1024.76" data-end="1032.049">see</span> <span data-start="1032.059" data-end="1038.069">okay yeah cuz you could tell when you</span> <span data-start="1038.069" data-end="1039.839">were playing the game that it just sort</span> <span data-start="1039.839" data-end="1041.879">of sped up and then slowed down and sped</span> <span data-start="1041.879" data-end="1045.329">up and slowed down that becomes I heard</span> <span data-start="1045.329" data-end="1047.159">there's a hack where you could attach</span> <span data-start="1047.159" data-end="1049.259">something to the window objects to get</span> <span data-start="1049.259" data-end="1051.48">round set timeout zero not actually</span> <span data-start="1051.48" data-end="1053.58">being set timeout zero I don't know if</span> <span data-start="1053.58" data-end="1056.009">that works but not very interesting</span> <span data-start="1056.009" data-end="1066.84">thank you yes it didn't really make much</span> <span data-start="1066.84" data-end="1068.639">of a difference in my case because I</span> <span data-start="1068.639" data-end="1070.379">instantiate all the objects before I</span> <span data-start="1070.379" data-end="1073.08">started but I've run a few benchmarks in</span> <span data-start="1073.08" data-end="1074.82">that about that and it's about three or</span> <span data-start="1074.82" data-end="1077.759">four times faster I think so if on an</span> <span data-start="1077.759" data-end="1078.99">inner inner loop if you're creating</span> <span data-start="1078.99" data-end="1081.149">loads and loads of objects it's probably</span> <span data-start="1081.149" data-end="1084.289">worth it I just did it to make tidy code</span> <span data-start="1084.289" data-end="1103.56">but yeah that's yes</span> <span data-start="1103.57" data-end="1105.5">but there was who</span> <span data-start="1105.5" data-end="1132.72">oh yes</span> <span data-start="1132.73" data-end="1137.929">okay what should I use and said okay</span> <span data-start="1137.929" data-end="1146.909">yeah thanks for the tip anything else</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
