<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>4cEJ-1rXqMg</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/4cEJ-1rXqMg?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.38" data-end="1.79">Well, our next talk is by Luke Herrington on components as data, so a round of applause,</span> <span data-start="1.79" data-end="2.79">please.</span> <span data-start="2.79" data-end="3.79">[applause]</span> <span data-start="3.79" data-end="5.07">All right, let's get started.</span> <span data-start="5.07" data-end="9.4">Hey, everyone, my name is Luke Herrington, I'm a senior JavaScript engineer at Four Kitchens,</span> <span data-start="9.4" data-end="15.24">we're a digital agency and we make big websites.</span> <span data-start="15.24" data-end="22.46">Actually my work on NBC.com and the apps that inspired this talk, the API work.</span> </p>
<p><span data-start="22.46" data-end="25.589">And the talk is components as data.</span> <span data-start="25.589" data-end="31.789">Across-platform GraphQL powered component API and if that's not a mouthful, we're going</span> <span data-start="31.789" data-end="32.98">to unpack it, don't worry.</span> <span data-start="32.98" data-end="39.28">I just threw a bunch of buzzwords in there to get you all to come, all right?</span> <span data-start="39.28" data-end="41.37">So let's start with components.</span> <span data-start="41.37" data-end="46.92">Components are these things that show up in our front ends and everyone across our industry</span> <span data-start="46.92" data-end="49.03">is using them to build UIs.</span> <span data-start="49.03" data-end="53.03">They're the fundamental building blocks of a UI.</span> <span data-start="53.03" data-end="59.47">Doesn't matter what framework, what platform you're building on, you're using components</span> <span data-start="59.47" data-end="62.31">to build it most likely.</span> <span data-start="62.31" data-end="63.83">So I think components win.</span> <span data-start="63.83" data-end="68.819">We found a really good abstraction for building UI.</span> </p>
<p><span data-start="68.819" data-end="72.12">But what is a component?</span> <span data-start="72.12" data-end="74.07">So I like to define components this way.</span> <span data-start="74.07" data-end="77.28">This is kind of like pseudomath here.</span> <span data-start="77.28" data-end="81.52">A component is a function of rendering props and state.</span> </p>
<p><span data-start="81.52" data-end="88.409">And those words might sound familiar to you if you've built a React app.</span> <span data-start="88.409" data-end="92.159">Let's dig into those words a little bit more.</span> <span data-start="92.159" data-end="97.079">So props, I think of, as read-only external data.</span> <span data-start="97.079" data-end="101.579">They're basically the parameters to your render function.</span> <span data-start="101.579" data-end="105.31">State is going to be local data that changes over time.</span> <span data-start="105.31" data-end="112.6">And your render is a declarative representation of the UI based upon the current props and</span> <span data-start="112.6" data-end="116.46">state.</span> </p>
<p><span data-start="116.46" data-end="121.759">So let's start with just this simple example of a component, and then we'll get on to the</span> <span data-start="121.759" data-end="124.159">API stuff.</span> <span data-start="124.159" data-end="126.079">So here we have a switch component.</span> <span data-start="126.079" data-end="135.08">A switch component has a label, it has some state, whether or not it's on or off, and</span> <span data-start="135.08" data-end="137.22">it has some presentation to it.</span> <span data-start="137.22" data-end="142.73">You know, when it's on, it's green, when it's off it's white.</span> <span data-start="142.73" data-end="149.08">So the thing about components is that they're also composable, so we could take this switch</span> <span data-start="149.08" data-end="154.94">component, and we could add it to a row, for example.</span> </p>
<p><span data-start="154.94" data-end="160.78">And say we take that row component, and we add it to our settings screen and suddenly</span> <span data-start="160.78" data-end="170.15">we have basically a screen in our application.</span> <span data-start="170.15" data-end="172.45">So I love components.</span> <span data-start="172.45" data-end="177.87">As a '90s kid, who grew up building LEGOs, I can't help but love them, they feel like</span> <span data-start="177.87" data-end="182.59">LEGOs, and they're genuinely fun to work with and we see this happening in our industry,</span> <span data-start="182.59" data-end="188.59">it doesn't matter if you're building with something like SWIFT UI, or React, ReactNative,</span> <span data-start="188.59" data-end="199.13">VUe, you're using this general abstraction and I think it's because it's a good one.</span> <span data-start="199.13" data-end="203.32">So I'm going to stop gushing about components now because this is an API talk and you're</span> <span data-start="203.32" data-end="206.39">thinking, OK, where do we get to this whole GraphQL thing?</span> </p>
<p><span data-start="206.39" data-end="213.53">So, but I just love components so much so I'm going to leave this slide up for a second.</span> <span data-start="213.53" data-end="214.53">No.</span> <span data-start="214.53" data-end="215.98">Let's move on.</span> <span data-start="215.98" data-end="225.35">So when you get into building an application, there's these pieces to your app, to your</span> <span data-start="225.35" data-end="233.47">architecture, and I'm going to use this throughout the talk to kind of describe this API approach.</span> <span data-start="233.47" data-end="237.25">So generally you're going to have some sort of database or data store.</span> <span data-start="237.25" data-end="242.34">You're going to have business logic, which describes the rules that your business wants</span> <span data-start="242.34" data-end="245.96">to accomplish and help the user.</span> <span data-start="245.96" data-end="250.68">You're going to have some data fetching with some third-party or external APIs, and you're</span> <span data-start="250.68" data-end="255.82">going to be denormallizing your data from your database with maybe some third party</span> <span data-start="255.82" data-end="258.239">or other API data.</span> <span data-start="258.239" data-end="264.42">And you're probably going solve some sort of feature flags, A/B testing and then of</span> <span data-start="264.42" data-end="268.35">course you're going to have some sort of component library.</span> <span data-start="268.35" data-end="273.69">And you're going to kind of stitch that all together in a composable way into the pieces</span> <span data-start="273.69" data-end="279.9">and the pages or screens for your application.</span> </p>
<p><span data-start="279.9" data-end="286.75">So you can combine these things in countless ways and it's basically our job to figure</span> <span data-start="286.75" data-end="292.29">out how do we, you know, how do we put these together?</span> <span data-start="292.29" data-end="296.27">And as you're building these things, usually there comes a point in the conversation where</span> <span data-start="296.27" data-end="301.25">you're architecting an application of OK, are we going to, you know, take more of a</span> <span data-start="301.25" data-end="305.88">monolithic approach or are we going to decouple and build an API?</span> <span data-start="305.88" data-end="311.35">So when you're decoupling, we've had these kind of conversations before.</span> <span data-start="311.35" data-end="314.78">Who should use like a decoupled architecture?</span> <span data-start="314.78" data-end="315.93">What is decoupling?</span> <span data-start="315.93" data-end="317.6">Let's define the terms.</span> <span data-start="317.6" data-end="320.75">When should you do that in a project life cycle?</span> <span data-start="320.75" data-end="321.75">Why?</span> <span data-start="321.75" data-end="322.75">Why is it a good idea?</span> <span data-start="322.75" data-end="325.34">Why is it a bad idea sometimes.</span> <span data-start="325.34" data-end="326.46">And how?</span> <span data-start="326.46" data-end="327.91">The how-to.</span> </p>
<p><span data-start="327.91" data-end="332.12">But one thing that we generally neglect and I don't think it's on purpose but I think</span> <span data-start="332.12" data-end="335.68">it's assumed is where.</span> <span data-start="335.68" data-end="341.3">Where do we decouple our applications?</span> <span data-start="341.3" data-end="346.76">So in this talk, we're going to use our friend, the decouple line, to kind of describe and</span> <span data-start="346.76" data-end="352.58">explore this question of where do you decouple your application.</span> <span data-start="352.58" data-end="358.21">So as the decouple line moves around your architecture, some really interesting features</span> <span data-start="358.21" data-end="361.63">of your API are exposed.</span> <span data-start="361.63" data-end="369.389">Some  —  the format of your API is exposed and the content of your API is different.</span> </p>
<p><span data-start="369.389" data-end="374.34">So let's start by describing a typical decoupled architecture.</span> <span data-start="374.34" data-end="382.669">This is one that I think is basically assumed in general when we build APIs for our apps.</span> <span data-start="382.669" data-end="388.61">And that is, that you basically decouple right before business logic, but right after the</span> <span data-start="388.61" data-end="395.389">data store, and essentially you're building an API that exposes the raw data of your data</span> <span data-start="395.389" data-end="398.28">store, your database.</span> <span data-start="398.28" data-end="405.4">And this API is going to have listing functionality, it's going to have filtering functionality,</span> <span data-start="405.4" data-end="410.27">sorting, including, or joining of some sort.</span> <span data-start="410.27" data-end="411.77">It's pretty typical.</span> </p>
<p><span data-start="411.77" data-end="420.05">And a good example of this approach is the JSON API spec, which is an API format specification.</span> <span data-start="420.05" data-end="426.639">In this format you're going to roughly map CRUD operations to HTTP verbs and the queries</span> <span data-start="426.639" data-end="434.81">are going to look pretty atomic and low-level and almost like a SQL query.</span> <span data-start="434.81" data-end="440.4">Where you're basically saying, give me the authors and you better know there's an authors</span> <span data-start="440.4" data-end="443.54">table somewhere in your database.</span> <span data-start="443.54" data-end="447.699">And I want to get the posts for those authors and there's probably a post, too, and you</span> <span data-start="447.699" data-end="454.18">can see what I mean by kind of it being pretty closely mapping to your data model.</span> <span data-start="454.18" data-end="461.81">So I think this is what people usually mean when they say that their API is RESTful, and</span> <span data-start="461.81" data-end="469.9">let's be real: No one really knows what that means except for our fearless leader Roy Fielding.</span> <span data-start="469.9" data-end="470.9">But let's look back here.</span> </p>
<p><span data-start="470.9" data-end="476.009">This leaves, if you look kind of on the other side of the decouple line, this leaves a lot</span> <span data-start="476.009" data-end="478.419">for API consumers to implement.</span> <span data-start="478.419" data-end="480.58">This leaves them with business logic.</span> <span data-start="480.58" data-end="488.35">Further API fetching and denormalization, A/B testing, and the whole gamut.</span> <span data-start="488.35" data-end="494.59">So let's move this line over a bit to here.</span> <span data-start="494.59" data-end="502.33">So in this approach, you're exposing business logic in your API, and this is a really common</span> <span data-start="502.33" data-end="505.32">approach for product companies.</span> <span data-start="505.32" data-end="511.33">You're still exposing the resources of your data store, but you're also exposing operations</span> <span data-start="511.33" data-end="517.49">upon that date Y This is  —  it's more than just resources or</span> <span data-start="517.49" data-end="520.08">entities that you're exposing.</span> </p>
<p><span data-start="520.08" data-end="524.12">A great example of something like this is Stripe's API.</span> <span data-start="524.12" data-end="530.38">Stripe is a payment as a service company and they expose a really, really powerful API</span> <span data-start="530.38" data-end="538.08">for working with things like charges and customers and subscriptions, right?</span> <span data-start="538.08" data-end="544.43">But you're not just simply going and getting a subscriber and then deleting a subscriber.</span> <span data-start="544.43" data-end="549.58">Stripe also exposes parts of their business logic in the API.</span> <span data-start="549.58" data-end="553.87">So you could dispute a charge.</span> <span data-start="553.87" data-end="556.64">What HTTP verb does that map to?</span> </p>
<p><span data-start="556.64" data-end="557.64">Not really any.</span> <span data-start="557.64" data-end="563.87">Any of these kind of APIs can get really powerful.</span> <span data-start="563.87" data-end="569.93">They're essentially exposing their business logic to you and most of their customers are</span> <span data-start="569.93" data-end="574.88">going to be developers that need to  —  need someone else to deal with the hard bits of</span> <span data-start="574.88" data-end="579.39">payments, for example.</span> <span data-start="579.39" data-end="587.49">So this format, and the prior, get really powerful when you introduce something like</span> <span data-start="587.49" data-end="592.88">HATEOAS, stands for hypermedia as the engine of application state.</span> <span data-start="592.88" data-end="597.55">So a big mouthful there.</span> <span data-start="597.55" data-end="603.88">So let me give you an example of what HATEOAS looks like in action and this is a very basic</span> <span data-start="603.88" data-end="606.99">example in my opinion.</span> </p>
<p><span data-start="606.99" data-end="614.97">I think pagination of resources in your API is an example of HATEOAS.</span> <span data-start="614.97" data-end="623.86">So imagine that we have this listing API where we're going to get a list of things, and below</span> <span data-start="623.86" data-end="629.62">our data, we're going to return this kind of like metadata attribute in our response,</span> <span data-start="629.62" data-end="631.25">called links.</span> <span data-start="631.25" data-end="639.88">And the links are going to include these things like self, next, previous, last, first.</span> <span data-start="639.88" data-end="646.25">So if these links exist, the UI can know that there's more to see or that there's something</span> <span data-start="646.25" data-end="650.89">else before this page of the list.</span> <span data-start="650.89" data-end="656.19">So what they can do is wire up their UI, to based upon the existence of one of these properties,</span> <span data-start="656.19" data-end="662.14">create a next button or a previous button, and in that way the server is powering the</span> <span data-start="662.14" data-end="663.33">state.</span> <span data-start="663.33" data-end="671.1">We could do things like calculating the last page, by dividing the total count of the number</span> <span data-start="671.1" data-end="677.33">of items in this list, by the page size.</span> <span data-start="677.33" data-end="684.75">If some links don't exist, then you simply don't create the UI for that.</span> <span data-start="684.75" data-end="689.29">And the other really powerful thing about HATEOAS in hypermedia is that you can swap</span> <span data-start="689.29" data-end="693.44">out the implementation without friends even knowing.</span> </p>
<p><span data-start="693.44" data-end="696.399">So in this example I've switched to an offset-based pager.</span> <span data-start="696.399" data-end="699.79">You can do the same for a cursor-based pager.</span> <span data-start="699.79" data-end="708.07">And because they are running a git request for it, they know no different.</span> <span data-start="708.07" data-end="709.13">Super powerful.</span> <span data-start="709.13" data-end="717.81">Imagine doing that for your users, if you're working on a SaaS and expose an API.</span> <span data-start="717.81" data-end="727.18">You're exposing all of these actions and operations that they could basically generate and machine-read</span> <span data-start="727.18" data-end="730.47">and work with.</span> <span data-start="730.47" data-end="737.64">So there's kind of the explanation for this architecture.</span> </p>
<p><span data-start="737.64" data-end="742.88">So let's move the line all the way over to this other side.</span> <span data-start="742.88" data-end="746.58">And this one's a bit of a stretch, I'll admit it.</span> <span data-start="746.58" data-end="748.36">It's not really an API anymore.</span> <span data-start="748.36" data-end="753.019">You're basically building a monolith where you're sending HTML, CSS, JavaScript, down</span> <span data-start="753.019" data-end="754.42">the wire.</span> </p>
<p><span data-start="754.42" data-end="759.64">But it's a decision to make, nonetheless, when you're choosing your application.</span> <span data-start="759.64" data-end="764.43">And I want to kind of address the element in the room here, that the room monolith has</span> <span data-start="764.43" data-end="770.92">become this low-grade insult in our industry and I think that's a shame.</span> <span data-start="770.92" data-end="776.58">I think it's a case of guilt by association.</span> <span data-start="776.58" data-end="781.06">There's folks in our industry that have been in the industry for a long time and worked</span> <span data-start="781.06" data-end="787.07">on these large codebases or joined a team as a new member and had this legacy quote-unquote</span> <span data-start="787.07" data-end="791.15">application that was really difficult to work with and maybe it was poorly designed and</span> <span data-start="791.15" data-end="794.99">it also happened to be a monolith, because that's how everything was built for a very</span> <span data-start="794.99" data-end="798.529">long time.</span> </p>
<p><span data-start="798.529" data-end="804.98">But just because the different pieces of the application don't communicate over the network</span> <span data-start="804.98" data-end="807.04">doesn't mean that the app is poorly written.</span> <span data-start="807.04" data-end="810.26">In fact, I would argue the opposite.</span> <span data-start="810.26" data-end="816.399">You could take a poorly written monolith and break it up into microservices, and now you</span> <span data-start="816.399" data-end="817.83">have two problems.</span> <span data-start="817.83" data-end="821.36">You have a poorly designed application that communicates over the network and you have</span> <span data-start="821.36" data-end="825.8">CAP theorem to deal with now and concurrency and consistency issues.</span> <span data-start="825.8" data-end="830.14">So don't go so hard on the monolith.</span> <span data-start="830.14" data-end="835.93">I think it's a pretty good pattern.</span> </p>
<p><span data-start="835.93" data-end="839.21">Monolith does not mean spaghetti code.</span> <span data-start="839.21" data-end="841.23">OK.</span> <span data-start="841.23" data-end="851.03">So let's move on to the next ..  this one's interesting.</span> <span data-start="851.03" data-end="858.15">What is an application that  —  whose database lives in the client?</span> <span data-start="858.15" data-end="863.38">Well, it's an offline-first application or it's a local-first application.</span> <span data-start="863.38" data-end="870.14">And I'm really excited about this kind of pattern right here, these days.</span> <span data-start="870.14" data-end="877.35">In a world where people and their data, their private data, has become a product, this pattern,</span> <span data-start="877.35" data-end="880.709">I think, could be really helpful.</span> <span data-start="880.709" data-end="887.7">OK, I'll get off my soapbox.</span> <span data-start="887.7" data-end="892.339">There's some really interesting research happening in distributed, local-first, offline-first</span> <span data-start="892.339" data-end="893.35">applications.</span> <span data-start="893.35" data-end="898.69">It's a hard problem, so you have an app that has been offline for two weeks and connects</span> <span data-start="898.69" data-end="903.26">to the network and needs to sync with other nodes in the network?</span> <span data-start="903.26" data-end="906.05">How do you solve that problem?</span> </p>
<p><span data-start="906.05" data-end="908.69">It's a hard problem to solve.</span> <span data-start="908.69" data-end="911.33">But it's a real problem.</span> <span data-start="911.33" data-end="919.209">If you have a customer who's going to be out in the field for two weeks or in low-latency</span> <span data-start="919.209" data-end="925.181">and no internet connection, this might be an API that you consider building, and it</span> <span data-start="925.181" data-end="928.67">kind of takes the form of syncing.</span> <span data-start="928.67" data-end="934.73">There's some really interesting research happening in this spot with CRDTs, which stand for commutative</span> <span data-start="934.73" data-end="936.12">replicated data types.</span> </p>
<p><span data-start="936.12" data-end="944.529">Wherein you seepsly model the operations on your data as commutative, so you can basically</span> <span data-start="944.529" data-end="950.28">not worry about the order in which operations happen, when you reconnect to the network.</span> <span data-start="950.28" data-end="952.2">* Really excited about this pattern and I think</span> <span data-start="952.2" data-end="956.26">more apps should be built with data privacy in mind.</span> <span data-start="956.26" data-end="959.079">Data ownership.</span> <span data-start="959.079" data-end="961.829">OK.</span> <span data-start="961.829" data-end="967.87">So finally, let's move to components as data.</span> <span data-start="967.87" data-end="975.32">In components as data, the back end has essentially absorbed a lot more work, but leaves something</span> <span data-start="975.32" data-end="976.86">for the frontends to do.</span> <span data-start="976.86" data-end="986.829">And at this point, the backend kind of becomes a frontend in its own right so what this looks</span> <span data-start="986.829" data-end="993.769">like is an API that serves JSON, structured in terms of a UI tree.</span> <span data-start="993.769" data-end="999.88">And if that sounds confusing, we're going to unpack it and get some examples here.</span> </p>
<p><span data-start="999.88" data-end="1007.69">So your components can be described as data.</span> <span data-start="1007.69" data-end="1009.6">Hence the name components as data.</span> <span data-start="1009.6" data-end="1011.73">So let's get to an example.</span> <span data-start="1011.73" data-end="1013.67">Here's the most basic example I could think of.</span> <span data-start="1013.67" data-end="1015.45">A hero component.</span> <span data-start="1015.45" data-end="1023.04">So here we have a JSON blob with a field called component.</span> <span data-start="1023.04" data-end="1032.04">That component field is going to map directly to a component in your component library.</span> <span data-start="1032.04" data-end="1033.9">And then you have the data.</span> <span data-start="1033.9" data-end="1040.919">And the data is essentially going to represent the props that are needed to render that component.</span> <span data-start="1040.919" data-end="1048.95">Any state that the component might have is going to be locally handled.</span> <span data-start="1048.95" data-end="1050.85">So I wanted to address another thing.</span> </p>
<p><span data-start="1050.85" data-end="1057.25">When React was first released, there was this big conversation that happened about separation</span> <span data-start="1057.25" data-end="1059.01">of concerns.</span> <span data-start="1059.01" data-end="1066.04">In the creators of React's mind, I think there was this ability to question best practices</span> <span data-start="1066.04" data-end="1069.61">and I'm glad they did it.</span> <span data-start="1069.61" data-end="1077.59">But then also, with the introduction of hooks, which is a way of abstracting logic out of</span> <span data-start="1077.59" data-end="1083.79">components, and suspense, which is going to solve for data fetching and a couple other</span> <span data-start="1083.79" data-end="1092.72">problems, I think we've seen that the component as an abstraction isn't necessarily the best</span> <span data-start="1092.72" data-end="1099.23">abstraction for expressing business logic, or data fetching.</span> <span data-start="1099.23" data-end="1106.049">So I think that this pattern kind of works with that a little bit.</span> <span data-start="1106.049" data-end="1109.84">So this is a scary part in the talk where I need to load an iFrame.</span> <span data-start="1109.84" data-end="1111.679">Oh, my gosh!</span> <span data-start="1111.679" data-end="1112.9">It worked!</span> <span data-start="1112.9" data-end="1113.9">OK.</span> <span data-start="1113.9" data-end="1114.9">Whew!</span> </p>
<p><span data-start="1114.9" data-end="1123.91">So we used this pattern to build out NBC.com and all of its apps, Android, iOS, Roku, and</span> <span data-start="1123.91" data-end="1127.29">the TV app Samsung video.</span> <span data-start="1127.29" data-end="1137.58">So we used this component data to basically render the slideshow here, some shelves, with</span> <span data-start="1137.58" data-end="1142.67">your favorite shows, this is us, any it this is Us fans out there?</span> <span data-start="1142.67" data-end="1144.07">OK.</span> <span data-start="1144.07" data-end="1147.13">How about Will and Grace?</span> <span data-start="1147.13" data-end="1156.82">It's the '90s, OK!</span> </p>
<p><span data-start="1156.82" data-end="1160.95">So we used this pattern at NBC.</span> <span data-start="1160.95" data-end="1172.53">We started out kind of around here with a very data-centric metric API.</span> <span data-start="1172.53" data-end="1176.54">Including and joining kinds of logic.</span> <span data-start="1176.54" data-end="1180.669">This left a lot fort frontends to do and they were all reimplementing basically the same</span> <span data-start="1180.669" data-end="1187.26">queries with basically the same business logic and having to deal with all sorts of denormalization</span> <span data-start="1187.26" data-end="1188.33">on sides.</span> <span data-start="1188.33" data-end="1196.04">They were all doing similar AB tests, and it didn't seem dry when ultimately we wanted</span> <span data-start="1196.04" data-end="1198.88">a consistent experience across platforms.</span> </p>
<p><span data-start="1198.88" data-end="1206.169">So we built this proxy of sorts where we're including and denormallizing data from multiple</span> <span data-start="1206.169" data-end="1214.91">sources, multiple APIs and giving the clients much more to work with and much less responsibility.</span> <span data-start="1214.91" data-end="1221.62">But then has we built this out, we found that what the business wanted was a very powerful</span> <span data-start="1221.62" data-end="1229.76">suite of A/B testing and very quick process-platform A/B testing and feature flagging and reimplementing</span> <span data-start="1229.76" data-end="1235.5">that across platforms was more work than it needed to be.</span> <span data-start="1235.5" data-end="1239.16">So what we did was moved toward components as data where we absorbed that work and we</span> <span data-start="1239.16" data-end="1245.36">absorbed the component library into the back end.</span> <span data-start="1245.36" data-end="1250.83">So some basic components that live in the NBC data model would be, you know, a slideshow</span> <span data-start="1250.83" data-end="1252.49">that contains slides.</span> <span data-start="1252.49" data-end="1256.48">A shelf that might contain a series tile, or a video tile.</span> <span data-start="1256.48" data-end="1259.84">So those are what we're going to be working with our examples here.</span> <span data-start="1259.84" data-end="1265.27">It's a very basic example.</span> <span data-start="1265.27" data-end="1269.63">So we chose GraphQL to implement this pattern, and I think the reason we ultimately did it</span> <span data-start="1269.63" data-end="1273.59">was because of the types and the queries.</span> <span data-start="1273.59" data-end="1281.559">The coupling you of the queries and the types in GraphQL is a perfect match, in my opinion.</span> </p>
<p><span data-start="1281.559" data-end="1289.669">The way that these types need to be shared, especially in the component library as data,</span> <span data-start="1289.669" data-end="1294.42">it was just really powerful to be able to describe those with GraphQL schema.</span> <span data-start="1294.42" data-end="1298.35">And we'll show some benefits of doing that.</span> <span data-start="1298.35" data-end="1303.53">So let's just do a quick overview of what the GraphQL schema looks like for an application</span> <span data-start="1303.53" data-end="1307.049">like this, and this is again a simplified example.</span> <span data-start="1307.049" data-end="1311.33">So we're going to have an interface called component with a component field like we talked</span> <span data-start="1311.33" data-end="1317.33">about earlier, and a treatment field and this treatment field was essentially our quasi — like</span> <span data-start="1317.33" data-end="1324.36">class name field, that works cross-platform, so if we wanted a component to be, you know,</span> <span data-start="1324.36" data-end="1330.5">the primary or the featured type of component, we didn't have to create a whole new component</span> <span data-start="1330.5" data-end="1331.5">for that.</span> <span data-start="1331.5" data-end="1334.97">We could just augment it with this treatment field, like a class.</span> <span data-start="1334.97" data-end="1341.28">Then we have our video tile and the video tile also has a component and treatment field</span> <span data-start="1341.28" data-end="1345.13">and it's going to have a data field like we talked about, and that data field will contain</span> <span data-start="1345.13" data-end="1349.65">like an image, title, secondary title, and percent viewed.</span> </p>
<p><span data-start="1349.65" data-end="1355.58">We decoupled the data from the component for use if another data type might need video</span> <span data-start="1355.58" data-end="1359.2">data.</span> <span data-start="1359.2" data-end="1363.01">So then we have our shelf and a shelf is going to contain tiles.</span> <span data-start="1363.01" data-end="1370.09">So we define a series tile in a similar manner and we union the video and series tile together</span> <span data-start="1370.09" data-end="1376.35">into this tile union and the shelf data, the data for the shelf is going to contain this</span> <span data-start="1376.35" data-end="1382.44">items field, which is basically a slot for tiles to live.</span> <span data-start="1382.44" data-end="1389.04">It's kind of like children, but it's more specifically kind of tied to like a slot of</span> <span data-start="1389.04" data-end="1393.83">components.</span> <span data-start="1393.83" data-end="1398.1">So we're going to introduce this new interface called section, right?</span> <span data-start="1398.1" data-end="1406.38">And you'll see why in a bit, but this section interface is going to kind of delineate a</span> <span data-start="1406.38" data-end="1410.41">shelf component from other types of components.</span> <span data-start="1410.41" data-end="1414.799">It's a component, but it's also a section.</span> <span data-start="1414.799" data-end="1418.69">Same goes for featured: Slideshow is a different type of component.</span> <span data-start="1418.69" data-end="1420.62">It's like a featured component, right?</span> <span data-start="1420.62" data-end="1424.36">And these things might have different properties, different analytics, information, and metadata</span> <span data-start="1424.36" data-end="1430.83">information, and so introducing a new interface makes sense.</span> </p>
<p><span data-start="1430.83" data-end="1432.559">So a slideshow contains slides.</span> <span data-start="1432.559" data-end="1436.18">I think we get the picture there.</span> <span data-start="1436.18" data-end="1439.48">And then finally we're going to have our page type.</span> <span data-start="1439.48" data-end="1443.38">The page type stitches this all together, it takes a featured field, which is going</span> <span data-start="1443.38" data-end="1448.23">to be, you know, like that slideshow up on the top at the home page, for example and</span> <span data-start="1448.23" data-end="1452.9">then the sections field which is essentially going to represent all of the shelves in the</span> </p>
<p><span data-start="1452.9" data-end="1461.34">UI and the query will obviously take the name, user ID for personalization, and a platform.</span> <span data-start="1461.34" data-end="1465.84">So that we can vary the same platform.</span> <span data-start="1465.84" data-end="1467.9">So let's give another example.</span> <span data-start="1467.9" data-end="1472.799">This is what it's going to look like in Apollo Playground.</span> <span data-start="1472.799" data-end="1475.059">So here we have our home page.</span> <span data-start="1475.059" data-end="1478.23">We're using our page field.</span> <span data-start="1478.23" data-end="1484.15">We're querying the home page for user ID loop on platform web and you can see here that</span> <span data-start="1484.15" data-end="1490.159">we're spreading our slideshow fragment into featured, shelf into sections, and as we build</span> <span data-start="1490.159" data-end="1495.289">out more and more components that are of the section's interface, we would add more like</span> <span data-start="1495.289" data-end="1500.039">a group or other types.</span> <span data-start="1500.039" data-end="1506.9">So here we have our fragments that are going to look as you would expect.</span> <span data-start="1506.9" data-end="1511.98">And this is what it looks like to send back a UI tree as JSON.</span> <span data-start="1511.98" data-end="1517.58">We have our page, with our featured section and our sections array.</span> <span data-start="1517.58" data-end="1523.2">And we have our component, called slideshow with items of slides.</span> </p>
<p><span data-start="1523.2" data-end="1528.82">And sections are going to contain our shelf and in this case we have a top picks for you</span> <span data-start="1528.82" data-end="1536.36">shelf, personalized just for you.</span> <span data-start="1536.36" data-end="1539.46">Let's show another example: You don't have to just build out pages this way.</span> <span data-start="1539.46" data-end="1544.86">There's nothing that is forcing you to build out an entire page response.</span> <span data-start="1544.86" data-end="1546.61">You can build out certain features.</span> <span data-start="1546.61" data-end="1549.9">So when I talked about absorbing the business logic, this is kind of what I meant.</span> </p>
<p><span data-start="1549.9" data-end="1555.24">One of the features of NBC.com or really any media-streaming kind of platform is some kind</span> <span data-start="1555.24" data-end="1559.84">of continue watching feature where you can pick up where you've left off the videos you've</span> <span data-start="1559.84" data-end="1561.98">been watching.</span> <span data-start="1561.98" data-end="1567.76">So here we've exposed a continue watching field that just returns the continue watching</span> <span data-start="1567.76" data-end="1574.57">shelf, a bunch of video tiles with some percent viewed, some images, and the UI is going to</span> <span data-start="1574.57" data-end="1588.22">map over this field and generically render its contents.</span> <span data-start="1588.22" data-end="1592.23">So let's talk about this  —  I think that what we're describing here is some sort of design</span> <span data-start="1592.23" data-end="1598.97">schema, where your component libraries is described in terms of GraphQL, in terms of</span> <span data-start="1598.97" data-end="1600.1">a schema.</span> <span data-start="1600.1" data-end="1606.78">And this is, I think, what we are trying to accomplish often when we build a design system,</span> <span data-start="1606.78" data-end="1613.3">is we want rules, we want structure, and this type system ensures that.</span> </p>
<p><span data-start="1613.3" data-end="1618.799">A great example of this is when you throw in the schema and do an open source tool like</span> <span data-start="1618.799" data-end="1626.21">GraphQL Voyager, and you can see kind of this component library described as a graph.</span> <span data-start="1626.21" data-end="1632.01">So let's look at page, which is going to contain featured, and sections.</span> <span data-start="1632.01" data-end="1643.84">So go to sections, where there's a shelf, data, there's our tile union, and then a tile</span> <span data-start="1643.84" data-end="1648.08">could be a video tile or a series tile.</span> <span data-start="1648.08" data-end="1657.23">With their respective data.</span> <span data-start="1657.23" data-end="1661.38">So what does it look like to actually implement this on the front end?</span> </p>
<p><span data-start="1661.38" data-end="1666.24">We showed kind of the back-end implementation and we're going to use React to implement</span> <span data-start="1666.24" data-end="1667.84">this.</span> <span data-start="1667.84" data-end="1669.429">So we'll start with our component library.</span> <span data-start="1669.429" data-end="1673.46">That's how most front-end projects begin and we'll build out a slideshow.</span> <span data-start="1673.46" data-end="1678.34">A slideshow is going to have some state, as to which slide it's currently on.</span> <span data-start="1678.34" data-end="1679.679">A slide number.</span> <span data-start="1679.679" data-end="1685.15">And it's going to receive props and remember that the props here is the data that comes</span> <span data-start="1685.15" data-end="1686.919">from the API.</span> </p>
<p><span data-start="1686.919" data-end="1691.32">So it's going to include this items field.</span> <span data-start="1691.32" data-end="1696.97">So we could map over the items field, and get slides.</span> <span data-start="1696.97" data-end="1703.309">And we're going to generically render the children using this dictionary.</span> <span data-start="1703.309" data-end="1706.75">Passing the data through and the current state of the slide member.</span> <span data-start="1706.75" data-end="1711.24">Here is a boring slide component.</span> </p>
<p><span data-start="1711.24" data-end="1717.43">These are just example snippets here.</span> <span data-start="1717.43" data-end="1722.12">So these dictionaries are where kind of the magic happens here.</span> <span data-start="1722.12" data-end="1726.34">These dictionaries map to the interfaces ins in our schema.</span> <span data-start="1726.34" data-end="1731.97">So you remember our features interface and our sections interface, so we add the respective</span> <span data-start="1731.97" data-end="1738.6">components from the components library into these dictionaries.</span> </p>
<p><span data-start="1738.6" data-end="1745.029">Then when we want to go render a component, we use the respective dictionary, we grab</span> <span data-start="1745.029" data-end="1751.07">the component field, look up the component in the dictionary, and generically render</span> <span data-start="1751.07" data-end="1754.08">it with its data.</span> <span data-start="1754.08" data-end="1759.97">Finally, here's an example of how we could stitch together that full-page query that</span> <span data-start="1759.97" data-end="1766.57">I showed you, where we're using the featured section with the featured dictionary.</span> <span data-start="1766.57" data-end="1773.47">Grabbing out the featured property, and then rendering our sections array, and mapping</span> <span data-start="1773.47" data-end="1779.15">over the sections and rendering whatever component we have.</span> <span data-start="1779.15" data-end="1788.11">So this is, I think, a pretty interesting solution to a hard problem that NBC had.</span> <span data-start="1788.11" data-end="1789.82">And maybe you have it too.</span> <span data-start="1789.82" data-end="1797.22">Here are some of the hard parts: When business logic gets fragmented and you're centralizing</span> <span data-start="1797.22" data-end="1802.7">the business logic, you have to deal with it in a centralized way, and that it can mean</span> <span data-start="1802.7" data-end="1803.929">bloat.</span> </p>
<p><span data-start="1803.929" data-end="1805.51">And something you tried to dry out.</span> <span data-start="1805.51" data-end="1811.919">If you've ever tried to dry code with don't repeat yourself and then it turned out that</span> <span data-start="1811.919" data-end="1816.7">oh, actually, I kind of wanted to repeat myself.</span> <span data-start="1816.7" data-end="1819.52">The same goes with variance across platforms.</span> <span data-start="1819.52" data-end="1832.03">If Android wants that slight tweak or another platform wants another tweak.</span> <span data-start="1832.03" data-end="1839.539">So  we solved those by creating this abstraction</span> <span data-start="1839.539" data-end="1844.1">that we called the conditional resolver and you saw maybe if you're here in the last talk</span> <span data-start="1844.1" data-end="1849.23">what a resolver looks like and a conditional resolver allows you to essentially compose</span> <span data-start="1849.23" data-end="1854.73">an array of resolvers together with some basic conditions that are going to be looking at</span> <span data-start="1854.73" data-end="1862.299">the args off your query, a the variables off your query and the context, as well, and choosing</span> <span data-start="1862.299" data-end="1866.33">the time to run.</span> </p>
<p><span data-start="1866.33" data-end="1868.25">Another thing was pagination.</span> <span data-start="1868.25" data-end="1877.75">So we solved this by creating a lazy shelf that tells the front end, hey, when you render</span> <span data-start="1877.75" data-end="1883.52">this thing, there's not very much to do, but we were able to tell them, hey, implement</span> <span data-start="1883.52" data-end="1888.45">it like this, when you get a lazy shelf, use this query that we're going to give you the</span> <span data-start="1888.45" data-end="1894.059">query name in the lazy shelf data and then use these variables that we're passing to</span> <span data-start="1894.059" data-end="1899.1">you, and when you render, make this call and when you get the callback and the response,</span> <span data-start="1899.1" data-end="1901.76">you'll get a component and you'll swap it out.</span> <span data-start="1901.76" data-end="1907.48">So if you get a lazy shelf, you render it, it fires off a request and returns a shelf</span> <span data-start="1907.48" data-end="1909.69">and then you just swap in the shelf.</span> <span data-start="1909.69" data-end="1915.029">There are some good parts, too.</span> <span data-start="1915.029" data-end="1918.03">This led to vastly simpler front ends.</span> <span data-start="1918.03" data-end="1920.96">it's a different problem set for them to solve.</span> <span data-start="1920.96" data-end="1922.77">It's not easy, don't get me wrong.</span> <span data-start="1922.77" data-end="1924.49">But it's simpler.</span> <span data-start="1924.49" data-end="1931.72">We're also able to centralize business logic which has a lot of pros, lets fragmentation</span> <span data-start="1931.72" data-end="1934.28">and differences across platforms.</span> </p>
<p><span data-start="1934.28" data-end="1948.25">Also, centralizing A/B testing and feature flagging has been a huge boon. same goes for</span> <span data-start="1948.25" data-end="1954.88">feature flagging and releases, we also get this design consistency with a design schema.</span> <span data-start="1954.88" data-end="1959.89">The documentation for a component library for a front end is described in schema, and</span> <span data-start="1959.89" data-end="1966.07">you can use all of these really interesting GraphQL tools out there to document it and</span> <span data-start="1966.07" data-end="1970.25">finally on the server side we're able to do some query optimization and caching that you</span> <span data-start="1970.25" data-end="1975.63">simply wouldn't have been able to do on the front end.</span> <span data-start="1975.63" data-end="1980.669">So here's what I'll leave you with: I'm not saying that everyone should use this pattern.</span> <span data-start="1980.669" data-end="1989.809">In fact, I would caution you against it if you have a very transactional-heavy app or</span> <span data-start="1989.809" data-end="1997.76">if you have a UI that is very form-based, or I think you get what I'm saying.</span> <span data-start="1997.76" data-end="2005.039">If you're serving content or media, and you need to be very swift in *AB tests and you're</span> <span data-start="2005.039" data-end="2008.309">doing that across platforms, this might be a good fit for you.</span> </p>
<p><span data-start="2008.309" data-end="2011.23">It's not for everyone, though.</span> <span data-start="2011.23" data-end="2015.36">And I guess what I'm leaving you with, if you're going to design an API, think outside</span> <span data-start="2015.36" data-end="2016.36">the box.</span> <span data-start="2016.36" data-end="2022.779">You never know what you might come up with and you can have some fun doing it, as well.</span> <span data-start="2022.779" data-end="2023.899">Thanks everyone for having me.</span> </p>
<p><span data-start="2023.899" data-end="2025.11">It's been an honor speaking here.</span> <span data-start="2025.11" data-end="2028.75">Thank you to the conference organizers and come talk to me afterwards.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
