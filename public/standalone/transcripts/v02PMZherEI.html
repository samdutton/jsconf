<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>v02PMZherEI</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/v02PMZherEI?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.03" data-end="3.389">and yeah so how did we do the whole</span> <span data-start="3.389" data-end="5.19">thing because now we know what we use</span> <span data-start="5.19" data-end="6.99">but we don't really know how to attack a</span> <span data-start="6.99" data-end="9.929">coffee machine so neither me nor my</span> <span data-start="9.929" data-end="11.91">flatmate are electrical engineers I did</span> <span data-start="11.91" data-end="13.92">like two semesters in university but</span> <span data-start="13.92" data-end="15.9">like most of the people here probably if</span> <span data-start="15.9" data-end="18.66">you didn't do a topic for years you tend</span> <span data-start="18.66" data-end="21.3">to forget everything or most of it as</span> <span data-start="21.3" data-end="23.369">you will see throughout the process that</span> <span data-start="23.369" data-end="26.97">I clearly forgot a lot and so we did</span> <span data-start="26.97" data-end="28.98">what most people would do when they when</span> <span data-start="28.98" data-end="30.689">they figure something out that they have</span> <span data-start="30.689" data-end="32.43">no clue about we just opened this thing</span> <span data-start="32.43" data-end="34.559">so we took out all the screws that were</span> <span data-start="34.559" data-end="36.95">there literally all the screws initially</span> <span data-start="36.95" data-end="39.3">that were like from the casing so we</span> <span data-start="39.3" data-end="40.829">took all sides out even though we were</span> <span data-start="40.829" data-end="43.14">only interested on this side and there</span> <span data-start="43.14" data-end="44.94">were a couple of things here that were</span> <span data-start="44.94" data-end="47.37">of interest for us and they were all in</span> <span data-start="47.37" data-end="50.01">that corner um so the whole machine can</span> <span data-start="50.01" data-end="51.87">be controlled it has a major power</span> <span data-start="51.87" data-end="53.699">switch on the back but all the other</span> <span data-start="53.699" data-end="56.129">controls are on the right side of the</span> <span data-start="56.129" data-end="59.699">coffee machine and our buttons so we</span> <span data-start="59.699" data-end="61.35">have the buttons here and then we have a</span> <span data-start="61.35" data-end="62.699">micro controller that does the actual</span> <span data-start="62.699" data-end="65.18">work and we have this interesting cable</span> <span data-start="65.18" data-end="67.619">that connects the two and it was</span> <span data-start="67.619" data-end="70.439">interesting because it was an actual</span> <span data-start="70.439" data-end="72.78">cable they weren't soldered together or</span> <span data-start="72.78" data-end="75.27">something was like a pretty big cable</span> <span data-start="75.27" data-end="76.979">that we could just unplug so we did that</span> <span data-start="76.979" data-end="80.15">and we just took out the whole thing and</span> <span data-start="80.15" data-end="82.74">this is what we ended up with so this is</span> <span data-start="82.74" data-end="84.689">the actual control panel of the button</span> <span data-start="84.689" data-end="90.42">and it allows you to basically have</span> <span data-start="90.42" data-end="92.189">eight pins down there that's where the</span> <span data-start="92.189" data-end="93.75">cable plugged in and then you have seven</span> </p>
<p><span data-start="93.75" data-end="95.79">LEDs that are on the one hand used to</span> <span data-start="95.79" data-end="98.46">show state but they also use for error</span> <span data-start="98.46" data-end="100.829">messages etc and then you have those six</span> <span data-start="100.829" data-end="102.72">buttons so the bottom right one is the</span> <span data-start="102.72" data-end="103.92">important one that's power</span> <span data-start="103.92" data-end="106.56">the top one top right one is espresso</span> <span data-start="106.56" data-end="109.14">and the top and the right one in the</span> <span data-start="109.14" data-end="112.68">middle is is a normal coffee the left</span> <span data-start="112.68" data-end="115.74">ones are for for milk coffees etc also</span> <span data-start="115.74" data-end="117.329">we didn't we didn't focus on them</span> <span data-start="117.329" data-end="120.54">initially and this is the interesting</span> <span data-start="120.54" data-end="122.39">table unfortunately didn't have a</span> <span data-start="122.39" data-end="124.649">picture of the original setup so this</span> <span data-start="124.649" data-end="125.79">would be actually the picture of the</span> <span data-start="125.79" data-end="128.19">final setup that's where that's why we</span> <span data-start="128.19" data-end="129.929">have nice tape around it but basically</span> <span data-start="129.929" data-end="131.459">what we did is we took one side of the</span> <span data-start="131.459" data-end="131.819">cable</span> <span data-start="131.819" data-end="133.17">we just jammed in a bunch of jumper</span> <span data-start="133.17" data-end="135.629">wires so we could connect that to to the</span> <span data-start="135.629" data-end="138.51">temple or later into the into a</span> <span data-start="138.51" data-end="143.129">breadboard and then we we sat down and</span> <span data-start="143.129" data-end="145.109">thought about what do we actually know</span> <span data-start="145.109" data-end="146.879">about this board so we have eight cables</span> <span data-start="146.879" data-end="149.28">or eight pins that we want to control we</span> <span data-start="149.28" data-end="150.989">have six switches and we have seven LEDs</span> <span data-start="150.989" data-end="153.87">now the idea that we had was well we</span> <span data-start="153.87" data-end="155.639">have a cable so we can connect this to</span> <span data-start="155.639" data-end="157.23">the tehsil and we can figure out what</span> <span data-start="157.23" data-end="160.019">protocol is being spoken between this</span> <span data-start="160.019" data-end="162.84">control plate and the microprocessor we</span> <span data-start="162.84" data-end="164.849">can spoof this and then just let the</span> <span data-start="164.849" data-end="168.03">tehsil sent this protocol so basically</span> <span data-start="168.03" data-end="171.959">what our idea was is that we have power</span> <span data-start="171.959" data-end="177.09">going in from one pin and then we have</span> <span data-start="177.09" data-end="179.609">at least three pins that must represent</span> <span data-start="179.609" data-end="182.01">the buttons because say we have six pins</span> <span data-start="182.01" data-end="184.98">or six buttons we could use like a</span> <span data-start="184.98" data-end="187.379">binary flag and just represented with</span> <span data-start="187.379" data-end="189.569">three pins and then we have three pins</span> <span data-start="189.569" data-end="191.79">to control the LEDs but what is the</span> <span data-start="191.79" data-end="193.709">eighth cable for because our math</span> <span data-start="193.709" data-end="195.15">doesn't really add up here</span> <span data-start="195.15" data-end="197.31">but we figured let's let's go for the</span> <span data-start="197.31" data-end="199.5">assumptions and try naive approach so</span> <span data-start="199.5" data-end="203.159">this is the script to control the castle</span> <span data-start="203.159" data-end="205.079">using johnny-five</span> <span data-start="205.079" data-end="207.72">so we import the johnny-five library and</span> <span data-start="207.72" data-end="211.199">then we are import the tesla Isle plugin</span> <span data-start="211.199" data-end="214.139">so that allows us to communicate with</span> <span data-start="214.139" data-end="216.06">the johnny-five library and the tehsil</span> <span data-start="216.06" data-end="218.669">and then once the board is ready we just</span> <span data-start="218.669" data-end="222.09">create seven pins we admit omitted the</span> <span data-start="222.09" data-end="224.159">one that we connected to five poles</span> <span data-start="224.159" data-end="226.799">because 3.3 volts didn't lit up the LEDs</span> <span data-start="226.799" data-end="228.689">5 volts did so you can see how</span> <span data-start="228.689" data-end="230.22">scientifically we approach this whole</span> <span data-start="230.22" data-end="234.509">thing and then we set them to analog</span> <span data-start="234.509" data-end="236.75">mode so the idea was can we figure out</span> <span data-start="236.75" data-end="239.969">if the analog mode measures the voltage</span> <span data-start="239.969" data-end="242.31">on the pin so we could see if there is a</span> <span data-start="242.31" data-end="244.229">voltage difference when we press a</span> <span data-start="244.229" data-end="247.709">button for example and then we injected</span> <span data-start="247.709" data-end="249.239">them in the repple because journey 5 has</span> <span data-start="249.239" data-end="250.739">a nice rattle so when we start off the</span> <span data-start="250.739" data-end="253.5">script we can interact with that so we</span> <span data-start="253.5" data-end="254.939">just measured the values and</span> <span data-start="254.939" data-end="258">unfortunately analog pins are very good</span> <span data-start="258" data-end="260.4">and fluctuating so we couldn't get a</span> <span data-start="260.4" data-end="262.32">proper value out of this so we had to</span> <span data-start="262.32" data-end="264.51">you tweak this slightly and take out</span> <span data-start="264.51" data-end="266.79">this analog mode and turn it into a</span> <span data-start="266.79" data-end="268.8">digital pin so the difference is you can</span> <span data-start="268.8" data-end="271.41">only set a digital pin to high or low</span> <span data-start="271.41" data-end="273.36">and you can only read high or low so</span> <span data-start="273.36" data-end="277.77">it's 1 or 0 and we did that and we</span> <span data-start="277.77" data-end="279.51">figure it out so when we just plug in</span> <span data-start="279.51" data-end="282.27">power we have the three of the right</span> </p>
<p><span data-start="282.27" data-end="286.56">LEDs glowing up so that's good that part</span> <span data-start="286.56" data-end="289.26">seems to be power and if we turn off</span> <span data-start="289.26" data-end="291.48">three of the pins we can actually turn</span> <span data-start="291.48" data-end="293.94">off these three LEDs all the other ones</span> <span data-start="293.94" data-end="296.01">didn't work we we literally wrote a</span> <span data-start="296.01" data-end="297.33">binary flag that went through all</span> <span data-start="297.33" data-end="300.02">combinations but we couldn't get them on</span> <span data-start="300.02" data-end="303.3">but we knew that when you four pins now</span> <span data-start="303.3" data-end="305.01">we knew one is power and three can</span> <span data-start="305.01" data-end="306.72">control the LEDs so we're getting close</span> <span data-start="306.72" data-end="311.07">to our our initial assumption so what we</span> <span data-start="311.07" data-end="312.69">did with the other four pins was we</span> <span data-start="312.69" data-end="314.28">declared them as button so johnny-five</span> <span data-start="314.28" data-end="317.58">has a has a button clasp in it that</span> <span data-start="317.58" data-end="319.38">allows us to really use the power of</span> </p>
<p><span data-start="319.38" data-end="322.53">JavaScript by having our event listeners</span> <span data-start="322.53" data-end="324.6">on press and release so this is where</span> <span data-start="324.6" data-end="326.34">javascript is really cool for hardware</span> <span data-start="326.34" data-end="329.12">hacking because we can say listen for</span> <span data-start="329.12" data-end="331.62">whenever a button is pressed or when</span> <span data-start="331.62" data-end="334.8">it's released and it's just way easier</span> <span data-start="334.8" data-end="336.78">than writing a loop and figuring out of</span> <span data-start="336.78" data-end="340.29">the value changed and we did this and it</span> <span data-start="340.29" data-end="343.44">was some notes that we took in the</span> <span data-start="343.44" data-end="345.78">meantime and I could go through them but</span> <span data-start="345.78" data-end="347.97">they all don't mean anything but we were</span> <span data-start="347.97" data-end="349.71">onto something because we knew that pin</span> <span data-start="349.71" data-end="353.04">one was power 4 2 5 and 7 the LEDs were</span> <span data-start="353.04" data-end="355.08">able we were able to control through</span> <span data-start="355.08" data-end="358.83">pins 4 to 6 but the weird part was 7 & 8</span> <span data-start="358.83" data-end="360.65">were the only ones reacting on buttons</span> <span data-start="360.65" data-end="364.65">so whenever we press the bottom right</span> <span data-start="364.65" data-end="365.13">one</span> <span data-start="365.13" data-end="367.68">they were triggering 7 & 8 respectively</span> <span data-start="367.68" data-end="370.64">when we press the top two ones they</span> <span data-start="370.64" data-end="373.65">progressive and eight and if we set if</span> <span data-start="373.65" data-end="379.26">it helped set one bit to high we would</span> <span data-start="379.26" data-end="380.85">be able to trigger the other two as well</span> <span data-start="380.85" data-end="384.09">so we could use pin 2 & 3 to turn off</span> <span data-start="384.09" data-end="385.95">the buttons left and right but that's</span> <span data-start="385.95" data-end="387.54">not what we wanted right we want to be</span> <span data-start="387.54" data-end="390.689">able to figure out if that button was</span> <span data-start="390.689" data-end="392.399">but we could just figure out if one of</span> <span data-start="392.399" data-end="395.249">three of if one of three buttons has</span> <span data-start="395.249" data-end="399.629">been pressed which meant that that was</span> <span data-start="399.629" data-end="401.61">pretty useless so we had to go back to</span> <span data-start="401.61" data-end="403.919">the drawing board quite literally so we</span> <span data-start="403.919" data-end="406.739">took a picture of this for the first</span> <span data-start="406.739" data-end="408.239">time because I mean the plate is like</span> <span data-start="408.239" data-end="409.229">this big</span> <span data-start="409.229" data-end="411.36">and we're like looking at it like this</span> <span data-start="411.36" data-end="413.789">the whole time so we figured maybe</span> <span data-start="413.789" data-end="415.649">taking a picture is a bit more</span> <span data-start="415.649" data-end="417.899">productive so we took a picture zoomed</span> <span data-start="417.899" data-end="419.849">into it and then use the software called</span> </p>
<p><span data-start="419.849" data-end="422.129">Fritzing that you can use to create</span> <span data-start="422.129" data-end="425.399">diagrams and we turned this into this</span> <span data-start="425.399" data-end="429.479">beautiful diagram and it looks like a</span> <span data-start="429.479" data-end="431.219">mess and it is a mess because what we</span> <span data-start="431.219" data-end="434.819">did is we assumed into the picture and I</span> <span data-start="434.819" data-end="437.009">went to said okay I'm going to go from</span> <span data-start="437.009" data-end="440.519">this pin to this pin because they might</span> <span data-start="440.519" data-end="443.579">be connected and then my flatmates used</span> <span data-start="443.579" data-end="446.249">a multimeter to measure the resistance</span> <span data-start="446.249" data-end="448.529">between these two parts and if the</span> <span data-start="448.529" data-end="450.059">resistance is zero that means the two</span> <span data-start="450.059" data-end="453.629">pins are connected our approach meant</span> <span data-start="453.629" data-end="455.309">that we had to go from resistor to</span> <span data-start="455.309" data-end="457.619">resistor as well so that's what we left</span> <span data-start="457.619" data-end="459.779">out all the resistors on this thing or</span> <span data-start="459.779" data-end="463.709">what we deemed were resistors and while</span> <span data-start="463.709" data-end="465.3">this looks like a mess this was way more</span> <span data-start="465.3" data-end="466.919">useful for us because we could finally</span> <span data-start="466.919" data-end="470.579">figure out that not only pour a pin one</span> <span data-start="470.579" data-end="472.439">was power but pin two and three were</span> <span data-start="472.439" data-end="474.3">power as well and that was the reason</span> <span data-start="474.3" data-end="476.339">why the other LEDs never laid on because</span> <span data-start="476.339" data-end="479.009">we had to put five volts on this pin in</span> <span data-start="479.009" data-end="481.86">order to actually see that this that</span> <span data-start="481.86" data-end="484.709">these LEDs light up and the process of</span> <span data-start="484.709" data-end="486.749">figuring this out we'd burn two of the</span> </p>
<p><span data-start="486.749" data-end="491.189">LEDs though so by figuring out hey what</span> <span data-start="491.189" data-end="492.959">if we connect five volts directly to</span> <span data-start="492.959" data-end="497.459">this LED we that was I'd like 4 a.m. so</span> <span data-start="497.459" data-end="501.229">we were slightly slightly tired so we</span> <span data-start="501.229" data-end="503.789">broke two but in the end all of them</span> <span data-start="503.789" data-end="506.339">that were still working lit up so that</span> <span data-start="506.339" data-end="509.459">was a good approach but the switches</span> <span data-start="509.459" data-end="512.159">still showed the same problem we knew</span> <span data-start="512.159" data-end="515.009">that 1 2 3 R power 4 to 6 or LEDs so we</span> <span data-start="515.009" data-end="516.389">were able to finally flick on the</span> <span data-start="516.389" data-end="519.209">different LEDs but 7 to 8 we're still</span> <span data-start="519.209" data-end="521.39">the only ones that react to buttons</span> <span data-start="521.39" data-end="523.64">and we can't figure out which button was</span> <span data-start="523.64" data-end="527.72">pressed by just having two bit and so we</span> <span data-start="527.72" data-end="529.58">realized that three of these things</span> <span data-start="529.58" data-end="532.7">aren't LEDs does anyone have an idea</span> <span data-start="532.7" data-end="533.6">what this is</span> </p>
<p><span data-start="533.6" data-end="535.58">I mean it's written there but does</span> <span data-start="535.58" data-end="538.28">anyone know what it diet is alright one</span> <span data-start="538.28" data-end="541.46">person so diets are a few people so</span> <span data-start="541.46" data-end="543.62">diets are similar to LEDs they have one</span> <span data-start="543.62" data-end="546.98">property which is the current can only</span> <span data-start="546.98" data-end="549.95">flow into one direction to be and the</span> <span data-start="549.95" data-end="552.26">other directions blocked so an LED does</span> <span data-start="552.26" data-end="556.79">that and light up light up but diet will</span> <span data-start="556.79" data-end="559.37">just control the current going only in</span> <span data-start="559.37" data-end="562.55">one direction so we drop the LEDs from</span> <span data-start="562.55" data-end="564.65">the diagram and we added the three diets</span> <span data-start="564.65" data-end="566.45">and suddenly stuff made more sense we</span> <span data-start="566.45" data-end="568.76">could because we could follow the power</span> <span data-start="568.76" data-end="572.57">and we could see where it went and this</span> <span data-start="572.57" data-end="574.04">was super useful because we finally</span> <span data-start="574.04" data-end="576.62">figured out that there was a mapping and</span> <span data-start="576.62" data-end="578.33">the mapping was ATS which one was</span> <span data-start="578.33" data-end="580.97">connected between P 3 and P 7 switch to</span> <span data-start="580.97" data-end="583.76">was P 3 to P 8 and you see that all of</span> <span data-start="583.76" data-end="585.47">them are connected ultimately to seven</span> <span data-start="585.47" data-end="588.08">or eight so that that finally explained</span> <span data-start="588.08" data-end="590.72">why we you could only listen to the two</span> <span data-start="590.72" data-end="592.97">it gave us the same gave up a problem</span> <span data-start="592.97" data-end="594.8">though that all of these switches were</span> <span data-start="594.8" data-end="598.88">dependent on the input as well and that</span> <span data-start="598.88" data-end="600.77">meant we can fake the protocol we can</span> <span data-start="600.77" data-end="603.71">just send in high low high low to tell</span> <span data-start="603.71" data-end="606.56">it what button was pressed but we had a</span> <span data-start="606.56" data-end="608.99">useful thing at home that we've bought</span> <span data-start="608.99" data-end="612.47">kind of in luckily right before the</span> <span data-start="612.47" data-end="614.15">attack and those were relays</span> <span data-start="614.15" data-end="616.79">so relays are digital switches like</span> <span data-start="616.79" data-end="620.27">electronic switches that you can use for</span> <span data-start="620.27" data-end="621.92">example microcontroller like the tehsil</span> <span data-start="621.92" data-end="624.56">to flick them rather than having to</span> <span data-start="624.56" data-end="626.81">press them so what we did is we wired</span> <span data-start="626.81" data-end="629.18">the cable from the coffee machine into a</span> <span data-start="629.18" data-end="631.88">breadboard and then from there we</span> <span data-start="631.88" data-end="634.7">reconstructed the same setup that we had</span> <span data-start="634.7" data-end="638.45">here on just with the relays instead so</span> <span data-start="638.45" data-end="640.58">we only had four relate so we decided to</span> <span data-start="640.58" data-end="642.5">map only the three right buttons and</span> <span data-start="642.5" data-end="647.15">left out the left left three and we also</span> <span data-start="647.15" data-end="649.73">wired up these LEDs to these three LEDs</span> <span data-start="649.73" data-end="652.55">to show up which status it is in so that</span> <span data-start="652.55" data-end="653.99">we know whether the coffee machine is</span> <span data-start="653.99" data-end="654.98">heating right now</span> <span data-start="654.98" data-end="660.11">etc so this was the initial wire up we</span> <span data-start="660.11" data-end="662.24">had to be very careful to not touch the</span> <span data-start="662.24" data-end="665.959">hot coffee machine while testing it even</span> <span data-start="665.959" data-end="667.16">though my flatmate I think brewing</span> <span data-start="667.16" data-end="671.269">himself twice and then we scripted a</span> <span data-start="671.269" data-end="673.42">small manual script to control this and</span> <span data-start="673.42" data-end="675.709">basically what we did is we leveraged</span> <span data-start="675.709" data-end="677.589">the fact that there's also a relay class</span> <span data-start="677.589" data-end="680.24">we connected it we said on which port</span> <span data-start="680.24" data-end="683.42">where were connected to so we connected</span> <span data-start="683.42" data-end="685.16">to normally open which means by default</span> <span data-start="685.16" data-end="689.18">the switch is open and then we just</span> <span data-start="689.18" data-end="691.339">close them immediately and injected the</span> <span data-start="691.339" data-end="693.98">whole thing into the repple so that we</span> <span data-start="693.98" data-end="696.41">can control it and I hope the video</span> <span data-start="696.41" data-end="700.13">works so we ran grande open at like 5</span> <span data-start="700.13" data-end="703.16">a.m. we started editing at 8 p.m. and it</span> <span data-start="703.16" data-end="704.72">started running water it's a bit hard to</span> <span data-start="704.72" data-end="706.579">see we didn't put coffee in it because</span> <span data-start="706.579" data-end="708.38">we weren't sure yet if it works and we</span> <span data-start="708.38" data-end="710.29">didn't want to waste coffee and once it</span> <span data-start="710.29" data-end="712.76">once your trigger grinder closed it's</span> <span data-start="712.76" data-end="714.94">going to it's going to close again</span> <span data-start="714.94" data-end="718.97">alright um cool so once we were done</span> <span data-start="718.97" data-end="720.529">with that we just locked up the whole</span> <span data-start="720.529" data-end="723.23">thing um closed it again properly put</span> <span data-start="723.23" data-end="725.149">the sides back on and use the fact that</span> <span data-start="725.149" data-end="727.13">now that we remove the buttons we had</span> <span data-start="727.13" data-end="729.649">some holes there so we just wired the</span> <span data-start="729.649" data-end="731.63">cable through it put a button on it</span> <span data-start="731.63" data-end="735.62">that's the Johnny Five logo and then</span> <span data-start="735.62" data-end="737.899">wires the whole stuff on top so that in</span> <span data-start="737.899" data-end="741.05">theory we could even unplug the cables</span> <span data-start="741.05" data-end="743.06">here now and plug back in the control</span> <span data-start="743.06" data-end="744.589">plate and we could use the coffee</span> <span data-start="744.589" data-end="746.269">machine as intended without having</span> <span data-start="746.269" data-end="748.61">broken it because we didn't solder</span> <span data-start="748.61" data-end="751.55">anything but we still don't have an i/o</span> <span data-start="751.55" data-end="753.29">tea coffee machine wrap we were able to</span> <span data-start="753.29" data-end="755.209">control this with JavaScript but we</span> <span data-start="755.209" data-end="759.139">aren't able to have something that's</span> <span data-start="759.139" data-end="761.93">connected to the internet yet and this</span> <span data-start="761.93" data-end="763.85">is where my favourite status code comes</span> <span data-start="763.85" data-end="767.149">in for 18 I'm a teapot I don't know if</span> <span data-start="767.149" data-end="769.63">you've heard of this before this is a</span> <span data-start="769.63" data-end="772.43">suggested HTTP status code it's not an</span> <span data-start="772.43" data-end="774.769">official one but some people use it so</span> <span data-start="774.769" data-end="776.449">if you go to google.com slash</span> <span data-start="776.449" data-end="778.73">teapot it actually returns that HTTP</span> <span data-start="778.73" data-end="783.5">status code um and it was suggested in</span> <span data-start="783.5" data-end="787.79">the IETF RFC to 3 to 4 which is the HTC</span> </p>
<p><span data-start="787.79" data-end="790.49">CP or in other words the hypertext</span> <span data-start="790.49" data-end="793.85">coffeepot control protocol which was</span> <span data-start="793.85" data-end="797.3">suggested on April 1st 1998 and this</span> <span data-start="797.3" data-end="799.16">gives you an idea why we actually hacked</span> <span data-start="799.16" data-end="800.78">our coffee machine last weekend because</span> <span data-start="800.78" data-end="803.3">we're approaching April 1st and we</span> <span data-start="803.3" data-end="805.46">figure it is a good point to to</span> <span data-start="805.46" data-end="808.1">implement this protocol so we took this</span> <span data-start="808.1" data-end="809.93">protocol actually and implemented it or</span> <span data-start="809.93" data-end="811.94">parts of it but I first want to give you</span> <span data-start="811.94" data-end="814.88">an overview of it so it's it's based on</span> <span data-start="814.88" data-end="817.22">top of HTTP so you can use gaps and post</span> <span data-start="817.22" data-end="819.29">like there used to you can also use the</span> <span data-start="819.29" data-end="821.75">new method brew it's not limited to</span> <span data-start="821.75" data-end="823.79">copper to the coffee protocol though</span> <span data-start="823.79" data-end="826.96">either just in case you want to derive a</span> <span data-start="826.96" data-end="830.09">beer brewing protocol the RFC suggests</span> <span data-start="830.09" data-end="833.21">you could use the same method it suggest</span> <span data-start="833.21" data-end="835.43">you use a safe header to recommend</span> <span data-start="835.43" data-end="837.71">whether you can do the same operation</span> <span data-start="837.71" data-end="839.12">again so you can use this with</span> <span data-start="839.12" data-end="841.04">conditionals as well like if user is</span> <span data-start="841.04" data-end="843.07">awake you can't through another coffee</span> <span data-start="843.07" data-end="846.35">and it adds a new except additions</span> <span data-start="846.35" data-end="849.31">headers so you can add milk or serve or</span> <span data-start="849.31" data-end="851.53">alcohol to your coffee</span> <span data-start="851.53" data-end="855.41">it suggests the HTTP status code for 18</span> <span data-start="855.41" data-end="858.02">in case you try to talk to a copy to a</span> <span data-start="858.02" data-end="860.27">teapot rather than a coffee pot with</span> <span data-start="860.27" data-end="863.3">your instructions and obviously we need</span> <span data-start="863.3" data-end="866.24">to be able to address them so it defines</span> <span data-start="866.24" data-end="869.78">a URI scheme as well and many more</span> <span data-start="869.78" data-end="871.34">things this is actually the definition</span> <span data-start="871.34" data-end="873.89">of the except additions header fields so</span> <span data-start="873.89" data-end="875.81">with milk type syrup type sweetener type</span> <span data-start="875.81" data-end="878.75">spice type and alcohol type on sweetener</span> <span data-start="878.75" data-end="882.05">and spice type are not defined as what</span> <span data-start="882.05" data-end="884.03">is limited to that's probably great for</span> </p>
<p><span data-start="884.03" data-end="886.4">Starbucks so they can still use this if</span> <span data-start="886.4" data-end="889.21">they want to do pumpkin spice lattes um</span> <span data-start="889.21" data-end="891.62">but yeah that's basically what they</span> <span data-start="891.62" data-end="892.19">recommend</span> <span data-start="892.19" data-end="894.23">this is a coffee your eye scheme and I'm</span> <span data-start="894.23" data-end="896.24">happy that the screen is so big because</span> <span data-start="896.24" data-end="898.34">my favorite part is this so that's the</span> <span data-start="898.34" data-end="899.99">German one and you can see it starts</span> <span data-start="899.99" data-end="903.08">with like in person for be the reason I</span> <span data-start="903.08" data-end="905.03">cut it actually out is written below is</span> <span data-start="905.03" data-end="908.99">that they're internationalized and it</span> <span data-start="908.99" data-end="911.33">insists on that you use a capital K for</span> <span data-start="911.33" data-end="913.34">coffee if you're using the German</span> <span data-start="913.34" data-end="916.49">protocol so you need to escape that by</span> <span data-start="916.49" data-end="919.52">using person for B and then we have a</span> <span data-start="919.52" data-end="920.71">pod integer</span> <span data-start="920.71" data-end="923.14">you can add additions to it the great</span> <span data-start="923.14" data-end="925.149">thing is it's a life we actually have</span> <span data-start="925.149" data-end="928.81">something working and I'm going to do a</span> <span data-start="928.81" data-end="930.46">demo so I'm going to switch to my lovely</span> <span data-start="930.46" data-end="934">coffee machine here I couldn't bring my</span> <span data-start="934" data-end="935.74">actual coffee machine because my flat</span> <span data-start="935.74" data-end="937.68">net would have been really mad</span> <span data-start="937.68" data-end="939.399">especially if I wouldn't have gotten</span> <span data-start="939.399" data-end="941.74">this talking so I brought this coffee</span> <span data-start="941.74" data-end="943.839">machine here it's a fake coffee machine</span> <span data-start="943.839" data-end="946.709">it's basically a bunch of LEDs that</span> <span data-start="946.709" data-end="949.899">somebody will simulate the three buttons</span> <span data-start="949.899" data-end="951.91">that we would press so you can see that</span> <span data-start="951.91" data-end="953.44">the button of the fake buttons are</span> <span data-start="953.44" data-end="956.89">pressed and then we have the script here</span> <span data-start="956.89" data-end="959.62">and we have the script running or any is</span> <span data-start="959.62" data-end="962.47">basically an HTTP server so there's</span> <span data-start="962.47" data-end="964.33">nothing Hardware specific in this script</span> </p>
<p><span data-start="964.33" data-end="966.94">I'm using local tunnel to create an</span> <span data-start="966.94" data-end="970.709">address that we can externally at access</span> <span data-start="970.709" data-end="974.95">and basically once we have that all set</span> <span data-start="974.95" data-end="976.45">up we set up the coffee machine and when</span> <span data-start="976.45" data-end="978.79">that is ready we can use it and then we</span> <span data-start="978.79" data-end="980.26">just handle the request so what you can</span> <span data-start="980.26" data-end="981.97">see we check if the coffee machine is</span> <span data-start="981.97" data-end="983.529">actually a teapot just in case</span> <span data-start="983.529" data-end="987.13">we've get methods that respond with the</span> <span data-start="987.13" data-end="989.05">appropriate coffee message coffee pot</span> <span data-start="989.05" data-end="990.97">content type which is one that is</span> <span data-start="990.97" data-end="994">suggested in the protocol we also have</span> <span data-start="994" data-end="996.55">post and brew I don't think the HTTP</span> <span data-start="996.55" data-end="998.709">from node supports grew but I didn't try</span> <span data-start="998.709" data-end="1002.31">that yet we set the headers armed and</span> <span data-start="1002.31" data-end="1004.8">yeah we check for all this stuff like</span> <span data-start="1004.8" data-end="1006.42">the correct content type we check for</span> <span data-start="1006.42" data-end="1008.1">the accept additions unfortunately our</span> <span data-start="1008.1" data-end="1009.51">coffee machine doesn't support any</span> <span data-start="1009.51" data-end="1014.37">additions yet but it will come and yeah</span> <span data-start="1014.37" data-end="1016.709">so let's do a quick demo I'm going to</span> <span data-start="1016.709" data-end="1018.39">make this a bit bigger so I have my</span> <span data-start="1018.39" data-end="1020.16">authorization here it talks about</span> <span data-start="1020.16" data-end="1022.14">security in the RFC but I wasn't really</span> <span data-start="1022.14" data-end="1023.88">sure what they weren't really specific</span> <span data-start="1023.88" data-end="1025.86">what's the best authorization is so I</span> <span data-start="1025.86" data-end="1027.8">just have like I created my own header</span> <span data-start="1027.8" data-end="1031.86">and then we specify the content type so</span> </p>
<p><span data-start="1031.86" data-end="1034.62">I'm going to do a get actually to pot 0</span> <span data-start="1034.62" data-end="1038.61">so that should tell us if the internet</span> <span data-start="1038.61" data-end="1042.15">isn't too slow like local tunnel is</span> <span data-start="1042.15" data-end="1043.92">sometimes a bit slow there we go</span> <span data-start="1043.92" data-end="1045.39">currently the coffee machine is on</span> <span data-start="1045.39" data-end="1048.48">that's great now I had to improvise with</span> <span data-start="1048.48" data-end="1050.85">the URI scheme a bit because it doesn't</span> <span data-start="1050.85" data-end="1053.53">suggest like it's a copy pod</span> <span data-start="1053.53" data-end="1055.57">supports multiple versions or copies</span> <span data-start="1055.57" data-end="1057.88">which at not in 1998 wasn't really</span> <span data-start="1057.88" data-end="1061.66">common so I extended the thing a bit so</span> <span data-start="1061.66" data-end="1063.25">we can order an espresso and now you</span> <span data-start="1063.25" data-end="1066.19">should look at the LEDs so I'm going to</span> <span data-start="1066.19" data-end="1069.58">do a post request to the LEDs I'm going</span> <span data-start="1069.58" data-end="1075.61">to specify start and there we go the LED</span> <span data-start="1075.61" data-end="1079.18">lit up and the same port run there we</span> <span data-start="1079.18" data-end="1080.68">have the problem that right now we</span> <span data-start="1080.68" data-end="1083.73">aren't able to measure whether the</span> <span data-start="1083.73" data-end="1086.5">status is the right one like whether</span> <span data-start="1086.5" data-end="1088.18">it's currently brewing a coffee or not</span> <span data-start="1088.18" data-end="1091.48">we could figure this out by checking</span> <span data-start="1091.48" data-end="1094.09">what the value on the LEDs are on the</span> <span data-start="1094.09" data-end="1095.53">respective ones that we have on the</span> <span data-start="1095.53" data-end="1097.78">original board but the problem there is</span> <span data-start="1097.78" data-end="1100.63">that we would literally like the current</span> <span data-start="1100.63" data-end="1101.86">solution that we could only come up with</span> <span data-start="1101.86" data-end="1104.02">is having a photo sensor measure whether</span> <span data-start="1104.02" data-end="1107.32">literally the LED is on because we don't</span> <span data-start="1107.32" data-end="1109.15">share a common ground between the tehsil</span> <span data-start="1109.15" data-end="1111.46">and coffee machine so we can't measure</span> <span data-start="1111.46" data-end="1113.44">the values if you want to know more</span> <span data-start="1113.44" data-end="1114.82">about that we can talk about that later</span> <span data-start="1114.82" data-end="1119.74">over coffee and yeah so we can also turn</span> <span data-start="1119.74" data-end="1122.53">this whole thing off so that should</span> <span data-start="1122.53" data-end="1125.92">trigger the other one boom so that all</span> <span data-start="1125.92" data-end="1128.35">worked let's quickly look at the actual</span> <span data-start="1128.35" data-end="1132.19">coffee code so what we do is we similar</span> <span data-start="1132.19" data-end="1135.19">to the manual script we just initialize</span> <span data-start="1135.19" data-end="1137.23">the different relays that we're</span> <span data-start="1137.23" data-end="1139.39">connected to and then we have a press</span> <span data-start="1139.39" data-end="1140.95">power method which just checks if it's</span> <span data-start="1140.95" data-end="1142.66">on which currently is just a fake</span> <span data-start="1142.66" data-end="1144.37">because I know it's like it takes 20</span> <span data-start="1144.37" data-end="1146.29">seconds roughly to heat up so I'm</span> <span data-start="1146.29" data-end="1149.98">waiting for 21 seconds until it's on and</span> <span data-start="1149.98" data-end="1151.75">then we have a switch method and all of</span> <span data-start="1151.75" data-end="1153.85">them call this press baton method which</span> <span data-start="1153.85" data-end="1156.94">in order to simulate a button press we</span> <span data-start="1156.94" data-end="1159.85">just open the relay wait for 500</span> <span data-start="1159.85" data-end="1162.13">milliseconds and then close it again the</span> <span data-start="1162.13" data-end="1163.81">reason for that is if we would just keep</span> <span data-start="1163.81" data-end="1165.97">it open it would just continue running</span> <span data-start="1165.97" data-end="1167.86">until we close it again but if we only</span> <span data-start="1167.86" data-end="1170.17">present shortly starts brewing only the</span> <span data-start="1170.17" data-end="1171.61">amount that we need so for a Nespresso</span> <span data-start="1171.61" data-end="1173.56">would only brew that much rather than</span> <span data-start="1173.56" data-end="1175.99">having to figure out how many seconds it</span> <span data-start="1175.99" data-end="1179.14">takes to brew a copy we let that be done</span> <span data-start="1179.14" data-end="1181.45">by the coffee machine itself and that's</span> <span data-start="1181.45" data-end="1183.52">all like that's literally all the code</span> <span data-start="1183.52" data-end="1186.2">that we need</span> <span data-start="1186.21" data-end="1189.63">so let me switch back to my slides all</span> <span data-start="1189.63" data-end="1191.25">right so what did what what did we</span> <span data-start="1191.25" data-end="1193.71">actually learn during this during this</span> <span data-start="1193.71" data-end="1196.32">hack um first of all reverse engineering</span> <span data-start="1196.32" data-end="1198.96">is a lot of fun trying to figure this</span> <span data-start="1198.96" data-end="1201.27">out it's it's way too addicting I think</span> <span data-start="1201.27" data-end="1204.54">we started at 7 or 8 p.m. on on Friday</span> <span data-start="1204.54" data-end="1207.3">and we stayed up until 6 a.m. or</span> <span data-start="1207.3" data-end="1209.84">something until we finally had coffee</span> <span data-start="1209.84" data-end="1212.52">which was useful at that time because</span> <span data-start="1212.52" data-end="1213.81">like we totally didn't want to go to</span> <span data-start="1213.81" data-end="1218.34">sleep but it was real really a lot of</span> <span data-start="1218.34" data-end="1220.29">fun because reverse engineering an API</span> <span data-start="1220.29" data-end="1222.72">or something is already interesting but</span> <span data-start="1222.72" data-end="1224.04">reverse engineering something where you</span> <span data-start="1224.04" data-end="1226.74">have even less of a clue that's even</span> <span data-start="1226.74" data-end="1227.16">better</span> <span data-start="1227.16" data-end="1229.35">it can be very very frustrating though</span> <span data-start="1229.35" data-end="1234.09">because you can't just like it's harder</span> <span data-start="1234.09" data-end="1237.24">to reverse engineer hardware than it is</span> <span data-start="1237.24" data-end="1241.32">to reverse engineer software especially</span> <span data-start="1241.32" data-end="1243.09">because it's easier to break things and</span> <span data-start="1243.09" data-end="1244.32">if you're doing this in the middle of</span> <span data-start="1244.32" data-end="1245.97">the night and you're burning something</span> <span data-start="1245.97" data-end="1248.25">you might not be able to get replacement</span> <span data-start="1248.25" data-end="1251.58">parts JavaScript and hardware work great</span> <span data-start="1251.58" data-end="1253.02">so this was the first time I actually</span> <span data-start="1253.02" data-end="1256.65">did a hack with any hope like the</span> <span data-start="1256.65" data-end="1258.54">different options that we had there I</span> <span data-start="1258.54" data-end="1260.46">have them lying around but I never had a</span> <span data-start="1260.46" data-end="1262.5">good news case for it and I think this</span> <span data-start="1262.5" data-end="1265.89">was a really good use days the tehsil 2</span> <span data-start="1265.89" data-end="1267.69">is great like it's so much fun to work</span> <span data-start="1267.69" data-end="1271.26">with it it has a great CLI on that you</span> <span data-start="1271.26" data-end="1274.32">can spin a you can easily configure the</span> </p>
<p><span data-start="1274.32" data-end="1276.63">Tesla you can run scripts on it you can</span> <span data-start="1276.63" data-end="1278.73">port them on it it works really well and</span> <span data-start="1278.73" data-end="1281.1">johnny-five is super useful because it</span> <span data-start="1281.1" data-end="1283.17">allows you to do this cross cross</span> <span data-start="1283.17" data-end="1285.33">hardware compatibility so that you can</span> <span data-start="1285.33" data-end="1287.31">move this over to a different platform</span> <span data-start="1287.31" data-end="1289.23">later if you want to use a different</span> <span data-start="1289.23" data-end="1292.53">microcontroller so what's next</span> <span data-start="1292.53" data-end="1294.9">we need to programmatically determine</span> <span data-start="1294.9" data-end="1297.84">the state of the coffee machine which as</span> </p>
<p><span data-start="1297.84" data-end="1300.39">I mentioned before is a bit tricky right</span> <span data-start="1300.39" data-end="1302.7">now and we need to add more relate so we</span> <span data-start="1302.7" data-end="1307.38">can finally like add milk to our coffee</span> <span data-start="1307.38" data-end="1309.66">we need an Alexa integration so we have</span> <span data-start="1309.66" data-end="1311.73">the API now but I figured that I've</span> <span data-start="1311.73" data-end="1314.4">finished that on Wednesday or something</span> </p>
<p><span data-start="1314.4" data-end="1314.89">I didn't have</span> <span data-start="1314.89" data-end="1317.61">to finish up the the rest of the</span> <span data-start="1317.61" data-end="1319.45">integration so we need an Alexa</span> <span data-start="1319.45" data-end="1321.31">integration or at least an if this then</span> <span data-start="1321.31" data-end="1323.35">that Handler and probably a Twilio</span> <span data-start="1323.35" data-end="1324.73">integration so I can text when I'm</span> <span data-start="1324.73" data-end="1328.17">walking home to brew your coffee and</span> <span data-start="1328.17" data-end="1330.52">then if you have any suggestions I'm</span> <span data-start="1330.52" data-end="1332.26">more than open to to hear any of your</span> <span data-start="1332.26" data-end="1337.21">suggestions give any real cool idea like</span> <span data-start="1337.21" data-end="1337.81">we need</span> <span data-start="1337.81" data-end="1339.37">we definitely need an Irish coffee</span> <span data-start="1339.37" data-end="1341.44">option so we need to figure out some way</span> <span data-start="1341.44" data-end="1343.96">how we can pour whiskey into it since</span> <span data-start="1343.96" data-end="1346.12">the accept additions headers of suggest</span> <span data-start="1346.12" data-end="1347.95">already that with whiskey as an option</span> <span data-start="1347.95" data-end="1352.21">and yeah with that thanks everyone my</span> <span data-start="1352.21" data-end="1355.09">name is Dominic if I not hack coffee</span> <span data-start="1355.09" data-end="1356.08">machines at work as a developer</span> <span data-start="1356.08" data-end="1357.94">evangelist for Twilio and if you have</span> <span data-start="1357.94" data-end="1359.41">any questions you can grab me later for</span> <span data-start="1359.41" data-end="1372.21">a coffee beer or shoot me a message</span> </p>
<p><span data-start="1372.22" data-end="1375.789">I think we have like a minute left or</span> <span data-start="1375.789" data-end="1381.49">something there's a question yet yes so</span> <span data-start="1381.49" data-end="1386.559">right that's exactly that's that's like</span> <span data-start="1386.559" data-end="1390.309">v4 we first need to be able to brew all</span> <span data-start="1390.309" data-end="1392.77">this stuff right now the the agreement</span> <span data-start="1392.77" data-end="1394.57">that we have is whoever takes the coffee</span> <span data-start="1394.57" data-end="1396.46">puts a new cup underneath it and puts a</span> <span data-start="1396.46" data-end="1398.049">new because it's an espresso so you need</span> <span data-start="1398.049" data-end="1400.39">to put this thing in it so you need to</span> <span data-start="1400.39" data-end="1402.28">put that in and put the cup back onto it</span> <span data-start="1402.28" data-end="1404.11">but you can do that in the evening or</span> <span data-start="1404.11" data-end="1405.789">whenever you took the last coffee and</span> <span data-start="1405.789" data-end="1408.22">it's ready so that when you wake up or</span> <span data-start="1408.22" data-end="1409.87">when you really feel like your coffee</span> <span data-start="1409.87" data-end="1411.19">but you don't feel like making your</span> <span data-start="1411.19" data-end="1413.71">coffee you you don't have to worry about</span> <span data-start="1413.71" data-end="1414.69">that anymore</span> <span data-start="1414.69" data-end="1419.14">any other questions all right thanks for</span> <span data-start="1419.14" data-end="1425.33">your attention</span> <span data-start="1425.34" data-end="1427.38">also if you want to see the hardware you</span> <span data-start="1427.38" data-end="1429.3">can drop by now or later or something I</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
