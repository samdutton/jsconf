<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>XcS-LdEBUkE</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/XcS-LdEBUkE?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="21.73" data-end="25.73">Thank you for that wonderful introduction, that once expected.</span> <span data-start="25.73" data-end="31.23">Yes, hello, I'm James, I'm going to talk to you today about practical functional programming,</span> <span data-start="31.23" data-end="35.16">to make sure I get through this in plenty of time, and the clock's not ticking down,</span> <span data-start="35.16" data-end="40.07">so I don't know how much time I've got, that's very confusing.</span> <span data-start="40.07" data-end="41.94">What do I mean by functional programming?</span> <span data-start="41.94" data-end="48.089">Well, initially I didn't even know, itches looking for ideas to talk about on Twitter</span> <span data-start="48.089" data-end="53.25">a while ago, and Jan gave this idea, practical function fallal programming, and I brushed</span> <span data-start="53.25" data-end="56.449">it off with a little juke.</span> </p>
<p><span data-start="56.449" data-end="59.66">Got me thinking.</span> <span data-start="59.66" data-end="66.02">It has first class functions, and we have venttion and call backs and we have all the</span> <span data-start="66.02" data-end="69.71">array operations like map, filter, reduce and stuff like that.</span> <span data-start="69.71" data-end="75.25">But, there's a lot more to functional programming than we often acknowledge.</span> <span data-start="75.25" data-end="80.17">And what I would like to do is sort of demystify that a little bit.</span> </p>
<p><span data-start="80.17" data-end="85.44">Because one criticism of functional programming, it's not very practical and you need a PhD</span> <span data-start="85.44" data-end="88.45">to understand it.</span> <span data-start="88.45" data-end="92.929">What I'd like to do is sort of talk about the ways in which we are already using functional</span> <span data-start="92.929" data-end="97.25">ideas in mainstream JavaScript and how we can pay better attention to those and get</span> <span data-start="97.25" data-end="98.82">better value out of them.</span> <span data-start="98.82" data-end="104.979">Also promise the last occurrence of the word Monad in this talk, there's not going to be</span> <span data-start="104.979" data-end="107.289">a lot of type theory stuff going on.</span> <span data-start="107.289" data-end="109.95">What do we mean by functions?</span> </p>
<p><span data-start="109.95" data-end="114.64">Functional programming is about programming without side effects, if you're in the Parallel</span> <span data-start="114.64" data-end="118.979">JavaScript talk earlier you would have heard that side effects are one of the biggest barriers</span> <span data-start="118.979" data-end="126">to parallelizing a program because you can't reason about changes to a global state, makes</span> <span data-start="126" data-end="128.06">it hard to parial rise things.</span> <span data-start="128.06" data-end="130.94">What does it look like to program functionally.</span> <span data-start="130.94" data-end="140.01">You want to calculate the length of a list, length takes a list and returns an Int that's</span> <span data-start="140.01" data-end="141.49">what that little type signature means.</span> <span data-start="141.49" data-end="148.51">So, what you could do is set the counter to 0 and increment the counter for every iment</span> <span data-start="148.51" data-end="150.44">and return the last value of the counter.</span> <span data-start="150.44" data-end="155.65">How does that run out in practice, want to get the value of the list, set the count to</span> <span data-start="155.65" data-end="160.28">zero, first element, increment the index, there's a second element, we increment, there's</span> <span data-start="160.28" data-end="166.9">a third, we increment, there's no fourth element we break the loop and induction is 3.</span> <span data-start="166.9" data-end="171.99">The values of the index comments\h‑‑ those aren't statements that appear anywhere in</span> <span data-start="171.99" data-end="175.702">the program that state you have to keep in your head while you figure out what the program</span> <span data-start="175.702" data-end="180.03">dugs, that's what makes imperative programs hard to reason about.</span> </p>
<p><span data-start="180.03" data-end="184.859">A functional version would look like this, cough free script has three dot syntax that</span> <span data-start="184.859" data-end="190.23">breaks a list into the first elements and the rest of the elements.</span> <span data-start="190.23" data-end="195.15">If the first element is  the list is empty, right, so it has length 0 otherwise</span> <span data-start="195.15" data-end="199.799">the length one plus the length of the rest of the list, we're doing a recuresive break</span> <span data-start="199.799" data-end="200.799">down.</span> <span data-start="200.799" data-end="206.719">What does that look like in practice, so, there is a first element, so we'll pick a</span> <span data-start="206.719" data-end="207.719">second bunch.</span> <span data-start="207.719" data-end="214.78">We're just going to replace the definition, we're using it as a rewrite rule, no implicit</span> <span data-start="214.78" data-end="216.879">state to keep track of.</span> </p>
<p><span data-start="216.879" data-end="221.379">We do that a couple more times then we get length of the empty list, which we pick the</span> <span data-start="221.379" data-end="226.659">first branch of the conditional, which is 0 and result falls out.</span> <span data-start="226.659" data-end="231.129">So here rather than writing comments with sate in them, I've written "is" before each</span> <span data-start="231.129" data-end="234.33">expression, that's because they're identical.</span> <span data-start="234.33" data-end="238.2">Doesn't mean they have the same value at a particular point in time, they always have</span> <span data-start="238.2" data-end="241.9">the same value you can replace any of these expression with any of the other and the program</span> <span data-start="241.9" data-end="245.54">will do the same thing.</span> <span data-start="245.54" data-end="249.469">Substituting bitting of source code for each other makes it easy to think about, you don't</span> <span data-start="249.469" data-end="253.549">have to track state somewhere else in your mind or on paper.</span> <span data-start="253.549" data-end="261.769">Let's take another function, map, the signature means map takes a function from A to B and</span> <span data-start="261.769" data-end="266.51">a list of As and returns a list of Bs, the imperative version of that would be to take</span> <span data-start="266.51" data-end="272.94">an empty list and push ever VEX for every element in the input and return the list.</span> <span data-start="272.94" data-end="277.73">The functional version would be to say in is no first element, the effect is</span> <span data-start="277.73" data-end="282.95">then return an empty list otherwise afully F to the first element and then combine that</span> <span data-start="282.95" data-end="285.34">with map over the rest of the list.</span> <span data-start="285.34" data-end="290.42">Same structure as we're doing the went, we're using list instead of numbers, say we want</span> <span data-start="290.42" data-end="295.69">to square the first three numbers, we go, there is a first element, so we'll take a</span> <span data-start="295.69" data-end="300.28">second branch, so square of one is one, we pull that out of the front and map over what's</span> <span data-start="300.28" data-end="306.25">left, map over what's left, square two and then, we have anmentty list, and so, the\h‑‑</span> <span data-start="306.25" data-end="310.59">an empty list and then the result falls out.</span> </p>
<p><span data-start="310.59" data-end="314.35">These are our functional solutions to the problem, theye they work by not my stating</span> <span data-start="314.35" data-end="318.56">the state, they work by giving you an expression you're trying to calculatend that you can</span> <span data-start="318.56" data-end="322.1">replace and you do that recursively.</span> <span data-start="322.1" data-end="326.81">You can program by substitution by using these things.</span> <span data-start="326.81" data-end="330.94">The imperative solutions work by making some state and then like changing that state until</span> <span data-start="330.94" data-end="335.451">some condition becomes true and then handing that state off to you at the end.</span> <span data-start="335.451" data-end="339.94">But even though those have internal state and they're not internally functional, they</span> <span data-start="339.94" data-end="349.29">do exactly the same thing as these versions, because,\h‑‑ they don't Mutate\h‑‑</span> <span data-start="349.29" data-end="353.31">you can treat them as if they're the same functions.</span> <span data-start="353.31" data-end="360.37">That's useful, it means their state is completely ensuelated the sidefects continue leek out</span> <span data-start="360.37" data-end="361.91">into the rest of the program.</span> <span data-start="361.91" data-end="366.53">We use that in promises.</span> <span data-start="366.53" data-end="371.22">Promises have internal state, they are pending and they can become fulfilled or rejected</span> <span data-start="371.22" data-end="373.63">with a value or an error.</span> <span data-start="373.63" data-end="378.19">But, every time you call then it will yield the same value to you, you never get to see</span> <span data-start="378.19" data-end="382.99">what's actually going on inside of the promise, Jo us call then and value pops out and it's</span> <span data-start="382.99" data-end="387.7">always the same value you can treat a promise as an immutable value, which is useful.</span> </p>
<p><span data-start="387.7" data-end="394.47">A couple weeks ago too much ash ford had this really good essay, vents are bad primitive</span> <span data-start="394.47" data-end="398.94">for data flow, they require distribution of mutable state around your code and it's not</span> <span data-start="398.94" data-end="407.13">idiomatic or plea Saint to flow through data through events.</span> <span data-start="407.13" data-end="412.07">We can use types to answer that question, if we consider the FS.read file, that takes</span> <span data-start="412.07" data-end="417.18">a path name, an encoding, a call back and it returns nothing, and the call back is itself</span> <span data-start="417.18" data-end="421.01">a function that takes an error, value and alts returns nothing.</span> </p>
<p><span data-start="421.01" data-end="424.71">Now function that returns nothing must have side effects because if a function has no</span> <span data-start="424.71" data-end="428.06">return value and no sidefects what why you calling it?</span> <span data-start="428.06" data-end="429.8">It's not doing anything.</span> <span data-start="429.8" data-end="434.65">The thing that you think of not having side effects is reading a file we work with these</span> <span data-start="434.65" data-end="438.69">things using side effects functions, completely.</span> <span data-start="438.69" data-end="442.49">When we're dealing with all these asynchronous things all the time we have to make sure all</span> <span data-start="442.49" data-end="446.13">the side effects happen in the right order so the program doesn't get into a bizarre</span> <span data-start="446.13" data-end="450.55">state, and trying to did that on concurrent programs is very, very difficult, which you</span> <span data-start="450.55" data-end="452.56">doubt know.</span> </p>
<p><span data-start="452.56" data-end="457.401">It gets even harder when you try odo a lot of things at same time, if you want to read</span> <span data-start="457.401" data-end="462.14">a file and request a URL and get something out of a data business at the same time, you</span> <span data-start="462.14" data-end="470.77">use Async.parallel, and do operation, when they complete you get a cull back and you</span> <span data-start="470.77" data-end="475.49">get value for those things, what would I do if I wanted to get the value of the file before</span> <span data-start="475.49" data-end="477.84">the other things are completed and do something with it.</span> <span data-start="477.84" data-end="482.18">Because this, if any of the things fail, I won't get any of the values, I only work on</span> <span data-start="482.18" data-end="487.11">the file even if the HDP request fails, I could pull the file operation out top.</span> <span data-start="487.11" data-end="494.83">I have an FS.read file\h‑‑ but now I've made the program slower because the second</span> <span data-start="494.83" data-end="498.55">thing are blocked on the first thing completing, so I de‑parol liesed it.</span> <span data-start="498.55" data-end="505.23">That kills the performance, it's convenient, but, you've traded convenience for performance.</span> <span data-start="505.23" data-end="510.131">What you actually have do is keep the parallel construct to make sure the IO happens at the</span> <span data-start="510.131" data-end="514.839">same time but plug your processing into the bit where the file is requested, the more</span> <span data-start="514.839" data-end="522.729">you do these things the data processing, what you're forced do by the way that we schedule</span> <span data-start="522.729" data-end="528.089">things in asynchronous programs your programs get very messy, edge tangled you get into</span> <span data-start="528.089" data-end="529.089">what we roll call</span> <span data-start="529.089" data-end="534.399">back hell, it's not a sin tackic thing about your code creeping across the page, it's the</span> <span data-start="534.399" data-end="538.329">inability to reason able when things are happening in your program and make sure they happen</span> <span data-start="538.329" data-end="542.61">as efficiently as possible, to do this you is to construct your program in a very specific</span> <span data-start="542.61" data-end="546.089">way with call backs in all the right places.</span> </p>
<p><span data-start="546.089" data-end="551.209">So, last year I read this article called call backs are imperative, promises are functional,</span> <span data-start="551.209" data-end="557.519">which had this quote "the future of promises is that they remain immune to change circumstances."</span> <span data-start="557.519" data-end="562.38">I've already mentioned that\h‑‑ I got some laughs\h‑‑ I already mention how</span> <span data-start="562.38" data-end="567.1">promises look like immutable values because then always gives you the same result out</span> <span data-start="567.1" data-end="571.68">once the tasks are completed, but this is also true in a second way that I department</span> <span data-start="571.68" data-end="578.639">realize at the same, the promises that deal in changing promises much more easily.</span> <span data-start="578.639" data-end="581.84">Before when I was using the asing module I had to change my program quite radically,</span> </p>
<p><span data-start="581.84" data-end="587.36">I could make a big structural change to it to make quite a small requirement change.</span> <span data-start="587.36" data-end="593.069">But say those functions return promises my FS.read and database dot get always return</span> <span data-start="593.069" data-end="598.999">promises of strings, I can call all those functions and put the results in an array</span> <span data-start="598.999" data-end="605.46">and all the Io will just happen in parallel, but now I have an array of promises of strings.</span> <span data-start="605.46" data-end="608.81">And if I want just the first\h‑‑ if I just want the file out of that, then I can</span> <span data-start="608.81" data-end="613.04">get the first promise out of the list and do something with the result.</span> <span data-start="613.04" data-end="616.399">If I want to wait for all of the things to finish, then I can call promise.all with the</span> <span data-start="616.399" data-end="622.48">documents and I get a promise that will give me all of the results when they're ready,</span> <span data-start="622.48" data-end="626.31">if I don't want to deal with the file on it's own, I just delete the documents.zero line,</span> <span data-start="626.31" data-end="635.11">I can just add lines for those, I don't have to make bige structural changes to my program.</span> </p>
<p><span data-start="635.11" data-end="639.56">You keep the ability to keep your IO happening in parallel, but you keep the convenience</span> <span data-start="639.56" data-end="643.37">of being able to work with it easily, that's really important for dealing with programs</span> <span data-start="643.37" data-end="646.5">that change a lot over time.</span> <span data-start="646.5" data-end="650.809">And the reason this works is that I can ask for the value out of the file promise and</span> <span data-start="650.809" data-end="655.79">promise to all can also answer the value out of that file promise, and it'll work both</span> <span data-start="655.79" data-end="659.66">times because you can keep asking for the value over and over again, and you won't repeat</span> <span data-start="659.66" data-end="664.5">any work, what it means to be immutable, it's rejuiceble, right.</span> <span data-start="664.5" data-end="667.37">So let's talk\h‑‑ it's reusable.</span> <span data-start="667.37" data-end="673.029">We talk about I in very imperative terms, we say then takes a function and that function</span> <span data-start="673.029" data-end="677.519">will be invoked when the task completes with the value of the task, if it's completed it</span> <span data-start="677.519" data-end="681.37">will be invoked with the value of the task it returns a promise and that promise will</span> <span data-start="681.37" data-end="688.279">be invoked with the return of the call back, we talk about then, do this, then do this,</span> <span data-start="688.279" data-end="689.339">and then do that.</span> </p>
<p><span data-start="689.339" data-end="693.98">But if you think about the types of things that are involved, what then really does it</span> <span data-start="693.98" data-end="698.58">takes a promise of A and function there A to B and returns a promise of B, if we have</span> <span data-start="698.58" data-end="703.029">a promise of a string and we call then with a function that counts the word in a string,</span> <span data-start="703.029" data-end="709.749">string.split on spaces.length what we get is a promise of an I Int, we might not have</span> <span data-start="709.749" data-end="714.17">the Int, but that's the type of the value we have, we continue to do more processing</span> <span data-start="714.17" data-end="718.43">on it, transform it into another thing, transform it into another thing, and use the promise</span> <span data-start="718.43" data-end="722.1">itself as a value, not the thing that's inside of it.</span> <span data-start="722.1" data-end="728.06">This is exactly the same thing a ray.map works it takes list of something and a function</span> <span data-start="728.06" data-end="733.17">from A to B around returns a list of B, right, so if you have a list of strings and you map</span> <span data-start="733.17" data-end="736.749">a word counting function over the list, you now have a list of word counts just as if</span> <span data-start="736.749" data-end="740.66">you called then with a word counting function you turn a promise of a string into a promise</span> <span data-start="740.66" data-end="745.91">of a word count, a promise is just a container, it's a list, they're the same thing, the operations</span> <span data-start="745.91" data-end="751.089">are the same thing, a container of up type, container of another type with a mapping function</span> <span data-start="751.089" data-end="756.319">between them, and because they're just containertion you can compos containers, they're just another</span> <span data-start="756.319" data-end="760.449">type of data structure, if you have a list of promise of strings you turn that into a</span> <span data-start="760.449" data-end="766.31">list of promises of Int by mapping over the array this is no different than mapping over</span> <span data-start="766.31" data-end="769.6">nested array you have two maps inside of one another.</span> </p>
<p><span data-start="769.6" data-end="775.16">Promise to all is the same, we talk at promise to all as in you give it a bunch of promises</span> <span data-start="775.16" data-end="780.43">as input then it will give you one promise when it resolve, we talk about it in time</span> <span data-start="780.43" data-end="786.35">terms, if you talk about it in type terms, it turns a container inside out you give it</span> <span data-start="786.35" data-end="790.89">a list of promises and it gives you a promise of a list, you get one promise back that will</span> <span data-start="790.89" data-end="794.939">give you a list of all of the things.</span> <span data-start="794.939" data-end="801.35">This also solves the Zaga\h‑‑ Zalg oproblem, personification of the problem with writing</span> <span data-start="801.35" data-end="804.301">call back APIs that will execute a call back synchronously or asynchronously.</span> <span data-start="804.301" data-end="815.74">A equals Null promise.then X equals data equals X on statement before line three otherwise</span> <span data-start="815.74" data-end="820.559">your program won't work, if it ran asin concurrent resolution noselite would break.</span> <span data-start="820.559" data-end="824.24">The only reason it's a problem is because you have side effect, you care about things</span> <span data-start="824.24" data-end="828.399">happening in a certain order something that's been changed into another state before another</span> <span data-start="828.399" data-end="832.48">statement runs, if instead you do your process inside of the promise construct you don't</span> <span data-start="832.48" data-end="836.589">think of a promise as a thing to get value out of you think of it as a value on it's</span> <span data-start="836.589" data-end="840.55">own that you can do commutation inside of, then that problem goes away.</span> </p>
<p><span data-start="840.55" data-end="847.749">Want to talk about laciness, another big topic in functional programming (Lazi iness) I want</span> <span data-start="847.749" data-end="852.089">to show you a little bit of Hasckell code\h‑‑ Haskell code.</span> <span data-start="852.089" data-end="861.139">Cough free script is written as a colon, first element colon, the rest of the elements.</span> <span data-start="861.139" data-end="866.769">So map we've already seen, map of an Ety list is an empty list,and map in the general case,</span> <span data-start="866.769" data-end="871.17">you apply F to X and combine that to map over the rest of the list, it looks weird but we</span> <span data-start="871.17" data-end="877.22">saw it working in coffee script, filter works pretty much the same way, filter of an empty</span> <span data-start="877.22" data-end="884.379">list is an empty list, where peer Cex is true you keep X you you combine with the filter</span> <span data-start="884.379" data-end="890.149">of the rest of the list otherwise you throw X away and keep the rest of the list, we keep</span> </p>
<p><span data-start="890.149" data-end="893.67">X braced on whether the predicate is true for the value.</span> <span data-start="893.67" data-end="900.809">Take, first and end elements of allis, take where N is less than 0 you don't want to take</span> <span data-start="900.809" data-end="906.1">any more data, take of an empty list because there's no more day the to take, so empty,</span> <span data-start="906.1" data-end="912.3">then take in a general case, you pop the first element and take N minus one of what's left</span> <span data-start="912.3" data-end="916.429">and apply that recuresively the value will fall out.</span> <span data-start="916.429" data-end="918.579">This lets you do somethinger, very powerful.</span> <span data-start="918.579" data-end="928.6">Haskell has infinite data structure, list of .., is to infinity, the filter would never</span> <span data-start="928.6" data-end="933.67">return, it tries to process the whole array at once, looks what happen in Haskel, I'm</span> <span data-start="933.67" data-end="939.23">going to program by replacing functioncal with the definition, so let's see what happens,</span> <span data-start="939.23" data-end="943.319">so, even if one is false, so we drop the one.</span> <span data-start="943.319" data-end="947.8">Even if 2 is true, so pull the 2 out front and filter over what's left.</span> <span data-start="947.8" data-end="953.129">Now, we've destructured the umer end to map so we can pull that 2 through squaring functions,</span> <span data-start="953.129" data-end="959.139">we structured the upper end to take, can pull that expression out front, three minus what's</span> <span data-start="959.139" data-end="965.16">left, levering with two, one value through the list all the way through the pipeline.</span> </p>
<p><span data-start="965.16" data-end="966.699">We do more time.</span> <span data-start="966.699" data-end="971.559">We come down to take one, and one more time again, we come down to take zero and we have</span> <span data-start="971.559" data-end="973.99">three elements out front.</span> <span data-start="973.99" data-end="979.379">We know by definition, take of zero is an empty list and the result pops out.</span> <span data-start="979.379" data-end="981.899">We didn't have to look at the rest of the infinite list, we didn't have to care about</span> <span data-start="981.899" data-end="982.899">it.</span> <span data-start="982.899" data-end="987.399">That's really really powerful, skipping work you don't need to do to get the result you</span> <span data-start="987.399" data-end="988.399">want.</span> <span data-start="988.399" data-end="994.899">Again, Tom ash worth summed it up nicely there are two ways to combine transformations you</span> <span data-start="994.899" data-end="999.11">perform the first transformation on the whole collection before moving on to the second</span> <span data-start="999.11" data-end="1003.269">or perform all the transformations on the first element of the collection before moving</span> <span data-start="1003.269" data-end="1004.269">on to the second.</span> <span data-start="1004.269" data-end="1009.009">Now the first version is how JavaScript deals with array, filter the whole array and hand</span> <span data-start="1009.009" data-end="1013.089">that off to the map and the map maps over the whole array, reiterates it over how ever</span> <span data-start="1013.089" data-end="1019.44">many operations you have, the second way is the way Haskell deal was arrays</span> <span data-start="1019.44" data-end="1023.949">'s nothing inherent about the data structure that says you is to process them this way,</span> <span data-start="1023.949" data-end="1026.01">you can use either strategy.</span> </p>
<p><span data-start="1026.01" data-end="1031.75">Just as Haskll deals with lists as if they were streams question can deal with streams</span> <span data-start="1031.75" data-end="1033.98">as if they're lists.</span> <span data-start="1033.98" data-end="1036.449">Streams they're big part of node programming right.</span> <span data-start="1036.449" data-end="1041.73">Huge part of node programming, really node's core feature, these streams.</span> <span data-start="1041.73" data-end="1044.28">So, do something a little Funky.</span> <span data-start="1044.28" data-end="1052.82">So, I'm going to make a classical map that inherit from stream.platform, and transform</span> <span data-start="1052.82" data-end="1057.2">method is going to replay that function to incoming chunk and push it.</span> <span data-start="1057.2" data-end="1063.559">Going to add a map method to stream.prototype that pipes the stream through map transform,</span> <span data-start="1063.559" data-end="1068.601">it's a similar lair toy array.map, we're taking a stream of As, and a function from A to B</span> <span data-start="1068.601" data-end="1070.22">and a stream of A to B.</span> <span data-start="1070.22" data-end="1077.89">Same operation, filter same way, predicate function, and now we're going to push the</span> <span data-start="1077.89" data-end="1082.24">chunk, if the predicate is true for that chunk.</span> <span data-start="1082.24" data-end="1085.98">Take is going to be substance showuated with a number and in the transform method we're</span> <span data-start="1085.98" data-end="1092.63">going to push the chunk if N is greater than zero and then call N if it reaches zero, it</span> <span data-start="1092.63" data-end="1098.25">will mean all the streams that are feeding into this will stop sending it data because</span> <span data-start="1098.25" data-end="1100.87">it's emitted end, doesn't want anymore data, we can stop processioning when we have the</span> <span data-start="1100.87" data-end="1101.91">information we want.</span> </p>
<p><span data-start="1101.91" data-end="1104.61">That gets us lay citiness.</span> <span data-start="1104.61" data-end="1106.77">We have split\h‑‑ Laziness.</span> <span data-start="1106.77" data-end="1113.28">I'm going to add the split modules to the prototype.</span> <span data-start="1113.28" data-end="1117.25">Set high water mark 0 on all the streams, that means node won't egg eerily buffer data</span> <span data-start="1117.25" data-end="1122.169">the streams don't need, it will pull data through as it needs.</span> <span data-start="1122.169" data-end="1128.63">Put in a file called Lazy.Commonwealth of Virginia fee, I can split the on‑line breaks</span> <span data-start="1128.63" data-end="1134.429">and filter those lines if cluster finishing and map those matches to upper case and take</span> <span data-start="1134.429" data-end="1135.429">one of them.</span> <span data-start="1135.429" data-end="1138.69">And if I attach a data list to that I will get the first class definition that comes</span> <span data-start="1138.69" data-end="1144.371">out as upper case, if you watch the filter and the map functions here, they'll only be</span> <span data-start="1144.371" data-end="1148.41">called as many times as necessary to produce the output, the program won't consume the</span> <span data-start="1148.41" data-end="1150.299">whole file, it's powerful.</span> </p>
<p><span data-start="1150.299" data-end="1155.22">You're letting the consumer of the operation dictate how much get read at the other end,</span> <span data-start="1155.22" data-end="1158.23">you're avoiding work you don't need to do.</span> <span data-start="1158.23" data-end="1162.34">So here we're programming the streams and they look like arrays, it might look like</span> <span data-start="1162.34" data-end="1167.809">a cute trick, it's a general model of programming, general functional programming, I'm going</span> <span data-start="1167.809" data-end="1174.69">to write an IRC client using this strategy, first I'll write it imperative so it's familiar</span> <span data-start="1174.69" data-end="1183.87">Irc is going to take a TCP socket stand in and out, in a log file, we're going to split</span> <span data-start="1183.87" data-end="1188.679">the TCP and put on‑line breaks, IRC is a line warranted protocol, going to write that</span> <span data-start="1188.679" data-end="1193.47">file to the logs, going to pause the line into a\h‑‑ park it into a command structure,</span> <span data-start="1193.47" data-end="1196.63">if it's a notice we'll print to screen.</span> </p>
<p><span data-start="1196.63" data-end="1200.14">All the client will do is receive notices from the server and print them.</span> <span data-start="1200.14" data-end="1205.44">These are also wants to join rim,es so we'll split standard I believee input on‑line</span> <span data-start="1205.44" data-end="1212.03">break and if we see a line slash join, we set our global variable room to the value</span> <span data-start="1212.03" data-end="1219.549">of the Redux match and construct an Irc command, the Irc command for joining that rim.</span> </p>
<p><span data-start="1219.549" data-end="1224.049">If we did manager to construct a command, then we'll unparse it turn it into a string</span> <span data-start="1224.049" data-end="1228">and write that string to TCP and we'll write it to the logs.</span> <span data-start="1228" data-end="1233.7">We also want to send messages so if we oar in a room and the line is not blank we'll</span> <span data-start="1233.7" data-end="1239.31">construct a proof message command ILC speak for sending a mission age somewhere with the</span> <span data-start="1239.31" data-end="1242.85">room and the line of input, that's the room that we're currently in, we always send a</span> <span data-start="1242.85" data-end="1245.779">message to the room we're currently in.</span> <span data-start="1245.779" data-end="1251.75">We want to receive messages from the server, we'll get the channel and the message out</span> <span data-start="1251.75" data-end="1256.289">of that command and then compare the channel to the room that we're currently in, if they</span> <span data-start="1256.289" data-end="1260.83">match, we'll display the line, so we're only going to display messages from the server</span> <span data-start="1260.83" data-end="1264.9">from the room that we're currently in instead of all the rooms we've joined.</span> <span data-start="1264.9" data-end="1271.03">There's what room we're in, there's conditional processing, side effects things being written</span> <span data-start="1271.03" data-end="1277.55">to, event listeners, this is the imperative style for solving this problem.</span> <span data-start="1277.55" data-end="1281.169">Programs like this tend to not scale very well, the bigger they get, the harder it is</span> <span data-start="1281.169" data-end="1286.57">to reason want is happening at which times, which is important you've written in a state.</span> <span data-start="1286.57" data-end="1287.57">Way.</span> <span data-start="1287.57" data-end="1292.82">So, write that functionally, we can write function that takes TCP input stream and user</span> <span data-start="1292.82" data-end="1299.559">input stream and returns synchronously a TCP output stream and user output stream and some</span> <span data-start="1299.559" data-end="1303.95">logs, rather than taking it all as input and returning nothing with side effects we take</span> <span data-start="1303.95" data-end="1308.69">the inputs and return the outputs and do this without using call backs.</span> </p>
<p><span data-start="1308.69" data-end="1311.419">How is that going to work.</span> <span data-start="1311.419" data-end="1317.971">We take Irc in equals TCP map,\h‑‑ take a stream of strings mapping them through a</span> <span data-start="1317.971" data-end="1323.269">pausing function and that gives a string of IRC objects, just like working with arrays,</span> <span data-start="1323.269" data-end="1328.299">pretend you're working with arrays, that's what's going to happen, to get the notices,</span> <span data-start="1328.299" data-end="1334.519">we can filter those commands for one who's command is notice, then match map the matches</span> <span data-start="1334.519" data-end="1338.35">and assign the notices to user out here.</span> <span data-start="1338.35" data-end="1344.73">And that means user out will be the formated notice commands from the TCP stream.</span> <span data-start="1344.73" data-end="1349.38">And for the logs, we're just going to say the logs are the TCP input for formatting</span> <span data-start="1349.38" data-end="1351.15">function.</span> </p>
<p><span data-start="1351.15" data-end="1358.159">We want to join room, add more code, say room s is the user input, mapped through a function</span> <span data-start="1358.159" data-end="1364.831">that does a reject match on each line of input, it's going to match/join with a rename, we're</span> <span data-start="1364.831" data-end="1369.789">going to filter the reduction matches, so we just get the lines thattingually matched</span> <span data-start="1369.789" data-end="1376.46">and we're going to match those matches to pull the room value out of the\h‑‑ now</span> <span data-start="1376.46" data-end="1381.34">we have a stream of rooms that we've join joined to tell the server about that we need</span> <span data-start="1381.34" data-end="1389.799">need fro deuce a join command, join command equals room.map to produce an IRC command.</span> <span data-start="1389.799" data-end="1395.919">And then to send those to the server, we can say TCP out, equals joint command IRC, we</span> <span data-start="1395.919" data-end="1401.429">oar taking this stream of joint commands here, mapping them to strings and assigning that</span> <span data-start="1401.429" data-end="1406.669">to the TCP output, I'm also merging the TCP output into the logs here, time taking stuff</span> <span data-start="1406.669" data-end="1411.47">from input and stuff from out put and combining them in really clean way to get my logs, instead</span> <span data-start="1411.47" data-end="1415.701">of putting logging logic at different point in the program as before.</span> <span data-start="1415.701" data-end="1421.98">Now, we want to be able to send messages, to send a message you need the room you're</span> <span data-start="1421.98" data-end="1425.6">currently in, and you fled message you want to send, we try dog this without states, there's</span> <span data-start="1425.6" data-end="1433.66">no global room variable (Need) instead of what we do user end out filter for lines that</span> <span data-start="1433.66" data-end="1439.919">aren't blank and we do this thing rooms.sampled by, whatever messages\h‑‑ event, it gets</span> <span data-start="1439.919" data-end="1445.679">the latest vent by rooms and give both of the values by function arguments and construct</span> <span data-start="1445.679" data-end="1454.09">an IRC out of them, and then, we can just merge those into the TCP output with the joins</span> <span data-start="1454.09" data-end="1456.97">that we're sending earlier.</span> </p>
<p><span data-start="1456.97" data-end="1459.289">So ..</span> <span data-start="1459.289" data-end="1462.799">finally we want to be able to receive messages from other people.</span> <span data-start="1462.799" data-end="1470.08">So, we're going to filter the incoming messages for ones that match prove messages, and again,</span> <span data-start="1470.08" data-end="1474.45">we're going to use sample by, so every time we get a message in, we're going to give the</span> <span data-start="1474.45" data-end="1478.48">room we're currently in, and the message we just got, and compare the room that we're</span> <span data-start="1478.48" data-end="1483.07">currently if to the message room parameter, this gives us a stream of Boole cranes to</span> <span data-start="1483.07" data-end="1487.89">tell us whether the message we just got is for the room that we're currently in, it's</span> <span data-start="1487.89" data-end="1490.09">slightly weird operation, but it does work.</span> <span data-start="1490.09" data-end="1496.2">And then I can filter the in‑coming messages on that stream, if you have a stream of Boole</span> <span data-start="1496.2" data-end="1500.13">cranes you can use that to filter something else.</span> <span data-start="1500.13" data-end="1504.84">This will give you a stream of the in‑coming messages for the room I'm currently in, I've</span> <span data-start="1504.84" data-end="1510.549">written a non‑trivial network application that does exactly what we had before, no side</span> <span data-start="1510.549" data-end="1516.32">effects no variables are my stated, no call backs in the sense of side effect functions</span> <span data-start="1516.32" data-end="1517.77">that return nothing.</span> </p>
<p><span data-start="1517.77" data-end="1522.16">It's all pure functions, you can replace any variable variable in the program with a definition</span> <span data-start="1522.16" data-end="1526.61">and the program will do exactly the same thing, there's no hidden state to take care of, rather</span> <span data-start="1526.61" data-end="1530.46">than write ago program that says do this, then do this, you've written a program that</span> <span data-start="1530.46" data-end="1534.75">defines streame streams of day the relative to other streams of data and the control flow</span> <span data-start="1534.75" data-end="1540.25">is implicit that makes it easier to work in current programs.</span> <span data-start="1540.25" data-end="1543.409">To sum up you can get the slides here.</span> <span data-start="1543.409" data-end="1551.32">The article that Tom Ashwroth wrote.</span> <span data-start="1551.32" data-end="1554.519">\h‑‑ similarities between promises and liveses and maybes and stuff like that and</span> <span data-start="1554.519" data-end="1560.059">how they compos, last year Phillip Roberts is giving a talk here tomorrow, gave a really</span> <span data-start="1560.059" data-end="1564.88">good talk ant real‑timeCONF that you need watch.</span> <span data-start="1564.88" data-end="1570.25">And I've ended that with the links to documentation for some of these streaming libraries that</span> <span data-start="1570.25" data-end="1571.63">I've use in the this talk.</span> <span data-start="1571.63" data-end="1578.45">Finally, I thought I'd try and do something nice while I'm here, earlier this year I wrote</span> <span data-start="1578.45" data-end="1585.22">this book, apparently it's quite good, if you use the code JSFST for this weekend you</span> <span data-start="1585.22" data-end="1588.659">can get fiver pounds off of it, and it's already half price.</span> <span data-start="1588.659" data-end="1590.69">thank you for having me.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
