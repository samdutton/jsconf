<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Oeh1ppU8ygg</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/Oeh1ppU8ygg?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="9.92" data-end="11.55">this is weird</span> <span data-start="11.55" data-end="17.1">like really weird conference for node</span> <span data-start="17.1" data-end="22.14">man so I actually have nothing</span> <span data-start="22.14" data-end="25.169">interesting to say I don't do anything</span> <span data-start="25.169" data-end="27.509">interesting these days I just fix bugs</span> <span data-start="27.509" data-end="30.3">and try to progress node you know</span> <span data-start="30.3" data-end="32.94">there's there's a lot of work to do and</span> <span data-start="32.94" data-end="35.969">so I'm just going to talk about what is</span> <span data-start="35.969" data-end="38.969">happening in the next version it's okay</span> <span data-start="38.969" data-end="41.85">with you okay it's going to be extremely</span> <span data-start="41.85" data-end="43.829">you can like go get coffee if you want I</span> <span data-start="43.829" data-end="45.69">will not be offended I wanted to do a</span> <span data-start="45.69" data-end="49.07">more interesting talk but yeah alright</span> <span data-start="49.07" data-end="54.03">so first of all well I just put this</span> <span data-start="54.03" data-end="56.399">slide in here because it's it's somewhat</span> <span data-start="56.399" data-end="60.42">amazing like node seems to be attracting</span> <span data-start="60.42" data-end="63.539">a lot of people to it there are 4,000</span> <span data-start="63.539" data-end="65.339">people on the mailing list and if you go</span> <span data-start="65.339" data-end="68.07">in the IRC at noon on Pacific Standard</span> <span data-start="68.07" data-end="70.7">time you'll see 600 people idling there</span> <span data-start="70.7" data-end="74.759">it is kind of a lot of people there's</span> <span data-start="74.759" data-end="78.09">books and several books coming out I</span> <span data-start="78.09" data-end="80.1">guess the Japanese book is going to be</span> <span data-start="80.1" data-end="83.04">the first one it's 500 pages and will</span> <span data-start="83.04" data-end="87">probably be done I don't know when is it</span> <span data-start="87" data-end="92.82">going to be done guys like a month end</span> <span data-start="92.82" data-end="94.829">of June okay</span> <span data-start="94.829" data-end="96.659">of course most of us can't read it but</span> <span data-start="96.659" data-end="99.979">we can look at it and it'll be pretty</span> <span data-start="99.979" data-end="102.57">top is working on a book I think there's</span> <span data-start="102.57" data-end="104.159">there's some others in the works there's</span> <span data-start="104.159" data-end="106.02">there's translations in the various</span> <span data-start="106.02" data-end="109.68">languages and we are spamming hacker</span> <span data-start="109.68" data-end="112.8">news all the time</span> <span data-start="112.81" data-end="115.119">because I don't know we like to click</span> <span data-start="115.119" data-end="117.15">the up button</span> <span data-start="117.15" data-end="122.29">okay so May 2009 initial release then we</span> <span data-start="122.29" data-end="124">did the first stable release which was</span> <span data-start="124" data-end="128.38">zipped to in late 2010 and we just came</span> <span data-start="128.38" data-end="131.5">out with 0 4 which kind of had a bumpy</span> <span data-start="131.5" data-end="133.78">first few versions and is still a bit</span> <span data-start="133.78" data-end="138.28">bumpy with with SSL and stuff but it's</span> <span data-start="138.28" data-end="141.61">getting better starting to feel kind of</span> <span data-start="141.61" data-end="145.239">good about the new stuff that went into</span> <span data-start="145.239" data-end="151.54">0 4 so 0 4 was all about fixing SSL and</span> <span data-start="151.54" data-end="161.42">doing HTTP and</span> <span data-start="161.43" data-end="165.09">hello didn't anybody hear what I just</span> <span data-start="165.09" data-end="165.54">said</span> <span data-start="165.54" data-end="169.98">no okay so zero for I mean the main</span> <span data-start="169.98" data-end="172.83">focus was fixing the HTTP client</span> <span data-start="172.83" data-end="176.879">interface and fixing the and and doing</span> </p>
<p><span data-start="176.879" data-end="180.48">SSL properly with much thanks to Paul</span> <span data-start="180.48" data-end="182.61">Clara and a lot of other people who</span> <span data-start="182.61" data-end="189.03">worked on this so zero five is is our</span> <span data-start="189.03" data-end="190.86">next unstable release which we're</span> <span data-start="190.86" data-end="194.04">already working on and the the stable</span> <span data-start="194.04" data-end="196.5">release will be zero six and that will</span> <span data-start="196.5" data-end="199.01">be in about two to three months</span> <span data-start="199.01" data-end="204.03">hopefully so the goal of this basically</span> <span data-start="204.03" data-end="208.019">is windows compatibility we are taking</span> <span data-start="208.019" data-end="212.73">it very seriously to which you know most</span> <span data-start="212.73" data-end="215.12">of you people with all your glowing</span> <span data-start="215.12" data-end="218.48">icons out there on your laptops I see</span> <span data-start="218.48" data-end="221.569">you probably don't care so much because</span> <span data-start="221.569" data-end="223.98">the typical response from web</span> <span data-start="223.98" data-end="225.72">programmers is like what windows I mean</span> <span data-start="225.72" data-end="229.079">who uses that but actually believe it or</span> <span data-start="229.079" data-end="231.919">not I'm sure some of you believe it that</span> </p>
<p><span data-start="231.919" data-end="234.69">Windows does account for a large number</span> <span data-start="234.69" data-end="237.84">of the computers in the world in</span> <span data-start="237.84" data-end="242.329">particular servers there are a lot of</span> <span data-start="242.329" data-end="245.819">what's that exchange thing yeah mail</span> <span data-start="245.819" data-end="249.78">thing that that windows people use 33%</span> <span data-start="249.78" data-end="252.599">of servers according to Wikipedia we</span> <span data-start="252.599" data-end="256.079">want that market like for node to really</span> <span data-start="256.079" data-end="263.669">be a game it's total world domination we</span> <span data-start="263.669" data-end="265.86">have to target that that audience it's</span> <span data-start="265.86" data-end="268.68">it's not it's not acceptable to just</span> <span data-start="268.68" data-end="273.99">ignore that and continue onwards so we</span> <span data-start="273.99" data-end="277.11">do have a Windows port currently but</span> <span data-start="277.11" data-end="280.5">it's it's cygwin and nobody likes cygwin</span> <span data-start="280.5" data-end="282.33">everybody hates it it's just kind of</span> <span data-start="282.33" data-end="285.599">something that you do to get by and it's</span> <span data-start="285.599" data-end="287.97">buggy and it's slow and you wouldn't</span> <span data-start="287.97" data-end="290.55">really run a server off of cygwin but</span> <span data-start="290.55" data-end="292.8">you know it's a nice stopgap</span> <span data-start="292.8" data-end="295.47">to help the windows people get going but</span> <span data-start="295.47" data-end="297.33">from what I hear it's much better to</span> <span data-start="297.33" data-end="301.379">just spin up a VMware instance of Lenox</span> <span data-start="301.379" data-end="306.449">and run node there rather than in cygwin</span> <span data-start="306.449" data-end="309.27">that's not real that's not a real</span> </p>
<p><span data-start="309.27" data-end="314.55">Windows port so question I guess a</span> <span data-start="314.55" data-end="315.96">reasonable question is is it even</span> <span data-start="315.96" data-end="319.139">possible to do decent servers in Windows</span> <span data-start="319.139" data-end="322.349">like obviously like the the rest of the</span> <span data-start="322.349" data-end="325.53">OS is so awful like it would not be</span> <span data-start="325.53" data-end="328.259">surprising that you know it is just</span> <span data-start="328.259" data-end="330.479">simply impossible to write a decent</span> <span data-start="330.479" data-end="333.719">server and by decent you know I mean</span> <span data-start="333.719" data-end="336.81">could handle 10,000 idle connections and</span> <span data-start="336.81" data-end="339.18">not you know just churn and spin to</span> <span data-start="339.18" data-end="344.33">death right so it is possible actually</span> </p>
<p><span data-start="344.33" data-end="347.52">Microsoft does have smart people and</span> <span data-start="347.52" data-end="351.44">they do have you know fairly advanced</span> <span data-start="351.44" data-end="354.99">techniques and in the in the api's but</span> <span data-start="354.99" data-end="358.62">it's not the same as unit and I think</span> <span data-start="358.62" data-end="360.93">that's why a lot of software doesn't</span> <span data-start="360.93" data-end="363.719">actually make the make the jump from</span> <span data-start="363.719" data-end="369.599">from UNIX to to Windows we are going to</span> <span data-start="369.599" data-end="373.199">make the jump so in UNIX</span> <span data-start="373.199" data-end="377.849">a good server software would mean that</span> <span data-start="377.849" data-end="380.61">you do non-blocking sockets and that you</span> <span data-start="380.61" data-end="383.729">use a constant time io multiplexer like</span> <span data-start="383.729" data-end="386.819">KQ or eople like this is the definition</span> <span data-start="386.819" data-end="389.699">of this is what you must do on UNIX</span> <span data-start="389.699" data-end="394.639">systems to create a reasonable server</span> <span data-start="394.639" data-end="401.61">Windows has the the UNIX e select but</span> <span data-start="401.61" data-end="404.159">it's not constant time and that means</span> <span data-start="404.159" data-end="406.8">like when you load it up with with save</span> <span data-start="406.8" data-end="410.34">more than a hundred file descriptors it</span> <span data-start="410.34" data-end="412.919">becomes slow it doesn't scale with the</span> <span data-start="412.919" data-end="414.419">number of sockets that you want to load</span> <span data-start="414.419" data-end="416.699">on this right your your your polling for</span> <span data-start="416.699" data-end="419.46">for file system state for file</span> <span data-start="419.46" data-end="421.949">descriptor state changes and it just it</span> <span data-start="421.949" data-end="423.779">can't do that in a reasonable amount of</span> <span data-start="423.779" data-end="424.38">time</span> <span data-start="424.38" data-end="426.21">has to scan over all these sockets all</span> <span data-start="426.21" data-end="431.07">the time so they also have this thing</span> <span data-start="431.07" data-end="437.45">called WUSA event select which is better</span> <span data-start="437.45" data-end="441.33">in that it's it's it doesn't have the</span> <span data-start="441.33" data-end="444.63">the same properties of having to scan</span> <span data-start="444.63" data-end="447.75">all the file descriptors every time but</span> <span data-start="447.75" data-end="449.97">the the pulling mechanism which is WS a</span> <span data-start="449.97" data-end="452.16">wait for multiple events these people</span> <span data-start="452.16" data-end="456.6">and their names and is actually limited</span> <span data-start="456.6" data-end="460.08">to 64 file descriptors per threat and</span> <span data-start="460.08" data-end="461.46">they're actually not file descriptors</span> <span data-start="461.46" data-end="465.86">here handles 64 sockets per per threat</span> <span data-start="465.86" data-end="468.96">great yeah good choice like what what</span> <span data-start="468.96" data-end="473.37">why 64 sockets per thread like no we</span> <span data-start="473.37" data-end="477.06">want 20,000 like this is ridiculous so</span> <span data-start="477.06" data-end="477.96">that's awesome</span> <span data-start="477.96" data-end="482.13">right so at which point you learn these</span> <span data-start="482.13" data-end="484.29">things and you're just like well I guess</span> <span data-start="484.29" data-end="485.67">to our server is going to suck on</span> </p>
<p><span data-start="485.67" data-end="492.03">Windows you know but we are nerds and so</span> <span data-start="492.03" data-end="497.25">we we we get into reading documentation</span> <span data-start="497.25" data-end="500.22">for long periods of time and you find</span> <span data-start="500.22" data-end="503.4">out that it is actually possible to</span> <span data-start="503.4" data-end="506.28">write really good servers on Windows</span> <span data-start="506.28" data-end="508.32">with something called IO completion</span> <span data-start="508.32" data-end="509.37">ports</span> <span data-start="509.37" data-end="512.669">it's just that IO completion ports don't</span> <span data-start="512.669" data-end="515.82">act the same way it's it's not the same</span> <span data-start="515.82" data-end="518.34">concept as what you have in Unix in Unix</span> <span data-start="518.34" data-end="522.69">you are as I said you're waiting for</span> <span data-start="522.69" data-end="524.64">file descriptor state changes so you're</span> <span data-start="524.64" data-end="527.85">waiting for you know that socket to</span> <span data-start="527.85" data-end="529.71">become readable so that you can read</span> <span data-start="529.71" data-end="531.9">from it doing a non-blocking read or</span> <span data-start="531.9" data-end="533.49">you're waiting for that socket to become</span> <span data-start="533.49" data-end="535.29">writable because you've got a big buffer</span> <span data-start="535.29" data-end="539.88">of stuff to dump to it in Windows in in</span> </p>
<p><span data-start="539.88" data-end="542.76">IO completion ports it's rather that you</span> <span data-start="542.76" data-end="546.93">write to the socket and you get told</span> <span data-start="546.93" data-end="549.39">when it's done so the the kernel manages</span> <span data-start="549.39" data-end="552.36">the the send buffer for you and when you</span> <span data-start="552.36" data-end="554.1">want to read from the socket you just</span> <span data-start="554.1" data-end="555.93">read full you give it a buffer you read</span> <span data-start="555.93" data-end="558.089">from it and then you go away</span> <span data-start="558.089" data-end="560.339">calls you back in the future so somehow</span> <span data-start="560.339" data-end="566.879">it's a higher level interface iocp also</span> <span data-start="566.879" data-end="569.97">supports pipes which is cool but</span> <span data-start="569.97" data-end="572.999">whatever but regular files is is really</span> <span data-start="572.999" data-end="575.759">interesting so you can actually do have</span> <span data-start="575.759" data-end="578.939">real asynchronous file IO in in the</span> <span data-start="578.939" data-end="582.779">kernel on Windows and not have to do</span> <span data-start="582.779" data-end="583.499">these tricks</span> <span data-start="583.499" data-end="585.899">so if you're familiar with how we do</span> <span data-start="585.899" data-end="588.779">this in in node we also do a synchronous</span> <span data-start="588.779" data-end="591.269">file IO but we have to hack it so we we</span> <span data-start="591.269" data-end="595.17">have userspace threads that we execute</span> <span data-start="595.17" data-end="597.629">system calls in which is I mean totally</span> <span data-start="597.629" data-end="600.059">stupid but there there's no way to get</span> <span data-start="600.059" data-end="607.589">around that in UNIX um so one for one</span> <span data-start="607.589" data-end="611.579">one point for Windows right the good</span> <span data-start="611.579" data-end="614.91">thing is that nodes API as as we present</span> <span data-start="614.91" data-end="619.41">it to users is already iocp Masek or</span> <span data-start="619.41" data-end="626.819">whatever is already iocp ish so so you</span> <span data-start="626.819" data-end="629.129">you do write to a socket and you get a</span> <span data-start="629.129" data-end="632.189">callback when it's done you just receive</span> <span data-start="632.189" data-end="634.47">data from from sockets so you don't have</span> <span data-start="634.47" data-end="636.059">this kind of interface where you're</span> <span data-start="636.059" data-end="639.209">you're polling for file system for for</span> <span data-start="639.209" data-end="642.87">file descriptor state changes what does</span> <span data-start="642.87" data-end="644.699">that mean it means that we can probably</span> <span data-start="644.699" data-end="647.91">rework the plumbing without changing the</span> <span data-start="647.91" data-end="651.72">user facing API so it's likely that 0/6</span> <span data-start="651.72" data-end="654.8">won't have any API changes or if so</span> <span data-start="654.8" data-end="657.3">relatively minor ones that we just have</span> <span data-start="657.3" data-end="662.129">to fix but rather the whole the whole</span> <span data-start="662.129" data-end="665.879">plumbing will be reworked to deal with</span> <span data-start="665.879" data-end="671.459">this there have been some other attempts</span> <span data-start="671.459" data-end="676.98">to create a server library that works on</span> <span data-start="676.98" data-end="681.059">both UNIX and Windows but somehow none</span> <span data-start="681.059" data-end="683.249">of them are acceptable Libby V which we</span> <span data-start="683.249" data-end="687.149">use in in node currently does is very</span> </p>
<p><span data-start="687.149" data-end="689.41">UNIX II it's a perfect perfect</span> <span data-start="689.41" data-end="693.839">abstraction over UNIX IO multiplexers on</span> <span data-start="693.839" data-end="696.97">Windows however it just doesn't have it</span> <span data-start="696.97" data-end="699.67">you know Libby V is all about file</span> <span data-start="699.67" data-end="701.47">descriptors and if they're readable or</span> <span data-start="701.47" data-end="703.66">write a book it doesn't pour it on to</span> <span data-start="703.66" data-end="708.31">unto iocp you can run Libby v on select</span> <span data-start="708.31" data-end="710.889">on Windows but as we said before that's</span> <span data-start="710.889" data-end="714.279">that's somewhat unacceptable</span> <span data-start="714.279" data-end="718.48">there's live event so lib event â€” did</span> <span data-start="718.48" data-end="722.139">some plumbing of their own and now runs</span> <span data-start="722.139" data-end="727.18">on iocp on Windows but at least one</span> <span data-start="727.18" data-end="730.389">person pointed out in a in a mailing</span> <span data-start="730.389" data-end="733.3">list post that it's really bad like I</span> <span data-start="733.3" data-end="734.29">don't know</span> <span data-start="734.29" data-end="737.079">you can push like between two two</span> <span data-start="737.079" data-end="739.24">sockets you can push like 100 megabits</span> <span data-start="739.24" data-end="743.74">or something like through the loop back</span> <span data-start="743.74" data-end="746.379">like the it doesn't seem like they've</span> <span data-start="746.379" data-end="748.509">done a very good job of doing that like</span> <span data-start="748.509" data-end="750.339">they they did a lot of work to sit on</span> <span data-start="750.339" data-end="753.189">top of IOC P but somehow they they</span> <span data-start="753.189" data-end="760.16">didn't achieve actual speed so fail um</span> <span data-start="760.17" data-end="763.3">it also also a live event doesn't it</span> <span data-start="763.3" data-end="764.98">doesn't deal with it's only dealing with</span> <span data-start="764.98" data-end="767.589">sockets right and then there's boost</span> </p>
<p><span data-start="767.589" data-end="772.779">ASIO which is this c++ monstrosity you</span> <span data-start="772.779" data-end="774.519">know you you have to download it it's</span> <span data-start="774.519" data-end="777.43">about 60 megabytes of source code and</span> <span data-start="777.43" data-end="781.149">like it's just so many files and so much</span> <span data-start="781.149" data-end="784.18">api apparently it does work though they</span> <span data-start="784.18" data-end="786.37">do actually give you a poll on Lennox</span> <span data-start="786.37" data-end="791.5">and iocp on on Windows but it's just so</span> <span data-start="791.5" data-end="793.93">massive and it's just like seriously is</span> <span data-start="793.93" data-end="795.519">this such a hard problem like all I want</span> <span data-start="795.519" data-end="798.009">to do is like write to a socket like</span> <span data-start="798.009" data-end="800.68">this is this is not such a difficult</span> <span data-start="800.68" data-end="803.41">problem that we really require three</span> <span data-start="803.41" data-end="806.139">hundred files and twelve thousand</span> <span data-start="806.139" data-end="813.069">semicolons is what i WC gelled so it</span> <span data-start="813.069" data-end="816.85">also doesn't support regular files this</span> <span data-start="816.85" data-end="819.639">is all crap like the it's not all crap</span> <span data-start="819.639" data-end="821.529">but it's it's just not acceptable for</span> <span data-start="821.529" data-end="823.03">what we want to do</span> <span data-start="823.03" data-end="825.61">and I just think the problem is is not</span> <span data-start="825.61" data-end="829.27">that hard especially on now that we have</span> </p>
<p><span data-start="829.27" data-end="832.09">Libby V on on UNIX which is a very sort</span> <span data-start="832.09" data-end="834.94">of thin layer we can use Libby Beyond on</span> <span data-start="834.94" data-end="838.39">UNIX to prop up this system and it's</span> <span data-start="838.39" data-end="840.58">done you know most of the work for us</span> <span data-start="840.58" data-end="842.56">for most of the operating systems and</span> <span data-start="842.56" data-end="846.31">then on Windows we have iocp and so we</span> <span data-start="846.31" data-end="848.86">just need to make like a little layer</span> <span data-start="848.86" data-end="852.37">over that so that's this thing it's</span> <span data-start="852.37" data-end="854.89">called lib Ohio it was called lib oh</span> <span data-start="854.89" data-end="856.81">well and I think we'll change the name</span> <span data-start="856.81" data-end="859.6">again just to just to confuse everybody</span> <span data-start="859.6" data-end="863.7">because nobody will actually use it so</span> <span data-start="863.7" data-end="866.29">currently this this is being done in a</span> <span data-start="866.29" data-end="869.26">separate repository than node but that's</span> <span data-start="869.26" data-end="872.71">just to kind of maintain purity we want</span> <span data-start="872.71" data-end="874.69">all of our tests to B and C and we want</span> <span data-start="874.69" data-end="876.49">to make sure that we're not you know</span> <span data-start="876.49" data-end="880.05">tempted to jump into some laughs</span> <span data-start="880.05" data-end="884.65">loveliness and you know use node to do</span> <span data-start="884.65" data-end="886.18">the testing and stuff we want all this</span> <span data-start="886.18" data-end="888.7">this to be very pure and and just</span> <span data-start="888.7" data-end="895.21">dealing with with the C system so it's</span> <span data-start="895.21" data-end="898.06">actually working the the TCP socket and</span> <span data-start="898.06" data-end="901.93">server stuff basically is more or less</span> <span data-start="901.93" data-end="904.39">working yeah there's some there's</span> <span data-start="904.39" data-end="906.13">probably some bugs still so so we're</span> <span data-start="906.13" data-end="910.41">writing a lot of tests and actually I</span> <span data-start="910.41" data-end="913.54">would like to ask if you are interested</span> <span data-start="913.54" data-end="915.55">in in system programming or you're</span> <span data-start="915.55" data-end="917.98">you're somehow interested in this</span> <span data-start="917.98" data-end="919.99">problem a great way to get involved with</span> <span data-start="919.99" data-end="922.84">lib Ohio is to go in there and write a</span> <span data-start="922.84" data-end="925.03">test I mean the tests are huge because</span> <span data-start="925.03" data-end="926.83">they're C and you have to set up servers</span> <span data-start="926.83" data-end="928.81">and stuff and it's it's not incredibly</span> <span data-start="928.81" data-end="932.53">fun but but we do need some the the main</span> <span data-start="932.53" data-end="934.45">point of this is is that we have two</span> <span data-start="934.45" data-end="936.49">different implementations and so testing</span> <span data-start="936.49" data-end="941.44">is everything in this system so since we</span> <span data-start="941.44" data-end="944.02">have the the socket stuff the TCP socket</span> <span data-start="944.02" data-end="947.26">stuff worked out more or less we're</span> <span data-start="947.26" data-end="949.18">probably going to be dropping this into</span> <span data-start="949.18" data-end="952.24">node master very soon now like next week</span> <span data-start="952.24" data-end="956">which will just destroy everything but</span> <span data-start="956" data-end="959.47">that's okay</span> </p>
<p><span data-start="959.48" data-end="963.23">Bert builder of of cloud kick is is</span> <span data-start="963.23" data-end="965.39">doing the windows side and I'm doing the</span> <span data-start="965.39" data-end="971.96">UNIX side so here's here's the nice</span> <span data-start="971.96" data-end="974.63">architectural diagram it's actually not</span> <span data-start="974.63" data-end="978.02">that nice um but it should be in two</span> <span data-start="978.02" data-end="980.45">squares right because one's representing</span> <span data-start="980.45" data-end="982.87">Windows and one's representing UNIX and</span> <span data-start="982.87" data-end="986.72">whatever but you get the point is is</span> <span data-start="986.72" data-end="989.75">that iocp is kind of a higher level</span> <span data-start="989.75" data-end="993.41">interface then then what UNIX provides</span> <span data-start="993.41" data-end="996.68">it's it's somehow more abstract and so</span> <span data-start="996.68" data-end="999.56">we we kind of are sitting on top of that</span> <span data-start="999.56" data-end="1002.44">and on on UNIX we have to kind of shim</span> <span data-start="1002.44" data-end="1004.21">that up with some extra libraries the</span> </p>
<p><span data-start="1004.21" data-end="1009.43">Libby B and libo i/o so the goal of this</span> <span data-start="1009.43" data-end="1014.68">is to avoid if def help we don't want</span> <span data-start="1014.68" data-end="1017.38">the entire source code of node to just</span> <span data-start="1017.38" data-end="1019.99">be littered with these preprocessor</span> <span data-start="1019.99" data-end="1022">branches that you know have different</span> <span data-start="1022" data-end="1024.91">implementations of every function the</span> <span data-start="1024.91" data-end="1026.65">goal is to push all the platform and</span> <span data-start="1026.65" data-end="1029.079">compatibility into this live Oh IO well</span> <span data-start="1029.079" data-end="1031.569">as much as makes sense obviously like we</span> <span data-start="1031.569" data-end="1034.02">don't want to get crazy about this but</span> <span data-start="1034.02" data-end="1037.089">let's get crazy a little bit we'll push</span> <span data-start="1037.089" data-end="1041.41">push it all down and then the the so</span> <span data-start="1041.41" data-end="1043.24">we'll have all the the platform stuff</span> <span data-start="1043.24" data-end="1045.79">into the this C library and then the</span> <span data-start="1045.79" data-end="1048.25">binding layer and the JavaScript stuff</span> <span data-start="1048.25" data-end="1051.64">should in the end be completely</span> <span data-start="1051.64" data-end="1052.51">cross-platform</span> <span data-start="1052.51" data-end="1055.45">ideally that's not the case right now so</span> <span data-start="1055.45" data-end="1059.62">if you look at the net dot J I told you</span> <span data-start="1059.62" data-end="1061.24">guys this would be a very boring talk I</span> <span data-start="1061.24" data-end="1062.05">am</span> </p>
<p><span data-start="1062.05" data-end="1067.72">I apologize I'm sure there will be like</span> <span data-start="1067.72" data-end="1069.55">very nice</span> <span data-start="1069.55" data-end="1072.9">I think sub stack made a Markov</span> <span data-start="1072.9" data-end="1076.3">generating rap IRC log thing this will</span> <span data-start="1076.3" data-end="1080.06">be fun</span> <span data-start="1080.07" data-end="1082.58">yes so we will avoid if deaf hell</span> <span data-start="1082.58" data-end="1085.2">another component of Windows is that</span> <span data-start="1085.2" data-end="1087.209">Windows users don't typically have</span> <span data-start="1087.209" data-end="1093.389">compiler tool chains so so we want to</span> <span data-start="1093.389" data-end="1095.849">distribute executables and one thing</span> <span data-start="1095.849" data-end="1097.409">that we've tried very hard in node is</span> <span data-start="1097.409" data-end="1099.869">not to dynamically link to everything in</span> <span data-start="1099.869" data-end="1101.759">the entire system although you know you</span> <span data-start="1101.759" data-end="1103.169">give it to the Debian package maintainer</span> <span data-start="1103.169" data-end="1105.149">x' and they're like static linking you</span> <span data-start="1105.149" data-end="1109.299">guys are idiots let's tear this apart um</span> </p>
<p><span data-start="1109.309" data-end="1117.719">Debian God so I'm glad that's being some</span> <span data-start="1117.719" data-end="1120.149">applause um there's probably one guy</span> <span data-start="1120.149" data-end="1123.349">that's like a Debian package Minturn</span> <span data-start="1123.349" data-end="1126.539">node you know they call our executable</span> <span data-start="1126.539" data-end="1128.399">nodejs instead of node because there's</span> <span data-start="1128.399" data-end="1132.229">some like ham-radio node executable know</span> <span data-start="1132.229" data-end="1134.879">we will get node okay the ham-radio</span> <span data-start="1134.879" data-end="1143.519">thing can change its name so right on</span> <span data-start="1143.519" data-end="1146.129">windows have you ever downloaded putty</span> <span data-start="1146.129" data-end="1149.639">it's like an exe file so beautiful like</span> <span data-start="1149.639" data-end="1152.099">I love that you just download it you run</span> <span data-start="1152.099" data-end="1154.649">it it works that is basically what we</span> <span data-start="1154.649" data-end="1157.349">will be able to do on Windows possibly</span> <span data-start="1157.349" data-end="1160.95">if we're if we're careful so I would</span> <span data-start="1160.95" data-end="1162.179">like to get to the state where we</span> <span data-start="1162.179" data-end="1166.2">literally distribute a exe file and</span> <span data-start="1166.2" data-end="1167.82">people can download that and now they</span> <span data-start="1167.82" data-end="1171.839">have note yes</span> <span data-start="1171.839" data-end="1174.299">it will be a nice user experience for</span> <span data-start="1174.299" data-end="1177.719">the windows people npm the package</span> <span data-start="1177.719" data-end="1182.729">manager are has a concept of building</span> <span data-start="1182.729" data-end="1187.409">add-ons right if you download I can't</span> <span data-start="1187.409" data-end="1189.029">even think of a library now something</span> <span data-start="1189.029" data-end="1191.549">you know there's all these add-ons it</span> <span data-start="1191.549" data-end="1193.82">will run through some GCC commands right</span> </p>
<p><span data-start="1193.82" data-end="1196.919">Windows users don't like to do that they</span> <span data-start="1196.919" data-end="1199.829">want binary stuff and actually a lot of</span> <span data-start="1199.829" data-end="1202.049">UNIX users also want binary stuff so</span> <span data-start="1202.049" data-end="1205.169">Isaac's been working on augmenting the</span> <span data-start="1205.169" data-end="1208.789">the package repository to store binary</span> <span data-start="1208.789" data-end="1211.59">compiled versions of the add-ons</span> <span data-start="1211.59" data-end="1213.96">that most people will be able to</span> <span data-start="1213.96" data-end="1218.85">download and just get a a pre pre</span> <span data-start="1218.85" data-end="1225.96">compiled dll and something that I really</span> <span data-start="1225.96" data-end="1229.679">want is long stack traces which I won't</span> <span data-start="1229.679" data-end="1231.659">go into what that is basically stack</span> <span data-start="1231.659" data-end="1234.299">traces that span events when you hit an</span> <span data-start="1234.299" data-end="1242.22">exception this will point of contention</span> <span data-start="1242.22" data-end="1247.14">yes so the primary thing that's</span> <span data-start="1247.14" data-end="1249.029">preventing us from doing that is that we</span> <span data-start="1249.029" data-end="1251.46">need entry points from the event loop</span> <span data-start="1251.46" data-end="1253.47">into JavaScript and we need to know</span> <span data-start="1253.47" data-end="1255.63">where all of those are and we need to</span> <span data-start="1255.63" data-end="1257.909">have a hook that is unified so that we</span> <span data-start="1257.909" data-end="1262.47">can do stuff there and currently it's</span> <span data-start="1262.47" data-end="1265.32">just spattered around the the system</span> <span data-start="1265.32" data-end="1267.419">it's just very hard to organize it we</span> <span data-start="1267.419" data-end="1269.1">don't have kind of a single entry point</span> <span data-start="1269.1" data-end="1270.929">where we can say okay now we are leaving</span> </p>
<p><span data-start="1270.929" data-end="1274.47">Libby B and going into into JavaScript</span> <span data-start="1274.47" data-end="1275.27">land</span> <span data-start="1275.27" data-end="1279">so with this plumbing reworking in mind</span> <span data-start="1279" data-end="1282.149">we know that we want that and so we will</span> <span data-start="1282.149" data-end="1285.899">take special care to to get these hooks</span> <span data-start="1285.899" data-end="1291.24">in there and as I said we don't want to</span> <span data-start="1291.24" data-end="1294.99">go the Libby B Lib event to path so you</span> <span data-start="1294.99" data-end="1296.85">know if we can't get gigabit throughput</span> <span data-start="1296.85" data-end="1299.039">over the loopback with the pair of TCP</span> <span data-start="1299.039" data-end="1302.13">sockets and have like 10,000 idle</span> <span data-start="1302.13" data-end="1305.37">connections on a on a server on every OS</span> <span data-start="1305.37" data-end="1307.549">then then clearly we have failed so</span> <span data-start="1307.549" data-end="1309.99">hopefully we that will not be the case</span> <span data-start="1309.99" data-end="1312.51">so we're trying to do benchmarking and</span> <span data-start="1312.51" data-end="1314.88">testing early on in the development of</span> <span data-start="1314.88" data-end="1317.27">this of this library so that we're not</span> <span data-start="1317.27" data-end="1319.77">so we don't like wake up in like you</span> <span data-start="1319.77" data-end="1321.63">know a year after our big refactor</span> <span data-start="1321.63" data-end="1323.64">somebody mails the mailing list and it</span> <span data-start="1323.64" data-end="1325.23">says oh I did this benchmark and it's</span> <span data-start="1325.23" data-end="1328.71">terrible no so hopefully we will know</span> <span data-start="1328.71" data-end="1331.23">where we're doing that is the end of my</span> <span data-start="1331.23" data-end="1342.42">talk you can ask me questions</span> <span data-start="1342.43" data-end="1344.53">so the question is are there any big</span> <span data-start="1344.53" data-end="1347.29">things that I that we have to give up in</span> <span data-start="1347.29" data-end="1352.93">order to do windows no actually not what</span> <span data-start="1352.93" data-end="1355.45">we have to do I mean the big thing that</span> <span data-start="1355.45" data-end="1357.52">we have to do is is we have to push some</span> <span data-start="1357.52" data-end="1359.32">of this code that's written in</span> </p>
<p><span data-start="1359.32" data-end="1362.71">JavaScript now the Lib Lib net-lib KS</span> <span data-start="1362.71" data-end="1368.14">into Sealand and it's unclear right now</span> <span data-start="1368.14" data-end="1372.96">if jumping between the c++ boundary and</span> <span data-start="1372.96" data-end="1375.76">javascript which we will possibly be</span> <span data-start="1375.76" data-end="1378.31">doing more of with this new binding</span> <span data-start="1378.31" data-end="1382.24">because whatever that that may affect</span> <span data-start="1382.24" data-end="1383.98">performance but we really won't know</span> <span data-start="1383.98" data-end="1387.19">until we get there but otherwise I mean</span> <span data-start="1387.19" data-end="1389.17">the the binding is very thin that we're</span> <span data-start="1389.17" data-end="1391.33">not we're not doing a bunch of magic</span> <span data-start="1391.33" data-end="1392.92">stuff here so we're just kind of</span> <span data-start="1392.92" data-end="1396.78">massaging the api's into place so no I</span> <span data-start="1396.78" data-end="1403.87">confidently so the question is have I</span> <span data-start="1403.87" data-end="1405.07">thought much about what comes after</span> <span data-start="1405.07" data-end="1412.84">windows compatibility yeah I mean there</span> <span data-start="1412.84" data-end="1415.3">there's there's some more stuff we need</span> <span data-start="1415.3" data-end="1420.04">to do still in particular there there</span> <span data-start="1420.04" data-end="1422.02">there's a lot of cleanup stuff that</span> <span data-start="1422.02" data-end="1424">needs to happen but we are quickly</span> <span data-start="1424" data-end="1427.3">approaching a stable thing so there's</span> <span data-start="1427.3" data-end="1429.79">not a ton of reworking this I want to do</span> <span data-start="1429.79" data-end="1431.68">this thing now because this is going to</span> <span data-start="1431.68" data-end="1435.85">basically be rewriting node we have a</span> <span data-start="1435.85" data-end="1440.11">lot of tests now so we can kind of with</span> <span data-start="1440.11" data-end="1441.61">some confidence say that we're going to</span> <span data-start="1441.61" data-end="1445.39">actually make it but I yeah we're</span> <span data-start="1445.39" data-end="1449.68">quickly approaching a 1.0 I don't worry</span> <span data-start="1449.68" data-end="1451.84">about it I mean one thing I've learned</span> <span data-start="1451.84" data-end="1454.18">is that like if you're not I mean we</span> <span data-start="1454.18" data-end="1456.94">will make every effort to make every</span> <span data-start="1456.94" data-end="1460.99">piece of core API work on both systems</span> <span data-start="1460.99" data-end="1464.95">in the most decent way oh by the way the</span> <span data-start="1464.95" data-end="1466.69">question was how can you prepare for</span> </p>
<p><span data-start="1466.69" data-end="1471.299">Windows API blah</span> <span data-start="1471.309" data-end="1473.98">just just hold off right I mean we might</span> <span data-start="1473.98" data-end="1475.419">just crash and burn here and the world</span> <span data-start="1475.419" data-end="1477.249">might explode so I mean don't worry</span> <span data-start="1477.249" data-end="1479.11">about it yet Hey hopefully hopefully</span> <span data-start="1479.11" data-end="1481.57">Scripps will just port over forward</span> <span data-start="1481.57" data-end="1483.49">slashes windows can deal with those it's</span> <span data-start="1483.49" data-end="1485.49">not it's not the worst thing on earth</span> <span data-start="1485.49" data-end="1488.169">that's not that's not the the path</span> <span data-start="1488.169" data-end="1491.129">problem is like the least of Windows</span> <span data-start="1491.129" data-end="1494.83">differences what's the next big thing</span> <span data-start="1494.83" data-end="1501.399">after Windows so just very vaguely I</span> <span data-start="1501.399" data-end="1503.95">think that that we need some some system</span> <span data-start="1503.95" data-end="1508.21">of connecting nodes together and kind of</span> <span data-start="1508.21" data-end="1510.58">managing multiple nodes and opening</span> <span data-start="1510.58" data-end="1513.389">channels between them that sort of thing</span> <span data-start="1513.389" data-end="1516.759">what are the the biggest problems people</span> <span data-start="1516.759" data-end="1523.529">have with node is that your question a</span> <span data-start="1523.529" data-end="1526.96">lot of people come to it and say people</span> <span data-start="1526.96" data-end="1528.639">can't program like this this is</span> <span data-start="1528.639" data-end="1532.389">impossible like this this outside in</span> <span data-start="1532.389" data-end="1534.129">word whatever spaghetti programming</span> <span data-start="1534.129" data-end="1537.749">style is is impossible to program in I</span> <span data-start="1537.749" data-end="1540.369">think those people haven't actually sat</span> <span data-start="1540.369" data-end="1542.71">down and like tried to write a program</span> <span data-start="1542.71" data-end="1544.659">or gotten deeply into it and I don't</span> <span data-start="1544.659" data-end="1547.45">think that that's really a huge problem</span> </p>
<p><span data-start="1547.45" data-end="1550.419">I think you can learn to do it's a</span> <span data-start="1550.419" data-end="1552.669">different programming style for sure but</span> <span data-start="1552.669" data-end="1555.73">you can learn to deal with that that</span> <span data-start="1555.73" data-end="1560.23">style of programming um I think the the</span> <span data-start="1560.23" data-end="1562.169">doubt that would be the made the most</span> <span data-start="1562.169" data-end="1564.73">the largest complaint the the second</span> <span data-start="1564.73" data-end="1567.879">largest complaint is the the point that</span> <span data-start="1567.879" data-end="1571.629">node is a single threaded deal</span> <span data-start="1571.629" data-end="1578.919">so I mean yeah you the you can't get</span> <span data-start="1578.919" data-end="1582.039">node to be scheduled to multiple CPUs</span> <span data-start="1582.039" data-end="1584.049">right so you you can't if you have this</span> <span data-start="1584.049" data-end="1585.97">server you can't you can't</span> <span data-start="1585.97" data-end="1588.789">naively take advantage of all the cores</span> <span data-start="1588.789" data-end="1592.24">on your system but we have ways of doing</span> <span data-start="1592.24" data-end="1594.73">dealing with that actually by I mean we</span> <span data-start="1594.73" data-end="1597.1">have a method of doing pre fork servers</span> <span data-start="1597.1" data-end="1599.919">and passing the server file descriptor</span> <span data-start="1599.919" data-end="1601.57">between processes and accepting</span> <span data-start="1601.57" data-end="1603.77">connections on each of them</span> </p>
<p><span data-start="1603.77" data-end="1608.419">I do think as I as I said what the next</span> <span data-start="1608.419" data-end="1610.4">big thing for note is that there is some</span> <span data-start="1610.4" data-end="1613.61">work to do with organizing these</span> <span data-start="1613.61" data-end="1615.59">multiple processes and making that</span> <span data-start="1615.59" data-end="1617.33">easier and more approachable and</span> <span data-start="1617.33" data-end="1620.12">possibly more native to note one thing I</span> <span data-start="1620.12" data-end="1622.24">didn't talk about with Windows is that</span> <span data-start="1622.24" data-end="1630.89">is that one minute 30 seconds okay one</span> <span data-start="1630.89" data-end="1632">thing I didn't talk about with Windows</span> <span data-start="1632" data-end="1633.5">is that Windows really hates processes</span> <span data-start="1633.5" data-end="1636.14">and they don't it's not clear to us</span> <span data-start="1636.14" data-end="1638.539">right now how we are going to do the pre</span> <span data-start="1638.539" data-end="1640.46">fork server thing on Windows because you</span> <span data-start="1640.46" data-end="1644.09">can't actually do the iocp except on</span> <span data-start="1644.09" data-end="1645.95">multiple processes on the same file</span> <span data-start="1645.95" data-end="1648.2">descriptor in Windows there's some</span> <span data-start="1648.2" data-end="1650.36">trickery that we can do by having</span> <span data-start="1650.36" data-end="1653.179">another thread and using select just for</span> <span data-start="1653.179" data-end="1655.07">accepting sockets and then you know you</span> <span data-start="1655.07" data-end="1656.75">can you can kind of get that into the</span> <span data-start="1656.75" data-end="1660.59">main iocp event loop but that's not what</span> </p>
<p><span data-start="1660.59" data-end="1662.75">Windows wants you to do they they want</span> <span data-start="1662.75" data-end="1664.82">you to have multiple threads in one</span> <span data-start="1664.82" data-end="1668.24">process and use iocp to dispatch to to</span> <span data-start="1668.24" data-end="1671.03">these threads so one thing that's</span> <span data-start="1671.03" data-end="1674.12">happening in in v8 3.2 which is the</span> <span data-start="1674.12" data-end="1676.039">version right after us we're pegged to</span> <span data-start="1676.039" data-end="1679.94">3.1 right now is they're doing a v8</span> <span data-start="1679.94" data-end="1681.59">there they have a new feature called</span> <span data-start="1681.59" data-end="1684.44">isolates which is basically you know</span> <span data-start="1684.44" data-end="1686.51">they used a lot of global variables and</span> <span data-start="1686.51" data-end="1688.07">now they're all packaging them up into</span> <span data-start="1688.07" data-end="1690.559">into an object so that you can start</span> <span data-start="1690.559" data-end="1694.82">multiple VMs inside of one process so</span> <span data-start="1694.82" data-end="1696.62">these VMs are thick right I mean they're</span> <span data-start="1696.62" data-end="1699.86">they're ten megabytes or something right</span> <span data-start="1699.86" data-end="1702.47">they they don't share anything which is</span> <span data-start="1702.47" data-end="1704.809">fine but that could be used and they're</span> <span data-start="1704.809" data-end="1707.179">going to use this on Chrome we could use</span> <span data-start="1707.179" data-end="1710.78">it to to start multiple v8 inside one</span> <span data-start="1710.78" data-end="1715.21">process and use iocp to to schedule the</span> <span data-start="1715.21" data-end="1718.01">isolates onto threads as they become</span> <span data-start="1718.01" data-end="1718.46">available</span> <span data-start="1718.46" data-end="1719.96">that would be the Windows II way to do</span> <span data-start="1719.96" data-end="1722.539">it but we also don't want to get too far</span> <span data-start="1722.539" data-end="1724.46">away from how UNIX does it so it's</span> <span data-start="1724.46" data-end="1725.809">unclear if we should split the</span> <span data-start="1725.809" data-end="1729.02">implementation or you know on on UNIX</span> <span data-start="1729.02" data-end="1731.57">you use multiple processes on on Windows</span> <span data-start="1731.57" data-end="1733.429">you use multiple threads or if we should</span> <span data-start="1733.429" data-end="1736.45">just try to port this threading idea to</span> <span data-start="1736.45" data-end="1741.25">unikz threads I mean kids these days no</span> </p>
<p><span data-start="1741.25" data-end="1745.93">I don't know um okay well I guess I'm</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
