<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ItyUjVWl4q8</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/ItyUjVWl4q8?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="3.109" data-end="5.729">thanks for having me here this is song</span> <span data-start="5.729" data-end="9.03">right but second okay today I'm going to</span> <span data-start="9.03" data-end="11.04">talk to you about implementing a visual</span> </p>
<p><span data-start="11.04" data-end="13.53">CSS testing framework using automatic</span> <span data-start="13.53" data-end="15.209">screenshot comparison to catch style</span> <span data-start="15.209" data-end="17.91">regressions my name is Jessica on the</span> <span data-start="17.91" data-end="20.76">internet and Jessica in real life and I</span> <span data-start="20.76" data-end="22.259">work at a company called bug snag here</span> <span data-start="22.259" data-end="24.42">in San Francisco bug snag is an</span> <span data-start="24.42" data-end="26.339">exception monitoring tool I'm a software</span> <span data-start="26.339" data-end="28.259">engineer they're working primarily in</span> <span data-start="28.259" data-end="30.24">Ruby and JavaScript but our stack</span> <span data-start="30.24" data-end="31.589">includes lots of languages including</span> <span data-start="31.589" data-end="34.62">node and go we're currently hiring so</span> <span data-start="34.62" data-end="36">please get in touch if you're interested</span> <span data-start="36" data-end="37.98">in working at a super small company for</span> <span data-start="37.98" data-end="40.59">developer tools so back to this whole</span> <span data-start="40.59" data-end="42.629">implementing a visual CSS testing</span> <span data-start="42.629" data-end="44.489">framework thing what am I even talking</span> <span data-start="44.489" data-end="47.73">about well at bug snag we decided we</span> <span data-start="47.73" data-end="49.23">wanted a way to automatically take two</span> <span data-start="49.23" data-end="51.87">screenshots of our website at different</span> <span data-start="51.87" data-end="55.14">times in our app for example since we</span> <span data-start="55.14" data-end="56.789">use get let's say we had a feature</span> <span data-start="56.789" data-end="58.68">branch that we just push to commit to</span> <span data-start="58.68" data-end="60.69">we'd want to take a screenshot of what</span> <span data-start="60.69" data-end="62.46">our home page looks like on that branch</span> <span data-start="62.46" data-end="64.92">and a screenshot of how our home page</span> <span data-start="64.92" data-end="66.63">looks on production or what's currently</span> <span data-start="66.63" data-end="69.509">running on master with those screenshots</span> <span data-start="69.509" data-end="71.99">we want to spot those differences and</span> <span data-start="71.99" data-end="74.549">produce some sort of diff image that</span> <span data-start="74.549" data-end="77.159">highlighted the difference is why would</span> <span data-start="77.159" data-end="80.28">we want to do this you ask well as we</span> <span data-start="80.28" data-end="82.29">all know writing reading and code</span> <span data-start="82.29" data-end="84.229">reviewing CSS can be pretty intense and</span> <span data-start="84.229" data-end="87.57">even more intense to refactor at bugs</span> <span data-start="87.57" data-end="89.25">nag we decided to do a huge</span> <span data-start="89.25" data-end="91.11">organizational and code style refactor</span> <span data-start="91.11" data-end="93.36">of our CSS and we wanted a way to test</span> <span data-start="93.36" data-end="94.95">that our site look the same despite</span> <span data-start="94.95" data-end="97.74">changing all of the code unfortunately</span> <span data-start="97.74" data-end="99.18">as you can tell that didn't really</span> <span data-start="99.18" data-end="101.369">always work out for us we went through</span> <span data-start="101.369" data-end="103.439">many iterations of refactoring and we</span> <span data-start="103.439" data-end="105.42">realized we needed a tool to help us out</span> <span data-start="105.42" data-end="108.869">and test our pages automatically so we</span> <span data-start="108.869" data-end="111">went on a hunt for a way to test our CSS</span> <span data-start="111" data-end="112.649">we wanted to know if there was a tool</span> <span data-start="112.649" data-end="114.06">already built that did what we wanted</span> <span data-start="114.06" data-end="116.1">without knowing exactly what it is that</span> <span data-start="116.1" data-end="118.74">we did want we first stumbled upon one</span> <span data-start="118.74" data-end="120.329">of Facebook's open source libraries</span> <span data-start="120.329" data-end="123.09">huxley and Huxley's read me it says</span> <span data-start="123.09" data-end="125.43">watches you browse take screenshots</span> <span data-start="125.43" data-end="127.2">tells you when they change which sounds</span> <span data-start="127.2" data-end="129.479">amazing it's exactly what we wanted but</span> </p>
<p><span data-start="129.479" data-end="131.85">I noticed it hadn't been updated in over</span> <span data-start="131.85" data-end="134.49">a year which wasn't promising but I</span> <span data-start="134.49" data-end="136.01">decided give it a shot anyway</span> <span data-start="136.01" data-end="138.21">after a good while of fiddling around</span> <span data-start="138.21" data-end="139.65">with Huxley it ended up being a little</span> <span data-start="139.65" data-end="141.54">bit too buggy for us although I did hear</span> <span data-start="141.54" data-end="143.19">somebody talking about it did work for</span> <span data-start="143.19" data-end="146.49">them so I'm happy yes but for us at it</span> <span data-start="146.49" data-end="148.44">would have random failures randomly</span> <span data-start="148.44" data-end="150.3">wouldn't take screenshots and I started</span> <span data-start="150.3" data-end="151.74">realizing it wasn't exactly what I was</span> <span data-start="151.74" data-end="153.18">looking for in a CSS testing tool anyway</span> </p>
<p><span data-start="153.18" data-end="156.15">I kept looking and it turns out there</span> <span data-start="156.15" data-end="157.35">are a lot of frameworks that do some</span> <span data-start="157.35" data-end="159.78">sort of CSS testing they all work in</span> <span data-start="159.78" data-end="161.43">different ways some take screenshots</span> <span data-start="161.43" data-end="164.16">some aren't even visual I definitely</span> <span data-start="164.16" data-end="166.05">recommend checking some of these out and</span> <span data-start="166.05" data-end="167.91">seeing if they fit what you're doing in</span> <span data-start="167.91" data-end="169.26">your apps before trying to build your</span> <span data-start="169.26" data-end="172.5">own but I really started thinking about</span> <span data-start="172.5" data-end="174.12">it what was I looking forward to CSS</span> <span data-start="174.12" data-end="176.25">testing framework what would fit the way</span> <span data-start="176.25" data-end="178.83">bug snag is built best I decided I</span> <span data-start="178.83" data-end="180.63">wanted a visual way to test my CSS with</span> <span data-start="180.63" data-end="182.37">screenshots rather than writing out</span> <span data-start="182.37" data-end="185.25">tests describing the visuals this is</span> <span data-start="185.25" data-end="187.26">where I need a disclaimer at bugs nag</span> <span data-start="187.26" data-end="188.73">our web dashboard is written in rails</span> <span data-start="188.73" data-end="191.22">this mix with the fact I wanted to test</span> <span data-start="191.22" data-end="192.75">to take screenshots affected my</span> <span data-start="192.75" data-end="194.25">decisions in what frameworks I wanted to</span> <span data-start="194.25" data-end="197.97">use we also use get for our source</span> <span data-start="197.97" data-end="199.68">control bug snag and we use it the</span> <span data-start="199.68" data-end="202.89">github way what that means is we have a</span> <span data-start="202.89" data-end="204.51">master branch which is always</span> <span data-start="204.51" data-end="207.53">deployables ready or it should be and</span> <span data-start="207.53" data-end="210">whenever we want to create a feature we</span> <span data-start="210" data-end="211.5">branch off master until it's ready and</span> <span data-start="211.5" data-end="214.25">then we were jit back into master</span> <span data-start="214.25" data-end="216.03">considering the tools we had at our</span> <span data-start="216.03" data-end="218.43">disposal and after taking a look at some</span> <span data-start="218.43" data-end="220.8">of the screenshot libraries their source</span> <span data-start="220.8" data-end="222.78">codes I realized that there actually</span> <span data-start="222.78" data-end="224.7">wasn't that much code going on in them</span> <span data-start="224.7" data-end="227.07">so I decided why not i'm going to write</span> <span data-start="227.07" data-end="229.67">one myself which is always a bad idea I</span> <span data-start="229.67" data-end="232.08">came up with a process of how I thought</span> </p>
<p><span data-start="232.08" data-end="235.8">I wanted my tests to work number one I</span> <span data-start="235.8" data-end="237.54">wanted a way to somehow automatically</span> <span data-start="237.54" data-end="241.17">visit pages of our site so the test</span> <span data-start="241.17" data-end="243.87">would in an actual browser hit each page</span> <span data-start="243.87" data-end="247.08">of our site on a local server once the</span> <span data-start="247.08" data-end="249.24">test visited the page I wanted the test</span> <span data-start="249.24" data-end="251.79">to take a screenshot of that page the</span> <span data-start="251.79" data-end="253.5">important bit for the screenshot is that</span> <span data-start="253.5" data-end="254.58">I'd wanted to take a screenshot of the</span> <span data-start="254.58" data-end="257.28">entire page not just the current view</span> <span data-start="257.28" data-end="259.98">port of the browser for example if a</span> <span data-start="259.98" data-end="261.39">change happened below the fold of our</span> <span data-start="261.39" data-end="262.98">site but we weren't taking full-page</span> <span data-start="262.98" data-end="264.63">screenshots we wouldn't be able to</span> <span data-start="264.63" data-end="268.14">capture the diff down there next I need</span> <span data-start="268.14" data-end="269.91">us I need somewhere to store these</span> <span data-start="269.91" data-end="272.04">shots and I need a way to upload and</span> <span data-start="272.04" data-end="273.57">download these screenshots from that</span> <span data-start="273.57" data-end="277.26">storage area so using get every time I</span> <span data-start="277.26" data-end="279.36">made a push to a branch I'd upload a</span> <span data-start="279.36" data-end="280.83">screenshot of the current state of each</span> <span data-start="280.83" data-end="284.28">page including our master branch and if</span> </p>
<p><span data-start="284.28" data-end="286.59">I had a screenshot already uploaded to</span> <span data-start="286.59" data-end="288.09">our storage area from our master branch</span> <span data-start="288.09" data-end="291.03">I need a way to upload my current</span> <span data-start="291.03" data-end="292.65">features branch to that storage area and</span> <span data-start="292.65" data-end="294.57">download my already uploaded master</span> <span data-start="294.57" data-end="298.95">screenshot from that storage area I then</span> <span data-start="298.95" data-end="300.66">need a way to make a diff of my</span> <span data-start="300.66" data-end="303.69">screenshots I'd want to diff between a</span> <span data-start="303.69" data-end="305.49">screenshot I took on master downloaded</span> <span data-start="305.49" data-end="307.17">from our storage area and the newest</span> <span data-start="307.17" data-end="310.59">screenshot I took on my future branch so</span> <span data-start="310.59" data-end="312.51">if i have the previous screen shot i</span> <span data-start="312.51" data-end="314.22">took which would be the current commit</span> <span data-start="314.22" data-end="316.44">commit on master vs my branches</span> <span data-start="316.44" data-end="319.62">screenshot i need a way to mark the</span> <span data-start="319.62" data-end="320.76">differences between those two</span> <span data-start="320.76" data-end="322.62">screenshots visually so in here it's the</span> <span data-start="322.62" data-end="326.55">header finally after i have just for all</span> <span data-start="326.55" data-end="328.17">my screenshots i need a way to view the</span> <span data-start="328.17" data-end="330.15">diffs even though i'll have a place to</span> <span data-start="330.15" data-end="332.22">upload them i did an accessible way for</span> <span data-start="332.22" data-end="333.57">everyone on the project to view the diff</span> <span data-start="333.57" data-end="336.69">screenshots depending on the commit so</span> <span data-start="336.69" data-end="338.64">now we have a plan we can start building</span> <span data-start="338.64" data-end="339.93">out our framework or on these things</span> <span data-start="339.93" data-end="343.95">that we need we need a way to write some</span> <span data-start="343.95" data-end="346.77">specs that will automatically run after</span> <span data-start="346.77" data-end="348.74">each push so we decided to use our spec</span> <span data-start="348.74" data-end="351.6">our spec is a testing tool for the Ruby</span> <span data-start="351.6" data-end="353.49">programming language we already had our</span> <span data-start="353.49" data-end="355.59">spec for our tests in our rails app so</span> <span data-start="355.59" data-end="356.85">writing these tests with our spec made</span> <span data-start="356.85" data-end="360.72">sense we wanted to be able to write</span> <span data-start="360.72" data-end="362.61">specs that look just like this where</span> <span data-start="362.61" data-end="365.27">we'd be able to navigate to a local URL</span> <span data-start="365.27" data-end="369.99">and save a screenshot of that page we</span> <span data-start="369.99" data-end="371.64">also wanted to these tests to be</span> <span data-start="371.64" data-end="375.78">separate from our main tests we pulled</span> <span data-start="375.78" data-end="377.37">out these visual specs into their own</span> <span data-start="377.37" data-end="380.04">r-spec tag that way these specs wouldn't</span> <span data-start="380.04" data-end="382.14">run with our main specs when we're</span> <span data-start="382.14" data-end="383.64">running the sweet locally unless we</span> <span data-start="383.64" data-end="386.13">explicitly asked it to this also made it</span> <span data-start="386.13" data-end="387.69">so we could break out our specs on our</span> </p>
<p><span data-start="387.69" data-end="390.9">CI we want on our visual specs to be</span> <span data-start="390.9" data-end="393.39">separate for a few reasons number one</span> <span data-start="393.39" data-end="396.57">our local build speed if our tell if our</span> <span data-start="396.57" data-end="398.13">local tests were bogged down by waiting</span> <span data-start="398.13" data-end="399.479">for visual specs that would become a</span> <span data-start="399.479" data-end="401.82">huge issue by having them broken out we</span> <span data-start="401.82" data-end="402.86">get iterate on our mains</span> </p>
<p><span data-start="402.86" data-end="404.569">Beck's faster and be able to push out</span> <span data-start="404.569" data-end="407.659">more often number two is speed with our</span> <span data-start="407.659" data-end="410.33">CI tests we wanted our main specs to</span> <span data-start="410.33" data-end="412.31">still be fast on our CI so that we could</span> <span data-start="412.31" data-end="414.409">merge non-visual pull requests without</span> <span data-start="414.409" data-end="416.889">waiting for our visual specs to finish</span> <span data-start="416.889" data-end="420.08">CI or continuous integration is a way</span> <span data-start="420.08" data-end="421.819">for us to automatically run our test</span> <span data-start="421.819" data-end="423.55">suite when we push things to github and</span> <span data-start="423.55" data-end="426.68">after our specs run on our CI we're able</span> <span data-start="426.68" data-end="428.509">to see if our build or is passing or not</span> <span data-start="428.509" data-end="432.439">I also learned that github just released</span> <span data-start="432.439" data-end="433.699">a new feature where you can split out</span> <span data-start="433.699" data-end="436.849">your build so thanks github so now we'll</span> <span data-start="436.849" data-end="438.409">be able to split out our visual specs</span> <span data-start="438.409" data-end="440.569">from our main specs here and so we can</span> <span data-start="440.569" data-end="442.46">quickly see which build is passing or</span> <span data-start="442.46" data-end="444.62">failing or still running without the</span> <span data-start="444.62" data-end="448.219">builds being combined at bugs now we</span> <span data-start="448.219" data-end="450.8">used build box for our CI build box</span> <span data-start="450.8" data-end="453.11">allows us to add steps to our tests that</span> <span data-start="453.11" data-end="454.639">way we can run our main specs first</span> <span data-start="454.639" data-end="457.639">apart from our visual specs and when</span> <span data-start="457.639" data-end="459.05">they're separate our visual specs don't</span> <span data-start="459.05" data-end="461.719">slow down our main specs and we converge</span> <span data-start="461.719" data-end="463.669">non-visual pull requests without waiting</span> <span data-start="463.669" data-end="468.469">for our visual specs to finish next we</span> <span data-start="468.469" data-end="470.18">needed a way to visit pages and take</span> <span data-start="470.18" data-end="472.279">screen shots with our r-spec tests for</span> <span data-start="472.279" data-end="475.43">that we decided to use selenium selenium</span> <span data-start="475.43" data-end="477.02">is a tool for automating browsers for</span> <span data-start="477.02" data-end="479.15">testing purposes we would need to use</span> <span data-start="479.15" data-end="482.15">specifically their webdriver API this</span> <span data-start="482.15" data-end="483.379">would allow us to drive a browser</span> <span data-start="483.379" data-end="485.089">natively on a local or remote machine</span> <span data-start="485.089" data-end="487.31">and more specifically this provides an</span> </p>
<p><span data-start="487.31" data-end="490.759">API between us and the browser to use</span> <span data-start="490.759" data-end="492.74">selenium we need to use the service like</span> <span data-start="492.74" data-end="495.62">soft labs or browser stack since we are</span> <span data-start="495.62" data-end="497.569">using a CI it doesn't just have browsers</span> <span data-start="497.569" data-end="499.43">built-in on the server we'd either have</span> <span data-start="499.43" data-end="500.719">to set up our own virtual machines for</span> <span data-start="500.719" data-end="501.889">these browsers or use one of these</span> <span data-start="501.889" data-end="504.02">services so we ended up trying browser</span> <span data-start="504.02" data-end="507.949">stack before our visual tests we need to</span> <span data-start="507.949" data-end="509.9">start our proxy to browser stack and a</span> <span data-start="509.9" data-end="512.12">fork trail server and then we need to</span> <span data-start="512.12" data-end="513.349">make an instance of our selenium</span> <span data-start="513.349" data-end="515.659">webdriver and then of course after all</span> <span data-start="515.659" data-end="516.86">of our tests we would terminate these</span> <span data-start="516.86" data-end="520.039">services we also had to allow but web</span> <span data-start="520.039" data-end="522.56">mock web mock is a library for stubbing</span> <span data-start="522.56" data-end="525.29">and setting expectations on HTTP</span> <span data-start="525.29" data-end="527.99">requests in Ruby this is to run what</span> <span data-start="527.99" data-end="530.269">real web requests in order to use our</span> <span data-start="530.269" data-end="533.35">local servers and upload our screenshots</span> <span data-start="533.35" data-end="536.02">to get our browserstack proxy running we</span> <span data-start="536.02" data-end="537.25">would just bought a new browser stuck</span> <span data-start="537.25" data-end="539.29">process and terminate the process using</span> <span data-start="539.29" data-end="542.65">its assigned PID and to get our rail</span> <span data-start="542.65" data-end="544.06">server running we would just spin up a</span> <span data-start="544.06" data-end="545.68">new rails process at four three thousand</span> <span data-start="545.68" data-end="547.42">unless one was currently running and</span> <span data-start="547.42" data-end="549.1">terminated the same way as our browser</span> <span data-start="549.1" data-end="552.7">stack process to set up our selenium</span> <span data-start="552.7" data-end="554.23">webdriver ways have to pass with the</span> <span data-start="554.23" data-end="555.94">capabilities we wanted like the browser</span> <span data-start="555.94" data-end="558.58">information and a URL to hit which was</span> <span data-start="558.58" data-end="561.73">pointed up our browser stack setting up</span> <span data-start="561.73" data-end="563.53">our silentium driver was easy but when</span> <span data-start="563.53" data-end="565.42">we were setting it up we did learn some</span> <span data-start="565.42" data-end="566.62">interesting things about taking</span> <span data-start="566.62" data-end="569.38">screenshots with different browsers with</span> <span data-start="569.38" data-end="571.45">our web driver we wanted to hit pages in</span> <span data-start="571.45" data-end="573.82">a trail browser and be able to take</span> <span data-start="573.82" data-end="575.44">screenshots of the full page not just</span> <span data-start="575.44" data-end="578.14">the current viewport unfortunately this</span> <span data-start="578.14" data-end="579.76">feature only works in firefox which is</span> <span data-start="579.76" data-end="582.58">not ideal since internet explorer and</span> <span data-start="582.58" data-end="583.84">chrome didn't work we couldn't really</span> <span data-start="583.84" data-end="585.25">transform this framework we were making</span> <span data-start="585.25" data-end="587.08">to be used for browser compatibility or</span> <span data-start="587.08" data-end="589.06">anything like that although this was an</span> <span data-start="589.06" data-end="590.71">ideal for our purposes right now is</span> <span data-start="590.71" data-end="593.04">we're factoring tool Firefox works fine</span> <span data-start="593.04" data-end="595.48">after writing our tests for static pages</span> <span data-start="595.48" data-end="597.61">such as our homepage we quickly realized</span> <span data-start="597.61" data-end="599.02">that we'd have an issue with the dynamic</span> <span data-start="599.02" data-end="602.17">data on our dashboard with dynamic data</span> <span data-start="602.17" data-end="604.12">you can get false positive diffs because</span> <span data-start="604.12" data-end="605.38">data can change between the viewing</span> <span data-start="605.38" data-end="608.02">times to combat this we set up picture</span> <span data-start="608.02" data-end="610">data for our r-spec tests and manually</span> <span data-start="610" data-end="611.77">adjusted any other data not covered by</span> <span data-start="611.77" data-end="613.69">fixtures using selenium JavaScript</span> <span data-start="613.69" data-end="615.52">support so that we don't get a false</span> <span data-start="615.52" data-end="619.24">positive diff okay now we have our test</span> <span data-start="619.24" data-end="621.25">taking screenshots we need to figure out</span> <span data-start="621.25" data-end="622.69">a way to make a diff between two of our</span> <span data-start="622.69" data-end="625">screenshots a magic worked perfectly for</span> <span data-start="625" data-end="627.91">this despite having literally one of the</span> <span data-start="627.91" data-end="629.77">worst sights I've ever seen imagemagick</span> <span data-start="629.77" data-end="632.17">did exactly what we needed imagemagick</span> <span data-start="632.17" data-end="634.36">is a tool to convert edit and compare</span> <span data-start="634.36" data-end="637.33">images image odjick has a command line</span> <span data-start="637.33" data-end="639.34">compare tool that with very various</span> <span data-start="639.34" data-end="641.29">options enabled allows us to shell out</span> <span data-start="641.29" data-end="643.66">and produce diff screenshots based on to</span> <span data-start="643.66" data-end="646.63">other screenshots for example when we</span> <span data-start="646.63" data-end="648.34">make a simple change to the Heather to</span> <span data-start="648.34" data-end="651.22">the header I tragic would spot those</span> <span data-start="651.22" data-end="653.65">differences and produce a screenshot</span> <span data-start="653.65" data-end="657.19">like that Emma Dragic has a lot of</span> <span data-start="657.19" data-end="658.72">options you can pass to its compare tool</span> <span data-start="658.72" data-end="660.49">and we take advantage of a few of these</span> <span data-start="660.49" data-end="663.16">options in order to make it work let's</span> <span data-start="663.16" data-end="664.54">go back to those options we use for a</span> <span data-start="664.54" data-end="665.77">second and go over how they actually</span> <span data-start="665.77" data-end="667.529">work with what we're doing</span> <span data-start="667.529" data-end="669.91">image objects compare tool from their</span> <span data-start="669.91" data-end="671.92">website mathematically and visually</span> <span data-start="671.92" data-end="673.36">annotates the differences between an</span> <span data-start="673.36" data-end="675.97">image and its reconstruction or in my</span> <span data-start="675.97" data-end="678.55">turn terms takes two images and provides</span> <span data-start="678.55" data-end="682.149">a Jeff compare lets you provide a metric</span> <span data-start="682.149" data-end="683.83">that outputs to a standard error a</span> <span data-start="683.83" data-end="685.24">measure of the difference is between</span> <span data-start="685.24" data-end="687.55">images according to a type of given</span> <span data-start="687.55" data-end="690.88">metric here we're using pae where PA e</span> <span data-start="690.88" data-end="693.64">stands for peak absolute we can use the</span> <span data-start="693.64" data-end="695.14">peak absolute to find the size of the</span> <span data-start="695.14" data-end="697.39">fuzz factor needed to make all pixels</span> <span data-start="697.39" data-end="701.17">similar so if we had screenshot 1 and</span> <span data-start="701.17" data-end="703.98">screenshot to that are pretty different</span> <span data-start="703.98" data-end="706.12">it would end up producing a diff like</span> <span data-start="706.12" data-end="709.63">this and our Peaks peak absolute</span> <span data-start="709.63" data-end="711.04">measurement would be outputted as</span> <span data-start="711.04" data-end="713.11">needing a huge fuss factor to make all</span> <span data-start="713.11" data-end="716.74">pixels similar the fuzz factor can be</span> <span data-start="716.74" data-end="718.3">important in case we want to ignore</span> <span data-start="718.3" data-end="719.83">pixels which only change by a slight</span> <span data-start="719.83" data-end="722.38">amount we might want to ignore small</span> <span data-start="722.38" data-end="724.6">changes in case of false positives for</span> <span data-start="724.6" data-end="726.76">example I've had false positives before</span> <span data-start="726.76" data-end="728.529">because gradients rendered slightly</span> <span data-start="728.529" data-end="731.589">differently between two images we don't</span> <span data-start="731.589" data-end="733.45">actually use this output right now but</span> <span data-start="733.45" data-end="734.62">it would be important if you wanted to</span> <span data-start="734.62" data-end="735.76">make an assertion in your tests</span> <span data-start="735.76" data-end="737.529">meaningful like actually have a failure</span> <span data-start="737.529" data-end="739.959">if a diff was produced we didn't end up</span> <span data-start="739.959" data-end="740.95">doing that because it doesn't</span> <span data-start="740.95" data-end="742.63">necessarily mean something's wrong if a</span> <span data-start="742.63" data-end="743.95">diff is produced it just means</span> <span data-start="743.95" data-end="748.089">something's change a few times when we</span> <span data-start="748.089" data-end="749.5">were running our specs we notice that</span> <span data-start="749.5" data-end="752.35">dips weren't even being produced we took</span> <span data-start="752.35" data-end="753.76">a look at the screenshots and realize</span> <span data-start="753.76" data-end="754.72">that they were different heights or</span> <span data-start="754.72" data-end="757.06">sizes for some reason like if we made a</span> <span data-start="757.06" data-end="758.73">change to accidentally remove the footer</span> </p>
<p><span data-start="758.73" data-end="761.079">Emma Dragic wouldn't let us do a default</span> <span data-start="761.079" data-end="762.64">compare on these images so we had to use</span> <span data-start="762.64" data-end="765.79">a sub image search sub image searching</span> <span data-start="765.79" data-end="767.92">is required to have compared search for</span> <span data-start="767.92" data-end="770.23">the best match location of a small image</span> <span data-start="770.23" data-end="772.39">within a larger image this option will</span> <span data-start="772.39" data-end="774.279">produce two different images or two</span> <span data-start="774.279" data-end="776.05">frames is what they call them the first</span> <span data-start="776.05" data-end="777.61">is the diff image is which is the one</span> <span data-start="777.61" data-end="779.29">we're going to be using and the second</span> <span data-start="779.29" data-end="781.72">would be the match score image match</span> <span data-start="781.72" data-end="783.22">score image isn't really important to us</span> <span data-start="783.22" data-end="786.16">but it's an image that's a smaller image</span> <span data-start="786.16" data-end="788.079">containing a pixel for every possible</span> <span data-start="788.079" data-end="790.87">position of the top left corner of the</span> <span data-start="790.87" data-end="793.12">given sub image the search will try to</span> <span data-start="793.12" data-end="794.98">compare the sub image at every possible</span> <span data-start="794.98" data-end="797.32">location in the larger image this can</span> <span data-start="797.32" data-end="798.97">make sub image searching very slow as</span> <span data-start="798.97" data-end="800.59">you could guess the smaller</span> <span data-start="800.59" data-end="803.08">some of the sub images the faster this</span> <span data-start="803.08" data-end="806.86">search is that being said this option</span> <span data-start="806.86" data-end="808.45">doesn't take effect unless you have two</span> <span data-start="808.45" data-end="810.4">images that are different sizes this</span> <span data-start="810.4" data-end="812.05">doesn't happen very often to us so the</span> <span data-start="812.05" data-end="813.73">amount it slows down our visual specs on</span> </p>
<p><span data-start="813.73" data-end="814.99">CI isn't really meaningful to us</span> <span data-start="814.99" data-end="817.27">especially since those specs aren't tied</span> <span data-start="817.27" data-end="820.54">to our main specs another fun thing we</span> <span data-start="820.54" data-end="822.16">ran into is sometimes our screen shots</span> <span data-start="822.16" data-end="824.17">were completely different like</span> <span data-start="824.17" data-end="827.56">completely different and imagemagick was</span> <span data-start="827.56" data-end="830.02">not into it in fact it just wouldn't</span> <span data-start="830.02" data-end="831.82">even give us a diff because the images</span> <span data-start="831.82" data-end="834.34">were so different without an option</span> <span data-start="834.34" data-end="836.14">called the dissimilarity threshold which</span> <span data-start="836.14" data-end="838.66">I find kind of weird this thrush will</span> <span data-start="838.66" data-end="840.37">determine how different two images could</span> <span data-start="840.37" data-end="842.44">be in order to dip them it's he faulted</span> <span data-start="842.44" data-end="844.84">2.2 so I just made it one and it seemed</span> <span data-start="844.84" data-end="847.69">to do the trick the only caveat as you</span> <span data-start="847.69" data-end="849.22">might get as you might have guessed is</span> <span data-start="849.22" data-end="850.18">doing dips on completely different</span> <span data-start="850.18" data-end="851.86">images can slow down your test by a lot</span> <span data-start="851.86" data-end="854.02">like our previous issue with some image</span> <span data-start="854.02" data-end="855.22">searching this doesn't seem to happen</span> <span data-start="855.22" data-end="857.26">much and since the tests are separate</span> <span data-start="857.26" data-end="859.03">from our main specs we weren't worried</span> <span data-start="859.03" data-end="861.34">about it plus the arguments aren't very</span> <span data-start="861.34" data-end="862.57">exciting just where our current</span> <span data-start="862.57" data-end="865.6">screenshot is located where our master</span> <span data-start="865.6" data-end="868.42">screenshot is located and where we want</span> <span data-start="868.42" data-end="871.36">the diff to save to okay now that we're</span> <span data-start="871.36" data-end="875.2">done with that stuff we had now that we</span> <span data-start="875.2" data-end="876.73">had our screenshots in our diffs we</span> <span data-start="876.73" data-end="877.99">needed somewhere to actually throw the</span> <span data-start="877.99" data-end="880.18">screenshots online and be able to grab</span> <span data-start="880.18" data-end="881.83">them back out with our rails app so we</span> <span data-start="881.83" data-end="885.34">decided to use AWS AWS or Amazon Web</span> </p>
<p><span data-start="885.34" data-end="887.47">Services offers cloud storage and has a</span> <span data-start="887.47" data-end="889.57">ruby API so we'll store and retrieve our</span> <span data-start="889.57" data-end="892.84">screenshots from one of their buckets we</span> <span data-start="892.84" data-end="894.31">ended up using a naming pattern of</span> <span data-start="894.31" data-end="897.4">commits sha area of site page name and</span> <span data-start="897.4" data-end="900.46">image type so for example we could have</span> <span data-start="900.46" data-end="902.65">a commit show of a 1a 1a 1a very</span> <span data-start="902.65" data-end="904.9">realistic I know where we're on our</span> <span data-start="904.9" data-end="906.94">marketing part of our site on the index</span> <span data-start="906.94" data-end="909.1">page and we're uploading the diff for</span> <span data-start="909.1" data-end="912.16">that page the image types could be the</span> <span data-start="912.16" data-end="913.69">current screenshot we took the master</span> <span data-start="913.69" data-end="916.27">screenshot we downloaded from s3 or the</span> <span data-start="916.27" data-end="919.52">diff we made of the two screenshots</span> <span data-start="919.53" data-end="921.67">viewing the screenshots from an amazon</span> <span data-start="921.67" data-end="923.62">bucket was far less than ideal so we</span> <span data-start="923.62" data-end="925.36">decided to set up our own custom viewing</span> <span data-start="925.36" data-end="928.36">page in our admin dashboard we created a</span> <span data-start="928.36" data-end="929.68">page that listed out our current</span> <span data-start="929.68" data-end="932.57">branches with our last three commits</span> <span data-start="932.57" data-end="934.07">and when you would click through it</span> <span data-start="934.07" data-end="936.17">would show you by area all of your</span> <span data-start="936.17" data-end="937.49">screenshots and dips which is our end</span> <span data-start="937.49" data-end="941.06">goal we did it however our tool is not</span> <span data-start="941.06" data-end="942.98">perfect right now it's certainly better</span> <span data-start="942.98" data-end="946.3">than what we had which was nothing but</span> <span data-start="946.3" data-end="949.34">right now all of our tests pass whether</span> <span data-start="949.34" data-end="951.41">or not there's a diff the only failed</span> <span data-start="951.41" data-end="953.57">there's an issue executing the test it</span> <span data-start="953.57" data-end="954.71">could be interesting to make our</span> <span data-start="954.71" data-end="956.54">assertions mean something like fail if</span> <span data-start="956.54" data-end="958.58">there's a diff we need to think more</span> <span data-start="958.58" data-end="960.29">about that because a diff like like I</span> <span data-start="960.29" data-end="961.79">said earlier it doesn't necessarily mean</span> <span data-start="961.79" data-end="966.05">a failure to us and the future it might</span> <span data-start="966.05" data-end="968.84">also be nice to account for 0% diffs so</span> <span data-start="968.84" data-end="971.12">maybe we shouldn't upload a diff image</span> <span data-start="971.12" data-end="972.8">at all if there's no diff between images</span> <span data-start="972.8" data-end="975.77">this could save a space on AWS bucket as</span> <span data-start="975.77" data-end="977.75">well speed up our tests because we're</span> <span data-start="977.75" data-end="979.07">trying to upload for your screenshots</span> <span data-start="979.07" data-end="981.29">and it would make our admin dashboard</span> <span data-start="981.29" data-end="985.1">less noisy we also think it would be</span> <span data-start="985.1" data-end="986.6">nice to automatically link these two a</span> <span data-start="986.6" data-end="989.84">github pull request so when a diff is</span> <span data-start="989.84" data-end="991.79">created maybe automatically attach it</span> <span data-start="991.79" data-end="993.59">onto its relevant pull request this</span> <span data-start="993.59" data-end="995.57">sounds a little tricky because maybe we</span> <span data-start="995.57" data-end="996.62">don't want to create that much noise</span> <span data-start="996.62" data-end="998.78">every time we push but it's an idea</span> <span data-start="998.78" data-end="1001.81">something we need to think about another</span> <span data-start="1001.81" data-end="1003.91">thing is that we currently only diff</span> <span data-start="1003.91" data-end="1005.41">between our current commit on a branch</span> <span data-start="1005.41" data-end="1008.41">and versus our most recent commit on</span> <span data-start="1008.41" data-end="1011.5">that sir so when we push a new commit to</span> <span data-start="1011.5" data-end="1013.57">our branch it'll diff versus the last</span> <span data-start="1013.57" data-end="1015.4">thing that we push to mash to master</span> <span data-start="1015.4" data-end="1017.41">this way we know what's changed between</span> <span data-start="1017.41" data-end="1019.24">the future I'm working on and what's</span> <span data-start="1019.24" data-end="1021.85">currently running in production it would</span> <span data-start="1021.85" data-end="1023.5">be nice if we could dip on master with</span> <span data-start="1023.5" data-end="1025.329">the current most recent commit and its</span> <span data-start="1025.329" data-end="1028.03">previous commitment so that way in cush</span> <span data-start="1028.03" data-end="1029.56">in case you push a visual change</span> <span data-start="1029.56" data-end="1031.24">directly to master which don't do that</span> <span data-start="1031.24" data-end="1035.11">you could still see a dip for it it</span> <span data-start="1035.11" data-end="1036.64">would also be nice to see a diff between</span> <span data-start="1036.64" data-end="1038.17">the previous commit on the current</span> <span data-start="1038.17" data-end="1041.41">branch as well like if you push to</span> <span data-start="1041.41" data-end="1043.51">commit to your branch that changes some</span> <span data-start="1043.51" data-end="1045.339">stuff visually you might want to see a</span> <span data-start="1045.339" data-end="1046.75">dip between those two regardless of</span> <span data-start="1046.75" data-end="1050.05">what's happening on master it also</span> <span data-start="1050.05" data-end="1051.34">really love to get this hooked up to</span> <span data-start="1051.34" data-end="1053.71">more browsers that would really enable</span> <span data-start="1053.71" data-end="1055.03">us to make this into a backwards</span> <span data-start="1055.03" data-end="1056.56">compatibility tool as well as an</span> <span data-start="1056.56" data-end="1058">automatic browser comparison to make</span> <span data-start="1058" data-end="1060.09">sure things aren't messed up in IE</span> <span data-start="1060.09" data-end="1062.77">thanks that's all I have and feel free</span> <span data-start="1062.77" data-end="1064.3">to ask me questions after a few</span> <span data-start="1064.3" data-end="1065.14">interesting</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
