<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>480JL_WuMt0</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/480JL_WuMt0?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.58" data-end="19.26">[Music]</span> <span data-start="19.27" data-end="21.29">intercalating this is talk about</span> <span data-start="21.29" data-end="23.72">javascript performance tuning secrets so</span> <span data-start="23.72" data-end="25.91">this is not so much about how to</span> <span data-start="25.91" data-end="27.439">structure your code in a way that it</span> <span data-start="27.439" data-end="29.45">runs quickly it's more about the tools</span> <span data-start="29.45" data-end="31.099">and techniques that you can use to begin</span> <span data-start="31.099" data-end="33.38">to evaluate and investigate performance</span> <span data-start="33.38" data-end="35.54">issues and so I'm assuming that you're</span> <span data-start="35.54" data-end="37.01">sort of familiar already with the basic</span> <span data-start="37.01" data-end="38.059">stuff and the dev tools like the</span> <span data-start="38.059" data-end="41.12">timeline panel and the profiler this is</span> <span data-start="41.12" data-end="42.44">going more into sort of more exotic</span> <span data-start="42.44" data-end="43.97">crazy stuff that you might not be as</span> <span data-start="43.97" data-end="45.41">familiar with some of it's a little</span> <span data-start="45.41" data-end="47.15">hacky some of it's a little bit tricky</span> <span data-start="47.15" data-end="49.64">and all that to get working but if</span> <span data-start="49.64" data-end="50.75">you're really in a tough bind with</span> <span data-start="50.75" data-end="52.07">performance and you're just desperate</span> <span data-start="52.07" data-end="53.54">for one little clue one of the most</span> <span data-start="53.54" data-end="54.89">scrap of information that might lead you</span> <span data-start="54.89" data-end="57.379">to an improvement and a fix these are</span> <span data-start="57.379" data-end="60.049">good tools to have in your tool kit so</span> <span data-start="60.049" data-end="61.309">because this talk is pretty short I'm</span> <span data-start="61.309" data-end="62.54">gonna fly over a lot of different</span> <span data-start="62.54" data-end="64.94">material I'm gonna try to post up some</span> <span data-start="64.94" data-end="66.74">links to further reading on this github</span> <span data-start="66.74" data-end="69.08">repo along with the slides there's</span> <span data-start="69.08" data-end="70.85">nothing there yet but hopefully by this</span> <span data-start="70.85" data-end="75.89">weekend there will be so me real quick I</span> <span data-start="75.89" data-end="77.39">started doing professional web</span> <span data-start="77.39" data-end="79.7">development back when Firefox was in 100</span> <span data-start="79.7" data-end="81.89">beta back when WebKit's javascript</span> <span data-start="81.89" data-end="83.659">engine sucks so badly that you couldn't</span> <span data-start="83.659" data-end="85.969">do anything with it things that really</span> <span data-start="85.969" data-end="87.92">come a long way since then these days I</span> <span data-start="87.92" data-end="89.689">work at Adobe on the brackets team</span> <span data-start="89.689" data-end="91.729">brackets is an open source code editor</span> <span data-start="91.729" data-end="93.229">that we're building for web developers</span> <span data-start="93.229" data-end="95.479">it's also written in JavaScript and it's</span> <span data-start="95.479" data-end="97.549">a pretty pretty serious app the rackets</span> </p>
<p><span data-start="97.549" data-end="99.17">UI is about a hundred thousand lines of</span> <span data-start="99.17" data-end="100.82">JavaScript code that's over ten</span> <span data-start="100.82" data-end="103.1">megabytes of J's files so it's a very</span> <span data-start="103.1" data-end="104.96">performance intensive app and that's</span> <span data-start="104.96" data-end="106.25">kind of where I'm coming from on all</span> <span data-start="106.25" data-end="110.63">this stuff so first of all why is this</span> <span data-start="110.63" data-end="111.979">even a complicated problem I mean it</span> <span data-start="111.979" data-end="113.84">seems like sort of naively you could</span> <span data-start="113.84" data-end="115.1">just do something like this right you</span> <span data-start="115.1" data-end="116.84">you record a start time you do some</span> <span data-start="116.84" data-end="118.789">stuff you record an end time you know</span> <span data-start="118.789" data-end="120.59">how how long it took right and we're</span> <span data-start="120.59" data-end="122.09">using that these higher resolution</span> <span data-start="122.09" data-end="124.429">performance measuring API is that are in</span> <span data-start="124.429" data-end="126.109">modern browsers you get sub millisecond</span> <span data-start="126.109" data-end="129.2">accuracy it's really cool but I think</span> <span data-start="129.2" data-end="130.46">there's basically two big problems with</span> <span data-start="130.46" data-end="132.5">this the first is that you know a lot of</span> <span data-start="132.5" data-end="133.79">times your JavaScript is running in the</span> <span data-start="133.79" data-end="134.9">browser and when you're running in the</span> <span data-start="134.9" data-end="136.16">browser there's a lot of other stuff</span> <span data-start="136.16" data-end="137.54">that happens after this code is done</span> <span data-start="137.54" data-end="140.06">like that or that or that</span> <span data-start="140.06" data-end="142.73">that so if what you actually care about</span> <span data-start="142.73" data-end="145.55">is how long it takes before the user</span> <span data-start="145.55" data-end="148.129">gets feedback visually on screen the</span> <span data-start="148.129" data-end="149.78">browser native rendering stuff is</span> <span data-start="149.78" data-end="151.78">actually very important and that's</span> <span data-start="151.78" data-end="153.01">from the bottleneck these days because</span> </p>
<p><span data-start="153.01" data-end="155.92">JavaScript is so darn fast that the</span> <span data-start="155.92" data-end="157.45">browser native side can actually be the</span> <span data-start="157.45" data-end="160.69">bigger performance issue so that's one</span> <span data-start="160.69" data-end="162.31">issue but then of course also you know</span> <span data-start="162.31" data-end="164.319">lots of people run JavaScript like on on</span> <span data-start="164.319" data-end="166.15">the server or in helicopters or other</span> <span data-start="166.15" data-end="168.34">crazy stuff and regardless of where</span> <span data-start="168.34" data-end="169.36">you're running and I think the second</span> <span data-start="169.36" data-end="170.68">issue comes into play and that is that</span> <span data-start="170.68" data-end="171.79">javascript is not actually what's</span> <span data-start="171.79" data-end="174.22">running on a CPU right there's this this</span> <span data-start="174.22" data-end="176.26">mystery black boxes JavaScript VM it</span> <span data-start="176.26" data-end="178.15">does a bunch of magic and make circa one</span> <span data-start="178.15" data-end="179.44">and that's actually what's running on</span> <span data-start="179.44" data-end="182.05">the CPU and for performance sensitive</span> <span data-start="182.05" data-end="184.54">code what goes on that black box can be</span> <span data-start="184.54" data-end="186.07">really important getting deeper insights</span> <span data-start="186.07" data-end="188.38">into there as valuable so I'll talk</span> <span data-start="188.38" data-end="189.94">about those two topics in turn first</span> <span data-start="189.94" data-end="191.83">kind of like getting inter tangled with</span> <span data-start="191.83" data-end="193.65">browser native rendering stuff and then</span> <span data-start="193.65" data-end="195.25">second the interaction between</span> </p>
<p><span data-start="195.25" data-end="196.989">JavaScript and the VM it's running in</span> <span data-start="196.989" data-end="199.09">I'll go through a number of topics in</span> <span data-start="199.09" data-end="200.769">each of these they're arranged roughly</span> <span data-start="200.769" data-end="203.709">in ascending order of craziness so we'll</span> <span data-start="203.709" data-end="204.819">go down the left column first and I'm</span> <span data-start="204.819" data-end="207.01">going on the right column and and then</span> <span data-start="207.01" data-end="208.09">it'll have a little bit of miscellaneous</span> <span data-start="208.09" data-end="211.84">stuff at the end the wrap-up so first of</span> <span data-start="211.84" data-end="213.19">all who hasn't seen the timeline panel</span> <span data-start="213.19" data-end="215.29">and is willing to admit it in front of</span> <span data-start="215.29" data-end="218.019">everybody here anyone no one brave</span> <span data-start="218.019" data-end="219.88">enough okay but that's good and so</span> <span data-start="219.88" data-end="220.84">hopefully everybody knows about this</span> <span data-start="220.84" data-end="223.09">frames view which is I think the the</span> <span data-start="223.09" data-end="224.56">most powerful visualization you can get</span> <span data-start="224.56" data-end="225.76">in there for things like animation</span> <span data-start="225.76" data-end="226.81">performance scrolling performance</span> <span data-start="226.81" data-end="228.459">anything that's really rendering</span> <span data-start="228.459" data-end="231.16">oriented okay so hopefully everyone's</span> <span data-start="231.16" data-end="232.57">familiar with that but here are some</span> <span data-start="232.57" data-end="233.56">things you might not know about the</span> <span data-start="233.56" data-end="236.019">timeline panel first of all you can</span> <span data-start="236.019" data-end="238.15">actually add your own custom annotation</span> <span data-start="238.15" data-end="239.59">to this panel so if you do consult a</span> <span data-start="239.59" data-end="241.09">timestamp you actually get these tick</span> <span data-start="241.09" data-end="243.82">marks that show up both in the overview</span> <span data-start="243.82" data-end="245.32">of the whole timeline capture and also</span> <span data-start="245.32" data-end="247.51">in the individual zoomed interview you</span> <span data-start="247.51" data-end="249.42">can also use slightly different code</span> <span data-start="249.42" data-end="252.25">console that time and time end to</span> <span data-start="252.25" data-end="254.92">actually insert your own little bars in</span> <span data-start="254.92" data-end="256.81">the view so you can basically begin to</span> <span data-start="256.81" data-end="259.919">layer on semantic annotations that are</span> <span data-start="259.919" data-end="262.36">specific to your code so it makes it</span> <span data-start="262.36" data-end="263.62">that much easier to parse so you're no</span> <span data-start="263.62" data-end="264.7">longer you're looking at this really</span> <span data-start="264.7" data-end="266.89">generic you sort of blinded you that the</span> <span data-start="266.89" data-end="268.72">browser gives you what's going on you</span> <span data-start="268.72" data-end="270.07">can now actually begin looking at this</span> <span data-start="270.07" data-end="271.63">in terms of what it means in your in</span> <span data-start="271.63" data-end="274">your app which is pretty pretty cool</span> <span data-start="274" data-end="276.669">stuff but one thing that's always</span> <span data-start="276.669" data-end="278.11">bothered me about the timeline panel is</span> <span data-start="278.11" data-end="280.03">that it's very manually driven workflow</span> <span data-start="280.03" data-end="281.83">right like you load your page you have</span> <span data-start="281.83" data-end="283.3">to click around in it you record some</span> <span data-start="283.3" data-end="284.44">data you scrub through it in the</span> <span data-start="284.44" data-end="286.78">timeline it's not really conducive to</span> <span data-start="286.78" data-end="288.19">things like continuous integration where</span> <span data-start="288.19" data-end="290.05">you might want to be you know checking</span> <span data-start="290.05" data-end="291.159">for performance regressions</span> <span data-start="291.159" data-end="292.75">automatically on every check-in and</span> <span data-start="292.75" data-end="293.5">things like that</span> <span data-start="293.5" data-end="296.289">but it actually turns out there is a way</span> <span data-start="296.289" data-end="298.78">to do that so this may not be widely</span> <span data-start="298.78" data-end="300.669">known but the timeline panel in fact</span> <span data-start="300.669" data-end="302.2">everything in the developer tools in</span> </p>
<p><span data-start="302.2" data-end="305.409">Chrome and WebKit is built on top of an</span> <span data-start="305.409" data-end="308.14">open API that's just in JSON format and</span> <span data-start="308.14" data-end="310.96">it exposes a socket connection so anyone</span> <span data-start="310.96" data-end="312.43">can connect to that remote debugging API</span> <span data-start="312.43" data-end="314.2">in fact in the brackets editor we use</span> <span data-start="314.2" data-end="315.46">that API for things like live</span> <span data-start="315.46" data-end="317.919">development and google has actually</span> <span data-start="317.919" data-end="319.99">built a testing framework on top of this</span> <span data-start="319.99" data-end="322.33">called the telemetry framework it's</span> <span data-start="322.33" data-end="324.039">basically a collection of Python scripts</span> <span data-start="324.039" data-end="327.36">and and templates for test cases that</span> <span data-start="327.36" data-end="329.979">let you do automated performance testing</span> <span data-start="329.979" data-end="331.63">using the same data feed that the</span> <span data-start="331.63" data-end="333.46">timeline panel gives you except in an</span> <span data-start="333.46" data-end="335.62">automated way it actually includes some</span> <span data-start="335.62" data-end="337.3">some pretty powerful UI automation</span> <span data-start="337.3" data-end="338.47">capability so you can do things like</span> <span data-start="338.47" data-end="340.27">simulating clicks and and scrolling</span> <span data-start="340.27" data-end="342.64">scrolling is a particularly tricky one</span> <span data-start="342.64" data-end="344.89">to simulate normally from JavaScript so</span> <span data-start="344.89" data-end="346.03">actually what they do here is that</span> <span data-start="346.03" data-end="347.95">there's a there's a special API that is</span> <span data-start="347.95" data-end="349.659">turned off in Chrome normally that when</span> <span data-start="349.659" data-end="351.61">the telemetry framework runs chrome it</span> <span data-start="351.61" data-end="354.159">passes a flag that enables a special API</span> <span data-start="354.159" data-end="356.289">just for simulating scrolling accurately</span> <span data-start="356.289" data-end="357.64">to get really good performance data</span> <span data-start="357.64" data-end="359.95">there so it's really cool stuff and</span> <span data-start="359.95" data-end="361.36">briefly the way it works is you you</span> <span data-start="361.36" data-end="362.83">write it up a JSON file that has like a</span> <span data-start="362.83" data-end="364.659">list of URLs and a list of actions in</span> <span data-start="364.659" data-end="366.01">the URLs and what you want to test in</span> <span data-start="366.01" data-end="368.02">them you know you can scroll different</span> <span data-start="368.02" data-end="369.25">parts of the document click on different</span> <span data-start="369.25" data-end="371.68">dom nodes that sort of thing</span> <span data-start="371.68" data-end="373.09">you need to get the chrome source code</span> <span data-start="373.09" data-end="374.229">you don't need to compile it but you get</span> <span data-start="374.229" data-end="375.22">the scripts out of there and then you</span> <span data-start="375.22" data-end="376.81">run you run these scripts and you pass</span> <span data-start="376.81" data-end="379.78">it your JSON file and and then it</span> <span data-start="379.78" data-end="381.099">actually spits out a JSON file with</span> <span data-start="381.099" data-end="385.03">performance data so simple as that if</span> <span data-start="385.03" data-end="386.469">you're looking for an example of how to</span> <span data-start="386.469" data-end="388.09">use this I think a great place to look</span> <span data-start="388.09" data-end="390.219">is the topcoat project which if anyone</span> <span data-start="390.219" data-end="391.84">was at CSS comp you would have seen a</span> <span data-start="391.84" data-end="393.64">little bit about that there it's an open</span> <span data-start="393.64" data-end="396.82">source CSS framework basically and</span> <span data-start="396.82" data-end="398.2">they're very very concerned with</span> <span data-start="398.2" data-end="399.61">performance rendering performance load</span> <span data-start="399.61" data-end="401.11">performance all that so they're doing</span> <span data-start="401.11" data-end="402.58">automated testing using this telemetry</span> <span data-start="402.58" data-end="404.05">framework you can see a great example of</span> <span data-start="404.05" data-end="404.89">how to use it there</span> <span data-start="404.89" data-end="407.14">and they've also built a spin-off</span> <span data-start="407.14" data-end="409.03">project which is the top code server</span> <span data-start="409.03" data-end="410.62">project it's basically a node server</span> <span data-start="410.62" data-end="412.12">that you can use to upload your</span> <span data-start="412.12" data-end="412.88">performer</span> <span data-start="412.88" data-end="414.59">results too and we'll track the results</span> <span data-start="414.59" data-end="416.24">over time and it presents a really nice</span> <span data-start="416.24" data-end="418.31">web view visualizing how your</span> <span data-start="418.31" data-end="420.38">performance is varying over time so it's</span> <span data-start="420.38" data-end="421.64">a really great project you can make use</span> <span data-start="421.64" data-end="426.31">of when you're using these api's also</span> <span data-start="426.31" data-end="428.24">there's some other cool stuff in the dev</span> <span data-start="428.24" data-end="430.16">tools the FPS meter continuous</span> <span data-start="430.16" data-end="431.99">repainting these are really invaluable</span> <span data-start="431.99" data-end="434.36">for assessing rendering performance I'm</span> <span data-start="434.36" data-end="435.86">not going to go into detail on them here</span> <span data-start="435.86" data-end="437.15">though there's a lot of great stuff you</span> <span data-start="437.15" data-end="439.33">can read up on the googles about this</span> <span data-start="439.33" data-end="441.05">definitely very useful if you don't know</span> <span data-start="441.05" data-end="444.44">about it similarly there's a mode where</span> <span data-start="444.44" data-end="445.97">you can see repaint rectangles overlaid</span> <span data-start="445.97" data-end="447.2">in the page and there's a mode where you</span> <span data-start="447.2" data-end="450.05">can see compositing layers annotated</span> <span data-start="450.05" data-end="452.42">with borders and grids on the page it</span> <span data-start="452.42" data-end="453.59">gives you really really great deep</span> <span data-start="453.59" data-end="454.79">insight into what's going on with</span> <span data-start="454.79" data-end="456.41">browser painting on the one hand and</span> <span data-start="456.41" data-end="458.32">browser compositing on the other hand</span> <span data-start="458.32" data-end="460.4">but again this is pretty well-documented</span> <span data-start="460.4" data-end="461.84">stuff so I'm not going to go into too</span> <span data-start="461.84" data-end="464.12">much detail on it right here the</span> <span data-start="464.12" data-end="465.38">question actually then I'm going to talk</span> <span data-start="465.38" data-end="466.64">about is what if this is what if this</span> <span data-start="466.64" data-end="468.26">isn't enough what if you need even more</span> <span data-start="468.26" data-end="471.46">deeper insight into what's going on with</span> <span data-start="471.46" data-end="474.58">rendering and compositing in the browser</span> <span data-start="474.58" data-end="476.51">how many people have seen this for you</span> <span data-start="476.51" data-end="479.63">before phew how many people like to know</span> <span data-start="479.63" data-end="483.74">how to read it all right cool it's gonna</span> <span data-start="483.74" data-end="484.79">do a whole joke or someone had their</span> <span data-start="484.79" data-end="485.93">hand up I was gonna be like put your</span> <span data-start="485.93" data-end="486.86">hand down if you work at Google that's</span> <span data-start="486.86" data-end="488.36">cheating but I guess no one hears from</span> </p>
<p><span data-start="488.36" data-end="491.63">Google so well so I'll give you a quick</span> <span data-start="491.63" data-end="495.47">tour of this well resolution okay this</span> <span data-start="495.47" data-end="496.52">is a lot like what you see in the</span> <span data-start="496.52" data-end="497.93">timeline panel except it's broken down</span> <span data-start="497.93" data-end="501.83">at a very low level by thread and so the</span> <span data-start="501.83" data-end="502.94">first thing to know is it's capturing</span> <span data-start="502.94" data-end="503.87">everything that's going on in the</span> <span data-start="503.87" data-end="505.43">browser including all tabs you have open</span> <span data-start="505.43" data-end="506.93">so you want to close every other tab to</span> <span data-start="506.93" data-end="509.06">get extraneous data out of here and then</span> <span data-start="509.06" data-end="511.7">you want to use the the task manager to</span> <span data-start="511.7" data-end="515.45">actually identify which which to which</span> <span data-start="515.45" data-end="517.219">process ID you care about for your tab</span> <span data-start="517.219" data-end="518.57">there's always going to be a few extra</span> <span data-start="518.57" data-end="520.82">ones in here I happen to know that for</span> <span data-start="520.82" data-end="522.8">this run that I already captured the</span> <span data-start="522.8" data-end="525.65">thread that I care about is 60 to 60 so</span> </p>
<p><span data-start="525.65" data-end="528.5">I'm just gonna go close all this extra</span> <span data-start="528.5" data-end="533.62">stuff here that I don't care about and</span> <span data-start="533.62" data-end="536.6">I'll just leave a couple the gp1 is</span> <span data-start="536.6" data-end="539.45">useful to see also so there are</span> <span data-start="539.45" data-end="542.03">basically two threads involved in</span> <span data-start="542.03" data-end="543.01">rendering on any given</span> <span data-start="543.01" data-end="544.69">browser tab there's a compositor thread</span> <span data-start="544.69" data-end="546.4">and the renderer thread which is</span> <span data-start="546.4" data-end="547.48">actually where the bulk of the work</span> <span data-start="547.48" data-end="549.01">usually happens that's where v8 runs</span> <span data-start="549.01" data-end="550.21">your JavaScript that's where layout</span> <span data-start="550.21" data-end="552.51">happens that's where repainting happens</span> <span data-start="552.51" data-end="554.59">but this doesn't really look like much</span> <span data-start="554.59" data-end="555.88">yet if you look at this is actually a</span> <span data-start="555.88" data-end="557.5">really big time scale it's like a like</span> <span data-start="557.5" data-end="559.51">three second capture so it's just a big</span> <span data-start="559.51" data-end="561.1">mash of stuff we want to be able to zoom</span> <span data-start="561.1" data-end="564.22">in and the quickest way to do that is to</span> <span data-start="564.22" data-end="565.63">hold down alt and use the mouse wheel</span> <span data-start="565.63" data-end="567.97">and you can begin zooming in and start</span> <span data-start="567.97" data-end="569.83">seeing this break down into individual</span> <span data-start="569.83" data-end="573.46">basically frame per frame units to</span> <span data-start="573.46" data-end="574.66">navigate further you pretend you're</span> <span data-start="574.66" data-end="576.49">playing quake and you use the a and the</span> </p>
<p><span data-start="576.49" data-end="579.31">D key to pan horizontally and you can</span> <span data-start="579.31" data-end="581.56">use W and s to zoom in and out so it's</span> <span data-start="581.56" data-end="583.3">like a video game it's a little crazy to</span> <span data-start="583.3" data-end="585.76">navigate and as we zoom in more we can</span> <span data-start="585.76" data-end="587.62">start seeing these individual frame by</span> <span data-start="587.62" data-end="588.76">frame units and if you look they're</span> <span data-start="588.76" data-end="591.43">broken down roughly in 16 and changed</span> <span data-start="591.43" data-end="593.38">millisecond intervals so that's this is</span> <span data-start="593.38" data-end="595.18">one frame right here and there's this</span> <span data-start="595.18" data-end="597.55">characteristic u-shape to it so</span> <span data-start="597.55" data-end="599.83">rendering a given frame starts on the</span> <span data-start="599.83" data-end="601.45">compositor thread and the bulk of the</span> <span data-start="601.45" data-end="602.59">work usually happens in the render</span> <span data-start="602.59" data-end="604.3">thread and then it basically wraps up on</span> <span data-start="604.3" data-end="605.56">the compositor threat again so when you</span> <span data-start="605.56" data-end="607.27">see one of these u shapes that's</span> <span data-start="607.27" data-end="609.01">generally a single frame from start to</span> <span data-start="609.01" data-end="612.67">finish so the way that you actually read</span> <span data-start="612.67" data-end="613.96">the data in here is this is basically a</span> <span data-start="613.96" data-end="615.82">stack trace on the native side so these</span> <span data-start="615.82" data-end="617.68">are different methods that are running</span> <span data-start="617.68" data-end="622.12">in in Chrome there's run task calls</span> <span data-start="622.12" data-end="623.86">begin frame on main thread which calls</span> <span data-start="623.86" data-end="625.6">animate on the one hand which calls into</span> <span data-start="625.6" data-end="627.96">v8 that's requestanimationframe</span> <span data-start="627.96" data-end="630.28">calls layout after that it calls update</span> <span data-start="630.28" data-end="633.61">layers etc so the width of the bar is</span> <span data-start="633.61" data-end="634.96">how long it took so you can begin to get</span> <span data-start="634.96" data-end="636.52">a really good sense here of what's the</span> <span data-start="636.52" data-end="638.41">self time versus the total time forgiven</span> <span data-start="638.41" data-end="640.75">method call broken down in a really low</span> <span data-start="640.75" data-end="644.08">level the colors don't actually mean</span> <span data-start="644.08" data-end="645.46">anything in particular that was pretty</span> <span data-start="645.46" data-end="647.56">confusing to me at first they're just</span> <span data-start="647.56" data-end="649.51">randomly assigned but the same method</span> <span data-start="649.51" data-end="650.8">consistently gets the same color</span> <span data-start="650.8" data-end="652.57">everywhere that it appears so it makes</span> <span data-start="652.57" data-end="653.86">it much easier to sort of skim through</span> <span data-start="653.86" data-end="656.74">repeated results more easily you'll also</span> <span data-start="656.74" data-end="659.62">see that as a GPU thread down here which</span> <span data-start="659.62" data-end="661.39">is sometimes in sync with what's going</span> <span data-start="661.39" data-end="663.4">on in your particular tabs compositor</span> <span data-start="663.4" data-end="664.72">and render threads but not always</span> <span data-start="664.72" data-end="666.1">because it's actually shared across the</span> <span data-start="666.1" data-end="668.17">whole browser and so it's usually</span> <span data-start="668.17" data-end="669.7">running at the same frame rate but</span> <span data-start="669.7" data-end="671.47">sometimes out of phase which is one of</span> <span data-start="671.47" data-end="673.54">the reasons that measuring rendering</span> <span data-start="673.54" data-end="675.29">latency is a lot trickier than regiment</span> <span data-start="675.29" data-end="677.98">during rendering frequency or framerate</span> <span data-start="677.98" data-end="680.72">an X on the GPU thread this is view is</span> <span data-start="680.72" data-end="682.459">going to be enhanced in a future version</span> <span data-start="682.459" data-end="684.589">of Chrome as they do some rendering</span> <span data-start="684.589" data-end="685.91">refactoring it's going to add more and</span> <span data-start="685.91" data-end="687.74">more tools to begin visualizing what's</span> <span data-start="687.74" data-end="689.389">going on with GPU textures and</span> <span data-start="689.389" data-end="691.88">individual repaint steps even so it's</span> <span data-start="691.88" data-end="695.66">pretty powerful this is sort of a</span> <span data-start="695.66" data-end="696.86">complement to the timeline panel though</span> <span data-start="696.86" data-end="698.149">it's not a replacement for it in fact</span> <span data-start="698.149" data-end="699.38">there's some cases where the timeline</span> <span data-start="699.38" data-end="700.73">panel gives you more information than</span> <span data-start="700.73" data-end="702.5">what you see here for example if you</span> <span data-start="702.5" data-end="704.6">hover over a repaint in the timelines</span> <span data-start="704.6" data-end="706.94">it'll show you overlaid on the page the</span> <span data-start="706.94" data-end="708.319">bounds of the repaint you can't get that</span> <span data-start="708.319" data-end="709.759">from chrome tracing and same thing with</span> <span data-start="709.759" data-end="711.38">layout you can see the stack trace that</span> <span data-start="711.38" data-end="712.94">caused the layout to happen you don't</span> <span data-start="712.94" data-end="714.589">get that from here either but what you</span> <span data-start="714.589" data-end="716.149">do get is this really really in-depth</span> <span data-start="716.149" data-end="717.92">thread by thread breakdown of what's</span> <span data-start="717.92" data-end="719.69">going on on the GPU thread versus the</span> <span data-start="719.69" data-end="720.949">compositor thread and you can begin to</span> <span data-start="720.949" data-end="722.839">see where bottlenecks are actually</span> <span data-start="722.839" data-end="724.13">happening at at a more fine-grained</span> <span data-start="724.13" data-end="728.839">level so back before all these tools</span> <span data-start="728.839" data-end="731.66">though you know measuring rendering</span> <span data-start="731.66" data-end="733.339">performance in JavaScript was like</span> <span data-start="733.339" data-end="734.779">comically bad if you mirror that earlier</span> <span data-start="734.779" data-end="735.68">slide there's all that stuff that</span> <span data-start="735.68" data-end="737.24">happens outside of JavaScript there's</span> <span data-start="737.24" data-end="738.29">almost native stuff so if you try to</span> <span data-start="738.29" data-end="739.37">measure it from JavaScript you get</span> <span data-start="739.37" data-end="741.41">ridiculous results like this where it's</span> <span data-start="741.41" data-end="744.11">like off by 2x or 3x it's just</span> <span data-start="744.11" data-end="746.18">completely ridiculous useless data and</span> <span data-start="746.18" data-end="748.25">back before things like the FPS meter</span> <span data-start="748.25" data-end="749.3">and the timeline panel were</span> <span data-start="749.3" data-end="752.51">well-established this is the kind of</span> <span data-start="752.51" data-end="754.49">terrible data you got and so this leads</span> <span data-start="754.49" data-end="756.56">us to our last and craziest hack in the</span> </p>
<p><span data-start="756.56" data-end="758.75">Dom rendering column back in the day</span> <span data-start="758.75" data-end="761.18">like say 2011 before there was an FPS</span> <span data-start="761.18" data-end="764.36">meter available what could you do to get</span> <span data-start="764.36" data-end="766.31">these orange bars to get the actual</span> <span data-start="766.31" data-end="768.35">accurate data when javascript is so far</span> <span data-start="768.35" data-end="771.05">off the mark and we developed a number</span> <span data-start="771.05" data-end="772.16">of people actually were not the only</span> <span data-start="772.16" data-end="773.6">ones we developed a really ridiculous</span> <span data-start="773.6" data-end="776.69">idea that looks like this that's not a</span> <span data-start="776.69" data-end="778.399">regular SLR camera that's a camera that</span> <span data-start="778.399" data-end="780.05">shoots video at 600 frames per second</span> <span data-start="780.05" data-end="782.24">and of course if you give engineers a</span> <span data-start="782.24" data-end="783.529">toy like this inevitably we're gonna</span> <span data-start="783.529" data-end="784.67">shoot some video that looks like this</span> <span data-start="784.67" data-end="787.189">before we get any real work done it's a</span> <span data-start="787.189" data-end="789.319">guy breathing fire obviously but</span> <span data-start="789.319" data-end="790.519">eventually we decided we should probably</span> <span data-start="790.519" data-end="794.29">try to be productive and we eventually</span> <span data-start="794.29" data-end="796.759">decided to shoot video that looks more</span> <span data-start="796.759" data-end="799.43">like this this is me hitting a key as</span> <span data-start="799.43" data-end="800.36">fast as I can</span> <span data-start="800.36" data-end="802.91">slow down 20 times and you can see</span> <span data-start="802.91" data-end="804.139">there's a noticeable delay between my</span> <span data-start="804.139" data-end="805.22">fingers striking the key and the</span> <span data-start="805.22" data-end="805.889">character</span> <span data-start="805.889" data-end="808.439">on the screen so you can get extremely</span> <span data-start="808.439" data-end="809.97">extremely precise information about</span> <span data-start="809.97" data-end="811.949">things like rendering latency using this</span> <span data-start="811.949" data-end="813.959">kind of technique obviously this is a</span> <span data-start="813.959" data-end="815.79">last resort it's really time consuming</span> <span data-start="815.79" data-end="817.829">to do this so you should prefer to use</span> <span data-start="817.829" data-end="819.359">the timeline panel the frame per second</span> <span data-start="819.359" data-end="821.609">meter requestanimationframe base timing</span> <span data-start="821.609" data-end="822.629">these more modern things that are</span> <span data-start="822.629" data-end="824.429">available but there are a few cases I</span> <span data-start="824.429" data-end="826.169">think where this is still useful things</span> <span data-start="826.169" data-end="827.579">like latency for example again are</span> <span data-start="827.579" data-end="828.929">trickier to measure the frames per</span> <span data-start="828.929" data-end="830.639">second meter tells you frequency but not</span> <span data-start="830.639" data-end="833.069">wait and see another thing that's really</span> <span data-start="833.069" data-end="834.359">powerful about it though is it actually</span> <span data-start="834.359" data-end="836.04">lets you measure the performance of apps</span> <span data-start="836.04" data-end="837.389">where you don't have access to the code</span> <span data-start="837.389" data-end="839.069">so I think we're very used to in the</span> </p>
<p><span data-start="839.069" data-end="840.449">JavaScript world you can bring up any</span> <span data-start="840.449" data-end="842.04">webpage and pull up developer tools on</span> <span data-start="842.04" data-end="843.899">it start poking around in the code but</span> <span data-start="843.899" data-end="845.189">let's say you're building like a mobile</span> <span data-start="845.189" data-end="847.589">website or code Cordova based mobile app</span> <span data-start="847.589" data-end="849.089">and you want to compare your performance</span> <span data-start="849.089" data-end="850.529">against a native phone app that's your</span> <span data-start="850.529" data-end="852.299">competitor you don't have access to the</span> <span data-start="852.299" data-end="854.129">native code you can't instrument it so a</span> <span data-start="854.129" data-end="855.419">technique like this would actually let</span> <span data-start="855.419" data-end="857.069">you measure the performance of the</span> <span data-start="857.069" data-end="858.899">native app and compare that against your</span> <span data-start="858.899" data-end="860.73">web-based app so in cases like that</span> <span data-start="860.73" data-end="862.589">world though this is crazy as a last</span> <span data-start="862.589" data-end="864.35">resort it can still come in handy</span> <span data-start="864.35" data-end="866.989">alright so we're done talking about the</span> <span data-start="866.989" data-end="869.16">rendering column let's switch over and</span> <span data-start="869.16" data-end="870.6">talk about things that go on inside of</span> <span data-start="870.6" data-end="873.389">v8 now and I think that probably</span> <span data-start="873.389" data-end="875.189">everybody knows about the profiler panel</span> <span data-start="875.189" data-end="878.069">at least a little bit in v8 or sorry in</span> <span data-start="878.069" data-end="880.589">the developer tools but actually I think</span> <span data-start="880.589" data-end="882.749">that for memory profiling the timeline</span> <span data-start="882.749" data-end="884.779">panel is a great first place to start</span> <span data-start="884.779" data-end="886.679">there are four things that this gives</span> <span data-start="886.679" data-end="888.749">you that are really really handy the</span> <span data-start="888.749" data-end="890.279">first is you get this if you switch to</span> <span data-start="890.279" data-end="892.019">the memory view you get this overview</span> <span data-start="892.019" data-end="893.579">across the whole timeline capture of</span> <span data-start="893.579" data-end="895.139">memory usage over time so you can start</span> <span data-start="895.139" data-end="896.519">to see patterns like memory leaks right</span> <span data-start="896.519" data-end="898.35">increasing constantly you can see</span> <span data-start="898.35" data-end="899.73">excessive object turn if you're getting</span> <span data-start="899.73" data-end="902.879">a GC sort of sawtooth too frequently you</span> <span data-start="902.879" data-end="904.589">also get this count at the bottom which</span> <span data-start="904.589" data-end="907.049">is counting the number of Dom related</span> <span data-start="907.049" data-end="908.519">objects specifically which is one of the</span> <span data-start="908.519" data-end="910.049">more dangerous sources of memory leaks</span> <span data-start="910.049" data-end="911.939">because of how much native browser stuff</span> <span data-start="911.939" data-end="913.889">is prevented from getting freed by</span> <span data-start="913.889" data-end="916.649">holding on to Dom objects then you can</span> <span data-start="916.649" data-end="918.449">also see individual GC events</span> <span data-start="918.449" data-end="920.879">highlighted as individual tick marks</span> <span data-start="920.879" data-end="922.139">here so you can actually quantify how</span> <span data-start="922.139" data-end="924.629">much time your JavaScript is frozen from</span> <span data-start="924.629" data-end="927.389">being executed by a GC going on and then</span> <span data-start="927.389" data-end="929.189">lastly for any individual yellow bar in</span> <span data-start="929.189" data-end="930.48">the timeline that's showing JavaScript</span> <span data-start="930.48" data-end="932.399">execution recent versions of chrome</span> <span data-start="932.399" data-end="935.249">actually show you the size of the number</span> <span data-start="935.249" data-end="937.139">of objects that were generated during</span> <span data-start="937.139" data-end="938.03">the execution that</span> <span data-start="938.03" data-end="939.38">javascript so you can again start to get</span> <span data-start="939.38" data-end="941.18">a sense of how much object turn is going</span> <span data-start="941.18" data-end="943.75">on and at a pretty fine-grained level</span> <span data-start="943.75" data-end="946.28">and then of course moving into the more</span> <span data-start="946.28" data-end="948.44">standard memory profiling view hopefully</span> <span data-start="948.44" data-end="950.06">everybody knows you can you can take a</span> <span data-start="950.06" data-end="951.65">memory snapshot and begin delving into</span> <span data-start="951.65" data-end="953.63">it something that might be a little less</span> <span data-start="953.63" data-end="954.92">widely known though is that you can</span> <span data-start="954.92" data-end="956.6">actually take multiple snapshots and dip</span> <span data-start="956.6" data-end="959.9">them in this view so this is really</span> <span data-start="959.9" data-end="961.04">really useful for looking at memory</span> <span data-start="961.04" data-end="963.08">leaks you can basically take one</span> <span data-start="963.08" data-end="965.84">snapshot do an operation that you expect</span> <span data-start="965.84" data-end="967.4">to be memory neutral like open and close</span> <span data-start="967.4" data-end="968.66">something and then take a second</span> <span data-start="968.66" data-end="970.79">snapshot and get a diff and all the unjú</span> <span data-start="970.79" data-end="972.23">seed objects hanging around between</span> <span data-start="972.23" data-end="974.42">those two snapshots are red flags are</span> <span data-start="974.42" data-end="978.46">potential sources of memory leaks so</span> <span data-start="978.46" data-end="980.96">let's talk about CPU profiling which is</span> <span data-start="980.96" data-end="982.37">of course the other sort of JavaScript</span> <span data-start="982.37" data-end="984.17">performance oriented side of the</span> <span data-start="984.17" data-end="985.82">profiling world this is getting a little</span> <span data-start="985.82" data-end="987.08">more exotic there's something that just</span> <span data-start="987.08" data-end="989.12">landed in Chrome Canary recently called</span> <span data-start="989.12" data-end="990.83">the flame chart view so if you capture a</span> </p>
<p><span data-start="990.83" data-end="993.01">CPU profile you can get this really cool</span> <span data-start="993.01" data-end="995.36">visualization of the data and what's</span> <span data-start="995.36" data-end="996.59">nice about this is that unlike the</span> <span data-start="996.59" data-end="999.62">normal CPU profile view which buckets</span> <span data-start="999.62" data-end="1001.75">all of the entire profiling run into one</span> <span data-start="1001.75" data-end="1003.82">data capture this actually shows you how</span> <span data-start="1003.82" data-end="1006.31">the hotspots of area over time so</span> <span data-start="1006.31" data-end="1007.66">there's two different panels here</span> <span data-start="1007.66" data-end="1009.67">basically and it's a little tricky to</span> <span data-start="1009.67" data-end="1011.23">sort them out but basically the top</span> <span data-start="1011.23" data-end="1012.79">panel here is an overview of the entire</span> <span data-start="1012.79" data-end="1015.64">profile capturing run and the spikes</span> <span data-start="1015.64" data-end="1016.6">here are basically showing you</span> </p>
<p><span data-start="1016.6" data-end="1018.67">JavaScript activities so the y-axis is</span> <span data-start="1018.67" data-end="1021.07">you know increased CPU usage essentially</span> <span data-start="1021.07" data-end="1022.75">and then you can zoom in on a particular</span> <span data-start="1022.75" data-end="1024.49">part of that like the highlighted area</span> <span data-start="1024.49" data-end="1027.07">here and you'll see along the bottom you</span> <span data-start="1027.07" data-end="1029.41">get this zoomed in view and this</span> <span data-start="1029.41" data-end="1030.88">actually the y-axis means something</span> <span data-start="1030.88" data-end="1032.32">different though his rig is confusing</span> <span data-start="1032.32" data-end="1035.29">the y-axis here is just is just a stack</span> <span data-start="1035.29" data-end="1037.6">call stack basically so it's a lot like</span> <span data-start="1037.6" data-end="1038.8">the chrome tracing view where it's a</span> <span data-start="1038.8" data-end="1040.39">call stack it's just actually flipped</span> <span data-start="1040.39" data-end="1041.83">upside down in this case but same</span> <span data-start="1041.83" data-end="1045.12">difference so the the x-axis here</span> <span data-start="1045.12" data-end="1048.01">represents time so the wider the bar the</span> <span data-start="1048.01" data-end="1049.27">more time spent just like the chrome</span> <span data-start="1049.27" data-end="1051.94">tracing view so the x-axis here roughly</span> <span data-start="1051.94" data-end="1053.56">maps to the y-axis up in this other</span> <span data-start="1053.56" data-end="1055.72">chart that's a little confusing the</span> <span data-start="1055.72" data-end="1056.89">other thing that's potentially confusing</span> <span data-start="1056.89" data-end="1058.84">about this is the color scheme combined</span> <span data-start="1058.84" data-end="1060.34">with the name flame chart makes it sound</span> <span data-start="1060.34" data-end="1062.02">kind of like a heat map like red is bad</span> <span data-start="1062.02" data-end="1062.71">and green</span> <span data-start="1062.71" data-end="1065.62">good that's actually not true at all the</span> <span data-start="1065.62" data-end="1067.12">colors here are just like chrome tracing</span> <span data-start="1067.12" data-end="1068.32">where they're essentially randomly</span> <span data-start="1068.32" data-end="1069.909">chosen colors that the same method gets</span> <span data-start="1069.909" data-end="1071.71">the same color everywhere it appears</span> <span data-start="1071.71" data-end="1073.57">just to make it easier to read but the</span> <span data-start="1073.57" data-end="1075.01">colors don't have any particular meaning</span> <span data-start="1075.01" data-end="1080.049">other than that so if you want to start</span> <span data-start="1080.049" data-end="1081.85">getting more sort of honing in on very</span> <span data-start="1081.85" data-end="1083.71">specific you know parts of your code</span> <span data-start="1083.71" data-end="1085.779">base to target for performance profiling</span> <span data-start="1085.779" data-end="1087.549">there are two really cool ways that you</span> <span data-start="1087.549" data-end="1090.159">can do that the first is you can use</span> <span data-start="1090.159" data-end="1091.99">consult up profile and profile end to</span> <span data-start="1091.99" data-end="1093.429">actually automatically kick off</span> <span data-start="1093.429" data-end="1095.289">profiling sessions to get recorded in</span> <span data-start="1095.289" data-end="1096.7">the dev tools and show up with your own</span> <span data-start="1096.7" data-end="1098.47">label you can actually have more than</span> <span data-start="1098.47" data-end="1100.36">one of these running at once they can be</span> <span data-start="1100.36" data-end="1101.38">overlapping they don't have to be</span> <span data-start="1101.38" data-end="1103.36">strictly nested so it's a really great</span> <span data-start="1103.36" data-end="1105.88">way to begin you know honing down on</span> <span data-start="1105.88" data-end="1107.14">specific parts of your code without</span> <span data-start="1107.14" data-end="1108.909">having to click the begin and end button</span> <span data-start="1108.909" data-end="1110.61">manually right at the right times and</span> <span data-start="1110.61" data-end="1114.85">then also you can use console time and</span> <span data-start="1114.85" data-end="1117.58">time end to add custom annotations that</span> <span data-start="1117.58" data-end="1119.529">show up in the chrome tracing view so</span> <span data-start="1119.529" data-end="1120.76">there you can actually begin to see your</span> <span data-start="1120.76" data-end="1122.86">own method calls your own time brackets</span> <span data-start="1122.86" data-end="1125.08">basically precisely lined up with what's</span> <span data-start="1125.08" data-end="1126.73">going on in the browser native side of</span> <span data-start="1126.73" data-end="1129.429">things in this really really rich rich</span> <span data-start="1129.429" data-end="1131.2">threaded view of what's going on so</span> <span data-start="1131.2" data-end="1132.549">again you know like the custom</span> <span data-start="1132.549" data-end="1133.99">annotations in the timeline panel these</span> <span data-start="1133.99" data-end="1135.279">are really cool ways to begin adding</span> <span data-start="1135.279" data-end="1138.07">your own annotations to a data set that</span> <span data-start="1138.07" data-end="1139.69">normally is kind of blind to what your</span> <span data-start="1139.69" data-end="1141.399">code means and is this very generic view</span> <span data-start="1141.399" data-end="1143.529">and here you can begin to make it much</span> <span data-start="1143.529" data-end="1145.419">more specific to your own profiling</span> <span data-start="1145.419" data-end="1149.2">needs your own goals and targets all</span> <span data-start="1149.2" data-end="1151.84">right let's say none of that stuff is</span> <span data-start="1151.84" data-end="1153.76">crazy enough let's dial up the craziness</span> <span data-start="1153.76" data-end="1156.909">meter a little bit further here if that</span> <span data-start="1156.909" data-end="1158.83">stuff isn't giving enough information it</span> <span data-start="1158.83" data-end="1161.02">turns out that v8 s —  profiler actually</span> <span data-start="1161.02" data-end="1163">produces a lot more info than what the</span> <span data-start="1163" data-end="1165.52">dev tools show and there are a few kind</span> <span data-start="1165.52" data-end="1167.02">of crazy hacky ways that you can get at</span> <span data-start="1167.02" data-end="1169.539">some of that richer info the set up for</span> <span data-start="1169.539" data-end="1171.82">this is a little bit involved that's why</span> <span data-start="1171.82" data-end="1172.929">this is on the high end of the crazy</span> <span data-start="1172.929" data-end="1174.34">spectrum so I won't go through that in</span> <span data-start="1174.34" data-end="1176.02">detail but I'll post up those steps</span> <span data-start="1176.02" data-end="1179.679">later but basically what you do is once</span> <span data-start="1179.679" data-end="1181.57">you get that set up you close all</span> <span data-start="1181.57" data-end="1182.95">instances of chrome that you have open</span> <span data-start="1182.95" data-end="1184.779">that includes canary and stable if you</span> <span data-start="1184.779" data-end="1186.82">happen to have both open thanks to a</span> </p>
<p><span data-start="1186.82" data-end="1188.59">John mcCutchan at Google for helping me</span> <span data-start="1188.59" data-end="1189.789">to figure that one out is very confusing</span> <span data-start="1189.789" data-end="1191.26">clothes every chrome process you can get</span> <span data-start="1191.26" data-end="1192.399">your hands on and when they're all</span> <span data-start="1192.399" data-end="1193.84">closed you go to the command line and</span> <span data-start="1193.84" data-end="1194.98">you launch Chrome with these special</span> <span data-start="1194.98" data-end="1195.79">flags</span> <span data-start="1195.79" data-end="1197.32">and they basically get fed through to v8</span> <span data-start="1197.32" data-end="1200.74">and tells v8 to generate a log file then</span> <span data-start="1200.74" data-end="1202.42">you dig out that log file and you run</span> <span data-start="1202.42" data-end="1204.43">this plot timer events script on it</span> <span data-start="1204.43" data-end="1207.64">which is part of the v8 source and it</span> <span data-start="1207.64" data-end="1209.23">generates a ping file it'll chug for a</span> <span data-start="1209.23" data-end="1210.52">little while and spit out this ping file</span> <span data-start="1210.52" data-end="1213.18">next to the log and it looks like this</span> <span data-start="1213.18" data-end="1215.08">looks a little bit like the chrome</span> <span data-start="1215.08" data-end="1217.27">tracing view but rather than being</span> <span data-start="1217.27" data-end="1218.47">concerned with browser rendering</span> <span data-start="1218.47" data-end="1220.48">performance this is all about what's</span> <span data-start="1220.48" data-end="1222.04">going on on the v8 side of things and</span> <span data-start="1222.04" data-end="1224.2">you can get really really fine grained</span> <span data-start="1224.2" data-end="1226.39">detail here like for example do you see</span> <span data-start="1226.39" data-end="1228.31">compactor and GC scavenger you can</span> <span data-start="1228.31" data-end="1230.71">actually see when GC activity is going</span> <span data-start="1230.71" data-end="1232.12">on when garbage collection is going on</span> <span data-start="1232.12" data-end="1234.07">is it garbage collecting from the young</span> <span data-start="1234.07" data-end="1236.56">space or the old space is it basically</span> <span data-start="1236.56" data-end="1237.7">is it garbage collecting objects that</span> <span data-start="1237.7" data-end="1238.99">were recently created and didn't leave</span> <span data-start="1238.99" data-end="1240.04">very long or is it getting rid of</span> <span data-start="1240.04" data-end="1241.51">objects that hung around a long time and</span> <span data-start="1241.51" data-end="1242.83">then all of a sudden all got freed it</span> <span data-start="1242.83" data-end="1244.12">was that can be a very very interesting</span> <span data-start="1244.12" data-end="1246.61">insight to have into what's going on and</span> <span data-start="1246.61" data-end="1249.07">with GC performance problems another</span> <span data-start="1249.07" data-end="1251.07">thing that's really cool in this view is</span> <span data-start="1251.07" data-end="1253.51">this bar that runs along the middle here</span> <span data-start="1253.51" data-end="1256.03">which tells you the kind of code being</span> <span data-start="1256.03" data-end="1258.1">executed and what that means is whether</span> <span data-start="1258.1" data-end="1260.56">v8 is currently running optimized code</span> <span data-start="1260.56" data-end="1263.95">or unoptimized code which can be very a</span> <span data-start="1263.95" data-end="1265.57">very important problem if your code</span> <span data-start="1265.57" data-end="1266.92">that's performance sensitive isn't</span> <span data-start="1266.92" data-end="1268.75">getting optimized fully by v8 that can</span> <span data-start="1268.75" data-end="1270.73">be a problem and it can be sort of a</span> <span data-start="1270.73" data-end="1272.98">mystery too and the way you tell it by</span> <span data-start="1272.98" data-end="1275.41">the my screen is optimized read full</span> <span data-start="1275.41" data-end="1277">code they call it is it is unoptimized</span> <span data-start="1277" data-end="1279.28">this particular trace is not such a good</span> <span data-start="1279.28" data-end="1281.23">example it's mostly neither it's mostly</span> <span data-start="1281.23" data-end="1282.82">not bottleneck by JavaScript at all but</span> <span data-start="1282.82" data-end="1284.2">in things that are bottlenecking on</span> <span data-start="1284.2" data-end="1285.46">javascript you'll see a lot of either</span> <span data-start="1285.46" data-end="1286.18">red or green</span> <span data-start="1286.18" data-end="1289.3">hopefully green but maybe red and so to</span> <span data-start="1289.3" data-end="1290.74">begin looking at it the first thing you</span> <span data-start="1290.74" data-end="1292.06">need to do is actually zoom in on this</span> <span data-start="1292.06" data-end="1293.83">data because if you look at this it's</span> <span data-start="1293.83" data-end="1295.06">capturing it's really hard to see the</span> <span data-start="1295.06" data-end="1297.64">numbers but it's basically 14 seconds is</span> <span data-start="1297.64" data-end="1298.9">the only thing this capture one it's the</span> <span data-start="1298.9" data-end="1300.31">entire time that chrome is up and</span> <span data-start="1300.31" data-end="1302.83">running you don't get any any control</span> <span data-start="1302.83" data-end="1304.09">over how long it runs the capture for</span> <span data-start="1304.09" data-end="1305.46">the whole time it's it's up and running</span> <span data-start="1305.46" data-end="1308.62">so to zoom in on this you can pass some</span> <span data-start="1308.62" data-end="1310.81">arguments to that the plot timer events</span> <span data-start="1310.81" data-end="1312.43">function and you can basically begin</span> <span data-start="1312.43" data-end="1313.84">zooming in so you can see now it's sort</span> <span data-start="1313.84" data-end="1315.16">of starting to break down if these frame</span> <span data-start="1315.16" data-end="1318.22">units again and you can zoom in even on</span> <span data-start="1318.22" data-end="1319.72">a single frame and start to get really</span> <span data-start="1319.72" data-end="1320.98">really detailed information you know</span> <span data-start="1320.98" data-end="1322.63">down to the millisecond basically about</span> <span data-start="1322.63" data-end="1324.91">what's going on inside a v8 at every</span> <span data-start="1324.91" data-end="1328.03">little time slice this is still kind of</span> <span data-start="1328.03" data-end="1329.57">a crappy iterative process like</span> <span data-start="1329.57" data-end="1330.86">have to like run the script and then</span> <span data-start="1330.86" data-end="1332.39">relook at the ping file and run the</span> <span data-start="1332.39" data-end="1334.43">script again and all that I did come up</span> <span data-start="1334.43" data-end="1336.38">with an interesting hack for it</span> <span data-start="1336.38" data-end="1338.35">navigating this data more interactively</span> <span data-start="1338.35" data-end="1340.79">it's a little tricky it requires pulling</span> <span data-start="1340.79" data-end="1342.47">a chunk of code out of the plot timer</span> <span data-start="1342.47" data-end="1344.48">event script that you run and basically</span> <span data-start="1344.48" data-end="1346.55">getting it to save its intermediate file</span> <span data-start="1346.55" data-end="1349.37">before generating the ping it turns out</span> <span data-start="1349.37" data-end="1350.75">that the intermediate file that it uses</span> <span data-start="1350.75" data-end="1352.1">to generate the ping is just a text</span> <span data-start="1352.1" data-end="1353.9">format file that contains a bunch of</span> <span data-start="1353.9" data-end="1356.66">drawing commands and if you cross out</span> <span data-start="1356.66" data-end="1358.22">the first line if you delete that first</span> <span data-start="1358.22" data-end="1359.96">line from the file you can then open</span> <span data-start="1359.96" data-end="1362.72">this in an interactive visualizer so</span> <span data-start="1362.72" data-end="1365.09">gnuplot is the thing it uses you can you</span> <span data-start="1365.09" data-end="1366.8">can get interactive visualizers onto</span> <span data-start="1366.8" data-end="1369.44">this new platform at data and I'll show</span> <span data-start="1369.44" data-end="1372.92">you a quick example of that here's where</span> <span data-start="1372.92" data-end="1374.87">the control scheme from chrome tracing</span> <span data-start="1374.87" data-end="1376.22">the video game style thing starts to</span> <span data-start="1376.22" data-end="1377.72">sound less crazy because I find this</span> <span data-start="1377.72" data-end="1378.83">even more bizarre the way that you</span> <span data-start="1378.83" data-end="1381.08">navigate this is you you control mouse</span> <span data-start="1381.08" data-end="1382.49">wheel to zoom in which seems pretty</span> <span data-start="1382.49" data-end="1384.74">reasonable and this is actually quite</span> <span data-start="1384.74" data-end="1386.3">powerful because it's because this is a</span> <span data-start="1386.3" data-end="1387.83">data plotting software package you</span> <span data-start="1387.83" data-end="1389.06">notice it's smart enough to keep the</span> <span data-start="1389.06" data-end="1390.95">axis labels interview even as you zoomed</span> <span data-start="1390.95" data-end="1394.04">in which is pretty cool but the way that</span> <span data-start="1394.04" data-end="1395.9">you scroll horizontally is you see I</span> <span data-start="1395.9" data-end="1397.28">have to refer to notes as how crazy this</span> <span data-start="1397.28" data-end="1399.08">is you have to you hold down shift and</span> <span data-start="1399.08" data-end="1400.22">you use the mouse wheel to scroll</span> <span data-start="1400.22" data-end="1401.96">horizontally and then to scroll</span> <span data-start="1401.96" data-end="1403.64">vertically you hold down alt and use the</span> <span data-start="1403.64" data-end="1406.07">mouse wheel makes tons of sense right</span> <span data-start="1406.07" data-end="1407.87">it's such an intuitive way of navigating</span> <span data-start="1407.87" data-end="1410.12">data but it is nonetheless a much faster</span> <span data-start="1410.12" data-end="1413.06">iteration than having to repeatedly look</span> <span data-start="1413.06" data-end="1414.44">at the milliseconds and then rerun the</span> <span data-start="1414.44" data-end="1415.88">script and open the ping file again and</span> <span data-start="1415.88" data-end="1417.95">you know rinse and repeat so this is</span> <span data-start="1417.95" data-end="1419.71">kind of a cool way to visualize the data</span> <span data-start="1419.71" data-end="1422.21">of course because this is just a text</span> <span data-start="1422.21" data-end="1423.35">format I think it would be really</span> <span data-start="1423.35" data-end="1424.64">awesome if someone wrote like a Java</span> </p>
<p><span data-start="1424.64" data-end="1426.44">Script in d3 based visualization of this</span> <span data-start="1426.44" data-end="1428.06">or something like that I'll definitely</span> <span data-start="1428.06" data-end="1429.59">buy a case of beer for anyone who I can</span> <span data-start="1429.59" data-end="1431.03">sort that out or for that matter anyone</span> <span data-start="1431.03" data-end="1432.02">who checks it into the dev tools</span> <span data-start="1432.02" data-end="1433.19">hopefully one of those two things will</span> <span data-start="1433.19" data-end="1437.96">happen to happen soon so once you've</span> <span data-start="1437.96" data-end="1439.94">actually zoomed in enough and been able</span> <span data-start="1439.94" data-end="1442.13">to identify some data there and let's</span> <span data-start="1442.13" data-end="1443.24">say you can actually see that some</span> <span data-start="1443.24" data-end="1445.16">things aren't getting optimized when you</span> <span data-start="1445.16" data-end="1448.4">want them to be optimized first you</span> <span data-start="1448.4" data-end="1449.69">don't know what code that actually is</span> <span data-start="1449.69" data-end="1451.16">you just you can see a red bar and you</span> <span data-start="1451.16" data-end="1452.87">want to know what functions they are so</span> <span data-start="1452.87" data-end="1454.76">one way to get more info on that is to</span> <span data-start="1454.76" data-end="1456.08">run that same log file through a</span> <span data-start="1456.08" data-end="1457.55">slightly different command it spits out</span> <span data-start="1457.55" data-end="1458.96">a text file that looks like this</span> <span data-start="1458.96" data-end="1460.88">at first glance this looks a lot like</span> <span data-start="1460.88" data-end="1462.63">the data you get out of the regular</span> <span data-start="1462.63" data-end="1464.37">tools profiler panel it's just kind of a</span> <span data-start="1464.37" data-end="1466.26">you know top-down heavy heavy daylight</span> <span data-start="1466.26" data-end="1469.41">you know list of functions but it has</span> <span data-start="1469.41" data-end="1471.45">this extra little annotation the</span> <span data-start="1471.45" data-end="1472.74">asterisk is telling you that those</span> <span data-start="1472.74" data-end="1474.9">functions are running optimized in the</span> </p>
<p><span data-start="1474.9" data-end="1477.18">VM the lack of an asterisk tells you</span> <span data-start="1477.18" data-end="1478.77">that the function is running unoptimized</span> <span data-start="1478.77" data-end="1481.23">and that is probably the red bar you're</span> <span data-start="1481.23" data-end="1482.55">looking at if you're seeing a lot of red</span> <span data-start="1482.55" data-end="1484.05">in your code it's gonna be the heavy</span> <span data-start="1484.05" data-end="1486.54">function that's not optimized so now you</span> <span data-start="1486.54" data-end="1488.1">know which function the next question is</span> <span data-start="1488.1" data-end="1490.05">why is it not running optimized because</span> <span data-start="1490.05" data-end="1491.34">that can be a total mystery you could</span> <span data-start="1491.34" data-end="1492.9">make random changes and see if it fixes</span> <span data-start="1492.9" data-end="1494.43">things but if you're really desperate</span> <span data-start="1494.43" data-end="1496.29">you'd like to get some kind of clue as</span> <span data-start="1496.29" data-end="1497.7">to what's up and why it didn't get</span> <span data-start="1497.7" data-end="1499.74">optimized and that's where the third v8</span> <span data-start="1499.74" data-end="1502.17">logging trick comes in you run Chrome is</span> <span data-start="1502.17" data-end="1504.03">slightly different flags and it actually</span> <span data-start="1504.03" data-end="1505.62">barks out a bunch of stuff the console</span> <span data-start="1505.62" data-end="1507.39">so you redirect it to a text file and</span> <span data-start="1507.39" data-end="1509.25">when you search that text file you start</span> <span data-start="1509.25" data-end="1511.8">seeing things like this and you can</span> <span data-start="1511.8" data-end="1513.06">actually see names of some of your own</span> <span data-start="1513.06" data-end="1514.53">functions in there and it'll actually</span> <span data-start="1514.53" data-end="1516.75">give you the reason in sort of shorthand</span> <span data-start="1516.75" data-end="1518.46">it'll give you the reason why that</span> <span data-start="1518.46" data-end="1519.99">function was ineligible for being</span> <span data-start="1519.99" data-end="1522.03">optimized or maybe in some cases why it</span> <span data-start="1522.03" data-end="1524.7">was optimized and then later on kicked</span> <span data-start="1524.7" data-end="1526.74">back and D optimized because it violated</span> <span data-start="1526.74" data-end="1528.36">some assumption that v8 was making about</span> <span data-start="1528.36" data-end="1532.68">its control flow this stuff is is again</span> <span data-start="1532.68" data-end="1533.85">this is like on the extreme end of the</span> <span data-start="1533.85" data-end="1535.77">crazy scale because of not only the</span> <span data-start="1535.77" data-end="1537.21">complicated set up but also the data</span> <span data-start="1537.21" data-end="1539.22">file that you get here is pretty hard to</span> <span data-start="1539.22" data-end="1540.9">parse through the reasons that it lists</span> <span data-start="1540.9" data-end="1542.97">are often pretty vague and from what</span> </p>
<p><span data-start="1542.97" data-end="1544.44">I've seen it seems to not always list</span> <span data-start="1544.44" data-end="1545.94">all of the functions that you expect it</span> <span data-start="1545.94" data-end="1547.41">to list so sometimes it may be missing</span> <span data-start="1547.41" data-end="1549.75">information so it's pretty hard to parse</span> <span data-start="1549.75" data-end="1550.98">through if you don't know the v8 source</span> <span data-start="1550.98" data-end="1553.68">code which I certainly don't but</span> <span data-start="1553.68" data-end="1555.15">hopefully a lot of this data is going to</span> <span data-start="1555.15" data-end="1557.31">begin bubbling up you know into views</span> <span data-start="1557.31" data-end="1559.02">like chrome tracing and even the dev</span> <span data-start="1559.02" data-end="1561.81">tools proper B you know as this stuff</span> <span data-start="1561.81" data-end="1563.52">coming out of v8 gets richer and more</span> <span data-start="1563.52" data-end="1565.62">stable and there's just so much need for</span> <span data-start="1565.62" data-end="1567.33">this to be exposed at a higher level so</span> </p>
<p><span data-start="1567.33" data-end="1568.47">I think we'll start seeing more of this</span> <span data-start="1568.47" data-end="1571.65">in the near future in actual UI oriented</span> <span data-start="1571.65" data-end="1576.78">tools so with all that said sometimes</span> <span data-start="1576.78" data-end="1578.04">you should ignore everything I talked</span> <span data-start="1578.04" data-end="1579.99">about and in fact everything anyone says</span> <span data-start="1579.99" data-end="1581.79">about JavaScript performance because</span> <span data-start="1581.79" data-end="1583.41">some things that sometimes they're</span> <span data-start="1583.41" data-end="1584.79">reasons to not focus on JavaScript</span> <span data-start="1584.79" data-end="1586.02">performance at all but to focus on other</span> <span data-start="1586.02" data-end="1589.14">things so reason number one I'll give</span> <span data-start="1589.14" data-end="1590.7">you three what I think are three good</span> <span data-start="1590.7" data-end="1592.71">reasons to not be always focus on</span> </p>
<p><span data-start="1592.71" data-end="1593.669">JavaScript performance</span> <span data-start="1593.669" data-end="1595.679">number one is that sometimes Network i/o</span> <span data-start="1595.679" data-end="1597.479">performance is a much much bigger issue</span> <span data-start="1597.479" data-end="1599.159">page load time is often one of the</span> <span data-start="1599.159" data-end="1600.929">number one complaints about slowness</span> <span data-start="1600.929" data-end="1602.909">that users have and that often has very</span> <span data-start="1602.909" data-end="1605.219">little to do with JavaScript has to do</span> <span data-start="1605.219" data-end="1606.269">with network performance and</span> <span data-start="1606.269" data-end="1609.149">minimization things like that and there</span> <span data-start="1609.149" data-end="1610.469">are a couple really cool browser API to</span> <span data-start="1610.469" data-end="1612.629">let you get an info about page load</span> <span data-start="1612.629" data-end="1614.489">timing like this one that's information</span> <span data-start="1614.489" data-end="1616.679">that is really hard to gather either on</span> <span data-start="1616.679" data-end="1618.929">your server or using regular JavaScript</span> <span data-start="1618.929" data-end="1620.19">without the help of this browser API</span> <span data-start="1620.19" data-end="1621.929">because you don't have insight into the</span> <span data-start="1621.929" data-end="1623.639">whole flow from the time the user clicks</span> <span data-start="1623.639" data-end="1624.809">a link to the time that this stuff</span> <span data-start="1624.809" data-end="1626.849">renders on-screen the browser knows that</span> <span data-start="1626.849" data-end="1628.349">whole timeline and they can save the</span> <span data-start="1628.349" data-end="1630.419">data and give it to you you can also get</span> <span data-start="1630.419" data-end="1632.639">data broken down by individual resources</span> <span data-start="1632.639" data-end="1635.009">so you can use these api's to get at the</span> <span data-start="1635.009" data-end="1637.229">loading time of individual image files</span> <span data-start="1637.229" data-end="1641.159">individual script files all that stuff</span> <span data-start="1641.159" data-end="1644.249">the working group that oh sorry this one</span> <span data-start="1644.249" data-end="1645.529">thing is going to say about this is that</span> <span data-start="1645.529" data-end="1647.999">perceived performance is often more</span> <span data-start="1647.999" data-end="1650.219">important than actual performance so</span> <span data-start="1650.219" data-end="1651.899">when you're talking to a server and the</span> <span data-start="1651.899" data-end="1653.7">server might be slow doing that in a way</span> <span data-start="1653.7" data-end="1655.019">that's asynchronous and doesn't block</span> <span data-start="1655.019" data-end="1658.169">any part of your pages UI is is a huge</span> <span data-start="1658.169" data-end="1659.759">huge win if you look at the way that you</span> <span data-start="1659.759" data-end="1661.2">know things like Google Docs or Trello</span> <span data-start="1661.2" data-end="1663.779">or Gmail do saves asynchronously in the</span> <span data-start="1663.779" data-end="1665.279">background of that blocking stuff it</span> <span data-start="1665.279" data-end="1666.749">makes it feel a lot faster even though</span> <span data-start="1666.749" data-end="1667.979">it could take several seconds for the</span> <span data-start="1667.979" data-end="1671.789">server to actually respond quick aside</span> <span data-start="1671.789" data-end="1673.799">the w3c working group that produced</span> <span data-start="1673.799" data-end="1675.269">those resource timing API is that I</span> <span data-start="1675.269" data-end="1677.039">showed you on this slide here they're</span> <span data-start="1677.039" data-end="1679.049">also beginning work now on a number of</span> </p>
<p><span data-start="1679.049" data-end="1681.269">AP is for rendering performance for</span> <span data-start="1681.269" data-end="1682.619">measuring that stuff programmatically so</span> <span data-start="1682.619" data-end="1683.459">they're beginning to basically</span> <span data-start="1683.459" data-end="1685.919">standardize things like the scrolling</span> <span data-start="1685.919" data-end="1687.479">simulation API that I mentioned earlier</span> <span data-start="1687.479" data-end="1690.959">with the chrome telemetry stuff so I</span> <span data-start="1690.959" data-end="1692.789">think we'll see a lot of cool stuff out</span> <span data-start="1692.789" data-end="1693.929">of this working group in the future this</span> <span data-start="1693.929" data-end="1694.859">is also the group that produced</span> <span data-start="1694.859" data-end="1696.749">requestanimationframe so we've gotten a</span> <span data-start="1696.749" data-end="1697.889">lot of good things out of them already I</span> <span data-start="1697.889" data-end="1701.579">think reason number two is that maybe</span> <span data-start="1701.579" data-end="1703.739">your code is good enough already I think</span> <span data-start="1703.739" data-end="1705.179">that sometimes there's a tendency in</span> <span data-start="1705.179" data-end="1706.889">some parts of JavaScript community to</span> <span data-start="1706.889" data-end="1707.729">started to jump the gun about</span> <span data-start="1707.729" data-end="1710.249">performance for example if someone might</span> <span data-start="1710.249" data-end="1711.659">see code like this and say oh geez you</span> <span data-start="1711.659" data-end="1712.619">can't do that look at this you're</span> <span data-start="1712.619" data-end="1713.909">entering a function closure every</span> <span data-start="1713.909" data-end="1715.44">iteration of loop and I mean look what</span> </p>
<p><span data-start="1715.44" data-end="1717.869">Jesper comm says about this it's way</span> <span data-start="1717.869" data-end="1719.339">faster to just use a regular for loop</span> <span data-start="1719.339" data-end="1721.799">and while there's some truth to that if</span> <span data-start="1721.799" data-end="1723.089">you look at the time scale on these</span> <span data-start="1723.089" data-end="1724.859">things sometimes you're talking about</span> <span data-start="1724.859" data-end="1726.419">the difference between 12 meeting 12</span> <span data-start="1726.419" data-end="1727.48">million iterations per sec</span> <span data-start="1727.48" data-end="1729.07">eighty million iterations per second and</span> <span data-start="1729.07" data-end="1731.2">if the context of your code is for</span> <span data-start="1731.2" data-end="1733.779">example creating a menu you know that</span> <span data-start="1733.779" data-end="1735.159">that difference makes no difference</span> <span data-start="1735.159" data-end="1736.48">right if you're only it going to iterate</span> <span data-start="1736.48" data-end="1738.039">a couple hundred even a couple thousand</span> <span data-start="1738.039" data-end="1739.529">times</span> <span data-start="1739.529" data-end="1741.639">that's that difference is just totally</span> <span data-start="1741.639" data-end="1743.08">water under the bridge so you know it's</span> <span data-start="1743.08" data-end="1744.73">not a best practice to make your code</span> <span data-start="1744.73" data-end="1746.139">harder to read or harder to maintain</span> <span data-start="1746.139" data-end="1748.299">just for speculative performance gains</span> <span data-start="1748.299" data-end="1749.85">the best practice is to identify</span> <span data-start="1749.85" data-end="1752.23">specific bottlenecks that your users</span> <span data-start="1752.23" data-end="1754.72">actually care about and make fixes for</span> <span data-start="1754.72" data-end="1756.21">those in a targeted way</span> <span data-start="1756.21" data-end="1759.46">lastly reason number three engineering</span> <span data-start="1759.46" data-end="1761.169">time is a finite resource and you should</span> <span data-start="1761.169" data-end="1763.389">spend time on what's most important so</span> <span data-start="1763.389" data-end="1764.71">here are some things that might be more</span> <span data-start="1764.71" data-end="1772.789">important than working on performance</span> <span data-start="1772.799" data-end="1775.21">it's a pretty good list right but</span> <span data-start="1775.21" data-end="1776.44">sometimes performance really does matter</span> <span data-start="1776.44" data-end="1778.12">and when that is the most important</span> <span data-start="1778.12" data-end="1779.799">thing to work on I hope that the tools I</span> <span data-start="1779.799" data-end="1781.24">showed you will make your life easier</span> <span data-start="1781.24" data-end="1782.44">when you get desperate with performance</span> <span data-start="1782.44" data-end="1784.27">stuff thanks for listening</span> <span data-start="1784.27" data-end="1798.53">[Applause]</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
