<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PU94cgLuw9I</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/PU94cgLuw9I?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="3.1" data-end="28">"Making the Jump: How Desktop-Era Frameworks Can Thrive on Mobile"</span> <span data-start="28" data-end="29.49">Tom Dale</span> <span data-start="29.49" data-end="30.49"Audience member: Thank you so much, Ashley.</span> <span data-start="30.49" data-end="31.49">That was really amazing.</span> <span data-start="31.49" data-end="32.49">And before you go, I took a photo of this.</span> <span data-start="32.49" data-end="33.49">So this store, in New York, that sells karate hip hop action/drama headphones and luxury</span> <span data-start="33.49" data-end="34.49">items.</span> </p>
<p><span data-start="34.49" data-end="35.49">Have you ever been in this store?</span> </p>
</section>

<section>
<p><span data-start="35.49" data-end="36.49"><span class="speaker">Ashley</span>: No, I just stood outside.</span> <span data-start="36.49" data-end="37.49">I'll come back and let you know.</span> <span data-start="37.49" data-end="38.49"Audience member: Awesome.</span> <span data-start="38.49" data-end="39.49">Thank you, Ashley.</span> <span data-start="39.49" data-end="40.49">Okay.</span> <span data-start="40.49" data-end="41.49">We have two more talks left today.</span> <span data-start="41.49" data-end="42.49">We're next, welcoming to the stage Tom Dale.</span> <span data-start="42.49" data-end="43.49">He is from New York City, of course.</span> <span data-start="43.49" data-end="44.49">He's a JavaScript thinkfluencer.</span> <span data-start="44.49" data-end="45.49">So this is going to be a think-piece talk, I think.</span> <span data-start="45.49" data-end="46.49">He's wearing a suit today because he's a contrarian, apparently and I think he wants everyone to</span> <span data-start="46.49" data-end="47.49">take a photo with him in the photobooth truck, which every time I walk past, there's not</span> <span data-start="47.49" data-end="48.49">enough people in there.</span> </p>
<p><span data-start="48.49" data-end="49.49">So I hope you've all had a turn in the photobooth truck.</span> <span data-start="49.49" data-end="50.49">So Tom's also wearing a suit because he wants you to join his professional network.</span> <span data-start="50.49" data-end="51.49">He works at LinkedIn.</span> <span data-start="51.49" data-end="52.49">[ Laughter ]</span> <span data-start="52.49" data-end="53.49">He looks very professional.</span> <span data-start="53.49" data-end="54.49">So he's going to give a talk today on how desktop-era frameworks can thrive on mobile.</span> <span data-start="54.49" data-end="55.49">I'm a little bit sad that he's actually in the completing the look with the bowtie and</span> <span data-start="55.49" data-end="56.49">didn't go all the way.</span> <span data-start="56.49" data-end="57.49">Thank you, Tom.</span> </p>
</section>

<section>
<p><span data-start="57.49" data-end="58.49"><span class="speaker">Tom</span>: Thank you very much.</span> <span data-start="58.49" data-end="59.49">Thank you all for having me here today.</span> <span data-start="59.49" data-end="60.49">It really is an honor to be here.</span> <span data-start="60.49" data-end="61.49">My name is Tom.</span> <span data-start="61.49" data-end="62.49">JSConf is a very special conference for me.</span> <span data-start="62.49" data-end="63.49">I was here about four years ago, which is when I met Zahra, who you saw earlier.</span> <span data-start="63.49" data-end="64.49">Jed introduced us on the plane and then two years after that, I proposed and we're getting</span> <span data-start="64.49" data-end="65.49">married in August.</span> <span data-start="65.49" data-end="66.49">So, for me, in particular, JSConf EU has been particularly life-changing and hopefully many</span> <span data-start="66.49" data-end="67.49">of you can develop specially similar relationships, professionally, I mean.</span> <span data-start="67.49" data-end="69.329">So today I want to talk to you about smartphones.</span> <span data-start="69.329" data-end="75.93">And in particular, I want to talk about how tools that grew up on the desktop like Ember,</span> <span data-start="75.93" data-end="80.6">Angular, and React, can make the jump to the mobile future.</span> <span data-start="80.6" data-end="86.609">And I think when people think about adapting apps to phones, they often focus on the more</span> <span data-start="86.609" data-end="88">obvious differences.</span> </p>
<p><span data-start="88" data-end="91.02">So, for example, things like the difference in screen size.</span> <span data-start="91.02" data-end="96.299">The difference in CPU performance, the different input devices, touch versus a mouse.</span> <span data-start="96.299" data-end="100.329">But I think where the device is used is important, too.</span> <span data-start="100.329" data-end="104.5">So, for example, a user on a mobile phone is more likely to be distracted than someone</span> <span data-start="104.5" data-end="108.32">who might be focused on a task at their desk.</span> <span data-start="108.32" data-end="113.84">Or they might have a more intermittent network connection than having a broadband Wi-Fi router</span> <span data-start="113.84" data-end="115.53">in their apartment.</span> <span data-start="115.53" data-end="121.21">So when phones can be used anywhere, there are very few assumptions we can make, whether</span> <span data-start="121.21" data-end="125.369">that's how attentive the user is, or whenever they have that Internet connection at all.</span> </p>
<p><span data-start="125.369" data-end="130.58">So I started working at LinkedIn in December and one thing about working at a site like</span> <span data-start="130.58" data-end="135.56">LinkedIn is it reminds me of how truly global the web can be.</span> <span data-start="135.56" data-end="142.19">In many cases, adapting to smartphones really means adapting to new users.</span> <span data-start="142.19" data-end="145.47">For many people, their first computer is a smartphone.</span> <span data-start="145.47" data-end="149.33">That means millions, maybe even billions of people are going to be participating online</span> <span data-start="149.33" data-end="152.28">without ever owning a desktop computer.</span> <span data-start="152.28" data-end="156.78">And the more global your app is, the more combinations of devices and networks you'll</span> <span data-start="156.78" data-end="157.97">have to deal with.</span> <span data-start="157.97" data-end="163.53">CPU power can range from a feature phone to a low-end smartphone, to the latest iPhone,</span> <span data-start="163.53" data-end="166.12">up to a beefy desktop computer.</span> <span data-start="166.12" data-end="172.4">And network connectivity can range from GPRS, to gigabit fiber, to nothing at all, just</span> <span data-start="172.4" data-end="176.82">ride the subway in New York.</span> <span data-start="176.82" data-end="184.64">So the problem with this is that without careful design, it's easy to optimize for one combination</span> <span data-start="184.64" data-end="186.95">at the cost of another.</span> <span data-start="186.95" data-end="189.35">So let's take a look at two different users.</span> </p>
<p><span data-start="189.35" data-end="191.55">Let's imagine these two scenarios.</span> <span data-start="191.55" data-end="194.89">So user A has a very low-end smartphone.</span> <span data-start="194.89" data-end="202.44">It has a CPU has easily overheats and starts throttling itself, and it would be borderline</span> <span data-start="202.44" data-end="208.21">useless except for the fact that it's not full.</span> <span data-start="208.21" data-end="217.95">It Opera Mini which heavily processes requests before the user gets it.</span> </p>
<p><span data-start="217.95" data-end="224.81">User B has a phone with a CPU that might rival a desktop computer and they've got plenty</span> <span data-start="224.81" data-end="225.86">of fast storage.</span> <span data-start="225.86" data-end="230.7">But the problem is this person is traveling without any cellular data.</span> <span data-start="230.7" data-end="235.59">So while they have sometimes access to broadband Internet, it's only when they're within range</span> <span data-start="235.59" data-end="239.45">of a Wi-Fi network that it's useful.</span> <span data-start="239.45" data-end="245.91">For user A, anything that's JavaScript is probably not going to be helpful at all.</span> <span data-start="245.91" data-end="252.54">Even if they stopped using Opera's proxy, with the slow CPU meaning that getting the</span> <span data-start="252.54" data-end="257.58">JavaScript means long load times.</span> <span data-start="257.58" data-end="264.28">It's about keeping the file size as small as possible.</span> <span data-start="264.28" data-end="268.73">For user B, we want our web app to work more like a native application.</span> </p>
<p><span data-start="268.73" data-end="275.031">In fact, we'd be willing to spend more time up front to load the entire app and as much</span> <span data-start="275.031" data-end="276.64">data possible on the phone.</span> <span data-start="276.64" data-end="278.67">That's basically what the App Store does, right?</span> <span data-start="278.67" data-end="282.561">So that meant that he could use it when we were away from the Wi-Fi connection that we</span> <span data-start="282.561" data-end="288.45">were relying on, and this user probably has higher expectations on this app, as well.</span> <span data-start="288.45" data-end="294.78">It would be worth sending a bit more code to get 60 frames per second animation and</span> <span data-start="294.78" data-end="300.75">buttery smooth scrolling if their device can handle it.</span> <span data-start="300.75" data-end="306.46">So best experience on a slow device is often radical different for the best experience</span> <span data-start="306.46" data-end="310.66">on a faster device.</span> <span data-start="310.66" data-end="319.18">And the more we try to take advantage of higher end phones, the worst we've made the experience</span> <span data-start="319.18" data-end="321.48">for the majority of the world.</span> <span data-start="321.48" data-end="326.02">So what do you all think is the solution to this problem?</span> <span data-start="326.02" data-end="331.79">I'll give you a hint, the initials are, "PE."</span> <span data-start="331.79" data-end="334.33">Any guesses?</span> </p>
<p><span data-start="334.33" data-end="335.33">That's right!</span> <span data-start="335.33" data-end="339.35">Panic and evacuate the building!</span> <span data-start="339.35" data-end="341">Very good.</span> <span data-start="341" data-end="346.08">The answer is supposed to be progressive enhancement but one thing that's implicit, at least in</span> <span data-start="346.08" data-end="350.83">all the advice that I've received about progressive enhancement is that you're supposed to do</span> <span data-start="350.83" data-end="351.83">it yourself.</span> <span data-start="351.83" data-end="356.84">It almost always means rendering on the server, and denying yourself the temptation of using</span> <span data-start="356.84" data-end="360.07">too much JavaScript.</span> <span data-start="360.07" data-end="365.57">And browsers in the last ten years, let's say, have advanced at a remarkable rate.</span> <span data-start="365.57" data-end="371.66">To me, it feels like the web has never had more momentum add feature after feature.</span> <span data-start="371.66" data-end="378.98">And, yet, despite all this incredible innovation from index.db to web workers, it doesn't actually</span> <span data-start="378.98" data-end="384.96">feel to me the experience of using web apps day to day has improved that much in the last</span> <span data-start="384.96" data-end="386.57">three or four years.</span> </p>
<p><span data-start="386.57" data-end="392.36">So why is it that these radical improvements in the browser don't seem to be translating</span> <span data-start="392.36" data-end="397.83">into radically improved web applications?</span> <span data-start="397.83" data-end="406.9">And I would argue the reason for this is the cost of code is too damn high.</span> <span data-start="406.9" data-end="411.82">Taking advantage of all of those new features in the browser requires a lot of code.</span> <span data-start="411.82" data-end="416.44">Native apps that work offline with beautiful user experiences with hundreds of megabytes</span> <span data-start="416.44" data-end="422.04">and that's not even factoring in the SDK that ships with the operating system on the phone.</span> <span data-start="422.04" data-end="427.32">On the web, just parsing and downloading JavaScript can be enough to turn phones janky, and when</span> <span data-start="427.32" data-end="432.12">you start bundling your JavaScript into a file, every byte starts to count.</span> </p>
<p><span data-start="432.12" data-end="440.27">And in turn, misaligned libraries have to compete on file size rather than robustness.</span> <span data-start="440.27" data-end="444.76">So how do they achieve these improbably small file sizes?</span> <span data-start="444.76" data-end="450.07">Often it's by persuading you that the old thing is unnecessarily complex, the cardinal</span> <span data-start="450.07" data-end="456.59">sin in JavaScript but they've seen through the BS and built something simple and that</span> <span data-start="456.59" data-end="459.1">leads to us the JavaScript simplicity fetish.</span> <span data-start="459.1" data-end="464.38">It is this emphasis on file size that leaves the JavaScript community to this fetish, when</span> <span data-start="464.38" data-end="471.47">file size relies on simplicity and speed relies on file size, and speed is paramount on the</span> <span data-start="471.47" data-end="475.84">web, we have to pretend that simple tools are the best tools because what other choice</span> <span data-start="475.84" data-end="478.18">do we have?</span> </p>
<p><span data-start="478.18" data-end="484.79">The only way to run an app that run well on slower phones and networks is write less JavaScript,</span> <span data-start="484.79" data-end="492.419">too often, handling edge cases and higher levels of abstraction.</span> <span data-start="492.419" data-end="497.979">We eventually start to collapse under our own page weight.</span> <span data-start="497.979" data-end="498.979">That's rational.</span> <span data-start="498.979" data-end="500.88">We've seen this play out several times now.</span> <span data-start="500.88" data-end="505.62">The more sophistication equals more code, equals slower load times.</span> <span data-start="505.62" data-end="513.11">So the time period from 2011 to that we have could be roughly broken up into the Backbone</span> <span data-start="513.11" data-end="516.449">era, and the Angular era and the Ember era.</span> <span data-start="516.449" data-end="525.779">This trio of eras can sometimes also been known as the Ember era.</span> <span data-start="525.779" data-end="532.22">Now it's easy to become enamored with the complexity of a tool.</span> </p>
<p><span data-start="532.22" data-end="538.759">And let's go back to 2011 and the most cutting-edge tool that people were using was Backbone.</span> <span data-start="538.759" data-end="546.149">And people were saying, I love it, I can clone it from GitHub, and read the source code within</span> <span data-start="546.149" data-end="548.329">a day.</span> <span data-start="548.329" data-end="553.81">But whenever my model changes, everything breaks.</span> <span data-start="553.81" data-end="557.85">I heard about this new library called Angular.</span> <span data-start="557.85" data-end="559.86">Two-way binding is so simple.</span> <span data-start="559.86" data-end="562.97">You just change it, and it changes it on the screen.</span> <span data-start="562.97" data-end="570.379">But a year later, it's like my app contains a controller with 3 million lines of code.</span> <span data-start="570.379" data-end="580.8">But don't worry, React is amazing and so simple because it's just the "V" in MVC and a year</span> <span data-start="580.8" data-end="590.369">or two into building your app you realize it's 7 megabytes and takes two years to build.</span> <span data-start="590.369" data-end="598.24">So Don Norman what you may know as the author of design of Everyday things, wrote this:</span> <span data-start="598.24" data-end="604.21">The numerous defeats in security measures prompts my slogan, the more secure you try</span> <span data-start="604.21" data-end="607.189">to make something, the less secure it becomes.</span> <span data-start="607.189" data-end="608.379">Why?</span> </p>
<p><span data-start="608.379" data-end="614.36">Because when security gets in the way, sensible and well meaning people develop hacks.</span> <span data-start="614.36" data-end="621.259">Like password rules are too annoying, people just write the password and put it on their</span> <span data-start="621.259" data-end="622.259">desk.</span> <span data-start="622.259" data-end="632.74">So I would like to offer a different corollary because when simplicity gets in the way, sensible,</span> <span data-start="632.74" data-end="638.459">and well meaning people develop hacks to defeat the simplicity.</span> <span data-start="638.459" data-end="640.8">So how do we break out of this local maxima.</span> <span data-start="640.8" data-end="645.43">How do we write one app that can scale up and down across these different devices and</span> <span data-start="645.43" data-end="647.23">performance characteristics?</span> <span data-start="647.23" data-end="653.61">Well, I think we can learn from native developers because they've had to tackle a similar problem.</span> </p>
<p><span data-start="653.61" data-end="659.209">So these are different CPU architectures and different CPU architectures have different</span> <span data-start="659.209" data-end="660.209">instruction sets.</span> <span data-start="660.209" data-end="672.2">If you write some code for x86 and you want to run on ARM, they're totally different.</span> <span data-start="672.2" data-end="675.759">If this is how software was written, there probably wouldn't be that much cross-platform</span> <span data-start="675.759" data-end="681.999">code and introducing new CPU architectures would be borderline impossible.</span> <span data-start="681.999" data-end="687.29">We've figured out, a long time ago, that a compiler can take a higher level program and</span> <span data-start="687.29" data-end="691.68">get it to run across all of these architectures and if a new architecture comes along, you</span> <span data-start="691.68" data-end="695.17">just have to update the compiler and not rewrite every app in existence.</span> <span data-start="695.17" data-end="701.439">So here's an existence of plying an LVM, and taking C code and taking an architecture that</span> <span data-start="701.439" data-end="706.07">didn't exist in the '70s, which was WebAssembly.</span> </p>
<p><span data-start="706.07" data-end="712.32">And best of all, the compiler makes our code not only run on all these architectures, but</span> <span data-start="712.32" data-end="718.66">it can be used to opt my our code differently for particular characteristics of that platform.</span> <span data-start="718.66" data-end="725.11">So, for example, here's a paper about optimizing GCC, where they said, finally, a new target-independent</span> <span data-start="725.11" data-end="729.269">feature could be implemented to take into account certain specific features of the target.</span> <span data-start="729.269" data-end="736.959">For example, to make advantage of the Intel Itanium, it's dating the paper, we've implemented</span> <span data-start="736.959" data-end="739.989">the support in the instruction scheduler.</span> <span data-start="739.989" data-end="745.559">And this is something that Ashley said in her talk when I totally agree with, if there's</span> <span data-start="745.559" data-end="750.309">one thing that I want you to take away from this talk is that modern web toolkits are</span> <span data-start="750.309" data-end="759.99">transforming away into something like a compiler where instead of compiling your into native</span> <span data-start="759.99" data-end="764.879">code, it's going into a highly optimized version.</span> <span data-start="764.879" data-end="770.399">And I think this would mean taking an app and delivering the most optimized version</span> <span data-start="770.399" data-end="771.689">to your device.</span> <span data-start="771.689" data-end="779.529">This could be like delivering new ES6 builds, or transpiled ES5 builds and/or transitioning</span> <span data-start="779.529" data-end="784.509">from server-side rendering and client-side rendering based on the network speed detected.</span> <span data-start="784.509" data-end="791.72">But most importantly, these tools can decouple the file size.</span> <span data-start="791.72" data-end="798.16">If we can shift the complexity to our build tools rather than being these monolithic runtime</span> <span data-start="798.16" data-end="802.989">libraries, we can reduce this pressure to be simple.</span> </p>
<p><span data-start="802.989" data-end="808.769">So unfortunately I don't have that much time for you today but I wanted to highlight three</span> <span data-start="808.769" data-end="812.97">things that the teams behind React, Ember, and Angular are working on, in order to demonstrate</span> <span data-start="812.97" data-end="816.119">that these things are becoming mobile on compilers.</span> <span data-start="816.119" data-end="822.41">And so the first thing that I want to talk about is React, and also Prepack which is</span> <span data-start="822.41" data-end="827.72">an open source tool for optimizing JavaScript validation.</span> <span data-start="827.72" data-end="832.939">Prepack was released while on the plane on my plane to Berlin.</span> <span data-start="832.939" data-end="841.61">But it was definitely true, the Prepack website uses quite a bit of computer science terminology</span> <span data-start="841.61" data-end="843.949">to explain what it's doing.</span> <span data-start="843.949" data-end="850.579">It's genuinely exciting and novel but you don't need to understand heap serialization</span> <span data-start="850.579" data-end="856.449">to understand why Prepack is cool for optimizing web apps.</span> </p>
<p><span data-start="856.449" data-end="863.86">So to understand why Prepack is school, let's see how something like a Rollup works.</span> <span data-start="863.86" data-end="869.569">It starts by analyzing which file it imports.</span> <span data-start="869.569" data-end="872.649">For each of those files.</span> <span data-start="872.649" data-end="877.48">Once it's analyzed the entire graph, it builds a new JavaScript file that includes just the</span> <span data-start="877.48" data-end="883.86">modules that were actually used.</span> <span data-start="883.86" data-end="895.73">And once  — </span> <span data-start="895.73" data-end="897.989">the final output is on the right.</span> <span data-start="897.989" data-end="902.199">Everything we've imported is inlined right into that file and modules that aren't imported</span> <span data-start="902.199" data-end="905.069">with excluded.</span> <span data-start="905.069" data-end="909.17">This gives us smaller files by eliminating the files that we don't actually use.</span> <span data-start="909.17" data-end="911.209">But it's not just modules.</span> <span data-start="911.209" data-end="916.47">Rollup can do other things if it sees things that we didn't use.</span> </p>
<p><span data-start="916.47" data-end="925.259">Notice that we've added a new class to animal.js, that's because Rollup is smart enough not</span> <span data-start="925.259" data-end="938.899">to include the feral animal class</span> <span data-start="938.899" data-end="943.6">static analysis just means figuring out things about how a program will run without actually</span> <span data-start="943.6" data-end="944.92">having to run it.</span> <span data-start="944.92" data-end="949.25">Rollup isn't running your code, it's just scanning to figure out what gets imported</span> <span data-start="949.25" data-end="951.369">and what gets exported.</span> <span data-start="951.369" data-end="958.149">And modules don't work inside of conditionals so it knows with 100% certainty.</span> </p>
<p><span data-start="958.149" data-end="962.67">That's roll-up.</span> <span data-start="962.67" data-end="964.819">Let's take a look at V8.</span> <span data-start="964.819" data-end="970.209">Specifically, I mean, any JavaScript virtual mean but we'll look at V8 specifically.</span> <span data-start="970.209" data-end="972.35">V8 can't help you with file size.</span> <span data-start="972.35" data-end="978.119">By definition, it has to have downloaded the JavaScript file already but it can help with</span> <span data-start="978.119" data-end="980.079">making your code faster.</span> <span data-start="980.079" data-end="985.22">So this is a high level view of the architecture, V8 and there's three major components.</span> </p>
<p><span data-start="985.22" data-end="988.42">I think there are V8 people here so please forgive me if I get anything wrong.</span> <span data-start="988.42" data-end="993.089">So the parser which turns your JavaScript into the instruction, and then the interpreter</span> <span data-start="993.089" data-end="999.389">ignition which evaluates your JavaScript and then the Turbofan which turns your JavaScript</span> <span data-start="999.389" data-end="1007.619">into something more time to generate but it can run at truly ridiculous speeds.</span> <span data-start="1007.619" data-end="1014.98">And as your program executes, it keeps track of how they're run and based on this information</span> <span data-start="1014.98" data-end="1027.04">it will ask Turbo fan to make optimized versions of your that it thinks it will make it run</span> <span data-start="1027.04" data-end="1028.04">faster.</span> <span data-start="1028.04" data-end="1031.64">Not running it JavaScript probably would be considered a bug because because it relies</span> <span data-start="1031.64" data-end="1036.86">on how the program actually runs, you have to use the unoptimized code for a while until</span> <span data-start="1036.86" data-end="1043.089">V8 can make discussions and that that means that every user pays that cost even though</span> <span data-start="1043.089" data-end="1046.909">the ended result is more or less the same for everyone.</span> <span data-start="1046.909" data-end="1054.539">This is the tension that we have with static analysis and dynamic analysis you pay the</span> <span data-start="1054.539" data-end="1059.97">cost once and all your users benefit but static analysis can only get you so far because you</span> <span data-start="1059.97" data-end="1063.62">can only perform optimizations you're 100% sure about.</span> <span data-start="1063.62" data-end="1068.549">If the module might get use, Rollup can't use it because if it guesses wrong, the app</span> <span data-start="1068.549" data-end="1069.549">breaks.</span> </p>
<p><span data-start="1069.549" data-end="1072.87">Information about the runtime analysis can collect information about how the program</span> <span data-start="1072.87" data-end="1077.28">actually runs so they don't have to guess but requiring the program to run in order</span> <span data-start="1077.28" data-end="1084.45">to optimize it is a bit of a catch-22.</span> <span data-start="1084.45" data-end="1087.931">And then that's the opposite of what we want on the web where things typically want to</span> <span data-start="1087.931" data-end="1089.08">feel instant.</span> </p>
<p><span data-start="1089.08" data-end="1090.84">So that's what makes Prepack so cool.</span> <span data-start="1090.84" data-end="1093.59">What it does is actually run you are why code.</span> <span data-start="1093.59" data-end="1098.779">Similar to V8, it's an actual JavaScript virtual machine but rather than running apps, though,</span> <span data-start="1098.779" data-end="1104.96">it runs at build time and it reverse-engineers a version that's faster for your JavaScript</span> <span data-start="1104.96" data-end="1110.08">to execute than the first time.</span> <span data-start="1110.08" data-end="1115">So this whole thing is a talk into itself and I'm still digesting how it works internally</span> <span data-start="1115" data-end="1116.72">but let's just take a quick look at how it works.</span> </p>
<p><span data-start="1116.72" data-end="1122.21">I know I showed an example also put so imagine we're writing a library that prints the data</span> <span data-start="1122.21" data-end="1130.73">of JSConf EU, so publish  —  so if we run this through Prepack, you can see that it's turned</span> <span data-start="1130.73" data-end="1137.26">it you will into a string literal.</span> <span data-start="1137.26" data-end="1142.07">But instead of every user having to allocate a data object, parse a date string, initialize</span> <span data-start="1142.07" data-end="1150.61">a date object, and generating an ISO-601 string, and this is a contrived example.</span> <span data-start="1150.61" data-end="1156.82">And each of these small stakes may start to really add up in codebase the sizes Ember,</span> <span data-start="1156.82" data-end="1158.1">Angular, or React.</span> <span data-start="1158.1" data-end="1164.22">And I'm hearing a rumor that Jason Miller is going to release something called pre-Prepack,</span> <span data-start="1164.22" data-end="1170.55">that does everything that Prepack does in only 600 bytes of code.</span> </p>
<p><span data-start="1170.55" data-end="1183.2">So let's look at Angular, it's on Typescript that's just a subset of JavaScript, and those</span> <span data-start="1183.2" data-end="1192.519">types makes refactoring much easier as your project grows, but to me, the most exciting</span> <span data-start="1192.519" data-end="1199.82">and underappreciated reasons for is the potential for using that type information to more aggressively</span> <span data-start="1199.82" data-end="1201.51">minify your builds.</span> <span data-start="1201.51" data-end="1211.87">So  in this examiner we've renamed this variable,</span> <span data-start="1211.87" data-end="1217.46">fruit, to be called o and because these variables inside this go nowhere outside of this function</span> <span data-start="1217.46" data-end="1221.799">can access it, so whatever we call inside it is arbitrary.</span> <span data-start="1221.799" data-end="1225.78">Let's change this example a little bit and instead of making fruit a string, we make</span> <span data-start="1225.78" data-end="1231.779">it an object with name property and even though the variable fruit gets mangled, the property</span> <span data-start="1231.779" data-end="1235.36">name stays the same.</span> <span data-start="1235.36" data-end="1244.73">Now uglify.js has a property  —   renaming properties can break things.</span> </p>
<p><span data-start="1244.73" data-end="1248.37">In fact, the readme of uglify says, note, this will probably break your code, which</span> <span data-start="1248.37" data-end="1252.33">doesn't instill a lot of confidence.</span> <span data-start="1252.33" data-end="1259.059">So, for example, if we have an element and we change its onclick property, if that gets</span> <span data-start="1259.059" data-end="1262.11">renamed to something else, then this is just going to fail silently.</span> <span data-start="1262.11" data-end="1266.559">That click handler that we thought we were handling just doesn't exist anymore.</span> <span data-start="1266.559" data-end="1272.139">And similarly if we look at a component, this is a React component, for example, there are</span> <span data-start="1272.139" data-end="1278.299">parts of this object that are private and then there are other things that are public,</span> <span data-start="1278.299" data-end="1281.929">meaning things like a library or a platform rely on it.</span> <span data-start="1281.929" data-end="1285.88">Really what we want to do is mangle the private stuff but make sure that the library can keep</span> <span data-start="1285.88" data-end="1288.82">using the public stuff and there's good news.</span> <span data-start="1288.82" data-end="1293.299">Google's closure compiler already supports this advanced minification for JavaScript.</span> <span data-start="1293.299" data-end="1300.33">Unfortunately, it requires an notating types with js style comments and  —  approximately</span> <span data-start="1300.33" data-end="1304.529">seven people on the planet outside of Google have actually gotten this to work.</span> </p>
<p><span data-start="1304.529" data-end="1311.27">Now the Angular team has released an amazing tool called Sickle that translates a type</span> <span data-start="1311.27" data-end="1319.2">script project who the bizarre format that compiler, and because Angular is written in</span> <span data-start="1319.2" data-end="1329.36">Typescript two, closure can do some advanced minification.</span> <span data-start="1329.36" data-end="1341.899">The idea it more accessible to broader world, and integrating into this NGCLI by default</span> <span data-start="1341.899" data-end="1348.82">I think would make a huge impact into basically every Angular app.</span> <span data-start="1348.82" data-end="1355.34">So lastly I just want to talk about Ember, and specifically Glimmer, which is the rendering</span> <span data-start="1355.34" data-end="1358.409">engineer in Ember, and also the library that we extracted to be used standalone outside</span> <span data-start="1358.409" data-end="1360.63">of Ember a month or two ago.</span> <span data-start="1360.63" data-end="1366.7">So now in thinking about the rendering engine is there's three things to consider.</span> <span data-start="1366.7" data-end="1374">How fast does it take to load.</span> <span data-start="1374" data-end="1378.399">But then once you have something within reasonable bound of time, you want to look at how long</span> <span data-start="1378.399" data-end="1381.559">does it take to render a component for the first time when you have to create brand-new</span> <span data-start="1381.559" data-end="1382.87">DOM elements.</span> <span data-start="1382.87" data-end="1387.08">And third, how long does it take to rerender a component updating its existing DOM elements</span> <span data-start="1387.08" data-end="1390.149">instead of replacing them when the data backing that component changes.</span> </p>
<p><span data-start="1390.149" data-end="1391.149">Okay.</span> <span data-start="1391.149" data-end="1393.149">So who remembers this app?</span> <span data-start="1393.149" data-end="1396.82">Yeah, the db bain of my existence.</span> <span data-start="1396.82" data-end="1406.509">This is Ryan Florence's dbmon demo app, which heights the differential app and everyone</span> <span data-start="1406.509" data-end="1408.71">was competing to have the fastest score on it.</span> <span data-start="1408.71" data-end="1413.37">And it's all anyone ever focused on but then more recently the community's focus has been</span> <span data-start="1413.37" data-end="1418.49">on initial load times as people have grappled with how we deal with these low-end phones</span> <span data-start="1418.49" data-end="1420.63">and slow networks.</span> <span data-start="1420.63" data-end="1424.429">And the tricky thing is trying to find the sweet spot that balances between optimizing</span> <span data-start="1424.429" data-end="1426.95">the first render and optimizing rerenders.</span> <span data-start="1426.95" data-end="1429.49">Fundamentally, this is an issue of bookkeeping.</span> <span data-start="1429.49" data-end="1433.659">The more bookkeeping you do in the initial render to make subsequent renders faster,</span> <span data-start="1433.659" data-end="1436.409">the longer that that render is going to take.</span> <span data-start="1436.409" data-end="1440.98">So consider a render using Bootstrap markup on VirtualJS.</span> <span data-start="1440.98" data-end="1444.28">That makes a lot of sense.</span> <span data-start="1444.28" data-end="1449.25">This is basically just instructions for how to create the real DOM but if a single part</span> <span data-start="1449.25" data-end="1454.049">changes we have to run the entire render function again and that's quite a few allocations of</span> <span data-start="1454.049" data-end="1457.87">virtual DOM objects, not to mention that once you have them, you have to then do this diffing</span> <span data-start="1457.87" data-end="1463.539">step to kind of reverse-engineer what changed between last render and this render.</span> </p>
<p><span data-start="1463.539" data-end="1469.399">So the performance cost is probably negligible but in larger apps you can see how it starts</span> <span data-start="1469.399" data-end="1471.22">to add up.</span> <span data-start="1471.22" data-end="1479.95">And in Glimmer we use Handlebar templates and success how do we compile them into.</span> <span data-start="1479.95" data-end="1486.05">Come Ember's history, this answer changed three times, first it was strings and then</span> <span data-start="1486.05" data-end="1494.179">DOM, and into with glimmer, byte code.</span> <span data-start="1494.179" data-end="1503.289">[Inaudible], and  a virtual machine that runs that compiled</span> <span data-start="1503.289" data-end="1504.289">code.</span> </p>
<p><span data-start="1504.289" data-end="1507.021">So in Glimmer we compiled this template into a JSON object that looks like this.</span> <span data-start="1507.021" data-end="1511.25">Now, this probably doesn't book meaningful to you but what this object represents is</span> <span data-start="1511.25" data-end="1521.929">a series of op codes, or instructions how to build  —  into integers, string literals,</span> <span data-start="1521.929" data-end="1524.83">so parsing is fast and memory consumption is much lower.</span> </p>
<p><span data-start="1524.83" data-end="1529.75">When we landed Glimmer in ember 2.10, many apps found their template sizes dropped from</span> <span data-start="1529.75" data-end="1531.46">75-85% which is significant.</span> <span data-start="1531.46" data-end="1539.529">Now if you look closely as 30 but we use integers to represent instructions for compactness</span> <span data-start="1539.529" data-end="1547.039">and for certainly V8 operations but if we were to operate it in a hypothetical linearized</span> <span data-start="1547.039" data-end="1552.02">set of instructions so when we take those instructions and we execute them on top of</span> <span data-start="1552.02" data-end="1555.74">the Glimmer VM, it looks a little bit something like this.</span> <span data-start="1555.74" data-end="1559.299">We have an instruction pointer that just goes through this sequence and so this is going</span> <span data-start="1559.299" data-end="1565">to build an li element and then we're going to move on and run the static add p code and</span> <span data-start="1565" data-end="1568.49">that's going to set the attribute and then we're going to add another static attribute</span> <span data-start="1568.49" data-end="1572.379">which is the active class and then that's the whole template and then we're going to</span> <span data-start="1572.379" data-end="1576.19">flush the element which tells Glimmer that this is something to go to put in the DOM.</span> <span data-start="1576.19" data-end="1580.71">Now this isn't this is an easy example because this is static.</span> <span data-start="1580.71" data-end="1587.49">But what I want mentioned yet is the Glimmer VM is made up of two VMs.</span> <span data-start="1587.49" data-end="1596.36">One is constructing DOM initial on initial render and the other is for updates.</span> </p>
<p><span data-start="1596.36" data-end="1600.049">So this is the program for initially rendering this template.</span> <span data-start="1600.049" data-end="1602.659">Now we could run this again for updates, right?</span> <span data-start="1602.659" data-end="1606.759">But there's a lot of static content in here and spending time executing op codes for static</span> <span data-start="1606.759" data-end="1609.7">content we know hasn't changed isn't a good use of time.</span> <span data-start="1609.7" data-end="1616.07">In fact, we just want to focus on this dynamic part and the way that we optimize is through</span> <span data-start="1616.07" data-end="1618.639">a technique called partial evaluation.</span> </p>
<p><span data-start="1618.639" data-end="1623.8">And partial evaluation simply means to generate an optimize program by evaluating an initial</span> <span data-start="1623.8" data-end="1624.8">program.</span> <span data-start="1624.8" data-end="1628.09">And we use this technique to generate it automatically.</span> <span data-start="1628.09" data-end="1635.99">So initially as the initial program is being run, we're generating a more optimized version</span> <span data-start="1635.99" data-end="1637.37">when the data changes.</span> </p>
<p><span data-start="1637.37" data-end="1641.73">Essentially these operations in the initial rendering program are responsible for generating</span> <span data-start="1641.73" data-end="1643.73">their own subsequent code.</span> <span data-start="1643.73" data-end="1646.99">So the way this works is that we're going to go through our op code for the initial</span> <span data-start="1646.99" data-end="1650.999">render as before that's going to open a new div and we're going to set some status traits</span> <span data-start="1650.999" data-end="1658.429">on this, so in addition to appending that text content to the DOM, we're also going</span> <span data-start="1658.429" data-end="1663.809">to generate an updating code which is to update that content and it's going to include a reference</span> <span data-start="1663.809" data-end="1667.35">to what value what you were putting in it as well as a reference to the text value that</span> <span data-start="1667.35" data-end="1670.36">you created.</span> </p>
<p><span data-start="1670.36" data-end="1674.539">Now when that data value behind that component updates instead of going that whole process</span> <span data-start="1674.539" data-end="1678.929">again, all we have to do is evaluate our highly optimized updating program which is just going</span> <span data-start="1678.929" data-end="1682.45">to take the old data out of the DOM and update it.</span> <span data-start="1682.45" data-end="1685.389">And you can think of it doing as something  —  it's a little more complex than this  —  but</span> <span data-start="1685.389" data-end="1694.28">you can think of why it ends up being fast because it needs  —  notice that basically</span> <span data-start="1694.28" data-end="1699.47">all the rendering library benchmarks only tested pure dynamic content but it's not representative</span> <span data-start="1699.47" data-end="1703.33">of apps in the world.</span> <span data-start="1703.33" data-end="1708.409">So we created benchmarks that had a mix of both static and dynamic content and what we</span> <span data-start="1708.409" data-end="1714.909">noticed was that initial I'm not putting the other names here because it's not a competition.</span> <span data-start="1714.909" data-end="1717.96">I think I wanted to show that we're basically in the same ballpark.</span> <span data-start="1717.96" data-end="1722.929">However, when we moved to updating other performance what we noticed was that it seems like having</span> <span data-start="1722.929" data-end="1729.33">this optimized bytecode makes a big difference, which can make a big difference, especially</span> <span data-start="1729.33" data-end="1730.669">on lower end phones.</span> </p>
<p><span data-start="1730.669" data-end="1733.85">So today we've talked about three popular frameworks and things that they're doing to</span> <span data-start="1733.85" data-end="1741.009">improve performance on mobile devices.</span> <span data-start="1741.009" data-end="1751.289">It's  —  there's an exciting trend towards more sophisticated tools that can analyze</span> <span data-start="1751.289" data-end="1756.24">your app, perform optimizations that can be time consuming, practically impossible to</span> <span data-start="1756.24" data-end="1757.559">do by hand.</span> <span data-start="1757.559" data-end="1763.149">Best of all code that clearly conveys intent to other humans has a funny way of conveying</span> <span data-start="1763.149" data-end="1768.21">the intent for optimizing compilers, too, p so in that we have be the idea that build</span> <span data-start="1768.21" data-end="1775.45">tools are  —  sophisticated build process of a modern web app.</span> <span data-start="1775.45" data-end="1779.159">This morning, Addy showed a bunch of techniques for measuring and improving the performance</span> <span data-start="1779.159" data-end="1780.6">for your web apps.</span> <span data-start="1780.6" data-end="1785.36">That's awesome information but not everyone can be Addy standing over them and reminding</span> <span data-start="1785.36" data-end="1790.809">them to take care of performance and spend time learning about these techniques so I'm</span> <span data-start="1790.809" data-end="1796.129">incredibly excited about a community that can help democratize and commoditize that</span> <span data-start="1796.129" data-end="1800.86">performance know-how.</span> </p>
<p><span data-start="1800.86" data-end="1806.34">So the best approach of approaching frameworks and compilers isn't that they just help today's</span> <span data-start="1806.34" data-end="1809.94">by reducing the cost of code, we can build better apps that don't collapse under the</span> <span data-start="1809.94" data-end="1820.679">weight of their own complexity.</span> <span data-start="1820.679" data-end="1823.46">This is a very exciting time to be a JavaScript developer.</span> <span data-start="1823.46" data-end="1828.34">I for one am really looking forward to web apps that load instantly, work offline, feel</span> <span data-start="1828.34" data-end="1830.24">great to use for everyone.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
