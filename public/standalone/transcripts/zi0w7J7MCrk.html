<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>zi0w7J7MCrk</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/zi0w7J7MCrk?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="21.47" data-end="30.7"Audience member: I'm going to talk about three of my things, Unicode, JavaScript and gangster rap. I work</span> <span data-start="30.7" data-end="38.079">for software developer in software relations, I like to collaborate on Open Source projects,</span> <span data-start="38.079" data-end="45.871">and one example of such a project is Punycode, it's part of node G S, it ships, if you can</span> <span data-start="45.871" data-end="58">want to play around, just require it,you didn't have to MPN install anything T puny\h‑‑</span> <span data-start="58" data-end="67.14">internationalized domain name into pure ASCII forms, so I want to write a JavaScript implementation</span> <span data-start="67.14" data-end="73.15">of, that I thought it would be really simple because the algorithm is well defined, I figured</span> </p>
<p><span data-start="73.15" data-end="78.83">I would port that into JavaScript and that would be it. But while I was working on this</span> <span data-start="78.83" data-end="84">actual emme opinionation I ran into lots of new things, things I didn't know about JavaScripts</span> <span data-start="84" data-end="86.55">and that's what this talk will be about, basically.</span> <span data-start="86.55" data-end="93.86">But, first, does anyone know who this guy is? Of yeah, of course, everyone knows it's</span> <span data-start="93.86" data-end="101.17">Jay Ze. He decided to write a JavaScript program once and instead he ended up writing a song</span> <span data-start="101.17" data-end="104.72">about his frustration with the language, it you might have heard of it before, it's called</span> <span data-start="104.72" data-end="114.37">99 problems, don't get me wrong I love JavaScript, just like with any other programming language,</span> <span data-start="114.37" data-end="120.07">if you don't know language by heart, and really who does, you're going to be surprised, that's</span> <span data-start="120.07" data-end="128.369">just what life as programmer is like, that's why we have PHPWTF.org, list it is weird quirk</span> <span data-start="128.369" data-end="137.47">in PHP and similarly WTF.com for JavaScriptful everything on these web sides can be explained</span> <span data-start="137.47" data-end="143.48">if you look at the specification, the PHP, the documentation or implementationsh even</span> <span data-start="143.48" data-end="148.25">then if particular behavior of language is confusing to a lot of people, that is a bit</span> <span data-start="148.25" data-end="154.84">of a problem, so I think the way JavaScript handles Unicode is well, very surprising to</span> <span data-start="154.84" data-end="159.65">say the least. But before we get into that, let's talk about Unicode itself, just to make</span> <span data-start="159.65" data-end="165.23">sure we're all on the same page. I'm going to tell you the absolute minimum about Unicode</span> <span data-start="165.23" data-end="170.65">in order to work with strings in JavaScript correctly and nothing else. It's easiest to</span> <span data-start="170.65" data-end="177.31">think of Unicode of a database that matches any symbol you can think of to a unique number,</span> <span data-start="177.31" data-end="183.78">the code points and a you cane unique con noncal name, it's easy to refer to any specific</span> <span data-start="183.78" data-end="189.39">symbol by using the unique name or code point, you don't have to use the symbol itself to</span> <span data-start="189.39" data-end="197.68">talk about the symbol. For example, Unicode map it is Latin capital letter A to U + 0041,</span> <span data-start="197.68" data-end="207.61">this is a hexadecimal number, usually four code unit codes like this\h‑‑ now, another</span> <span data-start="207.61" data-end="212.84">example is the letter\h‑‑ Latin small letter A, a different letter all together,</span> <span data-start="212.84" data-end="219.62">it gets it's own code point and it's own con noncal name's a lot of stuff in Unicode, each</span> <span data-start="219.62" data-end="224.75">symbol gets it's own code point's a lot of weird stuff, there's a snow man symbol in</span> </p>
<p><span data-start="224.75" data-end="229.739">Unicode, not sure why wow would you need it.</span> <span data-start="229.739" data-end="234.459">There's everyone's favorite character the pile of Poo, that's the con noncal name for</span> <span data-start="234.459" data-end="244.069">the symbol. You can see it's U + 1F 4A 9, you may be wondering at this point how many</span> <span data-start="244.069" data-end="249.5">code points are there what's the highest possible code point value in Unicode, well the possible</span> <span data-start="249.5" data-end="258.739">code point value from 0 to 10FFFF that's over one million possible symbols, to keep things</span> <span data-start="258.739" data-end="264.31">organized Unicode devised this range of code points into 17 planes that consist of about</span> <span data-start="264.31" data-end="270.659">65,000 code points each. The first of these plane s is called the BMP, the most important</span> <span data-start="270.659" data-end="274.87">pine one because it contains all the most commonly used symbols, most of the time you</span> <span data-start="274.87" data-end="285.91">don't need codes outside of BMP to write a text code with English, Spanish or German,</span> <span data-start="285.91" data-end="291.199">just like any other plane it contains about 65000 symbols, there's a grouping for the</span> <span data-start="291.199" data-end="297.54">other planes, they're called supple men tear planes, totals up to about one million other</span> <span data-start="297.54" data-end="303.79">code points, the vast majority of the Unicode code points base, these are called astral</span> <span data-start="303.79" data-end="313.8">planes or sup men tear plane,\h‑‑ supple men tear planes. Now, astral code points</span> <span data-start="313.8" data-end="318.24">are easy to recognize because when ever you need more than four hexadecimal digits to</span> <span data-start="318.24" data-end="324.87">represent that, it means it's an ascentral code point. So, now that we have basic understanding</span> <span data-start="324.87" data-end="335.08">of Unicode, let's see how it applies to JavaScript springs, starts with back clear X two hexadecimal</span> <span data-start="335.08" data-end="342.53">digit, grow know a bit about Unicode, you know they refer oUnicode code points, another</span> <span data-start="342.53" data-end="348.85">way to represent the string ABC in all caps, this is the way to represent the stringabc</span> <span data-start="348.85" data-end="354.38">in lower case, this is useful because you have weird characters that are maybe hard</span> <span data-start="354.38" data-end="358.43">to type on your keyboard or avoid encoding issues, if you save the file with different</span> <span data-start="358.43" data-end="365.49">encoding you can use escape sequences to represent these characters, this is useful but we're</span> <span data-start="365.49" data-end="374.65">still limited to two hexadecimal, which means can only be used up toFF.</span> </p>
<p><span data-start="374.65" data-end="380.55">There's a lot of other escapes, call Unicode, starts with back slash followed by U and four</span> <span data-start="380.55" data-end="390.65">hexadecimal digit, we can make the same exescapes but for four\h‑‑ like 2661 which is the</span> <span data-start="390.65" data-end="397.47">code for white heart symbol, this makes it possible to escape all these code points all</span> <span data-start="397.47" data-end="402.731">those in the BMP, actually. But, what about all the other planes, what about those ascentral</span> <span data-start="402.731" data-end="409.771">code points we need more than four hexadecimal digitter for them how do we escape them. What</span> <span data-start="409.771" data-end="416.449">about the pile ofpoo and other equally important ascentral symbols of course. We can actually</span> <span data-start="416.449" data-end="423.4">escape those, it's kind of sort of come plait. I will, in fact be really easy because you</span> <span data-start="423.4" data-end="429.86">have these things called Unicode code point escapes, back clash you followed by braces</span> <span data-start="429.86" data-end="437.729">you groups six hexadecimal digit, enough to represent any Unicode. You can simply escape</span> <span data-start="437.729" data-end="443.38">any Unicode symbol based on it's code point, it couldn't be easier, if you need something</span> <span data-start="443.38" data-end="451.12">that works to day in ESF, the unfortunate solution is to use surrogate pairs, each escape</span> <span data-start="451.12" data-end="457.11">represents the code point of a surrogate half, only when that two halves combine together</span> <span data-start="457.11" data-end="466.25">it form it is symbol. The surrogate code points they don't look like anything like the original</span> <span data-start="466.25" data-end="474.55">code point. Now there are formula that you can use based on a given astral code point.</span> </p>
<p><span data-start="474.55" data-end="480.9">Here's a JavaScript implementation, you don't have to learn by heart, you know this exists</span> <span data-start="480.9" data-end="487.35">if want to deal with string in javaScripts. Any way the whole concept of using the escape</span> <span data-start="487.35" data-end="494.65">to represent BMP and two separate escapes is a bit confusing and has a lot of annoying</span> <span data-start="494.65" data-end="500.38">consequences throughout the language. For example say you want to count number of symbol</span> <span data-start="500.38" data-end="507.289">in a string, my first thought would be to use the strings length property. In these,</span> <span data-start="507.289" data-end="514.779">indeed it reflects number of character in the strick, if you escape the character in</span> <span data-start="514.779" data-end="520.019">thestring and count the number of escape sequences we see there's only one escape sequences in</span> <span data-start="520.019" data-end="527.11">each of these strings, however, let's try some other similar looking characters. This</span> <span data-start="527.11" data-end="533.48">is the mathematical bold capital letter A, and mathematical bold B, they're different</span> <span data-start="533.48" data-end="538.47">code point, in this case they're ascentral code points because of that they have a length</span> <span data-start="538.47" data-end="543.329">of two in JavaScript rather than one even though there's only a single symbol there.</span> </p>
<p><span data-start="543.329" data-end="547.8">What JavaScript does it kind of exposes these surrogate halves as if they were separate</span> <span data-start="547.8" data-end="553.989">characters, and this is really confusing because we as human beings we think in terms of Unicode</span> <span data-start="553.989" data-end="564.619">characters or even Grapimeems, of and there's a very obvious joke to be made here, instead</span> <span data-start="564.619" data-end="569.119">I'm going to show you a real world example where this can actually break things, this</span> <span data-start="569.119" data-end="575.22">is Twitter while ago, it allows 140 characters per tweet, their back end doesn't mind what</span> <span data-start="575.22" data-end="581.61">symbol, ascentral symbols, they all count as one. Now, at some point they had a bug</span> <span data-start="581.61" data-end="586.61">in their front end and the JavaScript similarly read out the string length without accounting</span> <span data-start="586.61" data-end="594.67">for surrogate pairs, it would decrees by steps of two with each astral, it wasn't possible</span> <span data-start="594.67" data-end="604.49">to tweet more than 70 piles of Poo at a time, it was absolutely terrible. Accountable.J,</span> <span data-start="604.49" data-end="608.959">counts the number of words, letter, paragraphs and displies the numbers elsewhere\h‑‑</span> <span data-start="608.959" data-end="616.73">displays the numbers elsewhere on the page. I entered a pile of Poo and counted it as</span> <span data-start="616.73" data-end="621.6">two characters instead of one, these are just some example, this is an honest mistake the</span> <span data-start="621.6" data-end="628.459">make because it's surprising, if you're write ago JavaScript library that involves strings</span> <span data-start="628.459" data-end="633.559">whatsoever in JavaScript, you have to make it work with all symbols not just those in</span> <span data-start="633.559" data-end="638.57">the BMP, sooner or later one of your users is going to enter one of those Emoji or other</span> <span data-start="638.57" data-end="647.629">ascentral similar G. way to verify is to test it with centrals symbols, throw some piles</span> <span data-start="647.629" data-end="652.04">ofpoo in there and see what happens. This is what it felt like to enter that pile of</span> </p>
<p><span data-start="652.04" data-end="660.839">Poo,I just kind of new that something would likely go wrong, you know. So\h‑‑ yeah.</span> <span data-start="660.839" data-end="665.759">That's not good. Getting back to our question, how can it be done, how can we accurately</span> <span data-start="665.759" data-end="671.579">count number of symbols in the Java string or number of code points. One thing you could</span> <span data-start="671.579" data-end="682.11">use is a third party library like Punycoe. The USC 2 decode method takes a string and</span> <span data-start="682.11" data-end="688.68">returns an away of code points one for each point, you then get the length of the resulting</span> <span data-start="688.68" data-end="692.91">array rather thanstring directly this gives a more accurate result.</span> <span data-start="692.91" data-end="698.19">No mat whareyou're doing you is to account for surrogate halfs in JavaScript when you're</span> <span data-start="698.19" data-end="704.241">dealing with strings like that, you don't have a choice, you have to do this. There's</span> <span data-start="704.241" data-end="710.279">a cementlator solution for this, you can use array.from pass in the string and that would</span> <span data-start="710.279" data-end="715.43">return an array of string, one for each symbol in an array of string, this would use the</span> <span data-start="715.43" data-end="722.369">ES 6 string iter raptor, and the it aerator deals with whole code points when ever possible,</span> <span data-start="722.369" data-end="727.76">so you don't have to deal with the surrogates yourself anymore. This is not the most efficient</span> <span data-start="727.76" data-end="733.1">solution to this problem, you could use a regular expression if you need to count the</span> <span data-start="733.1" data-end="739.279">regular characters with\h‑‑ but we'll get to that later. Now, I've made a tool that</span> <span data-start="739.279" data-end="745.089">takes any string as input and shows the escape e Wednesday within the string, so it's kind</span> <span data-start="745.089" data-end="751.72">of like a Hexdom, which is sometimes more useful. Now, with this tool, it's really easy</span> <span data-start="751.72" data-end="756.459">to tell which Unicode characters the string contains exactly, even if the symbols are</span> <span data-start="756.459" data-end="765.769">non‑printable or just wide space. Now, depending on your use case,it's not that simple, we</span> <span data-start="765.769" data-end="769.85">know how to count code points correctly, but if we're being really pen den tack counting</span> <span data-start="769.85" data-end="778.239">the symbols in a string is different. Visually there's no way to tell that it's different.</span> </p>
<p><span data-start="778.239" data-end="783.85">What's going on, I took two strings and copied them into the tool I just showed you this</span> <span data-start="783.85" data-end="788.989">is what I got. The first string using the string F 1 for the end character with the\h‑‑</span> <span data-start="788.989" data-end="797.859">N character with theTilde, and the second one used U 0303 the code for combining Tilde,</span> <span data-start="797.859" data-end="805.329">they just get applied to previous symbol, we don't care about that, if want to count</span> <span data-start="805.329" data-end="813.279">the number of symbol in the string we expect six, so how can we make that happen. The answer</span> <span data-start="813.279" data-end="819.139">S. we can use Unicode normallytion, another new feature in ES 6 it ships to day in home</span> <span data-start="819.139" data-end="829.04">and Opera, if you want to use it in other browsers, use a poly fill called Unorm. Before</span> <span data-start="829.04" data-end="834.439">you account for these ascentral symbols you called normalize on the stream, pass in the</span> <span data-start="834.439" data-end="840.339">normallytion form you would like to use, this effectively gets rid of the look alike symbols.</span> <span data-start="840.339" data-end="846.499">Now, is this solution perfect, well, it kind of depends, if you need to support stuff like</span> <span data-start="846.499" data-end="853.669">that, if which case I count nine different symbols, this is basically a string with lots</span> <span data-start="853.669" data-end="858.009">of combining marks that get applied to the previous character what's why it looks weird.</span> <span data-start="858.009" data-end="869.569">I count ninety, but our Pendanticl count is 16, if you need to support\h‑‑ it beast</span> <span data-start="869.569" data-end="876.47">to use a regular expression that removes the combining marks and then gets lengths just</span> <span data-start="876.47" data-end="883.399">like question before. We'll get to that later. Another example is reversing a string? JavaScript,</span> <span data-start="883.399" data-end="888.029">it seems very simple, if you Google for it you'll end up a solution that looks like this,</span> <span data-start="888.029" data-end="895.449">take the string, split it into an array, refers to array and put it back together into a string.</span> </p>
<p><span data-start="895.449" data-end="908.559">And indeed this reverses the string Abc correctly, let's try Manana, here we're reversing again,</span> <span data-start="908.559" data-end="914.549">reverse function seems to work as expected, if we try to other Mana where the N and Tilde</span> <span data-start="914.549" data-end="922.459">are two separate characters we see it gets applied to letter "A" ande instead of "N,"</span> <span data-start="922.459" data-end="930.119">also if we try it on an ascentral symbol like the pile ofpoo we know they consist of two</span> <span data-start="930.119" data-end="935.819">surrogate halves, the first result is completely unusable the surrogate halves are not in order</span> <span data-start="935.819" data-end="942.959">this is data loss. Reversing a string becomes really strictly if you need full Unicode support</span> <span data-start="942.959" data-end="949.269">in JavaScript. Lucky for us a brilliant computer scientist calledMissy Elliott came up with</span> <span data-start="949.269" data-end="958.67">a brilliant algorithm that accounts for this issue. It goes, I put my Thng down flip it,</span> <span data-start="958.67" data-end="965.629">and reverse it. Indeed swiping the position with the symbol they belong to, as well as</span> <span data-start="965.629" data-end="970.11">reversing any surrogate pairs before further processing these strings all the issues are</span> <span data-start="970.11" data-end="973.989">avoided successfully, thank you Missy.</span> </p>
<p><span data-start="973.989" data-end="981.019">Here's a JavaScript\h‑‑ S reverse, if you need trovers a string in JavaScript, feel</span> <span data-start="981.019" data-end="987.551">free to use it. These were some examples and this behavior really affects all the string</span> <span data-start="987.551" data-end="996.379">methods too. It's everywhere. For example,string.fromcharcode allows you to use a string based on a Unicode,</span> <span data-start="996.379" data-end="1002.699">but it only works for BMP range, if you use it with an ascentral code, you'll get a different</span> <span data-start="1002.699" data-end="1017.11">result (Astral) you have to implement those former lists that I showed you earlier, you</span> <span data-start="1017.11" data-end="1022.699">could use a third‑party library, this is introducing dependency to create a string</span> <span data-start="1022.699" data-end="1028.799">out of a number which really shouldn't happen. Luckily in ES 6 there's a solution for this</span> <span data-start="1028.799" data-end="1041.13">in the form of a new method, Storm.fromCodePoin, this works properly including from Austria</span> <span data-start="1041.13" data-end="1048.47">symbols. Similar\h‑‑ if you use characterat to reSteve the first symbol in the string</span> <span data-start="1048.47" data-end="1052.11">containing the pile of Poo character you'll only get the first surrogate half instead</span> <span data-start="1052.11" data-end="1057.889">of the whole symbol is no solution for this inES 6 there, is a</span> <span data-start="1057.889" data-end="1064.33">proposal to add string.prototype.add which would do the same thing as character add it</span> <span data-start="1064.33" data-end="1072.93">would deal with full symbols instead of surrogate halves when ever possible. If you use character</span> <span data-start="1072.93" data-end="1076.899">code at to restreet the first code point or the first symbol in the string you'll get</span> <span data-start="1076.899" data-end="1082.82">the first symbol of the surrogate half rather than whole pile of Poo character, now, in</span> </p>
<p><span data-start="1082.82" data-end="1094.85">ES 6 there's a new method called string.pointAT, it deal was surrogate halfs when ever possible.</span> <span data-start="1094.85" data-end="1099.37">The links at the bottom they point to poly fills you start using today it works in every</span> <span data-start="1099.37" data-end="1105.429">browser that way. Now another example is you want to loop over every symbol in a string</span> <span data-start="1105.429" data-end="1111.549">and do something with each symbol you'd have to write a lot of boilerplate code just to</span> <span data-start="1111.549" data-end="1118.5">account for surrogate pairs to consider them as a single character. Now, in ES 6 this will</span> <span data-start="1118.5" data-end="1125.019">be much, much easier because you can just use for of this will use the new string iter</span> <span data-start="1125.019" data-end="1130.22">raptor, and this will deal with whole symbols instead of surrogate pairs automatically.</span> <span data-start="1130.22" data-end="1135.11">Now, this behavior affects pretty much all string methods so be really careful when you're</span> <span data-start="1135.11" data-end="1142.09">using them, really unfortunate, as 2PAC would say, that's just the way it is, some things</span> <span data-start="1142.09" data-end="1145.88">will never change.</span> <span data-start="1145.88" data-end="1152.44">Another similar problem lies with regular problems, so the dot operator in regular expressions</span> <span data-start="1152.44" data-end="1157.889">only matches a single character, because because JavaScript exposes surrogate halfs as separate</span> <span data-start="1157.889" data-end="1163.259">characters it won't ever match an Astral symbol, I would expect an answer of true here but</span> <span data-start="1163.259" data-end="1171.37">it's actually false. What regular expression can we use to much any Unicode symbol, any</span> <span data-start="1171.37" data-end="1177.21">ideas? Well, we can't use the.operator, as weave demonstrated that wouldn't match line</span> </p>
<p><span data-start="1177.21" data-end="1183.25">Riggs, we can fix that by doing something like, this match any character but wouldn't</span> <span data-start="1183.25" data-end="1186.49">match Stral symbol\h‑‑ Astral symbols, because as far as JavaScript concerned that</span> <span data-start="1186.49" data-end="1200.269">is two characters, what is the regular expression to match any Unicode point, like, this apparently.</span> <span data-start="1200.269" data-end="1205.48">Yeah .. so the first part of this regular expression matches any BMP symbol that does</span> <span data-start="1205.48" data-end="1210.49">not store a surrogate pair the second half matches a surrogate pair, in other words,</span> <span data-start="1210.49" data-end="1215.94">an astral symbol, this is not the type of regular expression you would enjoy writing</span> <span data-start="1215.94" data-end="1221.929">by hand, let alone maintaining it, I use JavaScript library to generate these for me, it's called</span> <span data-start="1221.929" data-end="1229.399">regenerate. Here I create a new instance, I add the range of all Unicode, then I call</span> <span data-start="1229.399" data-end="1236.25">two string that produces a string that can be used a expression literal I's supposed</span> <span data-start="1236.25" data-end="1241.98">to be used as part of a build script. Here east another example, a bit more advance.</span> </p>
<p><span data-start="1241.98" data-end="1247.6">Start with all Unicode points, remove a range of symbols based on their string values, then</span> <span data-start="1247.6" data-end="1254.95">remove a single symbol, then we call two string on that to turn that set into a regular expression.</span> <span data-start="1254.95" data-end="1259.97">And apparently that looks like this. So, once again, this is not a regular expression, you</span> <span data-start="1259.97" data-end="1265.321">would enjoy writing by hand or that you want to maintain, imagine having to adjust one</span> <span data-start="1265.321" data-end="1268.98">code point to that set and rewriting that whole thing, it would probably take a very</span> <span data-start="1268.98" data-end="1274.7">long time, it's much easier to change the five lines of code, write above the regular</span> <span data-start="1274.7" data-end="1279.37">expression, store that in a build script and run the build scrip again after you modify</span> <span data-start="1279.37" data-end="1285.03">et. Another example, say you need another expression that matches all Greek symbols</span> <span data-start="1285.03" data-end="1291.11">in the Unicode standard are BMP models that contain for each category,</span> <span data-start="1291.11" data-end="1297.25">script, block or property. If you combine these with regenerate it's easy to build complex</span> <span data-start="1297.25" data-end="1299.98">Unicode aware Unicode expression.</span> <span data-start="1299.98" data-end="1307.2">So I'm just requiring all the Greek symbol in Unicode 6.3.0 as an array than padsing</span> <span data-start="1307.2" data-end="1314">that to regenerate and turning that into a regular expression. You may have noticed I'm</span> <span data-start="1314" data-end="1320.41">using the data for Unicode 36‑point\h.0, justify weeks ago Unicode 7 was released so</span> <span data-start="1320.41" data-end="1332.049">this is out of date. I just need to change a single line of code. Changing that regular</span> <span data-start="1332.049" data-end="1336.251">expression, manually would have taken a very long time, now all I have to do is change</span> <span data-start="1336.251" data-end="1341.509">the Unicode version number, run the script again, just like that an up to date regular</span> <span data-start="1341.509" data-end="1348.72">expression comes out. Getting back to the dot operator, well ES 6 introduces a new flag</span> <span data-start="1348.72" data-end="1356.49">for regular expression, the U flag, it stands for Unicode, it matches\h‑‑ so it kind</span> <span data-start="1356.49" data-end="1361.26">of makes regular expressions work the way you think they would work. Here's another</span> <span data-start="1361.26" data-end="1366.89">example, in character classes, it's possible to use ranges, as I'm sure you know, probably</span> <span data-start="1366.89" data-end="1379.44">expect A,\h‑‑ C to match A\h‑‑ C and C, so similarly, you might expect this regular</span> <span data-start="1379.44" data-end="1384.37">expression to match the pile of Poo, the flexed buy accepts and the busy symbol, right, that</span> <span data-start="1384.37" data-end="1389.98">just makes sense, because that's the order of the code point, it doesn't work that way.</span> </p>
<p><span data-start="1389.98" data-end="1395.019">If you run this code it will throw an error on the very first line it will say the regular</span> <span data-start="1395.019" data-end="1399.94">expression is invalid, the range is out of order. So what's going on there? Well, as</span> <span data-start="1399.94" data-end="1404.84">far as JavaScript is concerned, this is what that regular expression looks like, so, it's</span> <span data-start="1404.84" data-end="1409.22">not trying to create a range between the two Emoji, it's trying to create range between</span> <span data-start="1409.22" data-end="1413.379">the one surrogate and the other surrogate for the other character, which is not the</span> <span data-start="1413.379" data-end="1420.85">right range, and because the range is not in the right order, it throws an error. This</span> <span data-start="1420.85" data-end="1426.95">is really easy to fix, you can add the U flag and that magically makes it work as you would</span> <span data-start="1426.95" data-end="1433.669">expect. If you need something that works today in ES 5, you're stuck with using a tool like</span> <span data-start="1433.669" data-end="1439.04">regenerate to build the regular expressions for you. But nowadays there's a better solution,</span> </p>
<p><span data-start="1439.04" data-end="1446.72">I just released this,it's called Regexpu, Compiler for regular expressions that use</span> <span data-start="1446.72" data-end="1453.289">the U flag, it will look through your code for regular expressions and rewrite them so</span> <span data-start="1453.289" data-end="1460.789">they're equivalent so they still work in Es 5. Hire's a demo of that.</span> <span data-start="1460.789" data-end="1465.549">This is live translation in the browser, you can use it in node I've submitted a patch</span> <span data-start="1465.549" data-end="1474.07">through intersure, you can start using this today. Write regular expressions theE is 6</span> <span data-start="1474.07" data-end="1481.37">way and compiling down to code that works to day without worrying about it. So in summary,</span> <span data-start="1481.37" data-end="1485.2">I think it's fair to say that JavaScript has a Unicode problem, rather than complaining</span> <span data-start="1485.2" data-end="1492.629">about it like JayZ did, we should probably be doing this instead. We should just deal</span> <span data-start="1492.629" data-end="1498.179">with it and work around these issues because it's honestly not that hard, and, you know,all</span> <span data-start="1498.179" data-end="1502.779">you have to do is add some pile of Poo to your unit test, there's a lot of talented</span> <span data-start="1502.779" data-end="1511.309">JavaScript programmers here\h‑‑ developers here, if we would add a Poo request for any</span> <span data-start="1511.309" data-end="1517.299">library that you're using or you've written, I think we can collectively discover lots</span> <span data-start="1517.299" data-end="1523.529">of bugs and help get them fixed. It's not that developers don't want the fix these issues,</span> <span data-start="1523.529" data-end="1528.659">I think problem is they don't know about it because it's such surprising behavior. Thank</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
