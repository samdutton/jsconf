<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>1nCq_a6-4bg</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/1nCq_a6-4bg?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.16" data-end="1.579">Building A Distributed Graph With Apollo Federation — Gerwin Brunner</span> <span data-start="1.579" data-end="2.579">- David Krehling We're back everyone.</span> <span data-start="2.579" data-end="3.579">Did you guys like your little break?</span> <span data-start="3.579" data-end="5.439">All right, so now we have two speakers coming onstage, Gerwin Brunner and David Krehling</span> <span data-start="5.439" data-end="6.439">on building Apollo graphs?</span> <span data-start="6.439" data-end="7.439">Got it.</span> <span data-start="7.439" data-end="8.439">OK, cool.</span> <span data-start="8.439" data-end="9.439">Let's give them a warm welcome [applause]</span> <span data-start="9.439" data-end="10.439"Audience member: Gerwin: Hello.</span> </p>
<p><span data-start="10.439" data-end="11.439">David: Can you hear us?</span> <span data-start="11.439" data-end="12.439">Great.</span> <span data-start="12.439" data-end="13.439">Gerwin: Yeah, I know what they meant before.</span> <span data-start="13.439" data-end="14.439">You're in the spotlight literally.</span> <span data-start="14.439" data-end="15.439">Is there anybody there?</span> <span data-start="15.439" data-end="16.439">David: All right, perfect.</span> <span data-start="16.439" data-end="17.439">So yeah.</span> <span data-start="17.439" data-end="18.439">So, yeah, thanks for coming, I guess.</span> <span data-start="18.439" data-end="19.439">Today we're going to talk about building a distributed graph with Apollo Federation and</span> <span data-start="19.439" data-end="24.449">maybe before we dive in, some questions for you just so we get to know you a little bit</span> <span data-start="24.449" data-end="25.449">better.</span> <span data-start="25.449" data-end="27.57">So actually, start with simple one.</span> </p>
<p><span data-start="27.57" data-end="29.529">How many of you actually know GraphQL?</span> <span data-start="29.529" data-end="31.75">OK, raise your hand.</span> <span data-start="31.75" data-end="33.92">OK, so I can't see anything.</span> <span data-start="33.92" data-end="38.719">OK, that's kind of good!</span> <span data-start="38.719" data-end="41.1">How many of you already use GraphQL?</span> <span data-start="41.1" data-end="46.01">Yay, also, quite good, I guess.</span> <span data-start="46.01" data-end="48.649">And how many of you have heard of the Apollo Federation.</span> <span data-start="48.649" data-end="53.06">OK, that's more than I expected.</span> <span data-start="53.06" data-end="56.18">But that's good, because that is why we're here.</span> <span data-start="56.18" data-end="59.85">Maybe just to start with us.</span> <span data-start="59.85" data-end="61.469">My name is David Krehling.</span> <span data-start="61.469" data-end="67.61">This guy next to me is Gerwin Brunner, we're both from Vienna Austria, and we work there</span> <span data-start="67.61" data-end="75.83">in one of the biggest banks in Austria and central Eastern Europe region and we're building</span> <span data-start="75.83" data-end="85.19">a state of the art web application replacing an old legacy one and we tried to incorporate</span> <span data-start="85.19" data-end="92.67">GraphQL like from day one into our design so we got quite a few learnings and basically</span> <span data-start="92.67" data-end="96.19">this talk incorporates that a little.</span> </p>
<p><span data-start="96.19" data-end="99.1">So maybe let's start simple.</span> <span data-start="99.1" data-end="101.03">What's actually GraphQL?</span> <span data-start="101.03" data-end="109.9">OK, so  —  oh, I can see it here so.</span> <span data-start="109.9" data-end="116.211">So I guess most of you know REST, and I guess most of you know like the issues you get with</span> <span data-start="116.211" data-end="124.89">REST, especially when you get like  —  when you have like more complex or bigger applications</span> <span data-start="124.89" data-end="126.25">or systems.</span> <span data-start="126.25" data-end="132.41">You have several issues, for example, if you need data from different kinds of services,</span> <span data-start="132.41" data-end="138.94">you always have to call them separately, you have to get all the data from them.</span> <span data-start="138.94" data-end="146.52">And basically this leads to a slow network environment and you basically get data you</span> <span data-start="146.52" data-end="151.33">don't want or you don't need.</span> <span data-start="151.33" data-end="160.01">GraphQL is trying to solve that by putting a data graph in between which is described</span> <span data-start="160.01" data-end="168.09">in this so-called schema and that basically allows you to query several services at once</span> <span data-start="168.09" data-end="173.15">and to query exactly for the data you really need.</span> <span data-start="173.15" data-end="180.3">What's also cool, just like a side fact, you can also put GraphQL as a layer on top of</span> <span data-start="180.3" data-end="188.22">your REST services so if you can't switch like this, you can really build the REST service</span> <span data-start="188.22" data-end="194.49">into your GraphQL environment and then replace it piece by piece.</span> </p>
<p><span data-start="194.49" data-end="203.09">So like I said before, like one of the core building blocks of GraphQL is the schema.</span> <span data-start="203.09" data-end="209.89">Which is shared between the client and server, and basically it's there to validate all the</span> <span data-start="209.89" data-end="213.32">inputs or the payloads you define in the schema.</span> <span data-start="213.32" data-end="220.569">So every time you make a request and GraphQL terminal, it would be a query or a mutation,</span> <span data-start="220.569" data-end="229.79">the schema checks if one the types are proper and if they are input or the payload is complete,</span> <span data-start="229.79" data-end="235.54">and if there's  —  if the data is in there or the data that you want.</span> <span data-start="235.54" data-end="240.04">Another thing is that it's like strictly typed, so you also have type validation in there,</span> <span data-start="240.04" data-end="241.07">as well.</span> <span data-start="241.07" data-end="246.711">The second big building block is the resolver, and basically in the resolver, not all of</span> <span data-start="246.711" data-end="252.02">the metric, but basically all the metric happens because it's there to process data, and to</span> <span data-start="252.02" data-end="254.05">retrieve data and return data.</span> </p>
<p><span data-start="254.05" data-end="264.26">So every time he query something for example, it goes through the resolver and basically</span> <span data-start="264.26" data-end="270.16">that's the point where you connect to the database, where you connect to APIs, to other</span> <span data-start="270.16" data-end="275.13">services and so on.</span> <span data-start="275.13" data-end="282.93">So maybe like the people that already worked with GraphQL know that issue, that like when</span> <span data-start="282.93" data-end="286.75">it gets a little bit more complex and as it gets a little bit bigger, you create this</span> <span data-start="286.75" data-end="292.47">huge monolithic schema, which basically creates a mess.</span> <span data-start="292.47" data-end="296.72">So there are several solutions to that.</span> </p>
<p><span data-start="296.72" data-end="306.53">One would be to use schema stitching, which basically creates a mess, as well.</span> <span data-start="306.53" data-end="312.62">Because like one of the biggest down sides is if you try to separate the schema which</span> <span data-start="312.62" data-end="317.72">shouldn't be separated, you create like lots of overhead code, you create lots of effort,</span> <span data-start="317.72" data-end="325.09">lots of work, the bigger it gets, the more you separate t the harder it gets to maintain.</span> <span data-start="325.09" data-end="333.61">Even to understand and basically at some point it's impossible to test it.</span> <span data-start="333.61" data-end="336.449">So that's where Apollo came in.</span> <span data-start="336.449" data-end="345.53">The smart guys there, and they created Apollo Federation.</span> </p>
<p><span data-start="345.53" data-end="352.64">What they tried to do is incorporate some core principles, basically the first one it</span> <span data-start="352.64" data-end="361.52">should be a declarative, meaning no schema stitching at all, so you're freed of that,</span> <span data-start="361.52" data-end="369.1">and another thing which is pretty great is that you have a separation of concerns, meaning</span> <span data-start="369.1" data-end="377.139">you divide your schema into several stand-alone schemas, which then can be referenced to each</span> <span data-start="377.139" data-end="378.18">other.</span> <span data-start="378.18" data-end="385.09">And basically to bring all of that back together to the client, Apollo created the gateway</span> <span data-start="385.09" data-end="392.99">which takes all those several federated schemas, and makes like one huge schema out of it again,</span> <span data-start="392.99" data-end="400.27">so basically like the client, nothing changed at all, it's only on the server side.</span> <span data-start="400.27" data-end="401.27">OK.</span> <span data-start="401.27" data-end="407.3">So to build up federated schema, you have several building blocks, we go through this</span> <span data-start="407.3" data-end="409.55">list one by one.</span> <span data-start="409.55" data-end="413.08">Let's just start with entities and keys.</span> <span data-start="413.08" data-end="425.25">So basically an entity is just  —  is just a GraphQL type basically the only thing that's</span> <span data-start="425.25" data-end="436.19">changed is this @key directive on the right-hand side of the customer.</span> <span data-start="436.19" data-end="445.62">Which basically creates a connection between the several schemas, so by adding this @key</span> <span data-start="445.62" data-end="455.31">field, you create this connection point and basically what it is is nothing else than</span> <span data-start="455.31" data-end="469.19">as a primary key, basically it works like an SQL.</span> </p>
<p><span data-start="469.19" data-end="477.86">So as soon as you created this entity, which again is basically just an @key directive,</span> <span data-start="477.86" data-end="486.539">you can reference it from different schemas or services, so maybe to go back, just imagine</span> <span data-start="486.539" data-end="493.26">this code example, for example, would be in a schema in the customer service, and the</span> <span data-start="493.26" data-end="497.94">next one here would be, for example, in the order service.</span> <span data-start="497.94" data-end="504.889">So basically everything you do there is just creating the same type again, but putting</span> <span data-start="504.889" data-end="510.6">this extent keyword in front of it, and again this directive.</span> <span data-start="510.6" data-end="514.529">The @key primary key at the end of it.</span> <span data-start="514.529" data-end="522.809">And that's basically where you'd just  —  how do you say it, like, reference to the other</span> <span data-start="522.809" data-end="523.809">schema.</span> <span data-start="523.809" data-end="526.569">And basically that's almost it.</span> <span data-start="526.569" data-end="532.209">So all you have to do now is just declare what do you want?</span> <span data-start="532.209" data-end="541.6">So basically again, just like super-simple GraphQL and for that, you got the other.</span> <span data-start="541.6" data-end="544.049">The other keyword which would be the external.</span> <span data-start="544.049" data-end="551.189"> —  I have to drink something, sorry.</span> </p>
<p><span data-start="551.189" data-end="561.48">Which would be the external keyword, and basically all the external is doing is it's telling</span> <span data-start="561.48" data-end="571.999">GraphQL, it's telling your schema in this case, the order schema, that the ID is coming</span> <span data-start="571.999" data-end="573.959">from a different schema.</span> <span data-start="573.959" data-end="577.759">So it's not like native to the schema.</span> <span data-start="577.759" data-end="584.99">This might sound kind of weird like in the first second, but if we go to the next slide,</span> <span data-start="584.99" data-end="591.679">hopefully it makes a little bit more sense, because there are also type extension, because</span> <span data-start="591.679" data-end="596.069">there's referencing between different schemas shouldn't be a one-way street.</span> <span data-start="596.069" data-end="603.019">It should basically go in the other direction, as well, because you want to divide it by</span> <span data-start="603.019" data-end="611.839">concern, and not just by type, so you also have the possibility, in this case, to extend</span> <span data-start="611.839" data-end="619.56">reference type, so basically meaning again we're in an order schema, we created the reference</span> <span data-start="619.56" data-end="622.429">to the customer type here.</span> </p>
<p><span data-start="622.429" data-end="629.089">And now we want to add some properties there, because just imagine in the order service,</span> <span data-start="629.089" data-end="633.45">we want to know the number of orders for one customer.</span> <span data-start="633.45" data-end="641.459">I mean there's no point to add this state to the customer service, it doesn't concern</span> <span data-start="641.459" data-end="646.91">it, so we have to add it to the order service and that's basically what we're doing here.</span> <span data-start="646.91" data-end="653.999">We just add another prop to a reference type, without this external keyword, so GraphQL</span> <span data-start="653.999" data-end="660.429">knows straight away, it's like native to this schema.</span> <span data-start="660.429" data-end="669.04">And that way you basically create the relationship between those different schemas, so actually,</span> <span data-start="669.04" data-end="671.05">it's super-simple.</span> </p>
<p><span data-start="671.05" data-end="679.42">So coming back to the architecture, actually, all you know is like different federated schemas,</span> <span data-start="679.42" data-end="686.149">and this Apollo gateway and basically Apollo is providing you with both of those.</span> <span data-start="686.149" data-end="694.97">Just to give you like a quick overview, how much code you would need to set it up, except</span> <span data-start="694.97" data-end="699.48">the code I showed you already, is basically just this.</span> <span data-start="699.48" data-end="716.92">So instead of inserting your server into your Apollo server, so basically that way you just</span> <span data-start="716.92" data-end="723.779">create a federated schema, which can, like work on its own, which is stand-alone, so</span> <span data-start="723.779" data-end="730.579">it's basically its own schema, and then, on the right-hand side, you see the Apollo gateway</span> <span data-start="730.579" data-end="734.689">which brings everything together, so in that Apollo gateway.</span> </p>
<p><span data-start="734.689" data-end="744.879">You put in a direction where to find it and that's it.</span> <span data-start="744.879" data-end="751.98">And it's basically not tough to set up and it brings you so much benefits.</span> <span data-start="751.98" data-end="758.56">And maybe to show you the transition from like a regular schema to a federated schema,</span> <span data-start="758.56" data-end="764.04">I will hand it over to Gerwin now.</span> <span data-start="764.04" data-end="768.49">Gerwin: So enough of the theory.</span> </p>
<p><span data-start="768.49" data-end="777.029">I like to do the insane stuff, which means, doing live coding and if the screen comes</span> <span data-start="777.029" data-end="778.959">up, we'll see how that goes.</span> <span data-start="778.959" data-end="780.73">Yeah.</span> <span data-start="780.73" data-end="782.51">OK.</span> <span data-start="782.51" data-end="785.91">So where do we start here?</span> <span data-start="785.91" data-end="788.079">OK.</span> <span data-start="788.079" data-end="792.009">Let's start with a little bit of looking into the code.</span> <span data-start="792.009" data-end="797.43">So our starting point is simple.</span> <span data-start="797.43" data-end="805.009">We have customers, we have coffee, like Espresso.</span> <span data-start="805.009" data-end="807.709">Or a cold brew, and we have orders.</span> <span data-start="807.709" data-end="815.499">Which combines those two things like customers and coffees together to basically enjoy the</span> <span data-start="815.499" data-end="816.499">beverage.</span> <span data-start="816.499" data-end="822.869">So that's the simplest schema we could come up with, so as we said, we had a customer</span> <span data-start="822.869" data-end="831.04">which has an ID and name, we have coffee which has an ID, a name, which is the type of coffee,</span> <span data-start="831.04" data-end="837.569">like Espresso, cappuccino, and we have a price, obviously it's not free and we have orders</span> <span data-start="837.569" data-end="842.699">that combine those and also give us the information when it was bought.</span> </p>
<p><span data-start="842.699" data-end="850.72">Pretty simple, pretty straightforward, then we have basically the resolvers and can everybody</span> <span data-start="850.72" data-end="854.04">see the stuff up there?</span> <span data-start="854.04" data-end="855.04">Yes?</span> <span data-start="855.04" data-end="856.98">No, OK, that's good, just to make sure.</span> <span data-start="856.98" data-end="862.57">So in the resolver, basically you would go to a database to a different API, to whatever,</span> <span data-start="862.57" data-end="867.85">to query the stuff, but in this case we don't  —  I just basically hard coded it here.</span> <span data-start="867.85" data-end="872.24">So we have a list of customers, we have Paul, Mark and Bruce.</span> <span data-start="872.24" data-end="877.29">We have coffees like Espresso, cold brew and nitro cold brew and we have resolvers that</span> <span data-start="877.29" data-end="879.129">merge those.</span> <span data-start="879.129" data-end="886.07">In the same query, we can query all customers, all coffees, all orders.</span> <span data-start="886.07" data-end="893.1">And we have this thing here that basically makes orders resolve correctly.</span> </p>
<p><span data-start="893.1" data-end="896.799">So now let's quickly look at GraphQL.</span> <span data-start="896.799" data-end="905.209">GraphQL comes with a lot of implementation of the GraphQL API, so Apollo provides it</span> <span data-start="905.209" data-end="909.839">as soon as you throw it into the application, you get like a graphical interface and if</span> <span data-start="909.839" data-end="921.369">you haven't seen it yet, it's magic, magic meaning, like oh, hey, I just start typing</span> <span data-start="921.369" data-end="929.35">and it says oh, customers, and I run this query and I get a list of customers, amazing.</span> <span data-start="929.35" data-end="934.449">Then we can do the same kind of thing for coffees, and what kind of coffees do we offer?</span> <span data-start="934.449" data-end="937.929">And we get a list of coffees.</span> <span data-start="937.929" data-end="944.48">And I probably need the ID of the customer in my application to do something else, so</span> <span data-start="944.48" data-end="953.749">I can add stuff on the go, and that's actually one of the biggest magics  —  biggest magic</span> <span data-start="953.749" data-end="960.85">that GraphQL does, it gives you the opportunity to, as a client to just select what you need.</span> <span data-start="960.85" data-end="961.85">Good.</span> <span data-start="961.85" data-end="963.809">So and finally, let's do something.</span> <span data-start="963.809" data-end="969.389">And let's take a look at the orders.</span> </p>
<p><span data-start="969.389" data-end="973.509">So we can do the same here, like when was it bought?</span> <span data-start="973.509" data-end="978.879">And we can also dig deep into the customer.</span> <span data-start="978.879" data-end="980.22">Who was it?</span> <span data-start="980.22" data-end="987.709">And we have all the same properties that the customer actually provides as an object.</span> <span data-start="987.709" data-end="995.329">So we can select the coffee  —  the customer, and to do the same exact same thing with the</span> <span data-start="995.329" data-end="998.389">coffee and  —  oops.</span> <span data-start="998.389" data-end="1005.779">Well, the exact same thing with coffee, l so display it and so we have it here.</span> <span data-start="1005.779" data-end="1010.569">So that's really, really really cool, compared to a REST API.</span> <span data-start="1010.569" data-end="1013.91">Who wants to do the same thing up here with REST API?</span> <span data-start="1013.91" data-end="1018.439">I encourage you to show me in that in 4 and a half minutes.</span> </p>
<p><span data-start="1018.439" data-end="1019.47">Anyway.</span> <span data-start="1019.47" data-end="1022.669">So enough about how cool that is.</span> <span data-start="1022.669" data-end="1025.92">So let's just do the crazy part.</span> <span data-start="1025.92" data-end="1033.77">The crazy part is we have looked at the schema, the resolver, and finally, there is like this</span> <span data-start="1033.77" data-end="1042.95">glue magic that comes from the Apollo server that basically loads the resolver and then</span> <span data-start="1042.95" data-end="1052">exposes it in a new URL called GraphQL and that's T that's really literally the only</span> <span data-start="1052" data-end="1055.03">code that that's something useful in this application.</span> <span data-start="1055.03" data-end="1058.19">I mean useful for this example.</span> </p>
<p><span data-start="1058.19" data-end="1064.45">And if we now decide as a company it's a great idea to split up the stuff, so we make three</span> <span data-start="1064.45" data-end="1065.45">teams.</span> <span data-start="1065.45" data-end="1069.36">One team for customers, one for coffee and one for orders and they should do whatever</span> <span data-start="1069.36" data-end="1073.96">they want to do whenever they want to do it without interfering with each other.</span> <span data-start="1073.96" data-end="1077.58">If you have just one schema, this can be a little bit painful!</span> </p>
<p><span data-start="1077.58" data-end="1087.49">Yeah, I think we can tell you in a beer session what we mean by painful.</span> <span data-start="1087.49" data-end="1088.49">Yeah.</span> <span data-start="1088.49" data-end="1099.65">So good, if we want to split that up, we basically create something like customer in microservices.</span> <span data-start="1099.65" data-end="1101.66">Which is just a folder.</span> <span data-start="1101.66" data-end="1110.98">And in there, we do three things, we create an index.js  —  oops index.js.</span> </p>
<p><span data-start="1110.98" data-end="1114.74">Yeah, typing is the most difficult thing.</span> <span data-start="1114.74" data-end="1123.81">Resolvers.js and I really understand what the other speaker yesterday meant with it's</span> <span data-start="1123.81" data-end="1125.32">hard to type here.</span> <span data-start="1125.32" data-end="1127.61">Good, so we have those three things.</span> <span data-start="1127.61" data-end="1133.5">I go to the existing schema and basically just copy everything, and remove the stuff</span> <span data-start="1133.5" data-end="1134.5">I'm not needing.</span> <span data-start="1134.5" data-end="1138.48">Because we're dealing with a customer here now, I just want to query customer.</span> <span data-start="1138.48" data-end="1142.85">I keep the type of customer and delete everything else.</span> <span data-start="1142.85" data-end="1143.85">save.</span> </p>
<p><span data-start="1143.85" data-end="1148.91">I do the same for the resolvers.</span> <span data-start="1148.91" data-end="1158.91">Keep the customer data or database actually, because that's what it is.</span> <span data-start="1158.91" data-end="1159.91">And remove everything that we don't need.</span> <span data-start="1159.91" data-end="1161.89">So that's it.</span> <span data-start="1161.89" data-end="1168.35">As you already saw here, this is a function I wrote before, which is just the same, Apollo</span> <span data-start="1168.35" data-end="1172.97">server creation that we saw before, this part here with two exceptions.</span> <span data-start="1172.97" data-end="1179.81">We built the schema first as a build federated schema and used that schema then to start</span> <span data-start="1179.81" data-end="1181.71">Apollo server, that's everything.</span> </p>
<p><span data-start="1181.71" data-end="1183.72">That's the only thing that changed here.</span> <span data-start="1183.72" data-end="1184.72">Not true.</span> <span data-start="1184.72" data-end="1185.94">There's one more thing.</span> <span data-start="1185.94" data-end="1194.36">I pass in a path because we need to expose this new schema somewhere in this example.</span> <span data-start="1194.36" data-end="1200.12">You would kind of need that, but if you really have different codebases, then every codebase</span> <span data-start="1200.12" data-end="1202.04">would have a different thing.</span> <span data-start="1202.04" data-end="1204.76">Here I just used one server.</span> <span data-start="1204.76" data-end="1211.34">So the path is here.</span> <span data-start="1211.34" data-end="1216.03">So we need the index file and I'm lazy because I can't remember this stuff, or actually I</span> <span data-start="1216.03" data-end="1222.28">tried to remember it before, but failed like three times, so I just copied this over here.</span> <span data-start="1222.28" data-end="1228.42">So OK, this function basically is just a little bit of glue code for my micro-service of the</span> <span data-start="1228.42" data-end="1237.5">customers, which just initializes the create Apollo server code that we had before and</span> <span data-start="1237.5" data-end="1239.15">exposes that.</span> <span data-start="1239.15" data-end="1241.47">So no magic here.</span> </p>
<p><span data-start="1241.47" data-end="1244.92">So this is the index that we had before.</span> <span data-start="1244.92" data-end="1254.88">We can now get rid of the initial full single schema GraphQL stuff and we just do two things,</span> <span data-start="1254.88" data-end="1263.68">we import the Apollo gateway, and we import the function that I just showed you with initializing</span> <span data-start="1263.68" data-end="1264.93">the customers.</span> <span data-start="1264.93" data-end="1267.69">Then I need to define the URL.</span> <span data-start="1267.69" data-end="1276">Oops, and not just a URL, but I also need to do just this here, define a URL, which</span> <span data-start="1276" data-end="1285.31">is GMS, which is GraphQL microservices/customer and I call in it customers, which is exactly</span> <span data-start="1285.31" data-end="1294.9">the method that starts up that specific GraphQL server for the customer, and then I have the</span> <span data-start="1294.9" data-end="1304.01">Apollo gateway where I pass in this URL of the customer to basically aggregate that.</span> <span data-start="1304.01" data-end="1310.76">So we have two things now, we have the separate GMS/customer GraphQL endpoint that works as</span> <span data-start="1310.76" data-end="1316.94">a regular GraphQL enter point and now we have the gateway, which is just /graphQL which</span> <span data-start="1316.94" data-end="1322.78">aggregates all the other ones, but we just have the customer one and that's it.</span> </p>
<p><span data-start="1322.78" data-end="1327.53">And if everything works  —  wow, it does!</span> <span data-start="1327.53" data-end="1336.54">We can go here and one thing, we can go into GMS customer, and we fail.</span> <span data-start="1336.54" data-end="1339.18">Which is not surprising.</span> <span data-start="1339.18" data-end="1340.62">Does the regular one work?</span> <span data-start="1340.62" data-end="1342.08">No, everything breaks.</span> <span data-start="1342.08" data-end="1343.08">Awesome!</span> <span data-start="1343.08" data-end="1346.3">Why  —  init customers is not loaded.</span> <span data-start="1346.3" data-end="1360.35">OK, saving things helps, yes, it really does, OK, that was simple, helpful.</span> <span data-start="1360.35" data-end="1372.64">So now we're in GMS customer and we can  —  oh, cool, query customers, what a surprise!</span> <span data-start="1372.64" data-end="1375.23">So damn it!</span> </p>
<p><span data-start="1375.23" data-end="1377.82">Wrong key.</span> <span data-start="1377.82" data-end="1382.28">So and here's my point, we can query the customers.</span> <span data-start="1382.28" data-end="1383.28">Woohoo!!</span> <span data-start="1383.28" data-end="1391.03">And also, we can query the customer here.</span> <span data-start="1391.03" data-end="1392.7">Customers and name.</span> <span data-start="1392.7" data-end="1394.91">So it's there.</span> <span data-start="1394.91" data-end="1395.91">Wow!</span> <span data-start="1395.91" data-end="1403.79">Two end points, one is the gateway, this is the gateway here now, and that one is basically</span> <span data-start="1403.79" data-end="1411.19">the GMS, the micro-service endpoint.</span> <span data-start="1411.19" data-end="1417.99">I'm going to copy over now from a working example the same thing for orders and customers.</span> <span data-start="1417.99" data-end="1419.2">Whoopsie.</span> <span data-start="1419.2" data-end="1425.85">So you just have to believe me that I'm doing the same thing as before, so we can go there.</span> <span data-start="1425.85" data-end="1432.69">Here we got all coffees, and the definition of the schema.</span> <span data-start="1432.69" data-end="1441.14">So we just have to import the same thing here, coffee will path, more coffee, and expose</span> <span data-start="1441.14" data-end="1447.11">it through the gateway, in the last step, and see if that works.</span> </p>
<p><span data-start="1447.11" data-end="1448.2">It does.</span> <span data-start="1448.2" data-end="1456.52">So the GMS customer still works and we just on this  —  try to see, oh, we have coffees</span> <span data-start="1456.52" data-end="1457.52">now.</span> <span data-start="1457.52" data-end="1459.04">Hey, cool!</span> <span data-start="1459.04" data-end="1463.12">And we just select the price to see a different  —  it works.</span> <span data-start="1463.12" data-end="1472.14">So same thing, and finally, I already copied it, we do the exact same thing for the orders,</span> <span data-start="1472.14" data-end="1475.04">and disclaimer: This is going to break.</span> </p>
<p><span data-start="1475.04" data-end="1477.23">Why is it going to break?</span> <span data-start="1477.23" data-end="1483.86">Because it complains about customer ID is marked as external, but it's not used.</span> <span data-start="1483.86" data-end="1492.73">OK, simple, because what I didn't do before is in the customers, when I copied it over,</span> <span data-start="1492.73" data-end="1494.32">I missed one thing.</span> <span data-start="1494.32" data-end="1504.48">I basically need to say that it's a key, and I already have done that in coffee, so @key</span> <span data-start="1504.48" data-end="1515.73">fields ID, which is this  —  which tells the gateway, hey, this is a thing you can reference,</span> <span data-start="1515.73" data-end="1521.85">and as soon as I add that, we should be back in business.</span> </p>
<p><span data-start="1521.85" data-end="1522.85">And we are.</span> <span data-start="1522.85" data-end="1523.85">And it works.</span> <span data-start="1523.85" data-end="1531.75">And so now we can try to also select the orders.</span> <span data-start="1531.75" data-end="1533.02">And the order ID.</span> <span data-start="1533.02" data-end="1537.17">Oops, let's remove these here, so we can see better.</span> <span data-start="1537.17" data-end="1539.74">We removed the order ID.</span> <span data-start="1539.74" data-end="1540.74">It's there.</span> <span data-start="1540.74" data-end="1542.39">What a surprise.</span> <span data-start="1542.39" data-end="1557.55">And we add the coffee, name, also there works nicely, and now we add the customer, and it</span> <span data-start="1557.55" data-end="1558.55">will break.</span> <span data-start="1558.55" data-end="1559.55">Haha.</span> <span data-start="1559.55" data-end="1560.55">Plan for that.</span> <span data-start="1560.55" data-end="1561.55">OK, so why?</span> <span data-start="1561.55" data-end="1565.75">Because we missed the other part, and we take a look at the resolver, and in the coffee</span> <span data-start="1565.75" data-end="1570.07">resolver, we already have it, and now I'm putting it over.</span> </p>
<p><span data-start="1570.07" data-end="1579.05">This is the second piece you need besides the key for reference is the way to tell the</span> <span data-start="1579.05" data-end="1584.91">local service that if some other service comes along and asks you for a customer in this</span> <span data-start="1584.91" data-end="1591.81">case, how to do that, and it's  —  the underscore-underscore resolve reference method you need to rely</span> <span data-start="1591.81" data-end="1596.14">on for that type and voila, it works.</span> <span data-start="1596.14" data-end="1597.14">That's it.</span> <span data-start="1597.14" data-end="1598.14">Almost in time.</span> <span data-start="1598.14" data-end="1599.14">David: So really in?</span> <span data-start="1599.14" data-end="1600.18">It breaks at the end?</span> <span data-start="1600.18" data-end="1601.18">Nice.</span> <span data-start="1601.18" data-end="1602.68">Basically just final words.</span> <span data-start="1602.68" data-end="1609.75">Maybe I just put together like a short list which basically some advanced  —  more advanced</span> <span data-start="1609.75" data-end="1615.951">features you can do with this Apollo Federation, so for example, you can not only like go 0</span> <span data-start="1615.951" data-end="1620.72">for one primary key, but you can do several, like you can even do like composite primary</span> <span data-start="1620.72" data-end="1628.19">keys, so like a combined key has to be there and so on and so forth.</span> </p>
<p><span data-start="1628.19" data-end="1635.25">If you're really interested in all that stuff and want to go into more detail, we get some</span> <span data-start="1635.25" data-end="1636.25">references here for you.</span> <span data-start="1636.25" data-end="1644.42">Basically the first one is the blogpost published in Apollo, which this talk is based on.</span> <span data-start="1644.42" data-end="1655.01">Oops there's a typo and the Apollo documentation and if you are interested in the code, there's</span> <span data-start="1655.01" data-end="1662.92">also the link to repository for this demo we just showed you.</span> </p>
<p><span data-start="1662.92" data-end="1667.26">So if you want to go into like a simple example and have to code right away, that would be</span> <span data-start="1667.26" data-end="1668.26">it.</span> <span data-start="1668.26" data-end="1672.32">So at that point, we're done.</span> <span data-start="1672.32" data-end="1674.32">Thank you for listening, and yeah.</span> <span data-start="1674.32" data-end="1678.28">Gerwin: If you got any questions, find us.</span> <span data-start="1678.28" data-end="1683.29">We will talk for beer! [applause]</span> </p>
<p><span data-start="1683.29" data-end="1695.14">David: Just to make my mom proud, I have to do one.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
