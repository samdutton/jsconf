<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dmrUxCe0R9U</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/dmrUxCe0R9U?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="19.49" data-end="21.869">solve most of our problems but it ends</span> <span data-start="21.869" data-end="23.91">up being a relatively poor abstraction</span> <span data-start="23.91" data-end="26.369">you know it's distracting away the</span> <span data-start="26.369" data-end="28.08">mechanics of making the HTTP request</span> <span data-start="28.08" data-end="29.849">rather than embracing the bits about</span> </p>
<p><span data-start="29.849" data-end="33.23">HTTP that actually make it useful and</span> <span data-start="33.23" data-end="35.55">you know even then I didn't actually</span> <span data-start="35.55" data-end="37.5">show it but you know that abstraction</span> <span data-start="37.5" data-end="40.23">was also leaking details still so it was</span> <span data-start="40.23" data-end="42.03">a leaky abstraction because we still got</span> <span data-start="42.03" data-end="44.1">the response back which would be just</span> <span data-start="44.1" data-end="46.14">the normal jquery ajax response with all</span> <span data-start="46.14" data-end="50.04">the HTTP response details in it so you</span> <span data-start="50.04" data-end="51.839">know this isn't a problem that specific</span> <span data-start="51.839" data-end="53.4">to jquery by any means and i don't mean</span> <span data-start="53.4" data-end="54.93">to pick on jquery it's just you know</span> <span data-start="54.93" data-end="56.489">it's one of the most popular library so</span> <span data-start="56.489" data-end="58.44">it's the easiest to demonstrate every</span> <span data-start="58.44" data-end="61.29">library that has some like Ajax</span> <span data-start="61.29" data-end="62.909">functionality tends to have this</span> <span data-start="62.909" data-end="66.39">fundamental issue so really kind of what</span> <span data-start="66.39" data-end="68.58">the present here is to really kind of</span> <span data-start="68.58" data-end="69.869">think about what the abstractions that</span> <span data-start="69.869" data-end="71.76">we should be doing and we should be</span> <span data-start="71.76" data-end="73.74">working with the resources and HTTP is</span> <span data-start="73.74" data-end="75.24">fundamentally about getting and</span> <span data-start="75.24" data-end="77.479">manipulating resources on a server</span> <span data-start="77.479" data-end="79.86">rather than dealing with the low-level</span> <span data-start="79.86" data-end="81.63">mechanics of actually how do we make a</span> <span data-start="81.63" data-end="84.99">request so there's a little library that</span> </p>
<p><span data-start="84.99" data-end="87.299">I created call dress gasps it's a very</span> <span data-start="87.299" data-end="90.119">thin wrapper around that basically the</span> <span data-start="90.119" data-end="92.64">raw of request and response I mentioned</span> <span data-start="92.64" data-end="94.619">earlier works with the xhr as well as</span> <span data-start="94.619" data-end="97.649">nodes HTTP libraries also have support</span> <span data-start="97.649" data-end="99.659">for Jason P and even i use cross-domain</span> <span data-start="99.659" data-end="103.53">request runs in common Jas and AMD so</span> <span data-start="103.53" data-end="104.969">whatever environment you want to work</span> <span data-start="104.969" data-end="109.579">with you know we're using modules it's</span> <span data-start="109.579" data-end="112.14">so you know if you're not familiar with</span> <span data-start="112.14" data-end="114.659">modules everyone in node you know it's</span> <span data-start="114.659" data-end="116.249">just a straight-up require rest it's</span> <span data-start="116.249" data-end="119.46">dead simple being a browser typically we</span> <span data-start="119.46" data-end="122.159">require an AMD loader so if you're not</span> <span data-start="122.159" data-end="123.179">familiar with that you basically just</span> <span data-start="123.179" data-end="125.789">define your module and your specify your</span> <span data-start="125.789" data-end="127.289">requirements and they get injected and</span> <span data-start="127.289" data-end="130.95">at runtime so how do what is restaurants</span> <span data-start="130.95" data-end="132.9">actually look like at runtime well we</span> <span data-start="132.9" data-end="134.7">have this rest function and we can then</span> <span data-start="134.7" data-end="136.74">again get that URL and it returns a</span> <span data-start="136.74" data-end="139.98">promise for the response and you know if</span> <span data-start="139.98" data-end="141.569">you think about what I just chose</span> <span data-start="141.569" data-end="143.22">talking about with jquery I mean this is</span> <span data-start="143.22" data-end="147.72">exactly the same pattern so you know I</span> <span data-start="147.72" data-end="150.18">must obviously not be very good what I</span> <span data-start="150.18" data-end="151.89">do</span> <span data-start="151.89" data-end="154.959">so before I get really into deep about</span> <span data-start="154.959" data-end="157.87">what makes rest rest there's a concept</span> <span data-start="157.87" data-end="160.54">out there of the Richardson maturity</span> <span data-start="160.54" data-end="163.45">model and this is basically you know</span> <span data-start="163.45" data-end="164.83">anytime someone starts talking about a</span> <span data-start="164.83" data-end="167.26">maturity model you know pay attention</span> <span data-start="167.26" data-end="169.38">figure out what they're talking about</span> <span data-start="169.38" data-end="171.55">figure out how much of it really is</span> <span data-start="171.55" data-end="173.38">important to you and then just you know</span> <span data-start="173.38" data-end="174.97">figure off where you want to get off the</span> <span data-start="174.97" data-end="178.36">train but at the very low level you know</span> <span data-start="178.36" data-end="180.849">what they call level zero it's basically</span> <span data-start="180.849" data-end="183.549">just you know random request going off</span> <span data-start="183.549" data-end="185.049">all over the place that have really no</span> <span data-start="185.049" data-end="187.239">semantic meaning but you know somehow</span> <span data-start="187.239" data-end="189.43">the client and server figure out what to</span> <span data-start="189.43" data-end="191.98">do the level one is where you actually</span> <span data-start="191.98" data-end="194.769">start using resources so instead of the</span> <span data-start="194.769" data-end="197.91">you know you can actually start to</span> <span data-start="197.91" data-end="199.87">access things of the more resource</span> <span data-start="199.87" data-end="201.549">oriented fashion rather than trying to</span> <span data-start="201.549" data-end="205.51">do RPC over HTTP or some other you know</span> <span data-start="205.51" data-end="208.84">hack level two is actually using HTTP</span> <span data-start="208.84" data-end="210.91">verbs so you know using gets to load</span> <span data-start="210.91" data-end="213.64">resources put to create resources put to</span> <span data-start="213.64" data-end="215.44">modify resources or create more</span> <span data-start="215.44" data-end="217.9">resources and then you know finally</span> <span data-start="217.9" data-end="220.209">level three is you know using hypermedia</span> <span data-start="220.209" data-end="223.209">api's so if you think about the web you</span> <span data-start="223.209" data-end="225.7">have a page of links and when you</span> <span data-start="225.7" data-end="227.2">navigate to that page you get the links</span> <span data-start="227.2" data-end="228.489">and you get the context of it and then</span> <span data-start="228.489" data-end="230.17">you figure out okay I want to follow</span> <span data-start="230.17" data-end="231.819">that link and then you get another page</span> <span data-start="231.819" data-end="233.109">it has to get more length and you keep</span> <span data-start="233.109" data-end="235.48">following that so the idea of hypermedia</span> <span data-start="235.48" data-end="237.76">resources is that for your actual for</span> <span data-start="237.76" data-end="240.609">your data API s you again have resources</span> <span data-start="240.609" data-end="242.319">with collection of links and you</span> <span data-start="242.319" data-end="244.45">navigate those links that reverse the</span> <span data-start="244.45" data-end="246.67">object graph rather than having to</span> <span data-start="246.67" data-end="248.56">figure out what the URL structure is in</span> <span data-start="248.56" data-end="250.45">advance that that server has support and</span> <span data-start="250.45" data-end="252.28">then going through and parsing that out</span> <span data-start="252.28" data-end="255.63">yourself</span> <span data-start="255.64" data-end="259.03">so back to what r SJ s is so it</span> <span data-start="259.03" data-end="260.709">mentioned earlier it's an abstraction to</span> <span data-start="260.709" data-end="263.47">work with resources rather than just an</span> <span data-start="263.47" data-end="266.14">abstraction to make requests so of</span> <span data-start="266.14" data-end="268">course we give you full access to the</span> <span data-start="268" data-end="270.55">request and response objects you know</span> <span data-start="270.55" data-end="272.95">all the properties that you can put on</span> <span data-start="272.95" data-end="274.99">to a request or a response you have</span> <span data-start="274.99" data-end="278.86">access to but really the advantages that</span> <span data-start="278.86" data-end="281.14">we have this notion of an interceptor</span> <span data-start="281.14" data-end="283.27">that allows you to really apply advanced</span> <span data-start="283.27" data-end="285.58">behavior to that core request response</span> <span data-start="285.58" data-end="288.07">facility so that we're not baking in a</span> <span data-start="288.07" data-end="289.54">bunch of knowledge into the actual</span> <span data-start="289.54" data-end="291.64">lowest level client but we're applying</span> <span data-start="291.64" data-end="294.43">it on after the fact really what that</span> <span data-start="294.43" data-end="295.93">allows you to do is configure your</span> <span data-start="295.93" data-end="298.09">clients once and then share them with</span> <span data-start="298.09" data-end="302.11">your application so digging into what</span> <span data-start="302.11" data-end="304.72">actually an interceptor is it kind of</span> <span data-start="304.72" data-end="306.58">just talked about that so let's actually</span> <span data-start="306.58" data-end="308.86">show one so in this case we basically</span> <span data-start="308.86" data-end="311.62">start with the rest client and then</span> <span data-start="311.62" data-end="313.419">we're going to chain off of that the</span> <span data-start="313.419" data-end="315.76">basic auth interceptor and to that</span> <span data-start="315.76" data-end="317.2">interceptor we give it a little bit of</span> <span data-start="317.2" data-end="318.61">configuration so we can give it a</span> <span data-start="318.61" data-end="321.22">username and the password then basically</span> <span data-start="321.22" data-end="323.86">we get back a resulting client and that</span> <span data-start="323.86" data-end="325.51">client again is just another function</span> <span data-start="325.51" data-end="327.82">where you can pass the same request</span> <span data-start="327.82" data-end="330.19">structure to and basically what happens</span> <span data-start="330.19" data-end="332.11">under the hood is that before making</span> <span data-start="332.11" data-end="335.02">that request it'll actually apply that</span> <span data-start="335.02" data-end="336.64">using password and actually authenticate</span> <span data-start="336.64" data-end="339.61">it for you so that the response is the</span> <span data-start="339.61" data-end="341.62">authenticated resource instead of just</span> <span data-start="341.62" data-end="345.97">anonymous resource so what can</span> <span data-start="345.97" data-end="347.62">interceptors do you know really just</span> <span data-start="347.62" data-end="349.18">about anything so they fundamentally</span> <span data-start="349.18" data-end="351.43">hook and intercept into the requester</span> <span data-start="351.43" data-end="353.8">relax respond to life cycle so that they</span> <span data-start="353.8" data-end="355.66">can either augment a request response or</span> <span data-start="355.66" data-end="358.78">replace it entirely they can follow the</span> <span data-start="358.78" data-end="360.55">natural chain of interceptors or they</span> <span data-start="360.55" data-end="361.9">can replace it and send them somewhere</span> <span data-start="361.9" data-end="364.919">off its somewhere completely different</span> <span data-start="364.919" data-end="367.3">they can also detect and recover from</span> <span data-start="367.3" data-end="369.25">air sea and promises has the notion of a</span> <span data-start="369.25" data-end="371.289">successful resolution versus an air</span> <span data-start="371.289" data-end="374.5">state so it can push that promise into</span> <span data-start="374.5" data-end="376.419">one or the other states and of course it</span> <span data-start="376.419" data-end="378.52">can also abort the request if you don't</span> <span data-start="378.52" data-end="381.88">want to wait for it anymore so the only</span> <span data-start="381.88" data-end="383.8">thing interceptors really can't do is</span> <span data-start="383.8" data-end="385.99">alter another configured client because</span> <span data-start="385.99" data-end="387.91">a client is just a function functions</span> <span data-start="387.91" data-end="389.95">closure you can't manipulate it once</span> <span data-start="389.95" data-end="392.02">it's created so that's actually also</span> <span data-start="392.02" data-end="394.27">what makes it safe to take a client</span> <span data-start="394.27" data-end="396.4">that's bumped configured and share it</span> <span data-start="396.4" data-end="402.4">with that within your application so out</span> <span data-start="402.4" data-end="403.63">of the box we have several different</span> <span data-start="403.63" data-end="405.46">interceptors some of them are just low</span> <span data-start="405.46" data-end="407.65">level basic things like being able to</span> <span data-start="407.65" data-end="408.97">default different portions of the</span> <span data-start="408.97" data-end="411.34">request like if you always want to add</span> <span data-start="411.34" data-end="413.02">certain headers to your request you know</span> <span data-start="413.02" data-end="414.97">you can do that or if you only really</span> <span data-start="414.97" data-end="417.16">care about the response entity instead</span> <span data-start="417.16" data-end="418.66">of the response headers and other meta</span> <span data-start="418.66" data-end="421.96">information like the status code there's</span> <span data-start="421.96" data-end="425.29">restful interceptors so there's a mime</span> <span data-start="425.29" data-end="426.64">interceptor that handles content</span> <span data-start="426.64" data-end="429.01">negotiation so I mean that ends up being</span> <span data-start="429.01" data-end="432.94">also kind of a nice feature you know in</span> </p>
<p><span data-start="432.94" data-end="434.53">HTTP what you're supposed to do</span> <span data-start="434.53" data-end="436.75">typically is set the accepts header on</span> <span data-start="436.75" data-end="438.76">the request that says what I'm</span> <span data-start="438.76" data-end="440.71">interested in receiving in terms of a</span> <span data-start="440.71" data-end="442.75">content type then the server decides</span> <span data-start="442.75" data-end="446.47">okay you wanted application Jason I know</span> <span data-start="446.47" data-end="448.48">how to create a patient Jason so well as</span> <span data-start="448.48" data-end="451.06">what I'll give you but then the receiver</span> <span data-start="451.06" data-end="453.52">sets the response content type as</span> <span data-start="453.52" data-end="456.01">application Jason when it sends back the</span> <span data-start="456.01" data-end="458.02">response so this header there this</span> <span data-start="458.02" data-end="460.6">interceptor also parses the response</span> <span data-start="460.6" data-end="463.93">based off of a return concept type so</span> <span data-start="463.93" data-end="466.6">many other libraries will just say I'm</span> <span data-start="466.6" data-end="467.8">just going to assume that I'm going to</span> <span data-start="467.8" data-end="471.01">get back Jason and if it gives back</span> </p>
<p><span data-start="471.01" data-end="472.81">Jason it works if you get back something</span> <span data-start="472.81" data-end="475.75">else you know many servers if you have a</span> <span data-start="475.75" data-end="478.09">500 air will give you back HTML by</span> <span data-start="478.09" data-end="479.98">default it'll still try and parse that</span> <span data-start="479.98" data-end="483.72">as Jason and you get an even bigger air</span> <span data-start="483.72" data-end="486.4">also in terms of authentication sought a</span> <span data-start="486.4" data-end="488.44">basic off interceptor there's also an</span> <span data-start="488.44" data-end="491.41">Olaf interceptor in terms of errors we</span> <span data-start="491.41" data-end="494.2">have to basically the ability to trigger</span> <span data-start="494.2" data-end="496.75">air is based off the response code the</span> <span data-start="496.75" data-end="499.93">ability to retry failed requests as well</span> <span data-start="499.93" data-end="503.41">as to just timeout and stop then finally</span> <span data-start="503.41" data-end="505.81">some of the fall backs support for a</span> <span data-start="505.81" data-end="509.58">JSONP for Jason P based services</span> <span data-start="509.58" data-end="511.83">obviously that one's browser only and</span> <span data-start="511.83" data-end="514.419">within IE have support for cross the</span> <span data-start="514.419" data-end="518.71">main request as well as trying to you</span> <span data-start="518.71" data-end="521.62">use the activex a check xhr support for</span> <span data-start="521.62" data-end="525.16">older versions of ie so basically you</span> <span data-start="525.16" data-end="526.51">just add those interceptors and just</span> <span data-start="526.51" data-end="529.93">does it correct so interceptors also</span> <span data-start="529.93" data-end="531.58">really easy to create your own and</span> <span data-start="531.58" data-end="534.28">configure your own so fundamentally it's</span> <span data-start="534.28" data-end="536.11">just a function that you give it a few</span> <span data-start="536.11" data-end="538.15">other functions so just a few different</span> <span data-start="538.15" data-end="541.69">phases of the request so most of the</span> <span data-start="541.69" data-end="543.25">time you know you're going to deal with</span> <span data-start="543.25" data-end="545.26">either the requested a response phase of</span> <span data-start="545.26" data-end="547.27">the interceptor so that means is when a</span> <span data-start="547.27" data-end="549.31">request is going in that function will</span> <span data-start="549.31" data-end="551.38">be called and then you can choose to</span> <span data-start="551.38" data-end="554.59">return either just a modified request or</span> <span data-start="554.59" data-end="556.42">you can actually trace it with something</span> <span data-start="556.42" data-end="558.58">entirely else and any of these phases</span> <span data-start="558.58" data-end="560.38">you can always return a promise for a</span> <span data-start="560.38" data-end="562.03">future value if you need to go off and</span> <span data-start="562.03" data-end="565.09">do some other asynchronous work within</span> <span data-start="565.09" data-end="566.83">the request and response interceptors</span> <span data-start="566.83" data-end="568.99">you also or phases of the Interceptor</span> <span data-start="568.99" data-end="570.61">you also get access to a configuration</span> <span data-start="570.61" data-end="572.2">object so for that basic auth</span> <span data-start="572.2" data-end="573.37">interceptor we were passing in a</span> <span data-start="573.37" data-end="575.65">username and password configuration so</span> <span data-start="575.65" data-end="577.75">those become available in these</span> <span data-start="577.75" data-end="579.64">callbacks and you can parcel map used as</span> <span data-start="579.64" data-end="582.61">as values success and error is really</span> <span data-start="582.61" data-end="584.8">just specializations of response so</span> <span data-start="584.8" data-end="587.61">whether or not the promise of the parent</span> <span data-start="587.61" data-end="590.5">client was in their successful state or</span> <span data-start="590.5" data-end="594.01">whether was in a narrow state so what</span> <span data-start="594.01" data-end="595.3">does it interceptor actually look like</span> <span data-start="595.3" data-end="597.37">in real life they're very very simple</span> <span data-start="597.37" data-end="600.13">the other way it's set up is that you</span> <span data-start="600.13" data-end="602.65">know you want to plot do and just like</span> <span data-start="602.65" data-end="603.91">any other type of programming in the</span> <span data-start="603.91" data-end="605.23">function you want it to do one thing and</span> <span data-start="605.23" data-end="608.17">you want to do it well so for a basic</span> <span data-start="608.17" data-end="610.54">auth interceptor really all we're doing</span> <span data-start="610.54" data-end="611.71">is getting access to their request</span> <span data-start="611.71" data-end="614.59">headers object trying to figure out the</span> <span data-start="614.59" data-end="615.91">username and password that we want to</span> <span data-start="615.91" data-end="617.38">use it will look on the request object</span> <span data-start="617.38" data-end="619.27">first otherwise it falls back to the</span> <span data-start="619.27" data-end="621.25">config and then finally you know</span> <span data-start="621.25" data-end="623.35">assuming that a user name is provided</span> <span data-start="623.35" data-end="625.57">it'll actually set the authorization</span> <span data-start="625.57" data-end="628.48">header basically encoding basics before</span> <span data-start="628.48" data-end="630.76">the username and password together and</span> <span data-start="630.76" data-end="632.35">it finally returns that response back</span> <span data-start="632.35" data-end="636.71">through and the request continues on</span> <span data-start="636.72" data-end="641.2">so within these interceptors you know</span> <span data-start="641.2" data-end="642.64">because we have interceptors that have</span> <span data-start="642.64" data-end="645.279">small chunks of behavior we really want</span> <span data-start="645.279" data-end="647.05">to be able to apply them together in</span> <span data-start="647.05" data-end="649.12">aggregate so the notion of chaining</span> <span data-start="649.12" data-end="650.77">interceptors together becomes really</span> <span data-start="650.77" data-end="652.209">important you can basically create a</span> <span data-start="652.209" data-end="655.42">pipeline of behavior that gets applied</span> <span data-start="655.42" data-end="657.339">to the request and response as it flows</span> <span data-start="657.339" data-end="662.98">through that interceptor chain so what</span> <span data-start="662.98" data-end="665.86">does it actually look like so</span> <span data-start="665.86" data-end="668.32">essentially it's just you know you get a</span> <span data-start="668.32" data-end="670.839">client and there's a method on that</span> <span data-start="670.839" data-end="673.33">client called chain which you can give</span> <span data-start="673.33" data-end="675.37">the interceptor implementation as well</span> <span data-start="675.37" data-end="677.08">as configuration for the interceptor if</span> <span data-start="677.08" data-end="679.3">it has any so in this case you know</span> <span data-start="679.3" data-end="680.709">we're taking that same basic off</span> <span data-start="680.709" data-end="682.779">interceptor and then we're chaining it</span> <span data-start="682.779" data-end="684.49">in applying the air code interceptor</span> <span data-start="684.49" data-end="686.29">which basically says you know in this</span> <span data-start="686.29" data-end="688.66">case if there's a 500 level or greater</span> <span data-start="688.66" data-end="692.2">response code then take that route value</span> <span data-start="692.2" data-end="693.88">and basically treat it as an error</span> <span data-start="693.88" data-end="696.3">instead of as a successful response and</span> <span data-start="696.3" data-end="698.98">then after that we basically chain in</span> <span data-start="698.98" data-end="700.39">the mime interceptor which is what does</span> <span data-start="700.39" data-end="702.579">the content negotiation and then finally</span> <span data-start="702.579" data-end="703.959">after that we chain in the hay dos</span> <span data-start="703.959" data-end="706.18">interceptor which is what does the hydro</span> <span data-start="706.18" data-end="708.43">media API support so these things</span> <span data-start="708.43" data-end="710.26">together you can figure out exactly what</span> <span data-start="710.26" data-end="712.329">you actually care about in terms of the</span> <span data-start="712.329" data-end="713.62">resource that you're trying to access</span> <span data-start="713.62" data-end="716.5">and you can then figure out what</span> <span data-start="716.5" data-end="717.64">features you need to actually support</span> <span data-start="717.64" data-end="718.99">you can figure out how they apply</span> <span data-start="718.99" data-end="721.209">together so another thing that's really</span> <span data-start="721.209" data-end="726.37">common is to take the the retry client</span> <span data-start="726.37" data-end="727.93">if you're waiting for some resource to</span> <span data-start="727.93" data-end="729.73">become available on the server say like</span> <span data-start="729.73" data-end="732.67">j/s comp registration basically you can</span> <span data-start="732.67" data-end="734.23">just keep checking to see if something's</span> <span data-start="734.23" data-end="737.26">available using some sort of intercept</span> <span data-start="737.26" data-end="738.88">you can set it into a successful or air</span> <span data-start="738.88" data-end="740.829">state if it failed you can retry again</span> <span data-start="740.829" data-end="743.26">and then finally you can set a time out</span> <span data-start="743.26" data-end="745.029">kind of after a blow that to say the</span> <span data-start="745.029" data-end="747.52">whole thing if it takes longer than you</span> <span data-start="747.52" data-end="754.05">know 10 minutes just give up</span> <span data-start="754.06" data-end="756.71">so realistically in practice the other</span> <span data-start="756.71" data-end="759.589">big benefit is that because we have this</span> <span data-start="759.589" data-end="761.39">configuration that's you know configured</span> <span data-start="761.39" data-end="762.589">once and then shared within the</span> <span data-start="762.589" data-end="764.57">application it's really easy to make</span> <span data-start="764.57" data-end="766.43">modifications for things so if we take</span> <span data-start="766.43" data-end="768.56">that previous interceptor and let's say</span> <span data-start="768.56" data-end="770">you know my boss comes to me and says</span> <span data-start="770" data-end="772.37">you know I heard about OAuth I really</span> <span data-start="772.37" data-end="774.29">kind of want you to try and look at you</span> <span data-start="774.29" data-end="775.7">actually utilizing oh off in your</span> <span data-start="775.7" data-end="777.68">application that's something where most</span> </p>
<p><span data-start="777.68" data-end="779.69">HTTP you clients are just going to fall</span> <span data-start="779.69" data-end="781.459">over flat they don't support it out of</span> <span data-start="781.459" data-end="782.87">the box you know you're kind of screwed</span> <span data-start="782.87" data-end="784.82">you have to go find some other client</span> <span data-start="784.82" data-end="787.49">act like you understand excuse me have</span> <span data-start="787.49" data-end="788.75">to go find some other clients actually</span> <span data-start="788.75" data-end="790.91">understands oooff and then figure out</span> <span data-start="790.91" data-end="792.44">whether that understands how to actually</span> <span data-start="792.44" data-end="793.79">interact with everything else that you</span> <span data-start="793.79" data-end="795.76">actually cared about making a request</span> <span data-start="795.76" data-end="797.72">well with rest GS is actually pretty</span> <span data-start="797.72" data-end="799.04">simple basically all we have to do is</span> <span data-start="799.04" data-end="800.839">pop off that basic auth interceptor and</span> <span data-start="800.839" data-end="803.6">apply in the OAuth interceptor and that</span> </p>
<p><span data-start="803.6" data-end="804.95">Oh F interceptor actually has a little</span> <span data-start="804.95" data-end="807.14">bit more config because it off is it a</span> <span data-start="807.14" data-end="809.99">little bit more complex but</span> <span data-start="809.99" data-end="812.24">fundamentally the other interceptors in</span> <span data-start="812.24" data-end="813.709">the chain don't really care what was</span> <span data-start="813.709" data-end="815.899">before them they just get the request in</span> <span data-start="815.899" data-end="818.45">the response and the clients that are</span> <span data-start="818.45" data-end="819.8">actually making the request trying to</span> <span data-start="819.8" data-end="822.26">get back data also don't really need to</span> <span data-start="822.26" data-end="824.51">kindercare that it was Oh auth under the</span> <span data-start="824.51" data-end="827.24">hood the other thing that's really</span> <span data-start="827.24" data-end="828.89">useful here particularly with OAuth</span> <span data-start="828.89" data-end="830.15">because you have to go off to another</span> <span data-start="830.15" data-end="833.39">server to get an off token have that</span> <span data-start="833.39" data-end="838.279">come back synchronously and then be able</span> <span data-start="838.279" data-end="839.63">to actually make requests using that</span> <span data-start="839.63" data-end="842.51">token you know making sure that you're</span> <span data-start="842.51" data-end="844.43">using the same token for every single</span> <span data-start="844.43" data-end="847.43">request becomes really useful so having</span> <span data-start="847.43" data-end="849.56">one interceptor near the root of your</span> <span data-start="849.56" data-end="851.24">chain that the rest of your application</span> <span data-start="851.24" data-end="852.92">can use and share becomes really</span> <span data-start="852.92" data-end="854.3">valuable because then the rest of your</span> <span data-start="854.3" data-end="856.19">application can benefit from that token</span> <span data-start="856.19" data-end="860.659">that got captured and cashed</span> <span data-start="860.669" data-end="866.499">so kind of switching up a little bit you</span> <span data-start="866.499" data-end="869.949">know HTTP is just one thing that we have</span> <span data-start="869.949" data-end="872.499">to use as clients HTTP is really good</span> <span data-start="872.499" data-end="874.929">for resources it's not really good for</span> <span data-start="874.929" data-end="877.929">events an event based data transmission</span> <span data-start="877.929" data-end="881.319">back between servers you know if there</span> <span data-start="881.319" data-end="882.549">was an event and we actually were</span> <span data-start="882.549" data-end="884.41">running server side you know maybe we</span> <span data-start="884.41" data-end="885.999">would use a web hook to be notified of</span> <span data-start="885.999" data-end="888.549">that something happened on the client we</span> <span data-start="888.549" data-end="889.959">don't have that option there's no way</span> <span data-start="889.959" data-end="891.939">for the server to you know establish</span> <span data-start="891.939" data-end="895.089">connection back to the client so</span> <span data-start="895.089" data-end="896.439">typically what people do instead is</span> <span data-start="896.439" data-end="898.359">obviously they use web sockets you know</span> </p>
<p><span data-start="898.359" data-end="900.1">WebSocket supports full bi-directional</span> <span data-start="900.1" data-end="902.41">communication you know client server to</span> <span data-start="902.41" data-end="906.759">client client to server but the problem</span> <span data-start="906.759" data-end="908.919">with WebSocket libraries at least the</span> <span data-start="908.919" data-end="911.109">ones that exist today is that they</span> <span data-start="911.109" data-end="913.419">extract sending receiving of messages</span> <span data-start="913.419" data-end="915.279">from client to server but they really</span> <span data-start="915.279" data-end="917.739">don't help you deal with messaging once</span> <span data-start="917.739" data-end="919.419">you receive the message off of that</span> <span data-start="919.419" data-end="922.689">socket this is something that the</span> <span data-start="922.689" data-end="923.979">server-side world has been dealing with</span> <span data-start="923.979" data-end="926.35">for a long time and there's a book</span> <span data-start="926.35" data-end="927.669">called enterprise integration patterns</span> <span data-start="927.669" data-end="930.999">this is basically the Gang of Four for</span> <span data-start="930.999" data-end="933.699">messaging and ability provides a bunch</span> <span data-start="933.699" data-end="935.919">of simple patterns to really support</span> <span data-start="935.919" data-end="938.559">messaging oriented programming and don't</span> <span data-start="938.559" data-end="940.119">let the word Enterprise scare you I mean</span> <span data-start="940.119" data-end="942.399">it come came out of enterprise computing</span> <span data-start="942.399" data-end="944.739">but these patterns are really simple and</span> <span data-start="944.739" data-end="947.109">if you're using amqp year zeromq or</span> <span data-start="947.109" data-end="949.72">activemq today you know that's kind of</span> <span data-start="949.72" data-end="951.429">really what those concepts are built</span> <span data-start="951.429" data-end="955.359">around so another library out there is</span> <span data-start="955.359" data-end="957.279">called messages j/s it's also part of</span> </p>
<p><span data-start="957.279" data-end="959.41">Cujo and it's really an implementation</span> <span data-start="959.41" data-end="961.47">of the enterprise integration patterns</span> <span data-start="961.47" data-end="964.269">that really give you the core primitives</span> <span data-start="964.269" data-end="968.709">of messaging so beyond that there's also</span> <span data-start="968.709" data-end="970.739">adapters to other types of messaging</span> <span data-start="970.739" data-end="973.749">systems once you want to leave your</span> <span data-start="973.749" data-end="975.549">local world and move over and network to</span> <span data-start="975.549" data-end="977.739">something else so web sockets happens to</span> <span data-start="977.739" data-end="980.649">be one of those adapters but let's kind</span> <span data-start="980.649" data-end="982.329">of look at just a brief hello world of</span> <span data-start="982.329" data-end="983.499">what it looks like in a messaging</span> <span data-start="983.499" data-end="985.929">environment so you know the first thing</span> <span data-start="985.929" data-end="987.879">we have to do is require messages and</span> <span data-start="987.879" data-end="990.669">then we basically get a new bus credit</span> <span data-start="990.669" data-end="991.579">message</span> <span data-start="991.579" data-end="993.66">so that's not something that strictly</span> <span data-start="993.66" data-end="995.97">required the messages object is itself a</span> <span data-start="995.97" data-end="998.489">bus but when you chain a new bus off of</span> <span data-start="998.489" data-end="1000.379">it you can get a local scope so all of</span> <span data-start="1000.379" data-end="1001.729">your names are isolated and don't</span> <span data-start="1001.729" data-end="1005.689">collide with anything else so on a bus</span> <span data-start="1005.689" data-end="1008.269">we're going to define two channels so in</span> <span data-start="1008.269" data-end="1009.589">this case we have a channel called lower</span> <span data-start="1009.589" data-end="1011.599">case in a channel upper case so a</span> <span data-start="1011.599" data-end="1013.279">channel is just a place where messages</span> <span data-start="1013.279" data-end="1016.249">are sent to and other handlers can</span> <span data-start="1016.249" data-end="1019.729">subscribe to that channel then we</span> <span data-start="1019.729" data-end="1022.309">basically have a transformer so that</span> <span data-start="1022.309" data-end="1024.86">transformer is basically has a function</span> <span data-start="1024.86" data-end="1027.289">that gets a message and then does</span> <span data-start="1027.289" data-end="1028.97">something to that message and returns it</span> <span data-start="1028.97" data-end="1031.159">so in this case basically getting a</span> <span data-start="1031.159" data-end="1033.35">string and we're calling to uppercase on</span> <span data-start="1033.35" data-end="1035.689">it and then in that transformer</span> <span data-start="1035.689" data-end="1038.059">basically has a couple configuration</span> <span data-start="1038.059" data-end="1040.49">parameters called input and output these</span> <span data-start="1040.49" data-end="1042.019">are the channels that we want to</span> <span data-start="1042.019" data-end="1044.24">subscribe to so input is the channel</span> <span data-start="1044.24" data-end="1045.949">that we want to subscribe to and an</span> <span data-start="1045.949" data-end="1047.36">output is the channel that we want to</span> <span data-start="1047.36" data-end="1049.399">send to once we've done our work with</span> <span data-start="1049.399" data-end="1053.539">that message and then we have an</span> <span data-start="1053.539" data-end="1055.07">outbound adapter which is basically just</span> <span data-start="1055.07" data-end="1056.87">a way of getting messages out of the</span> <span data-start="1056.87" data-end="1059.96">message bus back into regular code so in</span> <span data-start="1059.96" data-end="1061.19">this case we're base which is calling</span> <span data-start="1061.19" data-end="1063.47">console dot log and subscribing it to</span> <span data-start="1063.47" data-end="1065.75">the uppercase channel and then finally</span> <span data-start="1065.75" data-end="1069.11">we're going to call bus send to send a</span> <span data-start="1069.11" data-end="1070.879">new message to the lower case channel</span> <span data-start="1070.879" data-end="1073.1">say hello world then ultimately what</span> <span data-start="1073.1" data-end="1075.11">happens is it prints out hello world</span> <span data-start="1075.11" data-end="1078.35">capitalized and that's probably a ton of</span> <span data-start="1078.35" data-end="1083.539">work for a hello world and yes it is you</span> <span data-start="1083.539" data-end="1085.669">know for very simple use cases you know</span> <span data-start="1085.669" data-end="1087.889">these patterns are probably overkill but</span> <span data-start="1087.889" data-end="1090.919">they really become powerful once you can</span> <span data-start="1090.919" data-end="1092.629">actually have the need for decoupling</span> <span data-start="1092.629" data-end="1095.659">your application your system zis way we</span> <span data-start="1095.659" data-end="1097.34">will show an example of how that power</span> <span data-start="1097.34" data-end="1100.909">really pays off in a bit so there's</span> <span data-start="1100.909" data-end="1102.47">several other primitives talked about a</span> <span data-start="1102.47" data-end="1105.379">few of them you know channel there's</span> <span data-start="1105.379" data-end="1107.57">several different types of channels the</span> <span data-start="1107.57" data-end="1109.429">channel that we used by default it's</span> <span data-start="1109.429" data-end="1112.22">basically a point-to-point channel so if</span> <span data-start="1112.22" data-end="1113.69">you have multiple subscribers of that</span> <span data-start="1113.69" data-end="1115.25">channel for each message that goes in</span> <span data-start="1115.25" data-end="1117.769">the message goes out to one of those</span> <span data-start="1117.769" data-end="1120.559">subscribers also have pub/sub channels</span> <span data-start="1120.559" data-end="1122.539">you know message comes in everyone who</span> <span data-start="1122.539" data-end="1123.399">subscribed get them</span> <span data-start="1123.399" data-end="1125.95">in exchange channels which basically</span> <span data-start="1125.95" data-end="1127.739">allow you to do topic based routing</span> <span data-start="1127.739" data-end="1130.719">either based off of just some dynamic</span> <span data-start="1130.719" data-end="1132.94">key or some pattern if you want to</span> <span data-start="1132.94" data-end="1136.299">subscribe to similar to how AM PP has a</span> <span data-start="1136.299" data-end="1141.279">topic exchanges routing keys I'm also</span> <span data-start="1141.279" data-end="1142.869">have notion of a Q channel if you don't</span> <span data-start="1142.869" data-end="1144.249">want to have to deal with messages right</span> <span data-start="1144.249" data-end="1145.659">away and you want to buffer them up and</span> <span data-start="1145.659" data-end="1150.309">then pull them off as needed so within</span> <span data-start="1150.309" data-end="1151.45">the channels you can subscribe</span> <span data-start="1151.45" data-end="1153.729">unsubscribe there's also the mission of</span> <span data-start="1153.729" data-end="1155.469">tapping a channel if you want to be</span> <span data-start="1155.469" data-end="1157.059">notified every single time a message</span> <span data-start="1157.059" data-end="1158.619">comes in it's really useful for logging</span> <span data-start="1158.619" data-end="1161.919">and other types of auditing and then</span> <span data-start="1161.919" data-end="1163.149">beyond channels there's a notion of</span> <span data-start="1163.149" data-end="1165.339">handlers and handlers are things that</span> <span data-start="1165.339" data-end="1168.339">actually do things with messages so we</span> <span data-start="1168.339" data-end="1170.549">saw a transformer there's also filtering</span> <span data-start="1170.549" data-end="1173.979">routing splitting aggregating basically</span> <span data-start="1173.979" data-end="1175.539">everything you kind of want to do with a</span> <span data-start="1175.539" data-end="1178.509">message basically that's a handler then</span> <span data-start="1178.509" data-end="1179.739">finally we have inbound outbound</span> <span data-start="1179.739" data-end="1181.479">adapters as well as inbound and outbound</span> <span data-start="1181.479" data-end="1183.969">gateways inbound is coming into the</span> <span data-start="1183.969" data-end="1185.259">message bus out bounds going out of the</span> <span data-start="1185.259" data-end="1187.149">message bus adapters are typically</span> <span data-start="1187.149" data-end="1190.239">unidirectional just you know what's</span> <span data-start="1190.239" data-end="1193.479">fire-and-forget gateways typically are</span> <span data-start="1193.479" data-end="1196.69">more request reply oriented so basically</span> <span data-start="1196.69" data-end="1200.82">it establishes a promise for a response</span> <span data-start="1200.82" data-end="1202.809">so let's kind of look at what this</span> <span data-start="1202.809" data-end="1206.379">actually ends up looking like so had a</span> <span data-start="1206.379" data-end="1208.45">use case where basically had a server</span> <span data-start="1208.45" data-end="1210.429">where for every message that came into</span> <span data-start="1210.429" data-end="1213.039">it we wanted to send it out to every</span> <span data-start="1213.039" data-end="1216.46">single client that was connected so in</span> <span data-start="1216.46" data-end="1218.289">this case we have you know messages</span> <span data-start="1218.289" data-end="1220.33">again as well as a WebSocket server</span> <span data-start="1220.33" data-end="1223.69">library realistically we were using</span> <span data-start="1223.69" data-end="1225.489">stock j/s in this case as a server but</span> <span data-start="1225.489" data-end="1227.979">it could be just about anything so we're</span> <span data-start="1227.979" data-end="1229.659">establishing to pub subchannels this</span> <span data-start="1229.659" data-end="1232.149">time metro message is coming from the</span> <span data-start="1232.149" data-end="1233.739">client and then messages that we want to</span> <span data-start="1233.739" data-end="1237.789">stand back down to the client and then</span> <span data-start="1237.789" data-end="1240.279">we have a web based on the WebSocket</span> <span data-start="1240.279" data-end="1242.71">server for every connection we want to</span> <span data-start="1242.71" data-end="1246.309">take that connection and we have a node</span> <span data-start="1246.309" data-end="1248.429">stream gateway so basically this is a</span> <span data-start="1248.429" data-end="1251.2">message a set of messaging adapters that</span> <span data-start="1251.2" data-end="1254.289">for the notes dream API can basically</span> <span data-start="1254.289" data-end="1255.41">take every mess</span> <span data-start="1255.41" data-end="1257.75">coming in and put it to the Alpha</span> </p>
<p><span data-start="1257.75" data-end="1259.1">Channel and every message that's going</span> <span data-start="1259.1" data-end="1263.15">out and put it to the input channel so</span> <span data-start="1263.15" data-end="1265.64">basically what we're seeing here is on</span> <span data-start="1265.64" data-end="1267.26">that bus we're establishing the Gateway</span> <span data-start="1267.26" data-end="1269.69">for that connection all the messages</span> <span data-start="1269.69" data-end="1271.76">that are coming in get sent to the from</span> <span data-start="1271.76" data-end="1273.32">Channel client because this is on the</span> <span data-start="1273.32" data-end="1274.88">server we're going to going out goes</span> <span data-start="1274.88" data-end="1276.77">like the other way and then finally what</span> <span data-start="1276.77" data-end="1278.63">we're doing is we're forwarding the from</span> <span data-start="1278.63" data-end="1281.08">client channel to the to client channel</span> <span data-start="1281.08" data-end="1283.25">so basically everything that comes from</span> <span data-start="1283.25" data-end="1285.59">a client goes directly back to a client</span> <span data-start="1285.59" data-end="1287.93">and because it's pops up every client to</span> <span data-start="1287.93" data-end="1289.46">subscribe gets every message that was</span> <span data-start="1289.46" data-end="1292.28">received so but there's also a fatal</span> <span data-start="1292.28" data-end="1295.43">flaw in here if anybody sees it and it's</span> <span data-start="1295.43" data-end="1298.31">that you know we're running within a</span> <span data-start="1298.31" data-end="1299.84">single process in the single instance</span> <span data-start="1299.84" data-end="1301.82">and you know we're only going to be</span> <span data-start="1301.82" data-end="1303.41">getting the connections and subscribing</span> <span data-start="1303.41" data-end="1306.02">them to the bus if they happen to be on</span> <span data-start="1306.02" data-end="1308.93">the same local node so typically what</span> <span data-start="1308.93" data-end="1311.24">you want to do is have some other</span> <span data-start="1311.24" data-end="1314.24">messaging gateway on your back-end</span> <span data-start="1314.24" data-end="1316.67">server so in this case we're going to</span> <span data-start="1316.67" data-end="1319.69">introduce Redis for a very basic pub/sub</span> <span data-start="1319.69" data-end="1322.4">so you know requiring the reddest client</span> <span data-start="1322.4" data-end="1324.98">and one of the other adapters that we</span> <span data-start="1324.98" data-end="1328.25">have set up is for a Redis gateway so</span> <span data-start="1328.25" data-end="1329.66">everything else is the same in terms of</span> <span data-start="1329.66" data-end="1331.13">how we're interacting with the WebSocket</span> <span data-start="1331.13" data-end="1332.87">and the channels but instead of just</span> <span data-start="1332.87" data-end="1335.33">forwarding from client to client again</span> <span data-start="1335.33" data-end="1337.88">we're actually going to take that those</span> <span data-start="1337.88" data-end="1340.58">messages and pass them through Redis for</span> <span data-start="1340.58" data-end="1343.1">a very basic pub/sub so messages come</span> <span data-start="1343.1" data-end="1344.99">from the client on the WebSocket end up</span> <span data-start="1344.99" data-end="1346.88">the server from the server gets sent to</span> </p>
<p><span data-start="1346.88" data-end="1349.97">Redis then the though each of those</span> <span data-start="1349.97" data-end="1351.32">server nodes is then configured to</span> <span data-start="1351.32" data-end="1352.97">connect to Reddit and receive messages</span> <span data-start="1352.97" data-end="1356.51">back off of that bus and then those</span> <span data-start="1356.51" data-end="1358.31">messages get sent back to every single</span> <span data-start="1358.31" data-end="1364.94">client then on the client side you know</span> <span data-start="1364.94" data-end="1366.8">again we're going to use sock Jess and</span> <span data-start="1366.8" data-end="1368.09">again you know this code should look</span> <span data-start="1368.09" data-end="1369.8">very familiar and this you know it's the</span> <span data-start="1369.8" data-end="1371.24">exact same API is the exact same</span> <span data-start="1371.24" data-end="1373.1">programming model whether your client or</span> <span data-start="1373.1" data-end="1375.11">server but in this case we have a</span> <span data-start="1375.11" data-end="1377.15">WebSocket gateway setup and that's just</span> <span data-start="1377.15" data-end="1378.95">a set of adapters that and understand</span> <span data-start="1378.95" data-end="1384.17">the w3c web socket API so in this case</span> <span data-start="1384.17" data-end="1385.73">you know it expects to begin</span> <span data-start="1385.73" data-end="1388.28">a WebSocket connection so I'm using soft</span> <span data-start="1388.28" data-end="1390.23">j s so we can get HTTP fallbacks and</span> <span data-start="1390.23" data-end="1392.21">other things in addition to just raw</span> <span data-start="1392.21" data-end="1396.32">native web sockets and you know again</span> <span data-start="1396.32" data-end="1399.29">you know the the up the input and output</span> <span data-start="1399.29" data-end="1401.99">channels are setup subnets just come to</span> <span data-start="1401.99" data-end="1403.94">and from the server and we can interact</span> <span data-start="1403.94" data-end="1407.87">with them so still have a couple minutes</span> <span data-start="1407.87" data-end="1410.12">if you actually want to see this running</span> <span data-start="1410.12" data-end="1413.03">you can go to Jas comp cloud foundry com</span> <span data-start="1413.03" data-end="1415.01">and I actually have that code running</span> <span data-start="1415.01" data-end="1418.19">what you'll see is there's a little</span> <span data-start="1418.19" data-end="1419.69">circle that will pop up for every user</span> <span data-start="1419.69" data-end="1421.76">and as you move your mouse around the</span> <span data-start="1421.76" data-end="1423.92">circle will follow you and basically</span> <span data-start="1423.92" data-end="1425.21">what it's doing is it's capturing the</span> <span data-start="1425.21" data-end="1428.12">raw mousemove events on the browser</span> <span data-start="1428.12" data-end="1429.68">sending them up to the server</span> <span data-start="1429.68" data-end="1431.63">distributing them across reddest each of</span> <span data-start="1431.63" data-end="1433.13">the instances on the server something</span> <span data-start="1433.13" data-end="1434.96">them back down so this application is</span> <span data-start="1434.96" data-end="1436.73">actually running with three instances up</span> <span data-start="1436.73" data-end="1440.21">on cloud foundry and it's the circles</span> <span data-start="1440.21" data-end="1443.75">app sample app in within KU jjs if you</span> <span data-start="1443.75" data-end="1445.22">actually want to go grab the source for</span> <span data-start="1445.22" data-end="1449">it and with that i just want to say</span> <span data-start="1449" data-end="1451.52">thanks if you have any questions I guess</span> </p>
<p><span data-start="1451.52" data-end="1457.82">I have a minute all right so if anyone</span> <span data-start="1457.82" data-end="1459.5">wants to talk further just feel free to</span> <span data-start="1459.5" data-end="1460.85">grab me I'll be here for the rest of the</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
