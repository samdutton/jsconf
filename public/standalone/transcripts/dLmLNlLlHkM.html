<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dLmLNlLlHkM</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/dLmLNlLlHkM?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="2.48" data-end="5.97">hello everyone thank you all for coming</span> <span data-start="5.97" data-end="9.03">I'm so excited to be here Budapest is a</span> <span data-start="9.03" data-end="12.15">beautiful city I'm from San Francisco my</span> <span data-start="12.15" data-end="14.099">name is Ahmad le â€” I'm software engineer</span> <span data-start="14.099" data-end="15.87">and web / experienced team at Pinterest</span> <span data-start="15.87" data-end="18.06">and one of the projects that I've been</span> <span data-start="18.06" data-end="20.58">working on last year is react migration</span> <span data-start="20.58" data-end="23.31">and today I'm going to tell you a story</span> <span data-start="23.31" data-end="25.89">about our journey to react we'll take a</span> <span data-start="25.89" data-end="27.63">look into challenges we faced and</span> <span data-start="27.63" data-end="29.16">techniques we used while migrating</span> <span data-start="29.16" data-end="31.65">pinterest profiles to react if you have</span> <span data-start="31.65" data-end="33.39">any questions please make a note and</span> <span data-start="33.39" data-end="35.69">i'll be happy to answer them in the end</span> <span data-start="35.69" data-end="38.37">so today's presentation is broke into</span> <span data-start="38.37" data-end="41.28">four major parts and the first one is</span> <span data-start="41.28" data-end="43.89">about how we why we decided to migrate</span> <span data-start="43.89" data-end="45.87">to react at all and not any other</span> <span data-start="45.87" data-end="49.559">library the second part is about how we</span> <span data-start="49.559" data-end="51.42">had to prepare on our infrastructure</span> <span data-start="51.42" data-end="53.76">first before we were able to build</span> <span data-start="53.76" data-end="56.64">something in reality the third part is</span> <span data-start="56.64" data-end="60.84">about measuring the impact and this</span> <span data-start="60.84" data-end="62.64">pretty important part because during</span> <span data-start="62.64" data-end="64.5">migrations like that you may introduce</span> <span data-start="64.5" data-end="66.689">bugs or break something and you'll never</span> <span data-start="66.689" data-end="68.82">know if you're not measuring the things</span> <span data-start="68.82" data-end="71.34">that you're building and the last part I</span> <span data-start="71.34" data-end="73.77">will share you the details how our life</span> <span data-start="73.77" data-end="76.439">and engineering life has changed after</span> <span data-start="76.439" data-end="82.68">adoption of react so first of all why we</span> <span data-start="82.68" data-end="85.049">had to move away from the existing</span> <span data-start="85.049" data-end="87.24">framework at all and the existing</span> <span data-start="87.24" data-end="89.689">framework Denzel which was built into</span> <span data-start="89.689" data-end="92.61">2013 served us well until a certain</span> <span data-start="92.61" data-end="95.04">period of time but nowadays it's</span> <span data-start="95.04" data-end="97.56">outdated it's very common to many other</span> <span data-start="97.56" data-end="99.36">frameworks that were introduced during</span> <span data-start="99.36" data-end="102.09">the time three four five years ago and</span> <span data-start="102.09" data-end="105.24">it's based on object-oriented JavaScript</span> <span data-start="105.24" data-end="107.49">paradigm and it uses components based</span> <span data-start="107.49" data-end="113.43">here are key so one of the most common</span> <span data-start="113.43" data-end="115.89">questions is why we decided to move to</span> <span data-start="115.89" data-end="118.74">react and not to angular ember or meteor</span> <span data-start="118.74" data-end="121.95">or anything else and on this slide you</span> <span data-start="121.95" data-end="123.78">can see a list of requirements that we</span> <span data-start="123.78" data-end="127.259">head to our new framework and we want to</span> <span data-start="127.259" data-end="129.33">have a framework with a large developer</span> <span data-start="129.33" data-end="131.97">community and react has a huge developer</span> <span data-start="131.97" data-end="133.17">community and</span> <span data-start="133.17" data-end="134.64">to take advantage of these developer</span> <span data-start="134.64" data-end="138.3">community another requirement is design</span> <span data-start="138.3" data-end="141.239">patterns and react is very compatible</span> <span data-start="141.239" data-end="144.93">with our legacy stack and it makes the</span> <span data-start="144.93" data-end="147.18">emigration to many other frameworks much</span> <span data-start="147.18" data-end="151.77">easier the third requirement is solution</span> <span data-start="151.77" data-end="153.959">for isomorphism or so-called Universal</span> <span data-start="153.959" data-end="156.45">rendering and now we'll tell you later</span> <span data-start="156.45" data-end="159.9">why this is so important for us and in</span> <span data-start="159.9" data-end="162.15">that requirement is performance and</span> <span data-start="162.15" data-end="163.98">react is well known for its performance</span> <span data-start="163.98" data-end="165.66">benefits you probably heard about</span> <span data-start="165.66" data-end="168.18">virtual Dom and reconciliation algorithm</span> <span data-start="168.18" data-end="171.54">and so and so forth and the last thing</span> <span data-start="171.54" data-end="175.41">is developer experience and this is our</span> <span data-start="175.41" data-end="178.26">old legacy stack and you might have</span> <span data-start="178.26" data-end="180.09">something similar in your project we</span> <span data-start="180.09" data-end="182.76">have Python junga web server ginger</span> <span data-start="182.76" data-end="184.86">renderer on the back end nine checks on</span> <span data-start="184.86" data-end="187.79">the client and it's old as well but</span> <span data-start="187.79" data-end="191.489">being on board with all of these like</span> <span data-start="191.489" data-end="193.319">mojo bundler Redux</span> <span data-start="193.319" data-end="196.41">just unit tests and many other tools and</span> <span data-start="196.41" data-end="198.93">features has completely changed the way</span> <span data-start="198.93" data-end="203.22">we develop our modern web apps so just</span> <span data-start="203.22" data-end="205.079">to give you an idea of scale that we</span> <span data-start="205.079" data-end="208.26">operated we have 200 200 millions of</span> <span data-start="208.26" data-end="211.53">monthly active users which is more than</span> <span data-start="211.53" data-end="213.42">population of the biggest country in the</span> <span data-start="213.42" data-end="218.34">world Russia we serve more than 150,000</span> <span data-start="218.34" data-end="223.89">requests per second and since we</span> <span data-start="223.89" data-end="226.56">constantly ship new features we run</span> <span data-start="226.56" data-end="228.9">hundreds of experiments we can't just</span> <span data-start="228.9" data-end="231.63">simply freeze our product development in</span> <span data-start="231.63" data-end="233.489">order to rebuild the new web app from</span> <span data-start="233.489" data-end="235.5">scratch and react and while it's</span> <span data-start="235.5" data-end="237.51">relatively easy to build a new web app</span> <span data-start="237.51" data-end="240.81">in react changing a service immigrating</span> <span data-start="240.81" data-end="242.67">service that is constantly changing is</span> <span data-start="242.67" data-end="244.769">like changing engines of an airplane</span> <span data-start="244.769" data-end="247.93">while mid-flight</span> <span data-start="247.94" data-end="252.209">so how how many of you have tried to</span> <span data-start="252.209" data-end="255.18">rewrite your web app from from scratch</span> <span data-start="255.18" data-end="259.32">in any other framework again we see a</span> <span data-start="259.32" data-end="262.32">lot of hands and I try to do this before</span> <span data-start="262.32" data-end="265.169">and ended up in situation when I had old</span> <span data-start="265.169" data-end="267.27">web app which is still in production</span> <span data-start="267.27" data-end="269.819">and many almost hundreds of engineers</span> <span data-start="269.819" data-end="272.009">were completely changing it adding new</span> <span data-start="272.009" data-end="274.56">features and had me new one which is</span> <span data-start="274.56" data-end="276.479">still under development and I had to</span> <span data-start="276.479" data-end="278.52">port all these features back to the to</span> <span data-start="278.52" data-end="280.68">the new one and it's like the constant</span> <span data-start="280.68" data-end="282.569">race condition not the best situation to</span> <span data-start="282.569" data-end="283.819">be in</span> <span data-start="283.819" data-end="287.009">so now how can we avoid this and the</span> <span data-start="287.009" data-end="289.11">only way to avoid this is to rewrite our</span> <span data-start="289.11" data-end="292.05">web app part by part while there the</span> <span data-start="292.05" data-end="294.09">rest is still run by the old framework</span> <span data-start="294.09" data-end="297.9">and now we're coming to this idea of</span> <span data-start="297.9" data-end="301.44">so-called hybrid app it's an app where</span> <span data-start="301.44" data-end="303.419">we have two frameworks and they plug</span> <span data-start="303.419" data-end="305.58">this together together for the time of</span> <span data-start="305.58" data-end="308.31">the migration and thus our engineers</span> <span data-start="308.31" data-end="310.71">will not have to write everything at</span> <span data-start="310.71" data-end="312.599">once they will be able to migrate it</span> <span data-start="312.599" data-end="316.169">piece by piece so now we want to ask</span> <span data-start="316.169" data-end="318.75">question how can we make a hybrid app</span> <span data-start="318.75" data-end="321.18">and the very first thought maybe it's</span> <span data-start="321.18" data-end="323.31">not that complicated but let's take a</span> <span data-start="323.31" data-end="325.379">look at the list of the all possible</span> <span data-start="325.379" data-end="329.31">challenges and the very first challenge</span> <span data-start="329.31" data-end="332.34">is that react is obviously JavaScript</span> <span data-start="332.34" data-end="334.919">framework and how many of you have</span> </p>
<p><span data-start="334.919" data-end="339.509">JavaScript on the server side I can see</span> <span data-start="339.509" data-end="341.669">a little bit of hands but obviously not</span> <span data-start="341.669" data-end="344.31">everyone and having JavaScript on the</span> <span data-start="344.31" data-end="345.9">server side is not a very common thing</span> <span data-start="345.9" data-end="348.36">but having javascript in Python PHP or</span> </p>
<p><span data-start="348.36" data-end="351.06">Java or many other server-side languages</span> <span data-start="351.06" data-end="354.84">is very rare it's obviously not a common</span> <span data-start="354.84" data-end="358.039">at all so in order to enable our</span> <span data-start="358.039" data-end="360.06">JavaScript rendering on the server side</span> <span data-start="360.06" data-end="362.039">we had to prepare infrastructure first</span> <span data-start="362.039" data-end="364.74">and some of you may ask the question why</span> <span data-start="364.74" data-end="366.779">do I actually need so-called Universal</span> <span data-start="366.779" data-end="369.87">or isomorphic rendering and there is two</span> <span data-start="369.87" data-end="370.59">reasons for that</span> <span data-start="370.59" data-end="372.9">first of all our engineers they will not</span> <span data-start="372.9" data-end="375.06">have to write their templates twice so</span> <span data-start="375.06" data-end="377.46">we're saving their work in time and the</span> <span data-start="377.46" data-end="378.719">other reason is yes here</span> <span data-start="378.719" data-end="381.99">and even though nowadays search engines</span> <span data-start="381.99" data-end="385.08">they can execute JavaScript and parse</span> <span data-start="385.08" data-end="387.33">page that is rendered on the client-side</span> <span data-start="387.33" data-end="389.94">we run a bunch of experiments it's still</span> <span data-start="389.94" data-end="392.069">better to serve the initial markup as a</span> <span data-start="392.069" data-end="397.02">string as an HTML string so the second</span> <span data-start="397.02" data-end="399.779">challenge is rendering react components</span> <span data-start="399.779" data-end="401.4">inside of the old</span> <span data-start="401.4" data-end="404.4">and while react is pretty flexible in</span> <span data-start="404.4" data-end="406.199">terms of rendering as long as you can</span> <span data-start="406.199" data-end="408.93">provide it a container Dom element there</span> <span data-start="408.93" data-end="411.3">still might be some challenges and for</span> <span data-start="411.3" data-end="413.28">example what if your template files are</span> <span data-start="413.28" data-end="415.62">stored your what if your templates are</span> <span data-start="415.62" data-end="418.02">started in separate files or what if</span> <span data-start="418.02" data-end="420.09">your templates using a custom made</span> <span data-start="420.09" data-end="422.219">template language and such example is</span> <span data-start="422.219" data-end="424.62">ginger templates in Python and non Dex</span> <span data-start="424.62" data-end="428.58">in JavaScript so the third challenge is</span> <span data-start="428.58" data-end="431.52">dealing with the old resources and more</span> <span data-start="431.52" data-end="434.669">likely in your your your project you</span> <span data-start="434.669" data-end="437.219">have a resource layer which does all the</span> <span data-start="437.219" data-end="439.86">communication with the API and probably</span> <span data-start="439.86" data-end="441.389">you want to reuse it at least for the</span> <span data-start="441.389" data-end="443.279">first period of time unless you want to</span> <span data-start="443.279" data-end="446.099">really rebuild everything from scratch</span> <span data-start="446.099" data-end="448.68">in react and you have to Web Apps as we</span> <span data-start="448.68" data-end="451.11">discussed before so dealing with the old</span> <span data-start="451.11" data-end="454.56">resources is another challenge and the</span> <span data-start="454.56" data-end="457.379">last challenge is how can we make sure</span> <span data-start="457.379" data-end="459.96">that newly created UI and components</span> <span data-start="459.96" data-end="461.4">they're actually performing better than</span> <span data-start="461.4" data-end="464.009">the old ones what if we introduced a bar</span> <span data-start="464.009" data-end="466.529">for performance issues and something is</span> <span data-start="466.529" data-end="469.8">going wrong with the users so here we</span> <span data-start="469.8" data-end="471.779">outline our four main challenges and now</span> <span data-start="471.779" data-end="474.259">let's dive deeper into each of those and</span> <span data-start="474.259" data-end="476.879">before let me give you a high-level</span> <span data-start="476.879" data-end="483.839">overview of our web app architecture as</span> <span data-start="483.839" data-end="486.24">you can see on this slide there is</span> <span data-start="486.24" data-end="489.18">nothing crazy we have a client-side web</span> <span data-start="489.18" data-end="493.199">app Python junga web server and we have</span> <span data-start="493.199" data-end="496.68">pack an API and when a user agent sends</span> <span data-start="496.68" data-end="499.25">a request to the to the server the</span> <span data-start="499.25" data-end="502.77">server renders HTML with ginger render</span> <span data-start="502.77" data-end="505.259">in Python and sends back all this HTML</span> <span data-start="505.259" data-end="507.96">to the client which spawns a bunch of</span> <span data-start="507.96" data-end="511.169">requests for CSS images in JavaScript</span> <span data-start="511.169" data-end="513.81">and many other assets it initializes the</span> <span data-start="513.81" data-end="517.079">app and after that our subsequent</span> <span data-start="517.079" data-end="519.539">requests are handled only only for</span> <span data-start="519.539" data-end="521.76">retrieving the additional data so there</span> <span data-start="521.76" data-end="523.86">is no more subsequent renders on the on</span> <span data-start="523.86" data-end="526.11">the server side all the renders are</span> <span data-start="526.11" data-end="528.54">happening on the client side and because</span> <span data-start="528.54" data-end="530.699">of that we had so-called isomorphic</span> <span data-start="530.699" data-end="534.3">rendering so now let me give you a</span> <span data-start="534.3" data-end="534.69">little bit</span> <span data-start="534.69" data-end="537.33">contacts about ginger rendering engine</span> <span data-start="537.33" data-end="540.72">and Python and nunchucks in JavaScript</span> <span data-start="540.72" data-end="543.42">and these templating languages are very</span> <span data-start="543.42" data-end="546.48">similar almost identical and because of</span> <span data-start="546.48" data-end="548.73">that we had so-called isomorphic</span> <span data-start="548.73" data-end="551.22">rendering and the only one caveat in</span> <span data-start="551.22" data-end="553.32">this approach was that we had to have</span> <span data-start="553.32" data-end="555.12">two sets of utils you can see there is</span> <span data-start="555.12" data-end="557.82">one set youtubes in libraries for python</span> <span data-start="557.82" data-end="559.59">and another one for nunchucks in</span> <span data-start="559.59" data-end="562.59">javascript not the best approach because</span> <span data-start="562.59" data-end="564.96">you have to run tests and do all these</span> <span data-start="564.96" data-end="568.56">things that are not the best how many of</span> <span data-start="568.56" data-end="570.72">you are familiar with nunchucks or</span> <span data-start="570.72" data-end="575.73">ginger at all not that many people but</span> <span data-start="575.73" data-end="578.94">that's fine because I'm gonna go into a</span> <span data-start="578.94" data-end="580.8">high-level overview of this templating</span> <span data-start="580.8" data-end="583.77">language and it's pretty common similar</span> <span data-start="583.77" data-end="586.47">to many other languages on this slide</span> <span data-start="586.47" data-end="588.06">you can see small code snippet we are</span> <span data-start="588.06" data-end="591.42">initializing three variables very common</span> <span data-start="591.42" data-end="594.39">to many template templating languages on</span> <span data-start="594.39" data-end="596.94">this line you can see that we are</span> <span data-start="596.94" data-end="601.71">executing our template and if creating a</span> <span data-start="601.71" data-end="604.77">name is empty the render hello guest</span> <span data-start="604.77" data-end="609.99">welcome to Pinterest and finally on this</span> <span data-start="609.99" data-end="612.75">slide we are rendering a module called</span> <span data-start="612.75" data-end="616.38">home feed and module is a function call</span> <span data-start="616.38" data-end="618.45">in Java C it will be converted to</span> <span data-start="618.45" data-end="620.22">function call in JavaScript which will</span> <span data-start="620.22" data-end="622.83">file home feed module and it will render</span> <span data-start="622.83" data-end="625.5">for us passing all the options as a</span> <span data-start="625.5" data-end="629.49">properties does it look familiar for you</span> <span data-start="629.49" data-end="637.23">know any react people so it seems like</span> <span data-start="637.23" data-end="639.27">this architecture fits very well into</span> <span data-start="639.27" data-end="642.36">each other this is a react code snippet</span> <span data-start="642.36" data-end="645.69">and we reading properties with calling</span> <span data-start="645.69" data-end="648.33">home feed module we passing all the</span> <span data-start="648.33" data-end="650.04">options of the properties as well and</span> <span data-start="650.04" data-end="651.99">home field is not is another function</span> <span data-start="651.99" data-end="656.7">call in react so this looks very it</span> <span data-start="656.7" data-end="658.38">seems like these architectures fits very</span> <span data-start="658.38" data-end="659.49">well into each other</span> <span data-start="659.49" data-end="661.31">but the only one issue is that</span> </p>
<p><span data-start="661.31" data-end="664.17">JavaScript and Python is not commenting</span> <span data-start="664.17" data-end="666.74">at all or any other server-side language</span> <span data-start="666.74" data-end="670.88">because of that is a very first step we</span> <span data-start="670.88" data-end="673.1">enabled non Jax rendering on a</span> <span data-start="673.1" data-end="676.67">standalone node.js server that enables</span> <span data-start="676.67" data-end="678.14">JavaScript rendering on the on the</span> <span data-start="678.14" data-end="681.77">server side this will unblock nunchuks</span> <span data-start="681.77" data-end="683.84">rendering and our engineers would have</span> <span data-start="683.84" data-end="687.02">to rebuild the whole thing at once</span> <span data-start="687.02" data-end="688.94">but they will be able to migrate</span> <span data-start="688.94" data-end="691.07">incrementally rewriting our web app</span> <span data-start="691.07" data-end="696.47">piece by piece as a bonus we can reuse</span> <span data-start="696.47" data-end="698.69">the same youtubes and libraries so there</span> <span data-start="698.69" data-end="700.79">is no more duplicating libraries only in</span> </p>
<p><span data-start="700.79" data-end="705.05">JavaScript no more in Python so now we</span> <span data-start="705.05" data-end="707.93">have a plan for our migration at first</span> <span data-start="707.93" data-end="710.84">will migrate from Gingin Python and X on</span> <span data-start="710.84" data-end="713.39">the client tune and X on the on the</span> <span data-start="713.39" data-end="717.53">server and on the client and now let's</span> <span data-start="717.53" data-end="719.33">take a look how our rendering used to</span> <span data-start="719.33" data-end="721.46">work before we introduced node.js</span> <span data-start="721.46" data-end="724.85">sidebar as I mentioned before our</span> <span data-start="724.85" data-end="727.25">templates are structured as a trees a</span> <span data-start="727.25" data-end="730.01">root module can have children module and</span> <span data-start="730.01" data-end="731.51">children modules can have more children</span> <span data-start="731.51" data-end="734.72">modules and a renderer pass traverses</span> <span data-start="734.72" data-end="737.09">the tree rendering each of these node</span> <span data-start="737.09" data-end="740.44">and combining them into resulting HTML</span> <span data-start="740.44" data-end="743.92">so a user agent sends a request to the</span> <span data-start="743.92" data-end="748.55">to the Python jungle web server then we</span> <span data-start="748.55" data-end="750.38">send a request to the backend API in</span> <span data-start="750.38" data-end="751.94">order to retrieve the initial data for</span> <span data-start="751.94" data-end="755.33">the template and we start rendering our</span> <span data-start="755.33" data-end="758">templating tree so we render it as far</span> <span data-start="758" data-end="760.19">as we can go until additional data is</span> <span data-start="760.19" data-end="765.23">needed at this point worst to mention</span> <span data-start="765.23" data-end="767.66">that this process is CPU blocking so</span> <span data-start="767.66" data-end="769.19">nothing else can be rendered in this</span> <span data-start="769.19" data-end="772.97">process and this happens serially at</span> <span data-start="772.97" data-end="774.89">this point we'll request additional data</span> <span data-start="774.89" data-end="778.52">from the back in API and we continue our</span> <span data-start="778.52" data-end="781.49">rendering as far as we can go until</span> <span data-start="781.49" data-end="782.87">additional data needed and we're</span> <span data-start="782.87" data-end="785.6">requesting additional data and in the</span> <span data-start="785.6" data-end="788.3">end after the whole template is rendered</span> <span data-start="788.3" data-end="792.17">with sending the resulting HTML now</span> <span data-start="792.17" data-end="794.51">let's take a look what happened after we</span> <span data-start="794.51" data-end="797.54">introduced a node.js sidecar as you can</span> <span data-start="797.54" data-end="799.9">see the Harket texture is</span> <span data-start="799.9" data-end="802.33">similar to what we had before but now we</span> <span data-start="802.33" data-end="804.82">have injects proxy layer for load</span> <span data-start="804.82" data-end="808.33">balancing and we have a set of node.js</span> <span data-start="808.33" data-end="814.09">workers as it was before we're sending a</span> <span data-start="814.09" data-end="818.95">request from the user agent and we're</span> <span data-start="818.95" data-end="820.54">requesting the additional data from the</span> </p>
<p><span data-start="820.54" data-end="825.61">API after that we're sending a request</span> <span data-start="825.61" data-end="828.4">over network to our node.js server in</span> <span data-start="828.4" data-end="831.58">order to render our nunchuks template so</span> <span data-start="831.58" data-end="833.8">here where it becomes different we're</span> <span data-start="833.8" data-end="835.69">starting rendering with node.js server</span> <span data-start="835.69" data-end="838.84">over network and that's we were able to</span> <span data-start="838.84" data-end="841.36">enable JavaScript rendering on the</span> <span data-start="841.36" data-end="844.84">server side is it first before it</span> <span data-start="844.84" data-end="846.85">renders the template as far as it is it</span> <span data-start="846.85" data-end="850.42">can go until additional data is needed</span> <span data-start="850.42" data-end="852.49">and at this point it returns back</span> <span data-start="852.49" data-end="854.02">partially rendered template as a</span> <span data-start="854.02" data-end="857.68">response and our Python Django web</span> <span data-start="857.68" data-end="859.39">server requests more data from the</span> <span data-start="859.39" data-end="864.36">backend API so now we repeat the process</span> <span data-start="864.36" data-end="867.58">but the only difference is now we can</span> <span data-start="867.58" data-end="870.61">send multiple requests one for each sub</span> <span data-start="870.61" data-end="873.55">tree in order to paralyze rendering</span> <span data-start="873.55" data-end="877.39">process and we rendered it as far as we</span> <span data-start="877.39" data-end="881.89">can go again and this process is not CPU</span> <span data-start="881.89" data-end="888.58">blocking anymore so after a both sub</span> <span data-start="888.58" data-end="890.68">trees are rendered in parallel we send</span> <span data-start="890.68" data-end="893.44">back independent responses to the to the</span> <span data-start="893.44" data-end="895.9">passenger junga web server and we</span> <span data-start="895.9" data-end="898.32">continue process again and again</span> <span data-start="898.32" data-end="900.46">requesting additional data if it's</span> <span data-start="900.46" data-end="905.5">needed we send multiple requests and we</span> <span data-start="905.5" data-end="906.97">continue rendering until the tree is</span> <span data-start="906.97" data-end="910.09">fully rendered and at this point we send</span> <span data-start="910.09" data-end="914.89">the resulting HTML to the user agent so</span> <span data-start="914.89" data-end="916.63">if you can see the approach is very</span> <span data-start="916.63" data-end="918.52">similar to what we had before but now</span> <span data-start="918.52" data-end="920.8">we're rendering JavaScript templates on</span> <span data-start="920.8" data-end="924.09">a standalone node.js servers server and</span> <span data-start="924.09" data-end="926.83">you can use this approach in many</span> <span data-start="926.83" data-end="929.26">different languages we use it in iPhone</span> <span data-start="929.26" data-end="932.68">but if you are in Java or PHP or you</span> <span data-start="932.68" data-end="935.529">something else even like cold fusion</span> <span data-start="935.529" data-end="939.22">someone is using it still then you can</span> <span data-start="939.22" data-end="943.45">use the same approach so now at this</span> <span data-start="943.45" data-end="945.19">point we were able to solve our first</span> <span data-start="945.19" data-end="949.63">challenge and we can render nunchucks</span> <span data-start="949.63" data-end="951.04">templates on the client and on the</span> <span data-start="951.04" data-end="953.68">server and now we can go ahead and solve</span> <span data-start="953.68" data-end="965.47">our second challenge let me provide a</span> <span data-start="965.47" data-end="967.06">little bit of context about the old</span> <span data-start="967.06" data-end="971.32">framework Denzel Denzel is very very</span> <span data-start="971.32" data-end="972.79">similar to many other frameworks that</span> <span data-start="972.79" data-end="974.83">were introduced three four or five years</span> <span data-start="974.83" data-end="978.82">ago its component based framework and</span> <span data-start="978.82" data-end="981.399">uses object-oriented inheritance</span> <span data-start="981.399" data-end="984.06">approach and on this slide you can see</span> <span data-start="984.06" data-end="988.93">two nunchuks statements and one of them</span> <span data-start="988.93" data-end="992.08">is old denzel module code and another</span> <span data-start="992.08" data-end="995.98">one is new react component code and as I</span> <span data-start="995.98" data-end="998.5">mentioned before module is a function</span> <span data-start="998.5" data-end="1001.65">call it basically converts to JavaScript</span> <span data-start="1001.65" data-end="1003.93">call which will render for us Oh Denzel</span> <span data-start="1003.93" data-end="1006.93">component since it the same applies to</span> <span data-start="1006.93" data-end="1009.18">the component called component calls</span> <span data-start="1009.18" data-end="1010.98">another function call but it falls back</span> <span data-start="1010.98" data-end="1013.95">to react rendering so in order to</span> <span data-start="1013.95" data-end="1016.02">empower our engineers to migrate our</span> <span data-start="1016.02" data-end="1018.839">service incrementally with tweak than</span> </p>
<p><span data-start="1018.839" data-end="1021.57">Jax code and we introduced a new keyword</span> <span data-start="1021.57" data-end="1024.03">component which represents the bridge</span> <span data-start="1024.03" data-end="1026.9">between Denzel and react</span> <span data-start="1026.9" data-end="1031.319">so once nunchuks rendering its component</span> <span data-start="1031.319" data-end="1033.03">keyword it will render it Denzel react</span> <span data-start="1033.03" data-end="1035.73">bridge instead and on the slide you can</span> <span data-start="1035.73" data-end="1038.88">see a simplified version of Denzel reg</span> <span data-start="1038.88" data-end="1041.61">bridge which is a Denzel module which</span> <span data-start="1041.61" data-end="1046.53">will render for us react component let's</span> <span data-start="1046.53" data-end="1047.55">take a look how it works</span> <span data-start="1047.55" data-end="1052.26">so once the component is added to the</span> <span data-start="1052.26" data-end="1055.89">Dom it will read its own options and it</span> <span data-start="1055.89" data-end="1057.66">will figure out the name of the react</span> <span data-start="1057.66" data-end="1062.07">component that they want to render and</span> <span data-start="1062.07" data-end="1064.05">it will render this component passing</span> <span data-start="1064.05" data-end="1066.1">all the options to the properties</span> <span data-start="1066.1" data-end="1068.14">the rendering will happen in its own</span> <span data-start="1068.14" data-end="1072.97">container Dom element so this is pretty</span> <span data-start="1072.97" data-end="1075.52">simple but pretty powerful technique and</span> <span data-start="1075.52" data-end="1077.86">you can use it in many other JavaScript</span> <span data-start="1077.86" data-end="1079.57">libraries if you want to migrate from</span> <span data-start="1079.57" data-end="1082.03">one library to react and you want to use</span> <span data-start="1082.03" data-end="1084.85">the same libraries together during</span> <span data-start="1084.85" data-end="1089.44">period of migration some of you may ask</span> <span data-start="1089.44" data-end="1092.2">a really good question how react will</span> <span data-start="1092.2" data-end="1094.87">reuse the services rendered markup on</span> <span data-start="1094.87" data-end="1098.05">the client-side and this is a really</span> <span data-start="1098.05" data-end="1101.14">cool feature of react because once the</span> </p>
<p><span data-start="1101.14" data-end="1103.18">HTML is rendered on the server-side</span> <span data-start="1103.18" data-end="1106.33">react to automatically add a checksum to</span> <span data-start="1106.33" data-end="1110.47">it and after the web app is initialized</span> <span data-start="1110.47" data-end="1113.95">react to render the HTML in its own</span> <span data-start="1113.95" data-end="1117.04">virtual Dom not a real dumb but virtual</span> <span data-start="1117.04" data-end="1119.5">Dom and will generate another checksum</span> <span data-start="1119.5" data-end="1121.78">and if this checks I'm sorry the same</span> <span data-start="1121.78" data-end="1123.7">that means that we can reuse the</span> <span data-start="1123.7" data-end="1125.74">existing HTML and will not have to</span> <span data-start="1125.74" data-end="1128.38">change the Dom elements at all this is</span> <span data-start="1128.38" data-end="1130.33">pretty important for many performance</span> <span data-start="1130.33" data-end="1133.84">optimizations and also it reduces UI</span> <span data-start="1133.84" data-end="1136.45">flickering that you might see when Dom</span> <span data-start="1136.45" data-end="1138.97">has changed after javascript is</span> <span data-start="1138.97" data-end="1141.52">initialized think it's one of the really</span> <span data-start="1141.52" data-end="1147.46">cool features of react so now since we</span> <span data-start="1147.46" data-end="1149.14">can render react components inside of</span> <span data-start="1149.14" data-end="1151.39">the old framework we can deal with the</span> <span data-start="1151.39" data-end="1154.6">old resource later and more likely in</span> <span data-start="1154.6" data-end="1158.53">your project you have ajax library or</span> <span data-start="1158.53" data-end="1161.29">library that is building on top of ajax</span> <span data-start="1161.29" data-end="1163.54">request that does all the communication</span> <span data-start="1163.54" data-end="1165.73">to the api for you and certain serves</span> <span data-start="1165.73" data-end="1168.25">all the data from the server to to the</span> <span data-start="1168.25" data-end="1170.2">client and probably at least for the</span> <span data-start="1170.2" data-end="1171.88">first period of time of migration you</span> <span data-start="1171.88" data-end="1174.46">really want to reuse this library and</span> <span data-start="1174.46" data-end="1176.8">for that purpose we use powder</span> <span data-start="1176.8" data-end="1180.25">components as adaptors if you don't know</span> <span data-start="1180.25" data-end="1182.11">how the component is a very powerful</span> <span data-start="1182.11" data-end="1184.63">technique that helps you to reuse</span> <span data-start="1184.63" data-end="1186.28">components logic while remaining</span> <span data-start="1186.28" data-end="1189.4">components composable it's a function</span> <span data-start="1189.4" data-end="1191.11">that takes a component and returns</span> <span data-start="1191.11" data-end="1193.45">another component I know it may sound a</span> <span data-start="1193.45" data-end="1195.13">little bit confusing but let's take a</span> <span data-start="1195.13" data-end="1196.9">look to the example and I think</span> <span data-start="1196.9" data-end="1198.75">everything will be clear</span> <span data-start="1198.75" data-end="1201.58">so on this slide you can see on the left</span> <span data-start="1201.58" data-end="1205.6">side it's a hoc with the resource that</span> <span data-start="1205.6" data-end="1209.11">helps us to communicate with the API and</span> <span data-start="1209.11" data-end="1211.809">with the older resource layer and on the</span> <span data-start="1211.809" data-end="1213.549">right side you can see the example of</span> <span data-start="1213.549" data-end="1217.99">usage of hoc with resource so what</span> <span data-start="1217.99" data-end="1224.679">happens on component it mount when the</span> <span data-start="1224.679" data-end="1227.08">component is already in the Dom it will</span> <span data-start="1227.08" data-end="1230.909">send a request to the resource layer and</span> <span data-start="1230.909" data-end="1234.669">once the data comes back it will change</span> <span data-start="1234.669" data-end="1237.7">its own state thus it will render its</span> <span data-start="1237.7" data-end="1241.87">own components and no trigger rendering</span> <span data-start="1241.87" data-end="1245.59">of the of the child this is pretty</span> <span data-start="1245.59" data-end="1247.539">simple but pretty powerful technique</span> <span data-start="1247.539" data-end="1250.33">that helps a lot in migrations like that</span> <span data-start="1250.33" data-end="1252.34">and you can use it for many other things</span> <span data-start="1252.34" data-end="1254.62">not only for dealing with resources but</span> <span data-start="1254.62" data-end="1256.87">this one is the main one for example if</span> <span data-start="1256.87" data-end="1260.07">you have some experiments layer or</span> <span data-start="1260.07" data-end="1263.049">something else you can always make sure</span> <span data-start="1263.049" data-end="1266.11">that the newly created reaction ponents</span> <span data-start="1266.11" data-end="1268.12">and architecture are always in sync with</span> <span data-start="1268.12" data-end="1273.639">the with the with this layer so now we</span> <span data-start="1273.639" data-end="1276.85">can render nunchuks on the server we can</span> <span data-start="1276.85" data-end="1279.19">render react on the server on the client</span> <span data-start="1279.19" data-end="1282.07">and now we can move forward and solve</span> <span data-start="1282.07" data-end="1292.09">our last and fourth challenge so now</span> <span data-start="1292.09" data-end="1294.309">we're talking about UI experiments and</span> <span data-start="1294.309" data-end="1297.029">this is the most exciting part for me</span> <span data-start="1297.029" data-end="1300.639">with more than 200 200 millions of</span> <span data-start="1300.639" data-end="1302.889">monthly active users we have to roll out</span> <span data-start="1302.889" data-end="1304.87">things very carefully because we have to</span> <span data-start="1304.87" data-end="1307.539">make sure that our newly created UI is</span> <span data-start="1307.539" data-end="1309.039">actually performing better than the old</span> <span data-start="1309.039" data-end="1311.85">one and for that purpose we use</span> <span data-start="1311.85" data-end="1314.679">gatekeeper a be testing framework and if</span> <span data-start="1314.679" data-end="1315.789">you have something similar in your</span> <span data-start="1315.789" data-end="1319.75">project it's super handy normally maybe</span> <span data-start="1319.75" data-end="1321.61">testing frameworks are used to compare</span> <span data-start="1321.61" data-end="1323.62">different UIs and see how they behave</span> <span data-start="1323.62" data-end="1324.669">and measure</span> <span data-start="1324.669" data-end="1327.519">the data and impact but you can use</span> <span data-start="1327.519" data-end="1331.09">these frameworks as well for for</span> <span data-start="1331.09" data-end="1334.419">migrations or factoring like that so on</span> <span data-start="1334.419" data-end="1337.629">this slide you can see there is a very</span> <span data-start="1337.629" data-end="1340.149">simplified version of forking logic</span> <span data-start="1340.149" data-end="1342.669">based off on experiment check and if</span> <span data-start="1342.669" data-end="1345.369">user is in the react experiment then we</span> <span data-start="1345.369" data-end="1347.679">render newly created react component and</span> <span data-start="1347.679" data-end="1349.95">otherwise we'll fall back to the old</span> </p>
<p><span data-start="1349.95" data-end="1354.659">Denzel module now let's take a look</span> <span data-start="1354.659" data-end="1357.519">deeper at the experiment setup you can</span> <span data-start="1357.519" data-end="1360.129">see component tree or module tree on the</span> <span data-start="1360.129" data-end="1365.32">right side and this component tree at</span> <span data-start="1365.32" data-end="1367.69">some node something zell node you can</span> <span data-start="1367.69" data-end="1369.369">see that we are forking our experiment</span> <span data-start="1369.369" data-end="1372.519">logic and the whole right subtree is</span> <span data-start="1372.519" data-end="1375.07">still rendered in in denzel but the left</span> <span data-start="1375.07" data-end="1379.149">one is in react so worse to mention that</span> <span data-start="1379.149" data-end="1383.23">once a node is converted to component</span> <span data-start="1383.23" data-end="1385.84">call old children and descendants are</span> <span data-start="1385.84" data-end="1388.84">necessarily in reality basically there</span> <span data-start="1388.84" data-end="1391.359">is call of react inside of Denzel but</span> <span data-start="1391.359" data-end="1393.129">there is no call of the ins on one side</span> <span data-start="1393.129" data-end="1395.799">of react and this is done on purpose</span> <span data-start="1395.799" data-end="1398.32">because it helps you to move faster and</span> <span data-start="1398.32" data-end="1401.019">also it will be total mess if you start</span> <span data-start="1401.019" data-end="1403.48">calling react inside of themselves and</span> <span data-start="1403.48" data-end="1405.399">then downside of react and vice-versa</span> <span data-start="1405.399" data-end="1407.139">you don't want to you really don't want</span> <span data-start="1407.139" data-end="1413.619">to do this because of that we had to</span> <span data-start="1413.619" data-end="1416.32">convert our components from the very</span> <span data-start="1416.32" data-end="1419.019">leaves moving to the very top and we</span> <span data-start="1419.019" data-end="1423.399">call it bottom-up approach also it's</span> <span data-start="1423.399" data-end="1425.95">worse to mention that you probably want</span> <span data-start="1425.95" data-end="1428.289">to run your experiments at maximum per</span> <span data-start="1428.289" data-end="1430.48">page level and you don't want to compare</span> <span data-start="1430.48" data-end="1433.179">your old web up to the new one otherwise</span> <span data-start="1433.179" data-end="1435.34">you have too many factors affecting your</span> <span data-start="1435.34" data-end="1437.59">data and you'll never be able to figure</span> <span data-start="1437.59" data-end="1440.379">out why you have metrics drops or why I</span> <span data-start="1440.379" data-end="1444.429">have maybe metric improvements also it's</span> <span data-start="1444.429" data-end="1446.049">forced to mention that you really want</span> <span data-start="1446.049" data-end="1448.95">to run your experiments exclusively and</span> <span data-start="1448.95" data-end="1450.85">otherwise you'll have the same issue</span> <span data-start="1450.85" data-end="1452.559">because different experiments will</span> <span data-start="1452.559" data-end="1461.83">affect the same metrics</span> <span data-start="1461.84" data-end="1465.66">later on you can login into your</span> <span data-start="1465.66" data-end="1468.72">experiments dashboard and see different</span> <span data-start="1468.72" data-end="1471.179">metrics so while we were running</span> <span data-start="1471.179" data-end="1473.16">immigration like that we were comparing</span> <span data-start="1473.16" data-end="1475.35">reacting Denzel to many different</span> <span data-start="1475.35" data-end="1477.809">metrics like engagement metrics or error</span> <span data-start="1477.809" data-end="1480.179">rate performance metrics and so on and</span> <span data-start="1480.179" data-end="1482.25">so forth on this slide you can see a</span> <span data-start="1482.25" data-end="1485.429">screenshot of the dashboard and you can</span> <span data-start="1485.429" data-end="1486.87">see there is a bunch of metrics on the</span> <span data-start="1486.87" data-end="1488.85">left side and there is a bunch of</span> <span data-start="1488.85" data-end="1491.28">squares on the right side the ones that</span> <span data-start="1491.28" data-end="1493.23">without color they actually gray and</span> <span data-start="1493.23" data-end="1496.38">means that there is no not enough data</span> <span data-start="1496.38" data-end="1499.049">to calculate the numbers so they will be</span> <span data-start="1499.049" data-end="1500.7">statistically significant</span> <span data-start="1500.7" data-end="1503.929">the red ones means there is a drop and</span> <span data-start="1503.929" data-end="1506.13">the blue ones means there is improvement</span> <span data-start="1506.13" data-end="1509.73">if there is a job you probably really</span> <span data-start="1509.73" data-end="1511.169">want to investigate it and figure out</span> <span data-start="1511.169" data-end="1513.03">maybe you introduced a bug or maybe</span> <span data-start="1513.03" data-end="1514.65">there is a performance issues that</span> <span data-start="1514.65" data-end="1518.37">affecting your user it's important to</span> <span data-start="1518.37" data-end="1521.309">say that during migrations like that you</span> <span data-start="1521.309" data-end="1523.47">may have a bunch of outta task unit</span> <span data-start="1523.47" data-end="1525.84">tests manual testing and things like</span> <span data-start="1525.84" data-end="1528.45">that but unlikely they will cover all</span> <span data-start="1528.45" data-end="1531.83">the edge cases for example what if your</span> <span data-start="1531.83" data-end="1534.12">well what if in your web app there is</span> <span data-start="1534.12" data-end="1536.58">something going on wrong in in different</span> <span data-start="1536.58" data-end="1539.429">language or what if people with poor</span> <span data-start="1539.429" data-end="1542.25">internet connection they having some</span> <span data-start="1542.25" data-end="1544.2">issues and it's really hard to catch</span> <span data-start="1544.2" data-end="1547.14">things like that using unit tests or out</span> <span data-start="1547.14" data-end="1549.66">a test or anything else but maybe</span> <span data-start="1549.66" data-end="1551.34">testing frameworks and measuring that</span> <span data-start="1551.34" data-end="1553.44">your data will always give you a signal</span> <span data-start="1553.44" data-end="1554.79">that something is going wrong and you</span> <span data-start="1554.79" data-end="1561.24">can start investigating so interest</span> <span data-start="1561.24" data-end="1563.97">profiles were the first user heavy page</span> <span data-start="1563.97" data-end="1565.919">that was successful immigrated to</span> <span data-start="1565.919" data-end="1569.13">reality and during react migration we've</span> <span data-start="1569.13" data-end="1570.87">seen consistent performance and</span> <span data-start="1570.87" data-end="1573.179">engagement improvements for example</span> <span data-start="1573.179" data-end="1575.76">metrics like Dom interactive or board</span> <span data-start="1575.76" data-end="1579.48">page views were up to 20% and we got</span> <span data-start="1579.48" data-end="1582.09">this 20% just from changing the gears</span> <span data-start="1582.09" data-end="1584.22">and infrastructure without actually</span> <span data-start="1584.22" data-end="1587.25">changing UI adult I think this is pretty</span> <span data-start="1587.25" data-end="1590.25">cool getting 20% from without changing</span> <span data-start="1590.25" data-end="1591.5">the</span> <span data-start="1591.5" data-end="1594.57">during migration our engineers our</span> <span data-start="1594.57" data-end="1596.34">product engineers they were able to</span> <span data-start="1596.34" data-end="1599.04">continue changing the service and they</span> <span data-start="1599.04" data-end="1601.29">were able to ship different features and</span> <span data-start="1601.29" data-end="1603.57">run different experiments in the rest of</span> <span data-start="1603.57" data-end="1609.96">the website and finally all these leads</span> <span data-start="1609.96" data-end="1612.559">to completely new developer experience</span> <span data-start="1612.559" data-end="1617.01">now we don't have duplicating nunchucks</span> <span data-start="1617.01" data-end="1620.549">and ginger libraries there is no need to</span> <span data-start="1620.549" data-end="1623.16">learn nunchucks at all that makes the</span> <span data-start="1623.16" data-end="1626.37">onboarding process much easier there is</span> <span data-start="1626.37" data-end="1628.14">single language on the client and on the</span> <span data-start="1628.14" data-end="1630.15">server side which makes life of our</span> <span data-start="1630.15" data-end="1634.08">engineers even more easier and finally</span> <span data-start="1634.08" data-end="1635.88">we are part of the large developer</span> <span data-start="1635.88" data-end="1638.04">community and there is no need in wiki</span> <span data-start="1638.04" data-end="1639.99">pages there is a lot of well-crafted</span> <span data-start="1639.99" data-end="1643.44">examples and documentation online it's</span> <span data-start="1643.44" data-end="1645.45">been a long journey but we're excited to</span> <span data-start="1645.45" data-end="1649.47">be part of react community thank you and</span> <span data-start="1649.47" data-end="1651.24">if you have any questions feel free to</span> <span data-start="1651.24" data-end="1661.11">find me in</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
