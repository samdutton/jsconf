<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>x8sKpJwq6lY</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/x8sKpJwq6lY?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.32" data-end="2.07">[Music]</span> <span data-start="2.07" data-end="3.84">[Applause]</span> <span data-start="3.84" data-end="5.66">[Music]</span> <span data-start="5.66" data-end="7.41">[Applause]</span> <span data-start="7.41" data-end="9.28">[Music]</span> <span data-start="9.28" data-end="11.02">[Applause]</span> <span data-start="11.02" data-end="12.78">[Music]</span> <span data-start="12.78" data-end="16.86">[Applause]</span> <span data-start="16.87" data-end="32.06">[Music]</span> <span data-start="32.07" data-end="34.39">the title of this presentation is please</span> <span data-start="34.39" data-end="36.43">don't mock me that's what my face looked</span> <span data-start="36.43" data-end="38.44">like seven years ago my name is Justin I</span> <span data-start="38.44" data-end="40">go by Searles my last name I'm most</span> <span data-start="40" data-end="41.829">internet things if you'd like my contact</span> <span data-start="41.829" data-end="44.35">info you may npm install' me i am the</span> <span data-start="44.35" data-end="45.61">creator and the current maintainer of</span> <span data-start="45.61" data-end="46.9">the world's second most popular</span> <span data-start="46.9" data-end="48.76">javascript mocking library if you don't</span> <span data-start="48.76" data-end="50.86">count jest or jasmine here's the</span> <span data-start="50.86" data-end="52.96">download chart that right there is sign</span> <span data-start="52.96" data-end="54.489">on the most popular one and that's us</span> <span data-start="54.489" data-end="57.1">test double way down there this was a</span> <span data-start="57.1" data-end="58.6">big day for us is the day we finally</span> <span data-start="58.6" data-end="60.37">caught up but the npm rebooted all their</span> <span data-start="60.37" data-end="63.309">servers so we're still fighting you</span> <span data-start="63.309" data-end="64.989">could totally help goose our numbers by</span> </p>
<p><span data-start="64.989" data-end="66.97">NPM installing testable today all of the</span> <span data-start="66.97" data-end="69.25">illustrations that i do will be just</span> <span data-start="69.25" data-end="70.84">musing testable by happenstance it's</span> <span data-start="70.84" data-end="73.57">what I know best I'm here today to</span> <span data-start="73.57" data-end="75.46">convince you that the popularity of a</span> <span data-start="75.46" data-end="77.26">JavaScript mocking library doesn't</span> <span data-start="77.26" data-end="79.33">matter and you should be saying well</span> <span data-start="79.33" data-end="80.26">you're just saying that because your</span> <span data-start="80.26" data-end="81.75">thing's not popular and you'd be right</span> <span data-start="81.75" data-end="84.58">but additionally I'm here because I've</span> <span data-start="84.58" data-end="85.6">been practicing test-driven development</span> <span data-start="85.6" data-end="88.33">with mocks for a decade now and I really</span> <span data-start="88.33" data-end="89.74">come to believe that literally nobody</span> <span data-start="89.74" data-end="91.78">knows how to use mocks and of course</span> <span data-start="91.78" data-end="93.1">that's a terrible thing to say I</span> <span data-start="93.1" data-end="94.299">shouldn't say that I should say</span> <span data-start="94.299" data-end="97.51">figuratively nobody knows and let's</span> <span data-start="97.51" data-end="98.89">break it down because there's a group of</span> <span data-start="98.89" data-end="100.63">people who can explain how to best mock</span> <span data-start="100.63" data-end="102.07">things in any given situation and</span> <span data-start="102.07" data-end="103.33">there's another group of people who</span> <span data-start="103.33" data-end="105.03">always mock things out consistently</span> <span data-start="105.03" data-end="106.78">unfortunately for all of us there's a</span> <span data-start="106.78" data-end="108.4">much larger group of people who use</span> <span data-start="108.4" data-end="110.59">mocking libraries without belonging to</span> <span data-start="110.59" data-end="112.9">either previous group and so you know</span> <span data-start="112.9" data-end="114.67">when we initially wrote test double J s</span> <span data-start="114.67" data-end="116.049">it was really to like target that</span> <span data-start="116.049" data-end="117.369">intersection of developers who already</span> <span data-start="117.369" data-end="119.11">knew really how to like make the most of</span> <span data-start="119.11" data-end="122.259">their tests and my goal is not just to</span> <span data-start="122.259" data-end="124.33">become more popular to grow the</span> <span data-start="124.33" data-end="125.35">intersection people who really</span> <span data-start="125.35" data-end="126.52">understand and get the most out of their</span> <span data-start="126.52" data-end="128.2">mocking library and them as a result the</span> <span data-start="128.2" data-end="129.549">most out of their tests so that's what</span> <span data-start="129.549" data-end="131.11">we're here to do today but to do that we</span> <span data-start="131.11" data-end="132.31">have to define a few terms first</span> <span data-start="132.31" data-end="134.409">whenever I say the word subject I'm</span> <span data-start="134.409" data-end="136.45">referring to the thing being tested like</span> <span data-start="136.45" data-end="138.939">a like an experimental test subject as</span> <span data-start="138.939" data-end="140.739">where it gets that name whenever I say</span> <span data-start="140.739" data-end="142.209">dependency like if you're testing a</span> <span data-start="142.209" data-end="144.28">module anything that that thing import</span> <span data-start="144.28" data-end="146.38">so relies upon that is external to it is</span> <span data-start="146.38" data-end="148.39">a dependency and whenever I say unit</span> <span data-start="148.39" data-end="149.95">test I'm not using a really like fancy</span> <span data-start="149.95" data-end="152.44">definition or nuance term really like if</span> <span data-start="152.44" data-end="153.52">you're invoking a function and you</span> <span data-start="153.52" data-end="154.84">assert certain things come out the other</span> <span data-start="154.84" data-end="156.81">end congratulations you have a unit test</span> <span data-start="156.81" data-end="159.4">the catch-all term for all types of</span> <span data-start="159.4" data-end="161.709">mocks is testing double whether you're</span> <span data-start="161.709" data-end="163.45">talking about a stub or a spy or a mock</span> <span data-start="163.45" data-end="165.52">or a fake but today I'm gonna like you</span> <span data-start="165.52" data-end="167.2">know disregard all of that and just use</span> <span data-start="167.2" data-end="168.72">mock because it's the most common</span> <span data-start="168.72" data-end="172.15">vernacular coincidentally and sort of</span> <span data-start="172.15" data-end="174.19">unfortunately from like a branding</span> <span data-start="174.19" data-end="175.81">perspective I'm also from a company</span> <span data-start="175.81" data-end="179.53">called test double we are not a mocking</span> <span data-start="179.53" data-end="181.51">library manufacturer instead we're</span> <span data-start="181.51" data-end="183.58">actually a consultancy and what we do is</span> <span data-start="183.58" data-end="185.44">we pair up with teams maybe like yours</span> <span data-start="185.44" data-end="186.82">who are looking for additional senior</span> <span data-start="186.82" data-end="189.04">developer talent and we join you on</span> <span data-start="189.04" data-end="191.02">contract to work alongside you get</span> <span data-start="191.02" data-end="192.37">things done and hopefully with an eye to</span> <span data-start="192.37" data-end="194.38">helping you make things better along the</span> <span data-start="194.38" data-end="196">way you can learn more about us online</span> <span data-start="196" data-end="198.76">this talk has four parts the first part</span> <span data-start="198.76" data-end="202.03">is obvious abuses of mocking we're gonna</span> <span data-start="202.03" data-end="204.459">move on to the less obvious abuses and</span> <span data-start="204.459" data-end="206.02">then we're going to move right along to</span> <span data-start="206.02" data-end="207.73">the questionable uses that might have</span> <span data-start="207.73" data-end="209.86">some value but people often mess up and</span> <span data-start="209.86" data-end="211.72">finally the one good use for mocking</span> <span data-start="211.72" data-end="213.43">that I found in you know all this</span> <span data-start="213.43" data-end="215.68">practice so first let's start with the</span> <span data-start="215.68" data-end="217.989">obvious uses and that is using partial</span> <span data-start="217.989" data-end="220.269">mocks so you like mocked out part of a</span> <span data-start="220.269" data-end="221.769">thing but left part of the other stuff</span> <span data-start="221.769" data-end="223.6">real and to illustrate let's say that</span> <span data-start="223.6" data-end="226.12">you run a park ticket kiosk machine</span> <span data-start="226.12" data-end="227.799">you know people tap on the screen and</span> <span data-start="227.799" data-end="229.959">then you know they say hey I'm 12 years</span> <span data-start="229.959" data-end="232.209">old and so we check our inventory module</span> <span data-start="232.209" data-end="233.86">to ensure that the child tickets are</span> <span data-start="233.86" data-end="235.57">available before we try to sell them if</span> <span data-start="235.57" data-end="237.07">they'd said they were 13 we check for</span> <span data-start="237.07" data-end="238.84">adult tickets and either way because we</span> <span data-start="238.84" data-end="240.43">want to like upsell them during the</span> <span data-start="240.43" data-end="241.66">checkout phase we make sure that we have</span> </p>
<p><span data-start="241.66" data-end="243.94">Express passes available to sell the</span> <span data-start="243.94" data-end="245.53">logic like might be implemented in code</span> <span data-start="245.53" data-end="247.15">like this you know if they're under 13</span> <span data-start="247.15" data-end="248.17">and sure we have a child ticket</span> <span data-start="248.17" data-end="249.73">otherwise ensure we have an adult ticket</span> <span data-start="249.73" data-end="251.44">the Express module thing is turned on</span> <span data-start="251.44" data-end="252.91">make sure we have those and so on and so</span> <span data-start="252.91" data-end="254.769">forth a test for this how would that</span> <span data-start="254.769" data-end="256.12">look well we'd create another test</span> <span data-start="256.12" data-end="257.68">module over here and we did invoke the</span> <span data-start="257.68" data-end="259.72">code just like we normally would but</span> <span data-start="259.72" data-end="261.07">what about this insurer child ticket</span> <span data-start="261.07" data-end="262.36">because it's like a Boyd function it</span> <span data-start="262.36" data-end="264.16">doesn't return anything useful so like</span> <span data-start="264.16" data-end="265.78">how would we assert on that well we</span> <span data-start="265.78" data-end="267.4">could mock out that method on the</span> <span data-start="267.4" data-end="269.74">inventory and then return back and</span> <span data-start="269.74" data-end="271.54">verify that that call took place and a</span> <span data-start="271.54" data-end="273.31">way to do that we just replace poke a</span> <span data-start="273.31" data-end="274.96">hole in reality replace that method and</span> <span data-start="274.96" data-end="275.67">then fit</span> <span data-start="275.67" data-end="277.38">code path me again we just invoke it</span> <span data-start="277.38" data-end="279.21">like normal and then you know testable</span> <span data-start="279.21" data-end="280.44">and a lot of mocking libraries come with</span> <span data-start="280.44" data-end="281.73">a way to like verify a particular</span> <span data-start="281.73" data-end="284.04">invocation happen just how you like it</span> <span data-start="284.04" data-end="285.63">for the other code path for the adult</span> <span data-start="285.63" data-end="287.76">we'd write another test case we poke a</span> <span data-start="287.76" data-end="290.1">second hole in reality and while we're</span> <span data-start="290.1" data-end="291.3">there we can make sure we don't call</span> <span data-start="291.3" data-end="292.8">that one during the child code bat that</span> <span data-start="292.8" data-end="294.18">wouldn't make sense and then mostly just</span> <span data-start="294.18" data-end="296.4">copy paste and then update the values we</span> <span data-start="296.4" data-end="298.8">can run this test great test passes</span> <span data-start="298.8" data-end="299.58">looks good</span> <span data-start="299.58" data-end="302.34">fortunately time marches on and you</span> <span data-start="302.34" data-end="303.48">didn't do anything but you get a phone</span> <span data-start="303.48" data-end="305.19">call that the build is broken and your</span> <span data-start="305.19" data-end="307.02">test is the one failing so you run the</span> <span data-start="307.02" data-end="308.7">test again and sure enough it's failing</span> <span data-start="308.7" data-end="311.28">in two places we're calling the adult</span> <span data-start="311.28" data-end="313.53">code the adult inventory insure adult</span> <span data-start="313.53" data-end="315.99">thing an extra time when we didn't</span> <span data-start="315.99" data-end="317.64">expect to and that doesn't make any</span> <span data-start="317.64" data-end="318.96">sense to us cuz we haven't changed this</span> <span data-start="318.96" data-end="320.28">code we look at it nothing's different</span> <span data-start="320.28" data-end="322.86">here so we look at the only thing that's</span> <span data-start="322.86" data-end="324.93">actually external still a real method</span> <span data-start="324.93" data-end="326.73">ensure Express pass that's still getting</span> <span data-start="326.73" data-end="327.93">called so that means we have to go now</span> <span data-start="327.93" data-end="329.49">load up this inventory module and we can</span> <span data-start="329.49" data-end="331.05">see the maintainer of that module</span> <span data-start="331.05" data-end="333.51">actually added an intrinsic call to</span> <span data-start="333.51" data-end="334.68">ensure adult ticket maybe they don't</span> <span data-start="334.68" data-end="336">want to sell Express passes if they're</span> <span data-start="336" data-end="337.59">out of stock and that might make sense</span> <span data-start="337.59" data-end="338.91">to them but like can we really blame</span> <span data-start="338.91" data-end="340.32">them for breaking our tests like were</span> <span data-start="340.32" data-end="342.36">they expecting this zombie half real</span> <span data-start="342.36" data-end="344.01">half fake inventory module to be</span> <span data-start="344.01" data-end="345.69">floating around somewhere probably not</span> <span data-start="345.69" data-end="347.91">so we don't have really any recourse</span> <span data-start="347.91" data-end="349.68">except to poke a third hole in reality</span> <span data-start="349.68" data-end="351.9">and we can make the test work but</span> <span data-start="351.9" data-end="353.7">something feels wrong it's almost like</span> <span data-start="353.7" data-end="355.29">our ship is sinking and our solution is</span> <span data-start="355.29" data-end="358.71">to poke more holes in it so in this case</span> <span data-start="358.71" data-end="360.42">you know the test felt good initially</span> <span data-start="360.42" data-end="362.04">because it was superficially simple it</span> <span data-start="362.04" data-end="363.51">was terse and only said what we cared</span> <span data-start="363.51" data-end="365.73">about but underlying that was that we</span> <span data-start="365.73" data-end="367.2">didn't really have good experimental</span> <span data-start="367.2" data-end="368.25">control from what we're trying to</span> <span data-start="368.25" data-end="369.96">specify so instead what I'd recommend</span> <span data-start="369.96" data-end="372.63">you do fake out the whole thing that way</span> <span data-start="372.63" data-end="374.58">it's really clear what the contract line</span> <span data-start="374.58" data-end="376.29">is and then require your thing and test</span> <span data-start="376.29" data-end="378.69">as usual in short if you have a</span> <span data-start="378.69" data-end="380.13">dependency and it's a totally real</span> <span data-start="380.13" data-end="381.57">dependency that's really easy to</span> <span data-start="381.57" data-end="382.92">maintain because we're used to invoking</span> <span data-start="382.92" data-end="385.14">code that's real if you have code that's</span> <span data-start="385.14" data-end="386.79">like a dependency that you've completely</span> <span data-start="386.79" data-end="388.77">faked out whether what the tool or not</span> <span data-start="388.77" data-end="390.78">at least you have total experimental</span> <span data-start="390.78" data-end="392.04">control so the expectations are clear</span> <span data-start="392.04" data-end="393.78">but if you have this like dependency</span> <span data-start="393.78" data-end="395.34">that's like half real a half fake it's</span> <span data-start="395.34" data-end="397.59">going to fail for surprising reasons and</span> <span data-start="397.59" data-end="399.87">you're gonna have a bad time the second</span> <span data-start="399.87" data-end="401.28">obvious abuse that I see of mocking is</span> <span data-start="401.28" data-end="403.89">people partially mocking out the actual</span> <span data-start="403.89" data-end="405.18">thing the subject the thing that they're</span> <span data-start="405.18" data-end="407.58">testing this advice is short please</span> <span data-start="407.58" data-end="409.08">don't fake out part of the thing</span> <span data-start="409.08" data-end="410.849">that you're testing you know I get</span> <span data-start="410.849" data-end="412.379">pushed back sometimes like oh well we</span> <span data-start="412.379" data-end="414.21">have a very very large module it's got</span> <span data-start="414.21" data-end="415.259">all these methods and they call each</span> <span data-start="415.259" data-end="416.789">other and there's just no other way to</span> <span data-start="416.789" data-end="418.259">get coverage of this little thing right</span> <span data-start="418.259" data-end="419.939">here so we need to poke holes here and</span> <span data-start="419.939" data-end="421.139">there and there to get our test running</span> <span data-start="421.139" data-end="422.699">a problem with that is like now you have</span> <span data-start="422.699" data-end="424.139">two problems you have a big thing that</span> <span data-start="424.139" data-end="425.669">nobody understands and tests of it that</span> <span data-start="425.669" data-end="429.18">nobody trusts so please don't do that</span> <span data-start="429.18" data-end="431.49">third obvious thing that we see is when</span> <span data-start="431.49" data-end="433.349">people replace some of a dependent of</span> <span data-start="433.349" data-end="435.419">the dependencies under tests but not all</span> <span data-start="435.419" data-end="437.219">of them for a given subject and so to</span> <span data-start="437.219" data-end="440.189">explain I'd like to use a word over</span> <span data-start="440.189" data-end="442.469">mocking if you've heard this term I</span> <span data-start="442.469" data-end="443.61">think it's kind of like a prevailing</span> <span data-start="443.61" data-end="445.349">ideology of how people think about</span> <span data-start="445.349" data-end="447.24">mocking and tests as if it's an</span> <span data-start="447.24" data-end="449.34">affordance to be moderated like you have</span> <span data-start="449.34" data-end="450.15">this manometer</span> <span data-start="450.15" data-end="451.68">that's like slowly building up as you</span> <span data-start="451.68" data-end="453.539">mock things but watch out because you</span> <span data-start="453.539" data-end="455.34">don't want to over mock you've crossed</span> <span data-start="455.34" data-end="456.81">some invisible threshold so don't do</span> <span data-start="456.81" data-end="457.05">that</span> <span data-start="457.05" data-end="459.06">and it's a strange way to think about it</span> <span data-start="459.06" data-end="460.259">so let's talk about it let's say that</span> <span data-start="460.259" data-end="463.169">you write a system that handles airplane</span> <span data-start="463.169" data-end="465.12">seat reservations and your great your</span> <span data-start="465.12" data-end="467.49">pair programming together at work and so</span> <span data-start="467.49" data-end="468.509">you think about the different</span> <span data-start="468.509" data-end="470.37">dependencies that you need to implement</span> <span data-start="470.37" data-end="472.379">this subject that's under test and then</span> <span data-start="472.379" data-end="473.58">you talk about the different test cases</span> <span data-start="473.58" data-end="475.56">that you need to implement and because</span> <span data-start="475.56" data-end="477.69">you're pairing you try to normalize on</span> <span data-start="477.69" data-end="479.31">approach and so you know person on the</span> <span data-start="479.31" data-end="480.659">right says hey I like mocking out my</span> <span data-start="480.659" data-end="482.069">dependency isn't the person on the left</span> <span data-start="482.069" data-end="483.69">you know doesn't like mocking tries to</span> <span data-start="483.69" data-end="485.46">avoid so you know you're pairing so what</span> <span data-start="485.46" data-end="486.839">do you do you compromise and just mock</span> <span data-start="486.839" data-end="490.05">out half the things that is not a laugh</span> <span data-start="490.05" data-end="492.389">line that's just how people really do</span> <span data-start="492.389" data-end="494.94">this so you might got half the things</span> <span data-start="494.94" data-end="497.039">and as far as this ideology of mock</span> <span data-start="497.039" data-end="498.719">commoners ago you're looking good you're</span> <span data-start="498.719" data-end="502.02">46 percent or whatever but time passes</span> <span data-start="502.02" data-end="503.55">and you get another call because the</span> <span data-start="503.55" data-end="505.5">build is failing and it's your fault and</span> <span data-start="505.5" data-end="507.24">so you can see here you know request see</span> <span data-start="507.24" data-end="509.129">our module is calling this seat map with</span> <span data-start="509.129" data-end="510.779">a particular address and then it gives</span> <span data-start="510.779" data-end="512.789">the seat object back and you can see</span> <span data-start="512.789" data-end="514.14">it's like a string right well the</span> <span data-start="514.14" data-end="515.43">problem is that they've updated that</span> <span data-start="515.43" data-end="517.199">contract and now they expect it to be a</span> <span data-start="517.199" data-end="519.779">- arised address and so our test blew up</span> <span data-start="519.779" data-end="521.849">well the person on the right who prefers</span> <span data-start="521.849" data-end="523.26">to isolate their dependency says hey</span> <span data-start="523.26" data-end="524.73">this failure has nothing to do with the</span> <span data-start="524.73" data-end="526.92">subject and you know she'd be right like</span> <span data-start="526.92" data-end="528.51">you see the seat number is just kind of</span> <span data-start="528.51" data-end="530.31">passed in like a baton we don't do any</span> <span data-start="530.31" data-end="532.26">of the string manipulation stuff here</span> <span data-start="532.26" data-end="534.329">and so she changes that real dependency</span> <span data-start="534.329" data-end="537.12">to a fake dependency fixes the test now</span> <span data-start="537.12" data-end="539.279">more time passes but this time worse</span> <span data-start="539.279" data-end="541.47">thing production is broken so let's dig</span> <span data-start="541.47" data-end="542.98">in you know here we have</span> <span data-start="542.98" data-end="545.05">this thing that actually fires the book</span> <span data-start="545.05" data-end="546.459">seat and for obvious reasons we've</span> <span data-start="546.459" data-end="548.68">knocked that out and you can see if it</span> <span data-start="548.68" data-end="549.97">takes these three arguments well the</span> <span data-start="549.97" data-end="552.13">maintainer of that transposed the second</span> <span data-start="552.13" data-end="553.51">and third argument for whatever reason</span> <span data-start="553.51" data-end="555.91">and our test continued to pass it was a</span> <span data-start="555.91" data-end="558.76">fantasy green test and as a result</span> <span data-start="558.76" data-end="560.11">production blew up because the build was</span> </p>
<p><span data-start="560.11" data-end="561.67">Green now the person on the Left who</span> <span data-start="561.67" data-end="562.99">hates mocking would point out hey this</span> <span data-start="562.99" data-end="564.07">wouldn't have happened if we hadn't</span> <span data-start="564.07" data-end="565.6">knocked this thing out and he's right -</span> <span data-start="565.6" data-end="567.639">so he goes into the test and replaces</span> <span data-start="567.639" data-end="569.139">the fake thing with the real thing and</span> <span data-start="569.139" data-end="570.94">gets you back to passing and I don't</span> <span data-start="570.94" data-end="572.05">think this is what people meant by</span> <span data-start="572.05" data-end="574.75">ping-pong pier programming but this kind</span> <span data-start="574.75" data-end="576.13">of passive-aggressive back-and-forth is</span> <span data-start="576.13" data-end="578.079">exactly what you get people don't know</span> <span data-start="578.079" data-end="579.73">why they're using a particular tool for</span> <span data-start="579.73" data-end="582.279">a given job instead and this is kind of</span> <span data-start="582.279" data-end="584.889">maybe surprising to hear like a test</span> <span data-start="584.889" data-end="588.16">that never fails is a bad test because</span> <span data-start="588.16" data-end="589.839">it hasn't told you anything it's just</span> <span data-start="589.839" data-end="592.36">consumed countless cycles of cloud cpu</span> <span data-start="592.36" data-end="595.66">time in your CI server instead you know</span> <span data-start="595.66" data-end="597.16">it's gonna fail there hopefully it'll</span> <span data-start="597.16" data-end="598.779">fail so think at the time that you're</span> <span data-start="598.779" data-end="600.61">writing it what should failure mean for</span> <span data-start="600.61" data-end="602.23">this test and design that instead of</span> <span data-start="602.23" data-end="604.329">like how you actually write tests for</span> <span data-start="604.329" data-end="605.649">example if you're writing a unit test</span> <span data-start="605.649" data-end="607.329">it's all wired up all those dependencies</span> <span data-start="607.329" data-end="609.85">are real sure nothing is mocked but</span> <span data-start="609.85" data-end="611.56">let's think about like when it fails and</span> <span data-start="611.56" data-end="613.569">you know intuitively you can say well</span> <span data-start="613.569" data-end="615.13">it'll fail whenever the subject or its</span> <span data-start="615.13" data-end="617.35">dependencies logics changes that's great</span> <span data-start="617.35" data-end="619.51">it encourages you to be mindful though</span> <span data-start="619.51" data-end="621.67">of what I call redundant code coverage</span> <span data-start="621.67" data-end="625.24">and that is if you have a module that's</span> <span data-start="625.24" data-end="627.519">depended by 35 different things and you</span> <span data-start="627.519" data-end="629.5">change that module you don't want to set</span> <span data-start="629.5" data-end="630.639">yourself up for a situation where you</span> <span data-start="630.639" data-end="632.829">have to now go update 36 different tests</span> <span data-start="632.829" data-end="635.5">so be thinking about that now if we have</span> <span data-start="635.5" data-end="637.36">isolated unit tests where all the things</span> <span data-start="637.36" data-end="639.519">are faked out 100% mocks or our my</span> <span data-start="639.519" data-end="642.01">comedy readings are beeping loudly or</span> <span data-start="642.01" data-end="644.019">something but when it fails we have a</span> <span data-start="644.019" data-end="645.399">clear definition of what failure means</span> <span data-start="645.399" data-end="646.99">it means in the contract between the</span> <span data-start="646.99" data-end="648.73">subject and its dependency has changed</span> <span data-start="648.73" data-end="650.47">and so it should encourage us though to</span> <span data-start="650.47" data-end="652.48">like be mindful that like we probably</span> <span data-start="652.48" data-end="654.37">want to have another smoke test some</span> <span data-start="654.37" data-end="655.66">integrated thing that just make sure</span> <span data-start="655.66" data-end="656.709">that when everything is plugged together</span> <span data-start="656.709" data-end="658.81">the app basically seems to work so</span> <span data-start="658.81" data-end="661.269">that's important too but what do we what</span> <span data-start="661.269" data-end="662.47">do we do in this case we're half the</span> <span data-start="662.47" data-end="663.579">things are real and half the things are</span> <span data-start="663.579" data-end="665.47">fake you know it looks good under the</span> <span data-start="665.47" data-end="666.88">prevailing ideology of like you know</span> <span data-start="666.88" data-end="669.04">mocking is moderation but when does it</span> <span data-start="669.04" data-end="671.319">fail well it can fail for like multiple</span> <span data-start="671.319" data-end="673.6">numerous nonsensical reasons and so it</span> <span data-start="673.6" data-end="675.22">should encourage us do not write just</span> <span data-start="675.22" data-end="676.2">like this so</span> <span data-start="676.2" data-end="678.18">please don't do that and so instead of</span> <span data-start="678.18" data-end="680.01">critiquing how much mocking you see in</span> <span data-start="680.01" data-end="682.23">the codebase critique why people are</span> <span data-start="682.23" data-end="683.82">using box at all like what's the broader</span> <span data-start="683.82" data-end="685.59">strategy here and I guarantee you'll</span> <span data-start="685.59" data-end="687.39">have more productive discussions the</span> <span data-start="687.39" data-end="688.62">common thread between all three of these</span> <span data-start="688.62" data-end="690.69">things is that I think that you know</span> <span data-start="690.69" data-end="693.72">just we all tend to have this sensation</span> <span data-start="693.72" data-end="696.12">that like realism is very important in</span> <span data-start="696.12" data-end="697.02">testing because we want to make sure</span> <span data-start="697.02" data-end="698.16">things are gonna work and they're not</span> <span data-start="698.16" data-end="700.22">gonna explode but that can actually</span> <span data-start="700.22" data-end="704.04">cause problems where we forget that what</span> <span data-start="704.04" data-end="705.75">testing is really about is like setting</span> <span data-start="705.75" data-end="707.37">up clear experimental control to get</span> <span data-start="707.37" data-end="708.57">consistent results that tell us</span> <span data-start="708.57" data-end="709.83">something that we need to know and</span> <span data-start="709.83" data-end="712.2">that's important to all right so let's</span> <span data-start="712.2" data-end="713.88">move on to like the less obvious abuses</span> <span data-start="713.88" data-end="715.8">and that's I want to start with talking</span> <span data-start="715.8" data-end="717.96">about mocking out third-party libraries</span> <span data-start="717.96" data-end="720.33">so say that you depend on an awesome Lib</span> <span data-start="720.33" data-end="721.8">it's an NPM package and there's</span> <span data-start="721.8" data-end="723.54">references to it all over your codebase</span> <span data-start="723.54" data-end="725.73">it's got a kind of funky API though</span> <span data-start="725.73" data-end="728.04">first you call it and then you pass it a</span> <span data-start="728.04" data-end="729.81">config file so we read that from disk</span> <span data-start="729.81" data-end="731.7">that returns an instance of the library</span> <span data-start="731.7" data-end="733.59">that we can then call an optimized</span> <span data-start="733.59" data-end="734.91">method on and we get all these really</span> <span data-start="734.91" data-end="736.92">cool interpreter hints that we can use</span> <span data-start="736.92" data-end="739.32">to speed up our code problem with that</span> <span data-start="739.32" data-end="740.82">is that song and dance is kind of weird</span> <span data-start="740.82" data-end="743.04">and so it's really hard to mock awesome</span> <span data-start="743.04" data-end="745.56">live and here's like how you might you</span> <span data-start="745.56" data-end="747.45">know try to go about it you fake up the</span> <span data-start="747.45" data-end="748.68">file system and then you fake out</span> <span data-start="748.68" data-end="750.51">awesome Lib and then you create a an</span> <span data-start="750.51" data-end="752.07">artificial instance to represent</span> <span data-start="752.07" data-end="753.87">creating one then you fake out the file</span> <span data-start="753.87" data-end="755.64">system to say hey if we pass the right</span> <span data-start="755.64" data-end="756.63">path I'll give you something to</span> <span data-start="756.63" data-end="758.28">represent the config and then when we</span> <span data-start="758.28" data-end="760.05">get the config will return that instance</span> <span data-start="760.05" data-end="761.31">and then when you call optimize on the</span> <span data-start="761.31" data-end="762.84">instance we'll call back with some hints</span> <span data-start="762.84" data-end="764.52">that's a lot of setup and so you'd be</span> <span data-start="764.52" data-end="765.72">right to look at that and get really</span> <span data-start="765.72" data-end="767.43">frustrated how much you know mocking</span> <span data-start="767.43" data-end="768.96">logic you have at the top of your test</span> <span data-start="768.96" data-end="770.22">and a lot of people complain about that</span> <span data-start="770.22" data-end="772.77">but the root cause here has nothing to</span> <span data-start="772.77" data-end="773.97">do with the mocking library the root</span> <span data-start="773.97" data-end="775.86">cause is that that was hard to use code</span> <span data-start="775.86" data-end="778.53">and that like mocking libraries job is</span> <span data-start="778.53" data-end="780.18">to specify interactions you have with</span> <span data-start="780.18" data-end="782.61">public API s and so what the mocking</span> <span data-start="782.61" data-end="784.17">library is doing is it screaming at you</span> <span data-start="784.17" data-end="787.2">that this is a bad design so instead we</span> <span data-start="787.2" data-end="789.06">just like force it and so we like copy</span> <span data-start="789.06" data-end="790.74">paste that set up across all of our</span> <span data-start="790.74" data-end="794.07">tests and and you know JavaScript we</span> <span data-start="794.07" data-end="796.08">march along very quickly new major</span> <span data-start="796.08" data-end="797.67">update is announced to Awesome Lib and</span> <span data-start="797.67" data-end="799.11">we're really excited that maybe they'll</span> <span data-start="799.11" data-end="800.46">fix this for us but all they did was</span> <span data-start="800.46" data-end="803.33">change the callbacks to promises and so</span> <span data-start="803.33" data-end="806.01">now we have to go over here and J and</span> <span data-start="806.01" data-end="808.26">just add then resolve so that these are</span> <span data-start="808.26" data-end="808.48">not</span> <span data-start="808.48" data-end="809.98">promise resolutions and we have to do it</span> <span data-start="809.98" data-end="812.649">in 18 different places javascript</span> <span data-start="812.649" data-end="814.99">marches on and nobody uses awesome lib</span> <span data-start="814.99" data-end="817.209">anymore we find out that like the new</span> <span data-start="817.209" data-end="819.55">hotness is mind blow and and everyone's</span> <span data-start="819.55" data-end="821.199">pressuring us to go and switch as fast</span> <span data-start="821.199" data-end="823.149">as possible and so now we're just angry</span> <span data-start="823.149" data-end="824.68">because we have all this pain festering</span> <span data-start="824.68" data-end="826.93">throughout our system what I found is</span> <span data-start="826.93" data-end="828.82">that like if code is hard to mock and</span> <span data-start="828.82" data-end="830.44">it's something that you own it's a</span> <span data-start="830.44" data-end="831.88">module that's in your codebase and you</span> <span data-start="831.88" data-end="833.98">can readily change it that that feedback</span> <span data-start="833.98" data-end="836.01">is fantastic because the remedy has</span> <span data-start="836.01" data-end="838.57">improved the code design but if it's a</span> <span data-start="838.57" data-end="839.949">third party thing that you don't control</span> <span data-start="839.949" data-end="841.089">what are you gonna do like send a pull</span> <span data-start="841.089" data-end="842.17">request and ask them to change their</span> <span data-start="842.17" data-end="845.019">public API adjust for you no it's it's</span> <span data-start="845.019" data-end="846.73">not gonna work out so well it's it's an</span> <span data-start="846.73" data-end="849.04">example of useless pain and how people</span> <span data-start="849.04" data-end="850.839">go about testing is full of useless pain</span> <span data-start="850.839" data-end="852.82">so be on the lookout because it's money</span> <span data-start="852.82" data-end="854.17">out the window so if you care about</span> <span data-start="854.17" data-end="856">testing you need to minimize the amount</span> <span data-start="856" data-end="857.29">of drudgery or else people are gonna</span> <span data-start="857.29" data-end="858.97">come to value at less and view it as a</span> <span data-start="858.97" data-end="861.579">waste of time so instead of mocking out</span> <span data-start="861.579" data-end="862.75">third-party things I write little</span> <span data-start="862.75" data-end="866.23">wrappers for them instead an example of</span> <span data-start="866.23" data-end="867.579">this one might here be here just as</span> </p>
<p><span data-start="867.579" data-end="869.23">Questor it off to the periphery of my</span> <span data-start="869.23" data-end="871.06">application this is the only time I'm</span> <span data-start="871.06" data-end="872.62">ever going to require awesome live in my</span> <span data-start="872.62" data-end="874.54">app and instead I'm going to expose this</span> <span data-start="874.54" data-end="877.089">simple awesome callback API that I wish</span> <span data-start="877.089" data-end="878.98">that it did and sweep under the rug all</span> <span data-start="878.98" data-end="880.589">the other complexity that I have to have</span> <span data-start="880.589" data-end="883.779">additionally doing this by habit gives</span> <span data-start="883.779" data-end="885.399">you some like additional mental space to</span> <span data-start="885.399" data-end="887.29">think hey maybe we should be caching</span> <span data-start="887.29" data-end="889">this file a read that's kind of silly or</span> <span data-start="889" data-end="891.16">you know we could translate the awesome</span> </p>
<p><span data-start="891.16" data-end="892.69">Lib errors into something that's like</span> <span data-start="892.69" data-end="894.31">more concordant with like how we write</span> <span data-start="894.31" data-end="895.99">error handling for the rest of the</span> <span data-start="895.99" data-end="897.94">application and you can just do all that</span> <span data-start="897.94" data-end="900.91">there additionally all that test setup</span> <span data-start="900.91" data-end="902.26">you know that gets a lot simpler right</span> <span data-start="902.26" data-end="903.37">because now we're just faking out</span> <span data-start="903.37" data-end="904.66">something that we understand that's</span> <span data-start="904.66" data-end="907.42">simple to use and create so much extra</span> <span data-start="907.42" data-end="909.73">room in each test to be thinking about</span> <span data-start="909.73" data-end="911.38">like what am I actually trying to</span> <span data-start="911.38" data-end="913.06">specify instead of getting distracted in</span> <span data-start="913.06" data-end="915.22">all sorts of mocking related rabbit</span> <span data-start="915.22" data-end="917.199">holes and you don't have to worry about</span> <span data-start="917.199" data-end="919.149">writing unit tests of these things for</span> <span data-start="919.149" data-end="920.199">the same reason you're not going to</span> <span data-start="920.199" data-end="921.699">improve their design just trust the</span> <span data-start="921.699" data-end="923.11">framework to work because otherwise this</span> <span data-start="923.11" data-end="925.839">is money out the window then the next</span> <span data-start="925.839" data-end="927.639">lesser of the obvious things that I see</span> <span data-start="927.639" data-end="929.23">folks do is when they read a lot of code</span> <span data-start="929.23" data-end="931.51">that tangles up logic with delegation</span> <span data-start="931.51" data-end="932.98">let's explain so let's say that you own</span> <span data-start="932.98" data-end="934.779">a fencing studio and you rent out swords</span> <span data-start="934.779" data-end="936.339">and your boss says hey how many swords</span> <span data-start="936.339" data-end="937.93">are we gonna have on Tuesday and so</span> <span data-start="937.93" data-end="939.04">instead of like being like a normal</span> <span data-start="939.04" data-end="940.839">person you write it function that takes</span> <span data-start="940.839" data-end="941.88">in a date</span> <span data-start="941.88" data-end="944.83">you call a network requests to fetch out</span> <span data-start="944.83" data-end="946.06">all the rentals that are currently</span> <span data-start="946.06" data-end="947.95">outstanding you get those back and then</span> <span data-start="947.95" data-end="949.39">you filter those down first by</span> <span data-start="949.39" data-end="950.86">calculating the duration of that rental</span> <span data-start="950.86" data-end="952.03">and then figuring out when did the</span> <span data-start="952.03" data-end="953.92">rental start so that I can figure out</span> <span data-start="953.92" data-end="955.78">what's going to be do then plucking the</span> <span data-start="955.78" data-end="957.97">swords out of it now you also have an</span> <span data-start="957.97" data-end="959.53">inventory the stuff that's not currently</span> <span data-start="959.53" data-end="961.18">being rented so you call that — you get</span> <span data-start="961.18" data-end="962.47">the inventory back you can catenate the</span> <span data-start="962.47" data-end="963.61">- and then those are the swords that</span> <span data-start="963.61" data-end="965.47">you're gonna get back so you can report</span> <span data-start="965.47" data-end="967.9">success how might you test this well you</span> <span data-start="967.9" data-end="969.82">start by creating a fake rental object</span> <span data-start="969.82" data-end="971.35">properly that has the right properties</span> <span data-start="971.35" data-end="973.57">on it you stub that out so that fetch</span> <span data-start="973.57" data-end="974.92">rentals calls back with it when it's</span> <span data-start="974.92" data-end="976.93">invoked you step out the inventory as</span> <span data-start="976.93" data-end="978.76">well maybe with a second sword and then</span> <span data-start="978.76" data-end="980.38">with a very particular date argument you</span> <span data-start="980.38" data-end="982.63">call the subject under test and you</span> <span data-start="982.63" data-end="983.98">assert that like you get the two swords</span> <span data-start="983.98" data-end="985.39">that you expect and this works and you</span> <span data-start="985.39" data-end="986.95">have some other test cases — so it's a</span> <span data-start="986.95" data-end="989.38">little complicated time passes though</span> <span data-start="989.38" data-end="990.94">it's working fine and somebody on the</span> <span data-start="990.94" data-end="992.83">team points up hey you know we can speed</span> <span data-start="992.83" data-end="994.69">this code path up now because we have a</span> <span data-start="994.69" data-end="996.64">primed synchronous cache that you can</span> <span data-start="996.64" data-end="998.2">call you can go into the code and you</span> <span data-start="998.2" data-end="999.46">can eliminate one of these network</span> <span data-start="999.46" data-end="1001.47">requests so you just call that instead</span> </p>
<p><span data-start="1001.47" data-end="1003.06">I've done this and now that looks good</span> <span data-start="1003.06" data-end="1005.61">the code is faster but of course what it</span> <span data-start="1005.61" data-end="1008.28">broke the test so we're we're frustrated</span> <span data-start="1008.28" data-end="1010.8">by that if you look here yes sure enough</span> <span data-start="1010.8" data-end="1012.42">we are we are mocking out this other</span> <span data-start="1012.42" data-end="1014.49">thing for that part of the behavior it's</span> <span data-start="1014.49" data-end="1015.9">not going to do what we want the test is</span> <span data-start="1015.9" data-end="1017.28">gonna break and somebody on the team</span> <span data-start="1017.28" data-end="1018.87">might point out like oh well the test is</span> <span data-start="1018.87" data-end="1020.4">coupled to the implementation this is</span> <span data-start="1020.4" data-end="1021.96">very bad this is a common criticism</span> <span data-start="1021.96" data-end="1023.76">against mocking but I don't think it's</span> <span data-start="1023.76" data-end="1025.47">necessarily bad I think it's a little</span> <span data-start="1025.47" data-end="1027.78">bit of naive criticism because like we</span> <span data-start="1027.78" data-end="1029.58">write a test and then we assume that</span> <span data-start="1029.58" data-end="1032.16">it's going to save us in 800 different</span> <span data-start="1032.16" data-end="1034.23">types of change that the system might</span> <span data-start="1034.23" data-end="1036.36">undergo but like at most it can help us</span> <span data-start="1036.36" data-end="1037.86">from one or two so when you're writing</span> <span data-start="1037.86" data-end="1040.23">tests think about like you know this</span> <span data-start="1040.23" data-end="1042.959">test is going to make me safe for a</span> <span data-start="1042.959" data-end="1045.24">certain kind of change maybe but design</span> <span data-start="1045.24" data-end="1047.1">that upfront so for example if you have</span> <span data-start="1047.1" data-end="1048.99">your writing test or something it</span> <span data-start="1048.99" data-end="1050.43">doesn't have any dependencies it's</span> <span data-start="1050.43" data-end="1052.47">probably a pure function specifying</span> <span data-start="1052.47" data-end="1054.39">logic and that means that if the rules</span> <span data-start="1054.39" data-end="1056.73">to that logic change the tests need to</span> <span data-start="1056.73" data-end="1058.44">change if you're just refactoring from a</span> <span data-start="1058.44" data-end="1060.09">for loop to a for each or something</span> <span data-start="1060.09" data-end="1061.89">you're probably going to be fine but</span> <span data-start="1061.89" data-end="1063.93">like if you're adding a grace period to</span> <span data-start="1063.93" data-end="1065.76">these rental durations the rules of the</span> <span data-start="1065.76" data-end="1067.05">game change so you have to update all of</span> <span data-start="1067.05" data-end="1068.76">your code examples it is coupled to the</span> <span data-start="1068.76" data-end="1071.61">implementation in that way so if you</span> <span data-start="1071.61" data-end="1073.53">have like another test though and you're</span> <span data-start="1073.53" data-end="1074.19">mocking all</span> <span data-start="1074.19" data-end="1076.529">dependencies of the subject what it does</span> <span data-start="1076.529" data-end="1079.08">is it specifies those relationships and</span> <span data-start="1079.08" data-end="1080.46">so when the contracts change the test</span> <span data-start="1080.46" data-end="1082.289">needs to change the previous example</span> <span data-start="1082.289" data-end="1083.759">like if the duration has a grace period</span> <span data-start="1083.759" data-end="1085.799">one of its dependencies that's internal</span> <span data-start="1085.799" data-end="1088.11">to that that's that's arm's length we</span> <span data-start="1088.11" data-end="1089.399">don't have to worry about that this test</span> <span data-start="1089.399" data-end="1091.289">should keep passing but if we literally</span> <span data-start="1091.289" data-end="1093.539">change what we depend on to do our job</span> <span data-start="1093.539" data-end="1095.19">of course that just is going to change</span> <span data-start="1095.19" data-end="1098.49">gonna break and you need to fix it where</span> <span data-start="1098.49" data-end="1100.08">this really flies off the rails is when</span> <span data-start="1100.08" data-end="1102.36">people are right subjects that have you</span> <span data-start="1102.36" data-end="1104.519">know both the mocking out dependencies</span> <span data-start="1104.519" data-end="1106.409">and also implement some amount of logic</span> <span data-start="1106.409" data-end="1108.809">it gets really painful so to illustrate</span> <span data-start="1108.809" data-end="1111.179">our own example does this right we have</span> <span data-start="1111.179" data-end="1112.71">this current inventory we're calling</span> <span data-start="1112.71" data-end="1113.94">this fetch rental service that we're</span> <span data-start="1113.94" data-end="1115.62">calling but then we kind of like a joint</span> <span data-start="1115.62" data-end="1117.539">on to that this responsibility to like</span> <span data-start="1117.539" data-end="1120.48">calculate windswords or do and you can</span> <span data-start="1120.48" data-end="1121.769">see it right here it screams off the</span> <span data-start="1121.769" data-end="1123.659">page if you know what to look for you</span> <span data-start="1123.659" data-end="1125.129">know I've got network requests here and</span> </p>
<p><span data-start="1125.129" data-end="1126.84">I got all this logic and it's same thing</span> <span data-start="1126.84" data-end="1128.009">in the test I've got the network</span> <span data-start="1128.009" data-end="1129.36">requests here and then all this logic</span> <span data-start="1129.36" data-end="1131.549">floating around and what this is what</span> <span data-start="1131.549" data-end="1132.659">we've called it like if we're given a</span> <span data-start="1132.659" data-end="1134.34">design critique of this module we'd say</span> <span data-start="1134.34" data-end="1136.139">that this is mixed levels of abstraction</span> <span data-start="1136.139" data-end="1138.029">because two of the things that we're</span> <span data-start="1138.029" data-end="1139.59">doing are happening with like business</span> <span data-start="1139.59" data-end="1140.85">domain objects that speak in our</span> <span data-start="1140.85" data-end="1144.12">language like like like peers throughout</span> <span data-start="1144.12" data-end="1145.919">the app but then we're also dealing with</span> <span data-start="1145.919" data-end="1147.57">all this primitive gunk we're</span> <span data-start="1147.57" data-end="1149.279">implementing logic and multiplying</span> <span data-start="1149.279" data-end="1151.11">primitive you know values like integers</span> <span data-start="1151.11" data-end="1153.779">and such and that's a classic example of</span> <span data-start="1153.779" data-end="1155.129">a code smell and the way that you'd</span> <span data-start="1155.129" data-end="1156.419">remediated that code smell is by</span> <span data-start="1156.419" data-end="1158.73">spinning off that third thing so that</span> <span data-start="1158.73" data-end="1160.019">sword stock now has a single</span> <span data-start="1160.019" data-end="1161.7">responsibility its job is to break up</span> <span data-start="1161.7" data-end="1163.08">the work into these three other parts</span> <span data-start="1163.08" data-end="1165.47">and let them do the real heavy lifting</span> <span data-start="1165.47" data-end="1168.45">and and that thing that we just spun off</span> <span data-start="1168.45" data-end="1170.159">is now a lot easier to maintain because</span> <span data-start="1170.159" data-end="1171.48">it just takes in a couple arguments</span> <span data-start="1171.48" data-end="1173.009">spits out an outcome it's a pure</span> <span data-start="1173.009" data-end="1175.139">function really easy to test really easy</span> <span data-start="1175.139" data-end="1177.269">to maintain so if a test is specifying</span> <span data-start="1177.269" data-end="1179.669">pure logic there's no easier test to</span> <span data-start="1179.669" data-end="1181.44">write inputs and outputs there's there's</span> <span data-start="1181.44" data-end="1183.419">nothing else to deal with if it tests</span> <span data-start="1183.419" data-end="1185.1">specifies relationships and only</span> <span data-start="1185.1" data-end="1187.139">relationships those are completely under</span> <span data-start="1187.139" data-end="1188.909">your control they tend to not change</span> <span data-start="1188.909" data-end="1190.679">unless the contract changes but if it</span> <span data-start="1190.679" data-end="1192.059">specifies both you're gonna have really</span> <span data-start="1192.059" data-end="1193.649">really long test cases that change for</span> <span data-start="1193.649" data-end="1195.21">all sorts of different reasons it's more</span> <span data-start="1195.21" data-end="1197.399">useless pain so if you need a sticky</span> <span data-start="1197.399" data-end="1199.649">note to like put on your team wall or</span> <span data-start="1199.649" data-end="1202.74">something I encourage everyone to write</span> <span data-start="1202.74" data-end="1204.869">functions that either do something or</span> <span data-start="1204.869" data-end="1206.9">delegate to someone but</span> <span data-start="1206.9" data-end="1210.38">both all right the last lesser of the</span> <span data-start="1210.38" data-end="1212.78">obvious things that I see people do is</span> <span data-start="1212.78" data-end="1214.49">when they mock dependencies like halfway</span> <span data-start="1214.49" data-end="1216.92">down the call stack so what I mean by</span> <span data-start="1216.92" data-end="1219.29">that let's take that we have writing a</span> <span data-start="1219.29" data-end="1221.21">system to handle travel expenses</span> <span data-start="1221.21" data-end="1222.89">so we have our invoicing app and then</span> <span data-start="1222.89" data-end="1224.54">we're communicating via HTTP to get some</span> </p>
<p><span data-start="1224.54" data-end="1226.67">JSON back from our expense system and so</span> <span data-start="1226.67" data-end="1228.62">we have a method send invoice which</span> <span data-start="1228.62" data-end="1230.06">calls build invoice which calls to</span> <span data-start="1230.06" data-end="1232.04">filter the approved ones should groups</span> <span data-start="1232.04" data-end="1233.51">in buy purchase order and then loads the</span> <span data-start="1233.51" data-end="1235.19">expenses and then that breaks out to</span> <span data-start="1235.19" data-end="1236.96">HTTP to like load them from the expense</span> <span data-start="1236.96" data-end="1238.76">system and then all the way back up the</span> <span data-start="1238.76" data-end="1240.53">chain with this intermediary D or data</span> <span data-start="1240.53" data-end="1242.84">models for those actors so you might ask</span> <span data-start="1242.84" data-end="1244.25">hey I'm writing a test to this send</span> <span data-start="1244.25" data-end="1246.11">invoice thing which layer do I mock it</span> <span data-start="1246.11" data-end="1248.33">it's a good question so what my answer</span> <span data-start="1248.33" data-end="1249.23">depends on what kind of test you're</span> <span data-start="1249.23" data-end="1249.59">writing</span> <span data-start="1249.59" data-end="1251.03">so if you're writing an isolated unit</span> <span data-start="1251.03" data-end="1252.5">test as you develop it I would always</span> <span data-start="1252.5" data-end="1255.35">say depend not out the direct dependency</span> <span data-start="1255.35" data-end="1256.52">because you're gonna get designed</span> <span data-start="1256.52" data-end="1258.23">feedback what it's like to invoke that</span> <span data-start="1258.23" data-end="1259.91">thing and the test data is going to be</span> <span data-start="1259.91" data-end="1261.71">completely minimal so the contract</span> <span data-start="1261.71" data-end="1263.27">between those two things is really clear</span> <span data-start="1263.27" data-end="1264.98">if you're trying to get regression</span> <span data-start="1264.98" data-end="1266.63">safety just make sure that things work I</span> <span data-start="1266.63" data-end="1268.07">would either mock out nothing or say</span> <span data-start="1268.07" data-end="1270.38">mock out only like external system so</span> <span data-start="1270.38" data-end="1271.85">that you're using the system like a real</span> <span data-start="1271.85" data-end="1274.43">user would benefits here are that like</span> <span data-start="1274.43" data-end="1276.59">your test data is going to be</span> <span data-start="1276.59" data-end="1278.3">representative of real life they're</span> <span data-start="1278.3" data-end="1279.98">probably gonna like look like HTTP</span> <span data-start="1279.98" data-end="1282.38">fixtures and additionally if it breaks</span> <span data-start="1282.38" data-end="1283.79">you know what that means it doesn't work</span> <span data-start="1283.79" data-end="1286.25">anymore but I see a lot of teams reach</span> <span data-start="1286.25" data-end="1287.75">for the convenience of just mocking it</span> <span data-start="1287.75" data-end="1289.43">whatever arbitrary depth comes to mind</span> <span data-start="1289.43" data-end="1290.9">and this is kind of the worst of both</span> <span data-start="1290.9" data-end="1292.97">worlds because when it fails it doesn't</span> <span data-start="1292.97" data-end="1294.26">mean anything other than somebody might</span> <span data-start="1294.26" data-end="1295.34">have changed something and now you have</span> <span data-start="1295.34" data-end="1297.83">to update this test or like the the data</span> <span data-start="1297.83" data-end="1299.18">that you're loading the fixtures are all</span> <span data-start="1299.18" data-end="1300.92">kind of coupled to that thing and so</span> <span data-start="1300.92" data-end="1302.57">your data could fall out of sync at any</span> <span data-start="1302.57" data-end="1304.1">moment and yet this is probably like 80%</span> <span data-start="1304.1" data-end="1305.93">of the way that I see people knocking</span> <span data-start="1305.93" data-end="1307.28">out data providers and their JavaScript</span> <span data-start="1307.28" data-end="1311.21">apps so to summarize if you mock out a</span> <span data-start="1311.21" data-end="1312.92">direct dependency the failure is</span> <span data-start="1312.92" data-end="1314.36">meaningful because it means the contract</span> <span data-start="1314.36" data-end="1315.11">had changed</span> <span data-start="1315.11" data-end="1317.18">if you mock out an external system again</span> <span data-start="1317.18" data-end="1319.31">it's a meaningful failure it means your</span> <span data-start="1319.31" data-end="1321.05">thing is broken but if you mock out this</span> <span data-start="1321.05" data-end="1322.49">intermediate layer it probably just</span> <span data-start="1322.49" data-end="1323.84">means that you have to go and do the</span> <span data-start="1323.84" data-end="1325.76">chore of like updating that test now a</span> <span data-start="1325.76" data-end="1327.77">probably it's going to like your eyes</span> <span data-start="1327.77" data-end="1329.36">will glaze over when the build fails cuz</span> <span data-start="1329.36" data-end="1330.5">you know you just have to go update</span> <span data-start="1330.5" data-end="1332.51">stuff the common thread between all of</span> <span data-start="1332.51" data-end="1334.37">these is that when we reach for mocks is</span> <span data-start="1334.37" data-end="1336.32">just a tool of convenience they undercut</span> <span data-start="1336.32" data-end="1338.78">our overall test strategies return on</span> <span data-start="1338.78" data-end="1340.52">investment and</span> <span data-start="1340.52" data-end="1342.83">tends to make mocks a four-letter word</span> <span data-start="1342.83" data-end="1344.63">on a lot of teams I said that just</span> <span data-start="1344.63" data-end="1346.16">realizing Mach was already a four-letter</span> <span data-start="1346.16" data-end="1350.33">word but you get my point let's move on</span> <span data-start="1350.33" data-end="1351.73">to the questionable uses of mocking</span> <span data-start="1351.73" data-end="1353.96">first one I see a lot is when people</span> <span data-start="1353.96" data-end="1356.72">write mocked out tests for existing code</span> <span data-start="1356.72" data-end="1358.64">bases let's say that you work at an</span> <span data-start="1358.64" data-end="1361.01">internet of things doorbell company and</span> <span data-start="1361.01" data-end="1362.33">your startups you got a lot of spaghetti</span> <span data-start="1362.33" data-end="1364.52">code but you just got a lot more funding</span> <span data-start="1364.52" data-end="1365.84">so you can finally write all those unit</span> <span data-start="1365.84" data-end="1367.46">tests that you never did and you've been</span> <span data-start="1367.46" data-end="1368.66">really ashamed of the fact that you at</span> <span data-start="1368.66" data-end="1371">0% code coverage in your system and so</span> <span data-start="1371" data-end="1372.32">you think well what's the first test</span> <span data-start="1372.32" data-end="1373.37">that I could write let's write something</span> <span data-start="1373.37" data-end="1375.08">real simple and integral to like what</span> <span data-start="1375.08" data-end="1376.85">our system does that when you ring the</span> <span data-start="1376.85" data-end="1379.49">door the ding count goes up and so we</span> <span data-start="1379.49" data-end="1381.38">require a doorbell and then we require</span> <span data-start="1381.38" data-end="1383.54">the thing that rings the doorbell we</span> <span data-start="1383.54" data-end="1384.98">create a new doorbell we passes the</span> <span data-start="1384.98" data-end="1386.36">subject and make sure that the ding</span> <span data-start="1386.36" data-end="1389.059">count has been incremented we run this</span> <span data-start="1389.059" data-end="1391.4">test and oh well we got the stupid error</span> <span data-start="1391.4" data-end="1393.44">because you got to have a door for a</span> <span data-start="1393.44" data-end="1395.63">doorbell no problem I'm gonna import the</span> <span data-start="1395.63" data-end="1397.73">door it's actually the door passes to</span> <span data-start="1397.73" data-end="1400.16">the doorbell run my test except for the</span> <span data-start="1400.16" data-end="1402.17">fact that a door requires a house it's</span> <span data-start="1402.17" data-end="1402.679">fine</span> <span data-start="1402.679" data-end="1403.75">you're gonna import the house</span> <span data-start="1403.75" data-end="1405.41">instantiate a passing the door which</span> <span data-start="1405.41" data-end="1406.97">passes the doorbell oh just passing the</span> <span data-start="1406.97" data-end="1408.59">subject run the test and a house</span> <span data-start="1408.59" data-end="1409.97">requires a paid subscription network</span> <span data-start="1409.97" data-end="1411.59">connection to this other service and you</span> <span data-start="1411.59" data-end="1413.42">know what now you're just upset and</span> <span data-start="1413.42" data-end="1415.25">frustrated because like the thing about</span> <span data-start="1415.25" data-end="1417.47">untested code is very often lots of code</span> <span data-start="1417.47" data-end="1418.58">paths especially when we're creating</span> <span data-start="1418.58" data-end="1420.8">values are only ever invoked in one</span> <span data-start="1420.8" data-end="1423.05">place and so this kind of crapped you</span> <span data-start="1423.05" data-end="1424.82">can just like accrue one of the best</span> <span data-start="1424.82" data-end="1426.17">things about testing is all your code</span> <span data-start="1426.17" data-end="1428.15">gets like lots of exercise in lots of</span> <span data-start="1428.15" data-end="1429.32">different contexts so you're</span> <span data-start="1429.32" data-end="1430.85">incentivized to make value objects that</span> <span data-start="1430.85" data-end="1432.95">are cheap and easy to construct so the</span> <span data-start="1432.95" data-end="1434.6">right thing to do here is like make your</span> <span data-start="1434.6" data-end="1436.67">value objects easier to construct but of</span> <span data-start="1436.67" data-end="1437.66">course what they do instead is they</span> <span data-start="1437.66" data-end="1439.04">knock all that stuff out replace it with</span> <span data-start="1439.04" data-end="1440.99">a fake doorbell set add in count on it</span> <span data-start="1440.99" data-end="1443.15">and then get to get to passing but this</span> <span data-start="1443.15" data-end="1447.08">is not the right reaction I like if I</span> <span data-start="1447.08" data-end="1448.97">had to summarize that into like a motto</span> </p>
<p><span data-start="1448.97" data-end="1451.1">I say like mock out independencies mock</span> <span data-start="1451.1" data-end="1452.33">out things that have like application</span> <span data-start="1452.33" data-end="1455.09">logic that do the work but pass in real</span> <span data-start="1455.09" data-end="1456.89">values that type information should be</span> <span data-start="1456.89" data-end="1459.14">valuable it should be easy to construct</span> <span data-start="1459.14" data-end="1461.24">them and besides tests like this aren't</span> <span data-start="1461.24" data-end="1462.32">going to get you they're not gonna move</span> <span data-start="1462.32" data-end="1464.69">the needle very much in this person</span> <span data-start="1464.69" data-end="1466.88">situation instead what you probably want</span> <span data-start="1466.88" data-end="1469.28">with an untested system is more safety</span> <span data-start="1469.28" data-end="1471.11">to aggressively refactor it in which</span> <span data-start="1471.11" data-end="1472.83">case I recommend you to</span> <span data-start="1472.83" data-end="1475.2">the distance so think of ring Bell in</span> <span data-start="1475.2" data-end="1476.789">the context of its application maybe</span> <span data-start="1476.789" data-end="1478.44">there's an HTTP router in front of that</span> <span data-start="1478.44" data-end="1479.97">and then we could write a test that runs</span> <span data-start="1479.97" data-end="1481.919">in a separate process that interrogate</span> <span data-start="1481.919" data-end="1483.48">that thing just the way a real user</span> <span data-start="1483.48" data-end="1485.309">would so we can send a post request to</span> <span data-start="1485.309" data-end="1486.63">like exercise the behavior that we want</span> <span data-start="1486.63" data-end="1489.029">to test you know assume that maybe</span> <span data-start="1489.029" data-end="1490.679">writes to a data store somewhere and</span> <span data-start="1490.679" data-end="1492.84">then after we've done that we can run</span> <span data-start="1492.84" data-end="1494.519">another request and see whether or not</span> <span data-start="1494.519" data-end="1496.14">they'd had the impact that we want it or</span> <span data-start="1496.14" data-end="1497.37">we maybe could look directly at the</span> <span data-start="1497.37" data-end="1499.08">database and this is gonna provide way</span> <span data-start="1499.08" data-end="1501.299">more safety to like actually start</span> <span data-start="1501.299" data-end="1502.71">changing and improving the design of</span> <span data-start="1502.71" data-end="1505.62">that ring bell subject now integrated</span> <span data-start="1505.62" data-end="1507.48">tests they are indeed slower and they</span> <span data-start="1507.48" data-end="1509.519">fail for more nonsensical reasons but</span> <span data-start="1509.519" data-end="1511.38">they do provide more refactor safety and</span> <span data-start="1511.38" data-end="1512.49">if you knew you're in this situation</span> <span data-start="1512.49" data-end="1514.2">they're going to be a way more bang for</span> <span data-start="1514.2" data-end="1515.519">your buck from a code coverage</span> <span data-start="1515.519" data-end="1517.049">perspective and actually providing some</span> <span data-start="1517.049" data-end="1518.309">sort of sense that your build means</span> <span data-start="1518.309" data-end="1519.45">something</span> <span data-start="1519.45" data-end="1521.34">the next questionable use I see people</span> <span data-start="1521.34" data-end="1523.44">do a lot is enabling highly layered</span> <span data-start="1523.44" data-end="1526.559">designs by leveraging mocks you know</span> <span data-start="1526.559" data-end="1527.909">something I've seen over the years is</span> <span data-start="1527.909" data-end="1529.95">that testing tends to push us to make</span> <span data-start="1529.95" data-end="1532.47">smaller objects so instead of like one</span> <span data-start="1532.47" data-end="1535.59">gigantic horse sized duck module we're</span> <span data-start="1535.59" data-end="1537.86">writing like a hundred duck-sized horse</span> <span data-start="1537.86" data-end="1540.269">so instead of having a gigantic order</span> <span data-start="1540.269" data-end="1542.039">j/s method with like 800 methods all</span> <span data-start="1542.039" data-end="1543.659">over it we might have like a bunch of</span> <span data-start="1543.659" data-end="1544.769">carefully named different</span> <span data-start="1544.769" data-end="1547.049">responsibilities in our app in separate</span> <span data-start="1547.049" data-end="1550.08">files and so forth now I can talk all</span> <span data-start="1550.08" data-end="1552.029">day about like why big modules are bad</span> <span data-start="1552.029" data-end="1554.22">but it's not the case that smaller</span> <span data-start="1554.22" data-end="1555.63">modules are better just because they're</span> <span data-start="1555.63" data-end="1558.12">smaller in fact if you're like every</span> <span data-start="1558.12" data-end="1559.409">time you pick up a new feature and you</span> <span data-start="1559.409" data-end="1560.639">go to implement it you're just kind of</span> <span data-start="1560.639" data-end="1563.22">creating these six cookie cutter objects</span> <span data-start="1563.22" data-end="1565.049">over and over and over again you're not</span> <span data-start="1565.049" data-end="1566.85">actually like improving the design</span> <span data-start="1566.85" data-end="1568.62">that's just large objects with extra</span> <span data-start="1568.62" data-end="1571.049">steps like you're still you're adding a</span> <span data-start="1571.049" data-end="1572.22">bunch of new direction you're adding a</span> <span data-start="1572.22" data-end="1573.57">bunch of files you're not really like</span> <span data-start="1573.57" data-end="1575.789">improving things so you might ask hey</span> <span data-start="1575.789" data-end="1577.799">what is this like unsolicited design</span> <span data-start="1577.799" data-end="1579.57">feedback have to do with mocking well</span> </p>
<p><span data-start="1579.57" data-end="1582.299">I'll tell ya if we were testing all this</span> <span data-start="1582.299" data-end="1584.519">stuff and we made a change to this like</span> <span data-start="1584.519" data-end="1586.289">a bottom layer that's really heavily</span> <span data-start="1586.289" data-end="1588.36">dependent on module of course we would</span> <span data-start="1588.36" data-end="1590.49">have to update that test but normally it</span> <span data-start="1590.49" data-end="1591.96">would also fail all the tests of the</span> <span data-start="1591.96" data-end="1593.22">things and depend on that thing and</span> <span data-start="1593.22" data-end="1595.799">would disincentivize from a layering</span> <span data-start="1595.799" data-end="1598.59">like this but mocking comes in a lot of</span> <span data-start="1598.59" data-end="1599.94">teams will be like alright cool i can</span> <span data-start="1599.94" data-end="1601.71">just fake out all the layers beneath me</span> <span data-start="1601.71" data-end="1603.779">and so that means that i can create</span> <span data-start="1603.779" data-end="1605.49">these arbitrarily injury</span> <span data-start="1605.49" data-end="1607.74">stacked up applications with with the</span> <span data-start="1607.74" data-end="1609.57">test not no longer providing me that</span> <span data-start="1609.57" data-end="1611.429">feedback so mocks actually add a blind</span> <span data-start="1611.429" data-end="1613.559">spot to teams in this situation and I</span> <span data-start="1613.559" data-end="1615.179">would caution you to that like layering</span> <span data-start="1615.179" data-end="1617.28">is not the same thing as abstraction</span> <span data-start="1617.28" data-end="1619.08">you're not doing domain modeling if all</span> <span data-start="1619.08" data-end="1620.549">you're doing is adding more and more</span> <span data-start="1620.549" data-end="1623.25">layers of indirection so of course I</span> <span data-start="1623.25" data-end="1624.929">love small modules I love small things</span> <span data-start="1624.929" data-end="1626.94">make small things but make sure that</span> <span data-start="1626.94" data-end="1628.44">they're meaningful that they sell of a</span> <span data-start="1628.44" data-end="1629.94">distinct purpose the name means</span> <span data-start="1629.94" data-end="1631.77">something and that you're not just like</span> <span data-start="1631.77" data-end="1633.96">creating a bunch of files for no reason</span> <span data-start="1633.96" data-end="1635.7">so what I'd rather see is an application</span> <span data-start="1635.7" data-end="1637.47">that only has like one controller but</span> <span data-start="1637.47" data-end="1639.69">like it knows who to call at the right</span> <span data-start="1639.69" data-end="1641.46">time so you know maybe there is a</span> <span data-start="1641.46" data-end="1643.65">responsibility to create an order and</span> <span data-start="1643.65" data-end="1645.51">then I just use that it's like an escape</span> <span data-start="1645.51" data-end="1647.309">hatch like a main method for the create</span> <span data-start="1647.309" data-end="1649.5">order thing so that it can only focus on</span> <span data-start="1649.5" data-end="1651.09">what's special about creating orders and</span> <span data-start="1651.09" data-end="1652.47">doesn't get sucked into all this sort of</span> <span data-start="1652.47" data-end="1653.97">like carrying the water that is</span> <span data-start="1653.97" data-end="1655.409">necessary for every single feature if</span> <span data-start="1655.409" data-end="1656.549">you're just kind of copy and paste the</span> <span data-start="1656.549" data-end="1658.62">same stack over and over again so if</span> <span data-start="1658.62" data-end="1659.73">you're in this situation and you're</span> <span data-start="1659.73" data-end="1661.289">finding that like you're isolated unit</span> <span data-start="1661.289" data-end="1662.64">tests aren't providing you with like</span> <span data-start="1662.64" data-end="1665.309">useful design feedback they're not</span> <span data-start="1665.309" data-end="1667.5">providing you value don't do it anymore</span> <span data-start="1667.5" data-end="1669.63">in fact maybe question whether or not</span> <span data-start="1669.63" data-end="1671.46">like your architecture is too repetitive</span> <span data-start="1671.46" data-end="1673.049">and redundant and could be improved</span> <span data-start="1673.049" data-end="1675.24">the last questionable thing I see is</span> <span data-start="1675.24" data-end="1677.28">folks who rely too heavily on call</span> <span data-start="1677.28" data-end="1679.11">verification where you know a mocking</span> <span data-start="1679.11" data-end="1680.4">library lets you verify that a call</span> <span data-start="1680.4" data-end="1681.72">happened a lot of people will get really</span> <span data-start="1681.72" data-end="1683.549">excited about that and I'm a big</span> <span data-start="1683.549" data-end="1685.71">believer like in general terms that we</span> <span data-start="1685.71" data-end="1687.419">come to value whatever it is we measure</span> <span data-start="1687.419" data-end="1689.73">and an assertion is a measurement and so</span> <span data-start="1689.73" data-end="1691.83">our assertions tend to steer the design</span> <span data-start="1691.83" data-end="1694.049">of our systems so let's say that we run</span> <span data-start="1694.049" data-end="1694.77">a petting zoo</span> <span data-start="1694.77" data-end="1696.99">and you were given a copy of test double</span> </p>
<p><span data-start="1696.99" data-end="1698.19">J s and your birthday so you're really</span> <span data-start="1698.19" data-end="1700.95">excited to go mock things out and you</span> <span data-start="1700.95" data-end="1702.539">know you're what you're excited about is</span> <span data-start="1702.539" data-end="1703.71">like you love petting the pets but now</span> <span data-start="1703.71" data-end="1705.12">you can finally assert when that happens</span> <span data-start="1705.12" data-end="1706.83">so you know you put the sheep one time</span> <span data-start="1706.83" data-end="1709.08">you pet the llama you can even say hey I</span> <span data-start="1709.08" data-end="1711.659">put the Sheep two times you don't pet</span> <span data-start="1711.659" data-end="1713.159">the crocodile you can ascertain that -</span> <span data-start="1713.159" data-end="1714.72">sorry crocodile</span> <span data-start="1714.72" data-end="1716.94">we could write a test for this right you</span> <span data-start="1716.94" data-end="1718.95">know like when we passed in this like</span> <span data-start="1718.95" data-end="1720.72">function a kid and the sheep it'll</span> <span data-start="1720.72" data-end="1722.7">return true as well as for the llama and</span> <span data-start="1722.7" data-end="1724.35">false for the crocodile we invoked that</span> <span data-start="1724.35" data-end="1725.7">subject with those three animals and</span> <span data-start="1725.7" data-end="1727.409">then we verify that the sheep and the</span> <span data-start="1727.409" data-end="1729.539">llama got pet but the crocodile didn't</span> <span data-start="1729.539" data-end="1731.49">and to implement something that passes</span> <span data-start="1731.49" data-end="1733.08">this test we import for those two things</span> <span data-start="1733.08" data-end="1735.149">and then we pass in the kid and the</span> <span data-start="1735.149" data-end="1736.86">animals for each of those animals</span> <span data-start="1736.86" data-end="1738.179">it likes the animal that pets the animal</span> <span data-start="1738.179" data-end="1739.92">now we got to a passing test great</span> <span data-start="1739.92" data-end="1742.08">there's one problem though which is like</span> <span data-start="1742.08" data-end="1743.97">kids have dirty hams and the pet</span> <span data-start="1743.97" data-end="1745.53">function doesn't say how dirty and we</span> <span data-start="1745.53" data-end="1746.91">gotta clean the animals in this petting</span> <span data-start="1746.91" data-end="1749.19">zoo and so you just have to guess and so</span> <span data-start="1749.19" data-end="1750.99">you set up a cron job to hose down the</span> <span data-start="1750.99" data-end="1753.54">llamas every night at 10:00 p.m. which</span> <span data-start="1753.54" data-end="1755.46">is a tremendous waste of water so we</span> <span data-start="1755.46" data-end="1758.429">want to do better what happened here is</span> <span data-start="1758.429" data-end="1760.049">actually an example of like where tools</span> <span data-start="1760.049" data-end="1762">can mislead us because tools are awesome</span> <span data-start="1762" data-end="1763.89">because they save us time by reducing</span> <span data-start="1763.89" data-end="1765.809">the necessary thoughts and actions we</span> <span data-start="1765.809" data-end="1767.58">need to take in order to get a job done</span> <span data-start="1767.58" data-end="1769.38">but if we're not careful sometimes our</span> <span data-start="1769.38" data-end="1771.179">tools can actually eliminate useful</span> <span data-start="1771.179" data-end="1773.549">thoughts and and that happened in this</span> <span data-start="1773.549" data-end="1775.95">case now just because you're able to</span> <span data-start="1775.95" data-end="1777.54">verify calls with your mocking library</span> <span data-start="1777.54" data-end="1780.09">you have to realize that it might</span> <span data-start="1780.09" data-end="1782.1">encourage you to write more impure</span> <span data-start="1782.1" data-end="1784.2">functions and impure functions those</span> <span data-start="1784.2" data-end="1785.429">that have side effects are harder to</span> <span data-start="1785.429" data-end="1787.5">maintain than pure functions those that</span> <span data-start="1787.5" data-end="1789.51">return values because nowhere when I was</span> <span data-start="1789.51" data-end="1790.86">writing this code I think to ask</span> <span data-start="1790.86" data-end="1792.48">hey what value should pet returned</span> <span data-start="1792.48" data-end="1793.89">because I had a convenient way to assert</span> <span data-start="1793.89" data-end="1796.02">that it was just called and if I had to</span> <span data-start="1796.02" data-end="1797.49">think about that I'd say well you know</span> <span data-start="1797.49" data-end="1799.41">the pet function should probably take an</span> <span data-start="1799.41" data-end="1801.419">animal and then return a dirtier version</span> <span data-start="1801.419" data-end="1803.309">of that animal I guess so let's pretend</span> <span data-start="1803.309" data-end="1805.86">we did that and here we're gonna stub</span> <span data-start="1805.86" data-end="1807.21">out that when we pet the sheep we get a</span> <span data-start="1807.21" data-end="1808.47">dirty sheep when you pet the llama we</span> <span data-start="1808.47" data-end="1810.48">get a dirty llama now we care about this</span> <span data-start="1810.48" data-end="1811.799">result and we're gonna assert that we</span> <span data-start="1811.799" data-end="1813.12">get a dirty sheep a dirty llama on a</span> <span data-start="1813.12" data-end="1814.53">clean crocodile so other parts of our</span> <span data-start="1814.53" data-end="1816.09">system know which animals to clean at</span> <span data-start="1816.09" data-end="1817.71">the end of the day we update the</span> <span data-start="1817.71" data-end="1818.88">implementation like this first we're</span> <span data-start="1818.88" data-end="1820.95">gonna take away this for each whenever</span> <span data-start="1820.95" data-end="1822.78">you see a for each anywhere any kind of</span> <span data-start="1822.78" data-end="1824.73">loop you know that like your application</span> <span data-start="1824.73" data-end="1826.44">is just screaming side effects because</span> <span data-start="1826.44" data-end="1827.79">it doesn't return anything so we're</span> <span data-start="1827.79" data-end="1829.049">going to change that to a map instead</span> <span data-start="1829.049" data-end="1831.24">and trade one array for another and</span> <span data-start="1831.24" data-end="1833.4">return the value of that pet call and</span> <span data-start="1833.4" data-end="1834.6">the parse of the kid doesn't like the</span> <span data-start="1834.6" data-end="1836.1">animal will just return the animal as it</span> <span data-start="1836.1" data-end="1839.28">was and this pad passes the test so now</span> <span data-start="1839.28" data-end="1840.87">we know to wash these first two and we</span> <span data-start="1840.87" data-end="1843.63">can spare the third there's just one</span> <span data-start="1843.63" data-end="1845.91">last thing here is if you actually run</span> <span data-start="1845.91" data-end="1847.65">this test you're you know really big</span> <span data-start="1847.65" data-end="1848.88">warning up at the top because I'm gonna</span> <span data-start="1848.88" data-end="1850.2">tell you that you stubbed and verified</span> <span data-start="1850.2" data-end="1852.21">exactly the same call and that that was</span> <span data-start="1852.21" data-end="1854.04">probably redundant and what does that</span> <span data-start="1854.04" data-end="1855.69">mean well if you look at this test we're</span> <span data-start="1855.69" data-end="1858.45">now like verifying explicitly every</span> <span data-start="1858.45" data-end="1860.01">single thing that happens but we no</span> <span data-start="1860.01" data-end="1861.21">longer need to be because we're like</span> <span data-start="1861.21" data-end="1863.25">also stubbing these things and asserting</span> <span data-start="1863.25" data-end="1863.9">on the values</span> <span data-start="1863.9" data-end="1865.67">come back and so it's almost provably</span> <span data-start="1865.67" data-end="1867.5">redundant now we can just remove that</span> <span data-start="1867.5" data-end="1869.87">stuff simplified the test and so in</span> <span data-start="1869.87" data-end="1871.13">general after years and years and years</span> <span data-start="1871.13" data-end="1872.66">of writing and using mocking libraries</span> </p>
<p><span data-start="1872.66" data-end="1874.4">I've come to view verification as just</span> <span data-start="1874.4" data-end="1876.35">the assertion of last resort only if it</span> <span data-start="1876.35" data-end="1877.88">really makes sense for the thing I'm</span> <span data-start="1877.88" data-end="1879.41">calling to not return a value or if I'm</span> <span data-start="1879.41" data-end="1880.61">it's out of my hands out of my control</span> <span data-start="1880.61" data-end="1883.16">do I actually write assertions using</span> <span data-start="1883.16" data-end="1884.9">verification the common thread between</span> <span data-start="1884.9" data-end="1886.91">all three of these things is we forget</span> <span data-start="1886.91" data-end="1888.14">that like mocking libraries were</span> <span data-start="1888.14" data-end="1890.12">invented to provide rich design feedback</span> <span data-start="1890.12" data-end="1892.01">to improve the design the simplicity of</span> <span data-start="1892.01" data-end="1894.05">our systems and if we ignore that then</span> <span data-start="1894.05" data-end="1895.64">we're just introducing yet more useless</span> <span data-start="1895.64" data-end="1898.1">pain all right so that was like a lot of</span> <span data-start="1898.1" data-end="1900.29">things to not do the one thing that I</span> <span data-start="1900.29" data-end="1902.48">really like and let's talk about that so</span> </p>
<p><span data-start="1902.48" data-end="1904.16">I was really inspired by this book</span> <span data-start="1904.16" data-end="1905.63">called growing object-oriented software</span> <span data-start="1905.63" data-end="1908.24">guided by tests by Steve Freeman and NAT</span> <span data-start="1908.24" data-end="1910.91">Price years ago and I've iterated on it</span> <span data-start="1910.91" data-end="1912.77">enough that Matt has kindly asked me to</span> <span data-start="1912.77" data-end="1915.14">call what I do something else so I call</span> <span data-start="1915.14" data-end="1916.43">a discovery testing we're gonna do a</span> <span data-start="1916.43" data-end="1918.5">quick demo so suppose that you write</span> <span data-start="1918.5" data-end="1920.66">conference talks but it takes too long</span> <span data-start="1920.66" data-end="1922.94">there's just too much emoji and fiddling</span> <span data-start="1922.94" data-end="1925.13">and stuff so you decide let's meet it</span> <span data-start="1925.13" data-end="1926.51">and so you take something that loads up</span> <span data-start="1926.51" data-end="1928.31">all your notes you run it through a</span> <span data-start="1928.31" data-end="1930.35">sentiment I'll sentiment analyzer to</span> <span data-start="1930.35" data-end="1932.09">find what emoji should match up and then</span> <span data-start="1932.09" data-end="1934.43">you generate a keynote file you know if</span> <span data-start="1934.43" data-end="1935.93">we start a test like this and we're</span> <span data-start="1935.93" data-end="1937.4">practicing discovery testing I always</span> <span data-start="1937.4" data-end="1938.75">start with the setup at the very top</span> <span data-start="1938.75" data-end="1941.24">layer and I ask myself what's the code</span> <span data-start="1941.24" data-end="1943.4">that I wish I had because I'm lazy and</span> </p>
<p><span data-start="1943.4" data-end="1945.23">I'm also relatively incompetent and like</span> <span data-start="1945.23" data-end="1947.42">when I'm looking at a blank code listing</span> <span data-start="1947.42" data-end="1949.04">I just panic and assume that I'm too</span> <span data-start="1949.04" data-end="1951.05">dumb to figure it out but if I could</span> <span data-start="1951.05" data-end="1952.52">just say hey I wish I had something that</span> <span data-start="1952.52" data-end="1954.23">loads notes and something that pairs</span> <span data-start="1954.23" data-end="1955.97">those notes up with emoji to create</span> <span data-start="1955.97" data-end="1957.38">slides and then finally something to</span> <span data-start="1957.38" data-end="1958.79">create the keynote file for me that I</span> <span data-start="1958.79" data-end="1960.77">can understand and then you know I load</span> <span data-start="1960.77" data-end="1962.12">up my subject and I can start thinking</span> <span data-start="1962.12" data-end="1964.07">about the test well of course the test</span> <span data-start="1964.07" data-end="1965.51">should be it creates the keynote from</span> <span data-start="1965.51" data-end="1967.97">the notes I run this test and it fails</span> <span data-start="1967.97" data-end="1969.65">because I'm talking about code that</span> <span data-start="1969.65" data-end="1971.57">doesn't exist so it says hey this module</span> <span data-start="1971.57" data-end="1973.25">isn't real so I just touch it and I run</span> <span data-start="1973.25" data-end="1975.32">it again and then this other one the</span> <span data-start="1975.32" data-end="1977">second pair emoji isn't real touch it</span> <span data-start="1977" data-end="1979.34">run again and then create file isn't</span> <span data-start="1979.34" data-end="1981.8">realized cetera et cetera and I got that</span> <span data-start="1981.8" data-end="1983.57">too passing and what I love about that</span> <span data-start="1983.57" data-end="1985.79">is that it gives me small incremental</span> <span data-start="1985.79" data-end="1987.44">forward progress throughout the day even</span> <span data-start="1987.44" data-end="1989.12">if all I accomplished just then was like</span> <span data-start="1989.12" data-end="1991.43">the plumbing of my application it feels</span> <span data-start="1991.43" data-end="1992.83">like paint by number and</span> <span data-start="1992.83" data-end="1996.34">you know programming is an area of just</span> <span data-start="1996.34" data-end="1998.679">professional life where we I really wish</span> <span data-start="1998.679" data-end="2001.049">that things could we'd get more feedback</span> <span data-start="2001.049" data-end="2003">through the day like hey good job bad</span> <span data-start="2003" data-end="2005.46">job and sometimes people go days weeks</span> <span data-start="2005.46" data-end="2007.169">months without any real feedback that</span> <span data-start="2007.169" data-end="2009.33">they're on the right path so so testing</span> <span data-start="2009.33" data-end="2011.58">this way provide like soothes my anxiety</span> <span data-start="2011.58" data-end="2013.86">and now you know I've broken this work</span> <span data-start="2013.86" data-end="2015.539">up to at least three responsibilities</span> <span data-start="2015.539" data-end="2018.09">here so I can start writing the actual</span> <span data-start="2018.09" data-end="2019.83">tests now I assume I'm gonna need</span> <span data-start="2019.83" data-end="2021.6">something to represent notes so I create</span> <span data-start="2021.6" data-end="2024.87">like an ode note domain module and when</span> </p>
<p><span data-start="2024.87" data-end="2026.76">I stub you know for given a search</span> <span data-start="2026.76" data-end="2028.2">string you know I should call back with</span> <span data-start="2028.2" data-end="2030.179">those notes I assume I'm gonna need like</span> <span data-start="2030.179" data-end="2032.429">a slide value as well and so when I call</span> <span data-start="2032.429" data-end="2034.409">this pair emoji thing with the notes it</span> <span data-start="2034.409" data-end="2035.399">just should return these slides</span> <span data-start="2035.399" data-end="2037.44">synchronously I call my subject with</span> <span data-start="2037.44" data-end="2038.85">that search string and the given path</span> <span data-start="2038.85" data-end="2040.83">that I want to ready to file — and then</span> </p>
<p><span data-start="2040.83" data-end="2042.36">I verify that create file was called</span> <span data-start="2042.36" data-end="2044.49">with those slides at that path run my</span> <span data-start="2044.49" data-end="2046.71">test again and here's the message I've</span> <span data-start="2046.71" data-end="2047.94">been working for it's all this time</span> <span data-start="2047.94" data-end="2050.639">right I expected this to be called with</span> <span data-start="2050.639" data-end="2052.679">these slides at that path I can make</span> <span data-start="2052.679" data-end="2054.45">this test pass by importing the three</span> <span data-start="2054.45" data-end="2056.609">you know still empty modules we're gonna</span> <span data-start="2056.609" data-end="2058.77">fake that out at run time passing the</span> <span data-start="2058.77" data-end="2061.2">the topic to load notes get the callback</span> <span data-start="2061.2" data-end="2064.08">callback create the slides and then</span> <span data-start="2064.08" data-end="2065.429">create the file with those slides in</span> <span data-start="2065.429" data-end="2067.349">that given path I run this test and now</span> <span data-start="2067.349" data-end="2070.44">it passes now you'd be right to ask like</span> <span data-start="2070.44" data-end="2072.659">that was a lot of words and minutes for</span> <span data-start="2072.659" data-end="2074.73">five lines of code like how is this</span> <span data-start="2074.73" data-end="2076.23">actually a productive use of your time</span> <span data-start="2076.23" data-end="2078.089">and the answer is I've actually done a</span> <span data-start="2078.089" data-end="2079.8">lot of work here just by thinking</span> <span data-start="2079.8" data-end="2082.109">through all these things I just like</span> <span data-start="2082.109" data-end="2083.58">agreed to like hey this is our public</span> </p>
<p><span data-start="2083.58" data-end="2085.889">API of these two strings I know that</span> <span data-start="2085.889" data-end="2087.51">when I pass a topic into load notes I</span> <span data-start="2087.51" data-end="2089.52">get notes back I know pair emoji trades</span> <span data-start="2089.52" data-end="2091.2">notes for slides and I know that we</span> <span data-start="2091.2" data-end="2093.24">passed slides and path to some other</span> <span data-start="2093.24" data-end="2095.58">responsibilities the subject at this</span> <span data-start="2095.58" data-end="2097.44">point the entry point is done I'm not</span> <span data-start="2097.44" data-end="2098.97">kidding when I say often never look at</span> <span data-start="2098.97" data-end="2100.68">that top level again I've successfully</span> <span data-start="2100.68" data-end="2103.08">broken it up into three problems the</span> <span data-start="2103.08" data-end="2104.52">work is broken down into three things</span> <span data-start="2104.52" data-end="2105.9">that we know the contract so you don't</span> <span data-start="2105.9" data-end="2107.04">have to worry about the fiddly bits</span> <span data-start="2107.04" data-end="2108.359">giving all tangled together at some</span> <span data-start="2108.359" data-end="2109.92">point they have different jobs that we</span> <span data-start="2109.92" data-end="2112.08">know in advance and we already proven</span> <span data-start="2112.08" data-end="2113.76">out the contract between those things so</span> <span data-start="2113.76" data-end="2115.109">we know what to call them with because</span> <span data-start="2115.109" data-end="2116.28">there's already something calling them</span> <span data-start="2116.28" data-end="2118.89">and that's great so additionally you</span> <span data-start="2118.89" data-end="2120.78">know we we sussed out a couple of value</span> <span data-start="2120.78" data-end="2122.49">types that we want to be passing through</span> <span data-start="2122.49" data-end="2124.65">these methods you know we have some</span> <span data-start="2124.65" data-end="2125.98">notes and</span> <span data-start="2125.98" data-end="2128.11">and the next step is like it's a tree</span> <span data-start="2128.11" data-end="2130.18">right it's just recursion so we ask like</span> <span data-start="2130.18" data-end="2131.89">okay so how do you what do we want load</span> <span data-start="2131.89" data-end="2133.27">notes to do well it's got to read from</span> <span data-start="2133.27" data-end="2135.85">some note file parse our outline and</span> <span data-start="2135.85" data-end="2137.14">then flatten those points so that we're</span> <span data-start="2137.14" data-end="2139.18">having a linear presentation and the</span> <span data-start="2139.18" data-end="2141.31">first is IO and the second and third are</span> <span data-start="2141.31" data-end="2142.78">just pure functions and the writing test</span> <span data-start="2142.78" data-end="2144.07">for pure functions like we talked about</span> <span data-start="2144.07" data-end="2145.51">it's really easy so we want to maximize</span> <span data-start="2145.51" data-end="2148.72">those the pear emoji thing maybe we</span> <span data-start="2148.72" data-end="2150.37">tokenize those notes and then we run</span> <span data-start="2150.37" data-end="2152.65">that off to a sentiment analyzer and</span> <span data-start="2152.65" data-end="2154.09">then we convert them to slides and the</span> <span data-start="2154.09" data-end="2155.56">first things are pure function the</span> <span data-start="2155.56" data-end="2156.76">second thing is a good probably gonna be</span> <span data-start="2156.76" data-end="2158.17">a wrapper because I don't want to figure</span> <span data-start="2158.17" data-end="2160.18">out how to do sentiment analysis oh not</span> <span data-start="2160.18" data-end="2163.06">another pure function this last bit you</span> <span data-start="2163.06" data-end="2164.44">know we want to build some kind of</span> <span data-start="2164.44" data-end="2166.36">layout from those slides like text goes</span> <span data-start="2166.36" data-end="2168.55">on top emoji down here or whatever then</span> <span data-start="2168.55" data-end="2169.99">we need to generate Apple script</span> <span data-start="2169.99" data-end="2171.94">commands so we can actually know like</span> <span data-start="2171.94" data-end="2173.35">have a big array of like everything we</span> <span data-start="2173.35" data-end="2175.33">need to automate with keynote and then</span> <span data-start="2175.33" data-end="2176.71">finally something who's responsible for</span> <span data-start="2176.71" data-end="2178.96">rifling through all of those commands</span> <span data-start="2178.96" data-end="2181">and and generating the file for us the</span> <span data-start="2181" data-end="2182.86">first and second again pure functions</span> <span data-start="2182.86" data-end="2184.51">real easy and the last one would just</span> <span data-start="2184.51" data-end="2186.55">like shell out to this thing called OS a</span> <span data-start="2186.55" data-end="2188.41">script that's gonna like open up Apple</span> <span data-start="2188.41" data-end="2189.58">script in automate keynote</span> <span data-start="2189.58" data-end="2191.77">what I love about this process is it</span> <span data-start="2191.77" data-end="2193.57">gives me reliable incremental progress</span> <span data-start="2193.57" data-end="2195.82">throughout my day what shakes out the</span> <span data-start="2195.82" data-end="2196.78">other end is a bunch of single</span> <span data-start="2196.78" data-end="2198.73">responsibility units with intention</span> <span data-start="2198.73" data-end="2201.28">revealing names the the organization of</span> <span data-start="2201.28" data-end="2202.24">all these small things is actually</span> <span data-start="2202.24" data-end="2204.13">discoverable like if I create a new</span> <span data-start="2204.13" data-end="2205.78">directory every time i recurse well if</span> <span data-start="2205.78" data-end="2206.98">you're reading my code you only have to</span> <span data-start="2206.98" data-end="2208.21">dive as deep as you seem to be</span> <span data-start="2208.21" data-end="2209.89">interested and to answer the question</span> <span data-start="2209.89" data-end="2211.93">you're looking for it separates out all</span> <span data-start="2211.93" data-end="2213.88">of the values from the logic by default</span> <span data-start="2213.88" data-end="2215.83">so it doesn't tangle those up and I</span> <span data-start="2215.83" data-end="2217.3">spend most of my time writing really</span> <span data-start="2217.3" data-end="2219.22">easy like synchronous pure functions</span> <span data-start="2219.22" data-end="2220.69">which are the easiest kind of code to</span> <span data-start="2220.69" data-end="2224.65">maintain that's all I got so I thank you</span> <span data-start="2224.65" data-end="2226.45">for being patient really grateful that</span> <span data-start="2226.45" data-end="2229.11">you showed up at a talk late in the day</span> <span data-start="2229.11" data-end="2231.85">you know like I mentioned testable we're</span> <span data-start="2231.85" data-end="2233.89">a consultancy if your team is looking</span> <span data-start="2233.89" data-end="2236.82">for you know experienced developers</span> <span data-start="2236.82" data-end="2238.78">maybe you're only thinking about hiring</span> <span data-start="2238.78" data-end="2240.58">but you might be open to talking to us</span> <span data-start="2240.58" data-end="2241.99">instead about how we might be able to</span> <span data-start="2241.99" data-end="2243.43">help out and integrate with your team</span> </p>
<p><span data-start="2243.43" data-end="2244.99">I'd love to meet you check out our</span> <span data-start="2244.99" data-end="2247.06">website we're also hiring so if you'd</span> <span data-start="2247.06" data-end="2248.8">like to work remotely you kind of share</span> <span data-start="2248.8" data-end="2250.12">our passion for improving how the world</span> <span data-start="2250.12" data-end="2251.77">write software and you want to share</span> <span data-start="2251.77" data-end="2253.36">your experience with others check out</span> <span data-start="2253.36" data-end="2255.85">our join page video of this talk I've</span> <span data-start="2255.85" data-end="2257.41">got a previous one from a cert J s in</span> <span data-start="2257.41" data-end="2259.02">February I've already I buffered</span> <span data-start="2259.02" data-end="2260.849">so it's gonna be tweeting the video link</span> <span data-start="2260.849" data-end="2262.73">momentarily to my Twitter accounts URLs</span> <span data-start="2262.73" data-end="2264.869">would also love to see your feedback</span> <span data-start="2264.869" data-end="2267.72">through our website forum also I've got</span> <span data-start="2267.72" data-end="2270">brand new testable stickers are a new</span> <span data-start="2270" data-end="2272.369">alternate logo I'm gonna be here all</span> <span data-start="2272.369" data-end="2273.96">week and if you ask for a sticker I'd be</span> <span data-start="2273.96" data-end="2276.45">happy to give you one there's just one</span> <span data-start="2276.45" data-end="2277.619">last thing I want to share before we go</span> <span data-start="2277.619" data-end="2281.04">which is my wonderful wife Becky down in</span> <span data-start="2281.04" data-end="2282.599">front she put in a lot of work this</span> <span data-start="2282.599" data-end="2284.79">morning I took a lift out to the store</span> <span data-start="2284.79" data-end="2288.06">and she she just for your all's benefit</span> </p>
<p><span data-start="2288.06" data-end="2290.55">I'm not the generous type but she is but</span> <span data-start="2290.55" data-end="2291.9">I am like the head of marketing for</span> <span data-start="2291.9" data-end="2295.109">testable so I saw an opportunity and she</span> <span data-start="2295.109" data-end="2298.17">purchased like every last bug spray at</span> <span data-start="2298.17" data-end="2306">the target nearby so Thank You Becky</span> <span data-start="2306" data-end="2310.56">and then I affixed branded stickers on</span> <span data-start="2310.56" data-end="2312.42">to each of them so here's the deal</span> <span data-start="2312.42" data-end="2313.619">because there's not enough of these for</span> <span data-start="2313.619" data-end="2316.56">everybody if you come and meet us at</span> <span data-start="2316.56" data-end="2318.119">dinner and you talk a little bit and you</span> <span data-start="2318.119" data-end="2319.77">say just enough to demonstrate that you</span> <span data-start="2319.77" data-end="2321.72">actually showed up to a 5:45 p.m. talk</span> <span data-start="2321.72" data-end="2323.7">we will happily give you a bug spray</span> <span data-start="2323.7" data-end="2325.619">until we run out of them that's our</span> <span data-start="2325.619" data-end="2327.599">little gift to you thank you for your</span> <span data-start="2327.599" data-end="2329.04">patience I had a really good time</span> <span data-start="2329.04" data-end="2330.78">speaking here today</span> <span data-start="2330.78" data-end="2335.44">[Music]</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
