<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>n34S_uFtGnw</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/n34S_uFtGnw?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="9.78" data-end="14.049">okay hi yep I said I'm Tim ruffles I'm</span> <span data-start="14.049" data-end="15.609">currently working on a product called</span> <span data-start="15.609" data-end="17.619">psychic Jess which is a code quality</span> <span data-start="17.619" data-end="20.5">tool for JavaScript and today I'm going</span> <span data-start="20.5" data-end="23.169">to be talking about handling lots and</span> <span data-start="23.169" data-end="25.3">lots of asynchronous code big</span> <span data-start="25.3" data-end="27.309">asynchronous processes involving lots</span> <span data-start="27.309" data-end="29.379">and lots of inputs going lots of</span> <span data-start="29.379" data-end="36.93">different directions AKA callback hell</span> <span data-start="36.93" data-end="38.89">but i think we've got cool backhaul</span> <span data-start="38.89" data-end="40.629">wrong i think all the kind of typical</span> <span data-start="40.629" data-end="42.19">blog posts you see where people start</span> <span data-start="42.19" data-end="44.17">going on about callbacks being</span> </p>
<p><span data-start="44.17" data-end="46.93">JavaScript's go to and how you can try</span> <span data-start="46.93" data-end="48.52">anything complicated in javascript as</span> <span data-start="48.52" data-end="50.11">soon as you start using callbacks it all</span> <span data-start="50.11" data-end="52.06">turns into a big spaghetti code mess I</span> <span data-start="52.06" data-end="54.489">think they kind of missed the point so</span> <span data-start="54.489" data-end="55.93">in this I'm going to be talking about</span> <span data-start="55.93" data-end="58.57">how you can handle most callback stuff</span> <span data-start="58.57" data-end="60.309">with just the tools you already know a</span> <span data-start="60.309" data-end="62.23">JavaScript and then we can be looking at</span> <span data-start="62.23" data-end="63.76">what I think is the real cool back help</span> <span data-start="63.76" data-end="65.71">the real challenge is of asynchronous</span> <span data-start="65.71" data-end="68.079">code and looking at some new stuff some</span> <span data-start="68.079" data-end="69.909">libraries but also some new things in</span> <span data-start="69.909" data-end="72.13">JavaScript that will help you make a</span> <span data-start="72.13" data-end="76.119">simple game so pyramids pyramids of doom</span> <span data-start="76.119" data-end="78.85">do exist I've been looking at a lot of</span> <span data-start="78.85" data-end="80.59">code for sidekick it's kind of research</span> <span data-start="80.59" data-end="82.209">for what people are doing in terms of</span> <span data-start="82.209" data-end="85.09">their code and it's out there like if</span> <span data-start="85.09" data-end="87.6">you look on github some node code has</span> <span data-start="87.6" data-end="91.06">inline callbacks five levels deep you</span> <span data-start="91.06" data-end="92.409">know that there's no way you can reason</span> <span data-start="92.409" data-end="94.149">about this stuff it's just a nightmare</span> <span data-start="94.149" data-end="95.799">there's no way you could test this in a</span> <span data-start="95.799" data-end="99.52">million years there's really no need for</span> <span data-start="99.52" data-end="102.34">this kind of call back he'll like for</span> <span data-start="102.34" data-end="104.259">most of the code that I see it for</span> <span data-start="104.259" data-end="106.029">there's no need for it in the simple</span> <span data-start="106.029" data-end="108.039">cases like something like this so this</span> <span data-start="108.039" data-end="110.799">is a just some simple Express jazz</span> <span data-start="110.799" data-end="113.289">handler we're getting a user we're going</span> <span data-start="113.289" data-end="114.819">to update their profile we want to check</span> <span data-start="114.819" data-end="116.169">out you know did have a profile already</span> <span data-start="116.169" data-end="119.02">or are we creating a new one so just all</span> <span data-start="119.02" data-end="120.549">very simple stuff if we're writing the</span> <span data-start="120.549" data-end="123.069">synchronously it will be super simple if</span> <span data-start="123.069" data-end="125.049">you start just starting out node and you</span> <span data-start="125.049" data-end="126.039">don't you don't know any other way you</span> <span data-start="126.039" data-end="127.689">might end up with something like this so</span> <span data-start="127.689" data-end="129.31">we're handling errors all over the place</span> <span data-start="129.31" data-end="131.47">we've got quite a kind of deep stack of</span> <span data-start="131.47" data-end="135.7">nested callbacks we don't wanna do this</span> <span data-start="135.7" data-end="139.15">for two reasons first off it's</span> <span data-start="139.15" data-end="140.71">completely untested and I personally</span> <span data-start="140.71" data-end="141.94">find that</span> <span data-start="141.94" data-end="143.92">test codes without test is just not code</span> </p>
<p><span data-start="143.92" data-end="145.9">I don't really count thats code that's</span> <span data-start="145.9" data-end="147.61">kind of a hack that's like an experiment</span> <span data-start="147.61" data-end="149.83">without code I just don't trust it and I</span> <span data-start="149.83" data-end="151.36">wouldn't really trust someone else's</span> <span data-start="151.36" data-end="153.22">code I certainly don't trust my own code</span> <span data-start="153.22" data-end="155.71">if it doesn't have tests so how do we</span> <span data-start="155.71" data-end="158.08">test this code will there be no way we'd</span> <span data-start="158.08" data-end="160.33">have to dig right in so if you have a</span> <span data-start="160.33" data-end="161.62">look at the two points I've got these</span> <span data-start="161.62" data-end="163.24">comments saying we can't test this stuff</span> <span data-start="163.24" data-end="165.04">there's no way of getting in there it's</span> <span data-start="165.04" data-end="166.93">inside a closure we'd have to test the</span> <span data-start="166.93" data-end="168.64">whole lot in one go so all of those</span> <span data-start="168.64" data-end="170.92">callbacks or nothing so we're either</span> <span data-start="170.92" data-end="172.72">have to stub out every little bit of our</span> <span data-start="172.72" data-end="175.03">code there or we're just kind of give up</span> <span data-start="175.03" data-end="177.25">and not test it it's not cool just don't</span> <span data-start="177.25" data-end="179.2">it's not it's not doable so we can't do</span> <span data-start="179.2" data-end="180.73">this so we just can't do this kind of</span> <span data-start="180.73" data-end="182.5">stuff we have to name all are callbacks</span> <span data-start="182.5" data-end="184.87">and reveal them so we either reveal them</span> <span data-start="184.87" data-end="187.84">individually and the kind of no objects</span> <span data-start="187.84" data-end="189.46">just have loads of blobs of functions</span> <span data-start="189.46" data-end="190.99">just have a name so we can actually get</span> <span data-start="190.99" data-end="192.7">at them with our tests or we stick them</span> <span data-start="192.7" data-end="194.41">in objects and then we can get animo</span> <span data-start="194.41" data-end="195.97">test again so everything has to have a</span> <span data-start="195.97" data-end="197.2">name all your callback should have a</span> <span data-start="197.2" data-end="198.61">name you should be able to get at them</span> <span data-start="198.61" data-end="200.05">and test them individually and that</span> <span data-start="200.05" data-end="202.03">let's split up the input-output stuff</span> <span data-start="202.03" data-end="203.65">which is the complicated stuff the</span> <span data-start="203.65" data-end="206.2">asynchronous bit with the simple code we</span> <span data-start="206.2" data-end="208.09">have inside our handlers which say if I</span> <span data-start="208.09" data-end="209.95">have an error and a user what happens if</span> </p>
<p><span data-start="209.95" data-end="212.32">I have a no error and a user something</span> <span data-start="212.32" data-end="213.58">good happens all that kind of stuff it</span> <span data-start="213.58" data-end="215.08">suddenly becomes easy again as soon as</span> <span data-start="215.08" data-end="219.1">we do that reason be javascript already</span> <span data-start="219.1" data-end="220.9">has tools to avoid most of the simple</span> <span data-start="220.9" data-end="224.92">case kind of causes of complexity so the</span> <span data-start="224.92" data-end="226.9">named functions obviously but secondly</span> <span data-start="226.9" data-end="229.27">the function up bind so how many of</span> <span data-start="229.27" data-end="232.75">these are used function bind cool okay</span> <span data-start="232.75" data-end="234.37">so most of you well function up bind is</span> <span data-start="234.37" data-end="236.26">a really really nice little tool that</span> <span data-start="236.26" data-end="238.87">lets you get a new version of a function</span> <span data-start="238.87" data-end="241.18">that's kind of partially filled in so</span> <span data-start="241.18" data-end="243.209">let's say we if we have a look at the</span> <span data-start="243.209" data-end="246.989">save profile method here it has three</span> <span data-start="246.989" data-end="249.7">bits of context we're kind of going</span> <span data-start="249.7" data-end="251.08">halfway through a process so it already</span> <span data-start="251.08" data-end="253.72">has the user we've already got the user</span> <span data-start="253.72" data-end="255.34">and we're going to the next one of the</span> <span data-start="255.34" data-end="256.51">process we either get an error or a</span> <span data-start="256.51" data-end="258.669">profile so if we were doing this all in</span> <span data-start="258.669" data-end="260.35">line we'd obviously just reference the</span> <span data-start="260.35" data-end="262.06">variables in the closure but as I said</span> <span data-start="262.06" data-end="264.73">can't do that we can't test it how can</span> <span data-start="264.73" data-end="266.77">we get around that with bind well we can</span> <span data-start="266.77" data-end="269.05">use bind we pass it this which is the</span> <span data-start="269.05" data-end="271.87">context of this inside the new bound</span> <span data-start="271.87" data-end="273.789">function and we pass at some of the</span> <span data-start="273.789" data-end="275.79">variables which kind of fill it in and</span> <span data-start="275.79" data-end="277.02">get back what's called a partial</span> <span data-start="277.02" data-end="279.09">function which is exactly that it's like</span> <span data-start="279.09" data-end="280.53">a new version of the function where one</span> <span data-start="280.53" data-end="282.26">of the arguments has already been set</span> <span data-start="282.26" data-end="284.99">that's what you get so we've avoided</span> <span data-start="284.99" data-end="287.13">using closures and therefore the</span> <span data-start="287.13" data-end="288.54">untested bility just with pure</span> </p>
<p><span data-start="288.54" data-end="291.81">JavaScript so buying kind of fills in</span> <span data-start="291.81" data-end="293.19">the stuff we get this partially bound</span> <span data-start="293.19" data-end="295.89">function and we can apply it easily it's</span> <span data-start="295.89" data-end="299.7">nice and simple it's not ideal if we</span> <span data-start="299.7" data-end="300.9">have a look we've got our two kind of</span> <span data-start="300.9" data-end="302.25">solutions to this we got naming so we</span> <span data-start="302.25" data-end="303.93">can test we got bind so we don't have to</span> <span data-start="303.93" data-end="305.61">use closures we obviously have to</span> <span data-start="305.61" data-end="307.41">percolate this context down in our</span> <span data-start="307.41" data-end="309.45">functions it's a little bit fragile if</span> <span data-start="309.45" data-end="311.43">we need to change the context we're all</span> <span data-start="311.43" data-end="315.24">doing it by hand so it's okay but we you</span> <span data-start="315.24" data-end="316.92">know we've won hyung we we finished cool</span> <span data-start="316.92" data-end="322.11">back hell not exactly these simple cases</span> <span data-start="322.11" data-end="323.43">that people in blog posts say are</span> <span data-start="323.43" data-end="325.14">completely insoluble definitely have</span> <span data-start="325.14" data-end="328.07">solutions but they're still pay points</span> <span data-start="328.07" data-end="330.24">so what happens when we have lots and</span> <span data-start="330.24" data-end="332.07">lots of asynchronous stuff let's say we</span> <span data-start="332.07" data-end="334.11">have a list of files we need to apply</span> <span data-start="334.11" data-end="335.43">some transform to all of them</span> <span data-start="335.43" data-end="338.03">asynchronously or in this case we have</span> <span data-start="338.03" data-end="340.35">two processes we want to run in parallel</span> <span data-start="340.35" data-end="343.71">will bind can't help us their naming is</span> <span data-start="343.71" data-end="345.03">not going to help us there we need to</span> <span data-start="345.03" data-end="346.53">have some kind of way of saying when</span> <span data-start="346.53" data-end="348.59">both of these things are done progress</span> <span data-start="348.59" data-end="352.11">okay javascript doesn't give us any</span> <span data-start="352.11" data-end="354.39">tools natively to do that we can have to</span> <span data-start="354.39" data-end="355.68">start writing them ourselves we can have</span> <span data-start="355.68" data-end="357.15">to start implementing this flow control</span> <span data-start="357.15" data-end="359.31">our self which is not ideal because</span> <span data-start="359.31" data-end="361.32">every single time we do something we're</span> <span data-start="361.32" data-end="362.28">going to have to write some of this kind</span> <span data-start="362.28" data-end="366.6">of eight ad-hoc code same those sets so</span> <span data-start="366.6" data-end="368.67">innumerable zor collections of things so</span> <span data-start="368.67" data-end="370.68">for all the users do this asynchronous</span> <span data-start="370.68" data-end="372.33">process for all the files do this</span> <span data-start="372.33" data-end="374.13">asynchronous process again you can see</span> <span data-start="374.13" data-end="376.23">this is all very ad hoc code you know</span> </p>
<p><span data-start="376.23" data-end="378.27">I've just got this like done counting</span> <span data-start="378.27" data-end="380.04">how many of them we finish so far and</span> <span data-start="380.04" data-end="381.96">then finally it does the callback with</span> <span data-start="381.96" data-end="384.33">the array of the outputs of this</span> <span data-start="384.33" data-end="386.82">asynchronous process so it's a bit of a</span> <span data-start="386.82" data-end="388.92">pain point we're writing code again and</span> <span data-start="388.92" data-end="390.63">again and again to get round some kind</span> <span data-start="390.63" data-end="392.1">of problem there's something wrong with</span> <span data-start="392.1" data-end="394.44">our code that makes us continuous you</span> <span data-start="394.44" data-end="395.85">have to write this ad hoc code to solve</span> <span data-start="395.85" data-end="399.39">it well maybe you could just get someone</span> <span data-start="399.39" data-end="401.55">else to write the code for us you know</span> <span data-start="401.55" data-end="402.99">we can see these kind of patterns coming</span> <span data-start="402.99" data-end="404.669">up again and again someone else must</span> <span data-start="404.669" data-end="406.29">have had this problem and indeed they</span> <span data-start="406.29" data-end="407.46">have and they came up with something</span> <span data-start="407.46" data-end="408.96">called async Jess</span> <span data-start="408.96" data-end="412.08">whoo so aging jess is a nice library for</span> <span data-start="412.08" data-end="414.18">note all the concepts in it could easily</span> <span data-start="414.18" data-end="416.1">be applied to any kind of cool back</span> <span data-start="416.1" data-end="417.99">scheme so when I say note i mean the</span> <span data-start="417.99" data-end="420.84">node callback scheme in that you have an</span> <span data-start="420.84" data-end="423.3">error parameter and then result</span> <span data-start="423.3" data-end="425.37">parameter in your callbacks you could</span> <span data-start="425.37" data-end="426.78">change it for other ones and basically</span> <span data-start="426.78" data-end="428.28">it's all the code yet otherwise have to</span> <span data-start="428.28" data-end="430.83">write if you wanted to solve these kind</span> <span data-start="430.83" data-end="432.509">of problems so it replaces your ad hoc</span> <span data-start="432.509" data-end="434.31">code it's a library of code doesn't do</span> <span data-start="434.31" data-end="435.569">anything special doesn't require any</span> <span data-start="435.569" data-end="438.599">crazy language extensions and it handles</span> <span data-start="438.599" data-end="440.13">all the kind of passenger you might see</span> <span data-start="440.13" data-end="442.229">so a chain of processes where each</span> <span data-start="442.229" data-end="444.3">functions output goes into the next one</span> <span data-start="444.3" data-end="446.28">exactly the same as composed with</span> <span data-start="446.28" data-end="448.949">synchronous code it has a kind of a duel</span> <span data-start="448.949" data-end="451.56">in asynchronous code so we're water</span> <span data-start="451.56" data-end="455.039">falling down the coat or we might be</span> <span data-start="455.039" data-end="457.199">talking about parallel as I saying so</span> <span data-start="457.199" data-end="458.88">when all of these callbacks are fired</span> <span data-start="458.88" data-end="460.77">give me this callback and have all the</span> <span data-start="460.77" data-end="462.57">results in it we might be talking about</span> <span data-start="462.57" data-end="465.69">enumerations so mapping over file is all</span> <span data-start="465.69" data-end="469.8">that kind of stuff as I said it relies</span> <span data-start="469.8" data-end="471.69">on this interface this error result</span> <span data-start="471.69" data-end="473.729">interface it could rely on another one</span> <span data-start="473.729" data-end="475.86">if you wanted to rewrite it the kind of</span> <span data-start="475.86" data-end="477.84">concept is going on is that we can</span> <span data-start="477.84" data-end="481.59">replace the manual ad hoc code by using</span> <span data-start="481.59" data-end="482.97">an interface and just running a whole</span> <span data-start="482.97" data-end="484.56">library around it so it's not going to</span> <span data-start="484.56" data-end="485.82">do any good for you for like browser</span> <span data-start="485.82" data-end="487.74">stuff unless you do some adapting work</span> <span data-start="487.74" data-end="490.44">now the problem for me with async Jas is</span> <span data-start="490.44" data-end="493.38">it is still an ad hoc solution it's just</span> <span data-start="493.38" data-end="494.909">someone else has written a bunch of code</span> <span data-start="494.909" data-end="496.349">using the ad hoc solution it's still a</span> <span data-start="496.349" data-end="498.719">leaky abstraction what do I mean by that</span> <span data-start="498.719" data-end="500.729">is if it hasn't had it doesn't have a</span> <span data-start="500.729" data-end="503.669">helper for your precise situation you're</span> <span data-start="503.669" data-end="505.05">still going to have to write the ad hoc</span> <span data-start="505.05" data-end="507.74">code so in that simple example we had a</span> <span data-start="507.74" data-end="510.93">fetcher user fetch that users profile</span> <span data-start="510.93" data-end="512.669">and then using both for those bits of</span> <span data-start="512.669" data-end="515.579">information do something else so the</span> <span data-start="515.579" data-end="517.05">fetch the user and then fetch that guy's</span> <span data-start="517.05" data-end="519.719">profile is a is a waterfall it's a chain</span> <span data-start="519.719" data-end="521.82">but then taking both those bits of</span> <span data-start="521.82" data-end="523.979">information is a parallel thing we need</span> <span data-start="523.979" data-end="527.79">both those and if you look at the the</span> <span data-start="527.79" data-end="529.11">signatures for those functions</span> <span data-start="529.11" data-end="530.55">unfortunately can't do them both at once</span> <span data-start="530.55" data-end="532.589">there's no helper that does both at once</span> <span data-start="532.589" data-end="534.24">in a sink so we're gonna have to go back</span> <span data-start="534.24" data-end="536.37">to some kind of you know ad hoc co to</span> <span data-start="536.37" data-end="539.19">solve that problem out and this is to me</span> <span data-start="539.19" data-end="541.079">this is a classic example of a leaking</span> <span data-start="541.079" data-end="542.94">abstraction we still haven't solved the</span> <span data-start="542.94" data-end="544.71">it's root we're still having to write</span> <span data-start="544.71" data-end="545.85">more and more and more and more and more</span> <span data-start="545.85" data-end="548.4">code and a sings quite a big library is</span> <span data-start="548.4" data-end="549.9">not just one simple concept it's</span> <span data-start="549.9" data-end="552.42">basically a bunch of hairy code covering</span> <span data-start="552.42" data-end="555.51">all the different edge cases what is the</span> <span data-start="555.51" data-end="556.83">root problem i'm talking about what what</span> <span data-start="556.83" data-end="559.2">is causing all this hairy code well i</span> <span data-start="559.2" data-end="561.39">think it's the fact we don't have values</span> <span data-start="561.39" data-end="564.54">when we use callbacks so when you call a</span> <span data-start="564.54" data-end="565.74">normal synchronous function you get</span> <span data-start="565.74" data-end="567.36">something back night regardless how long</span> <span data-start="567.36" data-end="569.31">it takes could take 10 minutes it could</span> <span data-start="569.31" data-end="570.51">be blocking for 10 minutes but you still</span> <span data-start="570.51" data-end="572.16">get something back before the next line</span> <span data-start="572.16" data-end="574.47">of code executes and that means we can</span> <span data-start="574.47" data-end="576.39">do things with that value we can you</span> <span data-start="576.39" data-end="578.25">know use if statements we can follow</span> <span data-start="578.25" data-end="580.23">pover it all that kind of stuff but we</span> <span data-start="580.23" data-end="582.48">can't do anything in our programs with a</span> <span data-start="582.48" data-end="584.22">value that doesn't exist yet and that's</span> <span data-start="584.22" data-end="585.72">a problem with callbacks it replaces</span> <span data-start="585.72" data-end="588.42">values with flow control as in we jump</span> <span data-start="588.42" data-end="590.79">around the program we don't have a value</span> <span data-start="590.79" data-end="593.13">that we can kind of use in our programs</span> <span data-start="593.13" data-end="595.86">it just doesn't exist yet everything's</span> <span data-start="595.86" data-end="597.21">kind of easier value so this is a</span> <span data-start="597.21" data-end="599.16">synchronous version of our process you</span> <span data-start="599.16" data-end="600.84">can see it's just kind of you know</span> <span data-start="600.84" data-end="603.03">programming 101 stuff it's really really</span> <span data-start="603.03" data-end="605.01">really simple and that is our process</span> <span data-start="605.01" data-end="607.56">like the asynchronous honest of it is</span> <span data-start="607.56" data-end="609.9">not inherent if you say I mean it's just</span> <span data-start="609.9" data-end="611.79">an implementation detail it could be</span> <span data-start="611.79" data-end="613.5">this simple if our language was good</span> <span data-start="613.5" data-end="618.06">enough can we get values with async is</span> <span data-start="618.06" data-end="622.14">that possible what is there's an</span> <span data-start="622.14" data-end="625.64">abstraction called promises or futures</span> <span data-start="625.64" data-end="628.44">which has been around for a while and</span> <span data-start="628.44" data-end="630.45">the basic concept is rather than a</span> <span data-start="630.45" data-end="632.13">callback that kind of flies over your</span> <span data-start="632.13" data-end="633.24">head and you kind of don't know whether</span> <span data-start="633.24" data-end="636.45">the value is it gives you an IOU and</span> <span data-start="636.45" data-end="638.49">that's a value get back straight away so</span> <span data-start="638.49" data-end="639.99">rather than as I say taking a call back</span> <span data-start="639.99" data-end="641.55">in kind of jumping summer with the value</span> <span data-start="641.55" data-end="643.23">in a future point it gives you an IE</span> <span data-start="643.23" data-end="645.63">piece of paper saying I owe you one user</span> <span data-start="645.63" data-end="647.87">and then you can do stuff on that value</span> <span data-start="647.87" data-end="650.25">so just like normal normal code you get</span> <span data-start="650.25" data-end="653.04">your value straight away and the basic</span> </p>
<p><span data-start="653.04" data-end="656.58">API is it's later fulfilled as in the</span> <span data-start="656.58" data-end="659.28">user has appeared or rejected as in I</span> <span data-start="659.28" data-end="660.36">couldn't find the user or there was some</span> <span data-start="660.36" data-end="663.81">error in the process exactly once and</span> <span data-start="663.81" data-end="665.07">the other idea is it doesn't matter when</span> <span data-start="665.07" data-end="667.14">that happens so if it happens</span> <span data-start="667.14" data-end="671.85">immediately oh and you attach your your</span> <span data-start="671.85" data-end="673.92">call back later or your call back your</span> <span data-start="673.92" data-end="675.99">request for the value of the promise it</span> <span data-start="675.99" data-end="676.39">doesn</span> <span data-start="676.39" data-end="678.22">difference so it takes time out of the</span> <span data-start="678.22" data-end="680.47">equation it's a lot more like linking up</span> <span data-start="680.47" data-end="682.27">cells in a spreadsheet when you're using</span> <span data-start="682.27" data-end="684.46">promises and then the second really</span> <span data-start="684.46" data-end="687.13">important idea is that if you apply a</span> <span data-start="687.13" data-end="690.82">function to a promise you get a new</span> <span data-start="690.82" data-end="692.98">promise back which is a promise for the</span> <span data-start="692.98" data-end="696.37">transformed value inside that promise so</span> <span data-start="696.37" data-end="698.62">they chain so we have a look over here</span> <span data-start="698.62" data-end="700.18">we've got a promise for a coming back</span> <span data-start="700.18" data-end="702.76">from our get a function and then we use</span> <span data-start="702.76" data-end="705.28">the promise for a and we say then some</span> <span data-start="705.28" data-end="708.61">cool back and that will return a further</span> <span data-start="708.61" data-end="710.35">promise for value for B and we can see</span> <span data-start="710.35" data-end="713.53">the comparison with a standard callback</span> <span data-start="713.53" data-end="717.46">interface below so this is the bit where</span> <span data-start="717.46" data-end="718.99">it gets really useful so we got get a</span> <span data-start="718.99" data-end="721.81">then and we've got a function over a and</span> <span data-start="721.81" data-end="725.02">we're saying return get be so that whole</span> <span data-start="725.02" data-end="727.36">chain this changed just like jQuery or</span> <span data-start="727.36" data-end="729.34">lots of other libraries now returns a</span> <span data-start="729.34" data-end="731.95">promise for B and we can use that in</span> <span data-start="731.95" data-end="734.65">future bits and pieces the basic API is</span> <span data-start="734.65" data-end="736.75">just this then so you can see the direct</span> <span data-start="736.75" data-end="738.82">comparison we've got the promise for a</span> <span data-start="738.82" data-end="741.37">then call back an arrow back versus the</span> <span data-start="741.37" data-end="744.87">callback method where we have mm-hmm</span> <span data-start="744.87" data-end="752.2">thanks useful cool yeah so we and then</span> <span data-start="752.2" data-end="753.28">the call bad version we have the error</span> <span data-start="753.28" data-end="755.14">and then the the value so there's a very</span> <span data-start="755.14" data-end="757.75">kind of tight parallel between this two</span> </p>
<p><span data-start="757.75" data-end="760.39">AP is so it changed as I say that</span> <span data-start="760.39" data-end="762.16">promises the core idea one of the two</span> <span data-start="762.16" data-end="763.63">core ideas I think of promises is that</span> <span data-start="763.63" data-end="766.15">chains for reasons unknown Jay Curry's</span> <span data-start="766.15" data-end="768.94">API implementation doesn't chain so it's</span> <span data-start="768.94" data-end="770.53">not really a good implementation of</span> <span data-start="770.53" data-end="771.7">promises so I would avoid that like the</span> <span data-start="771.7" data-end="776.23">plague and yeah they just let make</span> <span data-start="776.23" data-end="778.06">things really simple again so if we have</span> <span data-start="778.06" data-end="779.59">a process here while we're trying to</span> <span data-start="779.59" data-end="782.59">threading through so this is from a</span> <span data-start="782.59" data-end="784.48">project I did called tweed are there was</span> <span data-start="784.48" data-end="786.52">like a machine learning Twitter client</span> <span data-start="786.52" data-end="789.19">and it needs to get a tweet and then it</span> <span data-start="789.19" data-end="790.87">needs to format the tweet and then it</span> <span data-start="790.87" data-end="792.31">needs to run a classifier on the tweak</span> <span data-start="792.31" data-end="793.9">and you can see that process kind of</span> <span data-start="793.9" data-end="795.64">gets flattened down we don't have any</span> <span data-start="795.64" data-end="797.44">real complexity there and the whole</span> <span data-start="797.44" data-end="799.78">process returns a promise for the final</span> <span data-start="799.78" data-end="802.03">value you seem so we got the Twitter</span> <span data-start="802.03" data-end="803.53">next week gives us promise for a tweet</span> <span data-start="803.53" data-end="805.57">then when we get the tweet we put it</span> <span data-start="805.57" data-end="807.28">through the formatter that's a promise</span> <span data-start="807.28" data-end="809.11">for a formatted tweet and then we get a</span> <span data-start="809.11" data-end="809.86">prom</span> <span data-start="809.86" data-end="813.339">for a classified tweet at the end and</span> <span data-start="813.339" data-end="814.66">because doesn't it there's no real</span> <span data-start="814.66" data-end="816.25">reason we can't have multiple consumers</span> <span data-start="816.25" data-end="817.959">for one promise it's easy to tag on</span> <span data-start="817.959" data-end="820.149">operations like logging whatever else</span> <span data-start="820.149" data-end="821.38">you need you can chuck it out and</span> <span data-start="821.38" data-end="825.37">everyone can get it so if we have a look</span> <span data-start="825.37" data-end="827.11">at the earlier thing where we're having</span> <span data-start="827.11" data-end="831.22">multiple dependencies because we don't</span> <span data-start="831.22" data-end="833.26">worry about time anymore we can just get</span> <span data-start="833.26" data-end="835.45">the first thing we can before we even</span> <span data-start="835.45" data-end="837.7">have it we can pass it into the process</span> <span data-start="837.7" data-end="839.86">that takes the first thing and then we</span> <span data-start="839.86" data-end="844.06">can use some method like all to pass</span> <span data-start="844.06" data-end="845.62">both of them onto a third process</span> <span data-start="845.62" data-end="847.39">without any nesting it's just super-easy</span> <span data-start="847.39" data-end="850.36">it's completely uncoupled to time we can</span> <span data-start="850.36" data-end="852.399">already start reasoning about stuff that</span> <span data-start="852.399" data-end="853.6">hasn't come back yet whereas with</span> <span data-start="853.6" data-end="854.8">callbacks would have to be doing all</span> <span data-start="854.8" data-end="857.5">this thudding via flow control a lot</span> <span data-start="857.5" data-end="861.07">more complicated and manual and</span> <span data-start="861.07" data-end="863.38">interestingly it works with a lot less</span> <span data-start="863.38" data-end="865.69">library code so if we just have promises</span> <span data-start="865.69" data-end="867.37">we don't do any other code at all we</span> <span data-start="867.37" data-end="869.98">just implement that to function API the</span> <span data-start="869.98" data-end="872.41">then thing we can starting really</span> <span data-start="872.41" data-end="875.199">interesting stuff because we can here we</span> <span data-start="875.199" data-end="877.449">have a map over three files we return a</span> <span data-start="877.449" data-end="879.31">promise for the contents of the file</span> <span data-start="879.31" data-end="881.92">each one and we map over the promises so</span> <span data-start="881.92" data-end="884.019">now have the final function here is a</span> <span data-start="884.019" data-end="886.54">pretty we get a variable contents that</span> <span data-start="886.54" data-end="888.16">contains a promise for the contents and</span> <span data-start="888.16" data-end="890.769">we can return a new promise which is a</span> <span data-start="890.769" data-end="892.269">promise for the transformation of that</span> <span data-start="892.269" data-end="894.13">content without any additional library</span> <span data-start="894.13" data-end="896.35">code because it's a value it works with</span> <span data-start="896.35" data-end="898.209">stuff like maps it works with every</span> <span data-start="898.209" data-end="899.74">other possible enumeration function you</span> <span data-start="899.74" data-end="901.93">could think of it's already there to</span> <span data-start="901.93" data-end="903.76">play with so we don't need to do</span> <span data-start="903.76" data-end="905.98">anything in particular we can make it</span> <span data-start="905.98" data-end="908.26">even better with with libraries but I</span> <span data-start="908.26" data-end="910.18">think it's a much happier abstraction</span> <span data-start="910.18" data-end="912.13">for that reason and you'll see</span> <span data-start="912.13" data-end="913.3">throughout the talk from this point on i</span> <span data-start="913.3" data-end="915.22">think promises solve that one problem</span> <span data-start="915.22" data-end="916.959">that you can never get away with if you</span> <span data-start="916.959" data-end="918.73">don't have a value which is you can't</span> <span data-start="918.73" data-end="920.41">talk about stuff until it appears with</span> <span data-start="920.41" data-end="922.829">callbacks where's your camera promises</span> <span data-start="922.829" data-end="925.54">so who only yet well we seem to be doing</span> <span data-start="925.54" data-end="927.88">pretty well but i'd say we still haven't</span> <span data-start="927.88" data-end="929.709">one we saw one core problem with</span> <span data-start="929.709" data-end="931.36">callbacks but i reckon there's another</span> <span data-start="931.36" data-end="934.93">one also to kind of pointers with</span> <span data-start="934.93" data-end="937.54">promises you need to ensure you catch</span> <span data-start="937.54" data-end="939.97">all the errors so when you do the then</span> <span data-start="939.97" data-end="941.829">promise doesn't have any idea of if</span> <span data-start="941.829" data-end="943.24">you're finished yet</span> <span data-start="943.24" data-end="944.649">and so we'll just soak up all the errors</span> <span data-start="944.649" data-end="946.54">in the rejection handler unless you say</span> <span data-start="946.54" data-end="949.75">done in most libraries to say like from</span> <span data-start="949.75" data-end="951.79">this point on just throw the error if if</span> <span data-start="951.79" data-end="953.83">it's if it's there and it's not being</span> <span data-start="953.83" data-end="956.8">handled so do you make sure you do that</span> <span data-start="956.8" data-end="960.91">and you still have to unwrap them so</span> </p>
<p><span data-start="960.91" data-end="962.74">JavaScript has all this great stuff like</span> <span data-start="962.74" data-end="964.99">tries and catches and for loops and</span> <span data-start="964.99" data-end="966.25">things that we just can't use with</span> <span data-start="966.25" data-end="967.6">asynchronous values whether their</span> <span data-start="967.6" data-end="970.63">promises or if their callbacks we can't</span> <span data-start="970.63" data-end="972.85">use them generically we have to unwrap</span> <span data-start="972.85" data-end="974.23">them from their process so they either</span> <span data-start="974.23" data-end="975.85">have to come into the callback and we</span> <span data-start="975.85" data-end="977.02">get them out of the callback but we have</span> <span data-start="977.02" data-end="979.06">to unwrap them from the promise and then</span> <span data-start="979.06" data-end="981.19">use them so we write a lot of additional</span> <span data-start="981.19" data-end="982.69">croft where are we effectively</span> <span data-start="982.69" data-end="985.029">unwrapping the async value from the</span> <span data-start="985.029" data-end="986.89">asynchronous process and then putting it</span> <span data-start="986.89" data-end="989.62">into our ifs or our fours or whatever if</span> <span data-start="989.62" data-end="990.85">you're really nice to be able to use</span> <span data-start="990.85" data-end="992.23">things like tries and catches and if</span> <span data-start="992.23" data-end="994.029">some else just straight on the results</span> <span data-start="994.029" data-end="995.74">of asynchronous values as if they were</span> <span data-start="995.74" data-end="997.63">synchronous that was what a library</span> <span data-start="997.63" data-end="999.64">asari a language that was designed for</span> <span data-start="999.64" data-end="1001.529">async would look like like why make it</span> <span data-start="1001.529" data-end="1004.07">more complicated than it already is and</span> </p>
<p><span data-start="1004.07" data-end="1006.42">I think this is the kind of irreducible</span> <span data-start="1006.42" data-end="1009.27">hell of callbacks is that we kind of</span> <span data-start="1009.27" data-end="1011.94">break JavaScript all the JavaScript we</span> <span data-start="1011.94" data-end="1013.5">know and love we can't use with this</span> <span data-start="1013.5" data-end="1015.72">stuff we have to unwrap and then we can</span> <span data-start="1015.72" data-end="1017.31">finally get to it we can't just use it</span> <span data-start="1017.31" data-end="1022.709">natively but but there's a pretty cool</span> <span data-start="1022.709" data-end="1026.97">concept called a wait this is some kind</span> <span data-start="1026.97" data-end="1029.189">of pseudocode imagine a language it</span> <span data-start="1029.189" data-end="1031.14">supports away languages that do support</span> <span data-start="1031.14" data-end="1033.329">away at things like C sharp so we have a</span> <span data-start="1033.329" data-end="1035.52">trying to catch and we we await the</span> <span data-start="1035.52" data-end="1036.959">result of an asynchronous callback a</span> <span data-start="1036.959" data-end="1038.819">couple of times here so we can say okay</span> <span data-start="1038.819" data-end="1042.51">if a equals await the capital a so we've</span> <span data-start="1042.51" data-end="1043.92">got some asynchronous stuff going on and</span> <span data-start="1043.92" data-end="1045.03">it's just going to stop at that point</span> <span data-start="1045.03" data-end="1046.8">nothing's going to happen and then it'll</span> <span data-start="1046.8" data-end="1048.449">come back so we're using asynchronous</span> <span data-start="1048.449" data-end="1049.95">code you know it's asynchronous</span> <span data-start="1049.95" data-end="1051.75">implementation we can run loads of a</span> <span data-start="1051.75" data-end="1053.58">sinker once we still have the the</span> <span data-start="1053.58" data-end="1055.5">performance of a sink but we get back a</span> <span data-start="1055.5" data-end="1057.54">synchronous looking code which is great</span> <span data-start="1057.54" data-end="1059.309">because a language is not as</span> <span data-start="1059.309" data-end="1061.5">implementation it doesn't matter if the</span> <span data-start="1061.5" data-end="1062.97">language look synchronous as long as the</span> <span data-start="1062.97" data-end="1064.59">async IO is still going on the</span> <span data-start="1064.59" data-end="1065.91">background so we can support lots and</span> <span data-start="1065.91" data-end="1067.35">lots of users and all that kind of good</span> <span data-start="1067.35" data-end="1070.71">stuff so could we possibly do this I</span> <span data-start="1070.71" data-end="1072.32">mean we can't really do it in in</span> </p>
<p><span data-start="1072.32" data-end="1075.09">JavaScript surely surely this is the end</span> <span data-start="1075.09" data-end="1076.65">of JavaScript do we have to you</span> <span data-start="1076.65" data-end="1078.03">some kind of new crazy language that</span> <span data-start="1078.03" data-end="1080.57">compiles to JavaScript or just give up</span> <span data-start="1080.57" data-end="1083.91">no javascript has a new trick up our</span> <span data-start="1083.91" data-end="1086.04">sleeve coming very soon we had a talk</span> <span data-start="1086.04" data-end="1089.97">about es5 today but now we have es6 we</span> <span data-start="1089.97" data-end="1093.33">will have seen hopefully so there's a</span> <span data-start="1093.33" data-end="1095.34">concept in es6 called generators and</span> <span data-start="1095.34" data-end="1097.8">this will let you do i'm sure a load of</span> <span data-start="1097.8" data-end="1098.94">really cool stuff that no one even</span> <span data-start="1098.94" data-end="1100.41">thought of yet but what are the really</span> <span data-start="1100.41" data-end="1102.66">exciting stuff it does is allows you to</span> <span data-start="1102.66" data-end="1105.03">write code that looks like synchronous</span> <span data-start="1105.03" data-end="1107.91">code so before we go any further I just</span> <span data-start="1107.91" data-end="1108.66">going to talk a little bit our</span> <span data-start="1108.66" data-end="1111.62">generators they're in the draft es6 back</span> <span data-start="1111.62" data-end="1113.88">that's supposedly going to be finalized</span> <span data-start="1113.88" data-end="1116.34">december this year the lesson was heard</span> <span data-start="1116.34" data-end="1119.88">an update from that it's in the draft so</span> <span data-start="1119.88" data-end="1122.55">it's kind of if the spec gets approved</span> <span data-start="1122.55" data-end="1124.92">it will be in there and it looks like</span> <span data-start="1124.92" data-end="1126.48">this so it has a little star operator</span> <span data-start="1126.48" data-end="1127.86">next to the function to say i'm a</span> <span data-start="1127.86" data-end="1129.99">generator function or a generator kind</span> <span data-start="1129.99" data-end="1132.48">of constructor and it has the yield</span> <span data-start="1132.48" data-end="1135.57">keyword now what yield does is at that</span> <span data-start="1135.57" data-end="1137.58">point it returns control back to the</span> <span data-start="1137.58" data-end="1139.89">calling whatever's calling the generator</span> <span data-start="1139.89" data-end="1141.81">so you can kind of think of its kind of</span> <span data-start="1141.81" data-end="1143.88">intermediate return and it pauses</span> <span data-start="1143.88" data-end="1146.31">execution inside that generator so we</span> <span data-start="1146.31" data-end="1147.96">won't go on to the next line of code</span> <span data-start="1147.96" data-end="1150.69">until the generator is resumed so we</span> <span data-start="1150.69" data-end="1152.79">literally pause at that point so if you</span> <span data-start="1152.79" data-end="1154.26">go have a look at this code here we have</span> <span data-start="1154.26" data-end="1156.15">a wild tree loop which is never a good</span> <span data-start="1156.15" data-end="1158.16">signing code you see a wild tree loop in</span> <span data-start="1158.16" data-end="1159.12">your code you're thinking are there's</span> <span data-start="1159.12" data-end="1160.98">this a bit of a nightmare but it works</span> <span data-start="1160.98" data-end="1162.84">fine with generators because we control</span> <span data-start="1162.84" data-end="1164.31">when it's resumed every time it hits</span> <span data-start="1164.31" data-end="1166.44">that yield inside the while loop it's</span> <span data-start="1166.44" data-end="1169.17">going to return control to the cooling</span> <span data-start="1169.17" data-end="1171.03">environment and it's not going to go</span> <span data-start="1171.03" data-end="1173.34">around the loop again until we hit next</span> <span data-start="1173.34" data-end="1175.23">so it's kind of like we can pause them</span> <span data-start="1175.23" data-end="1176.97">and play it again so lets you write</span> <span data-start="1176.97" data-end="1178.62">things like I don't know things that</span> <span data-start="1178.62" data-end="1180">generate long sequences of code</span> <span data-start="1180" data-end="1181.65">extremely of numbers or something</span> <span data-start="1181.65" data-end="1184.74">extremely nice and concisely and you can</span> <span data-start="1184.74" data-end="1187.74">see the API here we cool we as I said</span> <span data-start="1187.74" data-end="1188.79">it's a it's a kind of generator</span> <span data-start="1188.79" data-end="1190.8">constructor when we call it we get back</span> <span data-start="1190.8" data-end="1192.48">a generator we get an instance of the</span> <span data-start="1192.48" data-end="1194.82">generator so we call it first count now</span> <span data-start="1194.82" data-end="1196.65">we have our counter it's the generator</span> <span data-start="1196.65" data-end="1198.54">itself and then we call dot next on it</span> <span data-start="1198.54" data-end="1200.64">and then we get back a kind of to Polly</span> <span data-start="1200.64" data-end="1202.29">thing it so it's an object with two keys</span> <span data-start="1202.29" data-end="1204.51">value and result and then we can have a</span> <span data-start="1204.51" data-end="1207.75">look at the sorry value and done and we</span> <span data-start="1207.75" data-end="1209.22">gonna have a look at the valley see what</span> <span data-start="1209.22" data-end="1210.27">we got out and that will be the thing</span> <span data-start="1210.27" data-end="1210.659">that's been</span> <span data-start="1210.659" data-end="1213.09">yielded so it's kind of like the return</span> <span data-start="1213.09" data-end="1214.889">key word in that respect and we also</span> <span data-start="1214.889" data-end="1217.169">have a done and we can check if it's</span> <span data-start="1217.169" data-end="1218.399">done and basically if it's done it's</span> <span data-start="1218.399" data-end="1219.539">fallen off the bottom of the generator</span> <span data-start="1219.539" data-end="1222.479">just like normal cool so what does it</span> <span data-start="1222.479" data-end="1225.899">look like let's look so here is a thing</span> <span data-start="1225.899" data-end="1229.499">called three queries you can see it's</span> <span data-start="1229.499" data-end="1230.789">relying on some glue code that we're</span> <span data-start="1230.789" data-end="1232.2">going to have a look at in a bit called</span> <span data-start="1232.2" data-end="1234.72">away table and we've set up three</span> <span data-start="1234.72" data-end="1237.359">queries a B and C we set ourselves a</span> <span data-start="1237.359" data-end="1238.889">result array and then we're just using</span> <span data-start="1238.889" data-end="1241.619">the standard JavaScript I know not quite</span> <span data-start="1241.619" data-end="1243.149">the standard with this is just a</span> <span data-start="1243.149" data-end="1245.309">gratuitous es6 demonstration it's using</span> <span data-start="1245.309" data-end="1248.389">the four of not fought in so we can just</span> <span data-start="1248.389" data-end="1250.679">just go straight over an array without</span> <span data-start="1250.679" data-end="1252.599">any indices or anything very cool</span> <span data-start="1252.599" data-end="1254.519">feature of es6 so we're going over the</span> <span data-start="1254.519" data-end="1257.039">whole array of our promises and we're</span> <span data-start="1257.039" data-end="1258.809">just hitting yield and that's going to</span> <span data-start="1258.809" data-end="1260.369">block at that point we get out the</span> <span data-start="1260.369" data-end="1262.259">generator and then we'll come back when</span> <span data-start="1262.259" data-end="1264.57">the promises has been fulfilled so you</span> <span data-start="1264.57" data-end="1266.909">can see that this is parallel we've done</span> <span data-start="1266.909" data-end="1268.379">all the queries we started off all the</span> <span data-start="1268.379" data-end="1270.179">queries on the first three lines so</span> <span data-start="1270.179" data-end="1272.46">they're all going in parallel and then</span> <span data-start="1272.46" data-end="1273.679">we're going to block on them all until</span> <span data-start="1273.679" data-end="1275.999">they're all done and then we're gonna</span> <span data-start="1275.999" data-end="1277.95">return the rizal a array so it's very</span> <span data-start="1277.95" data-end="1280.139">concise and clear but it's also very</span> <span data-start="1280.139" data-end="1282.72">fast because it's parallel async good</span> <span data-start="1282.72" data-end="1286.049">combination cool now this is this is the</span> <span data-start="1286.049" data-end="1287.549">point I how to like oh can I actually</span> <span data-start="1287.549" data-end="1289.169">explain this how does this actually work</span> <span data-start="1289.169" data-end="1292.2">well I'm gonna proviso this is a black</span> <span data-start="1292.2" data-end="1294.479">box the way you do the the generator</span> <span data-start="1294.479" data-end="1297.2">implementation you can kind of ignore it</span> <span data-start="1297.2" data-end="1299.07">we can understand it it's not very</span> <span data-start="1299.07" data-end="1301.349">difficult you can you can either do this</span> <span data-start="1301.349" data-end="1304.229">with promises or with callbacks in the</span> <span data-start="1304.229" data-end="1305.519">same way if you have an interface for</span> <span data-start="1305.519" data-end="1306.989">your call backs you can do this with</span> <span data-start="1306.989" data-end="1309.509">callbacks to I think generators with</span> <span data-start="1309.509" data-end="1311.039">promises are a little bit more powerful</span> <span data-start="1311.039" data-end="1313.049">for reasons I'll explain in a second but</span> <span data-start="1313.049" data-end="1315.45">let's have a look at how this works okay</span> <span data-start="1315.45" data-end="1318.059">so we this is the queue door a sinc</span> <span data-start="1318.059" data-end="1320.909">function so this is the thing that given</span> <span data-start="1320.909" data-end="1323.609">a generator returns a kind of away table</span> <span data-start="1323.609" data-end="1325.529">1 so generators as they could be used</span> <span data-start="1325.529" data-end="1327.21">for loads of different things not just</span> <span data-start="1327.21" data-end="1329.009">this but we're going to use a generator</span> <span data-start="1329.009" data-end="1332.399">for this await style keyword so we get</span> <span data-start="1332.399" data-end="1333.869">our make generator function and we</span> <span data-start="1333.869" data-end="1335.599">return a new function that's the kind of</span> <span data-start="1335.599" data-end="1340.289">decorated one now we set up a continuous</span> <span data-start="1340.289" data-end="1342.179">function that takes a verb and we're</span> <span data-start="1342.179" data-end="1343.499">using bind against its lucky I talks</span> <span data-start="1343.499" data-end="1344.37">about that</span> <span data-start="1344.37" data-end="1346.11">we make two versions of the continuous</span> <span data-start="1346.11" data-end="1348.09">function one that's going to go next on</span> <span data-start="1348.09" data-end="1350.64">the generator and one that's going to go</span> <span data-start="1350.64" data-end="1352.74">throw on the generator and the next one</span> <span data-start="1352.74" data-end="1354.65">just regimes it as we've seen before</span> <span data-start="1354.65" data-end="1357.57">okay so we start off just by calling the</span> <span data-start="1357.57" data-end="1359.52">callback which is going to go into</span> <span data-start="1359.52" data-end="1362.13">continuer the verbs going to be next</span> <span data-start="1362.13" data-end="1364.8">it's going to ask for the next result of</span> <span data-start="1364.8" data-end="1366.12">the generator so it's going to run until</span> <span data-start="1366.12" data-end="1368.01">it hits the first yield and then give us</span> <span data-start="1368.01" data-end="1371.67">back the promise if we throw an error at</span> <span data-start="1371.67" data-end="1372.84">this point then it's going to return a</span> <span data-start="1372.84" data-end="1375.63">rejecter promise it's fine if the</span> <span data-start="1375.63" data-end="1377.19">results done we're going to return the</span> <span data-start="1377.19" data-end="1380.19">value of that entire process but the</span> <span data-start="1380.19" data-end="1381.96">important bit really is if it's not done</span> <span data-start="1381.96" data-end="1384.6">we're going to say cue up that promise</span> <span data-start="1384.6" data-end="1386.4">because it's yielding promises every</span> <span data-start="1386.4" data-end="1388.26">time that's the whole idea cue up that</span> <span data-start="1388.26" data-end="1390.78">promise and when it's done if it</span> <span data-start="1390.78" data-end="1393.21">succeeds we hit cool back so we loop and</span> <span data-start="1393.21" data-end="1395.79">if it fails we hit arrow back so we</span> <span data-start="1395.79" data-end="1399.95">throw now throw is really super because</span> <span data-start="1399.95" data-end="1402.809">throw I hope have a try-catch example in</span> <span data-start="1402.809" data-end="1413.7">here mmm yeah okay not even javascript</span> <span data-start="1413.7" data-end="1416.61">is a bit unfortunate but throw will</span> <span data-start="1416.61" data-end="1418.679">literally throw an error from that point</span> <span data-start="1418.679" data-end="1420.24">inside your generator so suddenly you're</span> <span data-start="1420.24" data-end="1422.49">a synchronous processes work with try</span> <span data-start="1422.49" data-end="1424.11">and catch which is completely amazing</span> <span data-start="1424.11" data-end="1426.69">you can suddenly granularly put a try</span> <span data-start="1426.69" data-end="1428.25">and catch around each one of your async</span> <span data-start="1428.25" data-end="1430.98">processes that might fail again you can</span> <span data-start="1430.98" data-end="1436.62">use try catch is pretty amazing cool and</span> <span data-start="1436.62" data-end="1438.21">that's it that's all you need and</span> <span data-start="1438.21" data-end="1440.07">there's similar the glue code for using</span> <span data-start="1440.07" data-end="1442.29">it with callbacks is even shorter it's</span> <span data-start="1442.29" data-end="1443.91">amazing now like I say I mean this is</span> <span data-start="1443.91" data-end="1445.71">just one use of generators they're going</span> <span data-start="1445.71" data-end="1449.13">to be pretty amazing so having a look at</span> <span data-start="1449.13" data-end="1452.57">a dependent process we can just yield a</span> <span data-start="1452.57" data-end="1455.64">wait for it to come back and then put</span> <span data-start="1455.64" data-end="1457.38">into be it's just like synchronous code</span> <span data-start="1457.38" data-end="1461.1">we get the value back parallel processes</span> <span data-start="1461.1" data-end="1462.39">as I said a pretty easy we just kick</span> <span data-start="1462.39" data-end="1463.74">them off we get the promises from both</span> <span data-start="1463.74" data-end="1465.48">and then we can just loop over and block</span> <span data-start="1465.48" data-end="1467.34">now the point I was making about cool</span> <span data-start="1467.34" data-end="1470.13">boxes you still can't do it like this</span> <span data-start="1470.13" data-end="1471.87">with callbacks because we're still going</span> <span data-start="1471.87" data-end="1473.429">to have the same problem where we don't</span> <span data-start="1473.429" data-end="1475.399">have the value yet to reason about</span> <span data-start="1475.399" data-end="1476.96">there's nothing in the machinery that's</span> <span data-start="1476.96" data-end="1479.869">going to let us give back something so</span> <span data-start="1479.869" data-end="1481.219">we can have to block on the call back</span> <span data-start="1481.219" data-end="1482.779">straightaway just one at a time so you</span> <span data-start="1482.779" data-end="1486.109">can't do parallel processes with with</span> <span data-start="1486.109" data-end="1487.429">just call backs if you can with promises</span> <span data-start="1487.429" data-end="1491.269">a new rule is pretty easy just leaping</span> <span data-start="1491.269" data-end="1494.149">over arrays and obviously this will</span> <span data-start="1494.149" data-end="1496.159">works with async as well if you using</span> <span data-start="1496.159" data-end="1501.109">the callback style sweet so seems like</span> <span data-start="1501.109" data-end="1503.269">kind of a synchronous code is a solved</span> <span data-start="1503.269" data-end="1505.46">problem well the last thing that we</span> <span data-start="1505.46" data-end="1506.96">can't do with a sink and I think we're</span> <span data-start="1506.96" data-end="1510.889">ever gonna be able to do is to wrap the</span> <span data-start="1510.889" data-end="1513.889">async bit of our code and ignore it from</span> <span data-start="1513.889" data-end="1514.849">the rest of our code so we have a</span> <span data-start="1514.849" data-end="1516.32">synchronous bit of our code and an async</span> <span data-start="1516.32" data-end="1518.869">because we can never stop the</span> <span data-start="1518.869" data-end="1520.219">asynchronous code kind of leaking out</span> <span data-start="1520.219" data-end="1521.45">we're always going to have to deal with</span> <span data-start="1521.45" data-end="1522.94">async code everywhere in our code base</span> <span data-start="1522.94" data-end="1525.71">and that's simply because jay s is</span> <span data-start="1525.71" data-end="1527.419">always going to be single threaded and</span> <span data-start="1527.419" data-end="1529.489">there's no way of having what i call a</span> <span data-start="1529.489" data-end="1531.08">deep co routine where we block the whole</span> <span data-start="1531.08" data-end="1534.109">thread all the generator does is go back</span> <span data-start="1534.109" data-end="1535.519">to the calling environment it doesn't</span> <span data-start="1535.519" data-end="1537.259">block the entire interpreter and this is</span> <span data-start="1537.259" data-end="1539.029">a good thing if we have threads we'd</span> <span data-start="1539.029" data-end="1540.109">have all the kind of problems with</span> <span data-start="1540.109" data-end="1541.129">reading that we don't have with</span> </p>
<p><span data-start="1541.129" data-end="1543.559">JavaScript so it's actually good this is</span> <span data-start="1543.559" data-end="1544.609">the kind of level of pain we should</span> <span data-start="1544.609" data-end="1547.639">accept in JavaScript we have synchronous</span> <span data-start="1547.639" data-end="1550.489">looking code it's pretty easy to reason</span> <span data-start="1550.489" data-end="1554.379">about I think we won I think we've won</span> <span data-start="1554.379" data-end="1556.929">asynchronous code is kind of easy again</span> <span data-start="1556.929" data-end="1559.399">it's pretty exciting so we got</span> <span data-start="1559.399" data-end="1561.049">JavaScript back we can use ifs we can</span> <span data-start="1561.049" data-end="1562.58">use else's we can use falls and tries</span> <span data-start="1562.58" data-end="1565.58">and catches it's all pretty easy we need</span> <span data-start="1565.58" data-end="1567.71">to wrap our code with these kind of glue</span> <span data-start="1567.71" data-end="1570.08">code things and use generators it still</span> <span data-start="1570.08" data-end="1571.639">leaks the async ever in our code but</span> <span data-start="1571.639" data-end="1573.259">we're happy with that we avoid threading</span> <span data-start="1573.259" data-end="1575.179">hell which I think of on balance is far</span> <span data-start="1575.179" data-end="1582.679">worse than callback hell cool so to sum</span> <span data-start="1582.679" data-end="1584.419">up don't in line everything it's</span> <span data-start="1584.419" data-end="1585.789">terrible you need to write tests</span> <span data-start="1585.789" data-end="1587.96">javascript has the tools to solve the</span> <span data-start="1587.96" data-end="1590.059">simple cases and when they fall down we</span> <span data-start="1590.059" data-end="1591.71">have our kind of trio of tools we can</span> <span data-start="1591.71" data-end="1594.32">use async it's pretty good it's not a</span> <span data-start="1594.32" data-end="1596.419">great abstraction kind of leaks and when</span> <span data-start="1596.419" data-end="1598.929">it leaks we can use promises promises</span> <span data-start="1598.929" data-end="1601.46">also solve the whole time issue we</span> <span data-start="1601.46" data-end="1602.899">finally have a value of game we can</span> <span data-start="1602.899" data-end="1605.059">write code straight away we can kind of</span> <span data-start="1605.059" data-end="1607.519">link it all up like a spreadsheet and</span> <span data-start="1607.519" data-end="1609.24">then finally if we want</span> <span data-start="1609.24" data-end="1611.52">right some really nice-looking code we</span> <span data-start="1611.52" data-end="1613.44">can use generators you can generate us</span> <span data-start="1613.44" data-end="1614.64">right now by the way in Chrome Canary</span> <span data-start="1614.64" data-end="1618.77">and node 0 point 11 with a harmony flag</span> <span data-start="1618.77" data-end="1620.97">and they're coming pretty soon there's</span> <span data-start="1620.97" data-end="1623.22">also a tracer compiler that compiles</span> <span data-start="1623.22" data-end="1625.62">from es5 to es6 includes generators by</span> <span data-start="1625.62" data-end="1628.56">some crazy voodoo so you can use it</span> <span data-start="1628.56" data-end="1630.78">today and and firefox but is it still</span> <span data-start="1630.78" data-end="1633.87">the python generators or yeah i thought</span> <span data-start="1633.87" data-end="1638.13">it was sweet okay so firefox soon</span> <span data-start="1638.13" data-end="1640.08">firefox currently has an old version</span> <span data-start="1640.08" data-end="1641.52">generators but it was seen how the best</span> <span data-start="1641.52" data-end="1644.9">version generators thanks a lot cool</span> <span data-start="1644.9" data-end="1653.779">that's me come</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
