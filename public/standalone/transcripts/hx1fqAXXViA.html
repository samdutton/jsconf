<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>hx1fqAXXViA</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/hx1fqAXXViA?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="8.63" data-end="11.91">hi everyone okay welcome to Hangover</span> <span data-start="11.91" data-end="13.86">number two I hope you're not</span> <span data-start="13.86" data-end="17.16">number two I hope you're not feeling too however this morning my name</span> <span data-start="17.16" data-end="18.779">is Oliver ash you can find me on twitter</span> <span data-start="18.779" data-end="22.14">at this user name and today i'm going to</span> <span data-start="22.14" data-end="24.029">be talking about how i built an offline</span> <span data-start="24.029" data-end="27.54">page for the Guardian com I work at the</span> </p>
<p><span data-start="27.54" data-end="30.06">Guardian previously I worked on the</span> <span data-start="30.06" data-end="32.52">content management system which is a web</span> <span data-start="32.52" data-end="35.13">application you can see here this is</span> <span data-start="35.13" data-end="38.01">called composer if you want to hear more</span> <span data-start="38.01" data-end="40.32">about that you can come talk to me later</span> <span data-start="40.32" data-end="41.88">but essentially this is the tool that</span> <span data-start="41.88" data-end="43.92">all the journalists key is to publish</span> <span data-start="43.92" data-end="47.36">content to the web and also print and</span> <span data-start="47.36" data-end="50.88">now I work on the website and so if you</span> <span data-start="50.88" data-end="52.53">hump me into the Guardian com this is</span> <span data-start="52.53" data-end="58.67">what it looks like I'm going to begin by</span> <span data-start="58.67" data-end="61.89">comparing web and native and how these</span> <span data-start="61.89" data-end="66.09">two different platforms compare when it</span> <span data-start="66.09" data-end="69.78">comes to performance in a native app</span> <span data-start="69.78" data-end="72.72">when you open when you open it it will</span> <span data-start="72.72" data-end="75.06">download some content and cash it so the</span> <span data-start="75.06" data-end="76.77">next time you're open it and you're</span> <span data-start="76.77" data-end="78.72">offline well you just see the stale</span> <span data-start="78.72" data-end="80.729">content this is a guardian up I'm</span> <span data-start="80.729" data-end="82.83">offline but I can still see the homepage</span> </p>
<p><span data-start="82.83" data-end="85.47">I can actually navigate into content and</span> <span data-start="85.47" data-end="89.25">I can still read it the same thing if</span> <span data-start="89.25" data-end="92.159">the server is down I'll see the stale</span> <span data-start="92.159" data-end="95.909">content if I have a poor connection then</span> <span data-start="95.909" data-end="97.89">I'll see the stell content whilst we try</span> <span data-start="97.89" data-end="100.95">to get the new content that might take a</span> <span data-start="100.95" data-end="102.18">long time but at least I'm seeing</span> <span data-start="102.18" data-end="104.7">something in the meantime and if I have</span> <span data-start="104.7" data-end="106.89">a good connection then I'll briefly see</span> <span data-start="106.89" data-end="108.96">the cell content and then I'll see the</span> <span data-start="108.96" data-end="111.24">new content once it arrives we will know</span> <span data-start="111.24" data-end="112.65">this because we will use native apps</span> <span data-start="112.65" data-end="116.7">every day but on the web well if you're</span> <span data-start="116.7" data-end="118.439">flying you don't really get anything if</span> </p>
<p><span data-start="118.439" data-end="120.18">I try to go to the Guardian calm and I'm</span> <span data-start="120.18" data-end="123.299">a flying I just get this chrome or Fline</span> <span data-start="123.299" data-end="125.58">page little and in fact there is a game</span> <span data-start="125.58" data-end="127.11">you can play if you tap on the dinosaur</span> <span data-start="127.11" data-end="130.7">it's quite fun I'm not very good at they</span> <span data-start="130.7" data-end="133.739">if the server's down again I'll just get</span> <span data-start="133.739" data-end="137.129">this page it's not very useful and if I</span> <span data-start="137.129" data-end="138.599">have a poor connection then you're going</span> <span data-start="138.599" data-end="140.129">to be if you try to let the Guardian</span> <span data-start="140.129" data-end="140.85">drama anyone</span> <span data-start="140.85" data-end="142.98">so you're going to be staring at a white</span> <span data-start="142.98" data-end="146.4">screen until the content of isles and if</span> <span data-start="146.4" data-end="147.96">you have a good connection then finally</span> <span data-start="147.96" data-end="150.15">we have the happy path you see the new</span> <span data-start="150.15" data-end="155.31">content and and and the offline page is</span> <span data-start="155.31" data-end="156.78">actually becoming something of a symbol</span> <span data-start="156.78" data-end="159">like this is an advertisement in the cap</span> <span data-start="159" data-end="161.16">underground station or in the capital of</span> </p>
<p><span data-start="161.16" data-end="164.01">Argentina and you can see that the the</span> <span data-start="164.01" data-end="165.33">dinosaur that I just showed you on the</span> <span data-start="165.33" data-end="167.7">offline page and is actually used in an</span> <span data-start="167.7" data-end="170.7">advertisement say what why don't we use</span> <span data-start="170.7" data-end="173.28">that as an opportunity to push our brand</span> <span data-start="173.28" data-end="177.74">and so to give the user something useful</span> <span data-start="177.74" data-end="181.02">so we can we can do that we can do</span> <span data-start="181.02" data-end="183.81">better and as a start the guards</span> <span data-start="183.81" data-end="187.05">intercom we built an offline page so if</span> <span data-start="187.05" data-end="190.92">i'm on https page on the guardian and i</span> <span data-start="190.92" data-end="196.32">go offline when i refresh that page I'll</span> <span data-start="196.32" data-end="198.87">see the offline page and it has a</span> <span data-start="198.87" data-end="201.9">crossword you can play but I'm not very</span> <span data-start="201.9" data-end="204.54">good at crossword this way have a go</span> <span data-start="204.54" data-end="209.76">there if you want to try it out we are</span> <span data-start="209.76" data-end="212.79">we have limited it to the smashing fire</span> <span data-start="212.79" data-end="214.62">/ developer blog section and that's</span> <span data-start="214.62" data-end="216.72">because of browser bucks which I will</span> <span data-start="216.72" data-end="220.98">explain later so I'm gonna I'm going to</span> <span data-start="220.98" data-end="226.04">break down how we built it in four steps</span> <span data-start="226.04" data-end="230.19">the first step is introducing service</span> <span data-start="230.19" data-end="234.72">workers I before I go into that I just</span> <span data-start="234.72" data-end="236.94">want to emphasize that this is something</span> <span data-start="236.94" data-end="240.42">that I was able to build in less than a</span> <span data-start="240.42" data-end="244.29">day I think mid 2015 Jake came into the</span> </p>
<p><span data-start="244.29" data-end="246.78">Guardian office to talk about service</span> <span data-start="246.78" data-end="249.66">workers and I thought okay I'm going to</span> <span data-start="249.66" data-end="251.64">use this as an opportunity to try and</span> <span data-start="251.64" data-end="253.35">learn and spilled something and I was</span> <span data-start="253.35" data-end="255.36">able to build what you just saw in less</span> <span data-start="255.36" data-end="257.19">than a day I did have to do some</span> <span data-start="257.19" data-end="259.32">polishing to get into production but</span> <span data-start="259.32" data-end="261.27">that was no more than a few hours so</span> <span data-start="261.27" data-end="262.59">everything you see here you can learn</span> <span data-start="262.59" data-end="265.74">you can I want to inspire you to go</span> <span data-start="265.74" data-end="267.06">ahead and pay with these technologies</span> <span data-start="267.06" data-end="270.479">yourself so what is the service worker</span> <span data-start="270.479" data-end="271.849">well</span> <span data-start="271.849" data-end="273.289">I don't know if this needs an</span> <span data-start="273.289" data-end="276.649">introduction really but i'm going to i'm</span> <span data-start="276.649" data-end="278.33">going to do an introduction but create</span> <span data-start="278.33" data-end="280.999">chrome dev summit last year i think</span> <span data-start="280.999" data-end="283.369">someone counted how many times the word</span> <span data-start="283.369" data-end="287.029">service workers was used and they</span> <span data-start="287.029" data-end="289.069">counted 66.5 I actually think that's</span> <span data-start="289.069" data-end="291.169">probably a guess and I think it was</span> <span data-start="291.169" data-end="292.399">probably mentioned more than a hundred</span> <span data-start="292.399" data-end="296.749">times but there we go and of course if</span> <span data-start="296.749" data-end="298.279">you if you didn't know what service</span> <span data-start="298.279" data-end="300.61">workers well then you probably</span> <span data-start="300.61" data-end="302.869">discovered yesterday that actually it's</span> <span data-start="302.869" data-end="305.599">just a cake and you can eat service</span> <span data-start="305.599" data-end="310.61">workers so a service worker is a script</span> <span data-start="310.61" data-end="313.369">that runs in the background and it's</span> <span data-start="313.369" data-end="316.249">useful for features that require no user</span> <span data-start="316.249" data-end="319.759">interaction so that might be listening</span> <span data-start="319.759" data-end="321.919">to a push event and you might want to</span> <span data-start="321.919" data-end="324.229">show a notification when you receive a</span> <span data-start="324.229" data-end="326.99">push oven we might be intersecting and</span> <span data-start="326.99" data-end="329.36">handling Network requests which is</span> <span data-start="329.36" data-end="330.559">something that will be using</span> <span data-start="330.559" data-end="332.36">specifically for the affluent page as</span> <span data-start="332.36" data-end="335.149">well as I'll show you and in the future</span> <span data-start="335.149" data-end="336.919">it will be used for other things like a</span> <span data-start="336.919" data-end="339.439">background think if you have some data</span> <span data-start="339.439" data-end="342.729">that you want to update periodically or</span> <span data-start="342.729" data-end="345.8">alarmed if you want to show a reminder a</span> <span data-start="345.8" data-end="349.879">specific time to a user and also maybe</span> <span data-start="349.879" data-end="351.649">geofencing so when you enter a</span> <span data-start="351.649" data-end="353.659">geographical perimeter you want to</span> <span data-start="353.659" data-end="356.059">perform some action all of these things</span> <span data-start="356.059" data-end="359.36">the service work is a perfect place to</span> <span data-start="359.36" data-end="361.819">have to have those features and it's</span> <span data-start="361.819" data-end="363.349">also a progressive enhancement because</span> <span data-start="363.349" data-end="365.3">if you don't have service worker then</span> <span data-start="365.3" data-end="368.719">your your website just works as it as it</span> <span data-start="368.719" data-end="373.369">was before to do two things tonight it's</span> <span data-start="373.369" data-end="377.479">https only and it's supported in chrome</span> <span data-start="377.479" data-end="380.839">or opera and firefox a moment but maybe</span> <span data-start="380.839" data-end="386.59">safari next decades we'll see</span> <span data-start="386.6" data-end="390.27">and for the observant among you you may</span> <span data-start="390.27" data-end="392.61">realize that actually the Guardian isn't</span> <span data-start="392.61" data-end="396.96">on HTTPS but we are migrating we're</span> <span data-start="396.96" data-end="400.02">actually migrating pay section by</span> <span data-start="400.02" data-end="402.15">section these are the ones that you can</span> <span data-start="402.15" data-end="405.06">go to today and they are HTTPS and if</span> <span data-start="405.06" data-end="406.41">you go to any of these page you'll get</span> <span data-start="406.41" data-end="411.42">our service worker and if you want to</span> <span data-start="411.42" data-end="413.1">learn more about how the migration is</span> <span data-start="413.1" data-end="414.45">going come and talk to me afterwards but</span> </p>
<p><span data-start="414.45" data-end="416.88">I think we've essentially ruled out as</span> <span data-start="416.88" data-end="420.24">advertising as a problem so we've almost</span> <span data-start="420.24" data-end="424.6">got the green light to go for the HTTPS</span> <span data-start="424.61" data-end="428.4">so creating and registering a service</span> <span data-start="428.4" data-end="431.07">worker just imagine me we create a empty</span> <span data-start="431.07" data-end="433.35">file called service worker George S and</span> <span data-start="433.35" data-end="435.78">on an HTML page we're going to have a</span> <span data-start="435.78" data-end="438.419">script that tells the browser we want to</span> <span data-start="438.419" data-end="443.07">register it we have a service worker</span> <span data-start="443.07" data-end="446.01">registered now but nothing is really</span> <span data-start="446.01" data-end="447.69">happening the request is just going</span> <span data-start="447.69" data-end="450.06">straight from the page to the server and</span> <span data-start="450.06" data-end="455.22">back if if you want to see yourselves</span> <span data-start="455.22" data-end="456.51">worker you can actually use the dev</span> <span data-start="456.51" data-end="457.98">tools to see that if you go into the</span> <span data-start="457.98" data-end="460.5">resources panel and I can service work</span> <span data-start="460.5" data-end="464.46">it down the left-hand side likewise in</span> <span data-start="464.46" data-end="468">chrome if you go to about debugging hash</span> <span data-start="468" data-end="470.28">workers and you can see your service</span> <span data-start="470.28" data-end="473.76">worker there as well so we have we have</span> <span data-start="473.76" data-end="475.89">a we have a service worker but it's not</span> <span data-start="475.89" data-end="479.01">doing anything what we need to do is we</span> <span data-start="479.01" data-end="480.45">need to we need to download some</span> <span data-start="480.45" data-end="482.7">resources ahead of time and the show to</span> <span data-start="482.7" data-end="484.62">the user when they're offline we want to</span> <span data-start="484.62" data-end="488.31">prime the cash and service worker has</span> <span data-start="488.31" data-end="489.75">something called the install event which</span> <span data-start="489.75" data-end="492.06">is the perfect opportunity to do this</span> <span data-start="492.06" data-end="495.9">and so I don't have too much code today</span> <span data-start="495.9" data-end="500.25">but this is just to show you how you</span> <span data-start="500.25" data-end="504.57">prank ash we in the install event we</span> <span data-start="504.57" data-end="506.19">just run a function called update cash</span> <span data-start="506.19" data-end="510.66">and that opens a new cache and it adds</span> <span data-start="510.66" data-end="513.75">three different assets to the cash the</span> <span data-start="513.75" data-end="516.39">offline page which is the HTML some CSS</span> <span data-start="516.39" data-end="517.9">which we need for that for the</span> <span data-start="517.9" data-end="523.21">homepage to work and some JavaScript and</span> <span data-start="523.21" data-end="524.98">we also we're going to version the cash</span> <span data-start="524.98" data-end="528.43">because as we see later we want to we</span> <span data-start="528.43" data-end="530.71">want to know when the user has an old</span> <span data-start="530.71" data-end="532.36">version and then we want to update it</span> <span data-start="532.36" data-end="538.06">and but you'll see that later and in our</span> <span data-start="538.06" data-end="540.07">case as you saw the offline page has a</span> <span data-start="540.07" data-end="541.6">critter has a crossword that's actually</span> <span data-start="541.6" data-end="543.85">built as a reactor reactor application</span> <span data-start="543.85" data-end="546.4">and that's all contained within within</span> <span data-start="546.4" data-end="548.13">the JavaScript that we're cashing here</span> <span data-start="548.13" data-end="551.29">so now we have a service worker and cash</span> <span data-start="551.29" data-end="555.1">but we're not doing anything still you</span> <span data-start="555.1" data-end="556.72">know the offline page doesn't work yet</span> <span data-start="556.72" data-end="558.82">request is just going straight to the</span> <span data-start="558.82" data-end="561.01">server and back so the next thing we</span> <span data-start="561.01" data-end="564.06">need to do is we need to handle requests</span> <span data-start="564.06" data-end="567.85">with something called to fetch event the</span> <span data-start="567.85" data-end="570.91">fetch event lets you intercept requests</span> <span data-start="570.91" data-end="574.59">and handle them programmatically and so</span> <span data-start="574.59" data-end="578.46">the default is just for the browser to</span> <span data-start="578.46" data-end="582.34">to make the request to the network and</span> <span data-start="582.34" data-end="583.9">in the code here which I've just added</span> <span data-start="583.9" data-end="585.34">to the bottom of the code that you saw</span> <span data-start="585.34" data-end="590.23">previously and I'm just going dude doing</span> <span data-start="590.23" data-end="591.76">what the browser were doing it anyway so</span> </p>
<p><span data-start="591.76" data-end="593.11">I'm not doing anything different here</span> <span data-start="593.11" data-end="595.9">but what you could do is you could fetch</span> <span data-start="595.9" data-end="597.1">for what you could fetch from the catch</span> <span data-start="597.1" data-end="599.89">cash instead or you could construct a</span> <span data-start="599.89" data-end="606.36">response programmatically so now our</span> <span data-start="606.36" data-end="608.83">service worker is actually doing</span> <span data-start="608.83" data-end="610.6">something the the requests are actually</span> <span data-start="610.6" data-end="614.32">going through the service worker to the</span> <span data-start="614.32" data-end="617.11">server and back but we still don't help</span> <span data-start="617.11" data-end="620.08">your flowing page working and let's move</span> <span data-start="620.08" data-end="623.41">on just to give you an idea of the</span> <span data-start="623.41" data-end="625.27">flexibility you have in a service worker</span> <span data-start="625.27" data-end="627.43">it is very very programmatic so you can</span> <span data-start="627.43" data-end="630.19">actually construct your own response as</span> <span data-start="630.19" data-end="632.02">you can see here I have a string of HTML</span> <span data-start="632.02" data-end="636.34">and I could just construct your response</span> <span data-start="636.34" data-end="638.71">from that string and respond with that</span> <span data-start="638.71" data-end="641.32">and that the browser is a perfectly</span> <span data-start="641.32" data-end="643.63">valid response so you have a lot of</span> <span data-start="643.63" data-end="647.789">control</span> <span data-start="647.799" data-end="651.499">so in order to use the fetch event to</span> <span data-start="651.499" data-end="653.809">serve the offline page and I need to I</span> <span data-start="653.809" data-end="655.459">need to break this down into two parts</span> <span data-start="655.459" data-end="657.29">because we have we have two different</span> <span data-start="657.29" data-end="660.259">types of content we have HTML which is</span> <span data-start="660.259" data-end="663.92">mutable and so you know the Guardian com</span> <span data-start="663.92" data-end="667.22">is some HTML and it changes every time</span> <span data-start="667.22" data-end="669.319">someone adds new contents for the</span> <span data-start="669.319" data-end="671.689">offline page will also change and every</span> <span data-start="671.689" data-end="675.259">time we make a change to it or you know</span> <span data-start="675.259" data-end="679.639">the crossword updates whereas we have we</span> <span data-start="679.639" data-end="681.739">have immutable assets like a CSS and</span> </p>
<p><span data-start="681.739" data-end="684.679">JavaScript once we deploy those they are</span> <span data-start="684.679" data-end="687.079">on the Internet forever and and if you</span> <span data-start="687.079" data-end="690.17">request that URL and it will it will</span> <span data-start="690.17" data-end="693.319">always return the same content so we</span> <span data-start="693.319" data-end="694.79">have different kasia strategies for</span> <span data-start="694.79" data-end="696.47">these different different types of</span> <span data-start="696.47" data-end="699.019">requests so I'm we need to handle them</span> <span data-start="699.019" data-end="704.089">separately for HTML and when when you're</span> <span data-start="704.089" data-end="706.61">offline and you make a request for some</span> <span data-start="706.61" data-end="708.35">HTML that's the time when we want to</span> <span data-start="708.35" data-end="711.169">show you offline page so what would be</span> <span data-start="711.169" data-end="713.66">is what we want to do is we want to go</span> <span data-start="713.66" data-end="715.61">to the network first because if you are</span> <span data-start="715.61" data-end="716.989">online we don't want to show the offline</span> <span data-start="716.989" data-end="720.11">page but if there is an error when we</span> <span data-start="720.11" data-end="722.689">try to go to the to the network then</span> <span data-start="722.689" data-end="725.6">we'll fall back to the cash and this is</span> <span data-start="725.6" data-end="727.249">a path pattern known as network first</span> <span data-start="727.249" data-end="732.919">then cash this is the same in fetch</span> <span data-start="732.919" data-end="736.579">event you saw earlier I the only change</span> </p>
<p><span data-start="736.579" data-end="738.819">I've made here is I've guarded the</span> <span data-start="738.819" data-end="742.73">response and I'm only handling HTML</span> <span data-start="742.73" data-end="744.679">requests and the way I do that is by</span> <span data-start="744.679" data-end="747.589">looking at the request headers and so</span> <span data-start="747.589" data-end="750.35">the request accept header and tells me</span> <span data-start="750.35" data-end="753.29">whether or not the browser accepts HTML</span> <span data-start="753.29" data-end="755.809">and all only I'll only handle the</span> <span data-start="755.809" data-end="759.549">request if the browser does except HTML</span> <span data-start="759.549" data-end="763.939">that's not useful in itself but we will</span> <span data-start="763.939" data-end="767.799">elaborate so moving on we hit we have</span> <span data-start="767.799" data-end="770.119">that we're doing the fetch to the</span> <span data-start="770.119" data-end="772.009">network and we want to fall back to the</span> <span data-start="772.009" data-end="776.48">cash fetch returns a promise so if</span> <span data-start="776.48" data-end="779.8">you're offline fetch will return</span> <span data-start="779.8" data-end="783.339">will return a rejected promise so we</span> <span data-start="783.339" data-end="787.089">catch that promise rejection and we</span> <span data-start="787.089" data-end="789.49">retrieve something from the cache which</span> <span data-start="789.49" data-end="795.399">is that offline page and now if you're</span> <span data-start="795.399" data-end="797.62">offline you get this beautiful offline</span> <span data-start="797.62" data-end="800.529">page that something's missing I hope you</span> <span data-start="800.529" data-end="803.709">can notice we're missing some styling</span> <span data-start="803.709" data-end="808.72">and some behavior so we now need to</span> <span data-start="808.72" data-end="811.779">handle asset requests and as I said</span> <span data-start="811.779" data-end="815.11">earlier these were immutable so what we</span> <span data-start="815.11" data-end="816.67">want to do really is we want to go to</span> <span data-start="816.67" data-end="818.769">the cash straight away because we know</span> <span data-start="818.769" data-end="821.82">that they're going to be in there and</span> <span data-start="821.82" data-end="825.79">this is how we do that if it's not HTML</span> <span data-start="825.79" data-end="830.47">then we'll just look in the cash to see</span> <span data-start="830.47" data-end="833.35">if there's a an entry that matches the</span> <span data-start="833.35" data-end="837.339">request that's coming through ah that's</span> <span data-start="837.339" data-end="839.17">not going to work for things which</span> <span data-start="839.17" data-end="842.92">aren't in the cash so we need to we need</span> <span data-start="842.92" data-end="845.079">to take a different approach we want to</span> <span data-start="845.079" data-end="848.35">go to the cash first and if it's not in</span> <span data-start="848.35" data-end="850.329">a cash then we'll try the network and</span> <span data-start="850.329" data-end="853.66">this is good for any CSS or JavaScript</span> <span data-start="853.66" data-end="855.55">any assets that we don't have in the</span> <span data-start="855.55" data-end="857.89">cash because remember remember we're</span> <span data-start="857.89" data-end="859.36">only cashing things which are needed for</span> <span data-start="859.36" data-end="863.32">your flame page and the way we do that</span> <span data-start="863.32" data-end="865.95">is the same code we had before and</span> <span data-start="865.95" data-end="869.829">cashes match returns at promise and</span> <span data-start="869.829" data-end="872.01">we'll see if the value of that from its</span> <span data-start="872.01" data-end="877.36">is  or not and if there is a</span> <span data-start="877.36" data-end="879.579">value then we'll just use that otherwise</span> <span data-start="879.579" data-end="881.29">we'll go to the network using the fetch</span> <span data-start="881.29" data-end="888.54">function the final part to talk about is</span> <span data-start="888.54" data-end="891.64">updating the crossword so we publish new</span> <span data-start="891.64" data-end="894.3">crosswords every day we have an avid</span> <span data-start="894.3" data-end="898.54">user base and it would be great if the</span> <span data-start="898.54" data-end="900.279">offline page contained the latest</span> <span data-start="900.279" data-end="904.99">crossword and how would you do this well</span> <span data-start="904.99" data-end="907.72">the way we're currently doing it is in</span> <span data-start="907.72" data-end="910.4">the global scope of our service worker</span> <span data-start="910.4" data-end="912.51">with we're seeing if the cache is</span> <span data-start="912.51" data-end="915.24">updated or not and we know we know that</span> <span data-start="915.24" data-end="917.7">by looking at the cache name that we</span> <span data-start="917.7" data-end="920.4">defined earlier as I said earlier we've</span> <span data-start="920.4" data-end="922.35">version the cash so if there isn't a</span> <span data-start="922.35" data-end="925.56">version that matches today's date then</span> <span data-start="925.56" data-end="928.98">we know it's not up to date and if it's</span> <span data-start="928.98" data-end="931.41">not up to date then we'll run the same</span> <span data-start="931.41" data-end="933.18">function that we ran in the install</span> <span data-start="933.18" data-end="935.7">event the update cash function and then</span> <span data-start="935.7" data-end="937.77">once that finishes we can safely delete</span> <span data-start="937.77" data-end="941.94">the old caches in the future we might</span> <span data-start="941.94" data-end="944.31">want to use the background sync API for</span> <span data-start="944.31" data-end="948.27">this instead it's kind of it's a bit of</span> <span data-start="948.27" data-end="949.95">a hack doing it doing it here and</span> <span data-start="949.95" data-end="951.72">actually the reason this works is</span> <span data-start="951.72" data-end="954.15">because the browser closes the service</span> <span data-start="954.15" data-end="956.79">worker and disabled memory and then it</span> <span data-start="956.79" data-end="959.25">will boot it up again when you visit</span> <span data-start="959.25" data-end="961.8">that page again and so this code in the</span> <span data-start="961.8" data-end="963.42">global scope actually gets it gets a</span> <span data-start="963.42" data-end="969.42">chance to run quite frequently sorry</span> <span data-start="969.42" data-end="973.25">there we go we have an offline page and</span> <span data-start="973.25" data-end="977.61">everything works next I want to talk</span> <span data-start="977.61" data-end="979.52">about what we might use service worker</span> <span data-start="979.52" data-end="981.75">for in the future on the Guardian calm</span> <span data-start="981.75" data-end="984.45">and you're flying page right now is a</span> <span data-start="984.45" data-end="986.39">little bit insignificant because of our</span> </p>
<p><span data-start="986.39" data-end="990.48">HTTPS migration is still ongoing and</span> <span data-start="990.48" data-end="992.97">also browser support but it will</span> <span data-start="992.97" data-end="994.56">increase in significance you can imagine</span> <span data-start="994.56" data-end="997.08">a year from now when browser support is</span> <span data-start="997.08" data-end="1001.64">really good and we're on HTTPS loads of</span> <span data-start="1001.64" data-end="1004.85">people will see that offline page so we</span> <span data-start="1004.85" data-end="1007.04">would like to extend it maybe do what</span> <span data-start="1007.04" data-end="1008.87">native apps to show the stale content or</span> <span data-start="1008.87" data-end="1011.18">download content ahead of time and show</span> <span data-start="1011.18" data-end="1013.55">them show the user personalized content</span> <span data-start="1013.55" data-end="1016.07">for them because we know what you've</span> <span data-start="1016.07" data-end="1020.9">been reading recently and we also have a</span> <span data-start="1020.9" data-end="1022.28">feature called save for later we could</span> <span data-start="1022.28" data-end="1027.02">use that as a action that states I want</span> <span data-start="1027.02" data-end="1029.66">to read this offline and we could also</span> <span data-start="1029.66" data-end="1033.02">go full you're flying fast and I'll fly</span> <span data-start="1033.02" data-end="1035.78">first what does that mean it means when</span> </p>
<p><span data-start="1035.78" data-end="1038.689">I request the HTML I get a response</span> <span data-start="1038.689" data-end="1040.699">instantly with just a shell of the page</span> <span data-start="1040.699" data-end="1043.449">and that's coming from the cash</span> <span data-start="1043.449" data-end="1048.86">via the service worker that improves</span> <span data-start="1048.86" data-end="1050.69">experience quite significantly for users</span> <span data-start="1050.69" data-end="1052.27">with poor connections as we saw earlier</span> <span data-start="1052.27" data-end="1055.61">when we compared native and web if you</span> <span data-start="1055.61" data-end="1057.2">if you have a poor connection you open a</span> <span data-start="1057.2" data-end="1058.61">website you're just going to be staring</span> <span data-start="1058.61" data-end="1061.13">a white screen so service workers allows</span> <span data-start="1061.13" data-end="1063.38">you to to avoid that situation and give</span> <span data-start="1063.38" data-end="1069.08">a much better experience and yeah we</span> <span data-start="1069.08" data-end="1070.7">could show you Stella content whilst</span> <span data-start="1070.7" data-end="1075.71">clutching new new new content as well so</span> <span data-start="1075.71" data-end="1078.59">just to create a very happy demo me to</span> <span data-start="1078.59" data-end="1080.6">demonstrate what I meant by that this is</span> <span data-start="1080.6" data-end="1084.11">kind of how many content websites why</span> <span data-start="1084.11" data-end="1087.32">today you tap on a link and then nothing</span> <span data-start="1087.32" data-end="1092.059">happens for 5-10 seconds depending on</span> <span data-start="1092.059" data-end="1094.52">your network connection and then finally</span> <span data-start="1094.52" data-end="1096.77">the new content downloads and it flashes</span> <span data-start="1096.77" data-end="1099.799">and it appears on screen but you're not</span> <span data-start="1099.799" data-end="1102.98">really giving you any feedback would it</span> <span data-start="1102.98" data-end="1104.9">would be much better if when I tap on</span> <span data-start="1104.9" data-end="1108.23">that link i get feedback straightaway to</span> <span data-start="1108.23" data-end="1109.4">say okay something is happening</span> <span data-start="1109.4" data-end="1110.99">something floating and then when the new</span> <span data-start="1110.99" data-end="1115.25">content arrives it just appears and that</span> <span data-start="1115.25" data-end="1120.09">is what we mean by show architecture i</span> <span data-start="1120.1" data-end="1122.929">also want to mention some problems and</span> <span data-start="1122.929" data-end="1124.82">caveats that I had when I was working on</span> <span data-start="1124.82" data-end="1126.86">this mentioned earlier that there were</span> <span data-start="1126.86" data-end="1129.71">browser bugs as a weird bargain chrome</span> <span data-start="1129.71" data-end="1136.07">where any redirect from HTTP to HTTPS</span> <span data-start="1136.07" data-end="1138.289">would result in there in a view of the</span> <span data-start="1138.289" data-end="1140.35">offline page even if you went offline</span> <span data-start="1140.35" data-end="1143.179">and we also had a weird bug in Firefox</span> <span data-start="1143.179" data-end="1146.419">where cookies were dropped and which</span> <span data-start="1146.419" data-end="1149.57">meant that or no those odd behavior like</span> <span data-start="1149.57" data-end="1152.87">users on HTTPS sections couldn't use</span> <span data-start="1152.87" data-end="1157.82">come commenting for some reason but we</span> <span data-start="1157.82" data-end="1159.08">worked around those and they weren't</span> <span data-start="1159.08" data-end="1161.96">they weren't too severe and it's it's</span> <span data-start="1161.96" data-end="1164.299">been good to push and identify those</span> <span data-start="1164.299" data-end="1167">lace bugs I think the vol being fixed</span> <span data-start="1167" data-end="1170.539">now and another problem we had was in</span> <span data-start="1170.539" data-end="1172.88">interleaving of versions in the seed in</span> <span data-start="1172.88" data-end="1175.159">cash and I want to explain what I mean</span> <span data-start="1175.159" data-end="1176.72">by that because I think</span> <span data-start="1176.72" data-end="1178.49">other people might have this problem</span> <span data-start="1178.49" data-end="1180.409">when they when they tried to cash wings</span> <span data-start="1180.409" data-end="1183.559">in a service worker so we have a service</span> <span data-start="1183.559" data-end="1187.61">worker and that caches I've simplified</span> <span data-start="1187.61" data-end="1189.44">the example here that this cash is two</span> <span data-start="1189.44" data-end="1191.539">things it caches the offline page which</span> <span data-start="1191.539" data-end="1195.549">it's an HTML and it caches some CSS and</span> <span data-start="1195.549" data-end="1198.47">that offline page when you try to run it</span> <span data-start="1198.47" data-end="1204.44">it will try to load that CSS and if if</span> <span data-start="1204.44" data-end="1206.63">we looked at how things were cashed in</span> <span data-start="1206.63" data-end="1211.73">our CDN when you request the service</span> <span data-start="1211.73" data-end="1214.429">worker for the first time okay the CDN</span> <span data-start="1214.429" data-end="1216.62">is going to cash that we say it's going</span> <span data-start="1216.62" data-end="1219.679">to cash it for 60 seconds when you</span> <span data-start="1219.679" data-end="1221.09">request your flowing page for the first</span> <span data-start="1221.09" data-end="1223.669">time the CDM will cash that as well for</span> <span data-start="1223.669" data-end="1227.09">60 seconds in the same with the CSS but</span> <span data-start="1227.09" data-end="1230.27">because the CSS is an immutable thing we</span> <span data-start="1230.27" data-end="1235.76">can cash that for much longer but at</span> <span data-start="1235.76" data-end="1239.5">some point in time we do a deploy and</span> <span data-start="1239.5" data-end="1243.07">someone changes a service worker and</span> <span data-start="1243.07" data-end="1245.99">when you when someone makes a request</span> <span data-start="1245.99" data-end="1248.96">for that the CDM wall will cash the new</span> <span data-start="1248.96" data-end="1250.61">version if the old version has fallen</span> <span data-start="1250.61" data-end="1254.03">out of the cash and that leads to a</span> <span data-start="1254.03" data-end="1256.159">situation like this where you have the</span> <span data-start="1256.159" data-end="1258.47">new version of the service worker which</span> <span data-start="1258.47" data-end="1262.13">is telling the browser to cash the old</span> <span data-start="1262.13" data-end="1264.26">the old version of the offline page</span> <span data-start="1264.26" data-end="1266.12">because the CDN still has that version</span> <span data-start="1266.12" data-end="1270.35">and and the new version of the CSS and</span> <span data-start="1270.35" data-end="1272.57">of course when you try to run the</span> <span data-start="1272.57" data-end="1274.039">offline page because you'll get an old</span> <span data-start="1274.039" data-end="1277.13">version the CSS just won't work because</span> <span data-start="1277.13" data-end="1279.23">it will be trying to lay the version 1</span> <span data-start="1279.23" data-end="1282.409">into the version 2 is a difficult</span> <span data-start="1282.409" data-end="1288.38">situation and we could have fixed it one</span> <span data-start="1288.38" data-end="1291.37">way we could have fixed it is by naming</span> <span data-start="1291.37" data-end="1293.809">versioning the service worker and the</span> <span data-start="1293.809" data-end="1296.96">offline page but the way we actually</span> <span data-start="1296.96" data-end="1300.799">fixed it was using something I guess you</span> <span data-start="1300.799" data-end="1302.75">would call a cache manifest and so this</span> <span data-start="1302.75" data-end="1305.679">is just some Jason that has some HTML</span> <span data-start="1305.679" data-end="1308.96">for the offline page and a list of</span> <span data-start="1308.96" data-end="1310.23">assets to download</span> <span data-start="1310.23" data-end="1312.54">and because a cache manifest will will</span> <span data-start="1312.54" data-end="1314.82">be a single entry in the CD in cash you</span> <span data-start="1314.82" data-end="1316.26">can guarantee that there will be no</span> <span data-start="1316.26" data-end="1323.95">interleaving of versions so there we go</span> <span data-start="1323.96" data-end="1327.929">finally why why did I why did I do this</span> </p>
<p><span data-start="1327.929" data-end="1330.99">I mean it's fun to experiment with new</span> <span data-start="1330.99" data-end="1334.49">browser technology of course but</span> <span data-start="1334.49" data-end="1337.35">although there's insignificant usage due</span> <span data-start="1337.35" data-end="1339.419">to HTTPS and browser support right now I</span> <span data-start="1339.419" data-end="1341.04">think it's good to plant the seeds and a</span> <span data-start="1341.04" data-end="1342.84">lot of people don't realize that the</span> <span data-start="1342.84" data-end="1346.35">webcam work offline and so I think it's</span> <span data-start="1346.35" data-end="1348.809">good to start demonstrating that and</span> <span data-start="1348.809" data-end="1351.809">people will start to see the product as</span> <span data-start="1351.809" data-end="1355.59">as these things do increase in support</span> <span data-start="1355.59" data-end="1359.28">and also it's good to iron out browser</span> <span data-start="1359.28" data-end="1363.63">bugs that pushes the web for words and I</span> <span data-start="1363.63" data-end="1365.929">really like this quote by Nolan awesome</span> <span data-start="1365.929" data-end="1368.97">if we only use features that work in ie8</span> <span data-start="1368.97" data-end="1370.74">we're condemning ourselves to 98 world</span> <span data-start="1370.74" data-end="1374.429">so I think I really really would like to</span> <span data-start="1374.429" data-end="1376.2">encourage everyone to like trying new</span> <span data-start="1376.2" data-end="1379.11">service workers today because you can</span> <span data-start="1379.11" data-end="1380.37">start building really great things of</span> <span data-start="1380.37" data-end="1386.19">them so in conclusion and service</span> <span data-start="1386.19" data-end="1388.29">workers allows us to progressively</span> <span data-start="1388.29" data-end="1390.57">enhance the experience for users who are</span> <span data-start="1390.57" data-end="1392.73">offline and but also uses with poor</span> <span data-start="1392.73" data-end="1395.34">connections and its really really easy</span> <span data-start="1395.34" data-end="1398.4">to build an offline page and and it's a</span> <span data-start="1398.4" data-end="1401.549">really good place to start so go ahead</span> <span data-start="1401.549" data-end="1404.79">and have a go here is some third reading</span> </p>
<p><span data-start="1404.79" data-end="1407.88">I wrote a blog post about all of this if</span> <span data-start="1407.88" data-end="1410.91">you want to read that and there's also a</span> <span data-start="1410.91" data-end="1413.73">great explainer on service workers on</span> <span data-start="1413.73" data-end="1417.69">Alex Russell's github and you can</span> <span data-start="1417.69" data-end="1419.46">actually visit the Guardian service</span> <span data-start="1419.46" data-end="1420.63">worker if you want to take a look at</span> <span data-start="1420.63" data-end="1423.36">what code we have in there I will admit</span> <span data-start="1423.36" data-end="1425.25">it's not exactly the same as what you've</span> <span data-start="1425.25" data-end="1426.48">seen here because I've had to work</span> <span data-start="1426.48" data-end="1428.34">around browser bugs and things like that</span> <span data-start="1428.34" data-end="1433.86">and but that's life thank you very much</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
