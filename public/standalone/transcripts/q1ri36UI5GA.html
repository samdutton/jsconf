<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>q1ri36UI5GA</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/q1ri36UI5GA?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0" data-end="12.15">I have a lot of energy because I</span> <span data-start="12.15" data-end="14.969">literally have been typing into these</span> <span data-start="14.969" data-end="19.47">slides like three seconds ago so I'm</span> <span data-start="19.47" data-end="24.81">hyped about how this is gonna go so this</span> <span data-start="24.81" data-end="27.71">talk is about creating add-ons for node</span> <span data-start="27.71" data-end="30.21">how many people know what add-ons for</span> <span data-start="30.21" data-end="35.69">node are okay cool cool that's people</span> <span data-start="35.69" data-end="39.45">so essentially add-ons are the node</span> <span data-start="39.45" data-end="42.059">version of C extension so you can take C</span> <span data-start="42.059" data-end="45.149">C code C libraries and expose them as</span> <span data-start="45.149" data-end="48.57">JavaScript API is I'm kind of going out</span> <span data-start="48.57" data-end="52.41">of order here so we'll see Who am I</span> <span data-start="52.41" data-end="55.77">first of all I'm Marco Rogers very newly</span> <span data-start="55.77" data-end="58.829">minted started working at at Yammer in</span> <span data-start="58.829" data-end="62.699">San Francisco so I'm also like one of</span> <span data-start="62.699" data-end="64.26">the node guys from very early days I was</span> <span data-start="64.26" data-end="66.78">like lurking on the mailing list when it</span> <span data-start="66.78" data-end="69.119">first showed up and like you know</span> <span data-start="69.119" data-end="72.75">remember 0.133 which really kind of felt</span> <span data-start="72.75" data-end="74.34">like it was a node and that you could</span> <span data-start="74.34" data-end="76.439">use it for something useful and they</span> <span data-start="76.439" data-end="80.09">stayed three three for a long time so</span> </p>
<p><span data-start="80.09" data-end="82.47">I've been around for a while I kind of</span> <span data-start="82.47" data-end="84.96">fell into doing node add-ons it's kind</span> <span data-start="84.96" data-end="86.009">of a story but we don't have a lot of</span> <span data-start="86.009" data-end="87.33">time I have a tremendous amount of</span> <span data-start="87.33" data-end="90.299">slides and I don't even we're not gonna</span> <span data-start="90.299" data-end="91.409">make it through those because I want to</span> <span data-start="91.409" data-end="94.89">do something else too so so let's keep</span> <span data-start="94.89" data-end="96.689">it moving I'm also the maintainer of Lib</span> <span data-start="96.689" data-end="100.89">xml j s one of the biggest node add-ons</span> <span data-start="100.89" data-end="102.78">easily one of the most complex it is</span> <span data-start="102.78" data-end="107.34">bindings to lib xml — which is the giant</span> <span data-start="107.34" data-end="111.09">like you know super compliant c library</span> <span data-start="111.09" data-end="113.579">for dealing with xml and HTML people</span> <span data-start="113.579" data-end="117.329">familiar with that pretty much so okay</span> <span data-start="117.329" data-end="119.399">and just to shout out to to Jeff's make</span> <span data-start="119.399" data-end="121.32">who actually started the project I</span> <span data-start="121.32" data-end="124.86">handed her over to me at a certain point</span> <span data-start="124.86" data-end="126.57">so I'm the primary maintainer now but I</span> <span data-start="126.57" data-end="128.009">just want to I wanted to give him a</span> <span data-start="128.009" data-end="131.039">shout out real quick so let's go through</span> <span data-start="131.039" data-end="132.84">the kind of boilerplate e stuff and then</span> <span data-start="132.84" data-end="133.15">we'll</span> <span data-start="133.15" data-end="135.04">get what kind of an atom looks like and</span> <span data-start="135.04" data-end="136.299">then I really want to kind of pull up</span> <span data-start="136.299" data-end="139.18">some code and look at it because the</span> <span data-start="139.18" data-end="140.439">reason I'm doing this talk let me kind</span> <span data-start="140.439" data-end="142">of just take a segue the reason I'm</span> <span data-start="142" data-end="143.86">doing this talk is because no one else</span> <span data-start="143.86" data-end="147.909">was doing this talk and note add-ons are</span> <span data-start="147.909" data-end="149.47">actually I think stream ly important</span> <span data-start="149.47" data-end="151.15">there's not a lot of community around</span> <span data-start="151.15" data-end="153.519">them yet and we we need to make more of</span> <span data-start="153.519" data-end="155.65">them so I'm the guy that's not afraid to</span> <span data-start="155.65" data-end="156.939">stand up here and look stupid while I</span> <span data-start="156.939" data-end="159.31">talk to you about it and like because</span> <span data-start="159.31" data-end="161.23">you know I don't have all the knowledge</span> <span data-start="161.23" data-end="163.15">that I need so I need to bring you guys</span> <span data-start="163.15" data-end="164.879">in so that's what I'm trying to do right</span> <span data-start="164.879" data-end="167.65">okay so an add-on is just simply a way</span> <span data-start="167.65" data-end="170.859">to bind C C++ classes or functions into</span> </p>
<p><span data-start="170.859" data-end="173.53">JavaScript okay a better definition a</span> <span data-start="173.53" data-end="177.67">way to enable new j/s ap is based on</span> <span data-start="177.67" data-end="179.709">existing code and that's a simple</span> <span data-start="179.709" data-end="181.62">distinction but it's important because</span> <span data-start="181.62" data-end="184.87">we'll see in a little bit you can create</span> <span data-start="184.87" data-end="186.459">you can and you should create your</span> <span data-start="186.459" data-end="188.889">JavaScript API the way that you want it</span> <span data-start="188.889" data-end="190.72">to be rather than looking at the library</span> <span data-start="190.72" data-end="191.889">and say what does this do</span> <span data-start="191.889" data-end="193.72">let me map this straight into JavaScript</span> <span data-start="193.72" data-end="197.829">right and most importantly I think just</span> <span data-start="197.829" data-end="200.23">for the purposes of organization a node</span> <span data-start="200.23" data-end="202.03">add-on when you create a node add-on you</span> <span data-start="202.03" data-end="203.739">get a you get one file and it's like</span> <span data-start="203.739" data-end="205.859">something dot node that's the extension</span> <span data-start="205.859" data-end="209.98">and node sees that as a module that it's</span> <span data-start="209.98" data-end="211.72">going to require and it's gonna have</span> <span data-start="211.72" data-end="213.37">exports hanging off of it just like any</span> <span data-start="213.37" data-end="214.659">other node module that you guys are</span> <span data-start="214.659" data-end="217.06">familiar with so that's also important</span> <span data-start="217.06" data-end="221.56">and we'll come back to that okay so why</span> <span data-start="221.56" data-end="223.12">would anyone want to do this I just</span> <span data-start="223.12" data-end="224.709">thought that this was something that I</span> <span data-start="224.709" data-end="227.68">wanted to throw out there C++ code is</span> <span data-start="227.68" data-end="230.139">really fast everybody likes that writing</span> <span data-start="230.139" data-end="231.549">it makes you feel kind of like a badass</span> <span data-start="231.549" data-end="233.65">especially if you are you know just</span> <span data-start="233.65" data-end="236.199">strictly a front-end guy like having</span> <span data-start="236.199" data-end="238.06">done C since college I'm describing</span> <span data-start="238.06" data-end="240.79">myself and then I jumped into it and I</span> <span data-start="240.79" data-end="243.18">was like alright I can do this right but</span> <span data-start="243.18" data-end="247.75">it it's hard and the people who know see</span> <span data-start="247.75" data-end="250.299">here are gonna be like well you can</span> <span data-start="250.299" data-end="252.849">leave I'm sorry cuz it sucks</span> <span data-start="252.849" data-end="254.859">and it's frustrating and but it's</span> <span data-start="254.859" data-end="257.079">awesome because when you get into it</span> <span data-start="257.079" data-end="258.31">when you get back into it and you feel</span> <span data-start="258.31" data-end="261.039">you see stuff working and you run a test</span> <span data-start="261.039" data-end="264.61">of a JavaScript module versus a C module</span> <span data-start="264.61" data-end="266.38">and you get like you know</span> <span data-start="266.38" data-end="268.36">orders of magnitude speed-up you feel</span> <span data-start="268.36" data-end="271.57">like a badass right so the third point I</span> <span data-start="271.57" data-end="273.07">think is the most important which is C</span> <span data-start="273.07" data-end="277.3">in C++ code actually exists and runs and</span> <span data-start="277.3" data-end="279.46">works right now whereas we're working</span> <span data-start="279.46" data-end="281.65">with JavaScript which doesn't have any</span> <span data-start="281.65" data-end="284.35">libraries right so the reason I'm giving</span> <span data-start="284.35" data-end="285.61">this talk and the reason that you guys</span> <span data-start="285.61" data-end="288.7">keep writing writing add-ons is to make</span> <span data-start="288.7" data-end="291.1">libraries for node right instead of</span> <span data-start="291.1" data-end="292.45">writing them in JavaScript which is</span> <span data-start="292.45" data-end="295.36">really fun and really cool use the ones</span> <span data-start="295.36" data-end="297.01">that are already there and network and</span> <span data-start="297.01" data-end="297.97">our battle-tested</span> <span data-start="297.97" data-end="301.45">and they're way fast right so and</span> <span data-start="301.45" data-end="302.77">finally you can speak intelligently</span> <span data-start="302.77" data-end="305.26">about why you hate to write C and C++</span> <span data-start="305.26" data-end="310.09">which I do all the time so so for the</span> <span data-start="310.09" data-end="312.16">for the majority of these examples I'm</span> <span data-start="312.16" data-end="314.92">gonna be using bcrypt people familiar</span> <span data-start="314.92" data-end="315.55">with bcrypt</span> <span data-start="315.55" data-end="318.58">pretty much so essentially it allows you</span> <span data-start="318.58" data-end="323.23">to encrypt data using Blowfish encoding</span> <span data-start="323.23" data-end="325.48">algorithms right and it's really simple</span> <span data-start="325.48" data-end="327.19">the the the signature should be crib</span> <span data-start="327.19" data-end="328.39">kind of look like this these are the two</span> <span data-start="328.39" data-end="330.19">major functions right you can generate a</span> <span data-start="330.19" data-end="335.32">salt by passing it a number and you can</span> <span data-start="335.32" data-end="338.62">call B crypt which is going to take a</span> <span data-start="338.62" data-end="340.75">the first string which is the the thing</span> <span data-start="340.75" data-end="342.46">that you want to encrypt the second</span> <span data-start="342.46" data-end="345.34">string which is the salt the second</span> <span data-start="345.34" data-end="348.04">string which is the salt and it's gonna</span> <span data-start="348.04" data-end="349.81">return you the encrypted version I'm</span> <span data-start="349.81" data-end="352.75">using s five for slides here so it's</span> <span data-start="352.75" data-end="354.82">gonna give me crap by now quick</span> <span data-start="354.82" data-end="356.08">shout-out to Nick Campbell who's a</span> <span data-start="356.08" data-end="357.97">friend of mine I wanted to use B crypt</span> <span data-start="357.97" data-end="360.25">for one because it's pretty simple the</span> </p>
<p><span data-start="360.25" data-end="363.43">API is simple but it's also very useful</span> <span data-start="363.43" data-end="365.98">and we can focus on the add-on rather</span> <span data-start="365.98" data-end="368.14">than the library itself because this is</span> <span data-start="368.14" data-end="370.6">the signature that's it we can move on</span> <span data-start="370.6" data-end="372.37">to the next thing and talk about how</span> <span data-start="372.37" data-end="374.92">we're gonna expose it in node and also</span> <span data-start="374.92" data-end="376.15">Nick Campbell is a good friend of mine</span> <span data-start="376.15" data-end="377.92">and I'm gonna if we have time kind of</span> <span data-start="377.92" data-end="380.77">tear into his version of B crypt and how</span> <span data-start="380.77" data-end="382.78">we might be able to improve it and he'd</span> <span data-start="382.78" data-end="384.49">be good-natured about that so I thought</span> <span data-start="384.49" data-end="387.01">that was a good idea and if you want to</span> <span data-start="387.01" data-end="388.03">learn more about bcrypt</span> <span data-start="388.03" data-end="391.99">click on this link where Koda Hale who</span> <span data-start="391.99" data-end="393.58">actually also works at Yammer I thought</span> <span data-start="393.58" data-end="394.93">it'd be cool I threw his link up there</span> <span data-start="394.93" data-end="396.49">it's from like years ago before I know</span> <span data-start="396.49" data-end="397.87">who he was and that's how I learned</span> <span data-start="397.87" data-end="399.69">about bcrypt so that's cool</span> <span data-start="399.69" data-end="403.11">all right so we're gonna write an add-on</span> <span data-start="403.11" data-end="406.08">and essentially it's gonna work like</span> <span data-start="406.08" data-end="408.09">this we're gonna require bcrypt</span> <span data-start="408.09" data-end="409.86">and that's gonna be our add-on module</span> <span data-start="409.86" data-end="412.32">it's gonna have a you know a class</span> <span data-start="412.32" data-end="415.89">hanging off of it that is bcrypt we're</span> <span data-start="415.89" data-end="417.54">gonna skip the salt stuff I just have my</span> <span data-start="417.54" data-end="420.51">own salt here create a bcrypt object and</span> <span data-start="420.51" data-end="425.01">then call encrypt one function that's</span> <span data-start="425.01" data-end="425.88">not gonna work</span> <span data-start="425.88" data-end="428.52">one function you call and you get you</span> <span data-start="428.52" data-end="430.26">pass it a password you get a salt and</span> <span data-start="430.26" data-end="432.59">you're good to go right that's that's</span> <span data-start="432.59" data-end="434.85">85% of what you need out of out of this</span> <span data-start="434.85" data-end="437.76">module right so pretty simple and we</span> <span data-start="437.76" data-end="439.49">should be able to get it done</span> <span data-start="439.49" data-end="443.04">how's it work so like I said when you</span> <span data-start="443.04" data-end="444.84">create a module you when you when you</span> <span data-start="444.84" data-end="446.61">successfully get your module to compile</span> <span data-start="446.61" data-end="449.03">you're gonna get one file that says</span> <span data-start="449.03" data-end="451.71">bcrypt node or whatever you decided to</span> <span data-start="451.71" data-end="455.25">name it be crypt that node when you</span> <span data-start="455.25" data-end="458.58">require modules in node it searches</span> <span data-start="458.58" data-end="460.65">through the past it finds them and it</span> <span data-start="460.65" data-end="462.66">tries to load them up when it sees dot</span> <span data-start="462.66" data-end="464.88">node it immediately treats that as an</span> <span data-start="464.88" data-end="467.58">add-on and calls DL open if you're</span> <span data-start="467.58" data-end="469.41">jumping into C you'll find out about DL</span> <span data-start="469.41" data-end="471.63">open I'm not gonna talk about it because</span> <span data-start="471.63" data-end="475.68">it makes my head hurt and then inside</span> <span data-start="475.68" data-end="478.35">your add-on will see this there's an</span> <span data-start="478.35" data-end="480.33">init function right and that's your</span> <span data-start="480.33" data-end="482.75">entry point into C into loading up your</span> </p>
<p><span data-start="482.75" data-end="486.51">C module as an add-on and we'll see that</span> <span data-start="486.51" data-end="488.55">and it basically it essentially behaves</span> <span data-start="488.55" data-end="491.34">like a module except you get you and it</span> <span data-start="491.34" data-end="493.77">you pass in an exports object and you</span> <span data-start="493.77" data-end="495.6">enhance that exports object and pass it</span> <span data-start="495.6" data-end="497.85">back from C right so it's essentially</span> <span data-start="497.85" data-end="499.92">you you get a module like like you</span> <span data-start="499.92" data-end="502.08">expect a node with an object that has</span> <span data-start="502.08" data-end="503.76">methods and properties hanging off of it</span> <span data-start="503.76" data-end="508.74">so it should be pretty familiar C so</span> <span data-start="508.74" data-end="510.93">let's let's kind of jump kind of jump in</span> <span data-start="510.93" data-end="513.09">I want to look at some code in in a</span> <span data-start="513.09" data-end="514.62">second but I want to go through the kind</span> <span data-start="514.62" data-end="516.69">of basic stuff right so this is</span> </p>
<p><span data-start="516.69" data-end="519.78">JavaScript and it's running in v8 and</span> <span data-start="519.78" data-end="522.3">it's a simple function it says encrypt</span> <span data-start="522.3" data-end="524.43">this is bound to whatever the context is</span> <span data-start="524.43" data-end="526.68">if there is one there's some arguments</span> <span data-start="526.68" data-end="529.41">you can check the arguments object and</span> <span data-start="529.41" data-end="531.3">you can pull them out and then you</span> <span data-start="531.3" data-end="533.94">return something very simple 101 right</span> <span data-start="533.94" data-end="538.97">here's what that looks like in v8</span> <span data-start="538.98" data-end="544.88">this is C++ if every time I look at it I</span> <span data-start="544.88" data-end="547.89">try to like I have to encourage myself</span> <span data-start="547.89" data-end="551.43">to keep doing it but it looks like this</span> <span data-start="551.43" data-end="554.67">right so bcrypt here is a C++ class and</span> <span data-start="554.67" data-end="556.29">encrypt is the function that's hanging</span> <span data-start="556.29" data-end="558.42">off of it and this is the part that</span> <span data-start="558.42" data-end="560.06">looks funky right this is the this is</span> <span data-start="560.06" data-end="563.67">essentially the crux of the v8 API which</span> <span data-start="563.67" data-end="567.18">is you call C++ functions and they have</span> <span data-start="567.18" data-end="568.74">this method signature and there's this</span> <span data-start="568.74" data-end="571.26">arguments object and that's in v8 and</span> <span data-start="571.26" data-end="573.66">this is their encapsulation of what we</span> <span data-start="573.66" data-end="575.82">just saw right which is we've got this</span> <span data-start="575.82" data-end="579.18">argument object that that represents the</span> <span data-start="579.18" data-end="580.59">the variable number of arguments that</span> <span data-start="580.59" data-end="582.72">we're passing to this function and then</span> <span data-start="582.72" data-end="583.95">we do something with them and we don't</span> <span data-start="583.95" data-end="584.7">return something</span> <span data-start="584.7" data-end="589.41">so this arguments object has some some</span> <span data-start="589.41" data-end="590.67">methods off of it that let you do</span> <span data-start="590.67" data-end="593.34">essentially the same thing because of</span> <span data-start="593.34" data-end="595.47">the way C++ works and because javascript</span> <span data-start="595.47" data-end="597.3">is so dynamic and the the context is</span> <span data-start="597.3" data-end="599.55">gonna change you can't use the regular</span> </p>
<p><span data-start="599.55" data-end="603.51">C++ this so the v8 guys they hung it off</span> <span data-start="603.51" data-end="605.19">of the arguments object so that's how</span> <span data-start="605.19" data-end="607.56">you can always get to this which is a</span> <span data-start="607.56" data-end="609.18">handle and we're gonna talk about that</span> <span data-start="609.18" data-end="612.33">in a minute I'm creating the same kind</span> <span data-start="612.33" data-end="614.25">of variable here with an Argus one I</span> <span data-start="614.25" data-end="617.07">missed a step but you can check the</span> <span data-start="617.07" data-end="620.46">length you can pull arguments out of the</span> <span data-start="620.46" data-end="624.48">args object because it acts as an array</span> <span data-start="624.48" data-end="627.33">right so you can index it you have to</span> <span data-start="627.33" data-end="630.45">worry about types a lot in v8 right</span> <span data-start="630.45" data-end="633.09">JavaScript types are really simple C and</span> <span data-start="633.09" data-end="636.57">C++ types are not and that's gonna be a</span> <span data-start="636.57" data-end="637.89">big deal and that's something that I</span> <span data-start="637.89" data-end="638.97">really want to kind of get you guys</span> <span data-start="638.97" data-end="641.07">feedback on if again if we have this</span> <span data-start="641.07" data-end="645.33">time so you know you can set you set</span> <span data-start="645.33" data-end="648">some some parameters you create some</span> <span data-start="648" data-end="650.25">variable set some parameters and then</span> <span data-start="650.25" data-end="651.72">how we added these two strings together</span> <span data-start="651.72" data-end="653.79">here really simply we need to use a</span> <span data-start="653.79" data-end="655.26">function for that and C so they're</span> <span data-start="655.26" data-end="656.16">string</span> <span data-start="656.16" data-end="659.76">string ducking cat and you pass it to vh</span> <span data-start="659.76" data-end="661.53">string objects we can create a new one</span> <span data-start="661.53" data-end="663.42">on the fly and then we pass our variable</span> <span data-start="663.42" data-end="665.58">whether it's defaulted or whether it was</span> <span data-start="665.58" data-end="667.5">passed in so they make sense to</span> <span data-start="667.5" data-end="667.92">everybody</span> <span data-start="667.92" data-end="677.04">is that mapping go for it uh yes that</span> <span data-start="677.04" data-end="678.09">that's a problem that's the type of</span> <span data-start="678.09" data-end="679.8">sorry like I said three seconds ago I</span> <span data-start="679.8" data-end="682.65">was doing this yes this should be args</span> <span data-start="682.65" data-end="684.18">here is what he said</span> <span data-start="684.18" data-end="687.78">so we're gonna see real working code in</span> <span data-start="687.78" data-end="688.77">a little bit so hopefully they'll be</span> <span data-start="688.77" data-end="693.27">better let's go all right let's talk</span> <span data-start="693.27" data-end="694.71">about some concepts that we're that</span> <span data-start="694.71" data-end="697.55">we're seeing here right the type of this</span> <span data-start="697.55" data-end="701.67">variable is a handle and it should</span> <span data-start="701.67" data-end="705.27">actually have a template parameter on it</span> <span data-start="705.27" data-end="708.6">this is not a C++ tutorial so I'm not</span> <span data-start="708.6" data-end="711.36">even going to go into how that works but</span> <span data-start="711.36" data-end="712.89">you'll learn the kind of boilerplate</span> <span data-start="712.89" data-end="716.36">stuff and eventually it'll make sense</span> <span data-start="716.36" data-end="720.12">but so essentially it kind of works like</span> <span data-start="720.12" data-end="724.65">this v8 is running a JavaScript you know</span> <span data-start="724.65" data-end="727.74">environment on a heap all JavaScript</span> <span data-start="727.74" data-end="730.89">values are on a heap right so when</span> <span data-start="730.89" data-end="733.41">you're dealing with them in your C++</span> <span data-start="733.41" data-end="735.6">functions you deal with handles and</span> <span data-start="735.6" data-end="738.3">handle is a local reference to</span> </p>
<p><span data-start="738.3" data-end="740.82">JavaScript values on the heap right so</span> <span data-start="740.82" data-end="742.38">everything that you deal with that is a</span> <span data-start="742.38" data-end="743.58">javascript value is gonna go through</span> <span data-start="743.58" data-end="745.8">handles and you essentially unwrap them</span> <span data-start="745.8" data-end="747.78">to get at the C types underneath them</span> <span data-start="747.78" data-end="749.9">we'll see a little bit of that hopefully</span> <span data-start="749.9" data-end="752.22">but like I said I really want to get to</span> <span data-start="752.22" data-end="753.92">the kind of the meat of things right</span> <span data-start="753.92" data-end="756.48">this is kind of what I exactly what I</span> <span data-start="756.48" data-end="758.46">just said about handles you need to</span> <span data-start="758.46" data-end="759.81">unwrap handles to get to the data</span> <span data-start="759.81" data-end="761.97">there's also handle scopes the reason</span> <span data-start="761.97" data-end="763.89">that v8 went with this and if you know</span> <span data-start="763.89" data-end="765.87">anything about SpiderMonkey they don't</span> <span data-start="765.87" data-end="767.52">have any kind of concept like this</span> <span data-start="767.52" data-end="770.04">the reason v8 went with this is that</span> <span data-start="770.04" data-end="772.76">they want to make it easy for you to</span> <span data-start="772.76" data-end="775.11">clean up your references so that they</span> <span data-start="775.11" data-end="777.45">don't leak and the way that they do that</span> <span data-start="777.45" data-end="779.13">is to have everything in a handle and a</span> <span data-start="779.13" data-end="781.89">handle is a handle make sure that you're</span> <span data-start="781.89" data-end="785.28">going through the right you know I mean</span> <span data-start="785.28" data-end="787.02">it's a name named appropriately it's a</span> <span data-start="787.02" data-end="788.67">handle to whatever you're dealing with</span> <span data-start="788.67" data-end="789.39">and you always</span> <span data-start="789.39" data-end="791.13">through the handle and they can track</span> <span data-start="791.13" data-end="793.5">handles and the way that they do that is</span> <span data-start="793.5" data-end="795.99">through this handle scope object you</span> <span data-start="795.99" data-end="797.82">create a handle scope and every time you</span> <span data-start="797.82" data-end="800.52">get a handle this object is gonna track</span> <span data-start="800.52" data-end="802.17">it and when it goes out of scope by</span> <span data-start="802.17" data-end="803.61">popping off you know pot this function</span> <span data-start="803.61" data-end="805.23">pops off the stack it's gonna clean out</span> <span data-start="805.23" data-end="807.12">all those handles right so it keeps you</span> <span data-start="807.12" data-end="809.4">from having a lot of memory leaks it</span> <span data-start="809.4" data-end="812.58">also creates a lot of headaches and will</span> <span data-start="812.58" data-end="813.93">maybe talk about that in a little bit</span> <span data-start="813.93" data-end="816.69">right if I'm going too fast please let</span> <span data-start="816.69" data-end="818.01">me know but you know I really want to</span> <span data-start="818.01" data-end="819.57">kind of blaze and then see if we can see</span> <span data-start="819.57" data-end="822.27">some code right there's two types of</span> <span data-start="822.27" data-end="824.61">handles there's local handles which like</span> </p>
<p><span data-start="824.61" data-end="826.02">I said are really important for cleaning</span> <span data-start="826.02" data-end="828.06">up your temporary objects that you're</span> <span data-start="828.06" data-end="829.86">dealing with in JavaScript</span> <span data-start="829.86" data-end="833.82">those get collected as usual by you know</span> <span data-start="833.82" data-end="837.27">by a a sea stack popping off and then</span> <span data-start="837.27" data-end="838.89">there are persistent handles because you</span> <span data-start="838.89" data-end="841.08">want to you want to have you know when</span> <span data-start="841.08" data-end="843">you get to your final destination of</span> <span data-start="843" data-end="845.31">your you know your return value you want</span> <span data-start="845.31" data-end="847.41">to have that persist so it can go back</span> <span data-start="847.41" data-end="849.39">into the JavaScript environment and</span> <span data-start="849.39" data-end="851.4">doesn't get collected right because it's</span> <span data-start="851.4" data-end="853.11">it's gonna get collected unless there is</span> <span data-start="853.11" data-end="856.14">a JavaScript reference to it so you need</span> <span data-start="856.14" data-end="857.64">to use persistent handles to make sure</span> <span data-start="857.64" data-end="860.16">that you know if you're dealing with</span> <span data-start="860.16" data-end="862.38">stuff in JavaScript you jump into C++</span> <span data-start="862.38" data-end="864.66">land and start doing something meanwhile</span> <span data-start="864.66" data-end="867.36">the v8 garbage collector decides to run</span> <span data-start="867.36" data-end="868.77">and it says oh you're not using this</span> </p>
<p><span data-start="868.77" data-end="870.72">I'll just clean it up then you're effed</span> <span data-start="870.72" data-end="874.41">right you're kind of screwed so all</span> <span data-start="874.41" data-end="877.53">right so the way that you deal with that</span> <span data-start="877.53" data-end="882.03">handle scopes and handles is like this</span> <span data-start="882.03" data-end="884.97">and this this slide may made more sense</span> <span data-start="884.97" data-end="887.7">earlier but you create a handle scope by</span> <span data-start="887.7" data-end="889.5">just you know doing a local</span> <span data-start="889.5" data-end="891.57">initialization of it and as soon as you</span> <span data-start="891.57" data-end="893.16">do this this is the only line that you</span> <span data-start="893.16" data-end="895.29">need your tracking handles within this</span> <span data-start="895.29" data-end="897.51">function right every handle you create</span> <span data-start="897.51" data-end="899.64">within this function is gonna get</span> <span data-start="899.64" data-end="900.96">tracked and it's gonna get cleaned up</span> <span data-start="900.96" data-end="904.23">when the function ends so this is</span> <span data-start="904.23" data-end="906.72">actually the way this worked out is kind</span> <span data-start="906.72" data-end="908.57">of a patch file because what I had</span> <span data-start="908.57" data-end="911.28">before I before I knew better what I had</span> <span data-start="911.28" data-end="913.47">was just okay I'm just gonna return a v8</span> <span data-start="913.47" data-end="915.33">array right like so created new arrays</span> <span data-start="915.33" data-end="917.55">basically like the empty brackets that</span> <span data-start="917.55" data-end="918.84">we all know from JavaScript and return</span> <span data-start="918.84" data-end="921.99">it and it was working fine 80% of the</span> <span data-start="921.99" data-end="923.55">time until the garbage collector</span> <span data-start="923.55" data-end="925.529">got to it and then it was gone and I was</span> </p>
<p><span data-start="925.529" data-end="927.54">SEC faulting right so that's what</span> <span data-start="927.54" data-end="929.279">happens like it's gonna let you drag</span> <span data-start="929.279" data-end="931.26">these handles around all the time until</span> <span data-start="931.26" data-end="934.019">you try to use them and the data</span> <span data-start="934.019" data-end="936.12">underneath has been collected and it</span> <span data-start="936.12" data-end="938.37">craps out that's what happens so what</span> <span data-start="938.37" data-end="940.29">you have to do is create scopes make</span> <span data-start="940.29" data-end="941.76">sure things get cleaned up and then you</span> <span data-start="941.76" data-end="944.91">have to close the scope it's miss named</span> </p>
<p><span data-start="944.91" data-end="947.54">I think but essentially what it means is</span> <span data-start="947.54" data-end="950.1">this is a local handle but I'm gonna</span> <span data-start="950.1" data-end="952.05">pass it to the calling scope because I</span> <span data-start="952.05" data-end="954.63">know that it's my return value right so</span> <span data-start="954.63" data-end="956.82">you take this scope and you say okay for</span> <span data-start="956.82" data-end="958.529">this handle I know you have it tracked</span> <span data-start="958.529" data-end="960.079">and you're gonna try to screw me on this</span> <span data-start="960.079" data-end="963.39">close it pass it back right so this is</span> <span data-start="963.39" data-end="964.649">very important there are a lot of</span> <span data-start="964.649" data-end="967.86">patches in live XML Jas just doing this</span> <span data-start="967.86" data-end="969.839">right and if you forget it you will have</span> <span data-start="969.839" data-end="974.73">problems so okay next kind of concept I</span> <span data-start="974.73" data-end="977.82">want to talk about really quick is how</span> <span data-start="977.82" data-end="981.36">do you deal with objects right you you</span> <span data-start="981.36" data-end="983.13">have your C library it might be a C++</span> <span data-start="983.13" data-end="986.04">library and they have classes and you're</span> <span data-start="986.04" data-end="987.75">going to want to hang some state off of</span> <span data-start="987.75" data-end="989.13">those classes and you're gonna get to</span> <span data-start="989.13" data-end="990.66">them when you when your extension calls</span> <span data-start="990.66" data-end="992.85">your C methods right the way that you do</span> <span data-start="992.85" data-end="995.88">that or at least the the node way that</span> <span data-start="995.88" data-end="998.459">we're providing to do that is through</span> <span data-start="998.459" data-end="1002.6">node object wrap and you know to kind of</span> <span data-start="1002.6" data-end="1005.18">keep things simple all this does is take</span> <span data-start="1005.18" data-end="1008.779">a C++ class and wrap it in a v8 handle</span> <span data-start="1008.779" data-end="1011.42">right so you can pass that handle around</span> <span data-start="1011.42" data-end="1013.279">and it'll act like an object when it's</span> <span data-start="1013.279" data-end="1015.709">in jeaious jeaious land when you call</span> <span data-start="1015.709" data-end="1017.69">and when you call into a c function you</span> <span data-start="1017.69" data-end="1019.25">take that handle and you unwrap it and</span> <span data-start="1019.25" data-end="1021.62">you get your C++ object back it's really</span> <span data-start="1021.62" data-end="1024.589">convenient it there's there's a lot of</span> <span data-start="1024.589" data-end="1027.829">like tricky C magic going on in there if</span> <span data-start="1027.829" data-end="1029.54">you're if you're not faint of heart jump</span> <span data-start="1029.54" data-end="1031.669">in there and take a look but it's it's</span> <span data-start="1031.669" data-end="1033.679">it's grimy so just you know do what it</span> <span data-start="1033.679" data-end="1035.9">says so</span> <span data-start="1035.9" data-end="1038.089">all right and I mean basically it has</span> <span data-start="1038.089" data-end="1039.169">two functions on it right</span> <span data-start="1039.169" data-end="1042.559">it has rap and has unwrapped so object</span> <span data-start="1042.559" data-end="1043.939">wrapped out unwrapped basically is gonna</span> <span data-start="1043.939" data-end="1046.37">take this the this the this context</span> <span data-start="1046.37" data-end="1047.72">that's coming in with this function and</span> <span data-start="1047.72" data-end="1051.08">that's a v8 handle write unwrap says</span> <span data-start="1051.08" data-end="1055.1">okay unwrap this and give me back my C++</span> <span data-start="1055.1" data-end="1056.94">object which is a B crypt and again</span> <span data-start="1056.94" data-end="1059.16">and I've left the template ization off</span> <span data-start="1059.16" data-end="1061.29">of here you have to tell it what you're</span> <span data-start="1061.29" data-end="1062.97">in right unwrapping and we'll see that</span> <span data-start="1062.97" data-end="1065.61">in real code in a little bit but as soon</span> <span data-start="1065.61" data-end="1067.11">as you do this you're you're back in</span> </p>
<p><span data-start="1067.11" data-end="1069.09">Sealand and you can do whatever you want</span> <span data-start="1069.09" data-end="1071.01">with this corner — you'd be crypt object</span> <span data-start="1071.01" data-end="1074.31">so alright there are a lot of classes</span> <span data-start="1074.31" data-end="1076.38">and utilities that node gives you to be</span> <span data-start="1076.38" data-end="1080.01">able to approximate what you expect a</span> <span data-start="1080.01" data-end="1084.54">node in the C in C and C++ land things</span> <span data-start="1084.54" data-end="1086.64">like event emitters are there so you can</span> <span data-start="1086.64" data-end="1088.41">subclass an event emitter on your C++</span> <span data-start="1088.41" data-end="1090.06">class and make it act like an event</span> <span data-start="1090.06" data-end="1092.49">emitter and and see you're calling emit</span> <span data-start="1092.49" data-end="1094.5">and you're giving it you know the the</span> <span data-start="1094.5" data-end="1097.44">name clothes and the callback thing is a</span> <span data-start="1097.44" data-end="1099.72">little a little a little different</span> <span data-start="1099.72" data-end="1101.43">that's on the other side of emit but</span> <span data-start="1101.43" data-end="1103.23">we're not gonna get to that because</span> <span data-start="1103.23" data-end="1105.33">there's a lot and we only have have a</span> <span data-start="1105.33" data-end="1106.98">half-hour and I'm already about 20</span> <span data-start="1106.98" data-end="1110.13">minutes in so but on the other side this</span> <span data-start="1110.13" data-end="1111.99">is JavaScript and I didn't you know I</span> <span data-start="1111.99" data-end="1115.22">didn't these slides are super new so</span> <span data-start="1115.22" data-end="1117.87">this is a new connection in JavaScript</span> <span data-start="1117.87" data-end="1120">this represents your connection in C++</span> <span data-start="1120" data-end="1121.92">class you're making a new one and you're</span> <span data-start="1121.92" data-end="1123.24">treating it just like an event emitter</span> <span data-start="1123.24" data-end="1125.61">right so it's gonna go through C code</span> <span data-start="1125.61" data-end="1126.96">it's gonna admit whatever you want it to</span> <span data-start="1126.96" data-end="1129.6">admit and it behaved when once it comes</span> <span data-start="1129.6" data-end="1131.34">out of the module it behaves like node</span> <span data-start="1131.34" data-end="1134.64">and it's awesome right so if you if you</span> <span data-start="1134.64" data-end="1137.01">learn the the kind of paradigms and the</span> <span data-start="1137.01" data-end="1139.71">the techniques to you know write your</span> <span data-start="1139.71" data-end="1141.48">modules such that they behave like node</span> <span data-start="1141.48" data-end="1143.73">you're white right way better add-ons</span> <span data-start="1143.73" data-end="1146.85">and people will be really happy there's</span> <span data-start="1146.85" data-end="1148.53">lots of other stuff I'm gonna start like</span> <span data-start="1148.53" data-end="1150.12">breeze in just a little bit like yeah</span> <span data-start="1150.12" data-end="1151.38">okay I'm so I'm a thing and there's lots</span> <span data-start="1151.38" data-end="1152.94">to cover here I didn't go through</span> <span data-start="1152.94" data-end="1155.04">throwing exceptions right you need to do</span> <span data-start="1155.04" data-end="1158.67">that object wrap also has a ref you know</span> <span data-start="1158.67" data-end="1161.7">it's kind of a reference counting thing</span> <span data-start="1161.7" data-end="1163.59">where you can when you have to do a</span> <span data-start="1163.59" data-end="1165.06">synchronous actions and you're</span> <span data-start="1165.06" data-end="1168.27">essentially off of the v8 thread to keep</span> <span data-start="1168.27" data-end="1170.85">your to keep your to keep the garbage</span> <span data-start="1170.85" data-end="1173.61">collector from collecting your your</span> <span data-start="1173.61" data-end="1175.32">objects like it's supposed to do you</span> <span data-start="1175.32" data-end="1176.67">have to tell it that it's referenced and</span> <span data-start="1176.67" data-end="1178.44">ref is the way that you do that there's</span> <span data-start="1178.44" data-end="1180.36">code around that to I really want to</span> <span data-start="1180.36" data-end="1182.37">just point you guys at a lot of examples</span> <span data-start="1182.37" data-end="1184.62">and have you kind of go in refer to</span> <span data-start="1184.62" data-end="1186.12">these slides and maybe it'll make more</span> <span data-start="1186.12" data-end="1188.57">sense but half hour so let's keep going</span> <span data-start="1188.57" data-end="1190.81">signatures are the way that you</span> <span data-start="1190.81" data-end="1193.93">make sure that the object that you're</span> <span data-start="1193.93" data-end="1196.42">calling methods on goes with your module</span> <span data-start="1196.42" data-end="1198.85">right because there's a disconnect</span> <span data-start="1198.85" data-end="1201.85">between the C++ classes and the</span> <span data-start="1201.85" data-end="1203.62">functions because javascript is so</span> <span data-start="1203.62" data-end="1205.72">dynamic I could I can take you know a</span> <span data-start="1205.72" data-end="1207.46">function and detach it from this object</span> <span data-start="1207.46" data-end="1209.71">and call it right and JavaScript is not</span> <span data-start="1209.71" data-end="1211.84">gonna know that it goes with that that</span> <span data-start="1211.84" data-end="1214.42">object because there's a C++ class under</span> <span data-start="1214.42" data-end="1215.95">it and if I try to reference it it's</span> <span data-start="1215.95" data-end="1217.96">gonna crash doesn't know that so there's</span> <span data-start="1217.96" data-end="1219.88">so signatures are really important also</span> <span data-start="1219.88" data-end="1223.06">but the thing is you can get really far</span> <span data-start="1223.06" data-end="1225.76">without doing any of this stuff and you</span> <span data-start="1225.76" data-end="1227.2">feel awesome about it and it's working</span> <span data-start="1227.2" data-end="1229.45">until it doesn't and so you have to</span> <span data-start="1229.45" data-end="1232.42">start finding all of these techniques to</span> <span data-start="1232.42" data-end="1234.58">to shore up your code and make it more</span> <span data-start="1234.58" data-end="1236.23">robust so I'm throwing this stuff in</span> <span data-start="1236.23" data-end="1236.65">here</span> <span data-start="1236.65" data-end="1239.47">but as you guys dig in like you know I'm</span> <span data-start="1239.47" data-end="1240.49">trying to get the conversation started</span> <span data-start="1240.49" data-end="1242.11">here so I know about this stuff when you</span> <span data-start="1242.11" data-end="1243.7">run into it like please let's starts</span> <span data-start="1243.7" data-end="1245.08">talking about it</span> <span data-start="1245.08" data-end="1248.71">so all right there's lots more slides</span> <span data-start="1248.71" data-end="1250.9">but let's let's stop and kind of look at</span> <span data-start="1250.9" data-end="1251.95">some code here and see if we can get</span> <span data-start="1251.95" data-end="1254.8">through at least a little bit right all</span> <span data-start="1254.8" data-end="1258.31">right so I've got I've got bcrypt here</span> <span data-start="1258.31" data-end="1259.96">right</span> <span data-start="1259.96" data-end="1262.5">there's several files here there is</span> <span data-start="1262.5" data-end="1265.15">there's a there's a dot H file which is</span> <span data-start="1265.15" data-end="1268.21">the headers for Blowfish and bcrypt</span> <span data-start="1268.21" data-end="1271.27">there's bcrypt CC which is the actual</span> <span data-start="1271.27" data-end="1273.1">implementation of bcrypt it has those</span> <span data-start="1273.1" data-end="1275.26">two that gin salt and that encrypt</span> <span data-start="1275.26" data-end="1276.91">function and see that I showed before</span> <span data-start="1276.91" data-end="1283.6">and there's Blowfish here so this is the</span> <span data-start="1283.6" data-end="1287.23">that's the the best extent of the C</span> <span data-start="1287.23" data-end="1289.72">library that's it right and then these</span> <span data-start="1289.72" data-end="1293.2">two files are your node add-on so these</span> <span data-start="1293.2" data-end="1295.27">five files if you put the right things</span> <span data-start="1295.27" data-end="1297.34">in them you get this little module that</span> <span data-start="1297.34" data-end="1299.2">will do B crypt for you and I think</span> <span data-start="1299.2" data-end="1299.95">that's really cool</span> <span data-start="1299.95" data-end="1303.46">so let's see how far I can get hang on</span> <span data-start="1303.46" data-end="1313.88">just a second</span> <span data-start="1313.89" data-end="1317.58">hello can hear alright cool cool uh</span> <span data-start="1317.58" data-end="1320.11">those are my slides let's get rid of</span> <span data-start="1320.11" data-end="1324.76">those this is Emacs oh god help me if I</span> <span data-start="1324.76" data-end="1328.57">can't get through this but yeah I'm</span> <span data-start="1328.57" data-end="1330.88">gonna blow them up um let me just find</span> <span data-start="1330.88" data-end="1336.4">what I need first let's look at the H</span> <span data-start="1336.4" data-end="1341.85">file which I don't have open this week</span> <span data-start="1341.85" data-end="1346.08">alright so source the Crypt node H</span> <span data-start="1346.08" data-end="1348.22">alright so here's our here's our header</span> <span data-start="1348.22" data-end="1349.57">file right here's what we want our</span> <span data-start="1349.57" data-end="1352.15">module to do it's gonna have a class</span> <span data-start="1352.15" data-end="1355.21">it's gonna be called bcrypt oh yeah</span> <span data-start="1355.21" data-end="1364.36">sorry there we go yeah all right I do I</span> <span data-start="1364.36" data-end="1365.92">do use Emacs I don't have to blow it up</span> <span data-start="1365.92" data-end="1371.47">very often so so here we go you've got</span> <span data-start="1371.47" data-end="1374.05">your bcrypt object and you've got uu</span> <span data-start="1374.05" data-end="1376.24">subclassing object wraps so that it will</span> <span data-start="1376.24" data-end="1378.64">behave sanely when you want it to stick</span> <span data-start="1378.64" data-end="1381.19">around right and there's there's three</span> <span data-start="1381.19" data-end="1382.78">there's three functions here right</span> <span data-start="1382.78" data-end="1385.15">there's there's a static version of</span> <span data-start="1385.15" data-end="1386.56">initialize which we'll see in just a</span> <span data-start="1386.56" data-end="1388.14">second that's how you're going to</span> <span data-start="1388.14" data-end="1390.97">essentially initialize your module and</span> <span data-start="1390.97" data-end="1393.99">populate it with methods there's a new</span> <span data-start="1393.99" data-end="1396.73">function which is your constructor for</span> <span data-start="1396.73" data-end="1398.92">this bcrypt object and javascript when</span> <span data-start="1398.92" data-end="1400.81">you call new bcrypt it's gonna call this</span> <span data-start="1400.81" data-end="1403.21">new function okay and there's encrypt</span> <span data-start="1403.21" data-end="1406.78">which is the the v8 version of this</span> <span data-start="1406.78" data-end="1408.34">encrypt function that you're gonna call</span> <span data-start="1408.34" data-end="1409.93">so these are if you remember the slides</span> <span data-start="1409.93" data-end="1411.82">that's the extent of what this module</span> <span data-start="1411.82" data-end="1414.55">does you get an object create one called</span> <span data-start="1414.55" data-end="1417.19">encrypt that's it right so this is the</span> <span data-start="1417.19" data-end="1420.96">extent of what we need for this now</span> <span data-start="1420.96" data-end="1428.88">let's look at the C file</span> <span data-start="1428.89" data-end="1432.11">okay I'm gonna I'm gonna go pretty fast</span> <span data-start="1432.11" data-end="1435.53">there's not a lot to look at here oh if</span> <span data-start="1435.53" data-end="1443.41">this is the wrong file sorry all right</span> <span data-start="1443.42" data-end="1445.94">here's what the C code looks like couple</span> <span data-start="1445.94" data-end="1448.73">headers don't worry about that using</span> <span data-start="1448.73" data-end="1450.53">namespace so you don't have to type v8</span> <span data-start="1450.53" data-end="1452.66">colon colon everywhere note colon colon</span> <span data-start="1452.66" data-end="1453.26">everywhere</span> <span data-start="1453.26" data-end="1455.179">here's your initialize function let me</span> <span data-start="1455.179" data-end="1456.44">start let me start with an it actually</span> <span data-start="1456.44" data-end="1459.35">here's an it way at the bottom it has an</span> <span data-start="1459.35" data-end="1462.74">extern it's called it in it and it gets</span> <span data-start="1462.74" data-end="1464.51">a handle object which is your target</span> <span data-start="1464.51" data-end="1468.38">this maps directly to module dot exports</span> <span data-start="1468.38" data-end="1470.66">it's the it's the JavaScript version of</span> <span data-start="1470.66" data-end="1472.76">that or is the C++ version of that so</span> <span data-start="1472.76" data-end="1474.26">we're gonna hang methods off of here and</span> <span data-start="1474.26" data-end="1476.54">when you do require bcrypt this is the</span> <span data-start="1476.54" data-end="1478.13">object that you're going to get and all</span> <span data-start="1478.13" data-end="1479.6">we do in this init function like I said</span> <span data-start="1479.6" data-end="1481.429">this is just a portal in is we</span> <span data-start="1481.429" data-end="1483.41">initialize it by passing it in to</span> <span data-start="1483.41" data-end="1486.86">initialize right here's where we get in</span> <span data-start="1486.86" data-end="1490.76">this — v8 I'm you know I can't do too</span> <span data-start="1490.76" data-end="1492.11">much to explain this because I have five</span> <span data-start="1492.11" data-end="1494.96">minutes but here the here are the things</span> <span data-start="1494.96" data-end="1496.1">that are happening here right we're</span> <span data-start="1496.1" data-end="1497.929">making a function template and what this</span> <span data-start="1497.929" data-end="1499.49">says is we're making a new function</span> <span data-start="1499.49" data-end="1501.559">template and what we're passing it in is</span> <span data-start="1501.559" data-end="1505.429">our function new that's this we're</span> <span data-start="1505.429" data-end="1506.9">telling it we're making a new JavaScript</span> <span data-start="1506.9" data-end="1508.34">function template that's going to be</span> <span data-start="1508.34" data-end="1511.46">mapped directly to this c++ new function</span> <span data-start="1511.46" data-end="1514.669">okay so when we when we call new bcrypt</span> <span data-start="1514.669" data-end="1517.28">it's going to call this we have to do</span> <span data-start="1517.28" data-end="1519.02">some some v8 stuff like set some</span> <span data-start="1519.02" data-end="1521.11">internal fields you'll learn about that</span> <span data-start="1521.11" data-end="1523.58">there's some other this is our Jen salt</span> <span data-start="1523.58" data-end="1526.64">function which I commented out and note</span> <span data-start="1526.64" data-end="1529.19">set prototype method is a one of those</span> <span data-start="1529.19" data-end="1532.64">handy macros that node gives you to do</span> <span data-start="1532.64" data-end="1535.13">these types of things easily so it's</span> <span data-start="1535.13" data-end="1536.96">going to take our function template it's</span> <span data-start="1536.96" data-end="1538.22">going to create a new property call</span> <span data-start="1538.22" data-end="1540.23">encrypt and encrypt is going to match</span> <span data-start="1540.23" data-end="1542.84">map directly to our encrypt function</span> <span data-start="1542.84" data-end="1543.98">that we're going to look at in just a</span> <span data-start="1543.98" data-end="1546.049">second so when you call encrypt on this</span> <span data-start="1546.049" data-end="1548.57">object it's going to map to this C++</span> <span data-start="1548.57" data-end="1551.66">function so so there's that and then</span> <span data-start="1551.66" data-end="1554.15">finally so what we have now what we have</span> <span data-start="1554.15" data-end="1554.97">now is</span> <span data-start="1554.97" data-end="1558.33">a new a new constructor essentially</span> <span data-start="1558.33" data-end="1559.679">right when we do new bcrypt</span> <span data-start="1559.679" data-end="1561.09">that's this this is a function template</span> <span data-start="1561.09" data-end="1565.53">right we've mapped it to encrypt so</span> <span data-start="1565.53" data-end="1566.94">we've got a function called encrypt and</span> <span data-start="1566.94" data-end="1570.299">then what we what we're creating now is</span> <span data-start="1570.299" data-end="1572.429">a new symbol called bcrypt</span> <span data-start="1572.429" data-end="1575.7">mapping it to our constructor and then</span> <span data-start="1575.7" data-end="1576.299">we're good to go</span> <span data-start="1576.299" data-end="1578.13">we've got our constructor here we've got</span> <span data-start="1578.13" data-end="1579.299">our encrypt function here</span> <span data-start="1579.299" data-end="1580.95">we hooked them up and then we've</span> <span data-start="1580.95" data-end="1582.9">attached that off of this target target</span> <span data-start="1582.9" data-end="1586.32">that set B Cribs get function cool</span> <span data-start="1586.32" data-end="1590.33">pretty much sweet all right</span> <span data-start="1590.33" data-end="1595.44">so new is really simple we create our</span> <span data-start="1595.44" data-end="1598.46">handle scope we always need those we</span> <span data-start="1598.46" data-end="1603.27">create a new bcrypt C++ object and then</span> <span data-start="1603.27" data-end="1605.52">we wrap it so this is a function that</span> <span data-start="1605.52" data-end="1607.47">comes off of object wrap and it says</span> <span data-start="1607.47" data-end="1611.07">take the C++ function and wrap this</span> <span data-start="1611.07" data-end="1613.14">handle around it and the handle that we</span> <span data-start="1613.14" data-end="1616.34">want is the context of this new function</span> <span data-start="1616.34" data-end="1619.35">okay so our thought this is going to</span> <span data-start="1619.35" data-end="1620.789">return our handle we're gonna pass it</span> <span data-start="1620.789" data-end="1622.47">into wrap and now we have a JavaScript</span> <span data-start="1622.47" data-end="1625.02">handle with our C object underneath and</span> <span data-start="1625.02" data-end="1626.76">they're gonna go together until they get</span> <span data-start="1626.76" data-end="1630.179">collected okay and then we return our</span> <span data-start="1630.179" data-end="1632.49">object you have to do this in you don't</span> <span data-start="1632.49" data-end="1634.32">have to do this explicitly in JavaScript</span> <span data-start="1634.32" data-end="1637.919">you have to do this in C++ to return</span> <span data-start="1637.919" data-end="1639.799">your object when you do constructors</span> <span data-start="1639.799" data-end="1642.179">encrypt this is the meat of it this is</span> <span data-start="1642.179" data-end="1644.159">the only thing that this this module</span> <span data-start="1644.159" data-end="1648.99">does handle scope unwrap our bcrypt</span> <span data-start="1648.99" data-end="1650.94">object because this we're calling bcrypt</span> <span data-start="1650.94" data-end="1654.78">dot encrypt unwrap it by calling unwrap</span> <span data-start="1654.78" data-end="1656.28">and we got we have to tell it it's a</span> <span data-start="1656.28" data-end="1658.89">bcrypt object right you've seen this now</span> <span data-start="1658.89" data-end="1660.96">we have our c++ object now we're gonna</span> <span data-start="1660.96" data-end="1663.12">pull the arguments out the first one is</span> <span data-start="1663.12" data-end="1666.09">our password second one is our salt all</span> <span data-start="1666.09" data-end="1670.02">of this is dealing with c conversion</span> <span data-start="1670.02" data-end="1673.2">from j s to C types all of this okay</span> <span data-start="1673.2" data-end="1675.6">turn it into a string because it's of</span> <span data-start="1675.6" data-end="1678.48">type handle value value is the highest</span> <span data-start="1678.48" data-end="1679.98">you know the highest level in the</span> <span data-start="1679.98" data-end="1682.53">hierarchy of values and v8 so it's a</span> <span data-start="1682.53" data-end="1684.21">value turn it into a string we know it's</span> <span data-start="1684.21" data-end="1686.149">a string because we're you know</span> <span data-start="1686.149" data-end="1689.119">we built this and we're writing the code</span> <span data-start="1689.119" data-end="1691.729">for it if you don't know what it is this</span> <span data-start="1691.729" data-end="1694.419">gets way harder but we know what it is</span> <span data-start="1694.419" data-end="1697.549">do data and you salt I'm turning into</span> <span data-start="1697.549" data-end="1700.159">utf-8 values and then I'm pulling those</span> <span data-start="1700.159" data-end="1702.859">out into char stars you have to go</span> <span data-start="1702.859" data-end="1704.659">through these steps usually right you</span> <span data-start="1704.659" data-end="1705.859">can write a macro around it but</span> <span data-start="1705.859" data-end="1707.839">essentially we went from JavaScript</span> <span data-start="1707.839" data-end="1711.289">strings to be a to C char stars now we</span> <span data-start="1711.289" data-end="1713.439">have we have our data right and then</span> <span data-start="1713.439" data-end="1716.389">this is the library call B Krypton those</span> <span data-start="1716.389" data-end="1718.359">two things and get back a char star</span> <span data-start="1718.359" data-end="1721.669">sorry um so I think the rest of this</span> <span data-start="1721.669" data-end="1723.229">makes a lot of sense right we're</span> <span data-start="1723.229" data-end="1725.239">creating a new string with our new b</span> <span data-start="1725.239" data-end="1728.299">cryptid value and we're returning it</span> <span data-start="1728.299" data-end="1731.359">that's it like you just you just created</span> <span data-start="1731.359" data-end="1733.939">a module right I didn't get to how to</span> <span data-start="1733.939" data-end="1736.489">build this and I don't think that's bad</span> <span data-start="1736.489" data-end="1740.659">because that part sucks but definitely</span> <span data-start="1740.659" data-end="1742.159">come talk to me let's look at this stuff</span> </p>
<p><span data-start="1742.159" data-end="1744.049">I'm gonna post all the slides which have</span> <span data-start="1744.049" data-end="1745.819">way more information about all the stuff</span> <span data-start="1745.819" data-end="1748.909">that I did not get to but if do we have</span> <span data-start="1748.909" data-end="1751.939">any time for questions at all what's</span> <span data-start="1751.939" data-end="1759.769">that oh yes it is going to be at it is</span> <span data-start="1759.769" data-end="1764.119">not up yet it is going to be at it is</span> <span data-start="1764.119" data-end="1767.399">going to be on github yes</span> <span data-start="1767.409" data-end="1769.669">it's in one of these slides where it</span> <span data-start="1769.669" data-end="1771.259">will be the repositories there is just</span> <span data-start="1771.259" data-end="1773.899">empty I'm gonna put the slides up what's</span> <span data-start="1773.899" data-end="1774.729">that</span> <span data-start="1774.729" data-end="1778.549">polo tech it's on the first slide that's</span> <span data-start="1778.549" data-end="1781.609">me everywhere Twitter github IRC</span> <span data-start="1781.609" data-end="1784.609">whatever so come talk to me we need to</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
