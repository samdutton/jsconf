<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>vR_fuZDwlZI</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/vR_fuZDwlZI?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="21.63" data-end="25.16">you</span> <span data-start="25.17" data-end="27.33">so again my name is Christopher I work</span> <span data-start="27.33" data-end="29.76">for ThoughtWorks I do a lot of stuff</span> <span data-start="29.76" data-end="34.83">also fronted stuff besides from from</span> <span data-start="34.83" data-end="36.96">hacking and I like hacking I like</span> <span data-start="36.96" data-end="40.26">building stuff I like languages but</span> <span data-start="40.26" data-end="42.48">today I like to talk about something</span> <span data-start="42.48" data-end="44.1">that has been interesting me for the</span> <span data-start="44.1" data-end="48.83">last year I call it a panoramic tour</span> <span data-start="48.83" data-end="51.71">through html5 rendering itself today and</span> <span data-start="51.71" data-end="54.78">it seems that engineering carefully</span> <span data-start="54.78" data-end="56.28">engineering the title kind of helped</span> <span data-start="56.28" data-end="58.65">because a lot of guys here today that's</span> <span data-start="58.65" data-end="59.99">good</span> <span data-start="59.99" data-end="62.94">but what is this about today what do I</span> <span data-start="62.94" data-end="67.2">want to talk about so in the next three</span> <span data-start="67.2" data-end="70.11">minutes I'd like to misuse a few browser</span> <span data-start="70.11" data-end="74.7">features some of those new I and that so</span> <span data-start="74.7" data-end="76.649">to make it fit in J's Kampf we use a lot</span> <span data-start="76.649" data-end="79.11">of JavaScript to play around with SVG</span> </p>
<p><span data-start="79.11" data-end="82.59">HTML CSS DOM and not sure if you heard</span> <span data-start="82.59" data-end="85.38">from that before the CSS object model</span> <span data-start="85.38" data-end="90.12">I do claim that we go boldly go where no</span> <span data-start="90.12" data-end="91.71">man or woman has gone before</span> <span data-start="91.71" data-end="95.37">let's see if I can hold up to this and I</span> <span data-start="95.37" data-end="96.59">hope that we have some fun on the way</span> <span data-start="96.59" data-end="100.68">because it's not as much about the young</span> <span data-start="100.68" data-end="102.6">product it's more about the way to how</span> <span data-start="102.6" data-end="105">to get there because I think I had some</span> <span data-start="105" data-end="106.38">fun on the way and I hope you guys have</span> <span data-start="106.38" data-end="109.68">some fun going through with that there's</span> <span data-start="109.68" data-end="111.09">special welcome to the chrome devs</span> <span data-start="111.09" data-end="113.84">today I have a few treats for you guys</span> <span data-start="113.84" data-end="116.58">there are three bugs I'd like to fix in</span> <span data-start="116.58" data-end="118.409">the next few weeks maybe they're not</span> <span data-start="118.409" data-end="120.479">bugs so I have to be careful but I</span> <span data-start="120.479" data-end="122.45">already talked to my quest yesterday and</span> <span data-start="122.45" data-end="124.95">it seems like we can tackle a few of</span> <span data-start="124.95" data-end="126.39">those things today I mean you think</span> </p>
<p><span data-start="126.39" data-end="128.58">Firefox because Firefox is most helpful</span> <span data-start="128.58" data-end="131.76">in the stuff that we'd be doing today</span> <span data-start="131.76" data-end="136.04">come chrome does a good job too so</span> <span data-start="136.04" data-end="138.51">specifically what we're going to do</span> <span data-start="138.51" data-end="142.56">today is we'll be trying to trigger the</span> <span data-start="142.56" data-end="144.87">HTML rendering capabilities that the</span> <span data-start="144.87" data-end="146.85">browser exposes well it doesn't expose</span> <span data-start="146.85" data-end="148.11">it actually the browser is a huge</span> <span data-start="148.11" data-end="149.85">external renderer but normally I'm not</span> <span data-start="149.85" data-end="152.37">allowed to call it from JavaScript</span> </p>
<p><span data-start="152.37" data-end="155.819">I'm trying to work around the the ways</span> <span data-start="155.819" data-end="158.11">and try to</span> <span data-start="158.11" data-end="160">make the browser give me a screenshot of</span> <span data-start="160" data-end="164.38">random webpages or random HTML um we're</span> <span data-start="164.38" data-end="166">going to render HTML to a canvas it</span> <span data-start="166" data-end="169.06">sounds a bit boring but let's see in</span> <span data-start="169.06" data-end="170.38">other words and that's what I learned</span> <span data-start="170.38" data-end="172.02">yesterday from Dominic's talk</span> <span data-start="172.02" data-end="174.97">we're building a prolly fill if you guys</span> <span data-start="174.97" data-end="178.48">didn't join this awesome talk polyfill</span> <span data-start="178.48" data-end="179.68">and I'm trying to explain that my words</span> <span data-start="179.68" data-end="180.94">it might be wrong Dom making correct me</span> <span data-start="180.94" data-end="183.07">but if you guys know a polyfill the</span> <span data-start="183.07" data-end="186.19">polyfill tries to make a browser follow</span> <span data-start="186.19" data-end="187.33">a standard the browser hasn't</span> <span data-start="187.33" data-end="188.65">implemented that yet you're going to</span> <span data-start="188.65" data-end="190.03">write a polyfill to make it work a</span> <span data-start="190.03" data-end="193.18">polyfill is not filling a gap without a</span> <span data-start="193.18" data-end="194.47">standard created there is no standard</span> <span data-start="194.47" data-end="196.57">for this it probably will get a standard</span> <span data-start="196.57" data-end="200.77">if you guys think it's useful so if that</span> <span data-start="200.77" data-end="201.16">makes sense</span> <span data-start="201.16" data-end="205.6">um so we're going to add new</span> <span data-start="205.6" data-end="208.3">capabilities to the canvas which is</span> <span data-start="208.3" data-end="211.27">basically just Troy's email that just</span> <span data-start="211.27" data-end="214.69">that Tony method method is what we will</span> <span data-start="214.69" data-end="216.82">be talking today it sounds easy</span> <span data-start="216.82" data-end="220.75">and it actually is maybe here's a quick</span> <span data-start="220.75" data-end="224.41">solution that is code that only works in</span> </p>
<p><span data-start="224.41" data-end="225.459">Firefox</span> <span data-start="225.459" data-end="227.23">I certainly only works in the chrome</span> <span data-start="227.23" data-end="229.72">mode of Firefox I'm posing a bit right</span> <span data-start="229.72" data-end="231.04">now because I actually don't know what</span> <span data-start="231.04" data-end="233.29">that exactly means I know that Firefox</span> <span data-start="233.29" data-end="235.18">is underneath written in a lot of</span> <span data-start="235.18" data-end="237.209">JavaScript I just don't know how to</span> <span data-start="237.209" data-end="239.29">trigger that code um because I'm not</span> <span data-start="239.29" data-end="240.91">really into that space but I know that</span> <span data-start="240.91" data-end="243.519">that works yeah so what we do what it</span> <span data-start="243.519" data-end="246.459">does is it gets a canvas and in the end</span> <span data-start="246.459" data-end="249.73">it draws a tab the content of a tab to</span> <span data-start="249.73" data-end="252.94">that canvas not sure where the chrome</span> <span data-start="252.94" data-end="254.44">has something like that I know that if</span> <span data-start="254.44" data-end="256.419">that Safari for example and chrome do</span> <span data-start="256.419" data-end="257.59">show you screenshots I guess that must</span> <span data-start="257.59" data-end="259.06">be implemented somehow possibly in</span> </p>
<p><span data-start="259.06" data-end="260.979">JavaScript but that's how Firefox does</span> <span data-start="260.979" data-end="265.03">that so that sounds pretty easy um but</span> <span data-start="265.03" data-end="268.63">as I kind of indicated it does not work</span> <span data-start="268.63" data-end="271.12">in a normal web page but that's what my</span> <span data-start="271.12" data-end="273.91">goal is I like to call this from any</span> <span data-start="273.91" data-end="277.78">random web page why is it not why is not</span> <span data-start="277.78" data-end="279.31">available in the web page all there's</span> <span data-start="279.31" data-end="281.53">security concerns and there are have</span> <span data-start="281.53" data-end="283.39">been awesome talks today yesterday also</span> <span data-start="283.39" data-end="286.33">from my quest about why you want to</span> <span data-start="286.33" data-end="289.15">limit what your websites or your</span> <span data-start="289.15" data-end="291.159">javascript is allowed to do</span> <span data-start="291.159" data-end="294.369">if your JavaScript would be allowed to</span> <span data-start="294.369" data-end="296.739">render random web content from random</span> <span data-start="296.739" data-end="299.589">sources to a canvas it would allow you</span> <span data-start="299.589" data-end="302.11">to inspect this and do something with</span> <span data-start="302.11" data-end="306.669">that so sadly um it does there's no easy</span> <span data-start="306.669" data-end="310.089">way to make it work so I like to ignore</span> <span data-start="310.089" data-end="312.159">any concerns that any content security</span> <span data-start="312.159" data-end="316.479">policy or same-origin policy has unlike</span> <span data-start="316.479" data-end="317.919">to work around it let's see if we can do</span> <span data-start="317.919" data-end="321.069">that so you guys I guess are all huge</span> <span data-start="321.069" data-end="324.49">fans of SVG and SVG unknown to me maybe</span> <span data-start="324.49" data-end="326.8">unknown to you has a foreign object a</span> <span data-start="326.8" data-end="329.679">tag the foreign object lets you allow to</span> <span data-start="329.679" data-end="333.58">embed any kind of HTML it actually</span> <span data-start="333.58" data-end="335.559">allows you to embed without HTML code</span> <span data-start="335.559" data-end="337.719">but you have to convert it to XHTML this</span> <span data-start="337.719" data-end="340.719">is a valid SVG and that is basically an</span> <span data-start="340.719" data-end="344.649">image that just shows HTML so maybe you</span> <span data-start="344.649" data-end="346.869">see where I'm getting here I'm I'm</span> <span data-start="346.869" data-end="349.059">allowed to draw images to to the canvas</span> <span data-start="349.059" data-end="351.519">now I have an image basically which</span> <span data-start="351.519" data-end="353.589">includes HTML so let's see if we can</span> <span data-start="353.589" data-end="354.809">build on that</span> <span data-start="354.809" data-end="360.129">so one short step as I said XHTML I</span> <span data-start="360.129" data-end="362.589">can't form and them HTML added I must</span> <span data-start="362.589" data-end="367.919">converted I need to provide XHTML and</span> </p>
<p><span data-start="367.919" data-end="369.909">Firefox but looking at the chrome</span> <span data-start="369.909" data-end="373.059">developers makes it very easy here there</span> <span data-start="373.059" data-end="374.499">is an XML serialize</span> <span data-start="374.499" data-end="377.079">you just ignore the basic code just the</span> <span data-start="377.079" data-end="379.749">XML civilizer that helps you to convert</span> <span data-start="379.749" data-end="383.949">any random document into XHTML now in</span> <span data-start="383.949" data-end="385.899">Chrome and Safari that does not work and</span> <span data-start="385.899" data-end="388.3">the guys have a point they say the</span> <span data-start="388.3" data-end="391.329">standard does not require XML serialize</span> <span data-start="391.329" data-end="395.619">transform an HTML document into HTML so</span> <span data-start="395.619" data-end="397.209">they have a different behavior there</span> <span data-start="397.209" data-end="398.949">it's actually Firefox that's doing</span> <span data-start="398.949" data-end="400.509">something that that's understand it</span> <span data-start="400.509" data-end="404.74">doesn't ask for so let's assume we have</span> <span data-start="404.74" data-end="406.689">a way of converting that if we if we're</span> <span data-start="406.689" data-end="408.249">going to implement that from today in</span> <span data-start="408.249" data-end="409.629">chrome in Safari</span> <span data-start="409.629" data-end="412.899">we need to have our own substitution for</span> <span data-start="412.899" data-end="415.539">that and I'm I'm really looking into a</span> <span data-start="415.539" data-end="418.119">lot of HTML parsers right lately I've</span> <span data-start="418.119" data-end="420.469">been looking for</span> <span data-start="420.469" data-end="423.77">for a year I might have found something</span> <span data-start="423.77" data-end="426.409">this afternoon but there's no good if</span> <span data-start="426.409" data-end="429.02">there's no good HTML to HTML converter</span> <span data-start="429.02" data-end="430.639">out there in pure JavaScript that works</span> <span data-start="430.639" data-end="432.199">in the browser so if you guys know of</span> <span data-start="432.199" data-end="433.639">something like that just come up to me</span> <span data-start="433.639" data-end="437.469">please so considering that we have that</span> <span data-start="437.469" data-end="439.49">what can we do with that right now</span> <span data-start="439.49" data-end="443.209">so in the future with pelops</span> <span data-start="443.209" data-end="446.629">we can basically just throw our SVG into</span> <span data-start="446.629" data-end="448.999">a blob and created object URL from that</span> <span data-start="448.999" data-end="452.36">this object URL is something we can just</span> <span data-start="452.36" data-end="454.369">pipe into an image and that image could</span> <span data-start="454.369" data-end="456.559">go into the canvas and we're done it's</span> <span data-start="456.559" data-end="458.479">not that easy because Safari isn't that</span> <span data-start="458.479" data-end="460.339">far at least it hasn't been that far a</span> <span data-start="460.339" data-end="463.159">month ago or something so we need to</span> <span data-start="463.159" data-end="465.259">fall back to data URIs your eyes I guess</span> <span data-start="465.259" data-end="467.689">you know that these I think were kind of</span> <span data-start="467.689" data-end="470.149">designed for adding small image content</span> <span data-start="470.149" data-end="473.24">to make your life easy to maybe improve</span> <span data-start="473.24" data-end="474.969">the bandwidth problems</span> <span data-start="474.969" data-end="478.909">improve upon of problems and what we can</span> <span data-start="478.909" data-end="480.349">do is basically if you have an SVG</span> <span data-start="480.349" data-end="484.219">that's what we started we can create an</span> <span data-start="484.219" data-end="487.129">image with Apps basic scheme here just</span> <span data-start="487.129" data-end="489.05">add a data image with the type SVG XML</span> <span data-start="489.05" data-end="492.019">trial said we'd have ade and then so the</span> </p>
<p><span data-start="492.019" data-end="496.399">SVG inside so what does that mean we can</span> <span data-start="496.399" data-end="498.919">now bring this together and remember</span> <span data-start="498.919" data-end="501.379">what our task was our task was render</span> <span data-start="501.379" data-end="504.289">HTML into the canvas so what we can do</span> <span data-start="504.289" data-end="506.869">is create a new image throw in the SVG</span> <span data-start="506.869" data-end="508.969">content and then get the canvas into all</span> <span data-start="508.969" data-end="512.149">the image and that is pretty easy pretty</span> <span data-start="512.149" data-end="515.63">simple code and I like to say</span> <span data-start="515.63" data-end="518.419">congratulations it looks like we're done</span> <span data-start="518.419" data-end="523.13">what we did is Emma did HTML beforehand</span> <span data-start="523.13" data-end="524.899">converting that to XHTML using for an</span> <span data-start="524.899" data-end="528.41">object into an SVG then we converted</span> <span data-start="528.41" data-end="530.86">that into a data URI got an image and</span> <span data-start="530.86" data-end="534.29">use the canvas dot get context draw</span> <span data-start="534.29" data-end="539.81">image and that's good so yeah not right</span> <span data-start="539.81" data-end="541.63">we have a few minutes left right so</span> <span data-start="541.63" data-end="546.529">there's more things to cover SVG is not</span> <span data-start="546.529" data-end="548.75">allowed to include any external</span> <span data-start="548.75" data-end="551.42">resources so I didn't know that</span> <span data-start="551.42" data-end="552.86">beforehand but if you</span> <span data-start="552.86" data-end="554.42">going to include refugee in your web</span> <span data-start="554.42" data-end="557.45">pages your SVG's are not allowed to link</span> <span data-start="557.45" data-end="559.7">to external resources that again is as</span> <span data-start="559.7" data-end="561.17">far as I understand for security reasons</span> <span data-start="561.17" data-end="564.2">so that is bad though because our</span> <span data-start="564.2" data-end="567.23">problem is HTML we want to render HTML</span> </p>
<p><span data-start="567.23" data-end="570.11">HTML allows for a lot of external</span> <span data-start="570.11" data-end="572.21">resources and I'm not sure I think I</span> <span data-start="572.21" data-end="574.19">covered all of them you have images you</span> <span data-start="574.19" data-end="576.44">have much of you knew about input</span> <span data-start="576.44" data-end="578.87">elements of type image you have style</span> <span data-start="578.87" data-end="581.99">sheets you have inside style sheets</span> <span data-start="581.99" data-end="585.44">background images you have staunchly CSS</span> <span data-start="585.44" data-end="588.23">may import other CSS style sheets you</span> <span data-start="588.23" data-end="591.04">have fonts and all of those things</span> <span data-start="591.04" data-end="593.36">linked to external resources and</span> <span data-start="593.36" data-end="595.25">although it's I'd like to render to the</span> <span data-start="595.25" data-end="598.82">canvas too so here's a kind of nifty</span> <span data-start="598.82" data-end="600.59">idea we could try to embed those</span> <span data-start="600.59" data-end="603.2">resources into the SVG SVG could take</span> <span data-start="603.2" data-end="608.54">data your eyes inside to write so how do</span> <span data-start="608.54" data-end="610.7">you find those external elements my girl</span> <span data-start="610.7" data-end="613.94">still is find a generic way of piping</span> </p>
<p><span data-start="613.94" data-end="616.55">HTML into the canvas so let's find out</span> <span data-start="616.55" data-end="618.71">how to make it solution to get that done</span> <span data-start="618.71" data-end="621.83">so that looks like pre a simple code I</span> <span data-start="621.83" data-end="624.32">think you create an empty document you</span> <span data-start="624.32" data-end="626.36">pipe your HTML into that document and</span> <span data-start="626.36" data-end="628.16">then you just get elements by tag name I</span> <span data-start="628.16" data-end="630.32">don't even need to carry all I can do is</span> <span data-start="630.32" data-end="632.66">just get all the images out and I can</span> <span data-start="632.66" data-end="636.41">just iterate over those images and do</span> <span data-start="636.41" data-end="638.48">something with that all right now I know</span> <span data-start="638.48" data-end="640.67">I know have all my images that might</span> <span data-start="640.67" data-end="644.2">email references what do I need to do</span> <span data-start="644.2" data-end="646.94">that's how my image looks like it's an</span> <span data-start="646.94" data-end="649.22">external image and I like to embed that</span> <span data-start="649.22" data-end="652.49">well we talked about data URIs before so</span> <span data-start="652.49" data-end="654.71">what I can do is just basically get that</span> <span data-start="654.71" data-end="656.63">image image to get the content and stuff</span> <span data-start="656.63" data-end="659.63">it into as a data URI into the source</span> <span data-start="659.63" data-end="661.61">and I'm done and how can we do that we</span> <span data-start="661.61" data-end="664.7">just use our plain simple Ajax I load</span> <span data-start="664.7" data-end="668.3">the content by our Ajax and that's how I</span> <span data-start="668.3" data-end="669.98">construct it I add that data URI</span> </p>
<p><span data-start="669.98" data-end="674.69">I'll encode that to base64 via B to a</span> <span data-start="674.69" data-end="680.18">function and I might be done well first</span> <span data-start="680.18" data-end="680.78">things first</span> <span data-start="680.78" data-end="683.39">Ajax you know needs to follow same</span> <span data-start="683.39" data-end="686.72">origin policy so this will not allow</span> <span data-start="686.72" data-end="688.55">me to load random webpages it only</span> <span data-start="688.55" data-end="690.35">allows to me to load stuff that I'm</span> <span data-start="690.35" data-end="692">allowed to see</span> <span data-start="692" data-end="697.48">so just need to mention that secondly</span> <span data-start="697.48" data-end="701.3">loading binary images through Ajax is</span> <span data-start="701.3" data-end="703.49">crazy that's not what Ajax was designed</span> <span data-start="703.49" data-end="706.25">to be Ajax was designed well the name</span> <span data-start="706.25" data-end="709.49">says XML all right it's used to XML and</span> <span data-start="709.49" data-end="714.829">and Jason you allow it to load text not</span> <span data-start="714.829" data-end="719.209">binary data so xhr to XML HTTP because -</span> <span data-start="719.209" data-end="723.079">now has capabilities for loading binary</span> <span data-start="723.079" data-end="726.019">data which gives you back a blob again</span> </p>
<p><span data-start="726.019" data-end="728.3">Safari is not playing along well here so</span> <span data-start="728.3" data-end="732.29">what we're doing we need to find a</span> <span data-start="732.29" data-end="734.6">workaround and that's what I've been</span> <span data-start="734.6" data-end="736.009">doing the whole time are just being</span> <span data-start="736.009" data-end="738.23">throwing things into Google and quite</span> <span data-start="738.23" data-end="740.209">often land on Stack Overflow and find a</span> <span data-start="740.209" data-end="742.31">solution for my problem I had so that's</span> <span data-start="742.31" data-end="743.6">something you can find on Stack Overflow</span> <span data-start="743.6" data-end="745.55">with a big sign saying don't do that</span> <span data-start="745.55" data-end="748.43">that's ugly it's bad but it seems to</span> <span data-start="748.43" data-end="751.16">work in all those browsers so the is you</span> <span data-start="751.16" data-end="755.269">know screw screw a XHTML HTTP request -</span> <span data-start="755.269" data-end="757.399">and screw blobs I can do that with all</span> <span data-start="757.399" data-end="759.769">browsers and I'm happy it's pretty slow</span> <span data-start="759.769" data-end="761.3">though if you load like megabytes of</span> <span data-start="761.3" data-end="763.22">data and you iterate through all the the</span> <span data-start="763.22" data-end="764.509">code points so what it actually does the</span> <span data-start="764.509" data-end="768.019">code I mean you can you you can read but</span> <span data-start="768.019" data-end="771.98">it basically just converts it from a to</span> <span data-start="771.98" data-end="775.149">cope point and throws away all the other</span> <span data-start="775.149" data-end="778.459">bits and just converts it back ugly but</span> <span data-start="778.459" data-end="782.449">it works so we good I'm setting the</span> <span data-start="782.449" data-end="784.579">second point now we I kind of describe</span> <span data-start="784.579" data-end="786.62">how to inline images what about</span> <span data-start="786.62" data-end="788.509">background images it seems a bit similar</span> <span data-start="788.509" data-end="791.209">they are images too but the problem here</span> <span data-start="791.209" data-end="794.149">is background images are referenced in</span> </p>
<p><span data-start="794.149" data-end="796.759">CSS how do I find my background images I</span> <span data-start="796.759" data-end="800.3">need to dig into CSS now that basically</span> <span data-start="800.3" data-end="804.139">requires me pausing CSS to find which we</span> <span data-start="804.139" data-end="807.05">source resources on you to inline so we</span> <span data-start="807.05" data-end="808.639">need to build something like this</span> <span data-start="808.639" data-end="810.559">function pass CSS and if I throw in a</span> <span data-start="810.559" data-end="811.85">span that has a background image I need</span> <span data-start="811.85" data-end="814.85">to find this external image PNG so let's</span> <span data-start="814.85" data-end="819.23">write CSS puzzle</span> <span data-start="819.24" data-end="820.98">you see we're getting a it's getting a</span> <span data-start="820.98" data-end="823.59">bit complicated to be fed though we're</span> <span data-start="823.59" data-end="825.84">done pretty quickly that is slide that</span> <span data-start="825.84" data-end="829.23">describes a CSS parser well we can just</span> <span data-start="829.23" data-end="831.51">use the CSS parser or from the browser I</span> <span data-start="831.51" data-end="834.81">didn't know that I've been using a pure</span> </p>
<p><span data-start="834.81" data-end="836.64">JavaScript solution for a long time</span> <span data-start="836.64" data-end="838.65">until I realized that the CSS only</span> <span data-start="838.65" data-end="839.43">existed</span> <span data-start="839.43" data-end="842.04">it's the CSS object model the browser</span> <span data-start="842.04" data-end="846.08">allows you to basically access its Pazza</span> <span data-start="846.08" data-end="849.27">so that's a nifty code that just does it</span> <span data-start="849.27" data-end="851.76">what it does is you create a style</span> <span data-start="851.76" data-end="855">element you pub your CSS content to that</span> <span data-start="855" data-end="857.52">style element and then you need to do</span> <span data-start="857.52" data-end="860.73">one very important step the browser only</span> <span data-start="860.73" data-end="863.1">starts to evaluate that that CSS if it</span> <span data-start="863.1" data-end="864.84">actually needs to do so so you need to</span> <span data-start="864.84" data-end="867.15">create a fake document at that style</span> <span data-start="867.15" data-end="868.98">element to that document and then the</span> <span data-start="868.98" data-end="873">browser starts to pass that CSS and then</span> <span data-start="873" data-end="875.25">you're done the style element sheet dot</span> </p>
<p><span data-start="875.25" data-end="878.25">CSS rules lists you gives you a list or</span> <span data-start="878.25" data-end="881.13">kind kind of lists lists like element to</span> <span data-start="881.13" data-end="885.12">access all your CSS rules that is and</span> <span data-start="885.12" data-end="886.68">when I found this piece of code I</span> <span data-start="886.68" data-end="888">thought that's so awesome I didn't know</span> <span data-start="888" data-end="892.56">that existed this is basically the</span> <span data-start="892.56" data-end="895.95">browser doing CSS pausing to be fair</span> <span data-start="895.95" data-end="898.38">it's really an air ugly API to be fair</span> <span data-start="898.38" data-end="900.66">if I just if I envisioned how I would do</span> <span data-start="900.66" data-end="902.46">that in in nodejs or any other</span> <span data-start="902.46" data-end="904.53">programming language I would require the</span> </p>
<p><span data-start="904.53" data-end="906.45">CSS parser and tell the CSS positive</span> <span data-start="906.45" data-end="908.4">I'll write my code it turns out that</span> <span data-start="908.4" data-end="910.98">Angele in in the browser Dom you always</span> <span data-start="910.98" data-end="913.89">tend to kind of access some weird API to</span> <span data-start="913.89" data-end="916.32">get some stuff done to be fair I think</span> <span data-start="916.32" data-end="919.92">nobody actually designed actually</span> <span data-start="919.92" data-end="921.69">designed that for that use case I don't</span> <span data-start="921.69" data-end="923.94">think anybody wanted the user or the</span> </p>
<p><span data-start="923.94" data-end="926.07">JavaScript rip our CSS well I need that</span> <span data-start="926.07" data-end="929.16">so here I am I want to get that stuff</span> <span data-start="929.16" data-end="935.01">done so can we put this together we now</span> <span data-start="935.01" data-end="937.5">can pass our rules we get a list we get</span> <span data-start="937.5" data-end="940.26">a list of rules and I mean we can</span> <span data-start="940.26" data-end="941.91">iterate over those rules just like we</span> <span data-start="941.91" data-end="943.95">did with the images before we go through</span> <span data-start="943.95" data-end="945.69">all the rules check if it has a</span> <span data-start="945.69" data-end="949.43">background image and if it does call our</span> <span data-start="949.43" data-end="952.48">virtual method do inline image URL</span> <span data-start="952.48" data-end="954.67">this method is something we already did</span> <span data-start="954.67" data-end="956.29">for the image we can do the same stuff</span> <span data-start="956.29" data-end="957.579">with the background images and we're</span> <span data-start="957.579" data-end="960.459">done so I showed you how to do inline</span> <span data-start="960.459" data-end="961.93">images now we're doing the same stuff</span> <span data-start="961.93" data-end="963.399">with background images only we need to</span> <span data-start="963.399" data-end="965.76">policy if that's before when we good</span> <span data-start="965.76" data-end="970.779">so next step number three</span> <span data-start="970.779" data-end="974.769">what about link elements to inline to</span> <span data-start="974.769" data-end="977.98">the reference style sheets my hTML is</span> <span data-start="977.98" data-end="980.529">allowed to reference other style sheets</span> <span data-start="980.529" data-end="982.54">if I want to run in my HTML or when I</span> <span data-start="982.54" data-end="984.67">might want to make sure that my style</span> <span data-start="984.67" data-end="986.949">sheets are rendered alongside so I need</span> <span data-start="986.949" data-end="988.57">to embed them to remember we are</span> <span data-start="988.57" data-end="992.41">rendering SVG to a canvas and the SVG is</span> <span data-start="992.41" data-end="994.089">embedding HTML but it's not allowed to</span> <span data-start="994.089" data-end="995.32">reference any external stuff time in</span> <span data-start="995.32" data-end="998.98">learning everything so it looks simple</span> <span data-start="998.98" data-end="1002.01">at first we just kind of go with similar</span> <span data-start="1002.01" data-end="1004.17">paths as with the image we're using Ajax</span> <span data-start="1004.17" data-end="1005.13">to load the content</span> <span data-start="1005.13" data-end="1006.51">it's simple here because we're actually</span> <span data-start="1006.51" data-end="1009.209">using a reloading text what we do is we</span> <span data-start="1009.209" data-end="1011.13">throw out the link and in the same place</span> <span data-start="1011.13" data-end="1013.079">we put a style element that includes the</span> <span data-start="1013.079" data-end="1016.26">content of that CSS make sure that you</span> <span data-start="1016.26" data-end="1018.18">put the starlet and the same position as</span> <span data-start="1018.18" data-end="1020.97">a link as CSS um as we learn today again</span> <span data-start="1020.97" data-end="1024.03">follows the order of the declarations so</span> <span data-start="1024.03" data-end="1027.72">be careful here we're not done yet</span> <span data-start="1027.72" data-end="1030.27">it looks simple to just embed that</span> <span data-start="1030.27" data-end="1033.51">content but the resources inside the CSS</span> </p>
<p><span data-start="1033.51" data-end="1036.54">I'm just in lining all those relative</span> <span data-start="1036.54" data-end="1039.99">links are relative to the source through</span> <span data-start="1039.99" data-end="1041.49">the URL of the stylesheet</span> <span data-start="1041.49" data-end="1044.97">so I can icon just pull in the CSS and</span> <span data-start="1044.97" data-end="1046.35">just dump it into the HTML all those</span> <span data-start="1046.35" data-end="1048">links will be broken all the relative</span> <span data-start="1048" data-end="1049.77">links will be broken what I need to do</span> <span data-start="1049.77" data-end="1056.07">is carefully inspect my my CSS unloading</span> <span data-start="1056.07" data-end="1058.049">so I need to pass this stuff again I</span> <span data-start="1058.049" data-end="1060.09">need to find all those references</span> <span data-start="1060.09" data-end="1063.26">background images fonts import rules and</span> <span data-start="1063.26" data-end="1067.26">need to adapt all those URLs to a</span> <span data-start="1067.26" data-end="1069.179">relative to the UL of the style of the</span> <span data-start="1069.179" data-end="1071.309">mother starship basically so for example</span> <span data-start="1071.309" data-end="1074.49">if I have if I have an image dot slash</span> <span data-start="1074.49" data-end="1076.62">images thoughts PI PNG it's an asset</span> <span data-start="1076.62" data-end="1079.38">style default CSS I need to replace the</span> <span data-start="1079.38" data-end="1081.809">dot dot with the assets from the starchy</span> <span data-start="1081.809" data-end="1086.73">so I'm using a pure Jas ULP</span> <span data-start="1086.73" data-end="1090.09">euro is which allows me to base my URL</span> <span data-start="1090.09" data-end="1092.22">absolutely I think it's a wrong name it</span> <span data-start="1092.22" data-end="1094.55">should be relatively to the sheet URL so</span> <span data-start="1094.55" data-end="1097.74">if I inline my CSS content I need to fix</span> <span data-start="1097.74" data-end="1099.809">all those paths and when I fix all those</span> <span data-start="1099.809" data-end="1101.43">part and I'm done then I need to go</span> <span data-start="1101.43" data-end="1103.02">through and replace all the background</span> <span data-start="1103.02" data-end="1105">images we're in the like just what we</span> <span data-start="1105" data-end="1111.059">did before so there you go we rendered</span> </p>
<p><span data-start="1111.059" data-end="1113.82">HTML through the CF SVG's for an object</span> <span data-start="1113.82" data-end="1114.98">we inlined</span> <span data-start="1114.98" data-end="1117.39">not all of the external resources by now</span> <span data-start="1117.39" data-end="1118.49">there's a bit more as I showed before</span> <span data-start="1118.49" data-end="1121.59">but we load in binary content through HX</span> <span data-start="1121.59" data-end="1122.88">or the text content through Ajax</span> <span data-start="1122.88" data-end="1126.12">reinventing image images through data</span> </p>
<p><span data-start="1126.12" data-end="1128.91">URI to embedding style sheets with</span> <span data-start="1128.91" data-end="1132.09">parsing CSS to find resources to fix the</span> <span data-start="1132.09" data-end="1133.22">past</span> <span data-start="1133.22" data-end="1135.36">so what does that what does it look like</span> <span data-start="1135.36" data-end="1139.559">it's demo time I'm showing you kind of</span> <span data-start="1139.559" data-end="1141.24">boring demo right now let's see if that</span> <span data-start="1141.24" data-end="1143.82">makes sense I have a canvas up there</span> <span data-start="1143.82" data-end="1149.01">maybe I should assume in a bit so</span> <span data-start="1149.01" data-end="1158.429">whoopsie that's a bit cut off what we</span> <span data-start="1158.429" data-end="1172.4">can do is just switch over here and so</span> <span data-start="1172.4" data-end="1175.88">so what I have there isn't a text area</span> <span data-start="1175.88" data-end="1180.48">where I can type in arbitrary HTML and</span> <span data-start="1180.48" data-end="1183.39">this is drawn into the canvas up there</span> <span data-start="1183.39" data-end="1184.8">if you don't believe me that this is a</span> <span data-start="1184.8" data-end="1187.11">canvas I can show you pretty easily if I</span> <span data-start="1187.11" data-end="1189.75">right-click on this in Firefox it allows</span> <span data-start="1189.75" data-end="1192.87">me to view the image so what I have</span> <span data-start="1192.87" data-end="1195.24">right now here is my HTML as an image</span> <span data-start="1195.24" data-end="1197.97">and if you look at the not sure whether</span> <span data-start="1197.97" data-end="1199.62">you can see that it's pretty small but</span> <span data-start="1199.62" data-end="1201.39">you see the data you are a UI in the</span> <span data-start="1201.39" data-end="1205.14">browser resource so I basically now have</span> <span data-start="1205.14" data-end="1207.63">an image that I just rendered inside the</span> <span data-start="1207.63" data-end="1209.76">browser with an external image and I can</span> <span data-start="1209.76" data-end="1219.09">do way more crazy stuff with that</span> <span data-start="1219.1" data-end="1225.89">so back to demo so we could say we've</span> <span data-start="1225.89" data-end="1228.92">done here I'd like to give you a small</span> <span data-start="1228.92" data-end="1232.85">bonus let's see if that makes fun I</span> <span data-start="1232.85" data-end="1235.34">don't only want to render a static HTML</span> </p>
<p><span data-start="1235.34" data-end="1240.95">I want to render aged in an HTML page</span> <span data-start="1240.95" data-end="1244.58">that includes JavaScript I want to make</span> <span data-start="1244.58" data-end="1247.43">sure that if my JavaScript does some</span> <span data-start="1247.43" data-end="1249.02">stuff with my page that I render the</span> <span data-start="1249.02" data-end="1253.7">final outcome so is that possible and it</span> <span data-start="1253.7" data-end="1256.73">turns out it is well what I can</span> <span data-start="1256.73" data-end="1259.01">basically do is just create an iframe</span> <span data-start="1259.01" data-end="1262.22">throw my HTML into that iframe and just</span> <span data-start="1262.22" data-end="1263.96">wait for the iframe to trigger the</span> <span data-start="1263.96" data-end="1265.37">onload event when the onload event</span> <span data-start="1265.37" data-end="1269.06">triggers my page has done its rendering</span> <span data-start="1269.06" data-end="1272.15">stuff and the state kind of the state</span> <span data-start="1272.15" data-end="1275.33">possibly changed and I can just then</span> <span data-start="1275.33" data-end="1277.67">take the document of the iframe and then</span> <span data-start="1277.67" data-end="1279.71">get the HTML out again and then I'll</span> <span data-start="1279.71" data-end="1281.99">have like a different HTML string and</span> <span data-start="1281.99" data-end="1284.27">that basically allows me to execute</span> </p>
<p><span data-start="1284.27" data-end="1286.88">JavaScript at the same time I'm not</span> <span data-start="1286.88" data-end="1289.79">really sure about the sandboxing stuff I</span> <span data-start="1289.79" data-end="1292.37">did read a bit up on sandboxing the</span> <span data-start="1292.37" data-end="1294.86">iframe and it turns out oh yeah my</span> <span data-start="1294.86" data-end="1296.06">feeling from that was I don't need to</span> <span data-start="1296.06" data-end="1297.53">sandbox it it works but if you guys have</span> <span data-start="1297.53" data-end="1299.12">security concerns but do come up there</span> <span data-start="1299.12" data-end="1300.86">to me and tell me if I need to make that</span> <span data-start="1300.86" data-end="1303.2">secure somehow it's forcing my security</span> <span data-start="1303.2" data-end="1307.9">concerns so there are a few issues here</span> <span data-start="1307.9" data-end="1309.98">as I said before the same-origin policy</span> <span data-start="1309.98" data-end="1312.47">does not allow you to to load random</span> <span data-start="1312.47" data-end="1316.07">content so Ajax you know that stuff what</span> <span data-start="1316.07" data-end="1318.2">you can do is if you if you have control</span> <span data-start="1318.2" data-end="1320.99">over the origins you can expose common</span> <span data-start="1320.99" data-end="1323.96">object resource sharing so correct yeah</span> <span data-start="1323.96" data-end="1328.22">cause a problem I had with the WebKit</span> <span data-start="1328.22" data-end="1330.11">family I'm not sure if I feel I'm still</span> <span data-start="1330.11" data-end="1334.22">allowed to call it WebKit family but</span> <span data-start="1334.22" data-end="1338">chrome sadly cannot write background</span> <span data-start="1338" data-end="1340.85">images back so this is a pausing that I</span> <span data-start="1340.85" data-end="1342.71">showed earlier does not work in Chrome</span> <span data-start="1342.71" data-end="1344.51">because of this simple bug so what I do</span> <span data-start="1344.51" data-end="1346.73">right now is we can just fall back to</span> <span data-start="1346.73" data-end="1348.83">the CSS object model implementation that</span> <span data-start="1348.83" data-end="1350.75">a guy on github does so</span> <span data-start="1350.75" data-end="1353.179">he's got an awesome implementation for</span> <span data-start="1353.179" data-end="1354.799">nodejs which I'm just using in a browser</span> <span data-start="1354.799" data-end="1357.62">and that's awesome so I know chrome has</span> <span data-start="1357.62" data-end="1359.21">that stuff in that case I'm using a</span> <span data-start="1359.21" data-end="1361.97">polyfill I guess so</span> <span data-start="1361.97" data-end="1366.89">a kind of special problem is if you're</span> <span data-start="1366.89" data-end="1368.99">embedding SVG's if you have an SVG</span> <span data-start="1368.99" data-end="1371.51">inside your HTML remember that the HTML</span> <span data-start="1371.51" data-end="1373.13">goes to into another SVG so you have an</span> </p>
<p><span data-start="1373.13" data-end="1375.89">SVG inside the SVG that suit doesn't</span> <span data-start="1375.89" data-end="1377.809">seem to work neither in Safari nor</span> <span data-start="1377.809" data-end="1381.26">chrome there's a workaround but that's a</span> <span data-start="1381.26" data-end="1386.39">basic issue the last point is my major</span> <span data-start="1386.39" data-end="1389.36">pain point and that's where I needed to</span> <span data-start="1389.36" data-end="1391.159">ask the Google guys I had a conversation</span> <span data-start="1391.159" data-end="1392.99">with Mike yesterday and maybe you</span> <span data-start="1392.99" data-end="1395.75">listened to his talk yesterday as</span> <span data-start="1395.75" data-end="1397.7">neither Safari not chrome allow me to</span> <span data-start="1397.7" data-end="1400.22">read from the canvas after I draw this</span> <span data-start="1400.22" data-end="1403.07">SVG to it there seems to be a different</span> <span data-start="1403.07" data-end="1404.72">interpretation of what the standard</span> <span data-start="1404.72" data-end="1406.85">requires Firefox allows you to do that</span> <span data-start="1406.85" data-end="1410.51">Chrome Safari don't if you want to then</span> <span data-start="1410.51" data-end="1412.97">work with the content you right now you</span> <span data-start="1412.97" data-end="1414.86">cannot you can't which is I think a</span> <span data-start="1414.86" data-end="1416.39">south state because obviously I can't</span> <span data-start="1416.39" data-end="1418.22">think of an attack vector because if I'm</span> <span data-start="1418.22" data-end="1419.72">allowed to load all that content and I'm</span> <span data-start="1419.72" data-end="1420.86">allowed to render that content I should</span> <span data-start="1420.86" data-end="1424.549">be able to read from this one last sat</span> <span data-start="1424.549" data-end="1425.96">point is I 11</span> <span data-start="1425.96" data-end="1428.419">even the ie 11 preview has no support</span> <span data-start="1428.419" data-end="1432.71">for an object so ie 11 sadly none of the</span> </p>
<p><span data-start="1432.71" data-end="1434.51">IE versions do support that stuff that</span> <span data-start="1434.51" data-end="1435.19">we're doing here</span> <span data-start="1435.19" data-end="1437.27">good news though this ability in the</span> <span data-start="1437.27" data-end="1439.159">browser's have increased and especially</span> <span data-start="1439.159" data-end="1440.63">the Firefox guys there's one guy in</span> <span data-start="1440.63" data-end="1442.88">Firefox that seems to be interested in</span> <span data-start="1442.88" data-end="1445.46">that and every time I complained he</span> <span data-start="1445.46" data-end="1449.09">quickly fixed that bug the last bug I</span> <span data-start="1449.09" data-end="1451.28">reported was my fault so he was nice too</span> <span data-start="1451.28" data-end="1454.4">so what's that sorry all about I ended</span> <span data-start="1454.4" data-end="1456.98">up putting that into a library it's on</span> <span data-start="1456.98" data-end="1460.25">github it seems a few people are using</span> <span data-start="1460.25" data-end="1461.39">that at least they're hitting the start</span> <span data-start="1461.39" data-end="1463.159">button on github I just don't know what</span> <span data-start="1463.159" data-end="1465.26">they do move out I don't have really I</span> <span data-start="1465.26" data-end="1466.58">don't know what people want to use it</span> <span data-start="1466.58" data-end="1469.039">for I just talked to dominate and he</span> <span data-start="1469.039" data-end="1470.78">said he's got an interesting to case but</span> </p>
<p><span data-start="1470.78" data-end="1473.539">I still need to ask him I have it I have</span> <span data-start="1473.539" data-end="1475.58">a use case for that and that maybe</span> <span data-start="1475.58" data-end="1478.61">sounds a bit weird my originally idea</span> <span data-start="1478.61" data-end="1482">was I want to start testing my CSS my</span> <span data-start="1482" data-end="1483.86">idea was if I can just take screenshots</span> <span data-start="1483.86" data-end="1484.58">I'm</span> <span data-start="1484.58" data-end="1487.399">I just compare my screenshots old versus</span> <span data-start="1487.399" data-end="1490.7">new and Mike might even crazy idea was I</span> <span data-start="1490.7" data-end="1492.769">wanted to do that in the browser and I</span> <span data-start="1492.769" data-end="1496.1">can now do that I can now render web</span> <span data-start="1496.1" data-end="1498.559">pages in the browser and I can do my</span> <span data-start="1498.559" data-end="1500.269">testing on that that's also in github if</span> <span data-start="1500.269" data-end="1504.289">in case you're interested so thanks for</span> <span data-start="1504.289" data-end="1505.7">listening and do something cool with</span> <span data-start="1505.7" data-end="1508.279">that and I might say that because pop</span> <span data-start="1508.279" data-end="1510.62">works is painful for me being here we're</span> <span data-start="1510.62" data-end="1513.44">hiring if you interested check that out</span> <span data-start="1513.44" data-end="1527.11">thank</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
