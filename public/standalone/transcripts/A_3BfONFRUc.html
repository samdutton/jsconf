<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>A_3BfONFRUc</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/A_3BfONFRUc?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.38" data-end="2.49">Maja Wichrowska — Do the Right (to Left) Thing: Directional Content in React.</span> <span data-start="2.49" data-end="3.49">My name is Maja.</span> <span data-start="3.49" data-end="9.09">I'm a front-end engineer at Airbnb in San Francisco, and I'm going to start this talk</span> <span data-start="9.09" data-end="15.92">with a fun fact, because that's kind of the traditional way we present at Airbnb.</span> </p>
<p><span data-start="15.92" data-end="25.369">My fun fact for today is that I actually broke my nose so fine, playing rugby, very expected,</span> <span data-start="25.369" data-end="30.739">so, if you notice these bruises under my eyes, it's not just the jet lag, it's a bit of the</span> <span data-start="30.739" data-end="31.96">nose!</span> <span data-start="31.96" data-end="39.61">So, I'm here to talk to you today about right-to-left languages, and specifically the infrastructure</span> <span data-start="39.61" data-end="44.491">we've been working on to support them at Airbnb.</span> <span data-start="44.491" data-end="48.42">I hope to answer a number of questions throughout this talk.</span> <span data-start="48.42" data-end="53.65">First, why support right-to-left languages at all?</span> <span data-start="53.65" data-end="56.74">Why is it hard to do so?</span> <span data-start="56.74" data-end="60.63">What tools are already available to us out there?</span> <span data-start="60.63" data-end="66.78">Finally, how we ended up tackling the problem at Airbnb with like a special secret bonus</span> <span data-start="66.78" data-end="71.859">deep dive into our CSS and JavaScript infrastructure.</span> </p>
<p><span data-start="71.859" data-end="77.039">The takeaway is that I plan to demonstrate the steps it takes to get this screen shot</span> <span data-start="77.039" data-end="81.63">turn into this.</span> <span data-start="81.63" data-end="86.509">And I hope that you leave this talk inspired to build in the same kind of support into</span> <span data-start="86.509" data-end="91.791">your apps, and help make a more connected web, one that is accessible and available</span> <span data-start="91.791" data-end="94.759">to everyone in the world.</span> <span data-start="94.759" data-end="101.009">Jumping right in, before we built this whole new infrastructure, it was important to consider</span> <span data-start="101.009" data-end="104.779">who we were building it for, and why it mattered.</span> <span data-start="104.779" data-end="109.389">Of course, I would be tempted to go back to the title slide and like it's the right thing</span> <span data-start="109.389" data-end="112.959">to do, and walk off the stage, and be done with it.</span> <span data-start="112.959" data-end="116.619">But I will delve a bit more into the details.</span> <span data-start="116.619" data-end="122.299">It's difficult to pinpoint an exact number of languages written right-to-left but a huge</span> <span data-start="122.299" data-end="126.22">number of people speak, read, and write these languages.</span> </p>
<p><span data-start="126.22" data-end="131.31">Arabic alone is the fifth most spoken language in the world, with estimates from about 300</span> <span data-start="131.31" data-end="137.61">million to up to 425 million speaking some variant of it.</span> <span data-start="137.61" data-end="143.45">Couple that with languages like Hebrew, Urdu, Persian, and more, and you easily add another</span> <span data-start="143.45" data-end="148.62">250 million people in the world who would benefit from a web in a readily supported</span> <span data-start="148.62" data-end="150.95">right-to-left languages.</span> <span data-start="150.95" data-end="157.72">Now, since Arabic is the most popular of these languages, we have the most data internet</span> <span data-start="157.72" data-end="165.52">users and specifically on the growing digital generation in the Middle East and North Africa.</span> </p>
<p><span data-start="165.52" data-end="169.01">Internet penetration in the Middle East is actually higher than the global average of</span> <span data-start="169.01" data-end="172.9">51 per cent, sitting at nearly 60 per cent.</span> <span data-start="172.9" data-end="179.21">Some countries like the UAE and Qatar have 90 per cent of the population regularly accessing</span> <span data-start="179.21" data-end="180.7">the internet.</span> <span data-start="180.7" data-end="182.36">These aren't casual users.</span> <span data-start="182.36" data-end="186.82">40 per cent of what has been dubbed as the Arab digital generation is on the internet</span> <span data-start="186.82" data-end="190.01">for at least five hours a day.</span> <span data-start="190.01" data-end="197.43">Now, taking a step back, even if you're not doing business in the Middle East or investing</span> <span data-start="197.43" data-end="202.53">there specifically, Arab immigrants are spread out all over the world.</span> <span data-start="202.53" data-end="204.98">There are normal forums on the web.</span> <span data-start="204.98" data-end="213.48">Four out of five all internet users speak Arabic which amounts to — it's the fourth</span> <span data-start="213.48" data-end="216.1">largest language group.</span> </p>
<p><span data-start="216.1" data-end="221.57">The number of English speakers on the web have grown about 600 per cent since 2000;</span> <span data-start="221.57" data-end="226.04">the number of Arabic speakers has grown over 7,000 per cent.</span> <span data-start="226.04" data-end="228.33">This is huge.</span> <span data-start="228.33" data-end="233.4">And what is more, at least 60 per cent of these users say they would prefer content</span> <span data-start="233.4" data-end="235.15">in their own language.</span> <span data-start="235.15" data-end="241.88">It's so much so that there is actually a statistical preference towards blocking and other content-creation</span> <span data-start="241.88" data-end="249.86">platforms which you can extrapolate as because they want that native language content.</span> <span data-start="249.86" data-end="259.56">Only 43 per cent of the top websites have that Arabic content.</span> <span data-start="259.56" data-end="264.71">The ones in the room are the ones who is move the metric in a positive direction.</span> <span data-start="264.71" data-end="271.98">For most of our apps, it's non-trivial, so which begs the question of course, why is</span> <span data-start="271.98" data-end="274.66">this hard?</span> <span data-start="274.66" data-end="280.07">If the problem was supporting basic Arabic content, it wouldn't be a challenge.</span> <span data-start="280.07" data-end="284.07">We would assembly align everything to the right and call it a day.</span> <span data-start="284.07" data-end="290.26">But, of course, Airbnb, like a lot of other platforms, has a tonne of user-generated content.</span> <span data-start="290.26" data-end="297.4">The text is showed in the user's preferred language, there's a good chance that reviews,</span> <span data-start="297.4" data-end="301.85">listing titles, descriptions, names, will be in a different language which creates a</span> <span data-start="301.85" data-end="308.13">by-directional text — a bidirectional text environment.</span> </p>
<p><span data-start="308.13" data-end="314.62">Even if we could control the language of our content, Arabic, Hebrew, are bidirectional</span> <span data-start="314.62" data-end="323.27">by default, numbers read left-to-right creating a challenge in the simplest of information.</span> <span data-start="323.27" data-end="326.4">Bidirectional inputs are trickier.</span> <span data-start="326.4" data-end="334.36">If you have to handle input in every languages, that — do you justify the input according</span> <span data-start="334.36" data-end="336.17">to the page's content language?</span> </p>
<p><span data-start="336.17" data-end="341.169">Do you decide on the fly based on which character the user inputs?</span> <span data-start="341.169" data-end="343.61">What about pre-fixes and sufficient fixes?</span> <span data-start="343.61" data-end="344.61">How do you — suffixes.</span> <span data-start="344.61" data-end="347.58">How do you address mixed content?</span> <span data-start="347.58" data-end="353.36">There is a ton of open questions as to how to create the best user experience.</span> <span data-start="353.36" data-end="359.251">When you add a little bit of directional styling, even things like floats, or padding, that's</span> <span data-start="359.251" data-end="362.84">asymmetrical, that needs to be mirrored too.</span> <span data-start="362.84" data-end="368.59">Finally, iconography and other images need to be taken into account.</span> <span data-start="368.59" data-end="373.98">If the text is flowing right-to-left, it makes that arrows, chevrons and other images need</span> <span data-start="373.98" data-end="379.83">to be method tide to disappoint — modified to point in that direction.</span> </p>
<p><span data-start="379.83" data-end="385.86">What about IDs, or search icons, check marks, universal symbols for accessibility.</span> <span data-start="385.86" data-end="390.45">There are so many icons that may or may not be flipped.</span> <span data-start="390.45" data-end="394.46">We live with a ton of questions.</span> <span data-start="394.46" data-end="401.29">What became apparent is that we actually need to allow for some imagery to stay in the default</span> <span data-start="401.29" data-end="403.68">direction, and then we need to flip some others.</span> <span data-start="403.68" data-end="411.55">So, in summary, for a truly comprehensive system to support right-to-left languages,</span> <span data-start="411.55" data-end="417.3">we need to be able to have non-directional content but bidirectional content on the same</span> <span data-start="417.3" data-end="421.09">page and on the same sentence.</span> <span data-start="421.09" data-end="425.9">We need to figure out how to allow users to type in content in their preferred language,</span> <span data-start="425.9" data-end="433.97">how to allow custom styles to be mirrored, padding, alignment, borders, things like than.</span> <span data-start="433.97" data-end="440.93">We need to have the same allowance for images and iconography, and the ability to opt out</span> <span data-start="440.93" data-end="444.27">all of these things on a selective basis.</span> <span data-start="444.27" data-end="449.86">So the big question becomes how do we accomplish all of this with minimal disruption to our</span> <span data-start="449.86" data-end="454.3">existing code base and our developer work flow?</span> <span data-start="454.3" data-end="460.01">We can begin by assessing the tools that are available to us.</span> <span data-start="460.01" data-end="463.93">The main thing at our disposal is this HTML attribute.</span> </p>
<p><span data-start="463.93" data-end="466.52">It is not a new feature.</span> <span data-start="466.52" data-end="474.16">It is kind of the opposite of a new feature, introduced to the HTML spec in 1999 and was</span> <span data-start="474.16" data-end="480.81">kind of designed as a one true thing to holistically support right-to-left languages.</span> <span data-start="480.81" data-end="485.43">This means that the browser support is super good — every browser supports it — but, unfortunately,</span> <span data-start="485.43" data-end="489.11">it was built for a very different web.</span> <span data-start="489.11" data-end="496.75">So, to time-travel back, look at a beautiful, brutalist Airbnb.com.</span> </p>
<p><span data-start="496.75" data-end="503.19">We set the dir attribute on the top level with great success.</span> <span data-start="503.19" data-end="509.57">Notably, this is designed to automatically flip inline block content and tap similar</span> <span data-start="509.57" data-end="510.57">information.</span> <span data-start="510.57" data-end="516.64">So, in the simplified Airbnb design, we see that everything is right-aligned as expect,</span> <span data-start="516.64" data-end="522.31">labels are on the correct side of their respective inputs, and tabular data like our calendar,</span> <span data-start="522.31" data-end="527.21">or even the grid of experiences flows in the right direction, which is what we want.</span> <span data-start="527.21" data-end="534">One thing to note, though, is that inline information, like our header links, remain</span> <span data-start="534" data-end="537.51">in the same order even with the dir attribute set.</span> <span data-start="537.51" data-end="541.15">This is due to the fact that the content is written in English, and, actually, if we translated</span> <span data-start="541.15" data-end="545.75">this, it would flow in the opposite direction.</span> <span data-start="545.75" data-end="552.62">Another weird point that's on this page, due to mixed content, looking at the prices on</span> <span data-start="552.62" data-end="559.01">our listing cards, we see that the bidirectional algorithm has identified the prices leading</span> <span data-start="559.01" data-end="566.43">the class, and, as a result, in a right-to-left page, that means it's on the right side.</span> <span data-start="566.43" data-end="572.81">If we translated this per person, it would actually be okay, so you can imagine this</span> <span data-start="572.81" data-end="575.55">page in Arabic, pretty good.</span> </p>
<p><span data-start="575.55" data-end="583.19">So, our first step in a right-to-left layout is to check this dir attribute on every page.</span> <span data-start="583.19" data-end="589.82">At the same time we set it, it made sense to make that available down the tree to do</span> <span data-start="589.82" data-end="592.55">customisation if necessary.</span> <span data-start="592.55" data-end="594.73">Enter reactive direction.</span> <span data-start="594.73" data-end="600.41">One of my co-workers conceived of and implemented this particular library.</span> <span data-start="600.41" data-end="607.18">It follows a basic structure that we've been using a lot for top-level variables like break</span> <span data-start="607.18" data-end="611.49">points, or loading data, even our internal brands.</span> </p>
<p><span data-start="611.49" data-end="617.24">Two main exports — a direction provider which sets the direction attribute on kind of a</span> <span data-start="617.24" data-end="624.23">top-level node, and a with-direction wrapper which consumes that direction as a prop and</span> <span data-start="624.23" data-end="626.73">sends it down to each of its child components.</span> <span data-start="626.73" data-end="631.63">So, in action, the direction provider is very simple.</span> </p>
<p><span data-start="631.63" data-end="639.25">If we start with a basic "hello world" React app, we assemble wrap the content to the direction</span> <span data-start="639.25" data-end="650.31">to rtl or LTR or if we — and set the direction appropriately.</span> <span data-start="650.31" data-end="657.43">In practice, if we do nothing else, this just sets the dir attribute on the root node of</span> <span data-start="657.43" data-end="658.52">our app.</span> <span data-start="658.52" data-end="666.72">Once it's set, we can leverage our value down the tree by using the wrapper, and there becomes</span> <span data-start="666.72" data-end="667.72">powerful.</span> <span data-start="667.72" data-end="672.42">If we wanted to have a basic step incrementor component with a chevron icon that we can</span> <span data-start="672.42" data-end="680.91">click and move our stepper forward, if we just put the dir attribute on top, you see</span> <span data-start="680.91" data-end="686.2">it works in the right way, and because we've styled these elements in an inline block fashion,</span> <span data-start="686.2" data-end="692.58">it will put it to the correct side of our text but it's pointing in the wrong direction,</span> <span data-start="692.58" data-end="697.83">and if we want to solve this in a reusable way, we want to create a direction, let's</span> <span data-start="697.83" data-end="700.87">call it icon chevron next.</span> </p>
<p><span data-start="700.87" data-end="707.3">By default, it returns the icon pointing to the right, but if we wrap it and with direction,</span> <span data-start="707.3" data-end="715.07">we will get access to that directional context and we can return a left icon in the rtl context.</span> <span data-start="715.07" data-end="717.82">So of course this changes the game.</span> <span data-start="717.82" data-end="723">If we reference this new and improved icon and set a direction provider at the top, we</span> <span data-start="723" data-end="727.83">can easily have a separator that works on every language with no problem.</span> <span data-start="727.83" data-end="736.29">So, with these basic tools at our disposal, we wanted to investigate how many of our components</span> <span data-start="736.29" data-end="742.51">need to be wrapped in with direction and customised according to that value.</span> <span data-start="742.51" data-end="747.64">Unfortunately, the answer was quite a lot.</span> <span data-start="747.64" data-end="752">The dir attribute only handles inline block and tabular layouts, and a lot of our pages</span> <span data-start="752" data-end="754.9">were styled in different ways.</span> <span data-start="754.9" data-end="761.18">The most basic layout characteristics, the fact that this bucket box should be on the</span> <span data-start="761.18" data-end="766.81">far side of the page, doesn't get — the book it box doesn't get fix by the dir attribute.</span> </p>
<p><span data-start="766.81" data-end="772.42">We have to manually address all of these little style tweaks and spacing and things like that</span> <span data-start="772.42" data-end="774.87">if we didn't come up with a better solution.</span> <span data-start="774.87" data-end="779.14">We didn't have the resources to deal with that.</span> <span data-start="779.14" data-end="783.62">So, we started investigate automated options.</span> <span data-start="783.62" data-end="796.77">We found a number of open resource projects, RTLSS, CSS — web pack, and even like — I've</span> <span data-start="796.77" data-end="799.86">lost all my slide.</span> <span data-start="799.86" data-end="806.14">All of these packages came with one major caveat: they're all CSS packages.</span> <span data-start="806.14" data-end="811.8">We had been spending the past two years moving away from style sheets, so none of these were</span> <span data-start="811.8" data-end="814.66">really helpful for us.</span> <span data-start="814.66" data-end="820.769">Maybe in 2014, when we had been relying on an internal bootstrap-like framework but at</span> <span data-start="820.769" data-end="822.769">this time, it wasn't really relevant.</span> <span data-start="822.769" data-end="826.769">I'm going to go on a bit of a tangent to explain.</span> <span data-start="826.769" data-end="831.98">Airbnb had traditionally been Ruby on Rails backbone style sheet.</span> <span data-start="831.98" data-end="838.36">But as we moved to a world of React, the style sheets we had were still associated largely</span> <span data-start="838.36" data-end="846.829">with routes whereas our components were more featured-based across multiple routes and</span> <span data-start="846.829" data-end="848.839">pages.</span> </p>
<p><span data-start="848.839" data-end="855.329">We also had a lot of generic class names that were really hard to track down and grab for</span> <span data-start="855.329" data-end="860.61">which made is really difficult to determine what component required which style sheet,</span> <span data-start="860.61" data-end="864.95">and which style sheet was still in effect.</span> <span data-start="864.95" data-end="866.86">This was like a particularly big one.</span> <span data-start="866.86" data-end="872.67">If you can't figure out if a particular override or style is still being used, that ends up</span> <span data-start="872.67" data-end="873.67">in us.</span> <span data-start="873.67" data-end="877.95">Sending down an enormous amount of CSS some of which is an app to the page you're looking</span> <span data-start="877.95" data-end="884.05">at, some of which isn't applicable to any page under Airbnb and this is causing a big</span> <span data-start="884.05" data-end="886.63">performance issue.</span> </p>
<p><span data-start="886.63" data-end="890.94">All of these things coupled together led to incident after incident.</span> <span data-start="890.94" data-end="897.23">I think I sent out six individual post-mortems related to mistaken CSS style sheets so started</span> <span data-start="897.23" data-end="898.97">to consider other options.</span> <span data-start="898.97" data-end="905">The question we asked was how do we style React components while minimising side effects</span> <span data-start="905" data-end="907.7">performance impact and implicit dependencies?</span> <span data-start="907.7" data-end="912.39">The answer foreign us, and I — the answer for us, and I will emphasise is may not be</span> <span data-start="912.39" data-end="919.47">for you, was to couple styles with our components and write our CSS in the React components.</span> </p>
<p><span data-start="919.47" data-end="923.64">The idea of CSS and JS had been hot around the web for a while and there were numerous</span> <span data-start="923.64" data-end="926.43">paradigms out there already.</span> <span data-start="926.43" data-end="936.32">We were leaning towards the Conig Aphrodite library and we will delve into the basics</span> <span data-start="936.32" data-end="939.54">of how it works.</span> <span data-start="939.54" data-end="947.45">With Aphrodite, you want the create method with your definitions.</span> <span data-start="947.45" data-end="953.16">It could be on import, that first render, but that needs to be accessible by your DOM</span> <span data-start="953.16" data-end="954.72">elements.</span> <span data-start="954.72" data-end="963.59">Aphrodite handles fancy selectors, pseudo selectors, and that's a feature bit on a pluggable</span> <span data-start="963.59" data-end="969.1">selector handler which will be important for us later.</span> <span data-start="969.1" data-end="976.72">What a Aphrodite does under the hoot is transpile that object to something it can understand.</span> <span data-start="976.72" data-end="983.42">Notably, it hashes the key of your style and creates a class name for it and then does</span> <span data-start="983.42" data-end="988.63">any special selector handling to generate the actual CSS.</span> <span data-start="988.63" data-end="995.57">You reference these styles objects on your individual DOM element using the CSS method.</span> <span data-start="995.57" data-end="1002.54">And this in turn turns into a unique — this in turn, turns into a unique class name.</span> </p>
<p><span data-start="1002.54" data-end="1008.11">What Aphrodite does is inject it directly into the page as a style tag.</span> <span data-start="1008.11" data-end="1013.459">This is great for performance reasons because it is only ever injecting the subtitle that</span> <span data-start="1013.459" data-end="1015.33">are actually being rendered to the page.</span> <span data-start="1015.33" data-end="1020.79"> —  it only injects the styles that are being injected into the page.</span> <span data-start="1020.79" data-end="1027.35">We also enjoyed the parity of these definitions with React native styles.</span> <span data-start="1027.35" data-end="1034.079">But, since the greater open source community hadn't landed on a CSS and JS solution and</span> <span data-start="1034.079" data-end="1041.29">still hasn't landed on one true solution, we didn't want to write our thousands of components</span> <span data-start="1041.29" data-end="1046.169">using Aphrodite only to have to write them again in six months.</span> </p>
<p><span data-start="1046.169" data-end="1052">One of my co-workers tried to future-proof this idea of Airbnb with a package called</span> <span data-start="1052" data-end="1054.36">React with Styles.</span> <span data-start="1054.36" data-end="1060.35">The basic premise of that is that, no matter what technology you're relying on, you always</span> <span data-start="1060.35" data-end="1063.87">write your components the exact same way.</span> <span data-start="1063.87" data-end="1071.78">What actually does under-the-hood legwork of that styling is an interface, and most</span> <span data-start="1071.78" data-end="1077.16">importantly, you can easily swap that interface out by changing what you register.</span> <span data-start="1077.16" data-end="1088.89">We have interfaces for Aphrodite, CSS, and even hilariously ..</span> <span data-start="1088.89" data-end="1091.28">just in case you change your mind.</span> <span data-start="1091.28" data-end="1097.71">So, to write an actual component in that paradigm, you start by importing these two functions,</span> <span data-start="1097.71" data-end="1101.14">and then the components are defined the exact same way they always have been.</span> <span data-start="1101.14" data-end="1107.22">Instead of the binnable component, you wrap it in with styles.</span> <span data-start="1107.22" data-end="1112.26">And styles can be defined in a very class-like manner.</span> <span data-start="1112.26" data-end="1119.1">You can see the parity with how we why using Aphrodite before showing through in this wrapper.</span> </p>
<p><span data-start="1119.1" data-end="1124.66">You can also easily reference top-level theme variables that you have defined like colour</span> <span data-start="1124.66" data-end="1128.57">constants, or user sizes, which is pretty neat.</span> <span data-start="1128.57" data-end="1134.21">Then, because we've wrapped our component, we actually have those styles accessible to</span> <span data-start="1134.21" data-end="1136.2">us as a problem.</span> </p>
<p><span data-start="1136.2" data-end="1141.53">We spread them on to whatever DOM node is needed using the CSS method which again you</span> <span data-start="1141.53" data-end="1145.09">can see the parity with how Aphrodite does class names.</span> <span data-start="1145.09" data-end="1149.94">This method can take conditional statements as well which is cool if you're trying to</span> <span data-start="1149.94" data-end="1152.94">do some fancy stuff based on props.</span> <span data-start="1152.94" data-end="1159.42">You can even it cannily pass in based on prop values or something calculated.</span> <span data-start="1159.42" data-end="1163.92">This is actually an added feature of React with Styles with these objects will get convert</span> <span data-start="1163.92" data-end="1170.92">the to an instyle tag which again is important for later.</span> <span data-start="1170.92" data-end="1177.12">Coming back to rtl, after that lovely tangent, the environment created by React with Styles</span> <span data-start="1177.12" data-end="1184.37">and Aphrodite proved to be both a unique challenge and a great benefit to how we implemented</span> <span data-start="1184.37" data-end="1187.98">automatic style-flipping for right-to-left context.</span> </p>
<p><span data-start="1187.98" data-end="1194.28">Even though we had to get creative with what was available to us, having this abstraction</span> <span data-start="1194.28" data-end="1200.24">layer allowed us to its trait an experiment in an isolated playground without touching</span> <span data-start="1200.24" data-end="1206.17">either Aphrodite or our own codebase which was pretty cooling.</span> <span data-start="1206.17" data-end="1214.76">When considering how to flip in this environment, we considered a handful which would inform</span> <span data-start="1214.76" data-end="1216.96">our own approach.</span> <span data-start="1216.96" data-end="1220.54">First, we would have to handle all directional styles.</span> <span data-start="1220.54" data-end="1225.94">Things like margin, padding, text alignment, floats, left-to-right positioning, transforms,</span> <span data-start="1225.94" data-end="1226.94">everything.</span> <span data-start="1226.94" data-end="1234.74">Second, and this sounds really big: we wanted zero changes as to how our developers were</span> <span data-start="1234.74" data-end="1240.55">writing their components and didn't want to have to make any changes to the existing codebase.</span> <span data-start="1240.55" data-end="1249.371">Third how style sheets needed to be handled and the inline style objects we were dynamically</span> <span data-start="1249.371" data-end="1252.51">creating on Render.</span> </p>
<p><span data-start="1252.51" data-end="1259.23">Of course, we didn't want to have a huge performance impact on our application while doing this</span> <span data-start="1259.23" data-end="1260.33">process.</span> <span data-start="1260.33" data-end="1262.48">So, attempt number 1.</span> <span data-start="1262.48" data-end="1267.24">Got to love the number 1 because you know it is not the final one!</span> <span data-start="1267.24" data-end="1271.06">We noted a few things that kind of like informed this attempt.</span> <span data-start="1271.06" data-end="1276.82">So, one, style sheet creation happens on import, not on render.</span> <span data-start="1276.82" data-end="1282.049">This means when we call that method, we don't have any access to React context or other</span> <span data-start="1282.049" data-end="1283.25">variables.</span> <span data-start="1283.25" data-end="1289.77">CSS method is a singleton global export, not passed down through the props which means</span> <span data-start="1289.77" data-end="1295.25">it doesn't have any access to React context.</span> </p>
<p><span data-start="1295.25" data-end="1300.57">Objects passed into the CSS method are handled at render time, not on import.</span> <span data-start="1300.57" data-end="1302.21">That's important.</span> <span data-start="1302.21" data-end="1306.57">We can, however, assume that all of our apps have a top-level dir attribute set, so we</span> <span data-start="1306.57" data-end="1310.6">do have that available to us.</span> <span data-start="1310.6" data-end="1316.54">As we noted before, Aphrodite has a built-in plug-in system to handle fancy selectors,</span> <span data-start="1316.54" data-end="1320.9">and we can create our own selectors through this process.</span> <span data-start="1320.9" data-end="1328.07">So you, the gameplan was to leverage Aphrodite's figure-in system to create descendent selectors.</span> <span data-start="1328.07" data-end="1334.37">Specifically, we would wrap our default styles in the ltr context, and the flip styles in</span> <span data-start="1334.37" data-end="1338.38">the dir squalls rtl context.</span> <span data-start="1338.38" data-end="1346.25">It knows we added these — added these two new keys we are looking at, and the most important</span> <span data-start="1346.25" data-end="1353.73">part of this is that we would search our generated CSS for anything that looks like a class name</span> <span data-start="1353.73" data-end="1359.23">- Aphrodite doesn't give us a nice object to work with, it just gives us a string — but</span> <span data-start="1359.23" data-end="1370.96">we do regec to find those and do each of one, depending on which object we are looking at.</span> <span data-start="1370.96" data-end="1376.9">The effect of this is if this was passed into our style-sheet creation method, what would</span> <span data-start="1376.9" data-end="1384.19">transform into, ah, is this output CSS.</span> <span data-start="1384.19" data-end="1390.4">And so, this isn't quite enough to satisfy all of our requirements, if this selector</span> <span data-start="1390.4" data-end="1397.84">handler was all we did, we would have to rewrite our styles to have this styles in them.</span> </p>
<p><span data-start="1397.84" data-end="1403.75">So, we wanted to monkey-patch the CSS method to do all of this for us.</span> <span data-start="1403.75" data-end="1406.73">This method takes a list of styles as arguments.</span> <span data-start="1406.73" data-end="1412.781">It flips them up so looks at the Aphrodite styles and the inline styles separately.</span> <span data-start="1412.781" data-end="1415.22">They go through the CSS call.</span> <span data-start="1415.22" data-end="1419.95">The inline styles get appended to a style tag, and is to what we did was create this</span> <span data-start="1419.95" data-end="1423.82">helper method that would split apart these styles.</span> <span data-start="1423.82" data-end="1428.49">We relied on a really excellent package called RTL CSS.</span> <span data-start="1428.49" data-end="1436.57">JS handling the flipping for which keys are appropriate for which context, and so we dumped</span> <span data-start="1436.57" data-end="1441.88">out this object output, and then we passed it into the CSS.</span> <span data-start="1441.88" data-end="1446.63">With our custom handler, we are free.</span> <span data-start="1446.63" data-end="1451.52">With inline styles, it is a bit trickier.</span> <span data-start="1451.52" data-end="1456.76">They have descendent selectors, obviously.</span> <span data-start="1456.76" data-end="1463.83">We had to call the same direction method to split those apart, and, if there were flippable</span> <span data-start="1463.83" data-end="1470.63">styles, we actually created a fake class name for that situation in the same way that Aphrodite</span> <span data-start="1470.63" data-end="1478.95">does, and, otherwise, dependent on the style tag just as always.</span> </p>
<p><span data-start="1478.95" data-end="1483.49">We had a decent amount of success with this.</span> <span data-start="1483.49" data-end="1491.751">We didn't have to change any of our components, and we found our switch component, which is</span> <span data-start="1491.751" data-end="1497.28">all CSS would roll in the correct way, so it was pretty good.</span> <span data-start="1497.28" data-end="1502.429">But a number of things cropped up that led us back to the drawing board.</span> <span data-start="1502.429" data-end="1507.1">For one, descendent selectors don't allow for content-switching.</span> <span data-start="1507.1" data-end="1510.909">As I mentioned earlier in the presentation, we have a lot of user-generated content.</span> <span data-start="1510.909" data-end="1516.23">You might be looking at Airbnb in Arabic but there might be a review in English, and we</span> <span data-start="1516.23" data-end="1520">need to be able to align that properly.</span> <span data-start="1520" data-end="1528.4">Second, descendent selectors coupled with directional styles and directional styles,</span> <span data-start="1528.4" data-end="1532.37">things like border and border left trying to override each other, actually led to a</span> <span data-start="1532.37" data-end="1538.179">lot of very strange specificity issues that we began exploring and learning about.</span> <span data-start="1538.179" data-end="1544.87">And then finally, when we upgraded to React, because we have server-side rendering in our</span> <span data-start="1544.87" data-end="1550.65">app, we started seeing whereas previously a client-side renderer would win, there were</span> <span data-start="1550.65" data-end="1561.11">discrepancies that would manifest themselves in really bizarre and like undebuggable ways.</span> </p>
<p><span data-start="1561.11" data-end="1566.37">So, we went back to the drawing board.</span> <span data-start="1566.37" data-end="1572.12">Looking back at our original requirements, we made one small change which is that we</span> <span data-start="1572.12" data-end="1576.7">would allow changes to our components as long as they were easily code moddable — moddable</span> <span data-start="1576.7" data-end="1583.03">and could manufacturer the script.</span> <span data-start="1583.03" data-end="1590.59">We made sure we could handle context-switching but no specificity issues, so dependent selectors</span> <span data-start="1590.59" data-end="1598.52">were probably out, and that specifically, there wasn't a server-client mismatch in some</span> <span data-start="1598.52" data-end="1599.68">occasions.</span> <span data-start="1599.68" data-end="1607.39">So, our new strategy was to create contextual create-and-resolve methods based on direction.</span> <span data-start="1607.39" data-end="1611.53">This notably was a bit of a challenge because, as mentioned before, these methods did not</span> <span data-start="1611.53" data-end="1615.73">have access to context in the beginning.</span> <span data-start="1615.73" data-end="1620.432">How this would look in our interface, whereas before we would have just one create and one</span> <span data-start="1620.432" data-end="1625.21">resolve method that would have to handle on everything, we split it up.</span> </p>
<p><span data-start="1625.21" data-end="1629.27">There's one for the left-to-right languages, and there's one for the right-to-left.</span> <span data-start="1629.27" data-end="1636.09">For Create, this was super easy, for, like, in a default context, we called style sheet,</span> <span data-start="1636.09" data-end="1642.929">create as normal, and the rtl context, we simply flip the styles into the pack I suggest</span> <span data-start="1642.929" data-end="1651.34">and put that into — inline styles is a similarly simple solution, we would just flip the styles,</span> <span data-start="1651.34" data-end="1655.549">so now there is no specificity issues, no challenges between the two.</span> <span data-start="1655.549" data-end="1657.28">Pretty good.</span> <span data-start="1657.28" data-end="1663.89">And the way we made this accessible to all of our components is, before we were creating</span> <span data-start="1663.89" data-end="1667.84">the style sheet on import, so, again, no context.</span> </p>
<p><span data-start="1667.84" data-end="1673.159">So we deferred it to the first renderer, and then picked the appropriate create method</span> <span data-start="1673.159" data-end="1674.72">based on directional context.</span> <span data-start="1674.72" data-end="1680.45">We are assuming that our apps are all wrapped in the direction provider.</span> <span data-start="1680.45" data-end="1688.88">But again, this doesn't consider dynamically-created inline styles, so we also picked our CSS method</span> <span data-start="1688.88" data-end="1690.79">based on the same context.</span> <span data-start="1690.79" data-end="1695.58">And the difference now is we pass it in as a prop.</span> <span data-start="1695.58" data-end="1700.919">So the main change 24-hour components, whereas previously they were written like this, we</span> <span data-start="1700.919" data-end="1705.22">would now pull the CSS method from our props and call it instead.</span> </p>
<p><span data-start="1705.22" data-end="1710.14">This is prettily easily code moddable, easy to write a script that handled all of our</span> <span data-start="1710.14" data-end="1716.07">cases off the bat, and the effect is pretty stunning.</span> <span data-start="1716.07" data-end="1722.279">With just a few changes to accurate calm, we are about to  —  to countercalm  —  ecosystem,</span> <span data-start="1722.279" data-end="1730.15">we are go to get — we still haven't launched but we still have a way of testing across</span> <span data-start="1730.15" data-end="1734.45">the entire platform but we don't expect to run into too much trouble.</span> <span data-start="1734.45" data-end="1738.46">The journey has gotten us an enormous way there, and we look forward to rolling out</span> <span data-start="1738.46" data-end="1743.08">these languages in the future and making Airbnb a bit more accessible to people across the</span> <span data-start="1743.08" data-end="1744.08">world.</span> <span data-start="1744.08" data-end="1749.7">And, if you would like to learn more, I highly recommend checking out a React with Direction</span> <span data-start="1749.7" data-end="1756.45">package, a React with Styles pack I suggest, and the JSS and CSS package, and you can always</span> <span data-start="1756.45" data-end="1758.779">tweet at me if you have any questions.</span> <span data-start="1758.78" data-end="1759.78">Thank you.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
