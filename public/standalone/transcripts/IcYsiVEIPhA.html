<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IcYsiVEIPhA</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/IcYsiVEIPhA?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="34.84" data-end="37.9">I'm Steffen Harris from inter labs and</span> <span data-start="37.9" data-end="39.94">I'm here and I'm quite excited to be</span> <span data-start="39.94" data-end="41.71">here today to talk about River Trail</span> <span data-start="41.71" data-end="45.39">which is the project we do it inter let</span> <span data-start="45.39" data-end="48.55">me and my colleagues and it's about</span> <span data-start="48.55" data-end="50.879">bringing parallel computer to JavaScript</span> <span data-start="50.879" data-end="53.379">so we really want to bring the pro</span> <span data-start="53.379" data-end="55.39">compute power you have in today's</span> <span data-start="55.39" data-end="58.03">hardware to the web to JavaScript and</span> <span data-start="58.03" data-end="60.309">y'all got phones today so that's where</span> <span data-start="60.309" data-end="61.87">you have pearl hardware you will have</span> <span data-start="61.87" data-end="64">pearl harbor in your laptops in your</span> <span data-start="64" data-end="66.4">desktops it's everywhere but how about</span> <span data-start="66.4" data-end="69.04">concurrency in JavaScript what's the</span> <span data-start="69.04" data-end="72.22">state of the art there so when I started</span> <span data-start="72.22" data-end="75.31">looking into this I took a look at</span> <span data-start="75.31" data-end="78.52">javascript and what concurrency you have</span> <span data-start="78.52" data-end="80.41">and one thing I realized and I found</span> <span data-start="80.41" data-end="81.31">that really interesting is that</span> </p>
<p><span data-start="81.31" data-end="83.14">JavaScript developers in a way are</span> <span data-start="83.14" data-end="85.6">really good concurrency engineers</span> <span data-start="85.6" data-end="87.7">they've right concurrent programs and</span> <span data-start="87.7" data-end="90.039">the reason for that is that you have</span> <span data-start="90.039" data-end="92.08">this cooperative multitasking kind of</span> <span data-start="92.08" data-end="94.39">model in your browser where either your</span> <span data-start="94.39" data-end="96.399">browser engine is running and rendering</span> <span data-start="96.399" data-end="98.59">and driving the UI or your script is</span> <span data-start="98.59" data-end="100.36">running so you cannot have both running</span> <span data-start="100.36" data-end="102.58">at the same time and this forces here as</span> <span data-start="102.58" data-end="105.039">a programmer to write these asynchronous</span> <span data-start="105.039" data-end="107.89">callback style applications where you</span> <span data-start="107.89" data-end="111.27">decompose your program into small pieces</span> <span data-start="111.27" data-end="114.22">that can run quickly enough so that you</span> <span data-start="114.22" data-end="116.08">get this impression as a user that</span> <span data-start="116.08" data-end="118.569">actually the browser and the scripts run</span> <span data-start="118.569" data-end="121.479">at the same time so you are kind of as a</span> <span data-start="121.479" data-end="123.459">developer aware of how to write</span> <span data-start="123.459" data-end="126.97">concurrent programs however you have one</span> <span data-start="126.97" data-end="129.009">nice thing in JavaScript it's fully</span> <span data-start="129.009" data-end="130.959">deterministic and that really makes your</span> <span data-start="130.959" data-end="134.74">life as a developer a lot easier what</span> <span data-start="134.74" data-end="136.75">fully deterministic means is that whilst</span> <span data-start="136.75" data-end="138.819">your script is running nobody else is</span> <span data-start="138.819" data-end="141.22">changing the world so you as a</span> <span data-start="141.22" data-end="143.08">programmer can rely on the fact that</span> <span data-start="143.08" data-end="145.42">only your script is actually</span> <span data-start="145.42" data-end="147.94">manipulating your data and that gives</span> <span data-start="147.94" data-end="149.65">you a very comfortable programming</span> <span data-start="149.65" data-end="151.12">environment because you have no</span> <span data-start="151.12" data-end="152.59">concurrent side effects and you don't</span> <span data-start="152.59" data-end="154.3">get the nasty things of concurrent</span> <span data-start="154.3" data-end="157.69">programming you don't get debt logs you</span> <span data-start="157.69" data-end="159.43">don't get life logs all of these issues</span> <span data-start="159.43" data-end="163.209">do exist of course there's a slight</span> </p>
<p><span data-start="163.209" data-end="166.84">Cabot here because in the end there is</span> <span data-start="166.84" data-end="167.95">no concurrency</span> <span data-start="167.95" data-end="170.56">the browser because what your JavaScript</span> <span data-start="170.56" data-end="172.9">engine does it fully sequentialized is</span> <span data-start="172.9" data-end="175.39">your program there's only one script and</span> <span data-start="175.39" data-end="177.519">only one event running at every single</span> <span data-start="177.519" data-end="180.519">each time and this of course is a</span> <span data-start="180.519" data-end="182.68">problem moving forward because having</span> <span data-start="182.68" data-end="184.48">all this pearl hardware how are you</span> <span data-start="184.48" data-end="186.31">going to exploit it if you cannot write</span> <span data-start="186.31" data-end="189.28">concurrent programs and typically when I</span> <span data-start="189.28" data-end="190.78">put up the slide and say hey there is no</span> <span data-start="190.78" data-end="192.13">concurrency in JavaScript there's</span> <span data-start="192.13" data-end="195.489">somebody shouting say hey what about web</span> <span data-start="195.489" data-end="198.549">workers we have web workers they give us</span> <span data-start="198.549" data-end="201.22">tasks Yeah right true you have web</span> <span data-start="201.22" data-end="202.69">workers but they are for a very specific</span> <span data-start="202.69" data-end="205.299">kind of concurrency if you look at how</span> <span data-start="205.299" data-end="206.89">web brokers are done is they are very</span> <span data-start="206.89" data-end="209.41">very heavy weight so what you can do you</span> <span data-start="209.41" data-end="211.299">can spawn a thread which typically</span> <span data-start="211.299" data-end="213.01">spawns an operating system thread and</span> <span data-start="213.01" data-end="214.81">then it can run some operation and you</span> <span data-start="214.81" data-end="217.599">sync it all up again but spawning and</span> <span data-start="217.599" data-end="219.579">syncing is very expensive so you</span> <span data-start="219.579" data-end="221.29">probably will only do that if you have</span> <span data-start="221.29" data-end="223.269">sufficient workload to make up those</span> <span data-start="223.269" data-end="226.87">costs again also web workers have this</span> <span data-start="226.87" data-end="229.45">actress model of writing concurrent</span> <span data-start="229.45" data-end="231.239">programs and what that means is that</span> <span data-start="231.239" data-end="233.95">when sexually you have to completely</span> <span data-start="233.95" data-end="235.9">disjoint on script engines running and</span> <span data-start="235.9" data-end="237.609">the only way they communicate is via</span> <span data-start="237.609" data-end="241.329">messages this is all nice this is all</span> <span data-start="241.329" data-end="243.4">great if you have a kind of concurrency</span> <span data-start="243.4" data-end="245.139">in your application that does not</span> <span data-start="245.139" data-end="248.23">require a lot of shared State so if you</span> <span data-start="248.23" data-end="249.88">can decompose your program into two</span> <span data-start="249.88" data-end="252.4">parts while you only send tiny little</span> <span data-start="252.4" data-end="254.62">messages between them you can use web</span> <span data-start="254.62" data-end="257.139">workers but as soon as you have to share</span> <span data-start="257.139" data-end="260.019">big pieces big chunks of data the hell</span> <span data-start="260.019" data-end="262">breaks loose because the communication</span> <span data-start="262" data-end="264.25">costs quickly eat all the benefit you</span> <span data-start="264.25" data-end="266.77">get from concurrency and that's not the</span> <span data-start="266.77" data-end="268.36">kind of concurrency I am interested in</span> <span data-start="268.36" data-end="270.13">here so I'm not talking about cause</span> <span data-start="270.13" data-end="272.889">brain heavyweight task parallelism what</span> </p>
<p><span data-start="272.889" data-end="274.81">I want to talk about here is data</span> <span data-start="274.81" data-end="278.95">parallel programming so what's data</span> <span data-start="278.95" data-end="280.389">promo programming I will give you my</span> <span data-start="280.389" data-end="282.7">very personal very developer centric</span> <span data-start="282.7" data-end="284.44">view of what date above programming</span> <span data-start="284.44" data-end="286.33">means for me so if you write a data</span> <span data-start="286.33" data-end="289.03">program where the tip that you do is you</span> <span data-start="289.03" data-end="290.86">have a piece of data and then you</span> <span data-start="290.86" data-end="292.9">specify independent computations on</span> <span data-start="292.9" data-end="295.539">pieces of that data and the really</span> <span data-start="295.539" data-end="297.25">important part there is you never</span> <span data-start="297.25" data-end="299.229">actually say that it is concurrent in</span> <span data-start="299.229" data-end="301.449">any way you never say is bonded</span> <span data-start="301.449" data-end="303.52">read you never say run this concurrently</span> <span data-start="303.52" data-end="306.129">all you do as a programmer you express</span> <span data-start="306.129" data-end="308.499">that these computations are independent</span> <span data-start="308.499" data-end="311.349">all the concurrency is implicit and</span> <span data-start="311.349" data-end="314.08">that's a quite powerful approach because</span> <span data-start="314.08" data-end="316.33">what you can do you can massively over</span> <span data-start="316.33" data-end="318.789">subscribe your resources so think about</span> <span data-start="318.789" data-end="321.039">an example like map where you have a</span> <span data-start="321.039" data-end="322.96">thousand array elements and you apply a</span> <span data-start="322.96" data-end="325.689">function to each of those elements with</span> <span data-start="325.689" data-end="327.339">the right function you can execute that</span> <span data-start="327.339" data-end="329.83">concurrently conceptually you have a</span> <span data-start="329.83" data-end="331.27">thousand threads you can run</span> <span data-start="331.27" data-end="333.46">concurrently but nobody with the same</span> <span data-start="333.46" data-end="335.349">mind would create a thousand operating</span> <span data-start="335.349" data-end="337.749">system threads so you over subscribe</span> <span data-start="337.749" data-end="340.569">your resources in the end you have a</span> <span data-start="340.569" data-end="342.339">runtime system that will figure all this</span> <span data-start="342.339" data-end="344.139">out for you because your runtime system</span> <span data-start="344.139" data-end="346.419">knows how many cores you have whether</span> <span data-start="346.419" data-end="348.189">you have simdi units maybe you have a</span> </p>
<p><span data-start="348.189" data-end="350.74">GPU so the runtime system can decide how</span> <span data-start="350.74" data-end="355.24">to execute these threads as a programmer</span> <span data-start="355.24" data-end="357.789">that's a very very nice place to be</span> <span data-start="357.789" data-end="359.62">because you don't have to care about all</span> <span data-start="359.62" data-end="361.509">the heavy lifting all you do is you</span> <span data-start="361.509" data-end="363.399">express your program in a way so that</span> <span data-start="363.399" data-end="365.649">you can say here at runtime is my code</span> <span data-start="365.649" data-end="368.08">look at it and figure out how to run</span> <span data-start="368.08" data-end="370.779">concurrently so let me show you some</span> <span data-start="370.779" data-end="374.02">code this is or should at least be valid</span> </p>
<p><span data-start="374.02" data-end="376.899">JavaScript so what it does is you take</span> <span data-start="376.899" data-end="378.159">this little array here with four</span> <span data-start="378.159" data-end="380.169">elements and then you apply map to it</span> <span data-start="380.169" data-end="382.749">the function I pass the map is this</span> <span data-start="382.749" data-end="385.629">little increment here so if you look at</span> <span data-start="385.629" data-end="387.909">it as a developer you can instantly spot</span> <span data-start="387.909" data-end="391.06">hey this can be run concurrently because</span> <span data-start="391.06" data-end="393.459">this increment operation doesn't affect</span> <span data-start="393.459" data-end="394.99">anything else apart from computing the</span> <span data-start="394.99" data-end="396.729">result it's completely side-effect free</span> <span data-start="396.729" data-end="399.879">I could do this map in parallel you as a</span> <span data-start="399.879" data-end="402.879">programmer you know that the JIT doesn't</span> <span data-start="402.879" data-end="405.58">and that's what we want to change we</span> <span data-start="405.58" data-end="407.379">want to give the programmer means to</span> <span data-start="407.379" data-end="409.629">tell the JIT that this function actually</span> <span data-start="409.629" data-end="412.12">can be run in parallel and that's what</span> </p>
<p><span data-start="412.12" data-end="414.879">River Trail is about River Trail is</span> <span data-start="414.879" data-end="417.43">about bringing data perl programming to</span> <span data-start="417.43" data-end="419.8">javascript and the important thing here</span> <span data-start="419.8" data-end="422.889">is bringing it to javascript designing</span> <span data-start="422.889" data-end="424.899">it for javascript so we didn't want to</span> <span data-start="424.899" data-end="427.33">do yet another data parallel programming</span> <span data-start="427.33" data-end="429.31">model there are sufficiently many out</span> <span data-start="429.31" data-end="431.589">there what we really wanted wanted to</span> <span data-start="431.589" data-end="433.59">create a data perl programming model</span> <span data-start="433.59" data-end="436.47">for javascript specifically designed for</span> <span data-start="436.47" data-end="438.87">javascript and to give you an idea what</span> <span data-start="438.87" data-end="440.97">that means for us what designing for</span> <span data-start="440.97" data-end="443.07">javascript meant when we did this work I</span> <span data-start="443.07" data-end="445.08">want to share some of our design goals</span> <span data-start="445.08" data-end="447.77">that we used when we designed retro and</span> <span data-start="447.77" data-end="450.87">the first one which probably is pretty</span> <span data-start="450.87" data-end="453.51">obvious if you read it is that we wanted</span> <span data-start="453.51" data-end="456.48">rivotril to look like JavaScript and to</span> <span data-start="456.48" data-end="459.72">behave like JavaScript it sounds simple</span> <span data-start="459.72" data-end="461.19">but actually that's probably the thing</span> <span data-start="461.19" data-end="463.71">that most influenced the design of river</span> <span data-start="463.71" data-end="465.72">trail on the end because we did not</span> <span data-start="465.72" data-end="467.88">deviate from this goal even for</span> <span data-start="467.88" data-end="469.74">performance reasons we always stuck to</span> <span data-start="469.74" data-end="471.12">the fact that it should be like</span> </p>
<p><span data-start="471.12" data-end="474.15">JavaScript so all called you right when</span> <span data-start="474.15" data-end="476.34">you use rubber trail still it's just</span> <span data-start="476.34" data-end="478.98">JavaScript there is nothing new to the</span> <span data-start="478.98" data-end="480.51">point that we even have a library</span> <span data-start="480.51" data-end="482.1">implementation of river trail that's</span> <span data-start="482.1" data-end="483.75">completely written in JavaScript it</span> <span data-start="483.75" data-end="485.94">completely adheres to the semantics of</span> </p>
<p><span data-start="485.94" data-end="488.67">JavaScript the only problem is it's not</span> <span data-start="488.67" data-end="492.09">concurrent also we had this rule of no</span> <span data-start="492.09" data-end="494.13">surprise so we wanted the system</span> <span data-start="494.13" data-end="496.17">whenever we left what jobs could</span> <span data-start="496.17" data-end="498.12">traditionally did whenever we introduced</span> <span data-start="498.12" data-end="500.46">concurrency to behave in a way that</span> <span data-start="500.46" data-end="505.47">developers would expect our second goal</span> <span data-start="505.47" data-end="507.03">is we wanted to keep the deterministic</span> <span data-start="507.03" data-end="509.07">execution model because that really</span> <span data-start="509.07" data-end="510.84">makes concurrent programming so much</span> <span data-start="510.84" data-end="513.87">easier so we designed the system that</span> <span data-start="513.87" data-end="515.46">you do not have race conditions that you</span> <span data-start="515.46" data-end="517.8">do not have debt log however there is no</span> <span data-start="517.8" data-end="520.77">magic things you simply cannot change</span> <span data-start="520.77" data-end="523.71">our that floating point operations can</span> <span data-start="523.71" data-end="525.51">introduce non determinism if you do</span> <span data-start="525.51" data-end="527.97">reduction operations so this limits of</span> <span data-start="527.97" data-end="530.37">the hot where we cannot change but other</span> <span data-start="530.37" data-end="532.17">than that we've designed the system so</span> <span data-start="532.17" data-end="534.09">that it is termina stick as far as it</span> <span data-start="534.09" data-end="538.71">could be and lastly and this is probably</span> <span data-start="538.71" data-end="540.51">the most important thing if you look at</span> <span data-start="540.51" data-end="542.82">your betrayal as a web technology we</span> <span data-start="542.82" data-end="545.84">wanted it to be as safe and as secure as</span> <span data-start="545.84" data-end="549.93">javascript is so River Trail is no more</span> <span data-start="549.93" data-end="552.42">secure than JavaScript but importantly</span> <span data-start="552.42" data-end="555.51">it's not less secure either we still use</span> <span data-start="555.51" data-end="557.94">a fully managed one time we still have</span> <span data-start="557.94" data-end="560.49">no pointers whatsoever and we do full</span> <span data-start="560.49" data-end="561.87">bounds checking there are no overflows</span> <span data-start="561.87" data-end="564.36">sober betrayal is really suitable as an</span> <span data-start="564.36" data-end="565.8">open web technology</span> <span data-start="565.8" data-end="568.78">so this is the design this is how we</span> <span data-start="568.78" data-end="571.33">wanted river gel to be let me need to</span> <span data-start="571.33" data-end="573.25">tell you a little bit what roofie looks</span> <span data-start="573.25" data-end="575.17">like and it will start a very conceptual</span> <span data-start="575.17" data-end="577.39">level so road trail has three components</span> <span data-start="577.39" data-end="580.27">that it's built off we call this a three</span> <span data-start="580.27" data-end="582.4">pillar approach because the API really</span> <span data-start="582.4" data-end="584.26">rests on these three components that's</span> <span data-start="584.26" data-end="586.66">all you need to understand first we have</span> <span data-start="586.66" data-end="588.4">a new data structure that's parallel</span> <span data-start="588.4" data-end="589.95">array and you can think of this</span> <span data-start="589.95" data-end="591.93">essentially like a JavaScript array</span> <span data-start="591.93" data-end="594.04">there are some very important</span> <span data-start="594.04" data-end="595.33">differences that make concurrent</span> <span data-start="595.33" data-end="597.97">execution a lot easier first of all</span> <span data-start="597.97" data-end="600.4">parallel rays I immutable and that means</span> <span data-start="600.4" data-end="601.96">as soon as you've created a parallel</span> <span data-start="601.96" data-end="604.12">array you can know language change its</span> <span data-start="604.12" data-end="606.52">values they're really simplifies the</span> <span data-start="606.52" data-end="608.8">implementation of an optimizing but</span> <span data-start="608.8" data-end="610.54">it helps developers as well the reason</span> <span data-start="610.54" data-end="612.19">about their code to understand what it</span> <span data-start="612.19" data-end="614.62">means but it's run concurrently the</span> <span data-start="614.62" data-end="616.54">second thing we've decided is pearl rays</span> <span data-start="616.54" data-end="619.06">are dense so JavaScript arrays have this</span> <span data-start="619.06" data-end="622.57">property that they can have poles now as</span> </p>
<p><span data-start="622.57" data-end="623.86">I said we want to do data pro</span> <span data-start="623.86" data-end="626.02">programming and in that kind of context</span> <span data-start="626.02" data-end="628.78">the data really induces your computation</span> <span data-start="628.78" data-end="631.21">so if you have holes in your array that</span> <span data-start="631.21" data-end="633.13">means that for certain elements no</span> <span data-start="633.13" data-end="635.26">computation will happen we just think</span> <span data-start="635.26" data-end="637.08">that's very difficult to understand and</span> <span data-start="637.08" data-end="639.85">obviously as implementers it makes</span> <span data-start="639.85" data-end="641.53">implementing it easier as well if you</span> <span data-start="641.53" data-end="644.56">don't have holes and lastly parallel</span> <span data-start="644.56" data-end="646.45">rays are homogeneous and what this means</span> <span data-start="646.45" data-end="648.64">at least is that if you have a nested</span> <span data-start="648.64" data-end="650.92">array then all the elements of the outer</span> <span data-start="650.92" data-end="654.58">array have the same length so you can</span> <span data-start="654.58" data-end="656.71">think of a prole array like a 3 by 4</span> <span data-start="656.71" data-end="659.8">matrix for example you have three outer</span> <span data-start="659.8" data-end="662.29">elements and each of them is a 4 element</span> <span data-start="662.29" data-end="664.33">array again so we have this homogeneity</span> <span data-start="664.33" data-end="666.28">requirement and again this comes from</span> <span data-start="666.28" data-end="668.14">the fact that your data induces your</span> <span data-start="668.14" data-end="670.9">computation if you have irregular shapes</span> <span data-start="670.9" data-end="673.06">it's very difficult to understand and</span> <span data-start="673.06" data-end="676.15">think about what's actually going on so</span> <span data-start="676.15" data-end="677.68">once you have the data structure you can</span> <span data-start="677.68" data-end="679.81">actually create it that's the parallel</span> <span data-start="679.81" data-end="681.79">the code you write you just take an</span> <span data-start="681.79" data-end="683.41">array-like w anything that has a length</span> <span data-start="683.41" data-end="686.32">on some properties parser to the apparel</span> <span data-start="686.32" data-end="687.82">array constructor which creates a</span> <span data-start="687.82" data-end="691.54">mutable version of it and fills all</span> <span data-start="691.54" data-end="695.24">holes what the pro</span> <span data-start="695.24" data-end="697.459">raised her well is it has six methods</span> <span data-start="697.459" data-end="700.67">and we've chosen map combined reduce</span> <span data-start="700.67" data-end="702.29">can't filter and scatter as the</span> <span data-start="702.29" data-end="704.089">perimeters we want to support because</span> <span data-start="704.089" data-end="705.62">these are the basic skeletons for</span> <span data-start="705.62" data-end="707.36">parallel computation in a day to pearl</span> <span data-start="707.36" data-end="709.76">setting there are more maybe you could</span> <span data-start="709.76" data-end="711.38">choose a different set but we believe</span> <span data-start="711.38" data-end="712.88">there's a sufficient to write most kinds</span> <span data-start="712.88" data-end="715.85">of applications also it's important to</span> <span data-start="715.85" data-end="718.22">note here that we've deliberately chosen</span> <span data-start="718.22" data-end="720.95">these high level primitives we've</span> <span data-start="720.95" data-end="722.209">deliberately chosen something like</span> <span data-start="722.209" data-end="724.279">reduce and the reason for that is we</span> <span data-start="724.279" data-end="726.26">wanted to have portability across</span> <span data-start="726.26" data-end="728.66">hardware platforms if you think about</span> <span data-start="728.66" data-end="730.58">reduce for example you really implement</span> <span data-start="730.58" data-end="732.26">that quite differently depending on</span> <span data-start="732.26" data-end="734.33">whether you run on a GPU or on a</span> <span data-start="734.33" data-end="736.04">multi-core where they have simply</span> <span data-start="736.04" data-end="738.62">instructions or not having that at this</span> <span data-start="738.62" data-end="740.899">high level allows us to retarget the</span> <span data-start="740.899" data-end="743.029">code dynamically to the different kinds</span> <span data-start="743.029" data-end="744.89">of architectures we run on so this is</span> <span data-start="744.89" data-end="747.5">truly performance portable as far as we</span> <span data-start="747.5" data-end="751.25">can make it and lastly we have the</span> <span data-start="751.25" data-end="753.649">concept of nine elemental function so</span> <span data-start="753.649" data-end="755.12">elemental functions are typically the</span> <span data-start="755.12" data-end="756.47">things that actually do the compute</span> <span data-start="756.47" data-end="758.899">workout if you think of a map the</span> <span data-start="758.899" data-end="760.19">elemental function is the function that</span> <span data-start="760.19" data-end="762.05">takes an element from the source array</span> <span data-start="762.05" data-end="764">and computes the corresponding element</span> <span data-start="764" data-end="766.55">in the result what's very specific about</span> <span data-start="766.55" data-end="769.01">our elemental functions is that require</span> <span data-start="769.01" data-end="771.23">them to be side-effect free and that's</span> <span data-start="771.23" data-end="773.06">what makes concurrent execution possible</span> <span data-start="773.06" data-end="775.7">in the first place we even go to the</span> <span data-start="775.7" data-end="776.899">point that if they're not side-effect</span> <span data-start="776.899" data-end="778.01">free you will get an error either</span> <span data-start="778.01" data-end="780.529">statically or at runtime so really</span> <span data-start="780.529" data-end="783.8">enforce side-effect rhiness but I want</span> <span data-start="783.8" data-end="785.209">to reiterate here once more they are</span> <span data-start="785.209" data-end="787.04">still written poorly in JavaScript</span> <span data-start="787.04" data-end="788.779">there's nothing new there so you just</span> <span data-start="788.779" data-end="790.87">take your existing JavaScript functions</span> <span data-start="790.87" data-end="794.45">coming back to my increment here this is</span> <span data-start="794.45" data-end="795.44">what it would look like now you know</span> <span data-start="795.44" data-end="797.48">called parallel or a top map you still</span> <span data-start="797.48" data-end="798.92">give it the same increment function as</span> <span data-start="798.92" data-end="801.56">before but now the JIT knows that this</span> <span data-start="801.56" data-end="804.05">function is side-effect free or because</span> <span data-start="804.05" data-end="806.87">you promised him to be to be so victory</span> <span data-start="806.87" data-end="808.61">by calling a parallel radar map as</span> <span data-start="808.61" data-end="810.649">opposed to narrate of map and this</span> <span data-start="810.649" data-end="814.61">enables concurrent execution ok</span> <span data-start="814.61" data-end="816.38">increment isn't really a good example</span> <span data-start="816.38" data-end="818.81">it's kind of boring so I wanted to do</span> <span data-start="818.81" data-end="820.64">something more sophisticated a little</span> <span data-start="820.64" data-end="822.95">bit to do that I need to give you</span> <span data-start="822.95" data-end="825.709">slightly more insight into the API but I</span> <span data-start="825.709" data-end="827.6">wouldn't won't go any deeper than</span> <span data-start="827.6" data-end="830.209">this slide I talked already about the</span> <span data-start="830.209" data-end="832.13">constructor form so you create a pro</span> <span data-start="832.13" data-end="834.139">array by passing an array-like value to</span> <span data-start="834.139" data-end="835.819">a pearl or a constructor there are</span> <span data-start="835.819" data-end="837.05">different constructor forms for</span> <span data-start="837.05" data-end="838.459">different kinds of things like a canvas</span> <span data-start="838.459" data-end="841.069">or more generic instructors but this is</span> <span data-start="841.069" data-end="842.62">the only one I will use in my example</span> <span data-start="842.62" data-end="845.959">and then you have certain properties the</span> <span data-start="845.959" data-end="847.639">length property everybody will know that</span> <span data-start="847.639" data-end="850.009">ever used in array it just gives you the</span> <span data-start="850.009" data-end="851.899">length of the outermost axis of your</span> <span data-start="851.899" data-end="854.42">array as our apparel arrays are</span> <span data-start="854.42" data-end="856.37">homogeneous we can give you some more we</span> <span data-start="856.37" data-end="858.17">can give you a shape and the shape is</span> <span data-start="858.17" data-end="859.91">essentially a condensed description of</span> <span data-start="859.91" data-end="862.06">the whole structure of your nested array</span> <span data-start="862.06" data-end="864.41">think again you have a 3 by 4 matrix</span> <span data-start="864.41" data-end="867.92">that would have a shape three four so</span> <span data-start="867.92" data-end="869.569">the shape property gives you a vector</span> <span data-start="869.569" data-end="871.22">that describes the whole shape of the</span> </p>
<p><span data-start="871.22" data-end="872.959">Ray that comes in handy if you want to</span> <span data-start="872.959" data-end="874.79">write code on multi-dimensional arrays</span> <span data-start="874.79" data-end="877.85">as I said we have a set of methods for</span> <span data-start="877.85" data-end="879.11">parallel compute and the one I want to</span> <span data-start="879.11" data-end="882.47">highlight here is combined so combined</span> <span data-start="882.47" data-end="885.56">takes takes two arguments a depth and a</span> <span data-start="885.56" data-end="887.509">function and what it implements it is a</span> <span data-start="887.509" data-end="889.97">parallel map with an index so you can</span> <span data-start="889.97" data-end="893.06">think of it it just as map the first</span> <span data-start="893.06" data-end="895.339">argument this depth tells the runtime</span> <span data-start="895.339" data-end="897.92">how deep you want a trade so if you have</span> <span data-start="897.92" data-end="899.6">a matrix and you want to iterate on</span> <span data-start="899.6" data-end="901.49">every element you would use a depth of 2</span> <span data-start="901.49" data-end="903.62">if you have a matrix and you want</span> <span data-start="903.62" data-end="906.199">iterate in every row it use a depth of 1</span> <span data-start="906.199" data-end="908.66">so it's kind of the nesting of your</span> <span data-start="908.66" data-end="912.23">looping construct the second argument</span> <span data-start="912.23" data-end="914.87">here is a function and again it's an</span> <span data-start="914.87" data-end="916.339">elemental function and in the case of</span> <span data-start="916.339" data-end="918.68">combined this function is called with</span> <span data-start="918.68" data-end="922.339">the indices of the current element also</span> <span data-start="922.339" data-end="924.709">what we do is during the execution of</span> <span data-start="924.709" data-end="927.259">the elemental function this is bound to</span> <span data-start="927.259" data-end="929.509">the sauce pearl array and that really</span> <span data-start="929.509" data-end="931.37">allows for a very compositional style of</span> <span data-start="931.37" data-end="934.009">programming so this is all you need to</span> <span data-start="934.009" data-end="936.319">know this is all the API you need to</span> <span data-start="936.319" data-end="939.709">know let's do an example I've looked</span> <span data-start="939.709" data-end="941">long to find an example they actually</span> <span data-start="941" data-end="943.519">kind of fits on a slide and in the end I</span> <span data-start="943.519" data-end="946.009">decided for edge detection which is a</span> <span data-start="946.009" data-end="948.139">nice image processing filter and it has</span> <span data-start="948.139" data-end="949.759">the property that we've implemented demo</span> <span data-start="949.759" data-end="951.319">and it's it's an on our website so if</span> <span data-start="951.319" data-end="953.3">you look at it so you don't need to</span> <span data-start="953.3" data-end="955.04">understand the full code here you can</span> <span data-start="955.04" data-end="958.069">later look at it scrutinize it what I</span> <span data-start="958.069" data-end="960.38">want you to concentrate on really as the</span> <span data-start="960.38" data-end="961">computation</span> <span data-start="961" data-end="963.82">workload here so if you look at that</span> <span data-start="963.82" data-end="967.39">it's JavaScript there's nothing new</span> <span data-start="967.39" data-end="969.45">there so how do you do edge detection</span> <span data-start="969.45" data-end="972.16">well it's a convolution style</span> <span data-start="972.16" data-end="974.32">computation so to compute one element of</span> <span data-start="974.32" data-end="976.63">the result you have to look at all the</span> <span data-start="976.63" data-end="979.3">neighbors in their sorcery and then you</span> <span data-start="979.3" data-end="981.61">compute to wait sums of those neighbors</span> <span data-start="981.61" data-end="983.14">and that's essentially what this follow</span> <span data-start="983.14" data-end="985.9">puters it looks a bit complicated</span> <span data-start="985.9" data-end="987.82">because it has to do boundary conditions</span> <span data-start="987.82" data-end="989.86">if you if your element you looking at is</span> <span data-start="989.86" data-end="991.9">the boundary of your image because then</span> <span data-start="991.9" data-end="993.25">there are certain neighbors just don't</span> <span data-start="993.25" data-end="995.53">exist but in essence you just compute</span> <span data-start="995.53" data-end="997.96">it's running some of the current element</span> <span data-start="997.96" data-end="1000.48">that's this this year at the two</span> <span data-start="1000.48" data-end="1006.45">positions x this so go matrix and the</span> <span data-start="1006.45" data-end="1007.83">solar matrix here is just a closure</span> <span data-start="1007.83" data-end="1009.45">bound variable again it's just</span> </p>
<p><span data-start="1009.45" data-end="1011.22">JavaScript you have all the features of</span> <span data-start="1011.22" data-end="1012.93">JavaScript at hands you can use closer</span> <span data-start="1012.93" data-end="1015.63">bond variables you have this will</span> <span data-start="1015.63" data-end="1020.19">function everything you want so if you</span> <span data-start="1020.19" data-end="1022.59">not trust me that this is the edge</span> <span data-start="1022.59" data-end="1024.72">detection for a single element how do</span> <span data-start="1024.72" data-end="1027.87">you lift this to an entire array well</span> <span data-start="1027.87" data-end="1029.339">you can write that obviously in</span> <span data-start="1029.339" data-end="1034.14">JavaScript today and that's one way you</span> <span data-start="1034.14" data-end="1035.73">could write it down so first you need</span> <span data-start="1035.73" data-end="1037.29">some image data right you compute your</span> <span data-start="1037.29" data-end="1039.15">gray scale image data from the canvas</span> <span data-start="1039.15" data-end="1042.089">element whatever you fancy and then you</span> <span data-start="1042.089" data-end="1044.91">have this for loop nest that essentially</span> <span data-start="1044.91" data-end="1046.92">iterates over your gray scale data and</span> <span data-start="1046.92" data-end="1049.2">looks at each and every element and then</span> <span data-start="1049.2" data-end="1051.84">calls the edge kernel function on it you</span> <span data-start="1051.84" data-end="1053.31">have to do some allocation of the result</span> <span data-start="1053.31" data-end="1054.78">and all these things but that's</span> <span data-start="1054.78" data-end="1056.19">essentially the pattern you implement</span> <span data-start="1056.19" data-end="1057.84">you have a nested for loop and get it</span> <span data-start="1057.84" data-end="1060.54">right over all the elements again as a</span> <span data-start="1060.54" data-end="1062.01">clever programmer if you look at this</span> <span data-start="1062.01" data-end="1065.22">code you will instantly see yeah that</span> <span data-start="1065.22" data-end="1067.38">can be run in parallel because I know H</span> <span data-start="1067.38" data-end="1070.83">detection has no side effects however</span> <span data-start="1070.83" data-end="1073.65">your jit won't know so how do I tell the</span> </p>
<p><span data-start="1073.65" data-end="1077.67">JIT I use a river trail primitive so as</span> <span data-start="1077.67" data-end="1079.59">before you'd first take your gray scale</span> <span data-start="1079.59" data-end="1082.38">data you create a parallel array out of</span> <span data-start="1082.38" data-end="1084.54">it which makes it immutable fills all</span> <span data-start="1084.54" data-end="1087.05">holes and checks its homogeneous and</span> <span data-start="1087.05" data-end="1091.2">then you call this combined method with</span> <span data-start="1091.2" data-end="1093.06">the depth of 2 because you want to look</span> <span data-start="1093.06" data-end="1094.8">at every single element of your</span> <span data-start="1094.8" data-end="1098.34">2d image data and your edge como as the</span> <span data-start="1098.34" data-end="1101.55">function in this now tells the JIT you</span> <span data-start="1101.55" data-end="1104.85">can execute this concurrently so it's</span> <span data-start="1104.85" data-end="1106.56">one thing to design a language and to</span> <span data-start="1106.56" data-end="1107.91">say okay you can write all these cool</span> <span data-start="1107.91" data-end="1109.65">things the other thing is to actually</span> <span data-start="1109.65" data-end="1111.93">make it happen so we implemented a</span> <span data-start="1111.93" data-end="1114.06">prototype for all this which comes as a</span> </p>
<p><span data-start="1114.06" data-end="1116.97">Firefox extension so how does this work</span> <span data-start="1116.97" data-end="1121.59">how do you compile this kind of code let</span> <span data-start="1121.59" data-end="1123.75">me quickly give you a view Nigeria so</span> <span data-start="1123.75" data-end="1124.98">here's your initial setting you have</span> <span data-start="1124.98" data-end="1126.99">your JavaScript engine which is running</span> <span data-start="1126.99" data-end="1129.15">your script and use the developer have</span> <span data-start="1129.15" data-end="1131.82">pulled a call it to combine into it so</span> <span data-start="1131.82" data-end="1134.01">what we do is at runtime we intercept</span> <span data-start="1134.01" data-end="1136.71">that call of combining and we pause your</span> <span data-start="1136.71" data-end="1138.75">script and instead start our compiler</span> <span data-start="1138.75" data-end="1140.58">which is completely written in</span> <span data-start="1140.58" data-end="1143.01">JavaScript as well so our compiler runs</span> <span data-start="1143.01" data-end="1145.34">inside of the JavaScript engine and the</span> <span data-start="1145.34" data-end="1147.6">compiler will just look at your your</span> <span data-start="1147.6" data-end="1149.28">kernel function your elemental function</span> <span data-start="1149.28" data-end="1151.32">and do a couple of analysis and</span> <span data-start="1151.32" data-end="1153.3">representation changes so first we do a</span> <span data-start="1153.3" data-end="1155.31">type inference and we've really dramatic</span> <span data-start="1155.31" data-end="1157.5">drastically specialized to argument</span> <span data-start="1157.5" data-end="1159.72">types under a sizes that's one thing</span> <span data-start="1159.72" data-end="1162.51">that gives us good performance so once</span> <span data-start="1162.51" data-end="1164.1">we know what the Rays are in the game</span> <span data-start="1164.1" data-end="1166.02">what their type are and what their sizes</span> <span data-start="1166.02" data-end="1168.21">are we do a representation analysis and</span> <span data-start="1168.21" data-end="1170.58">that's nice because as soon as you know</span> <span data-start="1170.58" data-end="1172.23">that something is an integer you can</span> <span data-start="1172.23" data-end="1174.18">vary a lot more efficiently select</span> <span data-start="1174.18" data-end="1176.13">elements using it as an index that's</span> <span data-start="1176.13" data-end="1178.38">just an artifact of how the JavaScript</span> <span data-start="1178.38" data-end="1181.53">semantics work as a next step we do</span> <span data-start="1181.53" data-end="1183.09">static memory allocation and the reason</span> <span data-start="1183.09" data-end="1184.5">we do that is because we just were too</span> <span data-start="1184.5" data-end="1186.05">lazy to implement a full-blown</span> <span data-start="1186.05" data-end="1189.6">concurrent elevator so instead we</span> <span data-start="1189.6" data-end="1192.02">allocate a looking steadily on the here</span> <span data-start="1192.02" data-end="1193.62">finally we do a bounced check</span> <span data-start="1193.62" data-end="1194.79">elimination because we're</span> <span data-start="1194.79" data-end="1196.43">representational is we already computed</span> <span data-start="1196.43" data-end="1199.05">the bounds of all local variables were</span> <span data-start="1199.05" data-end="1200.49">possible so we just used that</span> <span data-start="1200.49" data-end="1202.17">information but the last the most</span> <span data-start="1202.17" data-end="1204.18">important step is we create opencl code</span> <span data-start="1204.18" data-end="1207.72">so why opencl well this is a prototype</span> <span data-start="1207.72" data-end="1210.03">so when we did this we didn't really</span> <span data-start="1210.03" data-end="1212.13">have the time to implement a full-blown</span> <span data-start="1212.13" data-end="1214.35">compiler back end we didn't want to</span> <span data-start="1214.35" data-end="1216.03">implement a compiler that takes the code</span> <span data-start="1216.03" data-end="1217.95">to binary we didn't want to implement a</span> <span data-start="1217.95" data-end="1220.17">compiler that has a complete runtime</span> <span data-start="1220.17" data-end="1222.6">system for concurrent execution so what</span> <span data-start="1222.6" data-end="1224.64">we did instead is we reused an existing</span> <span data-start="1224.64" data-end="1226.77">opencl compiler but there's really no</span> <span data-start="1226.77" data-end="1228.6">reason why this should be</span> <span data-start="1228.6" data-end="1231.15">mended on top of opencl as a matter of</span> <span data-start="1231.15" data-end="1233.52">fact as soon as you leave the opencl of</span> <span data-start="1233.52" data-end="1235.68">sphere and implement this directly you</span> <span data-start="1235.68" data-end="1237.12">can probably do a much better job</span> <span data-start="1237.12" data-end="1239.61">because opencl is quite a straitjacket</span> <span data-start="1239.61" data-end="1241.56">that's not very well suited for</span> <span data-start="1241.56" data-end="1245.57">javascript anyhow so we end up with</span> <span data-start="1245.57" data-end="1248.79">opencl so we've taken your edge colonel</span> <span data-start="1248.79" data-end="1252.33">with compiler to open CL what's next so</span> <span data-start="1252.33" data-end="1254.61">far everything is written in JavaScript</span> <span data-start="1254.61" data-end="1257.01">and all this runs on probably every</span> <span data-start="1257.01" data-end="1258.78">browser that has a compliant JavaScript</span> <span data-start="1258.78" data-end="1261.27">engine but we need to execute it now</span> <span data-start="1261.27" data-end="1263.46">somehow and that's where our Firefox</span> <span data-start="1263.46" data-end="1266.82">extension comes into play what that does</span> <span data-start="1266.82" data-end="1269.67">it hooks up an open CL runtime to the</span> </p>
<p><span data-start="1269.67" data-end="1272.46">Firefox browser and it allows us to</span> <span data-start="1272.46" data-end="1274.53">actually execute that opencl colonel on</span> <span data-start="1274.53" data-end="1277.65">multi-core CPUs possibly using simply</span> <span data-start="1277.65" data-end="1279.9">extensions and in the future maybe even</span> <span data-start="1279.9" data-end="1283.53">on GPUs so once we've made that jump</span> <span data-start="1283.53" data-end="1285.57">into the opencl stag and your chrome has</span> <span data-start="1285.57" data-end="1289.02">been executed we have a result we inject</span> <span data-start="1289.02" data-end="1291.87">that back into the original script that</span> <span data-start="1291.87" data-end="1293.31">you had written as the result of</span> <span data-start="1293.31" data-end="1295.89">javascript operation cleaning up all the</span> <span data-start="1295.89" data-end="1297.69">stack we've created and resume your</span> <span data-start="1297.69" data-end="1300.42">kernel that's in its essence how we</span> <span data-start="1300.42" data-end="1302.73">execute rivotril program in our</span> <span data-start="1302.73" data-end="1306.15">prototype and you might say okay now</span> <span data-start="1306.15" data-end="1307.71">that's quite some effort you go through</span> <span data-start="1307.71" data-end="1310.41">here why do that why do i change my code</span> <span data-start="1310.41" data-end="1311.97">why do you write this complicated</span> <span data-start="1311.97" data-end="1314.31">prototype compiler it's a very simple</span> <span data-start="1314.31" data-end="1318.24">answer and let's be so we've done this</span> <span data-start="1318.24" data-end="1320.33">demo which is a particle simulation and</span> <span data-start="1320.33" data-end="1323.34">the rendering is done in WebGL but the</span> <span data-start="1323.34" data-end="1325.05">compute model behind it is completely</span> </p>
<p><span data-start="1325.05" data-end="1328.74">CPU pod so it's a big o n squared</span> <span data-start="1328.74" data-end="1330.83">algorithm that computes the physics and</span> <span data-start="1330.83" data-end="1335.39">we see using it for quad core Core i7 a</span> <span data-start="1335.39" data-end="1338.94">14-fold speed up I've decided not to</span> <span data-start="1338.94" data-end="1340.65">show the demo life on stage here today</span> <span data-start="1340.65" data-end="1343.13">but instead I just ask you go to the URL</span> <span data-start="1343.13" data-end="1346.2">install the extension to Firefox see for</span> <span data-start="1346.2" data-end="1349.2">yourself if you have a Mac that's all</span> <span data-start="1349.2" data-end="1350.7">you need to install because Matt comes</span> <span data-start="1350.7" data-end="1353.01">with opencl pre-installed if you have a</span> </p>
<p><span data-start="1353.01" data-end="1355.02">Windows machine you can download the</span> <span data-start="1355.02" data-end="1357.24">internal until opencl SDK and take a</span> <span data-start="1357.24" data-end="1360.06">look right away so go to the URL tried</span> <span data-start="1360.06" data-end="1362.72">it yourself see the speed ups</span> <span data-start="1362.72" data-end="1365.1">there is kind of a super linear speed-up</span> <span data-start="1365.1" data-end="1367.17">here because on a quad core you get a 14</span> <span data-start="1367.17" data-end="1370.71">type speed up part of that is due to us</span> <span data-start="1370.71" data-end="1372.63">having a better chip because we know a</span> <span data-start="1372.63" data-end="1374.91">lot more about the code and our compiler</span> <span data-start="1374.91" data-end="1378.39">only supports a subset of JavaScript but</span> <span data-start="1378.39" data-end="1380.46">a significant fraction really is</span> <span data-start="1380.46" data-end="1382.65">concurrency so if you try this in a dual</span> <span data-start="1382.65" data-end="1387.76">core or quad core you will see the scale</span> <span data-start="1387.77" data-end="1391.23">so here's the status quo here's where we</span> <span data-start="1391.23" data-end="1394.19">are we have this open source</span> <span data-start="1394.19" data-end="1396.3">implementation as a firefox extension</span> <span data-start="1396.3" data-end="1398.31">it's on github you can download it you</span> <span data-start="1398.31" data-end="1400.47">can play with it we have some pre-built</span> <span data-start="1400.47" data-end="1403.86">binaries for Firefox 10 we have a</span> <span data-start="1403.86" data-end="1405.9">sequential library so in case you do not</span> <span data-start="1405.9" data-end="1407.7">have Firefox you can still run the demo</span> <span data-start="1407.7" data-end="1409.38">it will just be significantly slower</span> <span data-start="1409.38" data-end="1412.56">because it's not accelerated we have</span> <span data-start="1412.56" data-end="1414.45">created a draft specification that goes</span> <span data-start="1414.45" data-end="1417.15">beyond our prototype and that</span> <span data-start="1417.15" data-end="1419.01">specification is available on github and</span> <span data-start="1419.01" data-end="1421.53">since this morning it has been promoted</span> <span data-start="1421.53" data-end="1424.29">to the actor script wiki as the data</span> <span data-start="1424.29" data-end="1427.38">parallelism strawman so we're heading to</span> <span data-start="1427.38" data-end="1430.05">acma to get the standardized to get this</span> <span data-start="1430.05" data-end="1435.51">discussed to get this adopted also we</span> <span data-start="1435.51" data-end="1437.07">have created the first implementation</span> <span data-start="1437.07" data-end="1439.71">for spider monkey which we use to play</span> <span data-start="1439.71" data-end="1441.48">with the API because that allows us to</span> <span data-start="1441.48" data-end="1443.85">do the full implementation of the actual</span> </p>
<p><span data-start="1443.85" data-end="1445.65">API without any limitations the</span> <span data-start="1445.65" data-end="1449.37">prototype may have however why I'm</span> <span data-start="1449.37" data-end="1451.68">really here today what's the point of</span> <span data-start="1451.68" data-end="1455.4">this talk is your engagement it's one</span> <span data-start="1455.4" data-end="1456.99">thing to design the language extension</span> <span data-start="1456.99" data-end="1459.27">it's one thing to do a prototype but the</span> <span data-start="1459.27" data-end="1460.95">important thing is is this good for</span> <span data-start="1460.95" data-end="1463.26">developers does this work does this</span> <span data-start="1463.26" data-end="1466.17">solve your problems so take a look play</span> <span data-start="1466.17" data-end="1468.03">with it come to me and we'll be running</span> <span data-start="1468.03" data-end="1470.25">around here for the next two days and</span> <span data-start="1470.25" data-end="1472.95">talk to me give me your experience we</span> <span data-start="1472.95" data-end="1474.87">really are interested in developer</span> <span data-start="1474.87" data-end="1478.14">feedback so I have a couple more minutes</span> <span data-start="1478.14" data-end="1480.78">to talk and this is really the status</span> <span data-start="1480.78" data-end="1483.24">quo this is what we've done so far but I</span> <span data-start="1483.24" data-end="1485.13">thought this is jas phone so maybe I</span> <span data-start="1485.13" data-end="1486.33">should talk about something that we're</span> <span data-start="1486.33" data-end="1489.33">cooking right now so let's go a bit</span> <span data-start="1489.33" data-end="1492">beyond the status quo in roseville and I</span> <span data-start="1492" data-end="1493.65">have to say this is really this is</span> <span data-start="1493.65" data-end="1494.79">latest news right</span> <span data-start="1494.79" data-end="1496.89">the soup we've been cooking a little but</span> <span data-start="1496.89" data-end="1498.6">there may be a raw ingredients here it's</span> <span data-start="1498.6" data-end="1502.44">not fully done yet how this work then</span> <span data-start="1502.44" data-end="1504.75">started I was reading this blog post by</span> <span data-start="1504.75" data-end="1507.24">a Yenta offered and he kind of talked</span> <span data-start="1507.24" data-end="1509.61">about how can we bring simdi to</span> </p>
<p><span data-start="1509.61" data-end="1511.8">JavaScript and that it's kind of the</span> <span data-start="1511.8" data-end="1513.96">next point here and at Apollo program in</span> <span data-start="1513.96" data-end="1516.33">view one and he's really interested in</span> <span data-start="1516.33" data-end="1518.19">sindhi for his audio applications</span> <span data-start="1518.19" data-end="1520.56">because he has this very fine grained</span> <span data-start="1520.56" data-end="1522.39">data parallelism that he wants to</span> <span data-start="1522.39" data-end="1526.05">express but cannot do so today and we</span> <span data-start="1526.05" data-end="1527.43">can really recommend this blog post</span> <span data-start="1527.43" data-end="1529.83">because it's great survey of the design</span> <span data-start="1529.83" data-end="1531.81">possibilities you have if you want to do</span> <span data-start="1531.81" data-end="1535.53">simdi in javascript you have raw sm</span> <span data-start="1535.53" data-end="1537.78">blade right thick inline assembly you</span> <span data-start="1537.78" data-end="1539.13">write some javascript code and then</span> <span data-start="1539.13" data-end="1540.39">there's some inline assembly in there</span> <span data-start="1540.39" data-end="1543.9">that tells how to do Cindy yeah you will</span> <span data-start="1543.9" data-end="1546.03">have pretty good performance but that</span> <span data-start="1546.03" data-end="1548.22">won't be portable and it for sure won't</span> <span data-start="1548.22" data-end="1552.3">be safe you can have standard intrinsic</span> <span data-start="1552.3" data-end="1554.85">so that gives you kind of some kind of</span> <span data-start="1554.85" data-end="1556.98">portability at least if you have the</span> <span data-start="1556.98" data-end="1559.41">same vendor of a hardware because they</span> <span data-start="1559.41" data-end="1561.15">kind of stick to the intrinsic for a</span> <span data-start="1561.15" data-end="1562.95">while but still if you have different</span> <span data-start="1562.95" data-end="1565.32">hardware vendors it's still not portable</span> <span data-start="1565.32" data-end="1567.45">and we still don't need to talk about</span> <span data-start="1567.45" data-end="1570.69">safety you could create Java specificity</span> <span data-start="1570.69" data-end="1572.61">our JavaScript specific intrinsic and</span> <span data-start="1572.61" data-end="1575.67">that would mean that you have intrinsic</span> <span data-start="1575.67" data-end="1578.97">that work across all hardware but still</span> <span data-start="1578.97" data-end="1581.61">it probably wouldn't be safe because you</span> <span data-start="1581.61" data-end="1582.96">would be still at the assembly level</span> <span data-start="1582.96" data-end="1585.75">essentially or you could create kind of</span> <span data-start="1585.75" data-end="1589.23">generic intrinsic that lifts it up to</span> <span data-start="1589.23" data-end="1591.45">the JavaScript level which would then be</span> <span data-start="1591.45" data-end="1593.82">portable it's safe but maybe you get low</span> <span data-start="1593.82" data-end="1596.46">performance and has last design choices</span> <span data-start="1596.46" data-end="1599.03">you just create a vector matrix API</span> <span data-start="1599.03" data-end="1601.23">because that's what you typically want</span> <span data-start="1601.23" data-end="1603.33">you want to do matrix vector multiply to</span> <span data-start="1603.33" data-end="1605.73">just Hotwire that into the browser but</span> <span data-start="1605.73" data-end="1607.29">that doesn't really solve the problem it</span> <span data-start="1607.29" data-end="1608.67">just solves the problem for very</span> <span data-start="1608.67" data-end="1613.65">specific set of applications so I'm most</span> <span data-start="1613.65" data-end="1615.05">interested in this generic approach</span> <span data-start="1615.05" data-end="1617.1">because I think if you do something on</span> <span data-start="1617.1" data-end="1619.23">the web it needs to be safe and needs to</span> <span data-start="1619.23" data-end="1622.23">be portable so I started thinking about</span> <span data-start="1622.23" data-end="1624.84">this and we discussed it a little and if</span> <span data-start="1624.84" data-end="1626.58">you think about simdi one thing to</span> <span data-start="1626.58" data-end="1627.85">realize this</span> <span data-start="1627.85" data-end="1630.21">it's nothing more or less than</span> <span data-start="1630.21" data-end="1634.63">small-scale beta probe ism so why then</span> <span data-start="1634.63" data-end="1636.549">can't we use River Trail which is good</span> <span data-start="1636.549" data-end="1638.38">at coarse-grained data parallelism to</span> <span data-start="1638.38" data-end="1642.46">express Cindy where's the problem so I</span> <span data-start="1642.46" data-end="1644.26">sat down I thought about you know some</span> </p>
<p><span data-start="1644.26" data-end="1646.059">Cindy intrinsics how do you write them</span> <span data-start="1646.059" data-end="1647.89">in River Trail and it turns out you can</span> <span data-start="1647.89" data-end="1650.86">actually quite neatly express them so</span> <span data-start="1650.86" data-end="1652.179">right here we have the standard add</span> <span data-start="1652.179" data-end="1654.4">intrinsic switch takes two vectors and</span> <span data-start="1654.4" data-end="1656.26">produces the element by some as a result</span> <span data-start="1656.26" data-end="1658.299">and you can write that as a road trail</span> <span data-start="1658.299" data-end="1661.33">one-liner so you take your vector a and</span> <span data-start="1661.33" data-end="1663.25">then you apply map to it with this</span> <span data-start="1663.25" data-end="1668.95">function I have to admit for brevity</span> </p>
<p><span data-start="1668.95" data-end="1670.87">I've used the arrow syntax here which is</span> <span data-start="1670.87" data-end="1673.44">not really part of JavaScript yet</span> <span data-start="1673.44" data-end="1675.46">multiplication you can write the same</span> <span data-start="1675.46" data-end="1678.19">way even shuffle which is a very common</span> <span data-start="1678.19" data-end="1680.289">vector operation you can easily express</span> <span data-start="1680.289" data-end="1682.24">in Revit well it's no longer a one liner</span> <span data-start="1682.24" data-end="1685.09">or it's a long one line but it's just a</span> <span data-start="1685.09" data-end="1687.7">comprehension constructor which takes</span> <span data-start="1687.7" data-end="1690.429">the the source array B and shuffled it</span> <span data-start="1690.429" data-end="1695.95">into the result ok so these are some</span> <span data-start="1695.95" data-end="1698.08">intrinsic but how do you write entire</span> <span data-start="1698.08" data-end="1702.49">programs so that look at matrix vector</span> <span data-start="1702.49" data-end="1706.48">multiply so how do you multiply a matrix</span> <span data-start="1706.48" data-end="1710.58">with a vector well you take each row</span> <span data-start="1710.58" data-end="1713.5">that's what this map here does it's a</span> <span data-start="1713.5" data-end="1715.419">map on the Ottomans dimension so you get</span> <span data-start="1715.419" data-end="1718.539">a row and then with that row you</span> <span data-start="1718.539" data-end="1720.159">multiply each element with the</span> <span data-start="1720.159" data-end="1721.27">corresponding element of the vector</span> <span data-start="1721.27" data-end="1726.25">that's what the internet does the</span> <span data-start="1726.25" data-end="1728.89">resulting vector you then reduce using</span> <span data-start="1728.89" data-end="1733.33">cloth at the end the outer map will</span> <span data-start="1733.33" data-end="1738.25">produce a vector which is your result so</span> <span data-start="1738.25" data-end="1740.289">if you have a clever jit it might see</span> <span data-start="1740.289" data-end="1742.929">that actually the input data it's all</span> <span data-start="1742.929" data-end="1744.88">these nicely for element thingies it's</span> <span data-start="1744.88" data-end="1747.25">all very small and the programmer told</span> <span data-start="1747.25" data-end="1749.02">me it's a pearl array there must be</span> <span data-start="1749.02" data-end="1751.14">something concurrent going on here and</span> <span data-start="1751.14" data-end="1754.24">hey this mad I can map it to assume the</span> <span data-start="1754.24" data-end="1757.179">intrinsic so if you have a clever jit</span> <span data-start="1757.179" data-end="1759.19">you can compile this kind of code to</span> </p>
<p><span data-start="1759.19" data-end="1761.37">Cindy code</span> <span data-start="1761.37" data-end="1763.54">well the harvesting isn't really good</span> <span data-start="1763.54" data-end="1765.58">here because of all the operations only</span> <span data-start="1765.58" data-end="1767.68">one map can be done in simdi well that's</span> <span data-start="1767.68" data-end="1769.3">a problem of simply because there is no</span> <span data-start="1769.3" data-end="1772.57">intrinsic for reduce but the season</span> <span data-start="1772.57" data-end="1774.52">cindy programmer he knows well i just</span> <span data-start="1774.52" data-end="1776.62">rewrite my coat slightly i use color</span> <span data-start="1776.62" data-end="1779.77">major psytrance post the matrix and now</span> <span data-start="1779.77" data-end="1782.23">if i do this index map on the outside I</span> <span data-start="1782.23" data-end="1785.77">get a column and I multiply that column</span> <span data-start="1785.77" data-end="1787.84">with a corresponding element of the</span> <span data-start="1787.84" data-end="1791.11">vector and then I do a vector reduction</span> <span data-start="1791.11" data-end="1794.71">on the results the result is still the</span> <span data-start="1794.71" data-end="1797.2">same but now I can do two of these maps</span> <span data-start="1797.2" data-end="1799.6">in parallel I can do Stu simdi</span> <span data-start="1799.6" data-end="1802.66">operations so why did I show you all the</span> <span data-start="1802.66" data-end="1804.85">sim decode I just want to give you a</span> <span data-start="1804.85" data-end="1806.77">feeling that with River Trail you could</span> <span data-start="1806.77" data-end="1811.57">actually write simdi codes and that's</span> <span data-start="1811.57" data-end="1814.66">that's a first it's a really a step</span> <span data-start="1814.66" data-end="1816.43">forward because right now a programmer</span> <span data-start="1816.43" data-end="1819.79">cannot bright simdi code at all however</span> <span data-start="1819.79" data-end="1821.74">there's no magic dust if I just shown</span> <span data-start="1821.74" data-end="1823.72">you it's still the programmer who has</span> <span data-start="1823.72" data-end="1825.91">two brightest in decode the programmer</span> <span data-start="1825.91" data-end="1828.22">has to choose the day layout so it's not</span> <span data-start="1828.22" data-end="1830.5">as nice and easy as coarse grained data</span> <span data-start="1830.5" data-end="1832.66">parallelism but it still it enables you</span> <span data-start="1832.66" data-end="1837.85">to write that code also this is probably</span> <span data-start="1837.85" data-end="1839.98">performance portable in theory but</span> <span data-start="1839.98" data-end="1842.35">whether it happens in reality is still</span> <span data-start="1842.35" data-end="1844.93">an open question because Cindy really is</span> <span data-start="1844.93" data-end="1846.7">different or different platforms and</span> <span data-start="1846.7" data-end="1848.95">probably the JIT implementations would</span> <span data-start="1848.95" data-end="1852.01">differ too so one jit might detect a</span> <span data-start="1852.01" data-end="1853.54">pattern where's the average it might not</span> <span data-start="1853.54" data-end="1857.68">and the final question and that's again</span> <span data-start="1857.68" data-end="1860.14">a question for you here can we encode</span> <span data-start="1860.14" data-end="1862.6">sufficiently many patterns so do you</span> <span data-start="1862.6" data-end="1864.16">have an application where you would</span> <span data-start="1864.16" data-end="1865.81">really like to have some Cindy code in</span> <span data-start="1865.81" data-end="1868.21">there but you have to use some C++ today</span> <span data-start="1868.21" data-end="1870.46">do you have these codes and can you</span> <span data-start="1870.46" data-end="1882.67">express that in River Trail</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
