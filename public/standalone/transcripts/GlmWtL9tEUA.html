<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GlmWtL9tEUA</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/GlmWtL9tEUA?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.32" data-end="2.07">[Music]</span> <span data-start="2.07" data-end="3.84">[Applause]</span> <span data-start="3.84" data-end="5.66">[Music]</span> <span data-start="5.66" data-end="7.41">[Applause]</span> <span data-start="7.41" data-end="9.28">[Music]</span> <span data-start="9.28" data-end="11.02">[Applause]</span> <span data-start="11.02" data-end="12.78">[Music]</span> <span data-start="12.78" data-end="16.86">[Applause]</span> <span data-start="16.87" data-end="25.939">[Music]</span> <span data-start="25.949" data-end="29.38">all right thank you very much</span> <span data-start="29.38" data-end="31.329">where should I put this I'm gonna put it</span> <span data-start="31.329" data-end="33.55">up here y'all can check that out all</span> <span data-start="33.55" data-end="34.629">right so welcome to my talk</span> <span data-start="34.629" data-end="37.18">this is universal react applications</span> <span data-start="37.18" data-end="40.93">with redux which is the most buzzword II</span> <span data-start="40.93" data-end="43.27">title I can think of in the 5 seconds I</span> <span data-start="43.27" data-end="46.69">was trying to sign up for a talk what</span> <span data-start="46.69" data-end="49.89">happened oh we went to sleep</span> <span data-start="49.89" data-end="55.57">are we back yet alright we're back I'll</span> <span data-start="55.57" data-end="59.23">try to remember to poke that thing okay</span> <span data-start="59.23" data-end="61.87">so by way of introduction my name is</span> </p>
<p><span data-start="61.87" data-end="64.089">Brad I build things with react and redux</span> <span data-start="64.089" data-end="66.49">at spread fast which is based in Austin</span> <span data-start="66.49" data-end="69.57">Texas anyone from Austin shout out</span> <span data-start="69.57" data-end="73.03">excellent yes it's too hot there though</span> <span data-start="73.03" data-end="77.11">so but good on you my first passion is</span> <span data-start="77.11" data-end="79.479">actually music that's the most</span> <span data-start="79.479" data-end="80.799">embarrassing photo I've ever shown this</span> <span data-start="80.799" data-end="83.229">many people you can't really see it but</span> <span data-start="83.229" data-end="84.49">that is a true mullet</span> <span data-start="84.49" data-end="86.22">there there's a little bit you can see</span> <span data-start="86.22" data-end="88.09">and I obviously know what I'm doing</span> <span data-start="88.09" data-end="90.24">because the guitar is upside down I</span> <span data-start="90.24" data-end="92.59">promise you I know more now so if you're</span> <span data-start="92.59" data-end="94">into like guitar shredding videos</span> <span data-start="94" data-end="97">there's an Instagram shameless plug and</span> </p>
<p><span data-start="97" data-end="101.47">I'm also recently a dad this is my son</span> <span data-start="101.47" data-end="104.68">Remington thank you</span> <span data-start="104.68" data-end="108.189">as of July 1st so if my talk seems</span> <span data-start="108.189" data-end="112.57">underprepared it's his fault so I just</span> <span data-start="112.57" data-end="114.58">want to start out by saying I love Redux</span> <span data-start="114.58" data-end="117.22">how many of you use Redux at work I'm</span> <span data-start="117.22" data-end="118.78">assuming most of you because you came to</span> <span data-start="118.78" data-end="120.97">this talk hopefully but I just want to</span> <span data-start="120.97" data-end="122.14">say that because I feel like it gets a</span> <span data-start="122.14" data-end="124.03">lot of crap and I think it's awesome and</span> <span data-start="124.03" data-end="126.329">it has made my day job a lot easier</span> <span data-start="126.329" data-end="132.849">so why this talk I saw this tweet when</span> <span data-start="132.849" data-end="133.48">did this happen</span> </p>
<p><span data-start="133.48" data-end="136.829">I don't know a little bit ago mid-july</span> <span data-start="136.829" data-end="139.09">was asking is anyone doing this is</span> <span data-start="139.09" data-end="140.86">anyone using Redux on the web and</span> <span data-start="140.86" data-end="142.51">sharing their Redux code with react</span> <span data-start="142.51" data-end="145.36">native project but not sharing you</span> <span data-start="145.36" data-end="148.3">and we've been doing this for years and</span> <span data-start="148.3" data-end="149.77">I thought is this interesting for people</span> <span data-start="149.77" data-end="151.69">to know maybe actually give an</span> <span data-start="151.69" data-end="153.58">experience report and just talk about</span> <span data-start="153.58" data-end="154.57">some of the challenges and what works</span> <span data-start="154.57" data-end="157.45">well and what doesn't so this talk might</span> <span data-start="157.45" data-end="159.19">be interesting to you if you have a</span> </p>
<p><span data-start="159.19" data-end="160.81">Redux app and you're looking about</span> <span data-start="160.81" data-end="162.31">thinking about making a mobile app</span> <span data-start="162.31" data-end="164.74">you're looking at react native maybe</span> <span data-start="164.74" data-end="166.78">you're just curious about mobile or</span> <span data-start="166.78" data-end="168.01">maybe for some other reason you're</span> <span data-start="168.01" data-end="170.17">looking to recompose your Redux</span> <span data-start="170.17" data-end="171.91">applications together into other</span> <span data-start="171.91" data-end="176.41">applications so this is kind of what's</span> <span data-start="176.41" data-end="178.03">going to be important is to understand</span> <span data-start="178.03" data-end="179.38">the decisions that we've made is to</span> <span data-start="179.38" data-end="180.88">understand the organizational structure</span> <span data-start="180.88" data-end="182.8">so for us our org kind of looks like</span> <span data-start="182.8" data-end="185.17">this we have many different web apps</span> <span data-start="185.17" data-end="187.3">that are all standardized on react and</span> <span data-start="187.3" data-end="190">redux and there's a lot of different</span> <span data-start="190" data-end="192.12">teams and they're basically independent</span> <span data-start="192.12" data-end="195.1">we have to or in the past we've had two</span> <span data-start="195.1" data-end="197.38">mobile developers a native iOS developer</span> <span data-start="197.38" data-end="199.62">and a native Android developer and they</span> <span data-start="199.62" data-end="201.76">try to keep up you can see they're very</span> <span data-start="201.76" data-end="204.61">worried about keeping up with features</span> <span data-start="204.61" data-end="206.53">that are being deployed on the web apps</span> <span data-start="206.53" data-end="209.5">and so what we've done is added a few</span> <span data-start="209.5" data-end="212.14">people like myself who are comfortable</span> <span data-start="212.14" data-end="214.72">with JavaScript also mildly comfortable</span> <span data-start="214.72" data-end="217.45">with doing native stuff and also told</span> <span data-start="217.45" data-end="219.64">the native developers they will be</span> <span data-start="219.64" data-end="221.17">writing JavaScript which you can see</span> <span data-start="221.17" data-end="225.16">they're super excited about so how does</span> <span data-start="225.16" data-end="229.54">this work here's an example here's the</span> <span data-start="229.54" data-end="231.7">web app we're using react and redux that</span> <span data-start="231.7" data-end="233.68">stuff goes through web pack there's a</span> <span data-start="233.68" data-end="235.36">bundle that gets deployed perfect you</span> <span data-start="235.36" data-end="237.85">guys know that part what we chose to do</span> <span data-start="237.85" data-end="241.84">is I'll go in and drop a rollup config</span> <span data-start="241.84" data-end="243.88">in each of those repos and make a</span> <span data-start="243.88" data-end="245.56">separate bundle that's just the stuff</span> <span data-start="245.56" data-end="247.87">that we want to consume so we'll see</span> <span data-start="247.87" data-end="249.19">what's in that bundle is just your your</span> <span data-start="249.19" data-end="251.77">reducers your actions your selectors and</span> <span data-start="251.77" data-end="253.51">there's an asterisk which we'll talk</span> <span data-start="253.51" data-end="259.359">about later so how to make a bundle it</span> <span data-start="259.359" data-end="262.24">looks something like this you create a</span> <span data-start="262.24" data-end="265.15">new entry point and then just import</span> <span data-start="265.15" data-end="267.85">just the things that you need so here</span> <span data-start="267.85" data-end="269.44">we're importing everything from this</span> <span data-start="269.44" data-end="271.21">widget reducer and we're kind of giving</span> <span data-start="271.21" data-end="272.65">ourselves some kind of standard</span> <span data-start="272.65" data-end="274.18">structure for this package is going to</span> <span data-start="274.18" data-end="275.77">export reducers and actions and</span> <span data-start="275.77" data-end="278.02">selectors you can use whatever</span> <span data-start="278.02" data-end="279.58">format organization works for you this</span> <span data-start="279.58" data-end="284.229">is just what we do and you will not want</span> <span data-start="284.229" data-end="286.419">to import everything there's going to be</span> <span data-start="286.419" data-end="287.949">stuff that's web specific like your</span> <span data-start="287.949" data-end="290.55">router reducer if you're doing that</span> <span data-start="290.55" data-end="293.889">things that are web specific that you</span> <span data-start="293.889" data-end="297.46">will not want to import so I want to</span> <span data-start="297.46" data-end="299.53">take a second and talk about why you</span> <span data-start="299.53" data-end="301.96">should bundle or why do that because</span> <span data-start="301.96" data-end="304.539">it's not actually the standard in react</span> <span data-start="304.539" data-end="306.729">native applications to bundle your</span> </p>
<p><span data-start="306.729" data-end="308.56">JavaScript most react native libraries</span> <span data-start="308.56" data-end="312.88">just ship JavaScript source why would</span> <span data-start="312.88" data-end="315.37">you do that that sounds insane it kind</span> <span data-start="315.37" data-end="318.61">of is but the reasons we chose to do a</span> <span data-start="318.61" data-end="320.86">bundle is because hey it provides us a</span> <span data-start="320.86" data-end="323.38">chance to catch things at compile time</span> <span data-start="323.38" data-end="327.19">so these are things like there was one</span> <span data-start="327.19" data-end="329.65">project that had a selector that was</span> <span data-start="329.65" data-end="332.71">returning SPG's based on some state</span> <span data-start="332.71" data-end="334.3">that's obviously not something we can</span> <span data-start="334.3" data-end="336.49">use on mobile so that had to get</span> <span data-start="336.49" data-end="338.83">reflected out into the component and so</span> <span data-start="338.83" data-end="340.449">this you have a chance now to catch</span> <span data-start="340.449" data-end="341.59">things like that that aren't going to</span> <span data-start="341.59" data-end="343.24">work on mobile at compile time</span> <span data-start="343.24" data-end="345.699">the second reason which is really the</span> <span data-start="345.699" data-end="348.88">bigger reason is that a single point of</span> <span data-start="348.88" data-end="352">entry provides you some encapsulation so</span> <span data-start="352" data-end="354.849">that a developer can't just go require</span> <span data-start="354.849" data-end="356.529">into source of your application that you</span> <span data-start="356.529" data-end="357.909">shipped and use something you didn't</span> <span data-start="357.909" data-end="359.889">intend to be used in your mobile</span> <span data-start="359.889" data-end="361.719">application so I think those two things</span> <span data-start="361.719" data-end="365.099">were enough to make that choice for us</span> <span data-start="365.099" data-end="368.169">some of the issues with bundling the ES</span> <span data-start="368.169" data-end="372.009">target is weird but it's not that weird</span> <span data-start="372.009" data-end="375.58">there's react native implements its own</span> <span data-start="375.58" data-end="379.09">version of Babel helpers and so you want</span> <span data-start="379.09" data-end="380.71">to use external helpers it also</span> <span data-start="380.71" data-end="383.139">implements async/await natively and</span> <span data-start="383.139" data-end="385.69">that's because of performance and</span> <span data-start="385.69" data-end="388.96">reasons and so you don't want you want</span> <span data-start="388.96" data-end="390.279">to use external helpers and you don't</span> <span data-start="390.279" data-end="392.71">want to compile async/await</span> <span data-start="392.71" data-end="394.3">and so it's actually really easy to do</span> <span data-start="394.3" data-end="396.699">that if you're using roll-up at least</span> <span data-start="396.699" data-end="398.56">you say I want external helpers this is</span> <span data-start="398.56" data-end="400.449">your babel config and roll up and you</span> <span data-start="400.449" data-end="402.759">say transform syntax async functions so</span> <span data-start="402.759" data-end="403.719">the battle knows what you're talking</span> <span data-start="403.719" data-end="406.509">about but it won't touch it and then you</span> <span data-start="406.509" data-end="407.889">have something that you can consume in</span> <span data-start="407.889" data-end="411.669">your react native application some other</span> <span data-start="411.669" data-end="412.3">gotchas</span> <span data-start="412.3" data-end="414.22">you're obviously if you're not familiar</span> </p>
<p><span data-start="414.22" data-end="416.74">I'll just do a quick review the react</span> <span data-start="416.74" data-end="418.99">native is running in a JavaScript</span> <span data-start="418.99" data-end="422.62">context that does not have any access to</span> <span data-start="422.62" data-end="426.1">Dom api's or any other wave api's that</span> <span data-start="426.1" data-end="427.6">you're normally used to it is a</span> <span data-start="427.6" data-end="428.41">bare-bones</span> <span data-start="428.41" data-end="430.93">like JavaScript interpreter environment</span> <span data-start="430.93" data-end="433.66">so anything in your web code that is</span> <span data-start="433.66" data-end="436.33">referencing window or Dom like if you're</span> <span data-start="436.33" data-end="439.51">doing local storage get item as the</span> <span data-start="439.51" data-end="441.34">default value in your reducer which you</span> <span data-start="441.34" data-end="442.63">shouldn't do but if you're doing that</span> <span data-start="442.63" data-end="446.5">and I've seen that move that out just</span> <span data-start="446.5" data-end="447.79">move that into your components anything</span> <span data-start="447.79" data-end="449.32">that's web specific should probably live</span> <span data-start="449.32" data-end="453.33">in your components anyways so that's my</span> <span data-start="453.33" data-end="455.56">thought there the other part of this</span> <span data-start="455.56" data-end="457.06">which is really sort of the same thing</span> <span data-start="457.06" data-end="460">is if you have some static config so</span> <span data-start="460" data-end="463.66">most web projects can just generate a</span> <span data-start="463.66" data-end="465.25">bundle with some static config and</span> <span data-start="465.25" data-end="468.46">that's going to be the same for each</span> <span data-start="468.46" data-end="469.75">host you just make a different bundle</span> <span data-start="469.75" data-end="471.43">for each host that you deploy to right</span> <span data-start="471.43" data-end="473.83">so you can do all that at compile time</span> <span data-start="473.83" data-end="478.84">and that's easy at on mobile you're</span> <span data-start="478.84" data-end="481.18">probably going to want to hit multiple</span> <span data-start="481.18" data-end="482.26">different environments and switch</span> <span data-start="482.26" data-end="484.33">between them at runtime right you're</span> <span data-start="484.33" data-end="485.56">going to want to have some kind of like</span> <span data-start="485.56" data-end="487.18">dev settings interface where you say</span> <span data-start="487.18" data-end="489.7">okay go look at this other environment</span> <span data-start="489.7" data-end="491.95">or just for the pure effect that you</span> <span data-start="491.95" data-end="495.19">might hit you might be doing like third</span> <span data-start="495.19" data-end="496.9">tier domain stuff where this company is</span> <span data-start="496.9" data-end="498.04">on this domain this company is on that</span> <span data-start="498.04" data-end="499.6">domain and you might need to switch</span> <span data-start="499.6" data-end="502.18">between them and that's now needs to</span> <span data-start="502.18" data-end="503.77">happen at runtime rather than on at</span> <span data-start="503.77" data-end="505.3">compile time so you have to care about</span> <span data-start="505.3" data-end="507.34">that and so the solution for that is</span> <span data-start="507.34" data-end="508.72">really simple you just move it to your</span> <span data-start="508.72" data-end="510.55">components this is one possible solution</span> <span data-start="510.55" data-end="514.9">that we do is to just do the same static</span> <span data-start="514.9" data-end="516.46">config but then dispatch that from your</span> <span data-start="516.46" data-end="518.44">components and move that stuff to state</span> <span data-start="518.44" data-end="521.08">and then in your actions later on you</span> <span data-start="521.08" data-end="522.7">can select that information out of state</span> <span data-start="522.7" data-end="525.7">and it's all in sync and nice there's</span> <span data-start="525.7" data-end="526.66">probably some other ways you can solve</span> <span data-start="526.66" data-end="530.17">that but that's how we did it another</span> <span data-start="530.17" data-end="532.69">thing declaring externals this is not</span> <span data-start="532.69" data-end="535.42">really an issue so much as just a</span> <span data-start="535.42" data-end="536.89">reality so it's something to be aware of</span> <span data-start="536.89" data-end="538.45">and you should probably be aware of this</span> <span data-start="538.45" data-end="542.08">with your web bundles anyways is do you</span> <span data-start="542.08" data-end="543.31">want to declare all of your period</span> <span data-start="543.31" data-end="544.87">appendices to be external because you</span> <span data-start="544.87" data-end="546.1">can definitely end up ship</span> <span data-start="546.1" data-end="549.22">like react Tom and you didn't mean to in</span> <span data-start="549.22" data-end="551.35">your bundle and you don't want to do</span> <span data-start="551.35" data-end="553.11">that so just a friendly reminder</span> <span data-start="553.11" data-end="557.47">probably the biggest well this is not</span> <span data-start="557.47" data-end="559.72">really a huge issue at the end of the</span> <span data-start="559.72" data-end="562.24">day you can't use NPM link with the</span> <span data-start="562.24" data-end="563.769">react native packager it just doesn't</span> <span data-start="563.769" data-end="565.18">work so if you were thinking that you</span> <span data-start="565.18" data-end="567.61">could debug creating your entry point</span> <span data-start="567.61" data-end="570.339">file and your bundle and use NPM link to</span> <span data-start="570.339" data-end="572.17">nicely do that while you're consuming it</span> <span data-start="572.17" data-end="574.11">and test it in the consuming application</span> <span data-start="574.11" data-end="576.339">you can't do that and you're gonna end</span> <span data-start="576.339" data-end="577.959">up copying files on the file system</span> <span data-start="577.959" data-end="580.959">that's you'll notice this is issue</span> <span data-start="580.959" data-end="582.73">number one when they moved to Metro</span> <span data-start="582.73" data-end="585.069">bundler it was copied over from the old</span> <span data-start="585.069" data-end="588.85">react native repo so I guess you could</span> <span data-start="588.85" data-end="590.11">be a hero if you want to fix this I'm</span> <span data-start="590.11" data-end="591.94">sure there's many people who would give</span> <span data-start="591.94" data-end="597.35">you beer ah let's take a break</span> <span data-start="597.36" data-end="600.1">you will see him twice more I apologize</span> <span data-start="600.1" data-end="604.48">if you don't think he's cute he's pretty</span> <span data-start="604.48" data-end="606.24">cute though</span> <span data-start="606.24" data-end="613.6">alright so using the bundle so now we've</span> <span data-start="613.6" data-end="616.3">moved from your web application who's</span> <span data-start="616.3" data-end="617.98">making a bundle and publishing some code</span> <span data-start="617.98" data-end="620.529">to your mobile application that's trying</span> <span data-start="620.529" data-end="623.829">to consume it and so you may have only</span> <span data-start="623.829" data-end="624.939">one application that you're trying to</span> <span data-start="624.939" data-end="626.529">share in our case we were trying to</span> <span data-start="626.529" data-end="628.689">compose multiple web applications down</span> <span data-start="628.689" data-end="630.73">into one mobile application that is</span> <span data-start="630.73" data-end="632.439">trying to implement all of them in one</span> <span data-start="632.439" data-end="636.43">native app and so here you can see we're</span> <span data-start="636.43" data-end="639.699">importing reducers we're aliasing them</span> <span data-start="639.699" data-end="642.13">and we're combining them into one</span> <span data-start="642.13" data-end="643.81">reducer and you notice we export</span> <span data-start="643.81" data-end="646.089">selectors to get at each of those pieces</span> <span data-start="646.089" data-end="648.63">of state which will be important later</span> <span data-start="648.63" data-end="651.67">and then this is what a container would</span> <span data-start="651.67" data-end="653.139">look like basically what you're doing</span> <span data-start="653.139" data-end="655.62">most of your work in the mobile app is</span> <span data-start="655.62" data-end="657.85">wiring up new containers and creating</span> <span data-start="657.85" data-end="661.6">new user interface in components and</span> <span data-start="661.6" data-end="663.579">you're reusing the same actions and</span> <span data-start="663.579" data-end="665.199">selectors that you would use so here</span> <span data-start="665.199" data-end="667.36">we're importing some actions we're</span> <span data-start="667.36" data-end="670.839">importing some selectors and we create a</span> <span data-start="670.839" data-end="672.79">container and this is too much code for</span> <span data-start="672.79" data-end="674.589">one slide I apologize this is the</span> <span data-start="674.589" data-end="677.889">important bit you'll notice here we're</span> <span data-start="677.889" data-end="679.45">using reselect as anyone</span> <span data-start="679.45" data-end="681.13">use reselect how many of you are</span> <span data-start="681.13" data-end="683.98">familiar with reselect have used it okay</span> <span data-start="683.98" data-end="688.18">some hands not a ton of hands basically</span> <span data-start="688.18" data-end="690.04">the important thing to know is that a</span> <span data-start="690.04" data-end="692.65">selector is doing something to get State</span> <span data-start="692.65" data-end="694.57">right it's it's grabbing your state and</span> <span data-start="694.57" data-end="696.16">it's going dot whatever it out whatever</span> <span data-start="696.16" data-end="697.95">that whatever to get you some value out</span> <span data-start="697.95" data-end="700.63">and it does fancier things because</span> <span data-start="700.63" data-end="704.02">performance so what we're doing here you</span> <span data-start="704.02" data-end="706.9">notice we're wrapping our selectors that</span> <span data-start="706.9" data-end="709.72">we imported in a transform to get at the</span> <span data-start="709.72" data-end="712.48">state and that's because we moved State</span> <span data-start="712.48" data-end="714.7">around right those selectors would be</span> <span data-start="714.7" data-end="716.62">looking at the wrong state shape if we</span> <span data-start="716.62" data-end="718.36">didn't do this but this is an easy</span> <span data-start="718.36" data-end="721.42">solution and this that selector that we</span> <span data-start="721.42" data-end="724.48">exported before it can be a simple just</span> <span data-start="724.48" data-end="726.97">property access like it is here and it</span> <span data-start="726.97" data-end="728.86">might actually be more complex and we'll</span> <span data-start="728.86" data-end="732.07">see an example of why later on so great</span> <span data-start="732.07" data-end="736.62">this works we're done thank you bye</span> <span data-start="736.62" data-end="741.19">could this be a trap maybe there's some</span> <span data-start="741.19" data-end="744.85">gotchas so like we were just talking</span> <span data-start="744.85" data-end="748">about how many of you use Redux func to</span> <span data-start="748" data-end="752.1">do your async stuff so a lot of people</span> <span data-start="752.1" data-end="757.26">quick survey redux promise no no means</span> </p>
<p><span data-start="757.26" data-end="761.29">Sagas okay I think you have this problem</span> <span data-start="761.29" data-end="762.82">everywhere if you're changing your state</span> <span data-start="762.82" data-end="764.56">shape this is how we solved it with</span> <span data-start="764.56" data-end="767.89">thunks because we use thunks so the</span> <span data-start="767.89" data-end="769.3">selectors that are in your thunks</span> <span data-start="769.3" data-end="770.56">remember they're in your web app code</span> <span data-start="770.56" data-end="772.84">they depend on the shape of the state</span> <span data-start="772.84" data-end="775">that your web app expected in the first</span> <span data-start="775" data-end="776.92">place when it was written and so it's</span> <span data-start="776.92" data-end="778.9">coupled to that state shape so just an</span> <span data-start="778.9" data-end="780.55">example here let's pretend that load</span> <span data-start="780.55" data-end="782.8">which widgets uses the get page number</span> <span data-start="782.8" data-end="784.81">selector right this is going to blow up</span> <span data-start="784.81" data-end="785.98">when you try to run it in your mobile</span> <span data-start="785.98" data-end="787.87">application if you move that state</span> <span data-start="787.87" data-end="790.45">around like we did so how do you fix</span> <span data-start="790.45" data-end="794.5">this this is a bad name for a thing I'm</span> <span data-start="794.5" data-end="796.48">sorry naming is hard but this is the</span> <span data-start="796.48" data-end="799.44">name that I came up with a func adaptor</span> <span data-start="799.44" data-end="802">basically what it does is it wraps your</span> <span data-start="802" data-end="804.25">thunk it returns you another thunk you</span> <span data-start="804.25" data-end="806.29">give it a transform and it'll make sure</span> <span data-start="806.29" data-end="808.09">that when your thunk calls get state and</span> <span data-start="808.09" data-end="811.15">any it gets the transformed state and</span> <span data-start="811.15" data-end="813.43">not your original station</span> <span data-start="813.43" data-end="814.84">and then it also makes sure that when</span> <span data-start="814.84" data-end="816.43">you dispatch other thunks from that</span> <span data-start="816.43" data-end="818.89">thunk that those also get the transform</span> <span data-start="818.89" data-end="822.79">state and this works this is an example</span> <span data-start="822.79" data-end="825.61">of usage pretend that that create func</span> <span data-start="825.61" data-end="827.59">adapter exists and it does that what I</span> <span data-start="827.59" data-end="830.26">just described so you can it works kind</span> <span data-start="830.26" data-end="832">of like connect where you call it with</span> <span data-start="832" data-end="833.38">the transform it gives you a function</span> <span data-start="833.38" data-end="835.81">that you can then use to wrap your</span> <span data-start="835.81" data-end="838.69">thunks and so that's what that looks</span> <span data-start="838.69" data-end="841.3">like you can just copy this code if you</span> <span data-start="841.3" data-end="843.19">want it's just it's a small function</span> <span data-start="843.19" data-end="846.1">it's not a big deal but that exists okay</span> <span data-start="846.1" data-end="850.42">so if you we we survived that our app</span> <span data-start="850.42" data-end="853.21">can now run it can be compiled consumed</span> <span data-start="853.21" data-end="855.07">and we can actually run and dispatch</span> <span data-start="855.07" data-end="864.07">actions and things work okay so Q he's</span> <span data-start="864.07" data-end="870.37">so fat all right so this next section of</span> <span data-start="870.37" data-end="873.49">things is going to be more less like</span> <span data-start="873.49" data-end="874.9">issues and fixing things because we</span> <span data-start="874.9" data-end="876.94">already got our app working there's</span> <span data-start="876.94" data-end="878.32">going to be situations where either</span> <span data-start="878.32" data-end="880.48">because of design or because of what you</span> <span data-start="880.48" data-end="883.89">want to achieve you're going to want to</span> <span data-start="883.89" data-end="885.97">augment the behavior or enhance the</span> <span data-start="885.97" data-end="887.89">behavior that the web application gave</span> <span data-start="887.89" data-end="889.42">you to do something that's more specific</span> <span data-start="889.42" data-end="891.7">to what you want on mobile and you want</span> <span data-start="891.7" data-end="894.4">to try to do that in as least as little</span> <span data-start="894.4" data-end="897.87">obtrusive not intrusive ly as possible</span> <span data-start="897.87" data-end="900.19">so that these are the there's an example</span> <span data-start="900.19" data-end="904.12">of that so on your web application you</span> <span data-start="904.12" data-end="905.79">might have like a search and filter and</span> <span data-start="905.79" data-end="907.93">those changes are happening live you</span> <span data-start="907.93" data-end="910.18">click the buttons the request has made</span> <span data-start="910.18" data-end="912.79">it you see the results it's all changing</span> <span data-start="912.79" data-end="914.68">live but on mobile your designs maybe</span> <span data-start="914.68" data-end="917.17">have like a cancel apply pattern where</span> <span data-start="917.17" data-end="918.49">you don't want to actually make the</span> <span data-start="918.49" data-end="919.839">request until later and you want to be</span> <span data-start="919.839" data-end="923.55">able to cancel back to some old state</span> <span data-start="923.55" data-end="925.93">that's not functionality that your web</span> <span data-start="925.93" data-end="928.33">app built and you shouldn't necessarily</span> <span data-start="928.33" data-end="930.31">have to refactor your entire web app</span> <span data-start="930.31" data-end="933.76">just to get this on mobile right so how</span> <span data-start="933.76" data-end="937.3">could we do this we can use a</span> <span data-start="937.3" data-end="939.37">higher-order reducer reducer enhancer or</span> <span data-start="939.37" data-end="941.8">whatever word you want to call that this</span> <span data-start="941.8" data-end="945.01">function takes this is imaginary this is</span> <span data-start="945.01" data-end="945.85">something that we've written in our</span> <span data-start="945.85" data-end="946.99">application but here it's</span> <span data-start="946.99" data-end="949.51">imaginary we're passing in a reducer</span> <span data-start="949.51" data-end="951.31">that controls some state that we want to</span> <span data-start="951.31" data-end="953.32">be able to cancel back to and it takes</span> <span data-start="953.32" data-end="956.35">an action type to mark the value of</span> <span data-start="956.35" data-end="958.149">state that you want to potentially go</span> <span data-start="958.149" data-end="960.459">back to so like this would be the action</span> <span data-start="960.459" data-end="961.87">that you fire when you navigate to that</span> <span data-start="961.87" data-end="964.51">modal screen and then it also takes a</span> <span data-start="964.51" data-end="966.52">cancel action which tells it yeah we</span> <span data-start="966.52" data-end="967.99">actually do want to cancel back please</span> <span data-start="967.99" data-end="969.58">restore the state that you marked</span> <span data-start="969.58" data-end="973.089">previously and then your state is going</span> <span data-start="973.089" data-end="975.279">to look like this right here this is it</span> <span data-start="975.279" data-end="976.93">was flow I changed it to typescript</span> <span data-start="976.93" data-end="978.61">because of the NPM talk I guess more</span> <span data-start="978.61" data-end="981.07">people use typescript and flow but</span> <span data-start="981.07" data-end="982.87">that's okay your state's gonna look</span> <span data-start="982.87" data-end="985">something like this right where your</span> <span data-start="985" data-end="986.83">state is now wrapped into properties</span> <span data-start="986.83" data-end="988.959">mark state and state and you just want</span> <span data-start="988.959" data-end="991.089">to select out the current state and</span> <span data-start="991.089" data-end="993.64">that's the situation where remember</span> <span data-start="993.64" data-end="995.98">earlier we talked about your state</span> <span data-start="995.98" data-end="997.649">selectors when you change state around</span> <span data-start="997.649" data-end="1000.029">may just be simple or they may be more</span> <span data-start="1000.029" data-end="1001.47">complex this is a case where it may be</span> <span data-start="1001.47" data-end="1003.42">more complex where you want to be able</span> <span data-start="1003.42" data-end="1007.47">to present the web applications code the</span> <span data-start="1007.47" data-end="1009.81">actual pass-through state and not this</span> <span data-start="1009.81" data-end="1013.86">cancelable State thing cool so we fixed</span> <span data-start="1013.86" data-end="1014.04">that</span> <span data-start="1014.04" data-end="1017.16">what's another use case maybe you want</span> <span data-start="1017.16" data-end="1021.3">to be able to reset data here I'm</span> <span data-start="1021.3" data-end="1022.79">talking about pagination this could be</span> <span data-start="1022.79" data-end="1025.11">any other type of situation where you</span> <span data-start="1025.11" data-end="1028.77">need to reset data say you have your web</span> <span data-start="1028.77" data-end="1030.66">app is has an interface where it's</span> <span data-start="1030.66" data-end="1033.12">paging data and because that's all they</span> <span data-start="1033.12" data-end="1034.5">were doing they're throwing the data</span> <span data-start="1034.5" data-end="1038.069">away every time you change the page but</span> <span data-start="1038.069" data-end="1039.75">on mobile the designs are that you have</span> <span data-start="1039.75" data-end="1041.339">an infinite scroll and you need to keep</span> <span data-start="1041.339" data-end="1043.41">that data around do you have to refactor</span> <span data-start="1043.41" data-end="1045.54">you could refactor your web application</span> <span data-start="1045.54" data-end="1049.19">to instead like window into that data</span> <span data-start="1049.19" data-end="1051.179">but remember we're trying to be</span> <span data-start="1051.179" data-end="1053.82">unobtrusive can we do this we can do</span> <span data-start="1053.82" data-end="1056.4">this in a similar way by in having a</span> <span data-start="1056.4" data-end="1061.08">higher-order reducer here we're here is</span> <span data-start="1061.08" data-end="1062.79">the case where we want to keep data</span> <span data-start="1062.79" data-end="1065.22">around but the consuming reducer is</span> <span data-start="1065.22" data-end="1066.9">throwing it away you know we can</span> <span data-start="1066.9" data-end="1069.42">intercept this data loaded imaginary</span> <span data-start="1069.42" data-end="1071.429">data loaded action we can get the old</span> <span data-start="1071.429" data-end="1073.71">value from state and then we can call</span> <span data-start="1073.71" data-end="1075.929">the reducer that we're consuming and do</span> <span data-start="1075.929" data-end="1077.73">some glue code to merge those together</span> <span data-start="1077.73" data-end="1079.98">which Java is pretty simple to do right</span> <span data-start="1079.98" data-end="1080.31">you</span> <span data-start="1080.31" data-end="1081.66">you're using like an immutable</span> <span data-start="1081.66" data-end="1085.5">collection you just merge those or go</span> <span data-start="1085.5" data-end="1086.28">the opposite way</span> <span data-start="1086.28" data-end="1088.65">right you could instead before you call</span> <span data-start="1088.65" data-end="1090.84">the reducer you're consuming clear out</span> <span data-start="1090.84" data-end="1094.86">the data that's there to get the paging</span> <span data-start="1094.86" data-end="1098.22">behavior and obviously you can solve</span> <span data-start="1098.22" data-end="1099.33">those in multiple different ways these</span> <span data-start="1099.33" data-end="1101.28">are examples of ways in which you can do</span> <span data-start="1101.28" data-end="1102.72">it without refactoring your web</span> <span data-start="1102.72" data-end="1104.37">application which for us was important</span> <span data-start="1104.37" data-end="1106.23">because those teams are independent of</span> <span data-start="1106.23" data-end="1108.36">the mobile team and we can't just go</span> <span data-start="1108.36" data-end="1109.71">stomping all over their code for no</span> <span data-start="1109.71" data-end="1112.17">reason even if we have what we think is</span> <span data-start="1112.17" data-end="1116.15">a good reason so this in the last part</span> <span data-start="1116.15" data-end="1118.5">just a friendly reminder that middleware</span> <span data-start="1118.5" data-end="1120.93">is cool I know some developers on my</span> <span data-start="1120.93" data-end="1122.43">team are kind of reticent to like write</span> <span data-start="1122.43" data-end="1124.92">custom middleware they think it's scary</span> <span data-start="1124.92" data-end="1126.66">it's not that scary</span> <span data-start="1126.66" data-end="1128.43">you should be using it in fact these</span> <span data-start="1128.43" data-end="1129.99">examples analytics and crash reporting</span> <span data-start="1129.99" data-end="1133.65">are right on the tutorial so friendly</span> <span data-start="1133.65" data-end="1135.9">reminder there but also you can use them</span> <span data-start="1135.9" data-end="1138.81">to implement integration with native</span> <span data-start="1138.81" data-end="1142.77">features like handoff and linking and so</span> <span data-start="1142.77" data-end="1145.26">we'll look at an example of handoff now</span> <span data-start="1145.26" data-end="1148.56">how that might work so does anyone</span> <span data-start="1148.56" data-end="1149.97">actually know what handoff is have you</span> <span data-start="1149.97" data-end="1154.35">ever actually used this feature like two</span> <span data-start="1154.35" data-end="1159.84">hands so handoff just for context is an</span> <span data-start="1159.84" data-end="1162.75">iOS feature where you can pass data</span> <span data-start="1162.75" data-end="1165.62">between your running applications and</span> <span data-start="1165.62" data-end="1168.72">generally it's for going from iOS to Mac</span> <span data-start="1168.72" data-end="1173.76">or iOS to iOS or vice versa but perhaps</span> <span data-start="1173.76" data-end="1175.26">a little-known feature of handoff is</span> <span data-start="1175.26" data-end="1177.54">that you can actually handoff from a</span> <span data-start="1177.54" data-end="1180.9">website from your domain to your native</span> <span data-start="1180.9" data-end="1183.57">application and vice versa so that if</span> <span data-start="1183.57" data-end="1186.09">someone is using your web app and they</span> <span data-start="1186.09" data-end="1187.77">pull up their phone they can actually</span> <span data-start="1187.77" data-end="1189.27">get a handoff recommendation says Oh</span> <span data-start="1189.27" data-end="1192.78">open this in my app and vice versa they</span> <span data-start="1192.78" data-end="1194.31">can be using your app on their phone and</span> <span data-start="1194.31" data-end="1195.87">then get a handoff recommendation on</span> <span data-start="1195.87" data-end="1197.46">their laptop that says go to this web</span> </p>
<p><span data-start="1197.46" data-end="1201.09">URL and that is pretty cool I think I</span> <span data-start="1201.09" data-end="1203.57">don't know why more apps don't use that</span> <span data-start="1203.57" data-end="1205.83">but we can imagine we could do this in</span> <span data-start="1205.83" data-end="1207.6">middleware without changing any of the</span> <span data-start="1207.6" data-end="1211.74">application logic code at all if we have</span> <span data-start="1211.74" data-end="1213.96">this what here is an imaginary custom</span> <span data-start="1213.96" data-end="1215.64">that we wrote just pretend this API</span> <span data-start="1215.64" data-end="1219.149">exists it basically looks like this and</span> <span data-start="1219.149" data-end="1221.07">are in our hand off middleware we could</span> <span data-start="1221.07" data-end="1223.32">you know subscribe to a hook that says</span> <span data-start="1223.32" data-end="1225.27">okay when we get a hand off event we get</span> <span data-start="1225.27" data-end="1227.52">some data in this case handing off from</span> <span data-start="1227.52" data-end="1229.289">the web will just get a URL that's the</span> <span data-start="1229.289" data-end="1231.419">only thing we'll get unfortunately but</span> <span data-start="1231.419" data-end="1233.159">we should be able to take that URL and</span> <span data-start="1233.159" data-end="1235.529">transform it into some navigation state</span> <span data-start="1235.529" data-end="1237.36">in our application which we can do just</span> <span data-start="1237.36" data-end="1239.58">by in our case we have all of our</span> <span data-start="1239.58" data-end="1242.94">navigation state inside of Redux but if</span> <span data-start="1242.94" data-end="1245.159">you were using some sort of navigator</span> <span data-start="1245.159" data-end="1246.63">pattern you could also just call</span> <span data-start="1246.63" data-end="1248.159">functions on the navigator you know do</span> <span data-start="1248.159" data-end="1249.419">whatever you need to do to restore that</span> </p>
<p><span data-start="1249.419" data-end="1252.27">URL presumably you have an analogue to</span> <span data-start="1252.27" data-end="1253.74">that URL state in your native</span> <span data-start="1253.74" data-end="1258.27">application and then going the other way</span> <span data-start="1258.27" data-end="1261.809">you can observe either you know methods</span> <span data-start="1261.809" data-end="1263.22">on your navigator hook into those calls</span> <span data-start="1263.22" data-end="1265.32">or observe navigation actions if you're</span> <span data-start="1265.32" data-end="1267.11">just dispatching navigation actions and</span> <span data-start="1267.11" data-end="1270.69">let your the handoff native module know</span> <span data-start="1270.69" data-end="1273.179">this is this is a URL you know you build</span> <span data-start="1273.179" data-end="1275.22">a URL that represents the current</span> <span data-start="1275.22" data-end="1276.779">navigation state and say that's the</span> <span data-start="1276.779" data-end="1278.64">current URL I would want the user to</span> <span data-start="1278.64" data-end="1280.77">resume â€” if they chose to do so</span> <span data-start="1280.77" data-end="1283.02">and that's it we didn't change any of</span> <span data-start="1283.02" data-end="1285.24">the web code we didn't write wrap any</span> <span data-start="1285.24" data-end="1287.94">actions or anything like that so use</span> <span data-start="1287.94" data-end="1291.929">middleware it's great cool</span> <span data-start="1291.929" data-end="1295.71">so in summary this has been a pretty big</span> <span data-start="1295.71" data-end="1298.74">success for us so far you might look at</span> <span data-start="1298.74" data-end="1300.21">the thunk adapter thing and say that's</span> <span data-start="1300.21" data-end="1302.419">crazy I can't believe you're doing that</span> <span data-start="1302.419" data-end="1304.83">and that it's a heck it probably is</span> <span data-start="1304.83" data-end="1307.26">that's okay it's working for us and</span> <span data-start="1307.26" data-end="1309.059">we're shipping a lot of code on mobile</span> <span data-start="1309.059" data-end="1309.69">really fast</span> <span data-start="1309.69" data-end="1313.35">so that's valuable some of the</span> <span data-start="1313.35" data-end="1315.96">challenges are keeping up to date with</span> <span data-start="1315.96" data-end="1319.02">the web projects there's a lot of things</span> <span data-start="1319.02" data-end="1320.49">that aren't caught in that compile step</span> <span data-start="1320.49" data-end="1322.919">that only get caught at runtime like</span> <span data-start="1322.919" data-end="1325.169">right now if they added a new if someone</span> <span data-start="1325.169" data-end="1326.82">again went into a reducer and said local</span> <span data-start="1326.82" data-end="1329.82">storage docket item it would not blow up</span> <span data-start="1329.82" data-end="1331.35">until we pulled in the new version of</span> <span data-start="1331.35" data-end="1332.85">the package and then we would have to go</span> <span data-start="1332.85" data-end="1337.47">back and fix it and then do it again so</span> <span data-start="1337.47" data-end="1339.6">that's kind of an annoying thing and is</span> <span data-start="1339.6" data-end="1341.7">just kind of a manual process of talking</span> <span data-start="1341.7" data-end="1342.809">to the teams and seeing what they're</span> <span data-start="1342.809" data-end="1345.419">working on so that could be better also</span> <span data-start="1345.419" data-end="1347.25">training I don't know if you guys have</span> <span data-start="1347.25" data-end="1347.79">found this</span> <span data-start="1347.79" data-end="1350.07">training people in react and redux if</span> <span data-start="1350.07" data-end="1352.17">they are not familiar with functional</span> <span data-start="1352.17" data-end="1354.93">programming is hard it takes a little</span> <span data-start="1354.93" data-end="1356.76">bit longer than I would assume it does</span> <span data-start="1356.76" data-end="1361.02">and that's especially true for remember</span> <span data-start="1361.02" data-end="1362.61">our excited mobile developers who were</span> <span data-start="1362.61" data-end="1365.33">thrilled to be riding with Jas before</span> <span data-start="1365.33" data-end="1367.77">it's especially true for them because if</span> <span data-start="1367.77" data-end="1369.57">you've been in that world that's a very</span> <span data-start="1369.57" data-end="1371.88">object oriented this is very very</span> <span data-start="1371.88" data-end="1372.51">different</span> <span data-start="1372.51" data-end="1375.69">and it is hard for them to learn they're</span> <span data-start="1375.69" data-end="1378.93">smart people obviously but it's just a</span> <span data-start="1378.93" data-end="1380.25">hard thing it's a complete paradigm</span> <span data-start="1380.25" data-end="1382.47">shift and so that is a challenge not</span> <span data-start="1382.47" data-end="1385.5">insurmountable but is a challenge some</span> <span data-start="1385.5" data-end="1388.98">future things that we would like to do</span> <span data-start="1388.98" data-end="1392.67">have automatic pull requests when new</span> <span data-start="1392.67" data-end="1394.11">packages are deployed this is just kind</span> <span data-start="1394.11" data-end="1395.79">of like a nice logistical thing that</span> <span data-start="1395.79" data-end="1397.92">could be great and this means we could</span> <span data-start="1397.92" data-end="1399.6">also write integration tests with their</span> <span data-start="1399.6" data-end="1401.52">thunks and make sure that everything</span> <span data-start="1401.52" data-end="1403.16">works right</span> <span data-start="1403.16" data-end="1405.45">then there's acceptance testing going</span> <span data-start="1405.45" data-end="1407.07">one step further acceptance testing on</span> <span data-start="1407.07" data-end="1410.52">mobile is hard because there at least</span> <span data-start="1410.52" data-end="1413.3">with react native there isn't a way to</span> <span data-start="1413.3" data-end="1416.43">do this headless Lee you have to use a</span> <span data-start="1416.43" data-end="1419.16">simulator or you'd have to go like use</span> <span data-start="1419.16" data-end="1421.2">react native web and render your mobile</span> <span data-start="1421.2" data-end="1423.63">application in a webview and then use</span> <span data-start="1423.63" data-end="1425.61">the web tools to do acceptance testing</span> <span data-start="1425.61" data-end="1429.63">which is seems to me too much work to</span> <span data-start="1429.63" data-end="1431.82">maintain just to get acceptance testing</span> <span data-start="1431.82" data-end="1434.01">on your mobile application so you're</span> <span data-start="1434.01" data-end="1435.93">stuck with like running in simulator and</span> <span data-start="1435.93" data-end="1440.82">using those api's which is hard that's</span> <span data-start="1440.82" data-end="1442.05">just a challenge but something that we</span> <span data-start="1442.05" data-end="1445.08">would like to solve and like I mentioned</span> <span data-start="1445.08" data-end="1447.45">before catching more things at bundle</span> <span data-start="1447.45" data-end="1450.36">time caching references to window</span> <span data-start="1450.36" data-end="1452.85">objects or Dom API is that or SVG's</span> <span data-start="1452.85" data-end="1455.58">things that we don't that are going to</span> <span data-start="1455.58" data-end="1457.53">fail at runtime we'd like to move that</span> <span data-start="1457.53" data-end="1459.9">catch to compile time if possible and</span> <span data-start="1459.9" data-end="1465.45">and then lastly I'm going to go next</span> <span data-start="1465.45" data-end="1466.38">door and learn about how I should</span> <span data-start="1466.38" data-end="1468.42">replace Redux with rxjs because</span> <span data-start="1468.42" data-end="1471.96">apparently that's the new hotness that's</span> <span data-start="1471.96" data-end="1474">it for me and a little bit early please</span> <span data-start="1474" data-end="1476.37">if you have questions I really want to</span> <span data-start="1476.37" data-end="1477.75">talk about all this stuff and if there</span> <span data-start="1477.75" data-end="1479.04">are better ways to do it please come</span> <span data-start="1479.04" data-end="1480.54">tell me if you're doing this I would</span> <span data-start="1480.54" data-end="1481.47">love to hear about that thing</span> <span data-start="1481.47" data-end="1482.85">to you very much</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
