<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>StN9QKnhhHc</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/StN9QKnhhHc?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="9.2" data-end="12.8">Hi, I'm James.</span> <span data-start="12.8" data-end="15.69">I'm here to talk to you about breaking changes.</span> <span data-start="15.69" data-end="20.27">To provide a bit of context and introduce myself, I am the creator of and maintainer</span> <span data-start="20.27" data-end="27.49">of the this set of MPM packages that provide WebSocket messaging, various layers of that</span> <span data-start="27.49" data-end="28.49">protocol.</span> <span data-start="28.49" data-end="30.59">They're widely used by different projects.</span> <span data-start="30.59" data-end="36.429">They generate about eight million downloads a week between them, and I've been maintaining</span> <span data-start="36.429" data-end="41">these pretty much since Node was released, so since early 2010.</span> <span data-start="41" data-end="45.75">So this is a reflection of my experience as an open-source maintainer of seeing things</span> <span data-start="45.75" data-end="49.389">change over time, and what the effects of that are.</span> </p>
<p><span data-start="49.389" data-end="51.309">An additional bit of context.</span> <span data-start="51.309" data-end="55.409">This talk should not be construed as a complaint about how things work.</span> <span data-start="55.409" data-end="59.929">We should be really grateful for all the software that we get for free that lets us do loads</span> <span data-start="59.929" data-end="60.929">of amazing stuff.</span> <span data-start="60.929" data-end="67.57">I'm trying to reflect on again my own experience rather than bashing anybody else and saying</span> <span data-start="67.57" data-end="68.57">you're doing this wrong.</span> </p>
<p><span data-start="68.57" data-end="72.78">It's how can we reflect and improve what we are doing?</span> <span data-start="72.78" data-end="78.95">Okay, so, with that out of the way, what do we mean by "breaking"?</span> <span data-start="78.95" data-end="86.1">Consider this module at the top that has a method called "get", and it takes a URL and</span> <span data-start="86.1" data-end="93.34">makes an HTTP request of the URL and invokes a callback with a status code which I've hard-coded</span> <span data-start="93.34" data-end="95.27">here as a number.</span> <span data-start="95.27" data-end="100.83">Let's say we change that number 404 and replace it with the string 404.</span> <span data-start="100.83" data-end="102.78">Do we think that is breaking change or not?</span> <span data-start="102.78" data-end="105.37">To answer that, we have to look at some use cases.</span> <span data-start="105.37" data-end="110.07">If something is calling this function, and it's using the weaker quality operator to</span> <span data-start="110.07" data-end="114.8">compare the numbers, that will keep working, because, in JavaScript, a number is week weakly</span> <span data-start="114.8" data-end="116.39">equal to its string representation.</span> </p>
<p><span data-start="116.39" data-end="122.27">However, if we're using stricter quality, this code will now break because numbers and</span> <span data-start="122.27" data-end="126.1">strings are never strictly equal to each other, so, if we have this code, we consider the</span> <span data-start="126.1" data-end="129.789">change to the HTTP module to have broken our programme.</span> <span data-start="129.789" data-end="137.25">Another example: this module contains a method that takes the name of a table and it runs</span> <span data-start="137.25" data-end="141.78">a query to count the number of records in that table, and then it invokes your callback</span> <span data-start="141.78" data-end="146.54">with the count which again I've hard-coded, and in the something about this module.</span> <span data-start="146.54" data-end="149.739">This is structural usual identical to the other module that I just showed you.</span> <span data-start="149.739" data-end="152.409">All I've done is replace some of the names.</span> <span data-start="152.409" data-end="157.31">The actual programmatic structure in terms of what the compiler cares about is the same</span> <span data-start="157.31" data-end="163.569">as the HTTP module, so, if we believe that that breaking change compatibility is purely</span> <span data-start="163.569" data-end="167.639">a function of the source code itself, then we have to give the same answer for the HTTP</span> <span data-start="167.639" data-end="169.92">module and this one.</span> <span data-start="169.92" data-end="171.53">Let's look at some use cases.</span> <span data-start="171.53" data-end="176.349">So, say somebody is counting the number of records in tables and then subtracting them,</span> <span data-start="176.349" data-end="182.36">for example, to work out the number of remaining tickets left for a conference, now, in JavaScript,</span> <span data-start="182.36" data-end="187.269">the subtraction operator coerces strings to number so you get arithmetic sub extraction</span> <span data-start="187.269" data-end="191.629">and the same result you had before.</span> </p>
<p><span data-start="191.629" data-end="198.67">If you're adding them together, the plus operator has an overloaded meeting, performing numbers</span> <span data-start="198.67" data-end="201.26">and concatenate strings together.</span> <span data-start="201.26" data-end="207.73">If something was a number and now a string, we get the string concatenation of those two</span> <span data-start="207.73" data-end="211.09">values, so this value no longer — programme does the same thing, and the author of this</span> <span data-start="211.09" data-end="214.73">programme would consider it broken by the changes made.</span> </p>
<p><span data-start="214.73" data-end="222.23">So, yeah, we would have to make an explicit change here to account for the fact that the</span> <span data-start="222.23" data-end="226.939">database module has changed how it represents the results to us by explicitly converting</span> <span data-start="226.939" data-end="228.769">the strings back to numbers again.</span> <span data-start="228.769" data-end="235.419">So, what we've seen here is that the meaning of values in programmes is not, like, fully</span> <span data-start="235.419" data-end="236.419">contained within themselves.</span> <span data-start="236.419" data-end="242.769">It is not to do with what their type is, like a number can be used for several different</span> <span data-start="242.769" data-end="246.54">purposes, it depends how you're using it that determines whether changing it would be a</span> <span data-start="246.54" data-end="247.79">problem.</span> <span data-start="247.79" data-end="255.069">So, what we've seen is that, rather than just beak a number, like something having one type,</span> <span data-start="255.069" data-end="257.579">it actually has a set of characteristic traits.</span> </p>
<p><span data-start="257.579" data-end="261.23">A Java programmer might call these "interfacers".</span> <span data-start="261.23" data-end="265.38">Haskell users might call them type classes, but the idea is that a value of a certain</span> <span data-start="265.38" data-end="269.63">type can be used for different operations, and it's which of those operations that you're</span> <span data-start="269.63" data-end="273.63">using which determines their true meaning.</span> <span data-start="273.63" data-end="277.78">So we've seen a couple of these already, like a number might be used for its identity, like</span> <span data-start="277.78" data-end="282.73">an HTTP status code is not like an arithmetic number, it's a machine-readable label for</span> <span data-start="282.73" data-end="284.2">something.</span> <span data-start="284.2" data-end="287.28">But numbers also have arithmetic properties.</span> <span data-start="287.28" data-end="292.13">You might want to do maths with them, addition and subtraction, and so on.</span> <span data-start="292.13" data-end="296.1">So that is a little bit of an example of why the complexity even exists in very simple</span> <span data-start="296.1" data-end="297.48">values like numbers.</span> <span data-start="297.48" data-end="298.7">What about objects?</span> <span data-start="298.7" data-end="300.351">What happens when we change the interfaces to those?</span> </p>
<p><span data-start="300.351" data-end="305.28">Let's say we have a function that returns an object that convince some information about</span> <span data-start="305.28" data-end="308.67">— that returns some information about the returns of the conference, in fact, this talk</span> <span data-start="308.67" data-end="310.25">in this conference.</span> <span data-start="310.25" data-end="314.36">It contains a title, date, and a presenter, all of which are strings.</span> <span data-start="314.36" data-end="320.01">Now, adding a new field to this object is probably not a problem.</span> </p>
<p><span data-start="320.01" data-end="325.01">Any programme that is using this will probably just ignore the fact that the new field exists,</span> <span data-start="325.01" data-end="326.01">right?</span> <span data-start="326.01" data-end="330.43">It won't be relying on it, so this object gaping a few field won't disrupt any existing</span> <span data-start="330.43" data-end="331.53">code.</span> <span data-start="331.53" data-end="338.28">However, if we remove a field, like the title object — sorry, the title property — some</span> <span data-start="338.28" data-end="342.15">code that is using this function will now probably break, so, for example, if we are</span> <span data-start="342.15" data-end="347.17">calling get hook info and putting the title attribute of the result into a string, we</span> <span data-start="347.17" data-end="352.28">will now get a string containing , and this is a case where JavaScript doesn't</span> <span data-start="352.28" data-end="354.06">alert you to the fact that it has made a mistake.</span> </p>
<p><span data-start="354.06" data-end="358.29">You don't get an error if you access an attribute that doesn't exist, you get the value ,</span> <span data-start="358.29" data-end="359.81">and that shows up in the spring.</span> <span data-start="359.81" data-end="364.82">The programme hasn't broken in the sense that it is crashing, but it is clearly not doing</span> <span data-start="364.82" data-end="367.4">what was intended.</span> <span data-start="367.4" data-end="371.04">A user will notice that something weird has happened here.</span> <span data-start="371.04" data-end="375.74">Likewise, changing the types of existing fields is likely to break existing programmes.</span> <span data-start="375.74" data-end="382.03">So, for example, if we were calling get hook info and then split the date field on dashes</span> <span data-start="382.03" data-end="386.31">to break the date into its component parts, that will no longer work because a date object</span> <span data-start="386.31" data-end="388.96">doesn't have a split method.</span> <span data-start="388.96" data-end="394.36">So, in broad terms, adding new fields to an object is fine.</span> <span data-start="394.36" data-end="398.01">The existing callers will just ignore that new field.</span> </p>
<p><span data-start="398.01" data-end="402.72">Removing a field might break things as we've seen, and JavaScript won't alert you to that</span> <span data-start="402.72" data-end="403.72">problem.</span> <span data-start="403.72" data-end="406.18">And changing the type of existing fields can also break things.</span> <span data-start="406.18" data-end="409.93">Sometimes, you will get an error because you're using a method that doesn't exist, but sometimes,</span> <span data-start="409.93" data-end="413.28">the programme will silently do the wrong thing.</span> <span data-start="413.28" data-end="415.26">But it's not quite as simple as that.</span> <span data-start="415.26" data-end="419.94">JavaScript being a small language has overloaded the few abstractions that it has with several</span> <span data-start="419.94" data-end="421.56">different meanings.</span> <span data-start="421.56" data-end="427.59">There are multiple different ideas and computation that is are overloaded on to the same thing</span> <span data-start="427.59" data-end="432.24">in JavaScript, and, one of those things is object.</span> <span data-start="432.24" data-end="438.65">We use object to represent the computational idea of maps, of records, of object-orientated</span> <span data-start="438.65" data-end="443.9">style objects, and several other things, so what do these terms mean?</span> </p>
<p><span data-start="443.9" data-end="446.34">We are using this one thing object for a lot of different functions.</span> <span data-start="446.34" data-end="450.05">We need to think about the different ways in which it's used.</span> <span data-start="450.05" data-end="457.88">So a map is an open-ended collection of key value pairs and, typically, the programme</span> <span data-start="457.88" data-end="462.68">doesn't care about what specific keys are in the object, it is just data, and it gets</span> <span data-start="462.68" data-end="465.41">processed, like whatever is there is processed.</span> <span data-start="465.41" data-end="469.77">Typically, if your programme is iterating over an object and owing what is — and programming</span> <span data-start="469.77" data-end="472.65">what it contains, it uses a map.</span> <span data-start="472.65" data-end="478.61">A record is a fixed set of known fields where the field can have different types and the</span> <span data-start="478.61" data-end="483.19">programme usually cares about specific fields within an object, so the proxy pass to react</span> <span data-start="483.19" data-end="485.32">component are a good example of this.</span> <span data-start="485.32" data-end="489.42">You don't just iterate over them and do the same thing over the fields, you normally pick</span> <span data-start="489.42" data-end="493.82">out the specific fields and put them in specific places in your UI.</span> <span data-start="493.82" data-end="499.77">An object-orientated programming kind of object is bit like an extension of a record.</span> <span data-start="499.77" data-end="503.89">It is a computational value that combines state with behaviour, so it's like a record</span> <span data-start="503.89" data-end="509.76">where some of the fields are functions that access the record's other data fields.</span> </p>
<p><span data-start="509.76" data-end="514.15">So the image value that I used in the previous example here is a good example of that, that</span> <span data-start="514.15" data-end="519.24">image.url bit comes from a class that takes a name, and it has a method that those how</span> <span data-start="519.24" data-end="523.65">to calculate the URL for the particular size of an image.</span> <span data-start="523.65" data-end="529.18">Typically, adding new methods to an OAP style object is fine which enables polymorphism,</span> <span data-start="529.18" data-end="534.25">which means that one function can work with lots of different kind of objects as long</span> <span data-start="534.25" data-end="536.84">as they have a method in common.</span> <span data-start="536.84" data-end="546.58">Its rivel in JavaScript is an example of this adding now fields to other things like records</span> <span data-start="546.58" data-end="548">can cause problems.</span> </p>
<p><span data-start="548" data-end="555.55">So, for example, if you add a field to your web pack could be config that it doesn't recognise,</span> <span data-start="555.55" data-end="558.89">you would get an error.</span> <span data-start="558.89" data-end="562.29">It checks everything that your object includes, and, if it don't recognise it, it gets an</span> <span data-start="562.29" data-end="564.82">error.</span> <span data-start="564.82" data-end="570.36">The kind of programme that web pack is, it indicates an error on the part of the user</span> <span data-start="570.36" data-end="575.19">if it includes data that should not be there — it usually indicates a typo, or a field</span> <span data-start="575.19" data-end="579.57">that is no longer supported if you've upgraded from 3 to 4.</span> </p>
<p><span data-start="579.57" data-end="583.63">So it's not always the case that adding new fields to something keeps your programme working.</span> <span data-start="583.63" data-end="589.14">In some cases, it will break them, and that's done for ergonomic reasons to help the user</span> <span data-start="589.14" data-end="591.6">use the programme correctly.</span> <span data-start="591.6" data-end="596.09">Likewise, if you're inserting something in a database, if you trying to I to save an</span> <span data-start="596.09" data-end="601.74">object to a table, should that be silently ignored if it doesn't have a property?</span> </p>
<p><span data-start="601.74" data-end="605.07">Should that be silently ignored?</span> <span data-start="605.07" data-end="612.08">ORMs typically include explicit instructions for these properties get saved to the database</span> <span data-start="612.08" data-end="619.32">and these don't and the user has to decide which things belong in which category.</span> <span data-start="619.32" data-end="625.26">So that's a little bit about — we've seen how primitive values like numbers can contain</span> <span data-start="625.26" data-end="629.25">quite a lot of complexity, and, likewise, something like object can take on a lot of</span> <span data-start="629.25" data-end="634.24">different computational meanings, and so changing it has different effects in different circumstances.</span> <span data-start="634.24" data-end="642.05">But another thing that causes programmes to break is just the concepts we are expressing</span> <span data-start="642.05" data-end="644.24">are too complicated.</span> <span data-start="644.24" data-end="650.66">One example of this was the recent proposal to add the flat method to the array prototype,</span> <span data-start="650.66" data-end="655.49">and a lot of people petitioned TC39 not to do this because it would conflict with another</span> <span data-start="655.49" data-end="658.23">implementation already out in the wild.</span> <span data-start="658.23" data-end="659.83">Why would this be a problem?</span> <span data-start="659.83" data-end="667.81">It's partly for sort of logistical reasons, like, TC39 is responsible for the environment</span> <span data-start="667.81" data-end="671.34">that exists in the browser, right, so we as developers don't have control over that, our</span> <span data-start="671.34" data-end="675.52">code gets deployed into all these browsers, and it has to deal with whatever is there,</span> <span data-start="675.52" data-end="676.52">right?</span> </p>
<p><span data-start="676.52" data-end="679.57">It's not like one of our dependencies where we choose which version it is.</span> <span data-start="679.57" data-end="684.51">Anything in the browser affects the code runs and we don't have direct control over it.</span> <span data-start="684.51" data-end="690.02">TC39 changing things in a way that conflicts with our code can cause problems.</span> <span data-start="690.02" data-end="693.85">Why does that conflict even exist in the first place?</span> <span data-start="693.85" data-end="698.3">If we were talking about a fairly simple function, it is quite likely that TC39's definition</span> <span data-start="698.3" data-end="703.09">would agree with the one the community had already adopted, and we wouldn't have a problem.</span> <span data-start="703.09" data-end="708.86">But the thing with the flattened method is that it is extremely conceptually complicated.</span> <span data-start="708.86" data-end="710.91">Here's one potential implementation of it.</span> <span data-start="710.91" data-end="717.69">So, we implement flatten by introducing starting with an empty list and concatenating the array</span> <span data-start="717.69" data-end="718.69">together.</span> <span data-start="718.69" data-end="725">The way this works is that it is will combine any array inside the outer array and flatten</span> <span data-start="725" data-end="727.76">the array to one level deep.</span> </p>
<p><span data-start="727.76" data-end="732.37">You might decide you want your array flattened infinitely deep, and this won't do that.</span> <span data-start="732.37" data-end="739.65">Or you might care about other collections, like iterable collections like strings, or</span> <span data-start="739.65" data-end="744.32">a set that is already present in the outer array — what is the effect of null?</span> <span data-start="744.32" data-end="746.42">What does it mean to combine these values?</span> <span data-start="746.42" data-end="751.31">There is a broad set of decisions to be made here about what this function even means.</span> <span data-start="751.31" data-end="756.16">And that means there is a broad spates of different implementations of it.</span> <span data-start="756.16" data-end="760.26">If you put two implementations of this function in the same programme, they're likely to disagree</span> <span data-start="760.26" data-end="761.98">with each other.</span> <span data-start="761.98" data-end="766.779">And so, one way that you can avoid breaking things is to avoid using functions that are</span> <span data-start="766.779" data-end="767.88">this complicated.</span> </p>
<p><span data-start="767.88" data-end="771.279">Often, if you have something and you want to flatten is to one level deep, you want</span> <span data-start="771.279" data-end="773.04">to use FlatMap instead.</span> <span data-start="773.04" data-end="779.2">If you know your arbitrarily deep, you might want to use an interpreter.</span> <span data-start="779.2" data-end="783.26">If you don't know how deeply nested your structure is, you have a deeper design problem that</span> <span data-start="783.26" data-end="784.899">needs fixing.</span> </p>
<p><span data-start="784.899" data-end="790.83">Yes, there is a lot of complexity inherent in this method which means it's hard to make</span> <span data-start="790.83" data-end="793.17">it into operate.</span> <span data-start="793.17" data-end="796.96">We saw a similar thing with the buffer constructor in node which was taking several different</span> <span data-start="796.96" data-end="802.07">types of values and giving a different behaviour depending on the type, and it was easy to</span> <span data-start="802.07" data-end="806.5">parse a number instead of a string and then get different behaviour and this caused security</span> <span data-start="806.5" data-end="811.55">errors in some WebSocket implementations where you could make the server expose unsanitised</span> <span data-start="811.55" data-end="814.77">memory to you.</span> </p>
<p><span data-start="814.77" data-end="819.18">We fixed that by turning into several different methods that made it explicit, like the user</span> <span data-start="819.18" data-end="822.73">would make it explicit what behaviour they wanted: either they want a buffer that contains</span> <span data-start="822.73" data-end="827.58">the byte data for a string or they want a buffer that is a fixed size of memory, and</span> <span data-start="827.58" data-end="828.67">now you've made it unambiguous.</span> <span data-start="828.67" data-end="833.72">The user is saying what they want.</span> <span data-start="833.72" data-end="837.25">So it's not just about the return values that our programmes have, and how things are consuming</span> <span data-start="837.25" data-end="838.25">them.</span> <span data-start="838.25" data-end="842.71">There's an implicit contract between any function and the things it takes in terms of of what</span> <span data-start="842.71" data-end="844.85">properties it expects them to have.</span> <span data-start="844.85" data-end="848.39">So, take this contains function.</span> </p>
<p><span data-start="848.39" data-end="852.13">This takes a list and a value, and it returns a count of the number of times that value</span> <span data-start="852.13" data-end="854.07">appears in the list.</span> <span data-start="854.07" data-end="861.69">It does that by initialising a counter to zero, and then using a for-of-loop iterating</span> <span data-start="861.69" data-end="866.14">over the counter.</span> </p>
<p><span data-start="866.14" data-end="870.39">This works fine with arrays, as you would expect, but because it uses a for-of loop,</span> <span data-start="870.39" data-end="872.89">it use any kind of iterable value.</span> <span data-start="872.89" data-end="878.98">If somebody is using this with a set, it will only one a 0 or a 1 with the set because sets</span> <span data-start="878.98" data-end="884.31">only contain one of each value but that is good to determine truthiness whether something</span> <span data-start="884.31" data-end="888.88">exists in the set or not.</span> <span data-start="888.88" data-end="893.05">Say the author of the contains function decides to change it, their assumption is that it</span> <span data-start="893.05" data-end="896.41">is only being used with arrays, so they will use an array method.</span> <span data-start="896.41" data-end="903.2">They use it using the filter method using values value to the input, and then return</span> <span data-start="903.2" data-end="904.58">the length of the result.</span> <span data-start="904.58" data-end="907.61">So this continues to to work with arrays just fine.</span> <span data-start="907.61" data-end="912.54">But now it blows up when you give it a set, because sets don't implement the filter method.</span> <span data-start="912.54" data-end="918.31">We get a slightly unobvious error here like the word "filter" doesn't correspond to anything</span> <span data-start="918.31" data-end="923.02">the user has said here, it's an error being thrown by the internals, but the programme</span> <span data-start="923.02" data-end="931.899">is rejecting an input that it previously accepted and that is because the author assumed that</span> <span data-start="931.899" data-end="938">people would only use it with one kind of value, but they never made that explicit.</span> </p>
<p><span data-start="938" data-end="943.7">So, we should also consider side effects when looking at our programmes.</span> <span data-start="943.7" data-end="950.37">JavaScript being an imperative language, our programmes don't just call functions and returns</span> <span data-start="950.37" data-end="951.66">values, they also have side effects.</span> <span data-start="951.66" data-end="955.93">For example, here's a function that adds a dependency to your package.json by reading</span> <span data-start="955.93" data-end="960.24">the file, parsing it, adding a dependency and copying back to list.</span> <span data-start="960.24" data-end="966.279">If we add a console log line, is that breaking change?</span> <span data-start="966.279" data-end="974.7">If it is embedded in a programme that expects to output JSON output, adding this log line</span> <span data-start="974.7" data-end="976.81">will make that programme fail.</span> <span data-start="976.81" data-end="983.7">Likewise, if you have an event emitter, you might decide to add a new value to the data</span> <span data-start="983.7" data-end="987.69">that is emitted with an event, and JavaScript lets you call functions with more arguments</span> <span data-start="987.69" data-end="991.03">than they were expecting, so this ought to be fine, right?</span> <span data-start="991.03" data-end="996.98">Turns out somebody is using a vary added function and expects the values to be the same time</span> <span data-start="996.98" data-end="1001.459">and processed in the same way.</span> <span data-start="1001.459" data-end="1006.91">I could go on with these sorts of examples all day, but the core theme here is that JavaScript</span> <span data-start="1006.91" data-end="1011.61">doesn't make it particularly easy for you to write code that works and keeps working.</span> </p>
<p><span data-start="1011.61" data-end="1015.769">It is permissive, works with code that you expect to throw you an error.</span> <span data-start="1015.769" data-end="1020.34">When it gives an error message, it isn't helpful and doesn't identify which bit of the programme</span> <span data-start="1020.34" data-end="1026.179">is incorrect, and you have no way of telling the compiler how you expect people to use</span> <span data-start="1026.179" data-end="1027.179">your programme.</span> <span data-start="1027.179" data-end="1030.92">The compiler can't tell you and you've done something that will break those.</span> <span data-start="1030.92" data-end="1034.02">Enough complaining.</span> <span data-start="1034.02" data-end="1039.39">What can we actually do?</span> <span data-start="1039.39" data-end="1044.829">One popular answer to this problem is semantic versions, or Sam very for short, which is</span> <span data-start="1044.829" data-end="1050.78">that you format your version numbers as three separate numbers where ink submitting the</span> <span data-start="1050.78" data-end="1054.55">front one means you've made an backwards incompatible change.</span> </p>
<p><span data-start="1054.55" data-end="1059.78">Second one is a new feature in a backwards compatible way, and changing the last number</span> <span data-start="1059.78" data-end="1061.3">means you've made a bug fix.</span> <span data-start="1061.3" data-end="1066.26">As we've seen, compatibility doesn't hinge on the module itself but on the context in</span> <span data-start="1066.26" data-end="1068.49">which the module is being used.</span> <span data-start="1068.49" data-end="1074.39">SemVer has conceptual limitations in that sense but also practical ones.</span> <span data-start="1074.39" data-end="1077.78">It is hard to express fine-grained information.</span> <span data-start="1077.78" data-end="1085.14">Like you might have released a breaking change but you haven't — like all the functions</span> <span data-start="1085.14" data-end="1088.94">that I happen to be using from your package are still fine, so I can't tell from the version</span> <span data-start="1088.94" data-end="1089.94">number whether it has saved the upgrade.</span> <span data-start="1089.94" data-end="1092.49">— whether it is safe to upgrade.</span> </p>
<p><span data-start="1092.49" data-end="1097.23">You can see it playing out in the ecosystem that a lot of time I've seen breaking changes</span> <span data-start="1097.23" data-end="1101.429">in production, they show newspaper bug fixes releases.</span> <span data-start="1101.429" data-end="1109.64">Last year, we had a denial of service vulnerability, and at the end of 2016, the sdlib library</span> <span data-start="1109.64" data-end="1122.49">released since 2009, which gives you an idea — and that contained a change that meant</span> <span data-start="1122.49" data-end="1126.19">previously valid configuration values that are required by the WebSocket compression</span> <span data-start="1126.19" data-end="1128.98">protocol were now illegal and it would throw errors on them.</span> <span data-start="1128.98" data-end="1136.04">In April the following year, Node.js released 4.8.2 and 6.10.2 which bundled this version</span> <span data-start="1136.04" data-end="1138.95">of sdlib and broke WebSocket servers.</span> <span data-start="1138.95" data-end="1147.96">In August, when we were releasing the new libraries, we discovered this issue, reported</span> <span data-start="1147.96" data-end="1154.67">it to the Node project, and Miles from the Node project reported this issue to sdlib.</span> <span data-start="1154.67" data-end="1161.22">This is not necessarily a bug in sdlib, it is sdlib's intention that these values are</span> <span data-start="1161.22" data-end="1162.83">not legal and you should not use they will.</span> <span data-start="1162.83" data-end="1165.929">They didn't know that this would break stuff to do with the WebSocket protocol.</span> </p>
<p><span data-start="1165.929" data-end="1171.5">A month later after figuring out the possible solutions, the fact that we would have to</span> <span data-start="1171.5" data-end="1177.77">deviate from the spec to make the programmes stop crashing and written everything up, deflate</span> <span data-start="1177.77" data-end="1182.65">reels cache, and a month after that Node.js released versions four, six, and eight in</span> <span data-start="1182.65" data-end="1187.41">a paper over the problem.</span> <span data-start="1187.41" data-end="1192.6">This gives you some idea of the time it takes for these changes to propagate through the</span> <span data-start="1192.6" data-end="1193.6">system.</span> </p>
<p><span data-start="1193.6" data-end="1196.62">Everyone is working with imperfect information and we have to figure out what is going on,</span> <span data-start="1196.62" data-end="1197.96">and that takes time.</span> <span data-start="1197.96" data-end="1202.929">When you're changing a system, you don't have to look at the meaning of the programme like</span> <span data-start="1202.929" data-end="1208.511">on its own, you have to think about the effect on the ecosystem of the community for the</span> <span data-start="1208.511" data-end="1210.7">information of that change to spread.</span> <span data-start="1210.7" data-end="1214.45">If you make too much change too quickly, you end up leaving everybody behind and you end</span> <span data-start="1214.45" data-end="1217.79">up not upgrading your software.</span> <span data-start="1217.79" data-end="1224.65">Another approach to breaking change is try to never break anything which sound like an</span> <span data-start="1224.65" data-end="1225.73">extreme position.</span> <span data-start="1225.73" data-end="1231.41">I'm not sure any of us would ever manage to live by this standard.</span> <span data-start="1231.41" data-end="1234.48">But, it is a constraint that people try and live to.</span> <span data-start="1234.48" data-end="1240.24">We saw Ryan yesterday say it's my fault, and I'm very sorry, unfortunately, it is impossible</span> <span data-start="1240.24" data-end="1241.52">to undo now.</span> <span data-start="1241.52" data-end="1243.84">This is the world we live in.</span> </p>
<p><span data-start="1243.84" data-end="1247.14">Too much stuff depends on our code, and we can't change it.</span> <span data-start="1247.14" data-end="1251.82">It is what I try to live by in my software and partly to do with how the maintenance</span> <span data-start="1251.82" data-end="1253.99">works.</span> <span data-start="1253.99" data-end="1257.33">There's two main reasons why I try to work this way.</span> <span data-start="1257.33" data-end="1260.27">The first is I'm not in direct contact with all of my users.</span> <span data-start="1260.27" data-end="1264.39">If I want to change something that's hard for me to inform the largest is people using</span> <span data-start="1264.39" data-end="1267.94">this code that I'm going to change it and they might need to update something.</span> <span data-start="1267.94" data-end="1274.22">Most of the people running my code don't know they're doing so.</span> <span data-start="1274.22" data-end="1280.02">So, my modules are typically embedded as transitive dependencies inside other things that people</span> <span data-start="1280.02" data-end="1286.09">are using, so there are two or three levels of intermediaries of the end-user and my code,</span> <span data-start="1286.09" data-end="1290.46">so, if I break something, there are several other authors and projects that would have</span> <span data-start="1290.46" data-end="1296.24">to paper over that for the end-user to see any benefit from it.</span> </p>
<p><span data-start="1296.24" data-end="1301.23">Because I do a open source in my spare time, I don't have a predictable amount of bandwidth</span> <span data-start="1301.23" data-end="1306.74">for switching problems so it's more valuable for me to keep things stable rather than release</span> <span data-start="1306.74" data-end="1311.32">stuff that might break things and have no visibility when I might be able to do with</span> <span data-start="1311.32" data-end="1312.32">that later.</span> <span data-start="1312.32" data-end="1315.76">I take a similar approach to my dependencies.</span> <span data-start="1315.76" data-end="1320.86">I leave them open-ended rather than pinning them with the carat or tilde operator.</span> <span data-start="1320.86" data-end="1327.059">I don't want to be a bottleneck on people getting an upgrade to the things that I'm</span> <span data-start="1327.059" data-end="1333.049">depending on. and I'm taking a risk here that these things might not be stable, but</span> <span data-start="1333.049" data-end="1334.51">that's countered by other measures.</span> </p>
<p><span data-start="1334.51" data-end="1336.72">I'm conservative with the things that I depend on.</span> <span data-start="1336.72" data-end="1342.309">I will typically try and adopt something and live with it for a few months and get an understanding</span> <span data-start="1342.309" data-end="1348.23">how it behaves over time before I release it to my users.</span> <span data-start="1348.23" data-end="1349.669">All this hinges on communication.</span> <span data-start="1349.669" data-end="1353.27">All of this stuff is — we've seen a lot of talks at this conference about how we communicate</span> <span data-start="1353.27" data-end="1355.5">with each other.</span> <span data-start="1355.5" data-end="1362.559">The core message that I want you to take away from this is that compatibility isn't an objective</span> <span data-start="1362.559" data-end="1367.73">technocratic thing about the code itself, it's about the tact that we all have imperfect</span> <span data-start="1367.73" data-end="1372.61">information about the author and the user and the software know different things about</span> <span data-start="1372.61" data-end="1379.65">the software, and that means that the author's intent and the user's usage will deviate.</span> <span data-start="1379.65" data-end="1385.24">The best ways that we can try to avoid things breaking is by affecting how people use our</span> <span data-start="1385.24" data-end="1387.12">software, in how we communicate with them.</span> <span data-start="1387.12" data-end="1391.13">We can partly do that through the code that we write, so, JavaScript is still a small</span> <span data-start="1391.13" data-end="1395.19">language but grown a few things recently to express yourself better.</span> <span data-start="1395.19" data-end="1398.49">It might be more appropriate rather than using a plain array to use a set that might be the</span> <span data-start="1398.49" data-end="1400.74">might help you be more specific about your meaning.</span> </p>
<p><span data-start="1400.74" data-end="1405.53">Instead of using a plain old object it might be appropriate to use a map for the distinctions</span> <span data-start="1405.53" data-end="1410.16">we saw earlier.</span> <span data-start="1410.16" data-end="1412.961">If you want to think about the operators and functions that you're using, if you know you're</span> <span data-start="1412.961" data-end="1418.29">doing string concatenation, rather than using the plus operator, which is ambiguous, consider</span> <span data-start="1418.29" data-end="1424.929">using templates or the join method which tells people you know you're doing string concatenation.</span> <span data-start="1424.929" data-end="1428.8">You can try as avoid brittle idioms in the language that make it likely you will have</span> <span data-start="1428.8" data-end="1429.8">to change your mind later.</span> <span data-start="1429.8" data-end="1436.95">If a programme is growing a long list of parameters, and you keep adding more things to it, that</span> <span data-start="1436.95" data-end="1440.17">makes the callers to those functions a bit cryptic, like what do true and false and zero</span> <span data-start="1440.17" data-end="1441.17">mean?</span> <span data-start="1441.17" data-end="1442.539">I don't really know.</span> </p>
<p><span data-start="1442.539" data-end="1445.08">Every time you add a new parameter, it gets more complicated.</span> <span data-start="1445.08" data-end="1451.47">A nicer way to do this is object destructuring and simulating named arguments and you can</span> <span data-start="1451.47" data-end="1452.77">give them default values.</span> <span data-start="1452.77" data-end="1457.41">That makes the function easier to change and makes the caller clearer about what it is</span> <span data-start="1457.41" data-end="1458.41">doing.</span> <span data-start="1458.41" data-end="1460.68">A really good example of this is callback.</span> <span data-start="1460.68" data-end="1465.51">If you want to add a new parameter to callback function, that parameter needs to go before</span> <span data-start="1465.51" data-end="1471.51">the callback, and you need to do some mending-up at the top of your method to account for callers</span> <span data-start="1471.51" data-end="1473.82">that aren't passing that new parameter yet.</span> <span data-start="1473.82" data-end="1477.5">It is much easier to do this if your function returns a promise because the parameter list</span> <span data-start="1477.5" data-end="1483.169">hasn't been polluted by this extra parameter that needs to be at the end, so it's much</span> <span data-start="1483.169" data-end="1486.69">easier just to add a new parameter there with a default value and not to have to add any</span> <span data-start="1486.69" data-end="1488.78">of that extra stuff.</span> </p>
<p><span data-start="1488.78" data-end="1490.98">Think about the error design.</span> <span data-start="1490.98" data-end="1494.179">Errors should be a way that help users write code that works.</span> <span data-start="1494.179" data-end="1498.44">They should not be a Carey thing but there to help people.</span> <span data-start="1498.44" data-end="1503.04">Things throwing errors when you're making a mistake is good for you.</span> <span data-start="1503.04" data-end="1506.669">For example, rather than the cryptic error we saw later about filter not existing when</span> <span data-start="1506.669" data-end="1511.77">we parsed in a set, we can put an assertion on the top of our method that I expect this</span> <span data-start="1511.77" data-end="1512.809">to be used with an array.</span> <span data-start="1512.809" data-end="1516.84">If not, I will give you a method that tells you that is what I expected.</span> <span data-start="1516.84" data-end="1521.299">So you can spot the bug in this code.</span> </p>
<p><span data-start="1521.299" data-end="1523.58">It's probably not very obvious.</span> <span data-start="1523.58" data-end="1530.17">The bug is that bytes has be to an integer but not on a number divisible by eight.</span> <span data-start="1530.17" data-end="1532.8">Sometimes, we will parse a fractional value here.</span> <span data-start="1532.8" data-end="1536.67">This worked fine until Node 9.</span> <span data-start="1536.67" data-end="1542.59">The crypto-library rounded the number down, but the programme that was using this it didn't</span> <span data-start="1542.59" data-end="1547.28">matter too much because it was asking for a lot more random data than it really needed,</span> <span data-start="1547.28" data-end="1550.2">so the number being rounded down slightly wasn't a problem.</span> </p>
<p><span data-start="1550.2" data-end="1554.36">Then in node 10, we got an error, key element is out of range.</span> <span data-start="1554.36" data-end="1556.5">This error is slightly unhelpful.</span> <span data-start="1556.5" data-end="1561.27">The error that the number is not an integer, not that this that it is out of range, but</span> <span data-start="1561.27" data-end="1563.39">crashing a programme that previously worked.</span> <span data-start="1563.39" data-end="1568.75">When you're adding errors to a library later in its life, think about should that error</span> <span data-start="1568.75" data-end="1571.66">get to crash the programmes currently using it?</span> <span data-start="1571.66" data-end="1574.38">Is there a better way to communicate that failure to the user?</span> <span data-start="1574.38" data-end="1578.44">It is quite common for people to dig around in the console and look at the properties</span> <span data-start="1578.44" data-end="1580.18">tab to figure out how to use them.</span> <span data-start="1580.18" data-end="1585.73">One convention we have in JavaScript is if you're accessing a lot of things with underscores,</span> <span data-start="1585.73" data-end="1588.22">that's a signal that you're doing something private.</span> </p>
<p><span data-start="1588.22" data-end="1594.04">That's not something the language enforces for you but it's a way that you can signal</span> <span data-start="1594.04" data-end="1600.66">to the user I didn't mean for you to use this, and it will probably break later.</span> <span data-start="1600.66" data-end="1604.12">The final thing that we have to rely on is documentation.</span> <span data-start="1604.12" data-end="1607.37">Documentation should help people use the code in the way that you intended.</span> <span data-start="1607.37" data-end="1614.99">Often, people land on Google and even if you have like really good documentation, arriving</span> <span data-start="1614.99" data-end="1618.62">at pros that — prose that requires a lot of context will give meme more questions than</span> <span data-start="1618.62" data-end="1619.69">they arrive with.</span> <span data-start="1619.69" data-end="1625.65">I could be going what's a driver object, should the you shall object be a strict?</span> <span data-start="1625.65" data-end="1627.08">How do I put this stuff together?</span> <span data-start="1627.08" data-end="1634.28">It would help people to give a self-contained example and once they understand the basic</span> <span data-start="1634.28" data-end="1640.45">concepts, more ready to dive into your API details and add things in more detail.</span> </p>
<p><span data-start="1640.45" data-end="1644.89">And finally, we have testing.</span> <span data-start="1644.89" data-end="1651.34">So, testing is a huge topic but I can't possibly cover in the minute I have remaining, but</span> <span data-start="1651.34" data-end="1657.02">one thing that I often see of people advise with testing that you should not test your</span> <span data-start="1657.02" data-end="1658.02">dependencies.</span> <span data-start="1658.02" data-end="1659.02">Don't test third-party code.</span> <span data-start="1659.02" data-end="1660.62">That's a really good idea.</span> <span data-start="1660.62" data-end="1662.37">You can do that.</span> <span data-start="1662.37" data-end="1666.53">What it does is validate your assumptions and tells you where they're no longer true.</span> <span data-start="1666.53" data-end="1672.02">Me as the user of the contains function we saw earlier, I can say it works with sets.</span> </p>
<p><span data-start="1672.02" data-end="1677.79">One day when the author changes it, that will step working, I will get an error, and then</span> <span data-start="1677.79" data-end="1683.3">immediately know that the reason my application is failing is because the dependency no longer</span> <span data-start="1683.3" data-end="1684.3">true.</span> <span data-start="1684.3" data-end="1686.65">So, what have we learned?</span> <span data-start="1686.65" data-end="1694.62">We've learned that compatibility is not pure a function of the source code but the context</span> <span data-start="1694.62" data-end="1696.02">which it's used.</span> <span data-start="1696.02" data-end="1701.2">We've learned that context is constructed by how people use your programme, something</span> <span data-start="1701.2" data-end="1706.49">you don't have control over, and finally, that you can influence that context by how</span> <span data-start="1706.49" data-end="1709.9">you communicate with the users, and how you tell them if the software is supposed to be</span> <span data-start="1709.9" data-end="1711.46">used.</span> </p>
<p><span data-start="1711.46" data-end="1712.46">Thank you very much.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
