<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ejcJmeewtd4</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/ejcJmeewtd4?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="15.25" data-end="18.4">my name is Kevin markman and I come to</span> <span data-start="18.4" data-end="19.66">you from New York to talk a little bit</span> <span data-start="19.66" data-end="22.779">about taking web apps offline and what</span> <span data-start="22.779" data-end="24.79">it takes to do that and how you can do</span> <span data-start="24.79" data-end="27.099">that because realistically your app</span> <span data-start="27.099" data-end="29.5">isn't there for your users unless it's</span> <span data-start="29.5" data-end="32.41">available to them all the time so first</span> <span data-start="32.41" data-end="34.449">I want to tell you a little bit about me</span> <span data-start="34.449" data-end="36.61">and my my background I come from a</span> <span data-start="36.61" data-end="40.36">history of C++ desktop applications and</span> <span data-start="40.36" data-end="42.37">they had the exact opposite problem so</span> <span data-start="42.37" data-end="43.809">the issue they face is that they didn't</span> <span data-start="43.809" data-end="45.699">get any of the advantages that the cloud</span> <span data-start="45.699" data-end="48.52">brings to to us to us javascript HTML</span> </p>
<p><span data-start="48.52" data-end="53.079">CSS people and that is the update update</span> <span data-start="53.079" data-end="55.93">cycles for years a product that i worked</span> <span data-start="55.93" data-end="58.78">on three years ago still isn't launched</span> <span data-start="58.78" data-end="61.18">I've launched more and the in the last</span> <span data-start="61.18" data-end="63.16">month then I've launched from my</span> <span data-start="63.16" data-end="65.199">previous job which is which is kind of</span> <span data-start="65.199" data-end="68.08">crazy so at the same time there are</span> <span data-start="68.08" data-end="70.59">things that desktop apps do well that</span> <span data-start="70.59" data-end="73.78">web apps suffer with and one of those</span> <span data-start="73.78" data-end="76.84">things is offline and Doc's offline was</span> <span data-start="76.84" data-end="79.149">a huge effort and it really pushed the</span> <span data-start="79.149" data-end="81.52">boundaries of what's possible and by</span> <span data-start="81.52" data-end="83.89">taking this step forward I think what</span> <span data-start="83.89" data-end="85.45">we're really showing the community at</span> <span data-start="85.45" data-end="87.729">large is that it can be done it can be</span> <span data-start="87.729" data-end="91.84">done for you so first what stocks who</span> <span data-start="91.84" data-end="93.64">here has used google documents by a show</span> <span data-start="93.64" data-end="97.06">of hands that is fantastic that's pretty</span> <span data-start="97.06" data-end="100.42">much all of you so i should be able to</span> <span data-start="100.42" data-end="103.03">skip through this quick sesh I through</span> <span data-start="103.03" data-end="104.979">this quickly but i do want to give a</span> <span data-start="104.979" data-end="108.579">high-level overview so what Google Docs</span> <span data-start="108.579" data-end="109.99">used to be a couple of years ago is</span> <span data-start="109.99" data-end="111.64">content editable which is basically a</span> <span data-start="111.64" data-end="114.7">text area into which you type it</span> <span data-start="114.7" data-end="117.88">transferred it puts it all into HTML it</span> <span data-start="117.88" data-end="119.439">would send it up to the server the</span> <span data-start="119.439" data-end="121.659">server would store it as HTML and that</span> <span data-start="121.659" data-end="123.97">was bad that was bad because the model</span> <span data-start="123.97" data-end="125.29">the view the controller they're they're</span> <span data-start="125.29" data-end="127.54">all the same thing basically you can't</span> <span data-start="127.54" data-end="129.16">have your model and your and your view</span> <span data-start="129.16" data-end="133.06">both be HTML so what documents is now is</span> <span data-start="133.06" data-end="135.82">it's a full fledge word processor what</span> <span data-start="135.82" data-end="137.17">you see on the screen was placed there</span> <span data-start="137.17" data-end="139.51">explicitly you can have tab stops for</span> <span data-start="139.51" data-end="142.15">example in HTML we placed that text</span> <span data-start="142.15" data-end="144.069">explicitly the cursor for example is</span> <span data-start="144.069" data-end="147.55">just a 1 pixel wide div which blinks on</span> <span data-start="147.55" data-end="148.81">a timeout</span> <span data-start="148.81" data-end="151">timer right so when you click back when</span> <span data-start="151" data-end="152.349">you click into the document it</span> <span data-start="152.349" data-end="154.63">explicitly positions that div in that</span> <span data-start="154.63" data-end="156.43">location everything is done in</span> </p>
<p><span data-start="156.43" data-end="161.65">JavaScript so that's really cool and</span> <span data-start="161.65" data-end="165.01">that really enables offline web apps the</span> <span data-start="165.01" data-end="166.63">number one thing that you need is you</span> <span data-start="166.63" data-end="168.22">need everything to be done on the client</span> <span data-start="168.22" data-end="170.92">if your app depends on constant server</span> <span data-start="170.92" data-end="172.66">communication to get all of its</span> <span data-start="172.66" data-end="175.06">information then you're you're gonna</span> <span data-start="175.06" data-end="177.76">you're going to suffer so we start off</span> <span data-start="177.76" data-end="178.84">in the right place but there were still</span> <span data-start="178.84" data-end="183.42">a number of things that we didn't do so</span> <span data-start="183.42" data-end="187">what we do what used to happen two years</span> <span data-start="187" data-end="189.19">ago Doc's would connect to a server and</span> <span data-start="189.19" data-end="191.86">pull down a huge chunk of content and</span> <span data-start="191.86" data-end="196.18">that includes the model the application</span> <span data-start="196.18" data-end="198.58">itself meaning the the JavaScript the</span> </p>
<p><span data-start="198.58" data-end="202.09">CSS etc and along with all the</span> <span data-start="202.09" data-end="203.92">configuration options and that</span> <span data-start="203.92" data-end="206.56">completely breaks MVC we're bundling it</span> <span data-start="206.56" data-end="208">all together so why do we do it for</span> <span data-start="208" data-end="211.45">performance but obviously or as you'll</span> <span data-start="211.45" data-end="213.489">see will we will have suffered because</span> <span data-start="213.489" data-end="216.43">of this but what's really nice is that</span> <span data-start="216.43" data-end="219.31">after this one chunk there's only little</span> <span data-start="219.31" data-end="220.66">things being sent back and forth to the</span> <span data-start="220.66" data-end="222.64">server the client really does the heavy</span> <span data-start="222.64" data-end="225.7">the heavy lifting here so that means</span> <span data-start="225.7" data-end="226.78">that if you have a really laggy</span> <span data-start="226.78" data-end="228.25">connection it doesn't matter you can</span> <span data-start="228.25" data-end="230.5">continue typing away and after that</span> <span data-start="230.5" data-end="232.51">connection is restored it will all get</span> <span data-start="232.51" data-end="234.19">sensitive server the server's really</span> <span data-start="234.19" data-end="236.5">just the persistence mechanism and the</span> <span data-start="236.5" data-end="240.1">client is the client is there for</span> <span data-start="240.1" data-end="243.73">everything that you do that really</span> <span data-start="243.73" data-end="247.15">enabled us to to take off line to next</span> <span data-start="247.15" data-end="248.56">step in the sense that we already had</span> <span data-start="248.56" data-end="250">this infrastructure from our real-time</span> <span data-start="250" data-end="256">collaboration built into our app so what</span> <span data-start="256" data-end="260.039">is Doc's like now as you see i make no</span> <span data-start="260.039" data-end="262.72">there's no separation between server and</span> <span data-start="262.72" data-end="264.88">storage to us server and storage are</span> <span data-start="264.88" data-end="266.979">sort of the same thing when we pull the</span> <span data-start="266.979" data-end="270.94">document from from storage or server it</span> <span data-start="270.94" data-end="273.28">doesn't matter so let's walk you through</span> <span data-start="273.28" data-end="275.86">at a high level what happens so first we</span> <span data-start="275.86" data-end="277.93">have this happy user and he types in</span> </p>
<p><span data-start="277.93" data-end="280.75">Doc's like google com he types in a</span> <span data-start="280.75" data-end="282.09">specific a</span> <span data-start="282.09" data-end="286.05">cific document ID either by bookmark or</span> <span data-start="286.05" data-end="290.22">using using the drive launcher and from</span> <span data-start="290.22" data-end="292.62">here chrome triggers the fallback</span> <span data-start="292.62" data-end="293.94">application because we don't have a</span> <span data-start="293.94" data-end="295.11">network connection let's assume we're</span> <span data-start="295.11" data-end="296.88">offline now the online flow is largely</span> <span data-start="296.88" data-end="301.65">unaffected the fallback application</span> <span data-start="301.65" data-end="304.35">takes them to a place which determines</span> <span data-start="304.35" data-end="306.419">which binary to run and we'll jump into</span> <span data-start="306.419" data-end="308.76">this in a second determines which binary</span> <span data-start="308.76" data-end="311.16">to run which java and c says to pull in</span> <span data-start="311.16" data-end="312.9">determines of the dock is available and</span> <span data-start="312.9" data-end="315.06">then sends the user to the docks</span> <span data-start="315.06" data-end="320.61">themselves to an offline specific binary</span> <span data-start="320.61" data-end="323.88">that offline binary then reads the</span> <span data-start="323.88" data-end="325.889">doctrine user data from the database and</span> <span data-start="325.889" data-end="327.84">uses that info to load the offline</span> <span data-start="327.84" data-end="334.229">document we use we then use browser we</span> <span data-start="334.229" data-end="336">then use browser history AP is to</span> <span data-start="336" data-end="338.01">rewrite the URL to make it look like you</span> <span data-start="338.01" data-end="339.96">were the online binary so why is that</span> <span data-start="339.96" data-end="341.55">important we don't want to surface to</span> <span data-start="341.55" data-end="342.81">the user that anything is different</span> <span data-start="342.81" data-end="343.91">everything should look identical</span> <span data-start="343.91" data-end="346.74">including the URL as a matter of fact if</span> <span data-start="346.74" data-end="348.389">you hit refresh it uses the current URL</span> <span data-start="348.389" data-end="351">in the URL bar so it will actually go</span> <span data-start="351" data-end="353.01">through this entire flow of hitting the</span> <span data-start="353.01" data-end="355.02">fallback application figuring out which</span> <span data-start="355.02" data-end="356.97">binary to use ensuring that the document</span> <span data-start="356.97" data-end="360.15">is available offline etc if if you don't</span> <span data-start="360.15" data-end="363.419">have a connection so as the user</span> <span data-start="363.419" data-end="364.95">interacts with their document as they're</span> <span data-start="364.95" data-end="367.32">typing stuff in it gets saved it gets</span> <span data-start="367.32" data-end="370.71">saved both locally as you see in uh in</span> <span data-start="370.71" data-end="372.99">the first part and then down to the</span> <span data-start="372.99" data-end="375.3">server what we store locally is pretty</span> <span data-start="375.3" data-end="376.77">much identical to what we sent to the</span> <span data-start="376.77" data-end="379.349">server and that's done so that as we</span> <span data-start="379.349" data-end="381.78">read it back it's exactly what the</span> <span data-start="381.78" data-end="384.12">server is sending to us so this works</span> <span data-start="384.12" data-end="387.87">really well except this only talks about</span> <span data-start="387.87" data-end="390.479">one document so what can we do to really</span> <span data-start="390.479" data-end="392.37">push this out because we have lots of</span> <span data-start="392.37" data-end="396.06">documents that are offline we have</span> <span data-start="396.06" data-end="398.7">what's known as a shared worker this is</span> <span data-start="398.7" data-end="400.26">actually a JavaScript shared worker</span> <span data-start="400.26" data-end="404.19">which which we synchronize all documents</span> <span data-start="404.19" data-end="405.75">with in the background so there's a</span> <span data-start="405.75" data-end="407.849">locking mechanism which I won't go into</span> <span data-start="407.849" data-end="409.889">in this talk it's an entire talk in</span> <span data-start="409.889" data-end="413.31">itself to ensure that nothing gets</span> <span data-start="413.31" data-end="415.77">written to storage by multiple by</span> <span data-start="415.77" data-end="417.72">multiple tabs at the same time but every</span> <span data-start="417.72" data-end="420.15">single docs tab that you have open has a</span> <span data-start="420.15" data-end="422.479">pointer to the shared worker so the way</span> <span data-start="422.479" data-end="425.43">javascript shared workers work as soon</span> <span data-start="425.43" data-end="427.229">as you close all tabs that points them</span> <span data-start="427.229" data-end="431.31">the shared worker dies so we also do one</span> <span data-start="431.31" data-end="433.8">last bit of magic which is a background</span> <span data-start="433.8" data-end="436.909">page this background page is a</span> <span data-start="436.909" data-end="438.93">permission that's granted to us through</span> <span data-start="438.93" data-end="442.289">a chrome app which is why we insured or</span> <span data-start="442.289" data-end="445.71">we force you to to install the drive</span> <span data-start="445.71" data-end="448.83">chrome app before before you can use</span> <span data-start="448.83" data-end="450.659">offline and it's really there for that</span> <span data-start="450.659" data-end="452.52">permission because if you're typing</span> <span data-start="452.52" data-end="456.72">offline and you close your tab and you</span> <span data-start="456.72" data-end="457.889">have chrome open or you have your</span> <span data-start="457.889" data-end="459.449">computer on and a couple of days later</span> <span data-start="459.449" data-end="462.12">you still haven't gone to Doc's you</span> <span data-start="462.12" data-end="464.25">really want that content available it'd</span> <span data-start="464.25" data-end="467.639">be crazy if it weren't there so let's</span> <span data-start="467.639" data-end="469.139">drill down a little bit I want to talk</span> <span data-start="469.139" data-end="474.9">about two things which were which were I</span> <span data-start="474.9" data-end="477.509">think the really novel parts about Doc's</span> <span data-start="477.509" data-end="482.039">offline so the first one is how we</span> <span data-start="482.039" data-end="483.539">manage loading so I talked about</span> <span data-start="483.539" data-end="485.039">choosing binaries the fallback</span> <span data-start="485.039" data-end="487.68">application what does that mean and the</span> <span data-start="487.68" data-end="489.719">second part is matching static data and</span> <span data-start="489.719" data-end="492.96">these two things really came up as we</span> <span data-start="492.96" data-end="494.759">were developing we didn't we didn't</span> <span data-start="494.759" data-end="496.229">envision them beforehand especially the</span> <span data-start="496.229" data-end="497.819">matching static data and now that's a</span> <span data-start="497.819" data-end="499.229">really really interesting one so I'm</span> <span data-start="499.229" data-end="501.69">really curious too I'm gonna ask you</span> <span data-start="501.69" data-end="505.93">guys a couple questions there as well so</span> <span data-start="505.94" data-end="508.38">first we're going to talk about managing</span> <span data-start="508.38" data-end="511.469">offline loading I first want to talk</span> <span data-start="511.469" data-end="513.36">about the application cache who here has</span> <span data-start="513.36" data-end="515.19">used an app cache in their in their</span> <span data-start="515.19" data-end="518.49">applications awesome great so I'm going</span> <span data-start="518.49" data-end="520.709">to go over this really quickly basically</span> <span data-start="520.709" data-end="522.479">an app cache allows you to store static</span> <span data-start="522.479" data-end="524.85">data on disk you reference it through</span> <span data-start="524.85" data-end="527.85">and through the HTML tag you say you say</span> <span data-start="527.85" data-end="530.88">the man the app cache manifest points to</span> <span data-start="530.88" data-end="533.73">this file it's just a blob that looks</span> <span data-start="533.73" data-end="535.62">like this it has an explicit section</span> </p>
<p><span data-start="535.62" data-end="537.529">Network section and fall back section</span> <span data-start="537.529" data-end="540.39">explicit section says if I hit this URL</span> <span data-start="540.39" data-end="542.76">always use what I have available locally</span> <span data-start="542.76" data-end="545.82">network says if I hit this URL always go</span> <span data-start="545.82" data-end="547.74">to the network and the fallback says if</span> <span data-start="547.74" data-end="549.209">I don't have</span> <span data-start="549.209" data-end="551.55">a connection available then fall back to</span> <span data-start="551.55" data-end="560.49">this so so what was the difficulty with</span> <span data-start="560.49" data-end="564.089">Doc's one of the things that is unique</span> <span data-start="564.089" data-end="566.429">about Doc's is we don't have just one</span> <span data-start="566.429" data-end="569.85">binary we have several binaries so for</span> <span data-start="569.85" data-end="571.949">example we have apps for domain and</span> <span data-start="571.949" data-end="573.99">people can choose to enable or disable</span> <span data-start="573.99" data-end="576.899">experimental features that leads to</span> <span data-start="576.899" data-end="578.429">different binaries but we can't</span> <span data-start="578.429" data-end="580.589">determine that from the document URL so</span> <span data-start="580.589" data-end="582.899">as the user types in the URL hit center</span> <span data-start="582.899" data-end="584.879">they're offline we have to pick the</span> <span data-start="584.879" data-end="587.399">binary based off that app cache does not</span> <span data-start="587.399" data-end="588.899">provide us a way to do that there's no</span> <span data-start="588.899" data-end="591.029">code that that can run there's not even</span> <span data-start="591.029" data-end="593.129">regular Express regular expression</span> <span data-start="593.129" data-end="595.649">matching in the explicit explicit cache</span> <span data-start="595.649" data-end="599.759">entry so instead M excuse me instead</span> <span data-start="599.759" data-end="601.98">what we have to do is we have a fallback</span> <span data-start="601.98" data-end="604.949">application so this syntax right at the</span> <span data-start="604.949" data-end="607.019">bottom says that if the user goes to</span> <span data-start="607.019" data-end="609.059">anywhere on docstoc google com so doc</span> <span data-start="609.059" data-end="611.009">cycle combat blah it goes to the</span> <span data-start="611.009" data-end="613.05">fallback location instead which is also</span> <span data-start="613.05" data-end="616.17">an explicit cache entry so let's</span> <span data-start="616.17" data-end="617.67">actually step through an example of this</span> <span data-start="617.67" data-end="620.85">so the user put some puts in the URL and</span> <span data-start="620.85" data-end="623.249">or clicks a link to it whichever way</span> <span data-start="623.249" data-end="627.749">they get it the application at chrome</span> <span data-start="627.749" data-end="628.679">decides that there is no network</span> <span data-start="628.679" data-end="630.42">available or the server responds with a</span> <span data-start="630.42" data-end="633.72">400 whatever forces it and it says hey</span> <span data-start="633.72" data-end="635.699">look there's a fallback location for</span> <span data-start="635.699" data-end="637.949">this so from there it forwards to the</span> <span data-start="637.949" data-end="640.679">fallback location the fallback location</span> <span data-start="640.679" data-end="642.689">takes a look at the URL which is in the</span> </p>
<p><span data-start="642.689" data-end="644.79">URL bar and it tries to interpret a few</span> <span data-start="644.79" data-end="646.649">things what does this point to is the</span> <span data-start="646.649" data-end="648.299">point to a document yes it's pointing to</span> <span data-start="648.299" data-end="649.47">a document does the user have</span> <span data-start="649.47" data-end="652.35">permissions for it uh what kind of</span> <span data-start="652.35" data-end="654.899">binary do we need for it etc it's the</span> <span data-start="654.899" data-end="655.98">one that actually does all the</span> <span data-start="655.98" data-end="658.86">processing by looking at the URL and and</span> <span data-start="658.86" data-end="661.139">making decisions from there and that's</span> <span data-start="661.139" data-end="664.129">the way that we can actually intercept</span> <span data-start="664.129" data-end="666.799">intercept it if those aren't available</span> <span data-start="666.799" data-end="669.42">if they answer those are no you don't</span> <span data-start="669.42" data-end="671.22">have the binary or the user doesn't have</span> <span data-start="671.22" data-end="674.579">permissions it blows up if you do then</span> <span data-start="674.579" data-end="677.189">we pick the binary and we forward the</span> <span data-start="677.189" data-end="680.61">user there but there's a catch you can't</span> <span data-start="680.61" data-end="683.01">there's no way to really communicate</span> <span data-start="683.01" data-end="687.09">with the binary so if you have an</span> <span data-start="687.09" data-end="688.83">application cache and you have an</span> <span data-start="688.83" data-end="690.66">explicit you have an explicit cash there</span> <span data-start="690.66" data-end="692.61">everything including query params have</span> <span data-start="692.61" data-end="695.67">to match exactly to hit it except</span> <span data-start="695.67" data-end="698.91">hashtags so hashes allow you to add</span> <span data-start="698.91" data-end="701.82">information after a URL it will still</span> <span data-start="701.82" data-end="704.67">hit the correct app cache manifest if</span> <span data-start="704.67" data-end="706.17">it's there before the hashtag and</span> <span data-start="706.17" data-end="708.96">everything afterward is ignored so we</span> <span data-start="708.96" data-end="711.18">encode a bunch of stuff after that</span> <span data-start="711.18" data-end="714">hashtag to relay that information from</span> <span data-start="714" data-end="717.36">the fallback application to to the</span> <span data-start="717.36" data-end="722.01">editor itself so that way we can we can</span> <span data-start="722.01" data-end="723.33">encode the things that are on the</span> <span data-start="723.33" data-end="725.43">landing page of the editor which weren't</span> <span data-start="725.43" data-end="727.71">there which are there on the online flow</span> <span data-start="727.71" data-end="730.11">but we can't get at immediately so</span> <span data-start="730.11" data-end="731.49">another thing that we noticed for</span> <span data-start="731.49" data-end="735.21">example is that it's slow to read we use</span> <span data-start="735.21" data-end="737.55">index DB its load to read index DB while</span> <span data-start="737.55" data-end="739.11">things are loading because the async</span> <span data-start="739.11" data-end="741.09">callbacks come back asynchronously at a</span> <span data-start="741.09" data-end="743.58">time and what you can't determine so if</span> <span data-start="743.58" data-end="746.04">a large JavaScript binary came in in</span> <span data-start="746.04" data-end="748.44">between it takes forever to cut to get</span> <span data-start="748.44" data-end="749.94">the call back and you can't have that</span> <span data-start="749.94" data-end="754.65">you really want to snap you load so from</span> <span data-start="754.65" data-end="756.63">there we parse the URL we extract out</span> <span data-start="756.63" data-end="758.16">the doc idea and whatever other things</span> <span data-start="758.16" data-end="760.47">are in the hashtag and then we rewrite</span> <span data-start="760.47" data-end="766.21">it using the browser html5 history API</span> <span data-start="766.22" data-end="770.76">and that's basically our initial load</span> <span data-start="770.76" data-end="774.45">flow so that worked really well except</span> <span data-start="774.45" data-end="777.03">we bumped into this issue and we really</span> <span data-start="777.03" data-end="778.82">we really only came up on it</span> <span data-start="778.82" data-end="781.29">infrequently but it was affecting more</span> <span data-start="781.29" data-end="782.61">and more users and we couldn't really</span> <span data-start="782.61" data-end="786.9">figure out what was going on so CSS and</span> </p>
<p><span data-start="786.9" data-end="788.55">JS bundles have to match the landing</span> <span data-start="788.55" data-end="790.2">page landing page here is just the HTML</span> <span data-start="790.2" data-end="793.17">page that's served so how does this come</span> <span data-start="793.17" data-end="795.48">up in practice same buddy have have an</span> <span data-start="795.48" data-end="797.94">idea of when the the JavaScript in the</span> <span data-start="797.94" data-end="804.64">HTML page wouldn't match so</span> <span data-start="804.64" data-end="810.19">this comes up so first let me let me</span> <span data-start="810.19" data-end="812.05">tell you why they have to match so our</span> <span data-start="812.05" data-end="814.78">HTML landing page actually points to a</span> <span data-start="814.78" data-end="817.12">javascript binary that has a hash tag</span> <span data-start="817.12" data-end="819.37">attached to it so for example we have</span> <span data-start="819.37" data-end="821.53">the HTML page refer to my javascript</span> <span data-start="821.53" data-end="825.31">binary 1 2 3 and that ensures that the</span> <span data-start="825.31" data-end="827.29">api's that are used between them are</span> <span data-start="827.29" data-end="831.25">identical so why is this a problem so</span> <span data-start="831.25" data-end="832.87">let's actually step through this and try</span> <span data-start="832.87" data-end="835.66">to see when this happens so there's a</span> <span data-start="835.66" data-end="837.37">level of indirection that's added by the</span> <span data-start="837.37" data-end="841.15">app cache so the user requests the app</span> <span data-start="841.15" data-end="844.09">cache manifest from a given machine from</span> <span data-start="844.09" data-end="847.18">machine a and that app cache manifest</span> <span data-start="847.18" data-end="851.86">says ok so your HDL page is / page for</span> <span data-start="851.86" data-end="855.91">example or / edit for documents and here</span> <span data-start="855.91" data-end="859.39">is your JavaScript binary etc that's</span> <span data-start="859.39" data-end="861.28">fine the users happy everything's good</span> <span data-start="861.28" data-end="863.38">and then the user goes to actually fetch</span> <span data-start="863.38" data-end="866.29">that so first they go to fetch the the</span> <span data-start="866.29" data-end="868.45">hash static content so they go and fetch</span> <span data-start="868.45" data-end="870.55">my JavaScript binary one two three</span> <span data-start="870.55" data-end="873.79">perfect not a problem and then they go</span> <span data-start="873.79" data-end="877">to fetch they go to fetch the HTML</span> <span data-start="877" data-end="878.56">landing page and now they hit a</span> <span data-start="878.56" data-end="881.02">different machine that machine could be</span> <span data-start="881.02" data-end="883.63">on a different a different schedule so</span> <span data-start="883.63" data-end="885.37">for example as we're rolling out new</span> <span data-start="885.37" data-end="888.67">versions of docs this probably won't</span> <span data-start="888.67" data-end="890.08">come as a surprise to you guys but we</span> <span data-start="890.08" data-end="891.97">have more than one machine running</span> </p>
<p><span data-start="891.97" data-end="895.33">Google Docs so as we roll as we roll out</span> <span data-start="895.33" data-end="898">new versions not all machines are on the</span> <span data-start="898" data-end="900.52">same version and that's exactly what's</span> <span data-start="900.52" data-end="902.62">happening here when we hit when we hit</span> <span data-start="902.62" data-end="904.78">machine be to actually retrieve the HTML</span> <span data-start="904.78" data-end="907.29">page it points to my JavaScript binary</span> <span data-start="907.29" data-end="911.11">456 the worst part about this is that</span> <span data-start="911.11" data-end="914.65">there's no mechanism to stop this the</span> <span data-start="914.65" data-end="916.51">the server will order have to return to</span> <span data-start="916.51" data-end="918.94">hundreds for all of this which from its</span> <span data-start="918.94" data-end="920.02">point of view it started everything</span> <span data-start="920.02" data-end="923.29">correctly the browser will see</span> <span data-start="923.29" data-end="925.45">everything returned properly so it says</span> <span data-start="925.45" data-end="927.85">my app cache is up-to-date it won't</span> <span data-start="927.85" data-end="929.74">retrieve a new app cache until there's a</span> <span data-start="929.74" data-end="931.45">new push so that could be you know a</span> <span data-start="931.45" data-end="934.81">week so that user won't be able to use</span> <span data-start="934.81" data-end="937.9">their offline application for that week</span> <span data-start="937.9" data-end="938.62">because</span> <span data-start="938.62" data-end="939.85">as soon as they get to the landing page</span> <span data-start="939.85" data-end="942.22">it will point to a JavaScript binary</span> <span data-start="942.22" data-end="944.41">which doesn't exist offline because</span> <span data-start="944.41" data-end="945.67">they're pointing to one two three and</span> <span data-start="945.67" data-end="949.42">they only have four five six offline so</span> <span data-start="949.42" data-end="951.97">they explode and exploding is a problem</span> <span data-start="951.97" data-end="954.93">so there are actually a few solutions</span> <span data-start="954.93" data-end="957.94">that are possible here does anybody have</span> <span data-start="957.94" data-end="959.23">any ideas send really bumped into this</span> <span data-start="959.23" data-end="966.34">before but I hear a yes out there so</span> <span data-start="966.34" data-end="968.26">what what was your solution or if you're</span> <span data-start="968.26" data-end="982.15">if you're willing to share it okay okay</span> <span data-start="982.15" data-end="985.99">that's that's a that's a related problem</span> <span data-start="985.99" data-end="987.91">so his solution was to make sure that</span> <span data-start="987.91" data-end="989.86">that that didn't change the the URLs</span> <span data-start="989.86" data-end="991.78">didn't change that's definitely one</span> <span data-start="991.78" data-end="994.48">solution and that's something that we</span> <span data-start="994.48" data-end="997.27">wanted to do but we decided against it</span> <span data-start="997.27" data-end="999.07">and the reason is you get a lot more</span> <span data-start="999.07" data-end="1003.06">cash hits if you uh if you hit if the</span> <span data-start="1003.06" data-end="1005.7">binary is always the same name so for</span> <span data-start="1005.7" data-end="1007.08">example if you have my JavaScript binary</span> <span data-start="1007.08" data-end="1010.5">1 2 3 you can you can say this expires a</span> <span data-start="1010.5" data-end="1013.17">you know a dozen years from now so that</span> <span data-start="1013.17" data-end="1015.57">the client never has to refresh the</span> <span data-start="1015.57" data-end="1017.64">binary and we weren't willing to undo</span> <span data-start="1017.64" data-end="1020.22">some optimizations that having a hash in</span> <span data-start="1020.22" data-end="1023.22">our in our JavaScript would an hour</span> </p>
<p><span data-start="1023.22" data-end="1025.35">JavaScript binary name would do somebody</span> <span data-start="1025.35" data-end="1030.57">else have any ideas all right well I'll</span> <span data-start="1030.57" data-end="1033.93">throw some out there so you could</span> <span data-start="1033.93" data-end="1035.97">download multiple binaries you could say</span> <span data-start="1035.97" data-end="1037.77">I'm going to download java script binary</span> <span data-start="1037.77" data-end="1040.89">one two three and four five six the</span> <span data-start="1040.89" data-end="1043.23">issue is that we have to know beforehand</span> <span data-start="1043.23" data-end="1044.79">when we're going to updates four five</span> <span data-start="1044.79" data-end="1046.83">six so before a push we would have to</span> <span data-start="1046.83" data-end="1049.32">tell all existing machines hey the next</span> </p>
<p><span data-start="1049.32" data-end="1050.82">JavaScript binary is going to be four</span> <span data-start="1050.82" data-end="1052.92">five six so download both of them and</span> <span data-start="1052.92" data-end="1055.65">that's sort of crappy plus the user is</span> <span data-start="1055.65" data-end="1057.54">going to have to download a lot more a</span> <span data-start="1057.54" data-end="1060.9">lot more JavaScript binaries and it's</span> <span data-start="1060.9" data-end="1064.17">just not the cleanest approach so you</span> <span data-start="1064.17" data-end="1065.46">could put the binary and slamming page</span> <span data-start="1065.46" data-end="1067.53">instead of having an external javascript</span> <span data-start="1067.53" data-end="1070.59">binary just in line it the difficulty</span> <span data-start="1070.59" data-end="1072">there is really performance</span> <span data-start="1072" data-end="1074.85">it's really what it boils down to it</span> <span data-start="1074.85" data-end="1076.74">also deviates from the online case and</span> <span data-start="1076.74" data-end="1078.12">we really wanted to keep the online and</span> <span data-start="1078.12" data-end="1082.23">offline flows similar so performance the</span> <span data-start="1082.23" data-end="1084.24">problem because we we dynamically</span> <span data-start="1084.24" data-end="1086.52">execute our scripts to ensure that only</span> <span data-start="1086.52" data-end="1088.98">when we need something does it get</span> <span data-start="1088.98" data-end="1091.35">pulled in so the user is able to edit a</span> <span data-start="1091.35" data-end="1093.42">document before all of the javascript is</span> <span data-start="1093.42" data-end="1097.26">even downloaded so we could put binary</span> <span data-start="1097.26" data-end="1098.94">into a comment and then evaluate that</span> <span data-start="1098.94" data-end="1101.91">comment so this is actually what what</span> <span data-start="1101.91" data-end="1103.8">other people do this is this is a fairly</span> <span data-start="1103.8" data-end="1106.8">common pattern and this is one that we</span> <span data-start="1106.8" data-end="1108.3">were really considering the problem is</span> <span data-start="1108.3" data-end="1110.28">it will deviate from online and offline</span> <span data-start="1110.28" data-end="1112.44">and the online case we don't want the</span> <span data-start="1112.44" data-end="1114.57">user to have to download two megabytes</span> <span data-start="1114.57" data-end="1116.85">of an HTML page before evaluating a</span> <span data-start="1116.85" data-end="1120.24">comment and we really did want that that</span> <span data-start="1120.24" data-end="1123">hard barrier there so you could version</span> <span data-start="1123" data-end="1124.74">landing pages the other thing you could</span> <span data-start="1124.74" data-end="1128.55">do is instead of having / / page or /</span> <span data-start="1128.55" data-end="1132.45">edit you could have / edit one / edit to</span> <span data-start="1132.45" data-end="1135.21">and / edit one will map to my JavaScript</span> <span data-start="1135.21" data-end="1138.27">binary one two three my you know edit</span> <span data-start="1138.27" data-end="1141.81">two will map to four five six the issue</span> <span data-start="1141.81" data-end="1143.97">is then all applications then have to</span> <span data-start="1143.97" data-end="1146.43">know oh I have to hit / edit to instead</span> <span data-start="1146.43" data-end="1148.92">of / edit three or instead of / out of</span> <span data-start="1148.92" data-end="1150.81">four and getting that coordination right</span> <span data-start="1150.81" data-end="1152.85">between all the different editors or</span> <span data-start="1152.85" data-end="1154.71">between all the between the fallback</span> <span data-start="1154.71" data-end="1157.47">application which actually loads it and</span> <span data-start="1157.47" data-end="1159.71">the end the push is kind of complicated</span> <span data-start="1159.71" data-end="1162.42">which leads us to intercept entries</span> <span data-start="1162.42" data-end="1164.67">which is what we ended up going with so</span> <span data-start="1164.67" data-end="1166.08">who here is familiar with the chrome</span> <span data-start="1166.08" data-end="1168.78">specific for as far as I know comes to</span> <span data-start="1168.78" data-end="1170.58">the concept of intercept entries in the</span> <span data-start="1170.58" data-end="1173.28">app cache awesome i'm going to teach you</span> <span data-start="1173.28" data-end="1179.67">something new so so chrome specific app</span> <span data-start="1179.67" data-end="1182.85">cache entries allow you allow you to</span> <span data-start="1182.85" data-end="1186.06">intercept urls using a prefix match</span> <span data-start="1186.06" data-end="1191.34">before they hit the network so how do we</span> <span data-start="1191.34" data-end="1195.78">use it we can say URL returns URL to so</span> <span data-start="1195.78" data-end="1199.2">in this case what we can do is we can</span> <span data-start="1199.2" data-end="1202.32">append that version so we can append</span> <span data-start="1202.32" data-end="1205.56">that version but have / edit reader</span> <span data-start="1205.56" data-end="1208.64">subversion in other words we can have in</span> <span data-start="1208.64" data-end="1212.04">the in the explicit entry section we can</span> <span data-start="1212.04" data-end="1214.92">have / page given that version we either</span> <span data-start="1214.92" data-end="1216.66">through a query parameter or however you</span> <span data-start="1216.66" data-end="1219.09">want to append it's that URL then we can</span> <span data-start="1219.09" data-end="1221.52">have that intercept entry say / page</span> <span data-start="1221.52" data-end="1225.45">always forwards to always forwards to /</span> <span data-start="1225.45" data-end="1229.05">page with that version attached so how</span> <span data-start="1229.05" data-end="1232.29">does this work why does this work so</span> <span data-start="1232.29" data-end="1234.27">what ends up happening is the browser</span> <span data-start="1234.27" data-end="1236.64">will actually try to download / page</span> <span data-start="1236.64" data-end="1238.44">with the given version if it hits</span> <span data-start="1238.44" data-end="1240.03">machine be if we go back to our diagram</span> <span data-start="1240.03" data-end="1242.37">and it hits machine be it's going to say</span> </p>
<p><span data-start="1242.37" data-end="1243.84">I don't know what that version is and</span> <span data-start="1243.84" data-end="1246">it's going to send back a 404 the</span> <span data-start="1246" data-end="1247.77">browser just going to get that 404 and</span> <span data-start="1247.77" data-end="1250.02">it's going to say well this app cache</span> <span data-start="1250.02" data-end="1252.69">this app cache update was a failure so</span> <span data-start="1252.69" data-end="1254.94">let's throw this away and then it does</span> <span data-start="1254.94" data-end="1257.97">it again so if the if the machine that</span> <span data-start="1257.97" data-end="1261.33">you hit is on a different version if the</span> <span data-start="1261.33" data-end="1262.77">machine that you hit when retrieving the</span> <span data-start="1262.77" data-end="1264.81">app cache manifest is on a different</span> <span data-start="1264.81" data-end="1266.34">version than the machine that you hit</span> <span data-start="1266.34" data-end="1267.96">when you actually retrieve the landing</span> <span data-start="1267.96" data-end="1270.78">page it just won't update the app cache</span> <span data-start="1270.78" data-end="1273.06">will not update so this is guaranteed to</span> <span data-start="1273.06" data-end="1275.49">work which is pretty neat and it</span> <span data-start="1275.49" data-end="1276.66">requires no difference between the</span> <span data-start="1276.66" data-end="1279.26">online in the offline flow we can still</span> <span data-start="1279.26" data-end="1282.63">use / page 1 online we don't have to</span> <span data-start="1282.63" data-end="1288.57">append a version number to it so why</span> <span data-start="1288.57" data-end="1292.32">this talk so I have just a few minutes</span> <span data-start="1292.32" data-end="1294.12">left and I really want people to think</span> <span data-start="1294.12" data-end="1296.97">about offline it's best for you and it's</span> <span data-start="1296.97" data-end="1298.92">best for your users if the stuff that</span> <span data-start="1298.92" data-end="1300.54">you if the stuff that you work on is</span> <span data-start="1300.54" data-end="1302.82">available for your users all the time</span> <span data-start="1302.82" data-end="1304.77">they will be much happier than if it's</span> <span data-start="1304.77" data-end="1306.12">available to them only when they have a</span> <span data-start="1306.12" data-end="1308.28">connection I'm sure people here despite</span> <span data-start="1308.28" data-end="1311.07">how how connected we seem to constantly</span> <span data-start="1311.07" data-end="1314.01">be have experienced network outages been</span> <span data-start="1314.01" data-end="1317.21">on a plane etc so web apps and</span> <span data-start="1317.21" data-end="1320.12">traditional apps are fairly similar</span> <span data-start="1320.12" data-end="1324">except now web apps can take advantage</span> <span data-start="1324" data-end="1326.22">of all the benefits of the cloud plus go</span> <span data-start="1326.22" data-end="1327.78">offline and I think that we've really</span> <span data-start="1327.78" data-end="1330.96">demonstrated it with with Doc's offline</span> </p>
<p><span data-start="1330.96" data-end="1333.57">I also wanted to point out some of the</span> <span data-start="1333.57" data-end="1334.92">things that made it hard for us like</span> <span data-start="1334.92" data-end="1337.02">matching static content through the</span> <span data-start="1337.02" data-end="1339.309">landing page that's something which</span> <span data-start="1339.309" data-end="1341.35">earlier earlier offline things like</span> <span data-start="1341.35" data-end="1344.35">there I mentioned it gears actually did</span> <span data-start="1344.35" data-end="1346.99">right and an app in the app cache world</span> <span data-start="1346.99" data-end="1348.759">that's that's been difficult for us to</span> <span data-start="1348.759" data-end="1353.74">do and it can be done so think offline</span> <span data-start="1353.74" data-end="1355.929">whenever you construct something make</span> <span data-start="1355.929" data-end="1357.789">sure that whenever it goes to server</span> <span data-start="1357.789" data-end="1359.44">just send its local store as well then</span> <span data-start="1359.44" data-end="1363.249">read it back from local store so I have</span> <span data-start="1363.249" data-end="1366.97">a few minutes left so I wanted to thank</span> <span data-start="1366.97" data-end="1369.61">you all for for coming and sitting</span> <span data-start="1369.61" data-end="1371.379">through my talk I didn't know if anybody</span> <span data-start="1371.379" data-end="1373.179">had any questions about any of the</span> <span data-start="1373.179" data-end="1374.919">things that I've discussed and i'll also</span> <span data-start="1374.919" data-end="1377.529">be available at the at the google booth</span> <span data-start="1377.529" data-end="1380.08">after this so feel free to visit us</span> <span data-start="1380.08" data-end="1383.499">we're in the and the lunchroom yes hey</span> <span data-start="1383.499" data-end="1386.379">so with the intercept rules was that</span> <span data-start="1386.379" data-end="1388.029">something that you put into chrome</span> <span data-start="1388.029" data-end="1389.649">because docks required it or is it</span> <span data-start="1389.649" data-end="1391.6">something that chrome put in then docs</span> <span data-start="1391.6" data-end="1393.7">discovered it like as it is that is eid</span> <span data-start="1393.7" data-end="1395.47">back loop or that is an excellent</span> <span data-start="1395.47" data-end="1400.09">question so the answer the answer is we</span> <span data-start="1400.09" data-end="1402.399">discovered it so if you take a look at</span> <span data-start="1402.399" data-end="1403.929">if you take a look at the history of it</span> <span data-start="1403.929" data-end="1406.09">intercept entries were added sometime</span> <span data-start="1406.09" data-end="1408.909">last November in the newest version of</span> </p>
<p><span data-start="1408.909" data-end="1412.419">Chrome nightlies at the time and and we</span> <span data-start="1412.419" data-end="1414.45">took advantage of it at some point in</span> <span data-start="1414.45" data-end="1420.909">June something like that so that was</span> <span data-start="1420.909" data-end="1425.419">that was innocent of us other questions</span> <span data-start="1425.429" data-end="1428.2">kind of a follow-up to this one are you</span> <span data-start="1428.2" data-end="1431.95">pushing that to standard bodies to get</span> <span data-start="1431.95" data-end="1433.869">because that sounds really useful but</span> <span data-start="1433.869" data-end="1436.869">then it only works on Chrome it is</span> <span data-start="1436.869" data-end="1439.119">incredibly useful so that's something</span> <span data-start="1439.119" data-end="1444.34">that we leave up to so there was a talk</span> <span data-start="1444.34" data-end="1446.47">earlier today in this room about pushing</span> <span data-start="1446.47" data-end="1448.6">stuff to standards bodies and it takes a</span> <span data-start="1448.6" data-end="1450.129">lot of time so that's something that we</span> <span data-start="1450.129" data-end="1452.559">have been pushing for there are a couple</span> <span data-start="1452.559" data-end="1455.499">of things that are better slowing that</span> <span data-start="1455.499" data-end="1457.09">down but this is something that we're</span> <span data-start="1457.09" data-end="1458.499">pushing for we think that it's an</span> <span data-start="1458.499" data-end="1459.85">excellent improvement to every browser</span> <span data-start="1459.85" data-end="1462.97">if it's one of its one of the things</span> <span data-start="1462.97" data-end="1465.46">along with getting permissions from the</span> <span data-start="1465.46" data-end="1466.96">chrome apps and background pages etc</span> <span data-start="1466.96" data-end="1470.049">that are preventing us from doing docs</span> <span data-start="1470.049" data-end="1471.82">offline cross-browser right now it's</span> <span data-start="1471.82" data-end="1472.99">chrome only so</span> <span data-start="1472.99" data-end="1475.15">pushing this to through standards will</span> <span data-start="1475.15" data-end="1477.309">make docs offline work everywhere that's</span> <span data-start="1477.309" data-end="1478.9">the better for us so that's definitely</span> <span data-start="1478.9" data-end="1481.78">something that we're pushing for other</span> <span data-start="1481.78" data-end="1486.91">questions I think that's it I think</span> <span data-start="1486.91" data-end="1488.47">that's it for now if you have any more</span> <span data-start="1488.47" data-end="1490.45">questions Kevin will be at the Google</span> <span data-start="1490.45" data-end="1492.46">booth inside but thank you very much</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
