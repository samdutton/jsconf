<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="web.dev LIVE video transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>6FRURtW5qXI</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/6FRURtW5qXI?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="24.939" data-end="25.96">Thank you.</span> <span data-start="25.96" data-end="30.099">A recurring theme over the last decade or so in the software industry is the</span> <span data-start="30.099" data-end="31.96">growth of data.</span> <span data-start="31.96" data-end="33.39">Some estimates say we've been doubling the total</span> <span data-start="33.39" data-end="38.12">amount of data in as little as every 2 years, and to</span> <span data-start="38.12" data-end="39.64">start with, we didn't really know what to do with all</span> <span data-start="39.64" data-end="41.469">the data we've been recording.</span> </p>
<p><span data-start="41.469" data-end="43.42">As people started to figure out the questions they wanted to ask</span> <span data-start="43.42" data-end="47.079">of their data the software industry reacted to this,</span> <span data-start="47.079" data-end="49.63">we develop backends and databases to scale that was able</span> <span data-start="49.63" data-end="53.129">to process this data in realtime.</span> <span data-start="53.129" data-end="57.559">Technology like Hadoop, Spark and Cassandra are now doing it in the scale.</span> <span data-start="57.559" data-end="62.989">This enables us, as front-end developers, to build</span> <span data-start="62.989" data-end="68.66">front ends to visualise and explore this data in realtime.</span> </p>
<p><span data-start="68.66" data-end="71.97">In this talk I'm going to show you a couple of talks</span> <span data-start="71.97" data-end="75.8">we have built out, and but first I want to explore</span> <span data-start="75.8" data-end="78.58">what is a good user experience.</span> <span data-start="78.58" data-end="80.89">In my eyes, it is two things, and there's many different ways of cutting</span> <span data-start="80.89" data-end="84.45">it, but I'm going to talk about intuitive and responsive</span> <span data-start="84.45" data-end="87.229">but intuitive, I'm talking about a user should</span> <span data-start="87.229" data-end="89.03">quickly be able to get a good understanding of what their</span> <span data-start="89.03" data-end="92.13">data is and how they should obviously ask questions</span> <span data-start="92.13" data-end="93.58">of it.</span> <span data-start="93.58" data-end="95.83">This is by no means an easy problem.</span> <span data-start="95.83" data-end="100.16">It requires a lot of studying by designers and front end engineers,</span> <span data-start="100.16" data-end="103.33">but it basically requires a good grasp of what your</span> <span data-start="103.33" data-end="105.55">users are, and the kind of questions they ask.</span> </p>
<p><span data-start="105.55" data-end="108.56">It can be dependent on the industry you're developing for as the</span> <span data-start="108.56" data-end="111.81">shape of the data.</span> <span data-start="111.81" data-end="114.34">And responsive, I'm not talking about responsive web</span> <span data-start="114.34" data-end="117.45">design but a responsive application when a user asks</span> <span data-start="117.45" data-end="119.81">a question of the application, it should be easy for</span> <span data-start="119.81" data-end="121.849">that user to get the answer they're looking for.</span> <span data-start="121.849" data-end="125.47">It should be very fast and responsive.</span> <span data-start="125.47" data-end="128.3">In the enterprise software industry, we've seen a lot of software</span> <span data-start="128.3" data-end="130.5">where these ask a straightforward question of the</span> <span data-start="130.5" data-end="133.48">data and it can take minutes, hours or even days to get</span> <span data-start="133.48" data-end="135.17">a response.</span> </p>
<p><span data-start="135.17" data-end="138.7">We don't want our users to switch between asking</span> <span data-start="138.7" data-end="140.53">questions and receiving an answer.</span> <span data-start="140.53" data-end="142.02">Let's talk about earthquakes.</span> <span data-start="142.02" data-end="147.909">Around 30 to 40 years ago, the traditional ways of measuring them was using seismological</span> <span data-start="147.909" data-end="148.909">data.</span> <span data-start="148.909" data-end="156.5">This pen would scribble on  the page.</span> <span data-start="156.5" data-end="160.25">These days, pretty much all of the data is digitised so there</span> <span data-start="160.25" data-end="163.72">are websites like this one which have a tonne of data spanning</span> <span data-start="163.72" data-end="167.2">about last week for thousands of sensor groups all</span> <span data-start="167.2" data-end="168.2">around the world.</span> </p>
<p><span data-start="168.2" data-end="169.78">Here we're going to look at an earthquake that</span> <span data-start="169.78" data-end="174.37">happened earlier in the month off the coast of Chilli,</span> <span data-start="174.37" data-end="177.58">it was kind of a big one, 8.3 on the Richter Scale.</span> <span data-start="177.58" data-end="180.27">So here we can see it happened around 11 pm,</span> <span data-start="180.27" data-end="182.64">maybe we want to see if there are any aftershocks, so we'll</span> <span data-start="182.64" data-end="185.7">plug in the next day, click update, wait for the spinners</span> <span data-start="185.7" data-end="188.64">to go away and we'll see that kind of information.</span> </p>
<p><span data-start="188.64" data-end="192.951">That isn't exactly unintuitive, but I can't zoom in</span> <span data-start="192.951" data-end="196.82">and see more of the data, I can't pan around and compare</span> <span data-start="196.82" data-end="199.069">the aftershocks with the initial quake.</span> <span data-start="199.069" data-end="202.36">I'm not able to do that side by sight analysis and there are</span> <span data-start="202.36" data-end="204.54">free charts on the screen all showing slightly different</span> <span data-start="204.54" data-end="207.34">data, but at this level of detail it is not discernible,</span> <span data-start="207.34" data-end="209.82">you can't make out what they're trying to show.</span> <span data-start="209.82" data-end="216.38">Now I want to show you something we've built.</span> </p>
<p><span data-start="216.38" data-end="219.08">This is chronicle, an application we built for</span> <span data-start="219.08" data-end="221.82">analysing time series data.</span> <span data-start="221.82" data-end="223.42">Seismological data is one example.</span> <span data-start="223.42" data-end="226.7">I'll search for Alaska.</span> <span data-start="226.7" data-end="232.81">In early September there was a swarm of earthquakes off the islands in Alaska,</span> <span data-start="232.81" data-end="237.05">this isn't a particularly part of the interesting work</span> <span data-start="237.05" data-end="239.37">for earthquakes, the US geological survey has</span> <span data-start="239.37" data-end="243.18">a bunch of things for recording activity.</span> <span data-start="243.18" data-end="245.81">We can see a big spike.</span> <span data-start="245.81" data-end="251.29">Select this and zoom in.</span> <span data-start="251.29" data-end="253.19">A huge cluster of earthquakes.</span> <span data-start="253.19" data-end="255.15">Zoom in.</span> <span data-start="255.15" data-end="257.799">It gets blocky here, and we'll talk about that</span> <span data-start="257.799" data-end="258.799">later on.</span> <span data-start="258.799" data-end="261.549">I have enough screen real estate, so I can split</span> <span data-start="261.549" data-end="264.002">these up as well, make it easier to figure out what is</span> <span data-start="264.002" data-end="266.22">going on if we don't have them clashing all on top of</span> <span data-start="266.22" data-end="268.629">each other.</span> </p>
<p><span data-start="268.629" data-end="276.56">We  can now pan and zoom around like you'd</span> <span data-start="276.56" data-end="277.56">expect.</span> <span data-start="277.56" data-end="282.81">This is a responsive intuitive application, I can zoom in and see what's going on, hide</span> <span data-start="282.81" data-end="287.09">these axes, and we can see that this sensor recording</span> <span data-start="287.09" data-end="292.05">the earthquake a few minutes, a few seconds, maybe, after</span> <span data-start="292.05" data-end="294.96">the other sensors.</span> <span data-start="294.96" data-end="298.7">And that's actually because this particularly sensor is on a different island further away.</span> <span data-start="298.7" data-end="300.65">We can use that to maybe triangulate the position</span> <span data-start="300.65" data-end="303.52">of the epicentre of the earthquake.</span> <span data-start="303.52" data-end="306.73">If you remember your high school university or geology classes, you'll</span> <span data-start="306.73" data-end="310.65">know it's made up of two component waves and a bunch</span> <span data-start="310.65" data-end="313.21">of the smaller ones too, the P1 at the start, the</span> <span data-start="313.21" data-end="315.55">S wave is the higher frequency one that comes in probably</span> <span data-start="315.55" data-end="317.31">around here.</span> </p>
<p><span data-start="317.31" data-end="319.66">If we wanted to compare this particular quake with the</span> <span data-start="319.66" data-end="323.58">others, we could offset it maybe and interact with these</span> <span data-start="323.58" data-end="326.06">charts individually, but we have a common scrub bar</span> <span data-start="326.06" data-end="328.72">across all three, so we can get a good idea of what's</span> <span data-start="328.72" data-end="331">going on.</span> <span data-start="331" data-end="334.69">What I'm trying to show you here is not actually anything to do with earthquakes or seismology,</span> <span data-start="334.69" data-end="337.05">they're both interesting and not terribly relevant</span> <span data-start="337.05" data-end="338.05">to the conference.</span> <span data-start="338.05" data-end="347.05">What I'm trying to show you a is a good way of measuring a large act of data.</span> </p>
<p><span data-start="347.05" data-end="350.88">That's key as an engineer, a lot of that is very interesting</span> <span data-start="350.88" data-end="354.169">to me, although as a user you can't really tell.</span> <span data-start="354.169" data-end="356.25">There is no indication of how much is on the screen.</span> <span data-start="356.25" data-end="358.96">Our users don't really care how much they have, they</span> <span data-start="358.96" data-end="362.419">just care about being access and asking questions.</span> <span data-start="362.419" data-end="365.54">For reference, there are four different series each recorded</span> <span data-start="365.54" data-end="368.92">at 100-hertz, so over the entire week, that's</span> <span data-start="368.92" data-end="371.61">around 300 million data points and all running on</span> <span data-start="371.61" data-end="374.3">my laptop and I'm able to interact with it intuitively and</span> <span data-start="374.3" data-end="376.669">responsibly.</span> </p>
<p><span data-start="376.669" data-end="378.919">This was developed for an industry customer, they</span> <span data-start="378.919" data-end="381.48">didn't care about data quite as dense as this, what they</span> <span data-start="381.48" data-end="387.32">cared about was  —  they had data of across tens of</span> <span data-start="387.32" data-end="391.8">thousands of different series, spanning multiple years,</span> <span data-start="391.8" data-end="395.729">and it is used in critical safety of life operations</span> <span data-start="395.729" data-end="398.14">where they need to be able to look at up to 40 series at</span> <span data-start="398.14" data-end="404.2">once of live, incoming realtime data.</span> <span data-start="404.2" data-end="409.3">So in total, with the tens of thousands of series over many,</span> <span data-start="409.3" data-end="412.08">many years, they have around 300 billion data points and</span> <span data-start="412.08" data-end="414.8">they're able to interact with it as if it was one.</span> </p>
<p><span data-start="414.8" data-end="417.37">They don't really care about the data skill.</span> <span data-start="417.37" data-end="420.77">And this is just one way of visualising large amounts of data.</span> <span data-start="420.77" data-end="425.04">I'm now going to show you another, and this is something</span> <span data-start="425.04" data-end="427.53">we built during hack week this year at Palantir.</span> <span data-start="427.53" data-end="433.12">It is a week Palantir has every year where we get to basically</span> <span data-start="433.12" data-end="435.22">work on whatever we want for an entire week.</span> <span data-start="435.22" data-end="437.509">Anyone in the company is allowed to work on any project</span> <span data-start="437.509" data-end="439.75">completely unrelated to their usual work, maybe a feature</span> <span data-start="439.75" data-end="442.66">to add to an app, maybe an entirely new prototype of</span> <span data-start="442.66" data-end="445.93">an application, and that's what we built up.</span> </p>
<p><span data-start="445.93" data-end="450.02">It's my favourite week because it gives anyone the</span> <span data-start="450.02" data-end="452.65">opportunity to build something cool and form a team around</span> <span data-start="452.65" data-end="454.3">it.</span> <span data-start="454.3" data-end="456.081">Many of our great products and features have come</span> <span data-start="456.081" data-end="457.199">out of this week.</span> <span data-start="457.199" data-end="460.32">What we're looking at is a network graph.</span> <span data-start="460.32" data-end="464.74">I have US presidential election data from campaign finance</span> <span data-start="464.74" data-end="465.8">data.</span> <span data-start="465.8" data-end="467.74">This was taken from the last two weeks running up to the</span> </p>
<p><span data-start="467.74" data-end="469.83">US election, and this dataset is entirely available</span> <span data-start="469.83" data-end="472.08">online and is one of the largest I know of of these</span> <span data-start="472.08" data-end="474.19">relational datasets.</span> <span data-start="474.19" data-end="478.1">We can see in the middle we have Art Robinson for congress, a political action</span> <span data-start="478.1" data-end="479.57">for committee.</span> <span data-start="479.57" data-end="483.789">This one particularly supports Art Robinson, but however these committees can support a</span> <span data-start="483.789" data-end="486.32">candidate or particular interest group.</span> <span data-start="486.32" data-end="490.5">Around it we can see payments and the green dots are</span> <span data-start="490.5" data-end="492.57">the donors.</span> <span data-start="492.57" data-end="497.52">So we can evaluate who is giving money to who.</span> <span data-start="497.52" data-end="504.819">In this particular case, we can see that William Brady here is donating $200 to Robinson for</span> <span data-start="504.819" data-end="505.819">congress.</span> <span data-start="505.819" data-end="508.06">What's interesting about this is that while we only took</span> <span data-start="508.06" data-end="510.36">about two weeks of the data and we only took it for</span> <span data-start="510.36" data-end="512.34">California, there is actually a whole tonne of data.</span> <span data-start="512.34" data-end="515.56">These are all the transactions in the last two weeks,</span> <span data-start="515.56" data-end="517.719">and maybe this is a comment on the US political system.</span> </p>
<p><span data-start="517.719" data-end="521.44">I'm allowed to do that; I'm in Europe.</span> <span data-start="521.44" data-end="525">So as we zoom out, we see a good view of the entire</span> <span data-start="525" data-end="527.74">data and we can see some visual artifacts going on and</span> <span data-start="527.74" data-end="530.399">I'm going to explain why these are later on.</span> <span data-start="530.399" data-end="534.38">So here we have the entire set of data.</span> <span data-start="534.38" data-end="536.68">There's two large blobs in the middle and then two to</span> <span data-start="536.68" data-end="537.91">the bottom right.</span> <span data-start="537.91" data-end="540.339">It won't surprise you if we use this little tool</span> <span data-start="540.339" data-end="544.86">to jump in and analyse what's going on in a given area,</span> <span data-start="544.86" data-end="548.39">we can find Mr Obama's political action commits and,</span> <span data-start="548.39" data-end="552.11">woah, that way too far.</span> <span data-start="552.11" data-end="554.339">Zoom out now.</span> <span data-start="554.339" data-end="556.58">It's thinking hard.</span> <span data-start="556.58" data-end="557.83">Traditionally at Palantir we've been dealing with</span> <span data-start="557.83" data-end="560.43">these large datasets for a while, and we didn't think</span> <span data-start="560.43" data-end="563.23">there was too much value in a graph of this scale.</span> </p>
<p><span data-start="563.23" data-end="565.73">It is so much data that we didn't think you could</span> <span data-start="565.73" data-end="566.99">visualise what was going.</span> <span data-start="566.99" data-end="570.52">However, when we built and took advantage of these features like the loop</span> <span data-start="570.52" data-end="572.12">I was just showing you, and hope to show you again in</span> <span data-start="572.12" data-end="577.279">a minute, when this has decided it's going to behave,</span> <span data-start="577.279" data-end="580.14">and through some clever node colouring, I suppose I can</span> <span data-start="580.14" data-end="582.94">fit it to screen, we're able to analyse this large amount</span> <span data-start="582.94" data-end="586.3">of data in a realistic and easy way.</span> </p>
<p><span data-start="586.3" data-end="590.52">We're basically allowed to see what's going on here, zoom in for more</span> <span data-start="590.52" data-end="592.98">information, we can use the loop tool to figure out this</span> <span data-start="592.98" data-end="597.41">one of Romney's parks, it is kind of unsurprising</span> <span data-start="597.41" data-end="601.54">these large groups are both related to Obama and Romney.</span> <span data-start="601.54" data-end="606.8">So this is a whole tonne of data and that's kind of interesting</span> <span data-start="606.8" data-end="607.8">to me.</span> <span data-start="607.8" data-end="609.071">It's probably not as interesting to our users how</span> <span data-start="609.071" data-end="611.81">much data we have here, but we're able to interact</span> <span data-start="611.81" data-end="614.38">with it in a realistic way, we're able to interact with</span> <span data-start="614.38" data-end="617.87">it, move nodes around as we see fit, apply layouts,</span> <span data-start="617.87" data-end="621.74">follow the lengths so here I can expand my selection to</span> <span data-start="621.74" data-end="625.62">all of the related lengths, and we can select all and we</span> <span data-start="625.62" data-end="627.38">can throw them in a stupid grid.</span> </p>
<p><span data-start="627.38" data-end="628.38">We can do it.</span> <span data-start="628.38" data-end="632.1">It is a very interactive application and we can</span> <span data-start="632.1" data-end="634.45">easily get a good visualisation over this data.</span> <span data-start="634.45" data-end="639.11">It uses a tool in the right-hand corner, we have 168,000 objects</span> <span data-start="639.11" data-end="640.82">on this graph.</span> <span data-start="640.82" data-end="644.43">And that's 999,000 donations for some reason one</span> <span data-start="644.43" data-end="646.93">shy of 100,000 donations here.</span> <span data-start="646.93" data-end="651.3">So in total we have 168,000 nodes with 200,000 edges going between</span> <span data-start="651.3" data-end="653.08">them.</span> <span data-start="653.08" data-end="656.05">And this is the kind of commonality I see between</span> <span data-start="656.05" data-end="658.69">this and chronicle, the one I showed you a minute ago,</span> <span data-start="658.69" data-end="660.61">we're dealing with a scale of data that has not</span> <span data-start="660.61" data-end="662.92">traditionally been easy to interact with on the front</span> <span data-start="662.92" data-end="663.92">end.</span> <span data-start="663.92" data-end="666.32">The big difference is this is entirely front end</span> <span data-start="666.32" data-end="667.32">driven.</span> </p>
<p><span data-start="667.32" data-end="671.04">Once I loaded the file from a flat JSON file it</span> <span data-start="671.04" data-end="673.19">is entirely stored on the front end, there's no back</span> <span data-start="673.19" data-end="674.19">end.</span> <span data-start="674.19" data-end="676.29">This is entirely client side JavaScript project.</span> <span data-start="676.29" data-end="680.31">I'll jump back to the presentation.</span> <span data-start="680.31" data-end="687.589">There's the demos we don't need to use.</span> <span data-start="687.589" data-end="692.29">At the heart of these applications is a visual display of our data, in one case this was</span> <span data-start="692.29" data-end="694.61">a series of line charts and then in the other a set of</span> <span data-start="694.61" data-end="695.649">nodes and edges.</span> <span data-start="695.649" data-end="698.51">Both are rendered on to a 2D canvas.</span> <span data-start="698.51" data-end="700.66">Now for those of you familiar with canvas programming,</span> <span data-start="700.66" data-end="703.149">you'll know there's a tonn of drawbacks to using</span> <span data-start="703.149" data-end="708.14">canvas.</span> </p>
<p><span data-start="708.14" data-end="713.1">In HTML we can position elements using CSS, we</span> <span data-start="713.1" data-end="714.56">can use tables, alternatives, take advantage of all</span> <span data-start="714.56" data-end="716.55">the fancy reactive components we've built to easily</span> <span data-start="716.55" data-end="718.17">build together an application.</span> <span data-start="718.17" data-end="722.51">We can use mouse event listeners on individual elements to figure out what the</span> <span data-start="722.51" data-end="724.45">user is trying to do at a given point.</span> </p>
<p><span data-start="724.45" data-end="728.7">In canvas we get these pretty primitive APIs and</span> <span data-start="728.7" data-end="731.12">have to use pixel math to work out where we're trying to</span> <span data-start="731.12" data-end="734.84">render and when a user interacts with the scene we</span> <span data-start="734.84" data-end="737.93">simply get an event callback saying it was an X and Y</span> <span data-start="737.93" data-end="739.49">coordinate, and we have to work out what the user was</span> <span data-start="739.49" data-end="741.16">trying to do at this point in time.</span> </p>
<p><span data-start="741.16" data-end="747.44">It is hard to do anything incremental, as soon as</span> <span data-start="747.44" data-end="749.37">you paint a node on to it, it's there for good.</span> <span data-start="749.37" data-end="751.529">The only way to get rid of it is to paint something</span> <span data-start="751.529" data-end="755.519">on top or close the whole canvas down.</span> <span data-start="755.519" data-end="758.35">If I'm trying to render a graph that size and want to move a node</span> <span data-start="758.35" data-end="761.301">across the screen, I have to do a lot of work to make</span> <span data-start="761.301" data-end="763.32">that happen.</span> <span data-start="763.32" data-end="767.19">The question is, why did we use canvas for this?</span> </p>
<p><span data-start="767.19" data-end="769.89">Why didn't we use SVG, 3G?</span> <span data-start="769.89" data-end="775.26">I'm sure we've all seen this demo online, a lot of tune, or why didn't</span> <span data-start="775.26" data-end="777.86">we use ploddable for synchronised line charts?</span> <span data-start="777.86" data-end="781.04">This is the open source charting library we announced</span> <span data-start="781.04" data-end="783.459">here last year and are still actively developing.</span> <span data-start="783.459" data-end="787.42">They even have an example of synchronised chart on the website</span> <span data-start="787.42" data-end="789.959">as if it was trying to tempt me to talk about them.</span> </p>
<p><span data-start="789.959" data-end="793.959">It all comes back to performance at scale.</span> <span data-start="793.959" data-end="797.21">The DOM simply wasn't designed to have tens of thousands,</span> <span data-start="797.21" data-end="803.7">hundreds of thousands of nodes in it all animating either independently or in sync, it just doesn't</span> <span data-start="803.7" data-end="804.7">work.</span> </p>
<p><span data-start="804.7" data-end="808.39">So for earlier versions we did use this, we wanted to</span> <span data-start="808.39" data-end="812.64">use this, however when you start to move nodes individually independent from the rest of</span> <span data-start="812.64" data-end="815.162">the scene, things start to slow down.</span> <span data-start="815.162" data-end="820.019">They get pretty sluggish.</span> <span data-start="820.019" data-end="822.519">One of the drawbacks that I was discussing was</span> <span data-start="822.519" data-end="825.29">having to rerender everything every frame and we can</span> <span data-start="825.29" data-end="827.53">find a work around for this.</span> </p>
<p><span data-start="827.53" data-end="831.25">We can stack multiple canvases on top of each other, for example</span> <span data-start="831.25" data-end="833.959">in chronicle, we had a different canvas for each of the</span> <span data-start="833.959" data-end="839.26">different series, the line graphs, we had a canvas for</span> <span data-start="839.26" data-end="842.69">the axis and a canvas for the controls and the hover.</span> <span data-start="842.69" data-end="844.709">This meant that as a user was hovering over the chart</span> <span data-start="844.709" data-end="848.72">we only need to re-render one of canvases, not the entire</span> <span data-start="848.72" data-end="849.72">scene every time.</span> </p>
<p><span data-start="849.72" data-end="851.899">The graph was even more decomposed.</span> <span data-start="851.899" data-end="854.64">We have a different layer for the selected edges,</span> <span data-start="854.64" data-end="856.93">nodes selecting nodes, this drag rectangle box and</span> <span data-start="856.93" data-end="858.769">so on.</span> <span data-start="858.769" data-end="861.37">This meant that if a user clicks on a node or if they do</span> <span data-start="861.37" data-end="863.839">a simple operation, we only needed to re-render one or</span> <span data-start="863.839" data-end="867.15">two, not the entire scene.</span> </p>
<p><span data-start="867.15" data-end="869.68">This trick extends to DOM elements too.</span> <span data-start="869.68" data-end="873.68">We can use absolute positioning to position DOM elements on top of the canvas.</span> <span data-start="873.68" data-end="876.779">This was how the loop tool I showed you earlier worked.</span> <span data-start="876.779" data-end="880.889">We positioned it to the left of the cursor, and</span> <span data-start="880.889" data-end="883.94">then we were able to program in however we wanted</span> <span data-start="883.94" data-end="887.36">the content, so we had this object previews with a table</span> <span data-start="887.36" data-end="888.36">of donations.</span> </p>
<p><span data-start="888.36" data-end="891.14">We can use normal HTML CSS for that.</span> <span data-start="891.14" data-end="893.11">This makes things flexible.</span> <span data-start="893.11" data-end="898.23">We can easily add extra hints and information about our scene.</span> <span data-start="898.23" data-end="901.61">In an earlier version of the graph we used that for every node.</span> <span data-start="901.61" data-end="903.75">Every node was a DOM element, positioned absolutely on</span> <span data-start="903.75" data-end="907.65">the scene, then we used CSS translations to move the</span> <span data-start="907.65" data-end="910.889">scene around as the user interacted and dragged around.</span> <span data-start="910.889" data-end="913.87">This worked out well, we had a single canvas for edges</span> <span data-start="913.87" data-end="915.67">and all of our nodes were easy to programme.</span> <span data-start="915.67" data-end="918.72">It was all very clean code.</span> <span data-start="918.72" data-end="921.13">The downside was that as we started to move nodes</span> <span data-start="921.13" data-end="923.22">independently as we started to push the node scale up to</span> <span data-start="923.22" data-end="926.329">tens of thousands, things slowed down.</span> </p>
<p><span data-start="926.329" data-end="929.089">It isn't designed for this behaviour.</span> <span data-start="929.089" data-end="933.12">This technique of layering canvas and DOM is really powerful.</span> <span data-start="933.12" data-end="937.26">Really flexible, but don't expect it to scale with the data.</span> <span data-start="937.26" data-end="939.67">The biggest problem we faced when we tried to scale</span> <span data-start="939.67" data-end="942.389">our graph out to hundreds of thousands of nodes was</span> <span data-start="942.389" data-end="946.07">simply the time it took to render a single frame.</span> <span data-start="946.07" data-end="948.66">Using tools like the Firefox performance tools and</span> <span data-start="948.66" data-end="951.51">the Chrome timeline we were able to get a good understanding</span> <span data-start="951.51" data-end="954.17">of what is happening each frame.</span> <span data-start="954.17" data-end="956.149">And I'm not actually going to go into them too much here, there's</span> <span data-start="956.149" data-end="958.779">a load of great resources online about to how to use</span> <span data-start="958.779" data-end="959.779">them.</span> <span data-start="959.779" data-end="962.18">There is also a lot about how to do specific canvas</span> <span data-start="962.18" data-end="964.01">profiling and optimisations.</span> </p>
<p><span data-start="964.01" data-end="966.949">However, do take them with a pinch of salt.</span> <span data-start="966.949" data-end="972.44">You'll often find advice like this: avoid shadow blur, which is great, it has a good</span> <span data-start="972.44" data-end="973.44">intent behind.</span> <span data-start="973.44" data-end="974.67">It can be expensive.</span> <span data-start="974.67" data-end="976.72">Rendering drop shadows turns out to be one of the more expensive</span> <span data-start="976.72" data-end="978.29">operations you can do on a canvas.</span> <span data-start="978.29" data-end="983.31">However, if you want to drop shadow on something it is bad advice, it doesn't</span> <span data-start="983.31" data-end="985.86">tell me what to do instead.</span> <span data-start="985.86" data-end="990.79">We wanted to drop shadow on to the nodes because it looks cool, so how do we do that?</span> <span data-start="990.79" data-end="993.12">How do we go about doing this?</span> </p>
<p><span data-start="993.12" data-end="996.52">We came up with the jsperf test to see if we can compare the standard rendering</span> <span data-start="996.52" data-end="998.68">of drop shadows to some other technique of getting</span> <span data-start="998.68" data-end="1001.72">the same effect.</span> <span data-start="1001.72" data-end="1003.149">This is what we're trying to render.</span> <span data-start="1003.149" data-end="1004.36">There's a subtle drop shadow.</span> <span data-start="1004.36" data-end="1011.57">You can just about see it.</span> <span data-start="1011.57" data-end="1014.07">We write our test, start with the width and height</span> <span data-start="1014.07" data-end="1015.899">of the node and the number to render.</span> <span data-start="1015.899" data-end="1019.841">We used to render a bunch because of the drawback of drop shadow</span> <span data-start="1019.841" data-end="1024.569">is when you render them on top of them the anti-aliasing</span> <span data-start="1024.569" data-end="1027.439">is what causes the slowdown to happen.</span> <span data-start="1027.439" data-end="1030.699">Then we have this render function, it takes a canvas context and renders</span> <span data-start="1030.699" data-end="1033.639">a node to it takes an X and Y position.</span> <span data-start="1033.639" data-end="1038.88">First of all make radius, set the style using this red, and</span> <span data-start="1038.88" data-end="1042.579">have a shadow blur of depth one.</span> </p>
<p><span data-start="1042.579" data-end="1045.639">For reference, this is what we're trying to render.</span> <span data-start="1045.639" data-end="1050.619">So we're making an arc and fill that with firebrick red and then stroke this to</span> <span data-start="1050.619" data-end="1054.09">get the white ring round, and add an orange stroke, this</span> <span data-start="1054.09" data-end="1056.529">represents the selection, as you select them they get</span> <span data-start="1056.529" data-end="1059.039">this orange halo.</span> </p>
<p><span data-start="1059.039" data-end="1061.519">What we're going to do is rendering directly to</span> <span data-start="1061.519" data-end="1064.739">the canvas, a thousand of these nodes versus first</span> <span data-start="1064.739" data-end="1066.909">rendering to an image essentially rasterising the node</span> <span data-start="1066.909" data-end="1070.669">down to an image and using that everywhere.</span> <span data-start="1070.669" data-end="1073.039">This looks like this, make a canvas, make it slightly</span> <span data-start="1073.039" data-end="1077.269">bigger to allow for the drop shadow, and we never attach</span> <span data-start="1077.269" data-end="1079.98">this to the DOM, it is purely held in memory, then</span> <span data-start="1079.98" data-end="1082.71">we call render note passing in with the canvas with</span> <span data-start="1082.71" data-end="1084.95">the H width and height in the middle.</span> </p>
<p><span data-start="1084.95" data-end="1088.44">Our two test cases look like this: we have a canvas</span> <span data-start="1088.44" data-end="1090.2">and pull out the context.</span> <span data-start="1090.2" data-end="1095.429">We clear it, JS perf uses the same HTML for the tests and it runs another</span> <span data-start="1095.429" data-end="1099.919">one to get a good aggregate of the number of time spent,</span> <span data-start="1099.919" data-end="1102.869">then we iterate through the thousand nodes calling</span> <span data-start="1102.869" data-end="1104.19">render note on to the canvas.</span> <span data-start="1104.19" data-end="1106.749">Our second test case looks almost identical.</span> <span data-start="1106.749" data-end="1111.193">The only line that changes is this, instead of calling it the node, we call it the draw</span> <span data-start="1111.193" data-end="1113.049">image.</span> <span data-start="1113.049" data-end="1115.389">And this is what it looks like.</span> <span data-start="1115.389" data-end="1118.389">You'd be hard pressed to tell the difference between the two if I didn't</span> <span data-start="1118.389" data-end="1121.149">say which was which, you'd probably have a guess,</span> <span data-start="1121.149" data-end="1122.33">but maybe not.</span> </p>
<p><span data-start="1122.33" data-end="1125.09">However, the time it takes to render each is</span> <span data-start="1125.09" data-end="1126.34">hugely different.</span> <span data-start="1126.34" data-end="1131.461">15.1 milliseconds, for reference if you want a 60FPS frame rate you need to be</span> <span data-start="1131.461" data-end="1135.049">rendering every frame in under 16.6, so at a thousand</span> <span data-start="1135.049" data-end="1137.69">nodes we can just about do the old technique, with this</span> <span data-start="1137.69" data-end="1139.58">we can scale it up more.</span> <span data-start="1139.58" data-end="1146.379">The drawback of this approach is that we need a raster image for every node size, not quite</span> <span data-start="1146.379" data-end="1149.629">every one, but we can choose a few sizes we care about</span> <span data-start="1149.629" data-end="1151.33">and then always scale them down.</span> <span data-start="1151.33" data-end="1155.429">It doesn't look too bad, and this way the memory impact isn't too high</span> <span data-start="1155.429" data-end="1157.32">and we can compute this as a one-off at the start when</span> <span data-start="1157.32" data-end="1160.96">we initialise our scene.</span> <span data-start="1160.96" data-end="1164.729">So the take away from this is not to avoid shadow blur.</span> <span data-start="1164.729" data-end="1168.37">If you just add it to one or two objects, the cost might not be too high.</span> <span data-start="1168.37" data-end="1170.321">What you should do is profile every change you're planning</span> <span data-start="1170.321" data-end="1172.259">on making, if you plan on making shadow blur,</span> <span data-start="1172.259" data-end="1173.259">profile it.</span> </p>
<p><span data-start="1173.259" data-end="1174.539">Does it make a meaningful impact?</span> <span data-start="1174.539" data-end="1179.289">If so, are there ways to find round this?</span> <span data-start="1179.289" data-end="1181.139">Another technique to push the scale a little bit</span> <span data-start="1181.139" data-end="1184.419">more was reducing the amount of detail rendered as the</span> <span data-start="1184.419" data-end="1186.399">scene  —  as we zoomed out.</span> <span data-start="1186.399" data-end="1192.259">In this example, we render the  —  we lower the opacity on our node labels</span> <span data-start="1192.259" data-end="1195.7">as we zoom out, once you get beyond a certain zoom</span> <span data-start="1195.7" data-end="1198.899">level the labels aren't useful, you can't read them.</span> <span data-start="1198.899" data-end="1200.95">So there is no reason to go to all the trouble of rendering</span> <span data-start="1200.95" data-end="1202.029">the text, which is expensive.</span> </p>
<p><span data-start="1202.029" data-end="1205.58">We do a similar thing with the icons too.</span> <span data-start="1205.58" data-end="1210.45">After a certain point, is all that matters is having a purple circle that's the</span> <span data-start="1210.45" data-end="1211.45">right size.</span> <span data-start="1211.45" data-end="1213.529">This allows you to pick up  —  oh look, there's a lot of</span> <span data-start="1213.529" data-end="1215.909">interesting things going on without having to think too</span> <span data-start="1215.909" data-end="1217.889">much about each individual data point.</span> <span data-start="1217.889" data-end="1220.57">This gives us the aggregation of the data.</span> <span data-start="1220.57" data-end="1223.379">Again, we profile each of these changes, does it</span> <span data-start="1223.379" data-end="1225.94">actually make a meaningful difference to the performance?</span> <span data-start="1225.94" data-end="1228.609">In this case it actually did.</span> </p>
<p><span data-start="1228.609" data-end="1231.08">Another trick was, as we moved even further out once</span> <span data-start="1231.08" data-end="1233.399">each node was taking up less than a pixel, we render</span> <span data-start="1233.399" data-end="1236.58">them as rectangles because they're quicker and better</span> <span data-start="1236.58" data-end="1237.96">than circles.</span> </p>
<p><span data-start="1237.96" data-end="1242.909">We figured if the user can't tell it's a circle, why bother spending all of our GPU</span> <span data-start="1242.909" data-end="1245.239">time making these circles?</span> <span data-start="1245.239" data-end="1250.6">The final thing is debounce.</span> <span data-start="1250.6" data-end="1253.44">This is a function that lets you split your rendering pipeline</span> <span data-start="1253.44" data-end="1254.44">into two.</span> <span data-start="1254.44" data-end="1258.029">The problem we faced as we kind of tried to scale up our</span> <span data-start="1258.029" data-end="1261.539">node scale even higher and higher, was that every time,</span> <span data-start="1261.539" data-end="1264.409">every frame, we were iterating through hundreds of</span> <span data-start="1264.409" data-end="1268.479">thousands of edges and nodes and spending the time to</span> <span data-start="1268.479" data-end="1273.85">iterate through each was pretty expensive, basically it</span> <span data-start="1273.85" data-end="1275.96">meant that our application didn't feel responsive, as</span> <span data-start="1275.96" data-end="1279.08">a user was dragging and planning across the scene, we</span> <span data-start="1279.08" data-end="1282.44">had to iterate through all these nodes and edges and do</span> <span data-start="1282.44" data-end="1285.71">some basic rendering, but this still took up a lot of</span> <span data-start="1285.71" data-end="1289.929">time, we ended up with the frame rate way too high  — </span> <span data-start="1289.929" data-end="1294.869">sorry, way too low, and this was just  —  it didn't feel</span> <span data-start="1294.869" data-end="1296.289">responsive.</span> </p>
<p><span data-start="1296.289" data-end="1297.49">We used debounce.</span> <span data-start="1297.49" data-end="1300.32">We debounced the interactions and only call render when the</span> <span data-start="1300.32" data-end="1302.409">user stops interacting.</span> <span data-start="1302.409" data-end="1306.349">That sounds insane.</span> <span data-start="1306.349" data-end="1310.33">We pushed back the expensive render on this debounce, and we</span> <span data-start="1310.33" data-end="1313.159">need to find a way of updating our scene without incurring</span> <span data-start="1313.159" data-end="1316.039">the expensive cost of a render.</span> <span data-start="1316.039" data-end="1317.57">How?</span> </p>
<p><span data-start="1317.57" data-end="1321.169">We can take advantage of the fact that we've just rendered the scene, and the scene we</span> <span data-start="1321.169" data-end="1324.139">rendered looks almost identical to the new scene, apart from</span> <span data-start="1324.139" data-end="1325.139">a few pixels.</span> <span data-start="1325.139" data-end="1330.889">So every time we rendered the scene we take a snapshot and save it to a an offscreen canvas.</span> </p>
<p><span data-start="1330.889" data-end="1335.769">It holds the entire screen.</span> <span data-start="1335.769" data-end="1340.44">It's not too bad, the bigger it was, the more expensive, but for our purposes</span> <span data-start="1340.44" data-end="1341.58">it works.</span> <span data-start="1341.58" data-end="1345.22">Ah, the user zooms out, we take the image, render it</span> <span data-start="1345.22" data-end="1347.33">on to the screen to render it down.</span> <span data-start="1347.33" data-end="1350.639">You get white boxes round the edge where we don't know the stated</span> <span data-start="1350.639" data-end="1353.84">of the world.</span> <span data-start="1353.84" data-end="1355.99">It doesn't really matter.</span> <span data-start="1355.99" data-end="1359.64">As you saw earlier, you'll get the white boxes, but you don't</span> <span data-start="1359.64" data-end="1362.23">really notice if you're going pretty slowly, and you're</span> <span data-start="1362.23" data-end="1365.129">going fast, as soon as you stop, the full render kicks in,</span> <span data-start="1365.129" data-end="1367.36">you see the whole state again.</span> </p>
<p><span data-start="1367.36" data-end="1370.389">As you zoom in, things get a bit blurry.</span> <span data-start="1370.389" data-end="1372.679">Again, it doesn't really detract.</span> <span data-start="1372.679" data-end="1374.169">You know where you're tying to zoom in to, you can</span> <span data-start="1374.169" data-end="1377.629">see where you're going to, it doesn't matter, and as</span> <span data-start="1377.629" data-end="1380.48">soon as you stop interacting, the full state of the graph</span> <span data-start="1380.48" data-end="1381.94">is available.</span> <span data-start="1381.94" data-end="1383.549">We do the same for planning as well.</span> <span data-start="1383.549" data-end="1386.33">We simply translate the gym.</span> <span data-start="1386.33" data-end="1387.599">This is even more noticeable.</span> <span data-start="1387.599" data-end="1391.58">Generally you pan quite fast, but it doesn't really stop</span> <span data-start="1391.58" data-end="1393.99">the interaction, you're still able to figure out what</span> <span data-start="1393.99" data-end="1396.159">you're doing with the scene.</span> </p>
<p><span data-start="1396.159" data-end="1399.399">And it is not long before the full render kicks in, so you're able to</span> <span data-start="1399.399" data-end="1401.6">see the full scene again.</span> <span data-start="1401.6" data-end="1403.639">This allowed us to push that node scale all the way</span> <span data-start="1403.639" data-end="1406.899">up, so that each frame render was no longer dependent on</span> <span data-start="1406.899" data-end="1409.65">the number of nodes and edges we were trying to render.</span> <span data-start="1409.65" data-end="1412.96">Our limitation was now the amount of stuff to store in</span> <span data-start="1412.96" data-end="1414.22">the JavaScript memory.</span> <span data-start="1414.22" data-end="1418.499">We actually do a similar trick in chronicle.</span> <span data-start="1418.499" data-end="1420.97">If you remember, as we panned left and right occasionally</span> <span data-start="1420.97" data-end="1422.97">things would get blocky, as we zoomed in, or as we</span> <span data-start="1422.97" data-end="1426.71">panned the B section was missing, and the reason is we</span> <span data-start="1426.71" data-end="1429.269">have to request data from our back end every time we</span> <span data-start="1429.269" data-end="1432.82">want to view data because we're talking about millions</span> <span data-start="1432.82" data-end="1435.65">maybe billions of data points, we need to use a back end</span> <span data-start="1435.65" data-end="1436.65">to aggregate this data for us.</span> </p>
<p><span data-start="1436.65" data-end="1439.499">We simply can't do it on the front end.</span> <span data-start="1439.499" data-end="1441.999">So instead of debouncing the render call, we</span> <span data-start="1441.999" data-end="1444.519">debounce our request data call.</span> <span data-start="1444.519" data-end="1445.95">The render is cheap enough, actually.</span> <span data-start="1445.95" data-end="1449.83">This is not too much data by the time it makes the front end, but the request data</span> <span data-start="1449.83" data-end="1452.239">call puts a tonne of work on to the server.</span> <span data-start="1452.239" data-end="1454.89">It has to load the stuff into the memory and do aggregations.</span> <span data-start="1454.89" data-end="1457.42">It is fast but it's not the thing where you want to be</span> <span data-start="1457.42" data-end="1459.59">thrashing the server making it do a load of work where</span> <span data-start="1459.59" data-end="1464.389">no one will see this, so we debounce this.</span> <span data-start="1464.389" data-end="1467.7">In the meantime, we have the data from the previous scene on the front</span> <span data-start="1467.7" data-end="1470.73">end, so we don't do the canvas tricks instead, we do</span> <span data-start="1470.73" data-end="1472.989">it with the raw data, we re-render the data we already</span> <span data-start="1472.989" data-end="1475.879">have for the subset of the scene we're going to know about,</span> <span data-start="1475.879" data-end="1477.97">so as you zoomed we can render the same data, just small</span> <span data-start="1477.97" data-end="1479.11">smaller and in the middle.</span> </p>
<p><span data-start="1479.11" data-end="1484.34">You as zoom in, we can render the data and that's why it gets blocky.</span> <span data-start="1484.34" data-end="1488.269">As I pan to the left, there's some data missing and the same</span> <span data-start="1488.269" data-end="1489.269">with the right.</span> <span data-start="1489.269" data-end="1490.88">It interacts the same with the graph and as we</span> <span data-start="1490.88" data-end="1492.499">zoom in, it gets blocky.</span> <span data-start="1492.499" data-end="1493.679">It doesn't detract.</span> <span data-start="1493.679" data-end="1497.32">You still have the same information as you had before,</span> <span data-start="1497.32" data-end="1498.749">but the back end is snappy.</span> <span data-start="1498.749" data-end="1504.549">So in no time the real data kicks in and you can continue the analysis.</span> <span data-start="1504.549" data-end="1506.309">This is very similar to how Google Maps works with</span> <span data-start="1506.309" data-end="1510.429">vector tiles.</span> <span data-start="1510.429" data-end="1513.019">To quickly sum up, we talked about what makes a good</span> <span data-start="1513.019" data-end="1516.472">user experience and this is the idea of making a good</span> <span data-start="1516.472" data-end="1520.499">intuitive and responsive user experience.</span> </p>
<p><span data-start="1520.499" data-end="1523.059">We talked a bit about decomposing the scene using layering</span> <span data-start="1523.059" data-end="1527.809">canvases or DOM on top, and to cover those of those</span> <span data-start="1527.809" data-end="1531.799">limitations, although there is still a lot to get over,</span> <span data-start="1531.799" data-end="1536.529">we can profile to figure out where time is being spent,</span> <span data-start="1536.529" data-end="1538.83">and we covered a few of the more commonplace and more</span> <span data-start="1538.83" data-end="1542.5">basic performance techniques, such as reusing objects</span> <span data-start="1542.5" data-end="1545.399">wherever you can, reusing the canvas, and pre-empting</span> <span data-start="1545.399" data-end="1546.399">the next state.</span> <span data-start="1546.399" data-end="1548.269">That's all I have.</span> <span data-start="1548.269" data-end="1551.129">So thanks a lot for listening and please come through with any questions,</span> <span data-start="1551.129" data-end="1552.129">please find me afterwards.</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
