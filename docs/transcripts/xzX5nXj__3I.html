<section>
<p><span data-start="17.24" data-end="19.49">my name is Tommy scratch I work for a</span> <span data-start="19.49" data-end="21.02">company called joint which you may be</span> <span data-start="21.02" data-end="24.71">heard of we do stuff with node which</span> <span data-start="24.71" data-end="28.97">you've also may be heard of and yeah i'm</span> <span data-start="28.97" data-end="30.65">writing this book i don't recommend</span> <span data-start="30.65" data-end="33.949">writing a book it's a stupid idea if</span> <span data-start="33.949" data-end="35.21">anybody ever tells you to write a book</span> <span data-start="35.21" data-end="37.4">you know just ignore them or hurt them</span> <span data-start="37.4" data-end="40.64">or both but this is this is the book i'm</span> <span data-start="40.64" data-end="42.23">writing in case wondering that's a</span> <span data-start="42.23" data-end="45.17">common tree true cuz alrighty clearly</span> <span data-start="45.17" data-end="50.479">let me pick my animal you know so I the</span> <span data-start="50.479" data-end="52.61">talk is multi Ted node architectures but</span> <span data-start="52.61" data-end="54.68">you know I wanted to kind of recap some</span> <span data-start="54.68" data-end="57.5">stuff I think the the people at Jay's</span> <span data-start="57.5" data-end="58.879">convoy always really smart but I think</span> <span data-start="58.879" data-end="60.53">often kind of looking at the core</span> <span data-start="60.53" data-end="61.61">principles of what we're trying to</span> <span data-start="61.61" data-end="65.449">achieve really helps so you know one of</span> <span data-start="65.449" data-end="66.47">the things that we want to do when we</span> <span data-start="66.47" data-end="68.78">write servers is minimize the client</span> <span data-start="68.78" data-end="69.89">response time and this is actually like</span> <span data-start="69.89" data-end="71.99">a big draw of why people use node right</span> <span data-start="71.99" data-end="73.67">is we want really fast service because</span> <span data-start="73.67" data-end="76.43">you know sometimes people just can't</span> <span data-start="76.43" data-end="79.61">wait to do stuff and you know that that</span> <span data-start="79.61" data-end="81.5">can be an issue in case we running I</span> <span data-start="81.5" data-end="84.109">also used to work for Yahoo so that's</span> <span data-start="84.109" data-end="91.85">the Yahoo that's a yahoo bathroom so the</span> <span data-start="91.85" data-end="93.77">goal number two is well sure we won't</span> <span data-start="93.77" data-end="96.049">really fast response times but you know</span> <span data-start="96.049" data-end="97.85">heck I only have so many servers you</span> <span data-start="97.85" data-end="100.46">know I mean I guess we could buy like a</span> <span data-start="100.46" data-end="102.079">server for every user that we have and</span> <span data-start="102.079" data-end="103.729">then all of their response times would</span> <span data-start="103.729" data-end="106.189">be really fast but nobody can obviously</span> <span data-start="106.189" data-end="107.24">nobody can afford to do that that's</span> <span data-start="107.24" data-end="109.64">stupid so it's you know we have we have</span> <span data-start="109.64" data-end="111.319">these two conflicting goals it's like</span> <span data-start="111.319" data-end="113.649">how do we how do we balance these things</span> <span data-start="113.649" data-end="116.719">because obviously you know at some point</span> <span data-start="116.719" data-end="118.729">we hit the capacity of our servers and</span> <span data-start="118.729" data-end="120.139">sometimes you know even if you're</span> <span data-start="120.139" data-end="122.45">planning capacity there's there's there</span> <span data-start="122.45" data-end="124.67">are issues there so I like to think of</span> <span data-start="124.67" data-end="127.34">this in in kind of the critical path</span> <span data-start="127.34" data-end="128.72">like one of the things I think people</span> <span data-start="128.72" data-end="130.55">people think of like these really</span> <span data-start="130.55" data-end="132.56">generalize models are computing and what</span> <span data-start="132.56" data-end="135.2">it comes down to for me is we have a</span> <span data-start="135.2" data-end="137.36">critical path this is what an Internet</span> <span data-start="137.36" data-end="139.1">application looks like a modern Internet</span> <span data-start="139.1" data-end="142.16">application looks like this you have</span> <span data-start="142.16" data-end="144.26">this big red blob of like network</span> <span data-start="144.26" data-end="146.09">latency at the front and this is</span> <span data-start="146.09" data-end="147.62">obviously this is really simplified but</span> <span data-start="147.62" data-end="149.78">you know the the talking back and</span> <span data-start="149.78" data-end="151.28">with a web client of the internet is</span> <span data-start="151.28" data-end="153.26">really slow compared to the actual</span> <span data-start="153.26" data-end="155.03">amount of computation it takes to render</span> <span data-start="155.03" data-end="158.12">a web page talking to the database it's</span> <span data-start="158.12" data-end="160.459">really slow compared to the actual time</span> <span data-start="160.459" data-end="161.93">it takes to do a query in general not</span> <span data-start="161.93" data-end="164.75">all queries but in general this is this</span> <span data-start="164.75" data-end="166.55">is generally true if you mean think</span> <span data-start="166.55" data-end="168.95">about Google if every time you typed in</span> <span data-start="168.95" data-end="170.81">a search query Google went out and</span> <span data-start="170.81" data-end="173.5">spidered the entire internet compiled</span> <span data-start="173.5" data-end="176.48">you know a search index and then gave</span> <span data-start="176.48" data-end="177.47">you back your result would be like a</span> <span data-start="177.47" data-end="180.05">month the point is that we take all the</span> <span data-start="180.05" data-end="182.66">computation as far away from the user as</span> <span data-start="182.66" data-end="184.55">possible so when the user is actually</span> <span data-start="184.55" data-end="186.17">interacting with the website the web</span> <span data-start="186.17" data-end="188.33">application whatever system it is that</span> <span data-start="188.33" data-end="192.23">we're doing the the maximum the biggest</span> <span data-start="192.23" data-end="194.39">pieces of this time is some kind of</span> <span data-start="194.39" data-end="196.88">rooting some kind of network transfer</span> <span data-start="196.88" data-end="199">and the actual amount of computation is</span> <span data-start="199" data-end="201.86">as small as possible and these are the</span> <span data-start="201.86" data-end="205.069">models of applications we build now so</span> <span data-start="205.069" data-end="206.51">the traditional way that we do this is</span> <span data-start="206.51" data-end="208.91">we pre allocate resources to the client</span> <span data-start="208.91" data-end="210.35">for the for the entire duration of the</span> <span data-start="210.35" data-end="212.18">request we go here you go here's a bunch</span> <span data-start="212.18" data-end="214.459">of resources and that gives you</span> <span data-start="214.459" data-end="216.23">efficiency within each individual</span> <span data-start="216.23" data-end="218.269">connection you give a bunch of resources</span> <span data-start="218.269" data-end="221.87">away and you get you know you get a lot</span> <span data-start="221.87" data-end="224.09">of efficiency it's like his here's a big</span> <span data-start="224.09" data-end="226.91">size of resources and that means that</span> <span data-start="226.91" data-end="228.709">the response time for this individual</span> <span data-start="228.709" data-end="230.51">connection is going to be really fast</span> <span data-start="230.51" data-end="231.98">because they've already given them all</span> <span data-start="231.98" data-end="234.32">the resources that they need to do this</span> <span data-start="234.32" data-end="236.03">so as soon as anything happens I'm</span> <span data-start="236.03" data-end="238.4">instantly ready to go so they kind of</span> <span data-start="238.4" data-end="240.44">makes sense you know I think of it like</span> <span data-start="240.44" data-end="243.23">this you know if the the you know if the</span> <span data-start="243.23" data-end="245.75">pie is my server I have like a certain</span> <span data-start="245.75" data-end="247.459">amount of resources it's just dedicated</span> <span data-start="247.459" data-end="249.62">to running you know whether it's node or</span> </p>
<p><span data-start="249.62" data-end="252.799">Apache or you know tom cat or whatever</span> <span data-start="252.799" data-end="254.6">and then every request you start to</span> <span data-start="254.6" data-end="256.7">share out the pie and you give each one</span> <span data-start="256.7" data-end="260.57">of these two requests and you know</span> <span data-start="260.57" data-end="262.94">that's great but we basically heavily</span> <span data-start="262.94" data-end="265.01">waste memory in order to serve the</span> <span data-start="265.01" data-end="268.34">fastest most optimal requests and when</span> <span data-start="268.34" data-end="270.46">you run out of you know memory the</span> <span data-start="270.46" data-end="272.66">Soviets overwhelmed and that's you know</span> <span data-start="272.66" data-end="274.49">that's kind of bad it's like fighting</span> <span data-start="274.49" data-end="276.71">off lobsters with a stick I guess to</span> <span data-start="276.71" data-end="278.89">stretch your metaphor I don't know um</span> <span data-start="278.89" data-end="281.21">actually I tried this talk somewhere</span> <span data-start="281.21" data-end="282.919">else and somebody had called me and said</span> <span data-start="282.919" data-end="283.61">those aren't lobs</span> <span data-start="283.61" data-end="288.289">those are crabs you know it's kind of</span> <span data-start="288.289" data-end="289.46">weird I mean to be honest I don't know</span> <span data-start="289.46" data-end="290.689">this gentleman well enough to know if</span> <span data-start="290.689" data-end="294.259">those are crabs or not that was awful</span> <span data-start="294.259" data-end="297.59">wasn't it but seriously I mean I think</span> <span data-start="297.59" data-end="299.509">the it's it's it's it's a model that</span> <span data-start="299.509" data-end="301.189">kind of it makes sense in principle but</span> <span data-start="301.189" data-end="302.629">we have these real-world constraints we</span> <span data-start="302.629" data-end="304.31">can't have as many services we want and</span> <span data-start="304.31" data-end="306.129">this is where the event loop comes in so</span> <span data-start="306.129" data-end="309.56">if you don't pre allocate memory what</span> <span data-start="309.56" data-end="312.05">happens we create a placeholder for so</span> <span data-start="312.05" data-end="313.61">test so this is kind of I mean this is</span> <span data-start="313.61" data-end="315.62">still kind of node 101 stuff but we have</span> <span data-start="315.62" data-end="317.479">all these placeholders and then we have</span> <span data-start="317.479" data-end="319.009">this shade work resource like now I have</span> <span data-start="319.009" data-end="321.259">some work to do I'm going to do it the</span> <span data-start="321.259" data-end="322.699">servers going to use memory in order to</span> <span data-start="322.699" data-end="324.949">deal with this one specific task we have</span> <span data-start="324.949" data-end="327.469">the first-in first-out model so we have</span> <span data-start="327.469" data-end="329.599">a bunch of events you can see that for</span> <span data-start="329.599" data-end="331.879">each individual event whether it's like</span> <span data-start="331.879" data-end="334.61">an event created by the node application</span> <span data-start="334.61" data-end="337.37">or from the OS it goes in and it comes</span> <span data-start="337.37" data-end="340.039">up but you know that makes the server</span> <span data-start="340.039" data-end="341.479">more efficient but it then creates this</span> <span data-start="341.479" data-end="343.36">thing well we can't block the event loop</span> <span data-start="343.36" data-end="346.189">so people start to you no wonder well</span> <span data-start="346.189" data-end="348.77">i'm using this model how do i actually</span> <span data-start="348.77" data-end="350.81">make the most of my service what are the</span> <span data-start="350.81" data-end="354.319">architectures that really helped me so</span> <span data-start="354.319" data-end="357.889">if i do big work in the event loop then</span> <span data-start="357.889" data-end="360.68">we can only serve after that after that</span> <span data-start="360.68" data-end="363.11">request is finished so you know this is</span> <span data-start="363.11" data-end="364.19">kind of this is like a different</span> <span data-start="364.19" data-end="365.659">programming model people like what I get</span> <span data-start="365.659" data-end="367.61">the other thing you know I just have</span> <span data-start="367.61" data-end="370.19">like one thread per user and I don't</span> <span data-start="370.19" data-end="371.509">have to think about it but now I'm in</span> <span data-start="371.509" data-end="374.21">the shared memory you know I'm sharing</span> <span data-start="374.21" data-end="375.83">all of this stuff how do i how do I do</span> <span data-start="375.83" data-end="377.21">that I have to worry about these big</span> <span data-start="377.21" data-end="379.789">tasks so blocking the event loop is just</span> <span data-start="379.789" data-end="383.02">bad nobody wants to do that you know um</span> <span data-start="383.02" data-end="384.86">don't worry we're going to run out of</span> </p>
<p><span data-start="384.86" data-end="387.979">I'm never that bad metaphor soon but</span> <span data-start="387.979" data-end="389.509">nobody wants to block the event loop so</span> <span data-start="389.509" data-end="390.56">it's like how do I do that how do i</span> <span data-start="390.56" data-end="392.24">create an architecture with node that</span> <span data-start="392.24" data-end="394.189">makes it work efficiently so this is the</span> <span data-start="394.189" data-end="396.05">obvious architecture and everybody uses</span> <span data-start="396.05" data-end="398.479">this in you know it's not rocket science</span> <span data-start="398.479" data-end="400.909">but it is a tiered architecture I have</span> <span data-start="400.909" data-end="403.43">my client and then I have some kind of</span> <span data-start="403.43" data-end="404.93">like node front end and then I have</span> <span data-start="404.93" data-end="407.12">database and this is I mean this is like</span> <span data-start="407.12" data-end="409.43">a really simple architecture but it's</span> <span data-start="409.43" data-end="411.74">it's clearly multi-tiered the database</span> <span data-start="411.74" data-end="414.139">is doing stuff that isn't in the main</span> <span data-start="414.139" data-end="415.969">node process we're not blocking we're</span> <span data-start="415.969" data-end="416.99">using eight</span> </p>
<p><span data-start="416.99" data-end="419.84">Kronus I oh and this this already is a</span> <span data-start="419.84" data-end="421.88">multi-tiered architecture you're pushing</span> <span data-start="421.88" data-end="424.07">the database work out so it's not</span> <span data-start="424.07" data-end="426.2">blocking the rest of the node process</span> <span data-start="426.2" data-end="428.15">right i mean we could just you know we</span> <span data-start="428.15" data-end="430.67">could have all of that together what</span> <span data-start="430.67" data-end="431.84">about something like this this is</span> <span data-start="431.84" data-end="433.13">something that I think a lot of people</span> <span data-start="433.13" data-end="435.47">were starting to play with will you know</span> <span data-start="435.47" data-end="439.55">if big things are no too bad how about I</span> <span data-start="439.55" data-end="441.11">do something like this so I want to do</span> <span data-start="441.11" data-end="443.42">clients maybe I want to use Jess domin</span> <span data-start="443.42" data-end="445.13">order to render all of my results people</span> <span data-start="445.13" data-end="447.5">people really like the idea of doing</span> <span data-start="447.5" data-end="449.87">stuff with jess Tom and that's cool I</span> <span data-start="449.87" data-end="452.18">think that's really interesting but it's</span> <span data-start="452.18" data-end="454.01">like well what if you know if if all of</span> <span data-start="454.01" data-end="456.38">the j estan stuff is really big I should</span> <span data-start="456.38" data-end="458.03">move that like a separate thing outside</span> <span data-start="458.03" data-end="460.88">of my main node process right and then</span> <span data-start="460.88" data-end="461.99">you end up with an architecture like</span> <span data-start="461.99" data-end="465.41">this well why would you do that one of</span> <span data-start="465.41" data-end="466.7">the things people want more paralyzation</span> <span data-start="466.7" data-end="468.82">like I'm spreading out my load I'm</span> <span data-start="468.82" data-end="471.71">creating more task synchronization but</span> <span data-start="471.71" data-end="474.47">if we look back at this diagram when</span> <span data-start="474.47" data-end="476">you're using something like Jess DOM and</span> <span data-start="476" data-end="478.4">you're just increasing the size of these</span> <span data-start="478.4" data-end="480.38">computational units you're just</span> <span data-start="480.38" data-end="482.81">increasing the size the critical path is</span> <span data-start="482.81" data-end="485.24">still the same the path between the user</span> <span data-start="485.24" data-end="487.49">asking for a request and getting on back</span> <span data-start="487.49" data-end="489.59">is the same you've just added more</span> <span data-start="489.59" data-end="492.44">computation so maybe the actual balance</span> <span data-start="492.44" data-end="495.41">on the critical path is different maybe</span> <span data-start="495.41" data-end="498.65">now computation is thirty percent of the</span> <span data-start="498.65" data-end="501.02">critical path instead of 10 because</span> <span data-start="501.02" data-end="502.55">you're doing more work on the server</span> <span data-start="502.55" data-end="505.22">because you're using more JavaScript I</span> <span data-start="505.22" data-end="507.71">think that's okay and this is the thing</span> <span data-start="507.71" data-end="510.8">is people people think that that doing</span> <span data-start="510.8" data-end="513.08">that helps them if you use non-blocking</span> <span data-start="513.08" data-end="516.56">i/o you're removing all of the resource</span> <span data-start="516.56" data-end="519.08">allocation during latency so all of</span> <span data-start="519.08" data-end="520.64">those latent periods you can forget</span> <span data-start="520.64" data-end="522.11">about and the computation is still the</span> <span data-start="522.11" data-end="523.94">same so pushing all of that</span> <span data-start="523.94" data-end="525.95">client-facing processing off the main</span> <span data-start="525.95" data-end="527.3">process so if we look at the</span> <span data-start="527.3" data-end="529.58">architecture again you know pushing that</span> <span data-start="529.58" data-end="532.01">back to another thing that's in the same</span> <span data-start="532.01" data-end="534.35">critical path isn't helping you in fact</span> <span data-start="534.35" data-end="535.84">it's actually just making it worse</span> <span data-start="535.84" data-end="538.7">you're pushing that processing so you</span> <span data-start="538.7" data-end="540.62">have to have another jump you have to</span> <span data-start="540.62" data-end="543.38">have more HTTP requests it turns out</span> <span data-start="543.38" data-end="546.97">that it's okay if you have a bunch of</span> <span data-start="546.97" data-end="549.53">like node front ends or running express</span> <span data-start="549.53" data-end="550.43">and</span> <span data-start="550.43" data-end="552.47">you know oh you know your individual</span> <span data-start="552.47" data-end="555.23">response time is now 15 milliseconds</span> <span data-start="555.23" data-end="557.149">instead of one millisecond well that's</span> <span data-start="557.149" data-end="559.49">okay because you're doing more work just</span> <span data-start="559.49" data-end="560.72">get more service you're going to need</span> <span data-start="560.72" data-end="562.46">more servers anyway so I think this is</span> <span data-start="562.46" data-end="564.47">something that people people you know</span> <span data-start="564.47" data-end="566.81">conceptually understand this idea if I</span> <span data-start="566.81" data-end="568.82">don't want to block the event loop but</span> <span data-start="568.82" data-end="570.56">if you're just doing more work then</span> <span data-start="570.56" data-end="572.45">that's okay so let's look at some other</span> <span data-start="572.45" data-end="575.12">stuff what other kind of architectures</span> <span data-start="575.12" data-end="577.1">might might we look at anything this is</span> <span data-start="577.1" data-end="578.99">where it starts to get more interesting</span> <span data-start="578.99" data-end="581.3">so we've got a client I've got a front</span> <span data-start="581.3" data-end="582.41">end farm which is talking to the</span> <span data-start="582.41" data-end="585.05">database maybe this is express now the</span> <span data-start="585.05" data-end="587.3">logging is this is something that isn't</span> <span data-start="587.3" data-end="588.77">on that critical path this isn't</span> <span data-start="588.77" data-end="591.35">involved in getting the response to the</span> <span data-start="591.35" data-end="594.32">user as fast as possible instead now</span> <span data-start="594.32" data-end="596.149">we've got something where it's you know</span> <span data-start="596.149" data-end="597.62">this is something that's out of band</span> <span data-start="597.62" data-end="599.54">this is something that and if you are</span> </p>
<p><span data-start="599.54" data-end="603.11">Matt is matt raney around somewhere hey</span> <span data-start="603.11" data-end="605.75">Matt there is he's really tall but he's</span> <span data-start="605.75" data-end="607.399">sitting down so now he's just putting</span> <span data-start="607.399" data-end="609.02">his hand up like an average height</span> <span data-start="609.02" data-end="612.8">person Matt Matt is doing a bunch of</span> <span data-start="612.8" data-end="614.42">stuff in this kind of model so i</span> <span data-start="614.42" data-end="616.19">recommend talking to matt if you if you</span> <span data-start="616.19" data-end="617.779">want to talk to somebody that's running</span> <span data-start="617.779" data-end="620.99">at scale a bunch of stuff where he's</span> <span data-start="620.99" data-end="623">pushing the work which isn't user-facing</span> <span data-start="623" data-end="625.4">out of band and this is this is where</span> <span data-start="625.4" data-end="627.26">it's useful if you have this process</span> <span data-start="627.26" data-end="629.029">that that you want to work as fast as</span> <span data-start="629.029" data-end="631.16">possible and you're sharing memory</span> <span data-start="631.16" data-end="632.93">things like logging just throw it at</span> </p>
<p><span data-start="632.93" data-end="634.73">Redis throw it at some node process</span> <span data-start="634.73" data-end="636.38">that's going to take it to read us a</span> <span data-start="636.38" data-end="639.35">real couch and get it out of the way the</span> <span data-start="639.35" data-end="642.41">user if you if you have and this is I</span> <span data-start="642.41" data-end="643.55">mean a really good example of this</span> <span data-start="643.55" data-end="646.73">actually is a standard error if you try</span> <span data-start="646.73" data-end="649.01">and write to process that standard error</span> <span data-start="649.01" data-end="652.43">on you'll note your main node process</span> <span data-start="652.43" data-end="656.63">that actually blocks it if the colonel</span> <span data-start="656.63" data-end="658.73">write buffer is full that will block</span> <span data-start="658.73" data-end="660.829">your whole main node process so the</span> <span data-start="660.829" data-end="662.63">better thing to do is if you want to log</span> <span data-start="662.63" data-end="663.829">to standard error which you don't really</span> <span data-start="663.829" data-end="666.23">need to but if you really did throw it</span> <span data-start="666.23" data-end="668.06">out to a separate note process that's</span> <span data-start="668.06" data-end="670.91">going to write to the that file</span> <span data-start="670.91" data-end="672.62">descriptor on your behalf you know you</span> <span data-start="672.62" data-end="674.089">can share the file descriptor you can</span> <span data-start="674.089" data-end="675.8">pass it over and it will write to it on</span> <span data-start="675.8" data-end="677.51">your behalf but you've got to get the</span> <span data-start="677.51" data-end="679.85">things that are blocking the ant to do</span> <span data-start="679.85" data-end="681.829">with actually serving the request to the</span> <span data-start="681.829" data-end="684.08">user out of the main band and</span> <span data-start="684.08" data-end="685.55">this is where it makes sense to start</span> <span data-start="685.55" data-end="689.09">splitting stuff up so move work which</span> <span data-start="689.09" data-end="690.83">isn't user-facing out of the event loop</span> <span data-start="690.83" data-end="692.78">don't worry about the stuff that is that</span> <span data-start="692.78" data-end="694.4">can stay there that's fine it's just</span> <span data-start="694.4" data-end="697.07">regular work and then of course you know</span> <span data-start="697.07" data-end="699.17">i mean i'm i've started displaying some</span> <span data-start="699.17" data-end="701.48">of these things now as stacks use pre</span> <span data-start="701.48" data-end="704.39">forking so just you know create things</span> <span data-start="704.39" data-end="706.24">into farms you want to use all of your</span> <span data-start="706.24" data-end="708.92">you know all of your cause on your</span> <span data-start="708.92" data-end="711.05">machine do people know about cluster</span> <span data-start="711.05" data-end="712.75">hands up people that use in cluster a</span> <span data-start="712.75" data-end="715.73">few people you can do you can do this by</span> <span data-start="715.73" data-end="718.94">hand I strongly recommend cluster I've</span> <span data-start="718.94" data-end="721.13">heard like TJ and Guillermo a good at</span> <span data-start="721.13" data-end="725.17">writing no taps apparently that's true</span> <span data-start="725.17" data-end="729.29">so this is this is a really this is how</span> <span data-start="729.29" data-end="732.11">you use cluster so I create a file</span> <span data-start="732.11" data-end="735.23">called children Jess I create a server</span> <span data-start="735.23" data-end="736.55">in this case obviously it's really</span> <span data-start="736.55" data-end="737.93">simple in your case is going to be a lot</span> <span data-start="737.93" data-end="740.66">more complicated create the server you</span> <span data-start="740.66" data-end="743.06">have a function which does stuff and all</span> </p>
<p><span data-start="743.06" data-end="744.47">I'm doing is instead of actually</span> <span data-start="744.47" data-end="747.05">listening myself I just export the</span> <span data-start="747.05" data-end="750.76">server it's a the people you spark to</span> <span data-start="750.76" data-end="753.8">anybody using spark no okay it's like</span> <span data-start="753.8" data-end="756.38">that if you've seen that and then to run</span> <span data-start="756.38" data-end="758.3">it instead of just running it as normal</span> <span data-start="758.3" data-end="760.52">I just have a rapper script so the</span> <span data-start="760.52" data-end="763.25">rapper script includes cluster cluster</span> <span data-start="763.25" data-end="765.62">children so I'm giving it the name of my</span> <span data-start="765.62" data-end="767.81">my JavaScript application and then I</span> <span data-start="767.81" data-end="769.52">tell it to listen on port 80 now what's</span> <span data-start="769.52" data-end="771.2">going to happen is in this scenario</span> <span data-start="771.2" data-end="773.09">instead of just starting a single node</span> <span data-start="773.09" data-end="774.68">process which is what typically happens</span> <span data-start="774.68" data-end="777.05">when you just type node my script it's</span> <span data-start="777.05" data-end="779.6">going to start 20 and what it's going to</span> <span data-start="779.6" data-end="782.15">do is it's going to create our a main</span> <span data-start="782.15" data-end="783.89">process which is going to create file</span> <span data-start="783.89" data-end="785.27">descriptors it's going to listen on port</span> <span data-start="785.27" data-end="787.34">80 and it's going to pass the file</span> <span data-start="787.34" data-end="788.57">descriptors it's going to pass the</span> <span data-start="788.57" data-end="792.29">socket that one socket on port 80 to all</span> <span data-start="792.29" data-end="794.27">of the other child processes but it's</span> <span data-start="794.27" data-end="795.92">gonna the way that no does that is going</span> <span data-start="795.92" data-end="797.42">to pass them at a kernel level so</span> <span data-start="797.42" data-end="799.01">basically we're going to tell the</span> <span data-start="799.01" data-end="801.65">colonel I have these 20 processes and I</span> <span data-start="801.65" data-end="804.5">want you to give anything that happens</span> <span data-start="804.5" data-end="806.12">on port 80 to one of them and one of</span> <span data-start="806.12" data-end="808.37">them is going to pick it up so now you</span> <span data-start="808.37" data-end="809.9">know if you have a server with you know</span> <span data-start="809.9" data-end="812.36">24 logical cores whatever so say it's</span> <span data-start="812.36" data-end="814.91">you know say it's just like a regular 8</span> </p>
<p><span data-start="814.91" data-end="817.74">CPU machine and each of them has you</span> <span data-start="817.74" data-end="820.83">44 cause you know you can you can use a</span> <span data-start="820.83" data-end="823.38">bunch of those cause in order to do your</span> <span data-start="823.38" data-end="825.81">node work that's that's great that you</span> <span data-start="825.81" data-end="828.69">now have a lot more capacity within your</span> <span data-start="828.69" data-end="830.25">node and this is by far the easiest way</span> <span data-start="830.25" data-end="831.93">to do it you can obviously I mean like</span> <span data-start="831.93" data-end="833.43">go and read the code it's you know I</span> <span data-start="833.43" data-end="835.02">think it's like a thousand lines or less</span> <span data-start="835.02" data-end="837">you know you can go and see what they're</span> <span data-start="837" data-end="839.52">doing but cluster has a bunch of really</span> <span data-start="839.52" data-end="841.47">nice tools for management and you know</span> <span data-start="841.47" data-end="843.48">keeping them the the notes heart and</span> <span data-start="843.48" data-end="847.32">restarting them and stuff and then if is</span> <span data-start="847.32" data-end="849.15">that's great but you can also use load</span> <span data-start="849.15" data-end="851.37">balancers to just distribute this is all</span> <span data-start="851.37" data-end="854.22">like regular stuff no proxy I don't know</span> <span data-start="854.22" data-end="856.47">if you saw Charlie's talk you know those</span> <span data-start="856.47" data-end="858.54">guys right node proxy squared varnish</span> <span data-start="858.54" data-end="860.49">hard proxy that you know there's a bunch</span> <span data-start="860.49" data-end="862.26">of stuff I'm not gonna really talk about</span> <span data-start="862.26" data-end="864.06">that and then the final thing I wanted</span> <span data-start="864.06" data-end="865.8">to talk about a little bit let me just</span> <span data-start="865.8" data-end="868.53">check my time all right so we've got</span> <span data-start="868.53" data-end="872.1">five minutes so shouting shouting is</span> <span data-start="872.1" data-end="874.11">kind of hard I mean you know there are</span> <span data-start="874.11" data-end="875.85">definitely strategies for charting I</span> <span data-start="875.85" data-end="878.28">think one of the earliest kind of good</span> <span data-start="878.28" data-end="879.81">references that I like on shouting is</span> <span data-start="879.81" data-end="882.96">cow henningsens book on flickr i think</span> <span data-start="882.96" data-end="885.57">it's like scaling or something like that</span> <span data-start="885.57" data-end="887.55">it's called so no variety book with a</span> <span data-start="887.55" data-end="892.47">fish on it and you know node node</span> <span data-start="892.47" data-end="895.26">process can handle lots of clients so</span> <span data-start="895.26" data-end="896.49">you can do really big shards this is</span> <span data-start="896.49" data-end="897.36">actually one of the things that's really</span> <span data-start="897.36" data-end="899.67">nice about node it's like typically when</span> <span data-start="899.67" data-end="900.87">you're doing shouting strategies it's</span> <span data-start="900.87" data-end="902.46">like well you know if each of my</span> <span data-start="902.46" data-end="903.9">machines only gets like a couple</span> <span data-start="903.9" data-end="906.39">thousand clients you know the logical</span> <span data-start="906.39" data-end="908.01">like separation so you've got like a</span> <span data-start="908.01" data-end="909.42">chat room if we were building a chat</span> <span data-start="909.42" data-end="911.31">room and you want to distribute across a</span> <span data-start="911.31" data-end="913.32">bunch of things you know and you have 30</span> <span data-start="913.32" data-end="915.89">people in chat room well you know it</span> <span data-start="915.89" data-end="918.42">gets difficult or like a hundreds of</span> <span data-start="918.42" data-end="920.52">people because node will happily handle</span> <span data-start="920.52" data-end="922.41">hundreds of people on a cat room you</span> <span data-start="922.41" data-end="923.52">know you could just have like one</span> <span data-start="923.52" data-end="925.38">process / chat room that's a really</span> <span data-start="925.38" data-end="927.03">common approach that people take there's</span> <span data-start="927.03" data-end="928.68">all kinds of things but because node</span> <span data-start="928.68" data-end="930.72">processes can handle lots of clients you</span> <span data-start="930.72" data-end="932.13">can do really big shards and that's kind</span> <span data-start="932.13" data-end="933.81">of nice and the other thing that's kind</span> <span data-start="933.81" data-end="936.33">of nice is that's a single process when</span> <span data-start="936.33" data-end="938.46">you start actually doing like multi-core</span> <span data-start="938.46" data-end="941.01">node on a single machine is you can use</span> <span data-start="941.01" data-end="943.38">unix sockets so you can you can use</span> <span data-start="943.38" data-end="945.3">those same file descriptors to start</span> <span data-start="945.3" data-end="948.18">passing a lot faster communication so</span> <span data-start="948.18" data-end="949.68">file descriptor sharing is actually</span> <span data-start="949.68" data-end="951.39">really nice because you can start to</span> <span data-start="951.39" data-end="956.16">have the same the same processes</span> <span data-start="956.16" data-end="958.32">listening to the same file descriptor so</span> <span data-start="958.32" data-end="959.64">you can basically create a bunch of file</span> <span data-start="959.64" data-end="961.86">descriptors pass them to a bunch of a</span> <span data-start="961.86" data-end="963.87">child processes on the same machine and</span> <span data-start="963.87" data-end="966.87">say you guys now have a really efficient</span> <span data-start="966.87" data-end="969">way to do multicast on a single machine</span> <span data-start="969" data-end="971.52">and the colonel is facilitating all that</span> <span data-start="971.52" data-end="973.44">so you're getting a really fast inter</span> <span data-start="973.44" data-end="974.94">process communication now I'm not saying</span> <span data-start="974.94" data-end="976.8">that that's easy i'm not saying that you</span> <span data-start="976.8" data-end="977.58">don't have to think about your</span> <span data-start="977.58" data-end="979.23">architecture but one of the things</span> <span data-start="979.23" data-end="980.91">that's great is because notice is</span> <span data-start="980.91" data-end="983.19">scaling so much on a single machine is</span> <span data-start="983.19" data-end="986.88">you can start to glue you know 8012</span> <span data-start="986.88" data-end="989.46">fairs and whatever it is 30,000 people</span> <span data-start="989.46" data-end="991.44">to a single machine and say you guys are</span> <span data-start="991.44" data-end="994.47">a shard and that you know depending i</span> <span data-start="994.47" data-end="996.18">mean you know i guess there's a few guys</span> <span data-start="996.18" data-end="998.07">probably from facebook or some like</span> <span data-start="998.07" data-end="999.9">other really big companies but for most</span> <span data-start="999.9" data-end="1002.72">applications something even that simple</span> <span data-start="1002.72" data-end="1005.45">means that if you can just glue you know</span> <span data-start="1005.45" data-end="1007.01">however many people is to one machine</span> <span data-start="1007.01" data-end="1009.14">you've just achieved the amount of scale</span> <span data-start="1009.14" data-end="1011.21">that you wanted so let's look something</span> <span data-start="1011.21" data-end="1013.55">like this client load balancers glue</span> <span data-start="1013.55" data-end="1016.82">people to a machine and then the machine</span> <span data-start="1016.82" data-end="1020.27">then shards out are a bunch of processes</span> <span data-start="1020.27" data-end="1022.52">which can share some file descriptors or</span> <span data-start="1022.52" data-end="1024.62">unix sockets in order to do that really</span> <span data-start="1024.62" data-end="1026.66">you know that much faster than over the</span> <span data-start="1026.66" data-end="1030.25">network multicast so that's that's nice</span> <span data-start="1030.25" data-end="1032.69">so this is you know these I mean and if</span> <span data-start="1032.69" data-end="1033.709">you want to talk about like more</span> <span data-start="1033.709" data-end="1035.75">detailed things these get really</span> <span data-start="1035.75" data-end="1037.37">application specific but this is a</span> <span data-start="1037.37" data-end="1039.38">really nice way to kind of distribute</span> <span data-start="1039.38" data-end="1042.5">some of that load so you know UNIX file</span> <span data-start="1042.5" data-end="1044.209">descriptors have a much lower unbanded</span> <span data-start="1044.209" data-end="1045.709">latency than that work you know there's</span> <span data-start="1045.709" data-end="1047.54">still there's still a buffer there's</span> <span data-start="1047.54" data-end="1049.52">still the potential that you may not be</span> <span data-start="1049.52" data-end="1050.87">able to write to the file descriptor</span> <span data-start="1050.87" data-end="1053.09">when you want but it's a lot lower than</span> <span data-start="1053.09" data-end="1056.15">sending stuff over the network so</span> <span data-start="1056.15" data-end="1058.7">summary don't sweat client side facing</span> </p>
<p><span data-start="1058.7" data-end="1061.64">CPU time it's not a big deal move non</span> <span data-start="1061.64" data-end="1064.37">client-facing stuff away and then you</span> <span data-start="1064.37" data-end="1066.14">know use cluster if you if you're not if</span> <span data-start="1066.14" data-end="1067.31">you're using node right now in</span> <span data-start="1067.31" data-end="1069.29">production and you're not using cluster</span> <span data-start="1069.29" data-end="1071.78">I really strongly recommend taking a</span> <span data-start="1071.78" data-end="1074.06">look at that and it's just it's cluster</span> <span data-start="1074.06" data-end="1077.18">by learn boost really simple and that's</span> <span data-start="1077.18" data-end="1079.73">it so you can follow me on shimmer on</span> <span data-start="1079.73" data-end="1081.95">Twitter with one because I guess I'm</span> <span data-start="1081.95" data-end="1083.3">kind of old I've been on the internet</span> <span data-start="1083.3" data-end="1084.58">long time</span> <span data-start="1084.58" data-end="1086.32">but and any questions I think they have</span> <span data-start="1086.32" data-end="1096.94">a couple minutes yes possibly I mean I</span> <span data-start="1096.94" data-end="1099.19">think we're working at the roadmap we're</span> <span data-start="1099.19" data-end="1100.45">really interested in taking suggestions</span> <span data-start="1100.45" data-end="1102.73">on what you guys want for energy so</span> <span data-start="1102.73" data-end="1105.039">please you know let us know you know we</span> <span data-start="1105.039" data-end="1106.299">are working on some of that stuff but</span> <span data-start="1106.299" data-end="1107.679">right now we haven't published the</span> <span data-start="1107.679" data-end="1123.22">roadmap oh okay yeah yet so a bunch of</span> <span data-start="1123.22" data-end="1125.32">people I think use memcached you know I</span> <span data-start="1125.32" data-end="1126.399">mean is there's like a bunch of</span> <span data-start="1126.399" data-end="1127.779">strategies to kind of do that I mean you</span> <span data-start="1127.779" data-end="1129.429">think it depends what you want to</span> <span data-start="1129.429" data-end="1130.63">achieve and what architectures you want</span> <span data-start="1130.63" data-end="1132.76">to achieve I think things like memcache</span> <span data-start="1132.76" data-end="1135.58">they're kind of obvious i think the the</span> <span data-start="1135.58" data-end="1137.98">ability to use file descriptors in node</span> <span data-start="1137.98" data-end="1140.049">is maybe less obvious to people but i</span> <span data-start="1140.049" data-end="1141.13">agree i mean like using something like</span> <span data-start="1141.13" data-end="1143.5">memcached is a completely viable</span> <span data-start="1143.5" data-end="1149.289">strategy to ya how would you do like</span> <span data-start="1149.289" data-end="1151.51">sticky user sessions so you want one</span> <span data-start="1151.51" data-end="1155.59">user session to always be passed to the</span> <span data-start="1155.59" data-end="1158.049">same note in front Joe so the question</span> <span data-start="1158.049" data-end="1159.399">was like how do you do sticky user</span> <span data-start="1159.399" data-end="1161.2">sessions I think it depends what you're</span> <span data-start="1161.2" data-end="1163.69">building an app in so I mean I mean it</span> <span data-start="1163.69" data-end="1165.37">whether you do that has like the load</span> <span data-start="1165.37" data-end="1168.309">balancer or whether you do that you know</span> <span data-start="1168.309" data-end="1170.47">based on something with like Express and</span> <span data-start="1170.47" data-end="1172.029">actually like set sessions and then use</span> <span data-start="1172.029" data-end="1174.399">the the session handle and express in</span> <span data-start="1174.399" data-end="1177.85">order to like redirect let's assume the</span> </p>
<p><span data-start="1177.85" data-end="1182.74">Express so I would say you could either</span> <span data-start="1182.74" data-end="1185.649">use a lightweight express in front in</span> <span data-start="1185.649" data-end="1187.659">order to like redirect so just like an</span> <span data-start="1187.659" data-end="1188.86">express app that's just reading the</span> <span data-start="1188.86" data-end="1190.899">session handle and then passing it off</span> <span data-start="1190.899" data-end="1192.789">to the right place so using Express as a</span> <span data-start="1192.789" data-end="1195.58">proxy or you could you could just read</span> <span data-start="1195.58" data-end="1199.84">the cookie in a node proxy and then use</span> <span data-start="1199.84" data-end="1206.5">that Rick give any metrics are now</span> <span data-start="1206.51" data-end="1210.75">I don't you should ask Charlie you</span> <span data-start="1210.75" data-end="1212.4">should see you should ask the ninjutsu</span> <span data-start="1212.4" data-end="1215.91">goes I mean in terms of kind of I mean</span> <span data-start="1215.91" data-end="1217.86">in terms of like node proxy I don't know</span> <span data-start="1217.86" data-end="1222.68">in terms of a proxy written in node I</span> <span data-start="1222.68" data-end="1224.73">guess it depends on like the profile of</span> <span data-start="1224.73" data-end="1228.81">your traffic but we've we've done tests</span> <span data-start="1228.81" data-end="1233.31">were reasonable reasonable sized servers</span> <span data-start="1233.31" data-end="1236.07">are doing you know very high hundreds of</span> <span data-start="1236.07" data-end="1238.05">thousands of requests a second without</span> <span data-start="1238.05" data-end="1243.74">any trouble single not a single process</span> <span data-start="1243.74" data-end="1248.18">like Rocky is rocky by a few drunken</span> <span data-start="1248.18" data-end="1251.73">know by it's it's it's chartered it's</span> <span data-start="1251.73" data-end="1254.61">it's split across so it's it's sharing a</span> <span data-start="1254.61" data-end="1259.69">file descriptor in order to do learning</span> <span data-start="1259.7" data-end="1264.12">it's a solaris colonel cuz i work for</span> <span data-start="1264.12" data-end="1268.11">join um cool i do you have another talk</span> <span data-start="1268.11" data-end="1269.94">or is it I don't know at the end of it</span> <span data-start="1269.94" data-end="1273.21">anymore any more questions okay thank</span> <span data-start="1273.21" data-end="1275.16">you very much oh um and I couldn't find</span> <span data-start="1275.16" data-end="1277.92">a way to put in the side but I am I just</span> <span data-start="1277.92" data-end="1279.24">think it's really awesome I mean it's</span> <span data-start="1279.24" data-end="1282.72">just you know it's it's it's it's a</span> <span data-start="1282.72" data-end="1284.04">really bad movie that Sean Connery made</span> <span data-start="1284.04" data-end="1286.95">in like nineteen seventy-four called I</span> <span data-start="1286.95" data-end="1290.82">think it's ass off yes go and watch it</span> <span data-start="1290.82" data-end="1295.65">because it's terrible so that's it thank</span> </p>
</section>