<section>
<p><span data-start="2.88" data-end="15.92">[Music]</span> <span data-start="30.48" data-end="37.629">[Music]</span> <span data-start="37.629" data-end="41.09">hi so my talk is called immutability or</span> <span data-start="41.09" data-end="42.859">putting the dream machine to work so</span> <span data-start="42.859" data-end="44.48">I've been a front-end developer for</span> <span data-start="44.48" data-end="46.129">eight years now I was at the New York</span> <span data-start="46.129" data-end="48.829">Times for four I recently left to join</span> <span data-start="48.829" data-end="50.48">up with a company called cognate echt</span> <span data-start="50.48" data-end="53.39">their consultancy and they also have a</span> <span data-start="53.39" data-end="56.449">database and a cognate act I think we</span> <span data-start="56.449" data-end="59.989">believe that a lot of software is far</span> <span data-start="59.989" data-end="61.609">too complex and there's ways to achieve</span> <span data-start="61.609" data-end="64.01">a lot more simplicity in the type of</span> <span data-start="64.01" data-end="65.84">systems that we write one way to achieve</span> <span data-start="65.84" data-end="68.27">simplicity is through immutability</span> <span data-start="68.27" data-end="70.82">by embracing immutability so cognitive</span> <span data-start="70.82" data-end="73.16">stewards closure and closure script I'm</span> <span data-start="73.16" data-end="74.51">the lead maintainer of clojurescript</span> <span data-start="74.51" data-end="76.85">those languages emphasize immutability</span> <span data-start="76.85" data-end="79.34">we also have a database product called</span> <span data-start="79.34" data-end="81.53">de Tomic which is a immutable relational</span> <span data-start="81.53" data-end="84.05">database I'm not actually going to talk</span> <span data-start="84.05" data-end="85.88">about any of those things today or only</span> <span data-start="85.88" data-end="87.53">we'll only talk about them a little bit</span> <span data-start="87.53" data-end="89.09">the thing that I really want to talk</span> <span data-start="89.09" data-end="91.49">about today is the dream machine so if</span> <span data-start="91.49" data-end="93.02">you have not seen this book or</span> <span data-start="93.02" data-end="94.61">encountered this book this should be</span> <span data-start="94.61" data-end="96.56">number one on your reading list if you</span> <span data-start="96.56" data-end="98.15">are involved in interactive computing in</span> <span data-start="98.15" data-end="100.55">any way shape or form this was</span> <span data-start="100.55" data-end="103.19">recommended to were recommended by Alan</span> </p>
<p><span data-start="103.19" data-end="106.31">Kay as one of the best histories of how</span> <span data-start="106.31" data-end="108.59">interactive computing came to be it will</span> <span data-start="108.59" data-end="110.24">make you laugh it will make you cry and</span> <span data-start="110.24" data-end="111.65">if you have anything with you eyes it</span> <span data-start="111.65" data-end="113.48">will fill you with a sense of wonder</span> <span data-start="113.48" data-end="117.8">so JCR Licklider was a psychologist who</span> <span data-start="117.8" data-end="120.95">at the time realized that there was not</span> <span data-start="120.95" data-end="123.53">a serious enough perspective on the role</span> <span data-start="123.53" data-end="126.26">of human psychology and human factors in</span> <span data-start="126.26" data-end="129.019">computing systems also a lot of people</span> <span data-start="129.019" data-end="130.52">didn't believe interactive computing</span> <span data-start="130.52" data-end="132.14">systems would be of any utility</span> <span data-start="132.14" data-end="134.9">whatsoever and he really paved the way</span> <span data-start="134.9" data-end="135.939">through</span> <span data-start="135.939" data-end="137.879">to make sure that research institutions</span> <span data-start="137.879" data-end="140.109">were you know putting the time and</span> <span data-start="140.109" data-end="143.469">effort into discovering the results of</span> <span data-start="143.469" data-end="147.31">you know interactive computing so he is</span> <span data-start="147.31" data-end="150.549">most famous for two essays one of the</span> <span data-start="150.549" data-end="152.439">famous ones is called the man computer</span> <span data-start="152.439" data-end="153.219">symbiosis</span> <span data-start="153.219" data-end="157.359">so Licklider basically predicted my talk</span> <span data-start="157.359" data-end="159.43">fifty-four years ago I was going through</span> <span data-start="159.43" data-end="160.629">this paper for the actually the first</span> <span data-start="160.629" data-end="163.45">time two days ago and he says something</span> <span data-start="163.45" data-end="165.43">very specific which I'm going to talk</span> <span data-start="165.43" data-end="167.62">about quite a bit today this talk is a</span> <span data-start="167.62" data-end="169.299">bit of a little bit of history a little</span> <span data-start="169.299" data-end="171.129">bit of data structures and a little bit</span> <span data-start="171.129" data-end="173.98">of examples so in this paper he he sort</span> <span data-start="173.98" data-end="176.29">of lays out what are the types of</span> <span data-start="176.29" data-end="178.9">hardware and software things that are</span> <span data-start="178.9" data-end="182.169">going to pave the way for interactive</span> <span data-start="182.169" data-end="184.12">systems he saw computing as a way to</span> <span data-start="184.12" data-end="187.45">augment the human intellect so he says</span> <span data-start="187.45" data-end="189.579">in this paper the tree memory scheme is</span> <span data-start="189.579" data-end="191.049">inefficient for small memories but it</span> <span data-start="191.049" data-end="193.03">becomes increasingly efficient and using</span> <span data-start="193.03" data-end="195.189">available storage space as memory size</span> <span data-start="195.189" data-end="197.049">increases the attractive features of the</span> <span data-start="197.049" data-end="198.76">scheme are these number one the</span> <span data-start="198.76" data-end="200.56">retrieval process is extremely simple</span> <span data-start="200.56" data-end="202.449">given the argument entered the standard</span> <span data-start="202.449" data-end="203.53">initial register with the first</span> <span data-start="203.53" data-end="205.329">character pick up the address of the</span> <span data-start="205.329" data-end="207.19">second then go to the second register</span> <span data-start="207.19" data-end="208.329">and pick up the addresses of the third</span> <span data-start="208.329" data-end="210.459">if two arguments have initial characters</span> <span data-start="210.459" data-end="212.409">in common they use the same storage</span> <span data-start="212.409" data-end="214.269">space for these characters and I'm going</span> <span data-start="214.269" data-end="216.93">to actually talk about this quite a bit</span> <span data-start="216.93" data-end="219.579">here we have several people that</span> <span data-start="219.579" data-end="221.109">benefited from the culture that</span> </p>
<p><span data-start="221.109" data-end="223.51">Licklider created John McCarthy Rees</span> <span data-start="223.51" data-end="225.579">received considerable funding he is the</span> <span data-start="225.579" data-end="227.669">inventor of Lisp artificial intelligence</span> <span data-start="227.669" data-end="229.81">interpreters functional programming</span> <span data-start="229.81" data-end="232.15">garbage collection all things that are</span> <span data-start="232.15" data-end="233.439">critical for doing anything that you</span> <span data-start="233.439" data-end="235.569">guys are doing today he was a</span> <span data-start="235.569" data-end="237.4">mathematician at the time using</span> <span data-start="237.4" data-end="238.959">computers was extremely difficult</span> <span data-start="238.959" data-end="241.299">he believed that computer actually</span> <span data-start="241.299" data-end="243.37">programming the computer itself should</span> <span data-start="243.37" data-end="246.4">be a real-time interactive activity you</span> <span data-start="246.4" data-end="249.04">can thank him for console the</span> <span data-start="249.04" data-end="250.84">interactive console that's that's</span> <span data-start="250.84" data-end="252.849">definitely due to John McCarthy to his</span> <span data-start="252.849" data-end="257.079">right is Ed fredkin he was a Caltech</span> <span data-start="257.079" data-end="258.28">dropout at 19</span> <span data-start="258.28" data-end="260.409">went to the US Air Force was a fighter</span> <span data-start="260.409" data-end="262.27">pilot and then when he was very young</span> <span data-start="262.27" data-end="264.82">was pivotal and in hacking these early</span> <span data-start="264.82" data-end="267.01">computers to do impossible things to</span> <span data-start="267.01" data-end="269.08">build interactive systems</span> </p>
<p><span data-start="269.08" data-end="272.169">Ede fred can also invented the tree and</span> <span data-start="272.169" data-end="274.539">that spelled TR IE and that's what we're</span> <span data-start="274.539" data-end="277.689">gonna talk a bit about so Alan Kay is</span> <span data-start="277.689" data-end="279.159">another important figure he also</span> <span data-start="279.159" data-end="280.3">benefited from the culture that</span> </p>
<p><span data-start="280.3" data-end="284.5">Lickliter created Alan Kay what well</span> <span data-start="284.5" data-end="285.4">understood</span> <span data-start="285.4" data-end="287.8">John McCarthy's ideas he built an</span> <span data-start="287.8" data-end="290.02">interactive programming language but on</span> <span data-start="290.02" data-end="291.55">top of that he sort of erected the</span> <span data-start="291.55" data-end="292.9">edifice that we are all familiar with</span> <span data-start="292.9" data-end="294.759">today around object-oriented programming</span> <span data-start="294.759" data-end="298.509">as well as blazing the trail around what</span> <span data-start="298.509" data-end="300.939">we consider modern user interfaces so</span> <span data-start="300.939" data-end="302.139">here's an image that I think is very</span> <span data-start="302.139" data-end="305.11">inspiring a big goal of his was that</span> <span data-start="305.11" data-end="306.879">computing should be simpler that it</span> <span data-start="306.879" data-end="308.379">should be available to people at a very</span> <span data-start="308.379" data-end="308.949">young age</span> <span data-start="308.949" data-end="311.669">here are some boys and girls and they're</span> <span data-start="311.669" data-end="313.87">interacting with a live small talk</span> <span data-start="313.87" data-end="315.28">programming environment and they're</span> <span data-start="315.28" data-end="316.96">doing things that you know we're I mean</span> <span data-start="316.96" data-end="318.099">they were very lucky right they were</span> <span data-start="318.099" data-end="320.889">they were they were experiencing the</span> <span data-start="320.889" data-end="322.539">future of computing when most people</span> <span data-start="322.539" data-end="327.25">were still doing basic right there's a</span> <span data-start="327.25" data-end="328.719">really great article I recommend reading</span> <span data-start="328.719" data-end="330.939">this is an article that I found on the</span> </p>
<p><span data-start="330.939" data-end="333.61">Atari archive it's more its Marion gold</span> <span data-start="333.61" data-end="337.599">Goldeen Marion golden and she was 11</span> <span data-start="337.599" data-end="339.4">years old and she was lucky enough to</span> <span data-start="339.4" data-end="341.949">experience a Xerox Paul out Xerox Alto</span> <span data-start="341.949" data-end="344.979">and small talk and she describes when</span> <span data-start="344.979" data-end="347.319">she's like 12 years old what it was like</span> <span data-start="347.319" data-end="349.36">to program one of these machines so she</span> <span data-start="349.36" data-end="351.849">she but directly benefitted from the</span> <span data-start="351.849" data-end="353.949">dream machine she's actually has for</span> <span data-start="353.949" data-end="357.25">years been a UI programmer at Apple and</span> <span data-start="357.25" data-end="359.11">she went off to do this because of her</span> <span data-start="359.11" data-end="361">experiences with the small talk</span> <span data-start="361" data-end="363.61">environment anyways you can fire up a</span> <span data-start="363.61" data-end="365.349">small talk environment today there's an</span> <span data-start="365.349" data-end="366.729">open-source one called squeak it's quite</span> <span data-start="366.729" data-end="368.44">cool if you open the system browser</span> <span data-start="368.44" data-end="370.479">which uncovers the entire internals of</span> <span data-start="370.479" data-end="372.219">that system you will encounter something</span> <span data-start="372.219" data-end="374.5">which is very familiar to JavaScript</span> <span data-start="374.5" data-end="378.849">programmers model-view-controller trig</span> </p>
<p><span data-start="378.849" data-end="380.77">Vereen Skagen adele goldberg and others</span> <span data-start="380.77" data-end="384.46">at Xerox PARC invented NBC well 35 35</span> <span data-start="384.46" data-end="385.409">years ago</span> <span data-start="385.409" data-end="387.52">longshadow people are still talking</span> <span data-start="387.52" data-end="389.529">about this stuff I would actually argue</span> <span data-start="389.529" data-end="391.93">we haven't really advanced much beyond</span> <span data-start="391.93" data-end="394.24">it but that's okay</span> <span data-start="394.24" data-end="396.969">because at an abstract level NBC is a</span> <span data-start="396.969" data-end="399.49">sound separation of concerns we want</span> <span data-start="399.49" data-end="400.75">users to be able to interact with their</span> <span data-start="400.75" data-end="402.79">domain we want to have intuitive</span> <span data-start="402.79" data-end="404.59">representations that domain and as</span> <span data-start="404.59" data-end="406.39">programmers we want to coordinate that</span> <span data-start="406.39" data-end="408.28">abstract domain and those abstract</span> <span data-start="408.28" data-end="410.23">visual representations such that the</span> <span data-start="410.23" data-end="413.32">user has a pleasant experience but I</span> <span data-start="413.32" data-end="414.76">would argue that implementations leave</span> <span data-start="414.76" data-end="416.83">much to be desired that's having worked</span> <span data-start="416.83" data-end="419.14">with a variety of mbc's over the years</span> <span data-start="419.14" data-end="421.06">and that's because they're erected on</span> <span data-start="421.06" data-end="422.26">top of stateful objects you have</span> <span data-start="422.26" data-end="423.58">stateful models you have stateful</span> <span data-start="423.58" data-end="425.35">controllers and you have stateful views</span> <span data-start="425.35" data-end="427.42">and so the crazy I'm the idea that I'm</span> <span data-start="427.42" data-end="428.83">going to throw out as I think that</span> </p>
<p><span data-start="428.83" data-end="431.11">Licklider was correct if you build your</span> <span data-start="431.11" data-end="434.17">user interfaces around trees really cool</span> <span data-start="434.17" data-end="437.98">things happen so trees so this is the</span> <span data-start="437.98" data-end="441.52">data structure part of the talk I'm just</span> <span data-start="441.52" data-end="442.9">gonna reuse some slides because these</span> <span data-start="442.9" data-end="444.31">slides are amazing they were done by</span> <span data-start="444.31" data-end="446.05">Zach Hollan at hacker school he's a</span> <span data-start="446.05" data-end="448.15">facilitator there he put these slides</span> <span data-start="448.15" data-end="450.04">together for Strange Loop and they're</span> <span data-start="450.04" data-end="451.51">just so good there's absolutely no</span> <span data-start="451.51" data-end="454.77">reason for me to come up with my own so</span> <span data-start="454.77" data-end="456.22">regardless of whether you like</span> <span data-start="456.22" data-end="457.45">functional programming a lot it's not</span> <span data-start="457.45" data-end="460.39">very important but all these ideas apply</span> <span data-start="460.39" data-end="462.1">if you like object-oriented programming</span> <span data-start="462.1" data-end="464.41">but we need to at least understand how</span> <span data-start="464.41" data-end="466.3">these data structures came to be and why</span> <span data-start="466.3" data-end="468.01">functional programmers like them in</span> <span data-start="468.01" data-end="469.72">order to understand how we might use</span> <span data-start="469.72" data-end="471.79">them if we prefer the object-oriented</span> <span data-start="471.79" data-end="474.46">approach so functional programmers they</span> <span data-start="474.46" data-end="475.9">like immutable values they don't like</span> <span data-start="475.9" data-end="479.17">stateful objects and when you change</span> <span data-start="479.17" data-end="480.4">something you just return a new value</span> <span data-start="480.4" data-end="482.05">and as JavaScript programmers you guys</span> <span data-start="482.05" data-end="483.49">are already well aware of this</span> <span data-start="483.49" data-end="485.47">you have numbers in JavaScript they are</span> <span data-start="485.47" data-end="486.7">thank goodness</span> <span data-start="486.7" data-end="489.34">immutable strings you're lucky not every</span> <span data-start="489.34" data-end="490.48">dynamic primary language had add</span> <span data-start="490.48" data-end="492.31">immutable strings you have immutable</span> <span data-start="492.31" data-end="494.89">strings so what functional programmers</span> <span data-start="494.89" data-end="496.99">want is that yes we know that if you add</span> <span data-start="496.99" data-end="498.76">one and one and we get to that doesn't</span> <span data-start="498.76" data-end="501.45">doesn't change the other ones right so</span> <span data-start="501.45" data-end="503.41">functional programmers also want this</span> <span data-start="503.41" data-end="505.27">behavior from collections so if I had a</span> <span data-start="505.27" data-end="508.36">key value to a map I get a new map and</span> <span data-start="508.36" data-end="510.88">the old map is not destroyed so as</span> </p>
<p><span data-start="510.88" data-end="512.26">JavaScript programmers you're extremely</span> <span data-start="512.26" data-end="514.99">used to destroying data on destroying</span> <span data-start="514.99" data-end="516.729">the past and we don't have to do that</span> <span data-start="516.729" data-end="518.2">and I'll demonstrate how this can be</span> <span data-start="518.2" data-end="519.76">done and so this is where the term</span> <span data-start="519.76" data-end="521.86">persistent comes from not persistent in</span> <span data-start="521.86" data-end="523.09">the sense of like you're going to record</span> <span data-start="523.09" data-end="524.89">it to a database but persistent in the</span> <span data-start="524.89" data-end="526.33">sense that you're not destroying</span> <span data-start="526.33" data-end="528.67">previous values and they're very fast</span> <span data-start="528.67" data-end="531.04">and this is actually relatively a recent</span> <span data-start="531.04" data-end="534.31">development Okazaki talked about purely</span> <span data-start="534.31" data-end="535.9">functional data structures but that you</span> <span data-start="535.9" data-end="536.75">know there</span> <span data-start="536.75" data-end="538.43">okay and they work they have good paper</span> <span data-start="538.43" data-end="540.89">complexity bounds a man named Phil</span> </p>
<p><span data-start="540.89" data-end="543.32">Bagwell who was EPFL where Scala was</span> <span data-start="543.32" data-end="546.38">invented he did initial research in the</span> <span data-start="546.38" data-end="547.82">early 2000s and how you could have</span> <span data-start="547.82" data-end="550.7">really high-performance persistent data</span> <span data-start="550.7" data-end="552.89">structures and they were further</span> <span data-start="552.89" data-end="555.38">modified by rich icky and actually it</span> <span data-start="555.38" data-end="557.18">was really closure that showed that they</span> <span data-start="557.18" data-end="559.57">could perform well on modern hardware</span> <span data-start="559.57" data-end="561.68">but they might that might sound really</span> <span data-start="561.68" data-end="563.72">advanced but I wanted to show you that</span> <span data-start="563.72" data-end="565.94">it's not scary oh I bet almost everyone</span> <span data-start="565.94" data-end="567.23">here in this room knows what a linked</span> <span data-start="567.23" data-end="569.69">list is and linked lists have the same</span> <span data-start="569.69" data-end="572.45">properties that we like about trees so</span> <span data-start="572.45" data-end="574.19">in a linked list here's a list with four</span> <span data-start="574.19" data-end="575.3">things in it and we store it in a</span> <span data-start="575.3" data-end="579.17">variable X well I can cons some value</span> <span data-start="579.17" data-end="580.64">onto the head of that and I can store</span> <span data-start="580.64" data-end="582.59">that in a variable Y and now I have two</span> <span data-start="582.59" data-end="586.67">values right and they share more than</span> <span data-start="586.67" data-end="589.43">50% of memory right they represent two</span> <span data-start="589.43" data-end="591.38">distinct values but they share more than</span> <span data-start="591.38" data-end="593.51">50% of memory I can take the tail of X</span> <span data-start="593.51" data-end="596.45">and cons e onto that now I have three</span> <span data-start="596.45" data-end="598.76">distinct list values and they all share</span> <span data-start="598.76" data-end="601.79">more than 50% of their memory so this is</span> <span data-start="601.79" data-end="603.56">a scalable idea this idea is called</span> <span data-start="603.56" data-end="606.589">structural sharing so sharing structure</span> <span data-start="606.589" data-end="608.78">gives us space efficiency but less</span> <span data-start="608.78" data-end="610.07">obvious is that actually gives you</span> <span data-start="610.07" data-end="612.14">computational efficiency so you if you</span> <span data-start="612.14" data-end="614.15">use structural sharing you can do these</span> <span data-start="614.15" data-end="615.8">immutable values and you can update just</span> <span data-start="615.8" data-end="618.68">a part of it and it will be efficient so</span> <span data-start="618.68" data-end="621.02">fill bag wall innovated this space again</span> <span data-start="621.02" data-end="622.4">he came up with this thing called the</span> <span data-start="622.4" data-end="624.86">arraignment try sort of tree hash array</span> <span data-start="624.86" data-end="627.32">hash array map tree rich Hickey took</span> <span data-start="627.32" data-end="629.24">that and modified it quite a bit in a</span> <span data-start="629.24" data-end="630.86">very clever way and he invented</span> <span data-start="630.86" data-end="632.42">something called the bitmap vector tree</span> <span data-start="632.42" data-end="634.22">so I know that everybody here knows what</span> <span data-start="634.22" data-end="636.38">an array is so a bitmap vector tree is</span> <span data-start="636.38" data-end="637.94">like an array it's its high-performance</span> <span data-start="637.94" data-end="640.1">random access and you can append to the</span> <span data-start="640.1" data-end="644.12">end quickly as well so the way that they</span> <span data-start="644.12" data-end="645.44">work as data lives in the leaves</span> <span data-start="645.44" data-end="647.21">it's a prefixed tree and remember</span> </p>
<p><span data-start="647.21" data-end="649.28">Licklider was talking about this in 1960</span> <span data-start="649.28" data-end="651.14">it uses a prefect it's a prefixed tree</span> <span data-start="651.14" data-end="653.72">to find a particular value and it's but</span> <span data-start="653.72" data-end="656.6">it's done in a bitwise way to make that</span> <span data-start="656.6" data-end="660.14">more visual so in in the in the tree of</span> <span data-start="660.14" data-end="661.79">a persistent vector you have an array of</span> <span data-start="661.79" data-end="663.98">arrays so at the root you have to pick</span> <span data-start="663.98" data-end="668">some fixed size say for and then every</span> <span data-start="668" data-end="670.13">element of that points to an array</span> <span data-start="670.13" data-end="672.38">which was also the same size and then</span> <span data-start="672.38" data-end="674.029">those arrays point to more arrays that</span> <span data-start="674.029" data-end="676.04">are the same size finally you're going</span> <span data-start="676.04" data-end="677.899">to hit a leaf node where you have actual</span> <span data-start="677.899" data-end="679.91">values okay this sounds kind of</span> <span data-start="679.91" data-end="681.86">interesting but how the hell do you look</span> <span data-start="681.86" data-end="685.97">up anything in this so imagine we wanna</span> <span data-start="685.97" data-end="688.16">get 100 sixth element so we can do this</span> <span data-start="688.16" data-end="690.44">really cool trick that represents a</span> <span data-start="690.44" data-end="693.35">binary number we can use bit masking to</span> <span data-start="693.35" data-end="695.449">find that thing so we can bit mask off</span> <span data-start="695.449" data-end="697.459">the first two bits this tells us to look</span> <span data-start="697.459" data-end="699.8">at look at index 1 we can bit-bit mask</span> <span data-start="699.8" data-end="701.42">the next two bits that get takes us the</span> <span data-start="701.42" data-end="704.029">next level look at index 2 bit mask</span> <span data-start="704.029" data-end="707.029">again finally it says the value you're</span> <span data-start="707.029" data-end="709.73">looking for is that index 2 and that's</span> <span data-start="709.73" data-end="711.949">106 so if you know anything about modern</span> </p>
<p><span data-start="711.949" data-end="714.68">JavaScript engines array axises and bit</span> <span data-start="714.68" data-end="716.42">shifting is about as fast as you can get</span> <span data-start="716.42" data-end="718.12">this is going to do this is going to be</span> <span data-start="718.12" data-end="720.649">the engine optimize this in pretty wild</span> <span data-start="720.649" data-end="723.38">ways which I will show that — but what</span> <span data-start="723.38" data-end="725.72">about update so this is where the</span> <span data-start="725.72" data-end="727.55">structural sharing comes into play if I</span> <span data-start="727.55" data-end="729.079">want to update for example I want to</span> <span data-start="729.079" data-end="731.899">replace 106 with the string foo how much</span> <span data-start="731.899" data-end="734.06">work do we have to do we only have to</span> <span data-start="734.06" data-end="735.98">clone the arrays on the path that</span> <span data-start="735.98" data-end="738.199">changed all other paths that weren't</span> <span data-start="738.199" data-end="740">involved in the change don't need to be</span> <span data-start="740" data-end="744.079">updated so that's how much work we have</span> <span data-start="744.079" data-end="746.779">to do to to update that thing and none</span> <span data-start="746.779" data-end="748.22">of the other nodes are going to change</span> <span data-start="748.22" data-end="750.589">they all stay the same so this is where</span> <span data-start="750.589" data-end="752.029">the the structural sharing we saw with</span> <span data-start="752.029" data-end="755">linked lists happens with trees so</span> <span data-start="755" data-end="757.16">you're probably thinking well the for</span> <span data-start="757.16" data-end="759.829">this seems like a weird number to pick</span> <span data-start="759.829" data-end="761.42">for the length and of course after</span> <span data-start="761.42" data-end="763.639">empirical testing it turns out that 32</span> <span data-start="763.639" data-end="765.649">is a really good number on modern</span> <span data-start="765.649" data-end="767.48">hardware you do a bunch of tests and 32</span> <span data-start="767.48" data-end="769.37">works out the best in terms of how</span> <span data-start="769.37" data-end="771.29">expensive is it to update versus how</span> <span data-start="771.29" data-end="773.81">quickly we can look something out ok</span> <span data-start="773.81" data-end="775.91">just to give you a sense of how good a</span> <span data-start="775.91" data-end="778.16">such a wide branching factor is 32 to</span> <span data-start="778.16" data-end="781.069">the seventh power that's 34 billion</span> <span data-start="781.069" data-end="784.37">elements on a 64-bit OS with a 64-bit VM</span> <span data-start="784.37" data-end="786.68">where the values are 64-bit if you do</span> <span data-start="786.68" data-end="788.149">that in a regular JavaScript array</span> <span data-start="788.149" data-end="791.54">that's 256 gigabytes of RAM I don't</span> <span data-start="791.54" data-end="793.04">think anybody in this room has a laptop</span> <span data-start="793.04" data-end="795.23">with that much memory to update</span> <span data-start="795.23" data-end="796.61">something in this data structure only</span> <span data-start="796.61" data-end="799.579">requires seven array updates to access</span> <span data-start="799.579" data-end="801.439">anything at most you need seven array</span> <span data-start="801.439" data-end="804.56">accesses and in some bit operations</span> <span data-start="804.56" data-end="808.29">okay so that's a lot of talk let's see</span> <span data-start="808.29" data-end="811.74">some let's see some numbers so this is a</span> <span data-start="811.74" data-end="814.86">recent build of v8 I'm I've exported all</span> <span data-start="814.86" data-end="816.39">the functionality and closure script by</span> <span data-start="816.39" data-end="817.65">a library called Mori which is available</span> <span data-start="817.65" data-end="820.26">on NPM as well as for the browser if you</span> <span data-start="820.26" data-end="822.69">want to do that so what I do is I build</span> <span data-start="822.69" data-end="824.19">an array and I add one mill I just</span> <span data-start="824.19" data-end="825.54">pushed one million elements to a</span> <span data-start="825.54" data-end="827.16">nighttime that and then I do this with a</span> <span data-start="827.16" data-end="830.01">persistent vector and I just calculate</span> <span data-start="830.01" data-end="831.54">the average well it looks like eighty</span> <span data-start="831.54" data-end="832.86">three milliseconds on this particular</span> <span data-start="832.86" data-end="835.32">machine and then we have an average of</span> <span data-start="835.32" data-end="838.2">about 288 for persistent vectors so it</span> <span data-start="838.2" data-end="839.76">should already be shocking because it's</span> <span data-start="839.76" data-end="841.56">this is not an order of magnitude slower</span> <span data-start="841.56" data-end="843.96">right this is about a little bit more</span> <span data-start="843.96" data-end="846">than three times slower that's already</span> <span data-start="846" data-end="847.59">cool there are many applications that</span> <span data-start="847.59" data-end="849.21">could benefit from these data structures</span> <span data-start="849.21" data-end="852.21">that don't need just the craziest amount</span> <span data-start="852.21" data-end="854.01">of perf I'm going to show something a</span> <span data-start="854.01" data-end="861.09">little bit crazier so we've been doing</span> <span data-start="861.09" data-end="863.31">persistent data structures for seven</span> <span data-start="863.31" data-end="864.69">years now enclosure and clear scripts</span> <span data-start="864.69" data-end="866.67">we've gotten more and more clever about</span> <span data-start="866.67" data-end="868.83">what optimizations you can do so you</span> <span data-start="868.83" data-end="870.24">guys might be familiar with object</span> <span data-start="870.24" data-end="873.09">freeze so of course all all of our data</span> <span data-start="873.09" data-end="874.71">structures are already front effectively</span> <span data-start="874.71" data-end="876.12">frozen but we have a corresponding</span> <span data-start="876.12" data-end="878.61">operation called thumb rule it's called</span> <span data-start="878.61" data-end="880.41">transient but we imagine it's like</span> <span data-start="880.41" data-end="882.87">object thaw and we can get in oh one</span> <span data-start="882.87" data-end="885.15">time a mutable version of the persistent</span> <span data-start="885.15" data-end="886.89">thing and we can also make it persistent</span> <span data-start="886.89" data-end="889.59">again in one time so how does a</span> <span data-start="889.59" data-end="892.53">transient vector compared to a immutable</span> <span data-start="892.53" data-end="900.3">array it's faster to build a persistent</span> <span data-start="900.3" data-end="902.16">vector than it is to mutate immutable</span> <span data-start="902.16" data-end="904.47">array so that's pretty crazy to show</span> <span data-start="904.47" data-end="906.72">that this is true on on engines other or</span> <span data-start="906.72" data-end="908.85">not faster but the performance is about</span> <span data-start="908.85" data-end="911.49">the same or not so bad for other</span> </p>
<p><span data-start="911.49" data-end="913.2">JavaScript engines this is a recent</span> <span data-start="913.2" data-end="917.97">build of JavaScript core it's not it's</span> <span data-start="917.97" data-end="920.64">not significantly slower right so we but</span> <span data-start="920.64" data-end="922.23">we have we have all this all these</span> <span data-start="922.23" data-end="924.3">magical properties that arrays don't</span> <span data-start="924.3" data-end="925.95">have and we can achieve their</span> <span data-start="925.95" data-end="932.19">performance of mutable arrays okay so</span> <span data-start="932.19" data-end="934.29">that's that's awesome so this is this is</span> <span data-start="934.29" data-end="935.7">because so many people have been</span> <span data-start="935.7" data-end="937.2">building the dream machine for us right</span> <span data-start="937.2" data-end="937.5">just</span> <span data-start="937.5" data-end="938.4">so much research has gone into</span> <span data-start="938.4" data-end="941.28">optimizing dynamic programming languages</span> <span data-start="941.28" data-end="943.05">and I got really excited because</span> <span data-start="943.05" data-end="945.48">recently WebKit sort of kicked up the</span> <span data-start="945.48" data-end="947.25">notch again I felt like things were</span> <span data-start="947.25" data-end="949.65">stagnating a bit with their FTL JIT</span> <span data-start="949.65" data-end="951.87">which is a fourth tier and that tier is</span> <span data-start="951.87" data-end="953.85">going to absolutely love the type of</span> <span data-start="953.85" data-end="956.1">code that's involved in doing these</span> <span data-start="956.1" data-end="958.98">kinds of data structures so there's more</span> <span data-start="958.98" data-end="961.59">excitement to come nick bray talked on</span> <span data-start="961.59" data-end="963.96">thursday about opening up the door to</span> <span data-start="963.96" data-end="966.87">shared memory parallel ism so closure</span> <span data-start="966.87" data-end="967.98">skippers already ready for that</span> <span data-start="967.98" data-end="968.97">clojurescript data structures are</span> <span data-start="968.97" data-end="970.89">already locked free so you can do</span> <span data-start="970.89" data-end="972.72">parallel operations on them without</span> <span data-start="972.72" data-end="976.23">locks okay so hopefully you're excited</span> <span data-start="976.23" data-end="977.37">about trees and you're convinced that</span> <span data-start="977.37" data-end="979.68">maybe Licklider had a good idea in 1960</span> <span data-start="979.68" data-end="982.62">so I want to see well what does this</span> <span data-start="982.62" data-end="985.59">mean for interactive programs so I built</span> <span data-start="985.59" data-end="987.2">a library five months ago called ohm</span> <span data-start="987.2" data-end="990.69">maybe some of you heard of it it it</span> <span data-start="990.69" data-end="993.24">basically marries are the suite of tree</span> <span data-start="993.24" data-end="995.04">based data structures with react and it</span> <span data-start="995.04" data-end="997.5">turns out that these are a really good</span> <span data-start="997.5" data-end="999.9">pair and let's talk really briefly why</span> <span data-start="999.9" data-end="1002.12">so we can now represent our application</span> <span data-start="1002.12" data-end="1004.31">state as one giant immutable value and</span> <span data-start="1004.31" data-end="1006.41">then react says oh well you can apply a</span> <span data-start="1006.41" data-end="1007.82">function to that and we're going to</span> <span data-start="1007.82" data-end="1009.41">compute some virtual Dom which is</span> <span data-start="1009.41" data-end="1011.51">another value and now if I update my</span> <span data-start="1011.51" data-end="1013.4">immutable app state and I get a new</span> <span data-start="1013.4" data-end="1014.9">value I can apply that function again</span> <span data-start="1014.9" data-end="1017.03">and react will produce some new virtual</span> </p>
<p><span data-start="1017.03" data-end="1019.25">Dom and the way that react works is it</span> <span data-start="1019.25" data-end="1020.99">applies a very clever diffing algorithm</span> <span data-start="1020.99" data-end="1022.97">on the on these two virtual Dom's</span> <span data-start="1022.97" data-end="1024.5">and then that creates a minimal change</span> <span data-start="1024.5" data-end="1026.93">set but what's fascinating about this is</span> <span data-start="1026.93" data-end="1029.65">that what happens if we flip V 1 and V 0</span> <span data-start="1029.65" data-end="1032.72">for free react will give us the reverse</span> <span data-start="1032.72" data-end="1036.29">change set right for free so this means</span> <span data-start="1036.29" data-end="1038.93">that we can do undo redo trivially you</span> <span data-start="1038.93" data-end="1040.819">can you can jump or to an arbitrary</span> <span data-start="1040.819" data-end="1043.339">point in time you can also do things it</span> <span data-start="1043.339" data-end="1045.41">makes actually computing Delta's faster</span> <span data-start="1045.41" data-end="1047.329">you can do it makes that which makes</span> <span data-start="1047.329" data-end="1049.61">synchronization simpler for example if</span> <span data-start="1049.61" data-end="1050.99">you want to rollback your app state on</span> <span data-start="1050.99" data-end="1053.09">an error you can just jump back to the</span> <span data-start="1053.09" data-end="1055.19">previous application state the snapshot</span> <span data-start="1055.19" data-end="1057.68">you don't have to manually reconstruct</span> <span data-start="1057.68" data-end="1059.27">what your app looked like before the</span> <span data-start="1059.27" data-end="1061.94">error occurred lots of cool stuff it's</span> <span data-start="1061.94" data-end="1063.68">not just about undo and redo which some</span> <span data-start="1063.68" data-end="1065.08">people get confused about</span> <span data-start="1065.08" data-end="1068.45">okay so let's so I it's it's most fun to</span> <span data-start="1068.45" data-end="1069.77">show an example that I did not write so</span> </p>
<p><span data-start="1069.77" data-end="1071.36">I said</span> <span data-start="1071.36" data-end="1073.7">I did a version up to do NBC with ohm</span> <span data-start="1073.7" data-end="1076.489">and I said I think I can do undo pretty</span> <span data-start="1076.489" data-end="1077.989">simply and I was able to do it</span> <span data-start="1077.989" data-end="1079.639">and non-invasively I did not change any</span> <span data-start="1079.639" data-end="1082.249">of my to do MBC code I did in an</span> <span data-start="1082.249" data-end="1084.11">external change and it was five lines of</span> <span data-start="1084.11" data-end="1087.259">code to add undo over the entire state</span> <span data-start="1087.259" data-end="1090.019">of the to-do MVC application so this guy</span> <span data-start="1090.019" data-end="1091.909">a table tainha skyjacked Scheidler said</span> <span data-start="1091.909" data-end="1094.279">well maybe maybe David know is pulling</span> <span data-start="1094.279" data-end="1095.809">my chain here is this this is actually</span> <span data-start="1095.809" data-end="1097.58">really work for a less trivial thing</span> <span data-start="1097.58" data-end="1099.86">than to do MVC so he decided decided to</span> <span data-start="1099.86" data-end="1104.179">build a 64 by 64 pixel editor the pixel</span> <span data-start="1104.179" data-end="1106.58">surface the frame is represented as an</span> <span data-start="1106.58" data-end="1111.799">immutable vector and that's 4096 values</span> <span data-start="1111.799" data-end="1114.08">in there that represent pixels so let's</span> <span data-start="1114.08" data-end="1117.71">see this guy in action so I can I can</span> <span data-start="1117.71" data-end="1119.389">select the color here and then I can you</span> <span data-start="1119.389" data-end="1122.239">know start drawing some things on to you</span> <span data-start="1122.239" data-end="1125.45">or let's resize that on the right you</span> <span data-start="1125.45" data-end="1130.48">should see the history accumulating I</span> <span data-start="1130.48" data-end="1134.32">can go over here and I can click undo</span> <span data-start="1134.32" data-end="1140.029">and click redo I can I can scrub and you</span> <span data-start="1140.029" data-end="1143.539">see the preview on the left oops</span> <span data-start="1143.539" data-end="1147.71">to do that and I can you know I can I</span> <span data-start="1147.71" data-end="1149.21">could you do this forever I've done it</span> <span data-start="1149.21" data-end="1150.95">you know I've done like 200 levels of</span> <span data-start="1150.95" data-end="1153.049">undo and the app is still responsive</span> <span data-start="1153.049" data-end="1155.83">good memory usage it doesn't slow down</span> <span data-start="1155.83" data-end="1159.59">so that's pretty cool so how complicated</span> <span data-start="1159.59" data-end="1161.509">was him was it was it for him to</span> <span data-start="1161.509" data-end="1163.179">actually implement that functionality</span> <span data-start="1163.179" data-end="1167.139">this is the entire code for undo redo</span> <span data-start="1167.139" data-end="1170.57">the preview as well as exporting it as</span> <span data-start="1170.57" data-end="1172.909">an animated gif these are very simple</span> <span data-start="1172.909" data-end="1174.679">functions it's about 60 lines of code</span> <span data-start="1174.679" data-end="1176.84">this is a nightmare to do in a mutable</span> <span data-start="1176.84" data-end="1179.149">system if you've ever tried that before</span> <span data-start="1179.149" data-end="1181.669">it's not fun and how much memory does it</span> <span data-start="1181.669" data-end="1183.619">use so if you took an array and you</span> <span data-start="1183.619" data-end="1185.809">cloned it 100 times and you because you</span> <span data-start="1185.809" data-end="1187.1">wanted to preserve the state of your app</span> <span data-start="1187.1" data-end="1189.409">of your frames and you updated one pixel</span> <span data-start="1189.409" data-end="1191.779">it takes about 1.7 megabytes to do this</span> <span data-start="1191.779" data-end="1193.19">if you do the same thing with a</span> <span data-start="1193.19" data-end="1195.2">persistent vector and you snapshot at</span> <span data-start="1195.2" data-end="1197.149">100 times you randomly updated a pixel</span> <span data-start="1197.149" data-end="1199.309">each time it takes two tenths of a</span> <span data-start="1199.309" data-end="1201.169">megabyte it's almost an order of</span> <span data-start="1201.169" data-end="1202.999">magnitude memory savings to use</span> <span data-start="1202.999" data-end="1204.66">persistent data structures for this</span> <span data-start="1204.66" data-end="1206.79">okay so we're getting we're nearing</span> <span data-start="1206.79" data-end="1210">towards the end so I I use closure and I</span> <span data-start="1210" data-end="1211.23">use closure script but I also do a lot</span> <span data-start="1211.23" data-end="1212.46">of JavaScript but I understand that a</span> <span data-start="1212.46" data-end="1213.6">lot of people don't want to do closure</span> <span data-start="1213.6" data-end="1215.43">script Lisp is still too crazy for a lot</span> <span data-start="1215.43" data-end="1218.1">of people so I spent some time about two</span> <span data-start="1218.1" data-end="1219.9">years ago exporting all of closure</span> <span data-start="1219.9" data-end="1221.49">scripts data structures as well as the</span> <span data-start="1221.49" data-end="1223.11">entire standard library for interacting</span> <span data-start="1223.11" data-end="1225.57">with them in a library called Mori if</span> <span data-start="1225.57" data-end="1227.88">you want to experiment with like what</span> <span data-start="1227.88" data-end="1229.38">type of user interfaces can we build</span> <span data-start="1229.38" data-end="1233.31">given the availability of really fast</span> <span data-start="1233.31" data-end="1235.83">really expressive persistent data</span> <span data-start="1235.83" data-end="1237.24">structures I highly recommend checking</span> <span data-start="1237.24" data-end="1239.22">it out I've tried for the most part to</span> <span data-start="1239.22" data-end="1241.2">follow conventions that are exist in</span> <span data-start="1241.2" data-end="1243.93">lodash and an underscore or what have</span> <span data-start="1243.93" data-end="1246.03">you but it does a lot more I mean there</span> <span data-start="1246.03" data-end="1246.93">are a lot of data structures we have</span> <span data-start="1246.93" data-end="1250.26">sets hashmaps sorted sets sorted maps</span> <span data-start="1250.26" data-end="1252.27">the persistent vectors I talked about</span> <span data-start="1252.27" data-end="1256.17">and some other things as well and I</span> <span data-start="1256.17" data-end="1258.21">actually there's a lot actually there's</span> <span data-start="1258.21" data-end="1259.95">a lot of cool possibilities here around</span> <span data-start="1259.95" data-end="1262.74">sweet Jas and Mori people have done some</span> <span data-start="1262.74" data-end="1265.29">experiments where by using sweet Jas</span> <span data-start="1265.29" data-end="1267.54">macros you can instead of having arrays</span> <span data-start="1267.54" data-end="1269.79">becoming arrays you can create</span> <span data-start="1269.79" data-end="1271.74">persistent vectors and if you have a</span> <span data-start="1271.74" data-end="1273.96">little object literal syntax instead it</span> <span data-start="1273.96" data-end="1277.92">will produce a a persistent hash map so</span> <span data-start="1277.92" data-end="1279.24">that's it hopefully that didn't take too</span> <span data-start="1279.24" data-end="1283.74">much time oh thanks</span> <span data-start="1283.74" data-end="1293.19">[Music]</span> </p>
</section>