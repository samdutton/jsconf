<section>
<p><span data-start="10.65" data-end="21.5">you</span> <span data-start="24.56" data-end="27.529">Thanks so yeah I'm Peter this is Kevin</span> <span data-start="27.529" data-end="29.449">we work at Adobe on this thing called</span> <span data-start="29.449" data-end="31.039">brackets how many people have heard of</span> <span data-start="31.039" data-end="32.54">brackets before to set it curiosity</span> <span data-start="32.54" data-end="34.309">awesome how many people have actually</span> <span data-start="34.309" data-end="37.16">used it ever yes that's what we like to</span> <span data-start="37.16" data-end="38.809">hear so for everyone else</span> <span data-start="38.809" data-end="40.73">brackets is an open-source code editor</span> <span data-start="40.73" data-end="42.62">that we're building it's MIT licensed</span> <span data-start="42.62" data-end="45.14">it runs the desktop back app but it's</span> <span data-start="45.14" data-end="46.879">actually written in JavaScript and HTML</span> <span data-start="46.879" data-end="49.61">and CSS and for that reason we think of</span> <span data-start="49.61" data-end="51.949">it as not just a code editor we think of</span> <span data-start="51.949" data-end="53.659">it as almost sort of a platform or a</span> <span data-start="53.659" data-end="56.08">sandbox for building to enable</span> <span data-start="56.08" data-end="59.6">experimentation in sort of code editor</span> <span data-start="59.6" data-end="61.79">ideas sort of new functionality new</span> <span data-start="61.79" data-end="64.21">experimental exotic you know features</span> <span data-start="64.21" data-end="66.92">for writing code tools for development</span> <span data-start="66.92" data-end="69.229">code we've done a whole bunch of</span> <span data-start="69.229" data-end="70.549">different experiments ourselves some of</span> <span data-start="70.549" data-end="72.53">them are built into brackets we've</span> <span data-start="72.53" data-end="74.45">shipped some of these ideas as brackets</span> <span data-start="74.45" data-end="75.77">extension some of them are kind of still</span> <span data-start="75.77" data-end="78.049">experimental and ongoing and we're gonna</span> <span data-start="78.049" data-end="79.85">focus on two of them today HTML live</span> <span data-start="79.85" data-end="81.439">development and something called Theseus</span> <span data-start="81.439" data-end="82.549">and we're gonna sort of go pretty deep</span> <span data-start="82.549" data-end="84.53">under the hood and explain how these</span> <span data-start="84.53" data-end="86.6">crazy new editing ideas actually work</span> <span data-start="86.6" data-end="88.729">and for the first one of those Kevin's</span> <span data-start="88.729" data-end="90.039">going to talk about live development</span> <span data-start="90.039" data-end="94.009">yeah so brackets for some time has had</span> <span data-start="94.009" data-end="96.32">live CSS development so basically if</span> <span data-start="96.32" data-end="98.27">you're editing a CSS stylesheet as you</span> <span data-start="98.27" data-end="99.95">make changes to the style sheet that</span> <span data-start="99.95" data-end="101.09">changes automatically show up in your</span> <span data-start="101.09" data-end="103.31">browser which is really cool</span> <span data-start="103.31" data-end="105.95">but see it with CSS is fairly</span> <span data-start="105.95" data-end="106.939">straightforward because you could just</span> <span data-start="106.939" data-end="107.899">replace a little stylesheet and the</span> <span data-start="107.899" data-end="109.67">browser will get it right with HTML</span> <span data-start="109.67" data-end="110.899">that's a bit harder and that's why it</span> <span data-start="110.899" data-end="112.49">gets to be interesting and hopefully</span> <span data-start="112.49" data-end="114.619">you'll enjoy hearing how that works but</span> <span data-start="114.619" data-end="117.53">let me show off what it looks like let's</span> <span data-start="117.53" data-end="120.71">see so here I am in the browser window</span> </p>
<p><span data-start="120.71" data-end="123.77">I've got a reveal.js presentation that</span> <span data-start="123.77" data-end="125.63">we're sweet looking at on the left side</span> <span data-start="125.63" data-end="128.06">we've got the live development stuff so</span> <span data-start="128.06" data-end="131.48">I should we do a demo sure why not yeah</span> <span data-start="131.48" data-end="133.22">so you can see that it's actually really</span> <span data-start="133.22" data-end="134.75">fun writing a real presentation where</span> <span data-start="134.75" data-end="136.34">you can do live changes to it like that</span> <span data-start="136.34" data-end="138.26">and see the changes as you as you make</span> <span data-start="138.26" data-end="142.48">them so let's talk about how that</span> <span data-start="142.48" data-end="146.569">actually works and what we had to do so</span> <span data-start="146.569" data-end="148.31">basically the idea here is that we want</span> <span data-start="148.31" data-end="150.08">to update the use update the page as the</span> <span data-start="150.08" data-end="151.97">user types we want to do it quickly for</span> <span data-start="151.97" data-end="153.739">two reasons one so that the changes show</span> <span data-start="153.739" data-end="155.599">up in the browser quickly and also so</span> <span data-start="155.599" data-end="158">that the typing speed is still fast</span> <span data-start="158" data-end="159.59">so that that's important to keep those</span> <span data-start="159.59" data-end="162.92">both going swiftly and so we also want</span> <span data-start="162.92" data-end="165.95">to make a reasonably minimal change to</span> <span data-start="165.95" data-end="167.51">the page so that if they have JavaScript</span> <span data-start="167.51" data-end="168.95">running or something else running on</span> <span data-start="168.95" data-end="172.1">that page that's not static content then</span> <span data-start="172.1" data-end="173.12">we want to make it so that just the</span> <span data-start="173.12" data-end="174.38">static content has changed as they're</span> <span data-start="174.38" data-end="176.93">typing so that is what we wanted to do</span> <span data-start="176.93" data-end="178.07">how hard can that be</span> <span data-start="178.07" data-end="181.61">let's see if we look at the HTML or XML</span> <span data-start="181.61" data-end="182.75">differece search that's been done</span> <span data-start="182.75" data-end="183.86">because basically what we're doing is</span> <span data-start="183.86" data-end="186.98">we're finding the differences daniel</span> </p>
<p><span data-start="186.98" data-end="188.48">Arenberg brothers paper is surveying the</span> <span data-start="188.48" data-end="190.25">research and he said but the algorithms</span> <span data-start="190.25" data-end="191.66">are all kind of difficult to understand</span> <span data-start="191.66" data-end="196.04">and yeah they they were this particular</span> <span data-start="196.04" data-end="197.69">paper proved to be a nice starting point</span> <span data-start="197.69" data-end="200.09">for us detecting changes in XML</span> <span data-start="200.09" data-end="202.58">documents it's efficient for a speed and</span> <span data-start="202.58" data-end="204.44">memory there's some loss of quality</span> <span data-start="204.44" data-end="205.58">which means your dips might be a bit</span> <span data-start="205.58" data-end="207.47">larger but that wasn't quite the</span> <span data-start="207.47" data-end="210.11">important thing to us and an important</span> <span data-start="210.11" data-end="211.82">thing too is it has a move operation and</span> <span data-start="211.82" data-end="216.62">we'll see why you want moves later on so</span> <span data-start="216.62" data-end="218.45">as we started implementing it we found a</span> <span data-start="218.45" data-end="220.34">number of differences between what that</span> <span data-start="220.34" data-end="222.019">paper was talking about and what we need</span> <span data-start="222.019" data-end="224.239">to do the biggest difference is that in</span> <span data-start="224.239" data-end="226.67">our environment we we're not just</span> <span data-start="226.67" data-end="228.47">dipping to static files on disk we</span> <span data-start="228.47" data-end="230.18">actually have this code editor that we</span> <span data-start="230.18" data-end="231.89">can store information about the document</span> <span data-start="231.89" data-end="233.45">as you're as you're writing your</span> <span data-start="233.45" data-end="235.55">document so what we do is we use this</span> <span data-start="235.55" data-end="237.2">feature we use an editor called code</span> <span data-start="237.2" data-end="239.3">mirror as the main editing surface in</span> <span data-start="239.3" data-end="241.19">brackets and it has a feature called</span> <span data-start="241.19" data-end="242.93">marks which basically lets you mark a</span> <span data-start="242.93" data-end="244.489">range of text and code mirror will keep</span> <span data-start="244.489" data-end="245.84">that mark up to date as the users</span> <span data-start="245.84" data-end="247.76">editing so if they insert some more text</span> <span data-start="247.76" data-end="251.87">that mark kind of stretches out so what</span> <span data-start="251.87" data-end="253.73">we do behind the scenes is we basically</span> <span data-start="253.73" data-end="255.799">create marks for each tag that go from</span> <span data-start="255.799" data-end="256.97">the beginning of the start tag to the</span> <span data-start="256.97" data-end="259.58">end of the end tag and we give it an ID</span> <span data-start="259.58" data-end="261.109">so each tag is going to get its own</span> <span data-start="261.109" data-end="263">unique ID and we propagate that all the</span> <span data-start="263" data-end="264.68">way through to the browser so that we</span> <span data-start="264.68" data-end="266.27">want to when we want to send dips across</span> <span data-start="266.27" data-end="267.59">to the browser we can edit based on</span> <span data-start="267.59" data-end="269.78">these IDs that were assigning so the</span> <span data-start="269.78" data-end="273.47">user never even has to see those so the</span> <span data-start="273.47" data-end="275.09">basic process that we go through is we</span> <span data-start="275.09" data-end="276.8">try to find the affected part of the</span> <span data-start="276.8" data-end="279.31">tree see if we can do maybe a partial</span> <span data-start="279.31" data-end="282.41">work on the tree we tokenize and parse</span> <span data-start="282.41" data-end="284.3">the document generate a bunch of edits</span> <span data-start="284.3" data-end="286.52">sudden those across the browser and then</span> <span data-start="286.52" data-end="288.11">apply them the browser</span> </p>
<p><span data-start="288.11" data-end="289.55">I'm not going to talk about the last two</span> <span data-start="289.55" data-end="291.409">they're they're not quite as interesting</span> <span data-start="291.409" data-end="293.449">for this purpose but I'll focus on those</span> <span data-start="293.449" data-end="296.869">first three so the first step in this</span> <span data-start="296.869" data-end="298.669">bunch of code here is basically just</span> <span data-start="298.669" data-end="300.11">figuring out is it a fairly simple</span> <span data-start="300.11" data-end="302.419">change and on that second line is it a</span> <span data-start="302.419" data-end="304.58">dangerous edit and basically idea where</span> <span data-start="304.58" data-end="305.959">there is that is it something that could</span> <span data-start="305.959" data-end="308.719">structurally change the document because</span> <span data-start="308.719" data-end="310.129">we found that there's a lot of edge</span> <span data-start="310.129" data-end="312.889">cases there to try and figure out can we</span> <span data-start="312.889" data-end="315.08">safely do just part of the tree if we</span> <span data-start="315.08" data-end="316.429">see a less than sign we just give up we</span> <span data-start="316.429" data-end="318.11">say no and we're gonna we're going to</span> <span data-start="318.11" data-end="320.509">just go ahead and do a full diff but a</span> <span data-start="320.509" data-end="322.909">lot of times as user typing you can</span> <span data-start="322.909" data-end="325.249">actually just focus on part of the tree</span> <span data-start="325.249" data-end="327.74">and work from there so for example in</span> <span data-start="327.74" data-end="332.029">that mark example I showed the h2 tag</span> <span data-start="332.029" data-end="333.349">there if you're just editing text in</span> <span data-start="333.349" data-end="335.149">there we can and you don't put a less</span> <span data-start="335.149" data-end="336.83">than sign or something we can say oh</span> <span data-start="336.83" data-end="338.599">yeah we just need to look at that h2 tag</span> <span data-start="338.599" data-end="340.909">and run a diff and see what see if</span> <span data-start="340.909" data-end="342.11">there's been a change of the text for</span> <span data-start="342.11" data-end="344.36">example and send that across so it's</span> <span data-start="344.36" data-end="345.679">much much faster especially in a big</span> <span data-start="345.679" data-end="349.909">document so the tokenizing parsing step</span> <span data-start="349.909" data-end="352.309">we started with this particular parsers</span> <span data-start="352.309" data-end="355.369">tokenizer because it had the right kind</span> <span data-start="355.369" data-end="356.689">of api for us and we've made a lot of</span> <span data-start="356.689" data-end="358.759">changes to it since then that are</span> <span data-start="358.759" data-end="360.019">specific to our need but but basically</span> <span data-start="360.019" data-end="361.969">we read the tokens as soon as the</span> <span data-start="361.969" data-end="363.439">document becomes invalid we actually</span> <span data-start="363.439" data-end="364.819">just stop updating we wait until it gets</span> <span data-start="364.819" data-end="366.409">valid again and then we make then we</span> <span data-start="366.409" data-end="368.599">start running dips again and then we</span> <span data-start="368.599" data-end="370.459">match up the the stuff that we're</span> <span data-start="370.459" data-end="371.719">reading from the document from the</span> <span data-start="371.719" data-end="373.369">document text we match that up with the</span> <span data-start="373.369" data-end="376.009">tokens sorry from the IDs that code</span> <span data-start="376.009" data-end="377.809">mirror is keeping for us and then we</span> <span data-start="377.809" data-end="380.18">build what we call a simple Dom it's not</span> <span data-start="380.18" data-end="382.43">actually it's our own little simple</span> </p>
<p><span data-start="382.43" data-end="385.519">JavaScript objects it's not native Dom</span> <span data-start="385.519" data-end="387.589">objects so we just have these simple Dom</span> <span data-start="387.589" data-end="390.319">objects and we calculate these hashes so</span> <span data-start="390.319" data-end="391.61">we'll take a look at what the simple Dom</span> <span data-start="391.61" data-end="393.229">looks like and I'll and you can see the</span> <span data-start="393.229" data-end="396.68">hashes here so basically if we have this</span> <span data-start="396.68" data-end="399.349">sort of example paragraph it's got you</span> <span data-start="399.349" data-end="400.55">know an attribute on it there are some</span> <span data-start="400.55" data-end="403.129">text nodes underneath it there's a an M</span> <span data-start="403.129" data-end="404.839">tag underneath it it's got its own text</span> <span data-start="404.839" data-end="407.269">node and so you know you have your</span> <span data-start="407.269" data-end="410.269">typical tree structure we had IDs to all</span> <span data-start="410.269" data-end="412.159">the elements that we talked about</span> <span data-start="412.159" data-end="413.809">already there those pass all the way</span> <span data-start="413.809" data-end="415.61">through and we have these signatures and</span> <span data-start="415.61" data-end="416.979">the signatures are really handy because</span> <span data-start="416.979" data-end="419.24">especially the subtree signature because</span> <span data-start="419.24" data-end="420.8">what it lets us do is</span> <span data-start="420.8" data-end="422.66">say you have you make a change to the</span> <span data-start="422.66" data-end="425.449">body of your of your page and in your</span> </p>
<p><span data-start="425.449" data-end="427.19">HTML page has you know you've got your</span> <span data-start="427.19" data-end="429.379">HTML element at the root and then you've</span> <span data-start="429.379" data-end="431.84">got a head and a body and basically we</span> <span data-start="431.84" data-end="433.879">look at the head of the new tree and</span> <span data-start="433.879" data-end="435.349">with the head of the old tree and hey</span> <span data-start="435.349" data-end="436.759">they've got the same subtree signature</span> <span data-start="436.759" data-end="438.71">that means we don't need to look at the</span> <span data-start="438.71" data-end="440.629">head at all so we just stop processing</span> <span data-start="440.629" data-end="442.49">on that part of the tree so we couldn't</span> <span data-start="442.49" data-end="444.05">quickly zero in on the part of the tree</span> <span data-start="444.05" data-end="445.19">that has changed by using these</span> <span data-start="445.19" data-end="447.919">signatures without having to compare</span> <span data-start="447.919" data-end="449.449">everything in the tree which makes a big</span> <span data-start="449.449" data-end="452.72">difference so to do that we use</span> <span data-start="452.72" data-end="454.43">something called murmur hash 3 which is</span> <span data-start="454.43" data-end="459.199">a fairly efficient hashing function and</span> <span data-start="459.199" data-end="461.03">we basically just take the information</span> <span data-start="461.03" data-end="463.19">that we need to look for the changes so</span> <span data-start="463.19" data-end="464.659">for like attributes we can just add up</span> <span data-start="464.659" data-end="467.509">the attribute pairs put them in a string</span> <span data-start="467.509" data-end="468.8">and then basically use that string and</span> <span data-start="468.8" data-end="471.229">hash it this is all fairly quick and</span> <span data-start="471.229" data-end="474.86">works pretty well so to show how this</span> <span data-start="474.86" data-end="476.719">what kind of edits were actually going</span> <span data-start="476.719" data-end="478.43">to produce here I'll use this simple</span> <span data-start="478.43" data-end="480.62">edit example where it's basically gonna</span> <span data-start="480.62" data-end="483.08">take the high J's conf paragraph and the</span> <span data-start="483.08" data-end="484.94">we're merging paragraphs paragraph and</span> <span data-start="484.94" data-end="487.069">we're gonna remove the paragraph tag</span> <span data-start="487.069" data-end="491.03">between them so so what we do is we</span> <span data-start="491.03" data-end="492.65">start off with a Dom that looks like a</span> <span data-start="492.65" data-end="495.5">simple Dom it looks like this so section</span> <span data-start="495.5" data-end="497.15">these IDs of course are gonna be</span> <span data-start="497.15" data-end="498.229">different than what we see in the actual</span> <span data-start="498.229" data-end="500.389">browser but section is the ID number one</span> <span data-start="500.389" data-end="502.58">and then we've got an h2 tag is number</span> <span data-start="502.58" data-end="505.789">two the change that we're gonna end up</span> <span data-start="505.789" data-end="508.94">making is that that paragraph ID number</span> <span data-start="508.94" data-end="510.889">four that's gonna get deleted because</span> <span data-start="510.889" data-end="513.14">we're going to delete the closing tag in</span> <span data-start="513.14" data-end="514.37">the start tag of the new paragraph and</span> <span data-start="514.37" data-end="516.56">that M tag that's number five needs to</span> <span data-start="516.56" data-end="518.959">move under paragraph three so we end up</span> <span data-start="518.959" data-end="520.339">with something that looks like this in</span> <span data-start="520.339" data-end="521.979">the end</span> <span data-start="521.979" data-end="526.13">so let's actually do the edit and see</span> <span data-start="526.13" data-end="532.01">what we get so let me find my example</span> <span data-start="532.01" data-end="535.49">okay so here's my example and I'm gonna</span> <span data-start="535.49" data-end="538.399">go ahead and do that so now we have</span> <span data-start="538.399" data-end="540.41">merged those two paragraphs together and</span> </p>
<p><span data-start="540.41" data-end="542.3">I have developer tools running against</span> <span data-start="542.3" data-end="545.39">brackets right here so we can see the</span> <span data-start="545.39" data-end="547.67">list of edits which communally actually</span> <span data-start="547.67" data-end="550.49">fits up on the screen perfectly</span> <span data-start="550.49" data-end="552.59">so the list of edits that we have we got</span> <span data-start="552.59" data-end="554.24">a few different edit types there are no</span> <span data-start="554.24" data-end="555.47">attribute edits going on here those are</span> <span data-start="555.47" data-end="557.42">very simple but we've got this this</span> <span data-start="557.42" data-end="559.22">first one is kind of mysterious it's</span> <span data-start="559.22" data-end="561.26">remember nodes and basically this is a</span> <span data-start="561.26" data-end="561.89">trick</span> <span data-start="561.89" data-end="564.38">because the way they browser implements</span> <span data-start="564.38" data-end="567.71">the the changes on its side is it just</span> <span data-start="567.71" data-end="568.97">looks at these edits as a set of</span> <span data-start="568.97" data-end="570.65">instructions it does one by one</span> <span data-start="570.65" data-end="572.84">so when we have a node that we know is</span> <span data-start="572.84" data-end="575.12">moving for example we will tell the</span> <span data-start="575.12" data-end="576.98">browser side hey hang on to this node</span> <span data-start="576.98" data-end="578.84">because you're gonna need it later</span> <span data-start="578.84" data-end="584.36">so that tag ID one to two to seven that</span> <span data-start="584.36" data-end="585.68">particular one is going to be that M</span> <span data-start="585.68" data-end="586.79">node because that's the one that's</span> <span data-start="586.79" data-end="588.77">that's moving so it's going so the</span> <span data-start="588.77" data-end="590.69">browser's gonna hang on to that then you</span> <span data-start="590.69" data-end="592.97">see we got a text replace these are</span> <span data-start="592.97" data-end="594.74">pretty common because when you're when</span> <span data-start="594.74" data-end="595.97">you're writing your HTML and it's nicely</span> <span data-start="595.97" data-end="598.16">structured and indented and all that you</span> <span data-start="598.16" data-end="599.33">have a lot of white space in there and</span> <span data-start="599.33" data-end="601.52">so that the text nodes we actually don't</span> <span data-start="601.52" data-end="603.71">really have a way to refer to them like</span> <span data-start="603.71" data-end="605.39">we do with elements you know with</span> <span data-start="605.39" data-end="608.03">elements you can easily just pick them</span> <span data-start="608.03" data-end="609.5">up by ID but with text node you've got</span> <span data-start="609.5" data-end="611.72">to actually refer to them sort of to the</span> <span data-start="611.72" data-end="613.1">relative to the elements that they're</span> <span data-start="613.1" data-end="615.65">around so that with this text replace</span> <span data-start="615.65" data-end="617.45">we've got happening here you can see it</span> <span data-start="617.45" data-end="619.16">has a parent ID so this text node lives</span> <span data-start="619.16" data-end="621.32">under that particular element and it's</span> <span data-start="621.32" data-end="623.3">after the element with this other ID and</span> <span data-start="623.3" data-end="626.42">before the element with this final ID 1</span> <span data-start="626.42" data-end="629.93">to 2 to 6 so that's really the only way</span> <span data-start="629.93" data-end="633.28">we could refer to text nodes so we</span> <span data-start="633.28" data-end="635.18">handle it that way we basically send</span> <span data-start="635.18" data-end="637.88">across a text replace saying here's your</span> <span data-start="637.88" data-end="640.4">new content just paste it all in the</span> <span data-start="640.4" data-end="642.11">next one is the element delete that we</span> <span data-start="642.11" data-end="643.79">expect for the paragraph that's going</span> <span data-start="643.79" data-end="645.92">away and then we do have another</span> <span data-start="645.92" data-end="648.41">whitespace replacement followed by the</span> <span data-start="648.41" data-end="651.2">element move so that's the so it's tag</span> </p>
<p><span data-start="651.2" data-end="653.84">ID 1 2 2 2 7 just like we said up at the</span> <span data-start="653.84" data-end="655.82">remember nodes 1 so basically this is</span> <span data-start="655.82" data-end="658.49">this is basically the the instruction</span> <span data-start="658.49" data-end="659.78">that is putting that element in the</span> <span data-start="659.78" data-end="661.82">place that it needs to be and you can</span> <span data-start="661.82" data-end="664.13">see it says last child is true and</span> <span data-start="664.13" data-end="665">that's basically telling the browser</span> <span data-start="665" data-end="667.12">just go ahead and do an append child</span> <span data-start="667.12" data-end="671.3">because this is the last one and then</span> <span data-start="671.3" data-end="673.25">finally s1 one more bit of white space</span> <span data-start="673.25" data-end="674.27">because you can never have too much</span> <span data-start="674.27" data-end="677.96">white space yeah so that's that's</span> <span data-start="677.96" data-end="682.16">basically what the edits look like so</span> <span data-start="682.16" data-end="683.64">how do we actually get those at</span> <span data-start="683.64" data-end="686.07">how do we get that edit list so we</span> <span data-start="686.07" data-end="689.34">basically have to go from the the old</span> <span data-start="689.34" data-end="690.63">treat of the new we needed to set up a</span> <span data-start="690.63" data-end="694.44">set of steps to do that so we start by</span> <span data-start="694.44" data-end="696.57">looking at the new tree so we take the</span> <span data-start="696.57" data-end="699.78">root of the new tree and we basically</span> <span data-start="699.78" data-end="701.97">step through it and compare its</span> <span data-start="701.97" data-end="703.86">attribute hashes you know those are very</span> <span data-start="703.86" data-end="706.43">simple changes compare child signatures</span> <span data-start="706.43" data-end="709.17">so there's a child signature and if the</span> <span data-start="709.17" data-end="711.18">new trees child signature is different</span> <span data-start="711.18" data-end="712.86">than the old trees child signature child</span> <span data-start="712.86" data-end="714.72">signature that means one of its direct</span> <span data-start="714.72" data-end="717.39">children has has changed and so we've</span> <span data-start="717.39" data-end="718.77">got another function that's the most</span> <span data-start="718.77" data-end="720.9">complicated part that generates those</span> <span data-start="720.9" data-end="723.84">element those edits and then we compare</span> <span data-start="723.84" data-end="725.04">subtree signatures so if those have</span> <span data-start="725.04" data-end="726.48">changed then we know we've got more</span> <span data-start="726.48" data-end="728.67">processing to do in this loop where</span> <span data-start="728.67" data-end="730.38">we're going to have to compare sub trees</span> <span data-start="730.38" data-end="732.78">further if there's a change there and</span> <span data-start="732.78" data-end="735.06">then there's a final extra case where</span> <span data-start="735.06" data-end="737.19">you might need to add a new element that</span> <span data-start="737.19" data-end="740.88">didn't exist in the old tree but so the</span> <span data-start="740.88" data-end="742.92">generating child edits is the</span> <span data-start="742.92" data-end="744.99">complicated part stuff like text nodes</span> <span data-start="744.99" data-end="746.22">makes it complicated because you know we</span> <span data-start="746.22" data-end="748.5">had that whole after ID before ID thing</span> <span data-start="748.5" data-end="750.54">that we've got to figure out moves are</span> <span data-start="750.54" data-end="752.31">kind of complicated because you have to</span> <span data-start="752.31" data-end="753.84">look to see okay this thing was deleted</span> <span data-start="753.84" data-end="756">so on one side where it was deleted in</span> <span data-start="756" data-end="757.41">one place but it's added another place</span> <span data-start="757.41" data-end="759.45">so we didn't need to kind of keep track</span> <span data-start="759.45" data-end="762.74">of that and then large structure changes</span> <span data-start="762.74" data-end="765.87">get complicated so walking through this</span> <span data-start="765.87" data-end="767.82">a little bit here are the old and new</span> <span data-start="767.82" data-end="771.53">trees so what happens is that the</span> <span data-start="771.53" data-end="773.97">section with the idea of one that's</span> <span data-start="773.97" data-end="775.23">going to get as child signatures</span> <span data-start="775.23" data-end="776.7">compared it's going to say well okay</span> <span data-start="776.7" data-end="777.84">there's so there's some difference among</span> <span data-start="777.84" data-end="779.91">these children here so that's then it's</span> <span data-start="779.91" data-end="783.03">gonna step through the children of that</span> <span data-start="783.03" data-end="785.13">element from the new tree and then the</span> <span data-start="785.13" data-end="787.53">old and compare them item by item and</span> <span data-start="787.53" data-end="789.12">you can see there's no change the text</span> <span data-start="789.12" data-end="791.67">node there's no change to the H to no</span> <span data-start="791.67" data-end="793.32">change paragraph 3 is still the same</span> <span data-start="793.32" data-end="794.76">element that it was before so that's</span> <span data-start="794.76" data-end="796.05">that's okay it doesn't actually think</span> <span data-start="796.05" data-end="798.27">there's a problem there and then that</span> <span data-start="798.27" data-end="801.69">text node is is the same and then that</span> <span data-start="801.69" data-end="802.8">we're done actually at that point</span> <span data-start="802.8" data-end="805.02">looking at the elements in the new in</span> <span data-start="805.02" data-end="807.21">the new tree so we know if we're done</span> <span data-start="807.21" data-end="808.26">looking at stuff in the new tree but</span> <span data-start="808.26" data-end="809.52">there's still stuff in the old tree that</span> <span data-start="809.52" data-end="811.56">stuff's been deleted so it's going to go</span> <span data-start="811.56" data-end="813.57">ahead and make a delete for that</span> <span data-start="813.57" data-end="817.11">paragraph at that point but then it</span> <span data-start="817.11" data-end="817.41">knows</span> <span data-start="817.41" data-end="820.379">that as it as it goes back to that main</span> <span data-start="820.379" data-end="822.12">loop it says okay well so paragraph</span> <span data-start="822.12" data-end="824.49">three has a change to its children so</span> <span data-start="824.49" data-end="825.87">it's going to go and cycle through</span> <span data-start="825.87" data-end="828.629">paragraph threes children so you see</span> <span data-start="828.629" data-end="832.47">there that the text node hi J s conf is</span> <span data-start="832.47" data-end="836.189">still the same but the M node is new so</span> <span data-start="836.189" data-end="838.23">and actually in this case the old tree</span> <span data-start="838.23" data-end="839.759">has run out of has run out of nodes to</span> <span data-start="839.759" data-end="841.319">compare but the new tree still has some</span> <span data-start="841.319" data-end="842.61">so you know those those are additions</span> <span data-start="842.61" data-end="845.339">that have happened but in the case of</span> <span data-start="845.339" data-end="847.05">this M node it knows that this M no it</span> <span data-start="847.05" data-end="849.269">existed in the old tree but it just</span> <span data-start="849.269" data-end="850.829">exists here now so it knows that's a</span> <span data-start="850.829" data-end="852.87">move and that's how it ends up making a</span> <span data-start="852.87" data-end="856.439">move edit for it and that's the basic</span> <span data-start="856.439" data-end="858.99">process it goes through you know each of</span> <span data-start="858.99" data-end="861.629">those differences that it spots it has a</span> <span data-start="861.629" data-end="863.129">different function that it's going to</span> <span data-start="863.129" data-end="865.439">call that generates the edits and it you</span> <span data-start="865.439" data-end="867.839">know will run some extra checks to see</span> <span data-start="867.839" data-end="869.639">when there's moves and things like that</span> <span data-start="869.639" data-end="873.87">it adds it basically has to do the</span> <span data-start="873.87" data-end="875.16">bookkeeping like when it spots an</span> <span data-start="875.16" data-end="877.649">element that it's that is appropriate</span> <span data-start="877.649" data-end="880.709">for using as a text after ID for example</span> <span data-start="880.709" data-end="883.92">it then sets it and hangs onto that data</span> <span data-start="883.92" data-end="885.99">that elements ID so that it can refer to</span> <span data-start="885.99" data-end="887.61">that in future text note edits and</span> <span data-start="887.61" data-end="890.519">things like that so it goes through this</span> <span data-start="890.519" data-end="892.68">this general process and there's a lot</span> <span data-start="892.68" data-end="894.269">of code to make that work can we have a</span> <span data-start="894.269" data-end="896.339">lot of test cases to make it work right</span> <span data-start="896.339" data-end="899.339">so performance why is that was what</span> <span data-start="899.339" data-end="900.269">we've been working on this print I</span> <span data-start="900.269" data-end="901.8">should mention this feature is actually</span> <span data-start="901.8" data-end="903.99">new in brackets sprint 31 which is the</span> <span data-start="903.99" data-end="906.569">sprint we're in right now so in a few</span> <span data-start="906.569" data-end="908.279">days we're gonna have a build out that</span> <span data-start="908.279" data-end="909.63">actually includes this feature right now</span> <span data-start="909.63" data-end="911.939">it's it's not a shipping feature but it</span> <span data-start="911.939" data-end="913.8">but it will be in a few days</span> <span data-start="913.8" data-end="915.24">so this sprint we've actually been</span> <span data-start="915.24" data-end="917.04">working on performance so you so it</span> <span data-start="917.04" data-end="918.63">seems like tokenizing and parsing and</span> <span data-start="918.63" data-end="920.22">hash computation in diff generation</span> <span data-start="920.22" data-end="922.079">sounds like that can actually actually</span> <span data-start="922.079" data-end="924.089">get kind of expensive but it turns out</span> <span data-start="924.089" data-end="927.089">that that's not the expensive part so it</span> <span data-start="927.089" data-end="928.29">always pays to measure before you</span> <span data-start="928.29" data-end="931.199">optimize it turned out that the code</span> <span data-start="931.199" data-end="933.899">mirror mark stuff was where we really</span> <span data-start="933.899" data-end="936.209">saw our bottlenecks and in fact a</span> <span data-start="936.209" data-end="938.04">specific area of it was was when you're</span> <span data-start="938.04" data-end="940.62">trying to find where the mark range is</span> <span data-start="940.62" data-end="942.689">in the text code mirror has to do a lot</span> <span data-start="942.689" data-end="943.68">of work to do that because basically</span> <span data-start="943.68" data-end="945.99">when you say get me the positions of</span> <span data-start="945.99" data-end="948.66">this mark it then goes has to basically</span> <span data-start="948.66" data-end="950.37">linearly scan through the document to</span> <span data-start="950.37" data-end="950.73">find</span> <span data-start="950.73" data-end="952.709">where the end of that mark is from the</span> <span data-start="952.709" data-end="954">beginning and figure out those positions</span> <span data-start="954" data-end="957.389">again recompute them so that's that gets</span> <span data-start="957.389" data-end="958.649">kind of expensive and that overwhelmed</span> <span data-start="958.649" data-end="961.62">everything else we had going on so all</span> <span data-start="961.62" data-end="963.87">we had to do is basically cache that and</span> <span data-start="963.87" data-end="965.01">that made that made all the difference</span> <span data-start="965.01" data-end="966.449">in the world as far as performance was</span> <span data-start="966.449" data-end="970.5">concerned so you can read more about</span> <span data-start="970.5" data-end="973.589">this research on our wiki if you go look</span> <span data-start="973.589" data-end="976.199">at the pages list you'll find the HTML</span> </p>
<p><span data-start="976.199" data-end="978.329">Dom data structure research if you're</span> <span data-start="978.329" data-end="979.949">interested in further detail on this and</span> <span data-start="979.949" data-end="981.24">of course it's open source so you can</span> <span data-start="981.24" data-end="985.44">also see the code Peter you want to take</span> <span data-start="985.44" data-end="986.79">it away all right so we're gonna switch</span> <span data-start="986.79" data-end="989.31">gears a little bit and talk a little bit</span> <span data-start="989.31" data-end="992.1">about the JavaScript at it inside of the</span> <span data-start="992.1" data-end="993.24">world actually more specifically</span> <span data-start="993.24" data-end="995.13">JavaScript debugging mr. project we're</span> <span data-start="995.13" data-end="996.93">working on called Theseus it's actually</span> <span data-start="996.93" data-end="998.04">a research project we're doing in</span> <span data-start="998.04" data-end="999.839">collaboration with this guy Tom Lieber</span> <span data-start="999.839" data-end="1002.36">from MIT so I'm very excited to be</span> <span data-start="1002.36" data-end="1003.29">talking about this because I think</span> <span data-start="1003.29" data-end="1004.49">between the two of us we have a monopoly</span> <span data-start="1004.49" data-end="1006.62">on the big hair for code editor</span> <span data-start="1006.62" data-end="1011.149">developers it's a good combo so Theseus</span> <span data-start="1011.149" data-end="1013.76">is a type of omniscience debugger anyone</span> <span data-start="1013.76" data-end="1015.05">heard that term before omniscient</span> <span data-start="1015.05" data-end="1017.72">debugging right so sometimes these are</span> <span data-start="1017.72" data-end="1019.12">called historical debuggers and</span> <span data-start="1019.12" data-end="1021.079">basically means that it's a it's a</span> <span data-start="1021.079" data-end="1023.24">debugger that has captured a deep</span> <span data-start="1023.24" data-end="1025.04">information about the entire history of</span> <span data-start="1025.04" data-end="1026.63">execution so rather than just knowing</span> <span data-start="1026.63" data-end="1027.919">the state when you're positive</span> <span data-start="1027.919" data-end="1029.689">breakpoint it knows everything that's</span> <span data-start="1029.689" data-end="1031.309">happened up until leading up to that</span> <span data-start="1031.309" data-end="1033.29">moment in time so some omniscient</span> <span data-start="1033.29" data-end="1034.88">debuggers use that to provide a step</span> <span data-start="1034.88" data-end="1036.35">backwards command so in addition to</span> <span data-start="1036.35" data-end="1038.089">being able to step line by line forwards</span> <span data-start="1038.089" data-end="1039.77">in the code you can also reverse time</span> <span data-start="1039.77" data-end="1042.919">and rewind line by line yeah and that's</span> <span data-start="1042.919" data-end="1044.9">a pretty cool feature there's some some</span> <span data-start="1044.9" data-end="1045.919">newer omniscient debuggers that are</span> <span data-start="1045.919" data-end="1047.24">experimenting with the idea of trying to</span> <span data-start="1047.24" data-end="1048.83">visualize the entire flow of execution</span> <span data-start="1048.83" data-end="1050.66">rather than just showing you a sliver of</span> <span data-start="1050.66" data-end="1052.49">time that you can step forward and</span> <span data-start="1052.49" data-end="1053.78">backward they try to show you everything</span> <span data-start="1053.78" data-end="1056.12">all together so if anyone's seen this</span> <span data-start="1056.12" data-end="1058.13">demo from Brett Victor that's in that</span> <span data-start="1058.13" data-end="1060.14">vein we also have a research project</span> <span data-start="1060.14" data-end="1061.88">going on with brackets called insta bug</span> <span data-start="1061.88" data-end="1065.419">that's along the same lines and then</span> <span data-start="1065.419" data-end="1068.21">some admission debuggers rather than try</span> <span data-start="1068.21" data-end="1069.41">to show you all the information at once</span> <span data-start="1069.41" data-end="1071.12">they sort of try to create a query ball</span> <span data-start="1071.12" data-end="1073.25">set of data so you can sort of filter it</span> <span data-start="1073.25" data-end="1074.72">down and you can ask questions about why</span> <span data-start="1074.72" data-end="1076.94">things happen that's the category that</span> </p>
<p><span data-start="1076.94" data-end="1080.45">Theseus sort of falls into so let me</span> <span data-start="1080.45" data-end="1081.74">actually go ahead and show you a demo of</span> <span data-start="1081.74" data-end="1087.03">it</span> <span data-start="1087.04" data-end="1090.05">what was the shortcut again command</span> <span data-start="1090.05" data-end="1098.15">option okay so yeah so I have TCS up and</span> <span data-start="1098.15" data-end="1099.38">running here it's a brackets extension</span> <span data-start="1099.38" data-end="1101.27">and I have this really simple fake web</span> <span data-start="1101.27" data-end="1102.89">page it has a fake network call because</span> <span data-start="1102.89" data-end="1105.35">you don't want to rely on the Wi-Fi and</span> <span data-start="1105.35" data-end="1106.91">when I click that button here if you</span> <span data-start="1106.91" data-end="1108.5">watch the numbers in the in the</span> <span data-start="1108.5" data-end="1110.57">left-hand column there you'll see the</span> <span data-start="1110.57" data-end="1112.46">numbers actually update every time I</span> <span data-start="1112.46" data-end="1113.69">click the button and you can see there's</span> <span data-start="1113.69" data-end="1115.16">this asynchronous sort of fake network</span> <span data-start="1115.16" data-end="1116.42">delay so you'll actually see that the</span> <span data-start="1116.42" data-end="1118.24">the thing making the network request</span> <span data-start="1118.24" data-end="1121.43">takes happens first and then you'll see</span> <span data-start="1121.43" data-end="1122.72">the second number for the callback</span> <span data-start="1122.72" data-end="1125.24">increment a second later you see that</span> <span data-start="1125.24" data-end="1128.27">kind of pause if I click this Clear</span> <span data-start="1128.27" data-end="1129.35">button you'll see the number down here</span> <span data-start="1129.35" data-end="1131.57">jumping around and you can see as I</span> <span data-start="1131.57" data-end="1132.62">click it it's updating pretty much</span> <span data-start="1132.62" data-end="1134.33">instantaneously so it's it's very fast</span> <span data-start="1134.33" data-end="1136.01">it's basically real time gathering this</span> <span data-start="1136.01" data-end="1140.87">information so it can do much more than</span> <span data-start="1140.87" data-end="1142.1">that though so for example if I click</span> <span data-start="1142.1" data-end="1142.85">one of these calls</span> </p>
<p><span data-start="1142.85" data-end="1144.59">I can see down here essentially sort of</span> <span data-start="1144.59" data-end="1146.75">a timeline of all the times this method</span> <span data-start="1146.75" data-end="1147.71">has been called and it's actually</span> <span data-start="1147.71" data-end="1150.2">captured the argument values here for</span> <span data-start="1150.2" data-end="1152.18">every invocation of that function so it</span> <span data-start="1152.18" data-end="1153.26">knows the timestamp and those the</span> <span data-start="1153.26" data-end="1154.67">argument values I can actually go look</span> <span data-start="1154.67" data-end="1156.14">at the stack trace that led to that call</span> <span data-start="1156.14" data-end="1157.81">it remembers everything that happened</span> <span data-start="1157.81" data-end="1159.8">more than that I can actually begin</span> <span data-start="1159.8" data-end="1162.5">selecting other functions and I can see</span> <span data-start="1162.5" data-end="1164.96">it essentially a threaded view of the</span> <span data-start="1164.96" data-end="1167">chain of causation that led to these</span> <span data-start="1167" data-end="1169.85">functions being called and if you stop</span> <span data-start="1169.85" data-end="1170.93">and think this is actually a pretty</span> <span data-start="1170.93" data-end="1172.73">impressive case if you look at this pair</span> <span data-start="1172.73" data-end="1175.07">because the callback is not being</span> <span data-start="1175.07" data-end="1176.63">literally directly called by this get</span> <span data-start="1176.63" data-end="1177.77">info function it's being called</span> <span data-start="1177.77" data-end="1180.08">asynchronously later kind of as a side</span> <span data-start="1180.08" data-end="1181.97">effect so it's sort of indirectly being</span> <span data-start="1181.97" data-end="1184.73">called and yet theseus is actually</span> <span data-start="1184.73" data-end="1186.05">stitching this together in sort of a</span> <span data-start="1186.05" data-end="1187.19">threaded view so it knows that this</span> <span data-start="1187.19" data-end="1189.23">specific call to get info at this time</span> <span data-start="1189.23" data-end="1191.33">led to this specific call to the call</span> <span data-start="1191.33" data-end="1194.57">back later and you can basically add as</span> <span data-start="1194.57" data-end="1196.1">many functions as you want to this query</span> <span data-start="1196.1" data-end="1198.35">and they'll all get threaded together so</span> <span data-start="1198.35" data-end="1200.57">it knows the arguments of the the</span> <span data-start="1200.57" data-end="1202.07">network call that led to the arguments</span> <span data-start="1202.07" data-end="1203.27">of the call back later even though</span> <span data-start="1203.27" data-end="1204.74">there's this kind of asynchronous delay</span> <span data-start="1204.74" data-end="1210.81">separating them</span> <span data-start="1210.82" data-end="1215.78">0/3 there you go okay so one thing that</span> </p>
<p><span data-start="1215.78" data-end="1217.58">I don't have time to show in detail it's</span> <span data-start="1217.58" data-end="1218.78">pretty cool about these days is that I</span> <span data-start="1218.78" data-end="1219.98">can actually do this for server-side</span> <span data-start="1219.98" data-end="1221.69">JavaScript code if it's running a node</span> <span data-start="1221.69" data-end="1223.85">as well as code running in the browser</span> <span data-start="1223.85" data-end="1225.14">on the client-side it can actually</span> <span data-start="1225.14" data-end="1227.72">gather data about both simultaneously so</span> <span data-start="1227.72" data-end="1228.83">if you have your client-side code</span> <span data-start="1228.83" data-end="1230.63">invoking a network call that causes code</span> <span data-start="1230.63" data-end="1232.7">to run a node then asynchronously later</span> <span data-start="1232.7" data-end="1234.44">causes more callbacks to run on the</span> <span data-start="1234.44" data-end="1236.72">client-side in the browser that threaded</span> <span data-start="1236.72" data-end="1238.01">view can actually show you the whole</span> <span data-start="1238.01" data-end="1239.39">timeline of all that stuff happening</span> <span data-start="1239.39" data-end="1240.68">interleaved both server-side and</span> <span data-start="1240.68" data-end="1243.71">client-side together it's pretty awesome</span> </p>
<p><span data-start="1243.71" data-end="1245.09">I think another milestone that we</span> <span data-start="1245.09" data-end="1246.47">reached recently with Theseus is you can</span> <span data-start="1246.47" data-end="1248.26">actually use it to debug brackets itself</span> <span data-start="1248.26" data-end="1250.34">which is pretty exciting cuz bracket</span> <span data-start="1250.34" data-end="1251.9">this is a huge code base it's megabytes</span> <span data-start="1251.9" data-end="1253.85">and megabytes of JavaScript code so sort</span> <span data-start="1253.85" data-end="1255.05">of shows that this really scales up</span> <span data-start="1255.05" data-end="1255.61">pretty well</span> <span data-start="1255.61" data-end="1257.87">so let's actually talk about how it</span> <span data-start="1257.87" data-end="1260.06">works now fundamentally the way it works</span> <span data-start="1260.06" data-end="1261.83">is by injecting instrumentation into the</span> <span data-start="1261.83" data-end="1264.5">JavaScript code it uses the Suprema</span> <span data-start="1264.5" data-end="1267.11">JavaScript parser uses an open source</span> <span data-start="1267.11" data-end="1268.4">project called falafels which is</span> <span data-start="1268.4" data-end="1270.92">essentially a parse tree walker and it</span> <span data-start="1270.92" data-end="1272.6">uses a modified version of J's hint to</span> <span data-start="1272.6" data-end="1274.37">get information about variable scoping</span> <span data-start="1274.37" data-end="1276.62">that whole stack of stuff is driven by</span> <span data-start="1276.62" data-end="1278.72">fondue which is basically a spin-off</span> <span data-start="1278.72" data-end="1280.94">project from Theseus that's just the</span> <span data-start="1280.94" data-end="1282.35">instrumentation part so it's sort of a</span> <span data-start="1282.35" data-end="1284.6">headless piece of JavaScript code that</span> <span data-start="1284.6" data-end="1286.82">takes JavaScript is input injects the</span> <span data-start="1286.82" data-end="1287.99">instrumentation and gives you the output</span> <span data-start="1287.99" data-end="1291.14">modified JavaScript so Theseus basically</span> <span data-start="1291.14" data-end="1293.15">asks fondue to generate an instrumented</span> <span data-start="1293.15" data-end="1294.59">copy of all your JavaScript code and</span> <span data-start="1294.59" data-end="1296.63">then it serves that up from a local node</span> <span data-start="1296.63" data-end="1297.89">server so similar to how the</span> <span data-start="1297.89" data-end="1299.9">instrumented HTML is served up for the</span> <span data-start="1299.9" data-end="1301.4">live HTML that Kevin talked about this</span> <span data-start="1301.4" data-end="1303.35">is serving up instrumented JavaScript</span> <span data-start="1303.35" data-end="1305.51">code so that's running in the browser</span> <span data-start="1305.51" data-end="1307.94">then brackets or Theseus inside of</span> <span data-start="1307.94" data-end="1309.62">brackets actually connects over to the</span> <span data-start="1309.62" data-end="1311.87">browser on a WebSocket to retrieve the</span> <span data-start="1311.87" data-end="1313.01">data that was gathered by that</span> <span data-start="1313.01" data-end="1314.96">instrumentation and then it's visualized</span> <span data-start="1314.96" data-end="1316.55">in the brackets UI and those the inline</span> <span data-start="1316.55" data-end="1318.23">annotations and the bottom panel that</span> <span data-start="1318.23" data-end="1319.45">you saw before</span> <span data-start="1319.45" data-end="1322.97">so let's actually look at what that</span> <span data-start="1322.97" data-end="1325.52">instrumentation looks like the simplest</span> <span data-start="1325.52" data-end="1326.84">and first thing that we want to do is</span> <span data-start="1326.84" data-end="1328.13">instrument every time a function is</span> <span data-start="1328.13" data-end="1329.39">called so we know when it was called</span> <span data-start="1329.39" data-end="1331.73">what the call stack was and what the</span> <span data-start="1331.73" data-end="1335.63">arguments were so every function the</span> <span data-start="1335.63" data-end="1336.83">beginning of the body in the end of the</span> <span data-start="1336.83" data-end="1338.72">function body gets these annotations</span> <span data-start="1338.72" data-end="1340.88">added that essentially just record what</span> <span data-start="1340.88" data-end="1342.62">function was called</span> <span data-start="1342.62" data-end="1344.54">there's argument values captures the</span> <span data-start="1344.54" data-end="1346.49">this value if there was one and captures</span> <span data-start="1346.49" data-end="1349.49">a timestamp so this is sort of a</span> <span data-start="1349.49" data-end="1350.87">simplified form of it there's actually a</span> <span data-start="1350.87" data-end="1352.19">little more boilerplate that it adds in</span> <span data-start="1352.19" data-end="1353.51">practice to do things like catching</span> <span data-start="1353.51" data-end="1355.25">exceptions and all that but this is</span> <span data-start="1355.25" data-end="1357.47">basically what it does but that's not</span> <span data-start="1357.47" data-end="1358.7">enough to do that sort of threaded view</span> <span data-start="1358.7" data-end="1360.35">where you see exactly which function</span> <span data-start="1360.35" data-end="1361.73">call led to which other function call</span> <span data-start="1361.73" data-end="1364.61">for that we need to do something more</span> <span data-start="1364.61" data-end="1365.63">complicated because if you think of</span> <span data-start="1365.63" data-end="1366.53">something like this so you could have</span> <span data-start="1366.53" data-end="1368.87">more than one call to a function in</span> <span data-start="1368.87" data-end="1370.4">different parts of the code base and the</span> <span data-start="1370.4" data-end="1372.8">the trace enter call inside the body of</span> <span data-start="1372.8" data-end="1374.84">bar doesn't know anything about which</span> <span data-start="1374.84" data-end="1376.55">particular place in the code it was</span> <span data-start="1376.55" data-end="1378.98">called from and it also doesn't know</span> <span data-start="1378.98" data-end="1379.88">which you would like to know which</span> <span data-start="1379.88" data-end="1382.88">invocation of the calling function led</span> <span data-start="1382.88" data-end="1384.23">to it so we can actually chain them all</span> <span data-start="1384.23" data-end="1386.059">together showing the argument values of</span> <span data-start="1386.059" data-end="1388.79">the caller and the callee all threaded</span> <span data-start="1388.79" data-end="1391.94">together so to do that we actually wrap</span> <span data-start="1391.94" data-end="1394.1">every single function invocation in the</span> <span data-start="1394.1" data-end="1396.14">whole code base and pass it through this</span> <span data-start="1396.14" data-end="1398.96">sort of function invoke our helper and</span> <span data-start="1398.96" data-end="1399.92">what that basically does is it's just</span> <span data-start="1399.92" data-end="1403.19">going to call bar apply with the</span> <span data-start="1403.19" data-end="1405.59">argument values but it's going to pass</span> <span data-start="1405.59" data-end="1406.91">along this identifier so we can remember</span> <span data-start="1406.91" data-end="1408.53">which place in the code base it's a</span> <span data-start="1408.53" data-end="1410.41">unique identifier for each call to bar</span> <span data-start="1410.41" data-end="1412.37">so it basically tells you the line</span> <span data-start="1412.37" data-end="1414.47">number it was called from and on top of</span> <span data-start="1414.47" data-end="1415.55">that it's going to capture the</span> <span data-start="1415.55" data-end="1416.57">information about the particular</span> <span data-start="1416.57" data-end="1419.57">invocation of the outer method foo so</span> <span data-start="1419.57" data-end="1420.86">basically what was it whatever was on</span> <span data-start="1420.86" data-end="1422.24">the stack frame there so that we know</span> <span data-start="1422.24" data-end="1424.25">the timestamp from the caller the</span> <span data-start="1424.25" data-end="1425.66">argument values captured from the caller</span> </p>
<p><span data-start="1425.66" data-end="1428.09">ID said arow it puts that information</span> <span data-start="1428.09" data-end="1430.04">kind of in some global state so that</span> <span data-start="1430.04" data-end="1431.51">when you get to the trace enter at the</span> <span data-start="1431.51" data-end="1433.04">beginning of the body of bar when it's</span> <span data-start="1433.04" data-end="1433.46">called</span> <span data-start="1433.46" data-end="1435.47">it can go grab that global State and</span> <span data-start="1435.47" data-end="1437.45">basically chain itself on to that sort</span> <span data-start="1437.45" data-end="1439.33">of threaded set of function calls</span> <span data-start="1439.33" data-end="1441.74">but even this is actually not everything</span> <span data-start="1441.74" data-end="1443.39">that we need because we've got this</span> <span data-start="1443.39" data-end="1444.8">asynchronous case we want to be able to</span> <span data-start="1444.8" data-end="1446.75">understand causation across asynchronous</span> <span data-start="1446.75" data-end="1448.01">gaps which is something that's really</span> <span data-start="1448.01" data-end="1449.87">hard to debug in traditional debugger so</span> <span data-start="1449.87" data-end="1451.19">this is kind of a really a really</span> <span data-start="1451.19" data-end="1453.23">important core part of the Theseus</span> <span data-start="1453.23" data-end="1456.38">project so we look at something like</span> <span data-start="1456.38" data-end="1457.88">this again this outer function foo it's</span> <span data-start="1457.88" data-end="1459.59">not calling this inner callback directly</span> <span data-start="1459.59" data-end="1461.69">the actual call stack of the inner</span> <span data-start="1461.69" data-end="1463.04">callback it's coming out of you know</span> <span data-start="1463.04" data-end="1464.72">like an xhr handler that goes through</span> <span data-start="1464.72" data-end="1466.07">some jQuery code and then this thing</span> <span data-start="1466.07" data-end="1467.78">gets called and the call stack doesn't</span> <span data-start="1467.78" data-end="1469.51">capture this relationship to fool at all</span> <span data-start="1469.51" data-end="1472.28">so what we do in Theseus is we actually</span> <span data-start="1472.28" data-end="1474.77">every place that a callback is created</span> <span data-start="1474.77" data-end="1475.47">we wrap</span> <span data-start="1475.47" data-end="1478.44">in a wrapper function and that wrapper</span> <span data-start="1478.44" data-end="1480.33">function stores on the function object</span> <span data-start="1480.33" data-end="1482.429">some state that lets us link it back to</span> <span data-start="1482.429" data-end="1484.889">foo and again it's not just the fact</span> <span data-start="1484.889" data-end="1486.149">that it's a function named foo with</span> <span data-start="1486.149" data-end="1487.5">such-and-such a line number that we want</span> <span data-start="1487.5" data-end="1489">to link to it's actually the specific</span> <span data-start="1489" data-end="1491.279">invocation of foo with all the argument</span> <span data-start="1491.279" data-end="1492.899">values that happened at that time in a</span> <span data-start="1492.899" data-end="1494.97">time sniff it was called in all that so</span> <span data-start="1494.97" data-end="1497.22">that information is captured at the time</span> <span data-start="1497.22" data-end="1498.72">that the wrapper is generated the</span> <span data-start="1498.72" data-end="1500.639">wrapper stores that off as a property on</span> <span data-start="1500.639" data-end="1503.039">the function object and then later on</span> <span data-start="1503.039" data-end="1504.48">when the wrapper is actually invoked it</span> <span data-start="1504.48" data-end="1506.789">can chain itself back to the particular</span> <span data-start="1506.789" data-end="1509.25">call to foo that eventually later on led</span> <span data-start="1509.25" data-end="1512.19">to the callback being run so this seems</span> <span data-start="1512.19" data-end="1513.629">like a crazy amount of instrumentation</span> <span data-start="1513.629" data-end="1514.889">being added I mean it's wrapping like</span> <span data-start="1514.889" data-end="1516.809">everything and anything right but</span> <span data-start="1516.809" data-end="1518.639">actually it's surprisingly it's it</span> <span data-start="1518.639" data-end="1519.779">doesn't really impact performance all</span> <span data-start="1519.779" data-end="1521.34">that much you know modern JavaScript VMs</span> <span data-start="1521.34" data-end="1524.19">are blazingly fast so this actually</span> <span data-start="1524.19" data-end="1525.899">works pretty effectively for even fairly</span> <span data-start="1525.899" data-end="1530.309">fairly large JavaScript code bases so if</span> <span data-start="1530.309" data-end="1531.09">you're interested in reading more about</span> <span data-start="1531.09" data-end="1533.22">that there's a great write up there on</span> <span data-start="1533.22" data-end="1534.45">the instrumentation in more detail or</span> <span data-start="1534.45" data-end="1535.95">you can actually just again go fork the</span> <span data-start="1535.95" data-end="1539.7">code and github I feel like it and I</span> <span data-start="1539.7" data-end="1540.84">just want to circle back really quick on</span> <span data-start="1540.84" data-end="1543.389">this sort of idea of brackets as a</span> <span data-start="1543.389" data-end="1545.19">sandbox you know we've been doing all</span> <span data-start="1545.19" data-end="1546.45">these kind of experiments you know with</span> <span data-start="1546.45" data-end="1549.539">different tooling UI ideas but we didn't</span> <span data-start="1549.539" data-end="1550.83">build it's just for us to do experiments</span> <span data-start="1550.83" data-end="1552.12">we built this for everyone to be able to</span> <span data-start="1552.12" data-end="1554.279">do to experiment with whatever ideas you</span> <span data-start="1554.279" data-end="1556.169">have about code editors and JavaScript</span> <span data-start="1556.169" data-end="1557.399">tooling and all that sort of stuff</span> <span data-start="1557.399" data-end="1559.139">and we think that brackets is a really</span> <span data-start="1559.139" data-end="1560.49">great platform to do that kind of stuff</span> <span data-start="1560.49" data-end="1562.169">on because it is written in JavaScript</span> <span data-start="1562.169" data-end="1563.879">and CSS and HTML so it's all the</span> <span data-start="1563.879" data-end="1565.59">standard web tech stack that everybody</span> <span data-start="1565.59" data-end="1567.87">already knows and we think that makes it</span> <span data-start="1567.87" data-end="1569.61">a really approachable code base to jump</span> <span data-start="1569.61" data-end="1571.139">in and begin hacking on begin writing</span> <span data-start="1571.139" data-end="1575.73">extensions for etc I'll just show you a</span> <span data-start="1575.73" data-end="1577.289">quick example here I won't actually walk</span> <span data-start="1577.289" data-end="1583.379">through this code in detail but in in</span> <span data-start="1583.379" data-end="1586.59">brackets here this is an extension I</span> <span data-start="1586.59" data-end="1590.639">sort of just wrote on the side I just</span> <span data-start="1590.639" data-end="1592.139">open an SVG file it basically just</span> <span data-start="1592.139" data-end="1594.269">provides an inline preview of the SVG so</span> <span data-start="1594.269" data-end="1596.25">it's a much simpler version of the live</span> <span data-start="1596.25" data-end="1597.69">preview and if I make edits here like</span> </p>
<p><span data-start="1597.69" data-end="1598.98">I'll bring up a color picker and it you</span> <span data-start="1598.98" data-end="1601.139">can see the the SVG is actually updating</span> <span data-start="1601.139" data-end="1603.779">in real time as I'm changing stuff in</span> <span data-start="1603.779" data-end="1606">the code so that's kind of something I</span> <span data-start="1606" data-end="1607.529">think would actually be pretty tricky to</span> <span data-start="1607.529" data-end="1609.299">do in a lot of other code editors but be</span> <span data-start="1609.299" data-end="1611.039">we have the full power of the Dom and a</span> <span data-start="1611.039" data-end="1613.08">real you know WebKit instance at our</span> <span data-start="1613.08" data-end="1614.94">disposal for rendering the UI it's</span> <span data-start="1614.94" data-end="1616.44">pretty simple to do in brackets if you</span> <span data-start="1616.44" data-end="1619.86">look at this you know it's really only</span> <span data-start="1619.86" data-end="1622.019">about two screen folds of code just to</span> <span data-start="1622.019" data-end="1623.97">get that up and running so you can</span> <span data-start="1623.97" data-end="1625.2">really kind of jump in and very quickly</span> <span data-start="1625.2" data-end="1627.179">experiment with ideas with in terms of</span> <span data-start="1627.179" data-end="1628.769">rich UI that would be hard to do in a</span> <span data-start="1628.769" data-end="1630.149">lot of other editors and that's exactly</span> <span data-start="1630.149" data-end="1631.649">the kind of experimentation that we want</span> <span data-start="1631.649" data-end="1634.619">to empower anyone to be able to play</span> <span data-start="1634.619" data-end="1637.769">with and build in brackets so yeah we've</span> <span data-start="1637.769" data-end="1639.659">built this sandbox and we want people to</span> <span data-start="1639.659" data-end="1641.129">come play in it so please come join our</span> <span data-start="1641.129" data-end="1649.52">sandbox</span> <span data-start="1649.53" data-end="1652.47">so we have time for maybe one question</span> <span data-start="1652.47" data-end="1654.87">is anybody enthusiastic and the audience</span> <span data-start="1654.87" data-end="1658.32">got a question okay there's one right</span> <span data-start="1658.32" data-end="1664.99">there</span> <span data-start="1665" data-end="1667.74">thanks for a great talk</span> <span data-start="1667.74" data-end="1671.159">if you can't calculate the number of</span> <span data-start="1671.159" data-end="1675.78">calls of each parcels I think I could</span> <span data-start="1675.78" data-end="1680.73">use this for a search did cotton my</span> <span data-start="1680.73" data-end="1688.89">project yeah did what I mean to test on</span> <span data-start="1688.89" data-end="1696.039">patents or methods of that never calls</span> <span data-start="1696.049" data-end="1703.049">did you say west okay it's the it's hard</span> <span data-start="1703.049" data-end="1704.99">with APA we might have to talk afterward</span> </p>
<p><span data-start="1704.99" data-end="1709.71">I ask you later okay okay yeah thanks</span> <span data-start="1709.71" data-end="1710.159">guys</span> <span data-start="1710.159" data-end="1725.23">okay thanks thank you</span> </p>
</section>