<section>
<p><span data-start="7.519" data-end="10.74">I'm going to talk a bit about the way</span> <span data-start="10.74" data-end="13.95">browsers implement and optimize the</span> <span data-start="13.95" data-end="15.9">documents object in the layout thing and</span> <span data-start="15.9" data-end="19.41">drawing their off as multi mentioned my</span> <span data-start="19.41" data-end="22.14">name is Madhava Baker I work for Mozilla</span> <span data-start="22.14" data-end="24.869">but not on any of this stuff it's</span> <span data-start="24.869" data-end="26.34">actually I expect there will be several</span> <span data-start="26.34" data-end="27.869">people in the room who know more about</span> <span data-start="27.869" data-end="30.449">this than I do they're free to correct</span> <span data-start="30.449" data-end="32.73">me at any time you might know me from</span> <span data-start="32.73" data-end="36.239">one of these things the book and the</span> <span data-start="36.239" data-end="38.879">software code mirror which is an editor</span> <span data-start="38.879" data-end="41.91">the difference the code editor that runs</span> <span data-start="41.91" data-end="45.18">inside the browser I like to start by</span> <span data-start="45.18" data-end="47.91">making a claim that the dome is actually</span> <span data-start="47.91" data-end="50.46">a great platform then we can be very</span> <span data-start="50.46" data-end="53.37">glad to have that probably half of you</span> <span data-start="53.37" data-end="55.739">have already moved on to know jazz and</span> <span data-start="55.739" data-end="57.449">are doing early server-side work or</span> <span data-start="57.449" data-end="65.97">something um but the general grumbling</span> <span data-start="65.97" data-end="67.979">that's often happening about the browser</span> <span data-start="67.979" data-end="72.93">platform is partially justified but we</span> <span data-start="72.93" data-end="75.42">have a very very nice and powerful</span> <span data-start="75.42" data-end="77.659">platform in the brochure and you</span> <span data-start="77.659" data-end="80.31">decoratively define and create your</span> <span data-start="80.31" data-end="83.52">documents then you have a full view of</span> <span data-start="83.52" data-end="85.56">these documents that you can from your</span> <span data-start="85.56" data-end="90.09">scripts manipulate and inspect and all</span> <span data-start="90.09" data-end="92.79">that is is by now heavily optimized so</span> <span data-start="92.79" data-end="96.29">that it's actually amazing how fast</span> <span data-start="96.29" data-end="99.86">things are being handled by the browser</span> <span data-start="99.86" data-end="103.38">so say you have a document big complex</span> <span data-start="103.38" data-end="105.54">document like almost every single</span> <span data-start="105.54" data-end="108.829">website that we're looking at nowadays</span> <span data-start="108.829" data-end="111.119">the first thing of course is the browser</span> <span data-start="111.119" data-end="113.46">parses the HTML that comes in applies</span> <span data-start="113.46" data-end="115.11">the styles that come back to applying</span> <span data-start="115.11" data-end="117.899">styles later but let's think about how</span> <span data-start="117.899" data-end="122.36">the drawing happens it's a tree stays</span> <span data-start="122.36" data-end="125.64">process I guess this is smaller than I</span> <span data-start="125.64" data-end="130.539">intended right um</span> <span data-start="130.549" data-end="133.739">first the browser builds up which</span> <span data-start="133.739" data-end="136.5">usually called a render tree or a layout</span> <span data-start="136.5" data-end="140.67">tree the instead of the document</span> <span data-start="140.67" data-end="144.659">hierarchy notes are organized by spatial</span> <span data-start="144.659" data-end="148.349">relations so it resembles the Dom very</span> <span data-start="148.349" data-end="150.319">much but if you have for example</span> <span data-start="150.319" data-end="153.659">absolutely positioned elements it is</span> <span data-start="153.659" data-end="156.269">moved up to the actual parents that</span> <span data-start="156.269" data-end="158.28">determines its position which is the</span> <span data-start="158.28" data-end="160.439">first parent that's absolutely a</span> <span data-start="160.439" data-end="164.76">relatively position if you have a fixed</span> <span data-start="164.76" data-end="166.349">position stuff its most all the way to</span> <span data-start="166.349" data-end="170.19">the top of the document because the</span> <span data-start="170.19" data-end="173.519">position of these elements is not does</span> <span data-start="173.519" data-end="175.019">not depend on the position of other</span> <span data-start="175.019" data-end="178.17">elements display none stuff is removed</span> <span data-start="178.17" data-end="179.639">from this tree all together in most</span> <span data-start="179.639" data-end="182.549">browsers so you get a tree that</span> <span data-start="182.549" data-end="185.489">corresponds very closely to the actual</span> <span data-start="185.489" data-end="187.44">rectangles that are appearing on the</span> <span data-start="187.44" data-end="191.329">screen and their dependencies in</span> <span data-start="191.329" data-end="195.69">positioning and sizing the next thing is</span> <span data-start="195.69" data-end="200.489">the layout in this tree this layout tree</span> <span data-start="200.489" data-end="203.01">is walked in a way that signs every</span> <span data-start="203.01" data-end="206.76">single visible note a size and a</span> <span data-start="206.76" data-end="209.78">position so a rectangle somewhere in the</span> <span data-start="209.78" data-end="213.03">coordinates page of the document if you</span> <span data-start="213.03" data-end="214.68">have inline elements they might end up</span> <span data-start="214.68" data-end="216.629">with multiple rectangles if they get</span> <span data-start="216.629" data-end="219.75">line broken each line gets its own</span> <span data-start="219.75" data-end="228.599">rectangle this layout in is mostly a top</span> <span data-start="228.599" data-end="232.709">down process and now it gets a width</span> <span data-start="232.709" data-end="235.409">that it's allowed to take it lays out</span> <span data-start="235.409" data-end="238.919">its descendants so in line stuff gets</span> <span data-start="238.919" data-end="241.23">line broken gets put next to each other</span> <span data-start="241.23" data-end="242.97">until you reach the end of the line then</span> <span data-start="242.97" data-end="245.549">it moves on to the next line block</span> <span data-start="245.549" data-end="247.709">elements gets just put under each other</span> <span data-start="247.709" data-end="250.68">an output of this process for each note</span> <span data-start="250.68" data-end="253.47">is a half which is then used to lay out</span> <span data-start="253.47" data-end="255.5">its siblings and</span> <span data-start="255.5" data-end="261.93">anything further down the tree so I said</span> <span data-start="261.93" data-end="264.06">mostly top down some things complicate</span> <span data-start="264.06" data-end="267.9">this tables mostly need multiple bosses</span> <span data-start="267.9" data-end="272.96">because table cells are adjusted too</span> <span data-start="272.96" data-end="276.15">well the size of the tables the width of</span> <span data-start="276.15" data-end="278.19">a table cell depends on its siblings so</span> <span data-start="278.19" data-end="280.979">they'll have to be laid out once to find</span> <span data-start="280.979" data-end="283.139">their maximum hey through maximum width</span> <span data-start="283.139" data-end="285.27">the width that I want then the actual</span> <span data-start="285.27" data-end="287.94">width is deidre mind especially if you</span> <span data-start="287.94" data-end="290.04">have deeply nested tables it can result</span> <span data-start="290.04" data-end="293.1">in a lot of going up and down the layout</span> <span data-start="293.1" data-end="296.91">tree in order to fix an actual layout</span> <span data-start="296.91" data-end="299.669">for each table cell which is one of the</span> <span data-start="299.669" data-end="304.68">reasons people hate tables I guess final</span> <span data-start="304.68" data-end="307.62">step is drawing this whole tree which is</span> <span data-start="307.62" data-end="310.2">basically organizing it in the index</span> <span data-start="310.2" data-end="314.19">order running over it and bleeding</span> <span data-start="314.19" data-end="315.9">everything to the screen i'll come back</span> <span data-start="315.9" data-end="320.06">to optimizations of that process later</span> <span data-start="320.06" data-end="325.41">and layout entry once is actually not</span> <span data-start="325.41" data-end="328.65">that hard the thing is that we have come</span> <span data-start="328.65" data-end="331.4">to expect to be able to change this tree</span> <span data-start="331.4" data-end="334.11">constantly and have it consistently</span> <span data-start="334.11" data-end="338.13">relay out in a performance fast way it</span> <span data-start="338.13" data-end="339.93">already starts during building of the</span> <span data-start="339.93" data-end="342.84">document when something is loading slow</span> <span data-start="342.84" data-end="344.61">it will often be rendered before it's</span> <span data-start="344.61" data-end="346.979">fully parsed the browser sparse</span> <span data-start="346.979" data-end="348.87">documents incrementally building up this</span> <span data-start="348.87" data-end="351.18">tree as they are running through the</span> </p>
<p><span data-start="351.18" data-end="356.039">HTML text for quick loading pages this</span> <span data-start="356.039" data-end="358.11">happens once and then you get a layout</span> <span data-start="358.11" data-end="360.75">in a draw for slow loading pages only</span> <span data-start="360.75" data-end="364.02">how the page will be loaded and then you</span> <span data-start="364.02" data-end="365.789">already want to draw something to the</span> <span data-start="365.789" data-end="368.76">screen so you get this partial Dom tree</span> <span data-start="368.76" data-end="370.62">is laid out and then later on the</span> <span data-start="370.62" data-end="372.51">parsing process continues adding notes</span> <span data-start="372.51" data-end="375.3">at some point real layouts it throws it</span> <span data-start="375.3" data-end="377.52">again maybe continues until it has parse</span> <span data-start="377.52" data-end="381.09">the whole document there's also things</span> <span data-start="381.09" data-end="385.11">like for example the hover pseudo class</span> <span data-start="385.11" data-end="386.22">when you're moving your mouse through</span> <span data-start="386.22" data-end="389.97">the documents at any point styling can</span> <span data-start="389.97" data-end="395.38">changed which can if you write specific</span> </p>
<p><span data-start="395.39" data-end="398.31">CSS rules can change the actual size of</span> <span data-start="398.31" data-end="401.48">elements can cause real layouts of</span> <span data-start="401.48" data-end="404.37">arbitrary parts of the document and of</span> <span data-start="404.37" data-end="408.44">course Crips tends to change the DOM and</span> <span data-start="408.44" data-end="411.18">expect that it will be immediately</span> <span data-start="411.18" data-end="414.12">reedus played in the correct way so if</span> <span data-start="414.12" data-end="416.4">we have a small demonstration document I</span> <span data-start="416.4" data-end="420.57">can demonstrate layout dependencies</span> <span data-start="420.57" data-end="423.81">between nodes if I were to add a little</span> <span data-start="423.81" data-end="428.68">inline notes somewhere in this document</span> <span data-start="428.69" data-end="431.19">well one thing is clear this paragraph</span> <span data-start="431.19" data-end="433.41">that I'm changing has to be line broken</span> <span data-start="433.41" data-end="438.21">again it might drop down another line</span> <span data-start="438.21" data-end="440.76">and thereby change it hate causing the</span> <span data-start="440.76" data-end="444.6">next paragraph to be shifted down but</span> <span data-start="444.6" data-end="446.67">for example the title and the sidebar</span> <span data-start="446.67" data-end="449.28">and the paragraph above it are never</span> <span data-start="449.28" data-end="452.3">affected by a reflow of this paragraph</span> <span data-start="452.3" data-end="454.68">so the browser should optimize this and</span> <span data-start="454.68" data-end="457.26">don't actually even touch these these</span> <span data-start="457.26" data-end="462.15">notes during this reflow also this</span> <span data-start="462.15" data-end="465.63">paragraph down here it might move down</span> <span data-start="465.63" data-end="468.81">but this never has to be realigned</span> <span data-start="468.81" data-end="471.51">broken its width chain it width doesn't</span> <span data-start="471.51" data-end="474.69">change so it's a very fast process it's</span> <span data-start="474.69" data-end="477.66">just moves down a bit if it doesn't</span> <span data-start="477.66" data-end="479.43">actually happen here but if this would</span> <span data-start="479.43" data-end="481.86">cause this paragraph to get a different</span> <span data-start="481.86" data-end="485.97">head if there were more things below say</span> <span data-start="485.97" data-end="488.1">a further then those would also depend</span> <span data-start="488.1" data-end="494.19">on on the size of of this paragraph even</span> <span data-start="494.19" data-end="495.84">though they are not siblings of your</span> <span data-start="495.84" data-end="499.32">children of this paragraph so it's a</span> <span data-start="499.32" data-end="502.59">kind of in order dependency everything</span> <span data-start="502.59" data-end="504.75">that comes after it goes out in an</span> <span data-start="504.75" data-end="508.11">inorder work of the layout tree might be</span> <span data-start="508.11" data-end="511.76">affected by a size change of this</span> <span data-start="511.76" data-end="517.55">specific node</span> <span data-start="517.56" data-end="521.38">so what that means is that manipulating</span> <span data-start="521.38" data-end="522.94">things that are positioned absolutely</span> <span data-start="522.94" data-end="525.82">which is out of the tree is typically</span> <span data-start="525.82" data-end="528.16">crazy fast because there are no</span> <span data-start="528.16" data-end="530.17">dependencies on other parts and there</span> <span data-start="530.17" data-end="532.48">are no other parts that depends on</span> <span data-start="532.48" data-end="535.96">absolutely positioned knows similarly</span> <span data-start="535.96" data-end="541.54">changing things like a color or CSS</span> <span data-start="541.54" data-end="545.32">transform or visibility hidden didn't</span> <span data-start="545.32" data-end="548.08">cause any real layout it causes a redraw</span> <span data-start="548.08" data-end="550.57">of this node but the rest of the</span> <span data-start="550.57" data-end="553.33">documents doesn't change position or</span> <span data-start="553.33" data-end="556.69">size depending on this node so that's</span> <span data-start="556.69" data-end="559.92">sufficient on the other hand changing</span> <span data-start="559.92" data-end="563.08">adding or removing things especially in</span> <span data-start="563.08" data-end="566.05">big documents in the flow of the</span> <span data-start="566.05" data-end="573.26">document can be arbitrarily expensive</span> <span data-start="573.27" data-end="576.7">one thing that's a very important part</span> <span data-start="576.7" data-end="578.85">of how brush optimize this is that they</span> <span data-start="578.85" data-end="583.27">reflow a document lazily they try they</span> <span data-start="583.27" data-end="585.01">don't immediately when a script touches</span> <span data-start="585.01" data-end="585.97">something they don't immediately</span> <span data-start="585.97" data-end="588.94">recompute a layout but they mark all the</span> <span data-start="588.94" data-end="590.89">notes that might potentially be affected</span> <span data-start="590.89" data-end="593.5">by the change as dirty and then when the</span> <span data-start="593.5" data-end="595.72">script finishes in the optimal cases</span> <span data-start="595.72" data-end="597.25">only when the strip's finishes do they</span> <span data-start="597.25" data-end="601.44">relay out every single dirty note</span> <span data-start="601.44" data-end="604">usually if the script makes a bunch of</span> <span data-start="604" data-end="605.92">changes there's a huge amount of overlap</span> <span data-start="605.92" data-end="608.05">in the layout work that has to be</span> <span data-start="608.05" data-end="610.87">repeated so if you only do it once</span> <span data-start="610.87" data-end="614.95">you're saving yourself ninety-nine</span> <span data-start="614.95" data-end="618.22">percent of the work one interesting case</span> <span data-start="618.22" data-end="620.77">here is that scripts can read layout</span> <span data-start="620.77" data-end="622.12">information for example through</span> <span data-start="622.12" data-end="624.91">properties like offset top or computed</span> <span data-start="624.91" data-end="628.33">style that with if you're doing getting</span> <span data-start="628.33" data-end="630.25">your script you're forcing a layout if</span> <span data-start="630.25" data-end="633.31">the note that you're reading is dirty so</span> <span data-start="633.31" data-end="636.97">the worst case is a loop that's changing</span> <span data-start="636.97" data-end="638.72">the DOM and then reading</span> <span data-start="638.72" data-end="640.55">layout information from the dome again</span> <span data-start="640.55" data-end="642.949">it will be forcing a layout on every</span> <span data-start="642.949" data-end="646.819">iteration and you can make huge huge</span> <span data-start="646.819" data-end="649.73">time savings by somehow rewriting your</span> <span data-start="649.73" data-end="652.759">code to not do this to minimize layout</span> <span data-start="652.759" data-end="655.939">round trips for assembling code mirror</span> <span data-start="655.939" data-end="658.699">at some point this editor there was code</span> <span data-start="658.699" data-end="662.209">that was building a line number bar on</span> <span data-start="662.209" data-end="664.85">the side by I wanted to ensure that</span> <span data-start="664.85" data-end="667.279">there were enough line numbers to cover</span> <span data-start="667.279" data-end="670.25">the actual health of the contents so it</span> <span data-start="670.25" data-end="672.889">was adding an out checking the health of</span> <span data-start="672.889" data-end="676.459">the line number bar if it was high</span> <span data-start="676.459" data-end="678.05">enough it stopped if not it added the</span> <span data-start="678.05" data-end="680.029">next note this could take for a few</span> <span data-start="680.029" data-end="683.48">thousand lines seconds of freezing the</span> <span data-start="683.48" data-end="687.41">browser completely by rewriting it to be</span> <span data-start="687.41" data-end="690.1">a little more clever like checking</span> <span data-start="690.1" data-end="692.6">computing the amount of notes it needed</span> <span data-start="692.6" data-end="695.269">in advance and just adding them without</span> <span data-start="695.269" data-end="697.67">reading it it took three milliseconds I</span> <span data-start="697.67" data-end="700.85">think so you can really get order of</span> <span data-start="700.85" data-end="705.29">magnitude increases by by being careful</span> <span data-start="705.29" data-end="706.879">about it even if it means building up</span> <span data-start="706.879" data-end="709.189">big data structures to catch some data</span> <span data-start="709.189" data-end="711.29">that you don't want to read during your</span> <span data-start="711.29" data-end="717.17">dom manipulation a very important aspect</span> <span data-start="717.17" data-end="720.769">of drawing is of drawing a dom is making</span> <span data-start="720.769" data-end="724.129">as much use of the hardware of the video</span> <span data-start="724.129" data-end="728.42">hardware as possible because in almost</span> <span data-start="728.42" data-end="731.089">every current machine drawing things to</span> <span data-start="731.089" data-end="733.189">video hardware is much much faster than</span> <span data-start="733.189" data-end="736.939">drawing in software this comes starts</span> <span data-start="736.939" data-end="738.23">with simple things like if you're</span> <span data-start="738.23" data-end="739.459">drawing something with a blue background</span> <span data-start="739.459" data-end="742.04">you using the video hardware tube little</span> <span data-start="742.04" data-end="744.17">blue rectangle instead of letting all</span> <span data-start="744.17" data-end="749.209">the bits yourself but it gets much more</span> <span data-start="749.209" data-end="750.92">advanced for example at Mozilla is</span> <span data-start="750.92" data-end="752.509">currently moving towards I think other</span> <span data-start="752.509" data-end="754.1">browsers are doing similar things but I</span> <span data-start="754.1" data-end="757.309">don't know the details is a system that</span> <span data-start="757.309" data-end="760.04">detects it divides the rendering tree in</span> <span data-start="760.04" data-end="762.67">two layers wear layers are things that</span> <span data-start="762.67" data-end="765.29">have a fixed relative position to each</span> <span data-start="765.29" data-end="770.74">other in regard to scrolling and to</span> <span data-start="770.74" data-end="776.899">animation so that for example in a very</span> <span data-start="776.899" data-end="779.36">simple document everything has a fixed</span> <span data-start="779.36" data-end="781.55">position compared to each other if there</span> <span data-start="781.55" data-end="783.589">are no fixed background your fixed</span> <span data-start="783.589" data-end="787.37">elements no internal scrolling diffs</span> <span data-start="787.37" data-end="790.339">then the whole document is basically one</span> <span data-start="790.339" data-end="793.22">picture that doesn't move accepts for</span> <span data-start="793.22" data-end="796.88">script changes or style changes so you</span> <span data-start="796.88" data-end="798.41">can render this to an off-screen buffer</span> <span data-start="798.41" data-end="801.44">and then just let the video hardware</span> <span data-start="801.44" data-end="803.72">blitz as you're scrolling blitz this</span> <span data-start="803.72" data-end="806.63">buffer at different different positions</span> <span data-start="806.63" data-end="810.29">and this is probably the fastest way to</span> <span data-start="810.29" data-end="812.51">do scrolling because there are no round</span> <span data-start="812.51" data-end="816.079">trips to actual Dom elements happening</span> <span data-start="816.079" data-end="817.85">you don't need to walk your tree and</span> <span data-start="817.85" data-end="819.589">draw the elements individually you just</span> <span data-start="819.589" data-end="823.209">build up this buffer once and I'm bladed</span> <span data-start="823.209" data-end="825.889">this even works for more complicated</span> <span data-start="825.889" data-end="827.63">things so you have a fixed background</span> <span data-start="827.63" data-end="830.149">you're scrolling transparent notes over</span> <span data-start="830.149" data-end="834.079">that if you create a layer I'm not sure</span> <span data-start="834.079" data-end="836.99">if Mozilla does this at the moment if</span> <span data-start="836.99" data-end="839.6">firefox is at the moment but it's</span> <span data-start="839.6" data-end="843.14">something that they're hoping to do you</span> <span data-start="843.14" data-end="844.43">can create a layer that's partially</span> <span data-start="844.43" data-end="848.12">transparent with an alpha channel and</span> <span data-start="848.12" data-end="850.1">just bleed that over your background</span> <span data-start="850.1" data-end="853.16">during scrolling which is still a much</span> <span data-start="853.16" data-end="857.149">much more much much faster than building</span> <span data-start="857.149" data-end="860.149">up your tree note by note as you doing</span> <span data-start="860.149" data-end="865.82">your your scroll another thing is of</span> <span data-start="865.82" data-end="867.89">course 3d transforms see as a 3d</span> <span data-start="867.89" data-end="870.22">transforms are pretty much defined as</span> <span data-start="870.22" data-end="873.89">video card operations so you draw your</span> <span data-start="873.89" data-end="876.29">buffer and then once and then you let</span> <span data-start="876.29" data-end="879.11">the video card handle the</span> <span data-start="879.11" data-end="881.87">transformations which is why they are</span> <span data-start="881.87" data-end="885.649">often faster than 2d transforms even</span> <span data-start="885.649" data-end="890.48">though they do almost the same thing one</span> <span data-start="890.48" data-end="892.55">thing i glossed over before is that</span> <span data-start="892.55" data-end="896.01">before you can do any layout or</span> <span data-start="896.01" data-end="898.5">is that you need to resolve all the</span> <span data-start="898.5" data-end="900.96">styles for every note there's actually</span> <span data-start="900.96" data-end="905.34">non-trivial because there are usually a</span> <span data-start="905.34" data-end="907.44">lot of styles and a lot of notes and</span> <span data-start="907.44" data-end="910.98">matching a style style rule against an</span> <span data-start="910.98" data-end="913.38">actual Dom node is not a trivial</span> <span data-start="913.38" data-end="917.28">president might require walking up the</span> </p>
<p><span data-start="917.28" data-end="919.71">Dom tree to ancestors it might even</span> <span data-start="919.71" data-end="921.57">require backtracking if you have long</span> <span data-start="921.57" data-end="927.21">chains of ancestor rules the naive</span> <span data-start="927.21" data-end="931.95">algorithm would be have complexity to</span> <span data-start="931.95" data-end="933.57">the number of notes times the number of</span> <span data-start="933.57" data-end="936.87">rules so if we look at some nodes and</span> <span data-start="936.87" data-end="940.44">rule counts of some popular size you're</span> <span data-start="940.44" data-end="943.71">saying that if you do an algorithm like</span> <span data-start="943.71" data-end="946.26">that for example Twitter would require</span> <span data-start="946.26" data-end="950.73">10 million rule matches um which is</span> <span data-start="950.73" data-end="952.77">doable I guess 10 million isn't that</span> <span data-start="952.77" data-end="955.23">much but which would definitely be a</span> <span data-start="955.23" data-end="959.76">waste of resources so there's actually a</span> <span data-start="959.76" data-end="962.13">pretty simple trick to to greatly reduce</span> <span data-start="962.13" data-end="964.11">the amount of raw matches that have to</span> <span data-start="964.11" data-end="967.23">be done I think most browsers do it I</span> <span data-start="967.23" data-end="969.69">know WebKit and Firefox do it like that</span> </p>
<p><span data-start="969.69" data-end="972.63">I expect most do something similar it</span> <span data-start="972.63" data-end="978.75">involves buckets say you have you index</span> <span data-start="978.75" data-end="981.93">all your rules after you're loading your</span> <span data-start="981.93" data-end="986.73">your style sheet by the rightmost</span> <span data-start="986.73" data-end="992.19">selector of the rule each rule ends up</span> <span data-start="992.19" data-end="994.98">in one and only one of four buckets if</span> <span data-start="994.98" data-end="997.98">the right mode selector has a has an ID</span> <span data-start="997.98" data-end="1000.47">then it ends up in the first buckets</span> <span data-start="1000.47" data-end="1003.89">indexed by ID it was a class its index</span> <span data-start="1003.89" data-end="1006.89">black claws into the second bucket if it</span> <span data-start="1006.89" data-end="1009.02">doesn't have closer ID it's indexed by</span> <span data-start="1009.02" data-end="1011.39">tag name in the third bucket if it has</span> <span data-start="1011.39" data-end="1013.76">neither of this tree then served in the</span> <span data-start="1013.76" data-end="1015.52">last bucket which is actually a list</span> <span data-start="1015.52" data-end="1019.75">another hash table now if you need to</span> <span data-start="1019.75" data-end="1023.87">find all applicable rules for a specific</span> <span data-start="1023.87" data-end="1026.72">note if first you check whether it has</span> <span data-start="1026.72" data-end="1028.169">an ID if it does you look and</span> </p>
<p><span data-start="1028.169" data-end="1030.449">I did bucket for each of his classes you</span> <span data-start="1030.449" data-end="1034.079">look in the class bucket you then always</span> <span data-start="1034.079" data-end="1037.1">look in the node name buckets for</span> <span data-start="1037.1" data-end="1039.899">fetching all the rules that apply to</span> <span data-start="1039.899" data-end="1042.149">this node name and you always have to</span> <span data-start="1042.149" data-end="1044.189">walk over all the notes in the last</span> <span data-start="1044.189" data-end="1046.409">bucket because they can't be</span> <span data-start="1046.409" data-end="1050.129">meaningfully indexed this cuts down the</span> <span data-start="1050.129" data-end="1052.019">amount of rules that you have to look at</span> <span data-start="1052.019" data-end="1058.259">by several orders of magnitude so then</span> <span data-start="1058.259" data-end="1059.85">you have to once you've found all</span> <span data-start="1059.85" data-end="1061.529">applicable rules you have to sort them</span> <span data-start="1061.529" data-end="1065.429">by by relevance by specific specificity</span> </p>
<p><span data-start="1065.429" data-end="1069.21">CSS defines that a scoring scheme for</span> <span data-start="1069.21" data-end="1073.58">rules we're more specific rules take</span> <span data-start="1073.58" data-end="1075.749">precedence over other ones so there's</span> <span data-start="1075.749" data-end="1077.669">always some sorting involved is multiple</span> <span data-start="1077.669" data-end="1081.809">rules match in general you want to</span> <span data-start="1081.809" data-end="1083.7">minimize the amount of rules that end up</span> <span data-start="1083.7" data-end="1089.129">in this rest buckets so well did I guess</span> <span data-start="1089.129" data-end="1091.259">only pathological style sheets have a</span> <span data-start="1091.259" data-end="1094.769">lot of these because you don't typically</span> <span data-start="1094.769" data-end="1096.749">define something for all hover elements</span> <span data-start="1096.749" data-end="1100.289">or only by attribute selector but I</span> <span data-start="1100.289" data-end="1102.72">guess you could do that and yeah that's</span> <span data-start="1102.72" data-end="1106.98">something to to be wary of also helps a</span> <span data-start="1106.98" data-end="1109.049">lot to use for example the parent</span> <span data-start="1109.049" data-end="1111.149">selector the greater than sign instead</span> <span data-start="1111.149" data-end="1113.279">of simply the ancestor selector and</span> <span data-start="1113.279" data-end="1115.919">social selector requires a walk all the</span> <span data-start="1115.919" data-end="1118.71">way to the top of the Dom tree to</span> <span data-start="1118.71" data-end="1120.57">determine whether something matches the</span> <span data-start="1120.57" data-end="1122.639">ancestor select the apparent selector</span> <span data-start="1122.639" data-end="1131.159">only requires a single step but yeah on</span> <span data-start="1131.159" data-end="1134.609">the whole my experience is that is</span> <span data-start="1134.609" data-end="1137.73">actually pretty rare to write something</span> <span data-start="1137.73" data-end="1140.85">that has a serious problem with style</span> <span data-start="1140.85" data-end="1145.169">matching on a modern browser that was</span> <span data-start="1145.169" data-end="1148.95">all I'd like to answer questions or</span> <span data-start="1148.95" data-end="1153.059">receive Corrections or feedback if</span> <span data-start="1153.059" data-end="1164.849">anyone has something</span> <span data-start="1164.859" data-end="1169.879">work test alone you said that you were</span> <span data-start="1169.879" data-end="1172.309">saying that 2d transforms are slower</span> <span data-start="1172.309" data-end="1174.919">than 3d transforms okay I'm wondering</span> <span data-start="1174.919" data-end="1176.779">why because until he transforms our</span> <span data-start="1176.779" data-end="1179.979">layers the same as 3d transforms but</span> <span data-start="1179.979" data-end="1182.33">those layers depend on a renderer</span> <span data-start="1182.33" data-end="1185.899">implementation right sorry yes these</span> <span data-start="1185.899" data-end="1188.899">transforms and how does that apply for</span> <span data-start="1188.899" data-end="1190.909">example on Android and the old androids</span> <span data-start="1190.909" data-end="1192.889">you have an amateur implementation at</span> <span data-start="1192.889" data-end="1194.299">left on top is the same as using</span> <span data-start="1194.299" data-end="1196.909">transforms because translate and</span> <span data-start="1196.909" data-end="1198.95">translate 3d I only met to those</span> <span data-start="1198.95" data-end="1201.109">functions on the render implementation</span> <span data-start="1201.109" data-end="1203.299">and I was wondering why you said that</span> <span data-start="1203.299" data-end="1205.459">you transfer eyes overall are faster</span> <span data-start="1205.459" data-end="1207.469">than everything you guys at fact I've</span> <span data-start="1207.469" data-end="1208.609">been wondering the saying I've been</span> <span data-start="1208.609" data-end="1209.869">trying to get an answer to that last</span> <span data-start="1209.869" data-end="1211.879">night because I figured this question</span> <span data-start="1211.879" data-end="1215.059">would come up and I didn't get a</span> <span data-start="1215.059" data-end="1217.669">satisfactory answer if someone here</span> <span data-start="1217.669" data-end="1219.739">knows I'd love to hear it my current</span> <span data-start="1219.739" data-end="1223.249">interpretation is that it 2d transform</span> <span data-start="1223.249" data-end="1225.829">requires the actual like polygons the</span> <span data-start="1225.829" data-end="1228.95">actual parts of the individual elements</span> <span data-start="1228.95" data-end="1232.399">to be drawn in the transforms way being</span> <span data-start="1232.399" data-end="1236.659">more precise than drawing them in the</span> <span data-start="1236.659" data-end="1238.579">untransformed ynn letting the hardware</span> <span data-start="1238.579" data-end="1240.469">treat that as a texture that it</span> <span data-start="1240.469" data-end="1242.959">transforms but I'm not sure whether this</span> <span data-start="1242.959" data-end="1248.629">is correct ok sorry does ok well I got</span> <span data-start="1248.629" data-end="1250.82">the answer but I was only asking for</span> <span data-start="1250.82" data-end="1253.849">well I wanted to clear up and 3d</span> <span data-start="1253.849" data-end="1256.459">transforms a lot faster on the overall</span> <span data-start="1256.459" data-end="1258.829">and they are faster on different</span> <span data-start="1258.829" data-end="1261.049">implementations on a GPU layer right and</span> <span data-start="1261.049" data-end="1263.179">it depends on how to render itself and</span> <span data-start="1263.179" data-end="1264.049">that is running in the background</span> <span data-start="1264.049" data-end="1266.389">process the render tree is scared of</span> <span data-start="1266.389" data-end="1268.609">course if you don't have 3d hardware and</span> <span data-start="1268.609" data-end="1270.619">for example you can use some left top</span> <span data-start="1270.619" data-end="1272.359">and Z index which is the pre bleh out</span> <span data-start="1272.359" data-end="1274.339">property and its overall faster than</span> <span data-start="1274.339" data-end="1276.409">using 2d transforms or 3d transforms</span> <span data-start="1276.409" data-end="1278.749">because her they are only the same</span> <span data-start="1278.749" data-end="1279.96">function but maps</span> <span data-start="1279.96" data-end="1283.2">yeah okay if only wanted to create up</span> <span data-start="1283.2" data-end="1293.97">okay hey thanks anyone else guess not</span> </p>
</section>