<section>
<p><span data-start="0.03" data-end="3.99">so hello everybody I'm really exciting</span> <span data-start="3.99" data-end="8.37">to be here and to talk about how browser</span> <span data-start="8.37" data-end="10.469">makers are making brother fast and I</span> <span data-start="10.469" data-end="14.13">will use Firefox quantum as an example</span> <span data-start="14.13" data-end="19.47">of how browser vendors are modifying the</span> <span data-start="19.47" data-end="22.97">browser to cope with the 21st century</span> <span data-start="22.97" data-end="26.939">most of the things that I'm about to say</span> <span data-start="26.939" data-end="29.07">is also valid for a lot of other</span> <span data-start="29.07" data-end="31.38">browsers but I'm taking the example of</span> </p>
<p><span data-start="31.38" data-end="37.559">Firefox content so I'm George Bailey I'm</span> <span data-start="37.559" data-end="40.2">part of developer outreach at Mozilla</span> <span data-start="40.2" data-end="44.76">and I have a Twitter account so the</span> <span data-start="44.76" data-end="47.489">story starts a little bit with how a</span> <span data-start="47.489" data-end="49.44">computer works so at the core of the</span> <span data-start="49.44" data-end="51.62">computer there is a processor and</span> <span data-start="51.62" data-end="56.28">processors have evolved over the years</span> <span data-start="56.28" data-end="59.699">very quickly initially in the 70s 80s</span> <span data-start="59.699" data-end="63.09">90s of last century there was something</span> <span data-start="63.09" data-end="66.33">called the more low that was basically</span> <span data-start="66.33" data-end="69.15">saying that every two years or every</span> <span data-start="69.15" data-end="73.619">three years your computer becomes twice</span> <span data-start="73.619" data-end="77.04">as fast as previous which was very</span> <span data-start="77.04" data-end="80.159">convenient for people making programs</span> <span data-start="80.159" data-end="82.5">and browser in particular because you do</span> <span data-start="82.5" data-end="84.869">nothing and two or three years later</span> <span data-start="84.869" data-end="87.54">your browser is twice as fast it's kind</span> <span data-start="87.54" data-end="92.84">of free lunch lately at the beginning</span> <span data-start="92.84" data-end="96.71">was second decade of this 21st century</span> <span data-start="96.71" data-end="100.5">people are seeing that processor or not</span> </p>
<p><span data-start="100.5" data-end="102.21">I'm not really doubling the speed</span> <span data-start="102.21" data-end="106.32">anymore each 2 or 3 years it's still a</span> <span data-start="106.32" data-end="108.619">little bit true for the high end</span> <span data-start="108.619" data-end="112.409">processors but in fact it doesn't really</span> <span data-start="112.409" data-end="114.689">matter for somewhere because we are no</span> <span data-start="114.689" data-end="116.969">more in a point where we want the web to</span> <span data-start="116.969" data-end="120">run only on the high end processor most</span> <span data-start="120" data-end="122.579">of the time you want it to run on such</span> <span data-start="122.579" data-end="126.42">device and it's not the latest the most</span> <span data-start="126.42" data-end="128.61">powerful processor in it because as the</span> <span data-start="128.61" data-end="132.4">battery will just last 5 minutes so</span> <span data-start="132.4" data-end="135.12">processor has found a different way to</span> <span data-start="135.12" data-end="139.51">increase the calculation power and it's</span> <span data-start="139.51" data-end="141.7">by having more calls</span> <span data-start="141.7" data-end="144.84">so more processing power in parallel and</span> <span data-start="144.84" data-end="147.31">the difference here is there is no free</span> <span data-start="147.31" data-end="149.709">lunch program has to adapt themselves</span> <span data-start="149.709" data-end="152.56">and to make use of this multiple course</span> <span data-start="152.56" data-end="154.599">of this concurrency that is now</span> <span data-start="154.599" data-end="163">available at the same time on two</span> <span data-start="163" data-end="165.489">browsers what we want browsers to do has</span> <span data-start="165.489" data-end="168.579">changed over the years so at the</span> <span data-start="168.579" data-end="170.139">beginning it was just displaying a</span> <span data-start="170.139" data-end="172.87">document and even in 2005 if you were</span> <span data-start="172.87" data-end="174.67">able to put a few images and making</span> <span data-start="174.67" data-end="177.43">rounded corner or on the box</span> <span data-start="177.43" data-end="180.7">you were top-notch developer it's not</span> <span data-start="180.7" data-end="184.42">the case anymore today and what we want</span> <span data-start="184.42" data-end="189.06">today is to have HD videos running with</span> <span data-start="189.06" data-end="193.079">transparency effect with rotations and</span> <span data-start="193.079" data-end="196.359">you want all these to run at 60 frames</span> <span data-start="196.359" data-end="199.54">per second you want all these to run on</span> <span data-start="199.54" data-end="202.629">your virtual reality headset which means</span> <span data-start="202.629" data-end="204.16">that in fact you need more than 60</span> <span data-start="204.16" data-end="205.629">frames per second because if you want</span> <span data-start="205.629" data-end="208.51">with a virtual reality headset not to be</span> <span data-start="208.51" data-end="211">to have motion sickness you need at</span> <span data-start="211" data-end="213.909">least 80 if not 100 100 frames per</span> <span data-start="213.909" data-end="217.989">second in order to achieve this in order</span> <span data-start="217.989" data-end="221.319">to cope with this browser had to adapt</span> <span data-start="221.319" data-end="223.87">they were designed in the 80s and the</span> <span data-start="223.87" data-end="225.79">80s and mostly at the beginning of the</span> <span data-start="225.79" data-end="227.949">90s even if they have evolved of the</span> <span data-start="227.949" data-end="231.01">years it's not the same architecture</span> <span data-start="231.01" data-end="235.93">that is able to run so modern web so</span> <span data-start="235.93" data-end="238.659">this story today is about telling you</span> <span data-start="238.659" data-end="241.479">what browser vendors are doing in order</span> <span data-start="241.479" data-end="243.159">to make your website view web</span> <span data-start="243.159" data-end="245.799">application faster even without you</span> <span data-start="245.799" data-end="251.109">having to do anything the browser is a</span> <span data-start="251.109" data-end="255.04">user agent and in 2008 we used this</span> <span data-start="255.04" data-end="258.039">robot for the launch and 543 it's a</span> <span data-start="258.039" data-end="261.669">friendly robot but of course over the</span> <span data-start="261.669" data-end="265.389">next decade it looks a little bit clunky</span> <span data-start="265.389" data-end="266.38">is it still</span> <span data-start="266.38" data-end="270.94">user agent that we want to have on the</span> <span data-start="270.94" data-end="274.96">web so the question is what a modern</span> <span data-start="274.96" data-end="283.9">browser is doing in 2018 sorry first</span> <span data-start="283.9" data-end="287.74">part is how does a web browser work and</span> <span data-start="287.74" data-end="290.95">especially the rendering engine so this</span> <span data-start="290.95" data-end="292.63">is quite important to understand a</span> <span data-start="292.63" data-end="294.1">little bit so that you understand what</span> <span data-start="294.1" data-end="297.43">changes are happening so the first thing</span> <span data-start="297.43" data-end="300.58">is your browser is downloading pages its</span> <span data-start="300.58" data-end="302.59">request handle on the web and it gets</span> </p>
<p><span data-start="302.59" data-end="306.34">HTML the JavaScript the CSS files and</span> <span data-start="306.34" data-end="309.49">just pass all these into an HTML parser</span> <span data-start="309.49" data-end="311.59">as a JavaScript engine the CSS parser</span> <span data-start="311.59" data-end="314.71">and what it does is to generate the Dom</span> <span data-start="314.71" data-end="318.64">of nodes so each time you modify the Dom</span> <span data-start="318.64" data-end="321.1">of nodes the whole process starts again</span> <span data-start="321.1" data-end="324.52">not downloading but what follow up so</span> <span data-start="324.52" data-end="327.13">with the CSS the first things to go in a</span> <span data-start="327.13" data-end="331.15">rendering engine is the stein engine the</span> <span data-start="331.15" data-end="334.84">styl engine take the CSS and applied and</span> <span data-start="334.84" data-end="338.41">define what rules are applied to each of</span> <span data-start="338.41" data-end="340.15">the boxes it doesn't apply them the yet</span> <span data-start="340.15" data-end="342.43">but you just defined what has a set of</span> <span data-start="342.43" data-end="346.56">rules that match each element of the Dom</span> <span data-start="346.56" data-end="349.39">when you have this you add all the media</span> <span data-start="349.39" data-end="352.33">so the images videos and you can know</span> <span data-start="352.33" data-end="354.88">the size of the images the size of the</span> <span data-start="354.88" data-end="356.98">videos and when you have this you have a</span> <span data-start="356.98" data-end="358.89">face that is a layout which is in fact</span> <span data-start="358.89" data-end="361.66">defining where on the page will be</span> <span data-start="361.66" data-end="365.14">displayed each of the boxes you have</span> <span data-start="365.14" data-end="367.36">several layers because they can be on</span> <span data-start="367.36" data-end="369.64">top of each others but you don't know</span> <span data-start="369.64" data-end="372.46">yet what is inside the layers and which</span> <span data-start="372.46" data-end="375.76">layer is winning the next step is a</span> <span data-start="375.76" data-end="379.78">paint so this is to apply texture on</span> <span data-start="379.78" data-end="382.18">each of the layers that will define okay</span> <span data-start="382.18" data-end="384.61">this texture is the video this texture</span> <span data-start="384.61" data-end="387.37">is the image this texture is just a</span> <span data-start="387.37" data-end="390.82">background or some text from this then</span> <span data-start="390.82" data-end="393.01">you have to define which pixels are</span> <span data-start="393.01" data-end="394.93">visible this is the next step and the</span> <span data-start="394.93" data-end="397.15">last step that is a compositor and then</span> <span data-start="397.15" data-end="400.08">you go to your page on the screen</span> <span data-start="400.08" data-end="402.78">and each time you modify the Dom you</span> <span data-start="402.78" data-end="404.22">have to go through this process again</span> <span data-start="404.22" data-end="407.669">for years and years browser have already</span> <span data-start="407.669" data-end="410.52">optimized this part by only redesigning</span> <span data-start="410.52" data-end="412.919">or redrawing the part of the page that</span> <span data-start="412.919" data-end="415.11">are actually modified when you change</span> <span data-start="415.11" data-end="417.87">the Dom and not the whole page but this</span> <span data-start="417.87" data-end="420.33">is really the big the big an important</span> <span data-start="420.33" data-end="426.24">element atmosphere in order to improve</span> <span data-start="426.24" data-end="429.69">this we wanted to test new algorithm and</span> <span data-start="429.69" data-end="431.669">we wanted especially to work on</span> <span data-start="431.669" data-end="433.919">parallelization so what we have done</span> <span data-start="433.919" data-end="435.599">first we have created a new language</span> <span data-start="435.599" data-end="439.71">called rust rust is replacing little by</span> <span data-start="439.71" data-end="442.25">little the different part of Firefox</span> <span data-start="442.25" data-end="445.469">written in C++ by by this language and</span> <span data-start="445.469" data-end="448.02">this language has been designed to make</span> <span data-start="448.02" data-end="453.8">the writing of of codes that can be</span> <span data-start="453.8" data-end="456.78">executed on multiple core on multiple</span> <span data-start="456.78" data-end="459.78">thread much much easier with less errors</span> <span data-start="459.78" data-end="463.259">than C++ and so that's really important</span> <span data-start="463.259" data-end="465.15">because a lot of people are contributing</span> <span data-start="465.15" data-end="468.15">to the code and if even if most people</span> <span data-start="468.15" data-end="470.43">are really good programmers they do Aero</span> <span data-start="470.43" data-end="473.27">but you can also get patches for</span> <span data-start="473.27" data-end="475.74">programmers that less experienced and</span> <span data-start="475.74" data-end="477.69">they will not do the basics common</span> <span data-start="477.69" data-end="482.33">errors we created then an experimental</span> <span data-start="482.33" data-end="485.639">engine and experimental browser called</span> <span data-start="485.639" data-end="488.37">servo it's written in rust</span> <span data-start="488.37" data-end="495.11">it has algorithm that take paradism and</span> <span data-start="495.11" data-end="498">that allows us to check if this</span> <span data-start="498" data-end="500.789">algorithm are very working very well and</span> <span data-start="500.789" data-end="503.729">also it has no significant UI it's not a</span> <span data-start="503.729" data-end="505.979">real browser it's something to test if</span> <span data-start="505.979" data-end="508.469">the idea we have are good or not and</span> <span data-start="508.469" data-end="510.389">finally and this is the most important</span> <span data-start="510.389" data-end="513.87">part servo can break the web so where is</span> <span data-start="513.87" data-end="516.899">a very complex piece and there is a lot</span> <span data-start="516.899" data-end="519.18">of special cases with special CSS</span> <span data-start="519.18" data-end="521.55">properties and so on and in fact to test</span> <span data-start="521.55" data-end="523.44">the algorithm you don't want to have to</span> <span data-start="523.44" data-end="526.35">write the engine in all the detail first</span> <span data-start="526.35" data-end="528.18">you won't first validate that in the</span> <span data-start="528.18" data-end="530.73">good case in the easy case you get the</span> <span data-start="530.73" data-end="533.7">speed improvements that you were you</span> <span data-start="533.7" data-end="538.29">to have so we did this several and we</span> <span data-start="538.29" data-end="543.81">developed a lot of things on it at the</span> <span data-start="543.81" data-end="546.36">same time we wanted to solve several</span> <span data-start="546.36" data-end="549.03">other problems so a firefox had a</span> <span data-start="549.03" data-end="551.01">stability problem we noticed over the</span> <span data-start="551.01" data-end="552.9">last few years that he was has a lot of</span> <span data-start="552.9" data-end="556.38">crashes and we were wondering why it has</span> <span data-start="556.38" data-end="558.42">an old theme so like the robots that</span> <span data-start="558.42" data-end="561">were loop is just looking old by just</span> <span data-start="561" data-end="565.38">having an old theme when the UI in OSS</span> <span data-start="565.38" data-end="567.09">has been improved</span> <span data-start="567.09" data-end="569.82">it feels slow and also there was a lot</span> <span data-start="569.82" data-end="571.95">of cases where in fact the user</span> <span data-start="571.95" data-end="573.81">interface was freezing</span> <span data-start="573.81" data-end="576.51">it's called UI young and finally we</span> <span data-start="576.51" data-end="578.34">wanted to increase to have the new</span> <span data-start="578.34" data-end="585.71">algorithm so we launched we launched a</span> <span data-start="585.71" data-end="590.55">project called quantum la the beginning</span> <span data-start="590.55" data-end="592.77">of last year and we decided we want to</span> <span data-start="592.77" data-end="594.72">make a quantum leap in performance and</span> <span data-start="594.72" data-end="600.02">in the way the website are rendered</span> <span data-start="600.02" data-end="602.07">there are several things that has been</span> <span data-start="602.07" data-end="604.59">done but the first thing and I want</span> <span data-start="604.59" data-end="606.03">first to thank my colleague 9 o'clock</span> <span data-start="606.03" data-end="613.02">who has drawn this amazing drawing I'm</span> <span data-start="613.02" data-end="616.65">absolutely unable unable to to make any</span> <span data-start="616.65" data-end="620.46">drawings that looks readable by anybody</span> <span data-start="620.46" data-end="623.52">so she's doing a lot of these drawings</span> <span data-start="623.52" data-end="625.68">she's writing blog post explaining how a</span> <span data-start="625.68" data-end="626.88">browser is working</span> <span data-start="626.88" data-end="629.97">there will be a link later that allow</span> <span data-start="629.97" data-end="631.95">you to have more information so the</span> <span data-start="631.95" data-end="633.66">first things that we have decided to do</span> <span data-start="633.66" data-end="637.47">is to change our Stan engine so the</span> <span data-start="637.47" data-end="640.2">style engine as I said take the</span> <span data-start="640.2" data-end="643.67">different CSS properties look at the</span> <span data-start="643.67" data-end="647.1">selectors at the specification and in</span> <span data-start="647.1" data-end="650.19">fact for each of the boxes define ok</span> <span data-start="650.19" data-end="652.71">these properties with this value apply</span> <span data-start="652.71" data-end="654.78">to this one for example the background</span> <span data-start="654.78" data-end="659.25">color of the text color as a font and so</span> <span data-start="659.25" data-end="662.43">on this is something that has to be done</span> <span data-start="662.43" data-end="665.76">to each and every boxes so this is at</span> <span data-start="665.76" data-end="667.53">first sight something that can be</span> <span data-start="667.53" data-end="671.76">use very easily to with a parallel with</span> <span data-start="671.76" data-end="677.37">paralyzation and so we tried it in rust</span> <span data-start="677.37" data-end="681.17">on style so basically we had several</span> <span data-start="681.17" data-end="684.12">processes several threads that takes</span> <span data-start="684.12" data-end="685.53">part of the tree and makes the</span> <span data-start="685.53" data-end="688.14">calculation and of course it's not that</span> <span data-start="688.14" data-end="691.32">easy because first you don't have one</span> <span data-start="691.32" data-end="694.26">thread one process per element on the</span> <span data-start="694.26" data-end="695.91">page because are sometimes several</span> <span data-start="695.91" data-end="699.51">thousand of them so you have to give</span> <span data-start="699.51" data-end="701.55">chunk of the page to each of the</span> <span data-start="701.55" data-end="704.1">processes so that means that some of</span> <span data-start="704.1" data-end="706.98">this process are just idle at some point</span> <span data-start="706.98" data-end="709.32">because there is nothing happening is I</span> <span data-start="709.32" data-end="710.88">finished their work while other may be</span> <span data-start="710.88" data-end="713.4">extremely busy so there is a very big</span> <span data-start="713.4" data-end="716.31">complex algorithm here that allows the</span> <span data-start="716.31" data-end="718.2">different threads or different processes</span> <span data-start="718.2" data-end="721.26">to still work from the other when they</span> <span data-start="721.26" data-end="728.21">are idle so with this we created and we</span> <span data-start="728.21" data-end="732.44">validated that's a new way of doing</span> <span data-start="732.44" data-end="736.11">styling in the browser is in fact much</span> <span data-start="736.11" data-end="739.2">much more efficient but that was only</span> <span data-start="739.2" data-end="740.97">the first step because this is in</span> <span data-start="740.97" data-end="743.339">several in the experimental browser we</span> <span data-start="743.339" data-end="745.53">needed to sort out all the detail and to</span> <span data-start="745.53" data-end="749.089">integrate this into the real browser and</span> <span data-start="749.089" data-end="751.38">integrating a new styling gene in a</span> <span data-start="751.38" data-end="753.83">browser it's a little bit like doing</span> <span data-start="753.83" data-end="757.86">heart surgery but with a person that is</span> <span data-start="757.86" data-end="759.089">still conscious</span> <span data-start="759.089" data-end="763.05">you you want to browser to continue to</span> <span data-start="763.05" data-end="765.39">work you don't want suddenly have no new</span> <span data-start="765.39" data-end="769.11">release for one year two years while you</span> <span data-start="769.11" data-end="772.23">put all the wire together so we took the</span> <span data-start="772.23" data-end="775.14">stylus or quantum CSS with a parallelism</span> <span data-start="775.14" data-end="777.57">we integrate it with a rule tree from</span> </p>
<p><span data-start="777.57" data-end="780.27">Firefox and also we took the staggering</span> <span data-start="780.27" data-end="783.21">cache from Chrome and Safari so the</span> <span data-start="783.21" data-end="787.11">start sharing cache just memorize things</span> <span data-start="787.11" data-end="788.52">you have already calculated because</span> <span data-start="788.52" data-end="790.589">sometimes on the page a lot of nodes</span> <span data-start="790.589" data-end="792.63">have the same ancestors and the same</span> <span data-start="792.63" data-end="797.04">values so it works pretty well in fact</span> <span data-start="797.04" data-end="798.6">it wasn't working that well anymore</span> <span data-start="798.6" data-end="801.18">because lately with all</span> <span data-start="801.18" data-end="803.67">you do classes and so on it became more</span> <span data-start="803.67" data-end="804.99">complex and there are less of these</span> <span data-start="804.99" data-end="809.22">elements that are there that were cashed</span> <span data-start="809.22" data-end="812.31">so we modified so start sharing cash in</span> <span data-start="812.31" data-end="816.09">orders for it to work again and then we</span> <span data-start="816.09" data-end="819.72">just transplanted stylo into the browser</span> <span data-start="819.72" data-end="822.39">and this happened last November in</span> </p>
<p><span data-start="822.39" data-end="825.39">Firefox 57 and we got for this spot a</span> <span data-start="825.39" data-end="829.2">very very large improvement in speed so</span> <span data-start="829.2" data-end="831.15">style is the first technology transfer</span> <span data-start="831.15" data-end="834.3">from several it's not the first part of</span> <span data-start="834.3" data-end="837.45">rust inside the browser and it is</span> <span data-start="837.45" data-end="839.37">solving a problem that is called</span> <span data-start="839.37" data-end="841.59">embarrassingly parallel problem by</span> <span data-start="841.59" data-end="844.23">definition style engine are doing</span> <span data-start="844.23" data-end="846.92">something that can be massively</span> <span data-start="846.92" data-end="851.55">paralyzed and of course when the page is</span> <span data-start="851.55" data-end="854.13">simple you see little improvement when</span> <span data-start="854.13" data-end="856.44">the page is very complex you see a lot</span> <span data-start="856.44" data-end="864.39">of improvement browser has another</span> <span data-start="864.39" data-end="868.29">challenge each time you click somewhere</span> <span data-start="868.29" data-end="871.19">on the browser there is an even handler</span> <span data-start="871.19" data-end="874.32">going on and firing and executing some</span> <span data-start="874.32" data-end="878.31">code and you want to be sure if you want</span> <span data-start="878.31" data-end="880.62">to have 60 frames per second or 120</span> <span data-start="880.62" data-end="883.23">frames per second that all that's</span> <span data-start="883.23" data-end="885.39">happening on the main thread and</span> <span data-start="885.39" data-end="888.6">especially these handlers happening is</span> <span data-start="888.6" data-end="891.66">no more than 16 millisecond or 8</span> <span data-start="891.66" data-end="894.81">millisecond for 120 frame per second so</span> <span data-start="894.81" data-end="896.22">that means that you have to go out of</span> <span data-start="896.22" data-end="898.14">the main straight as soon as possible</span> <span data-start="898.14" data-end="900">because while you're on the main thread</span> <span data-start="900" data-end="903.15">you cannot handle the next even so</span> </p>
<p><span data-start="903.15" data-end="905.43">Lex even when you are calling a page or</span> <span data-start="905.43" data-end="908.89">when you are clicking and so on</span> <span data-start="908.9" data-end="912.24">initially browser had everything on the</span> <span data-start="912.24" data-end="913.89">main thread and little by little over</span> <span data-start="913.89" data-end="916.17">the years I start to take things out so</span> <span data-start="916.17" data-end="918.42">first of of them is a video decoding</span> <span data-start="918.42" data-end="920.4">that is happening now most of the time</span> <span data-start="920.4" data-end="923.67">on the graphic cloud itself there was a</span> <span data-start="923.67" data-end="927.84">plugins also a display canvas worker and</span> <span data-start="927.84" data-end="929.76">several others but what is quite</span> <span data-start="929.76" data-end="932.76">interesting is</span> <span data-start="932.76" data-end="936.75">we have another piece of computer power</span> <span data-start="936.75" data-end="948.5">on a browser that is a GPU the GPU is</span> <span data-start="948.5" data-end="952.38">designed for games is designed for the</span> <span data-start="952.38" data-end="954.27">operating system where you have a lot of</span> <span data-start="954.27" data-end="957.96">calculation to do on a lot of data the</span> <span data-start="957.96" data-end="960.54">same operation on a very large amount of</span> <span data-start="960.54" data-end="963.21">data and it's very very efficient for</span> <span data-start="963.21" data-end="964.89">this kind of things it's very efficient</span> <span data-start="964.89" data-end="968.88">for gaming on the browser we have this</span> <span data-start="968.88" data-end="970.5">kind of operation one of them is a</span> <span data-start="970.5" data-end="973.68">compositing so the last bit of the</span> <span data-start="973.68" data-end="975.24">calculation where you have all the</span> <span data-start="975.24" data-end="977.16">layers and you have to define which one</span> <span data-start="977.16" data-end="978.45">are visible or not it's the same</span> <span data-start="978.45" data-end="980.94">operation most of the time on a lot of</span> <span data-start="980.94" data-end="985.61">data so we decided in 2016 to offload</span> <span data-start="985.61" data-end="988.53">the composition to the GPU and we did it</span> <span data-start="988.53" data-end="991.68">and improve a lot at the same time a</span> <span data-start="991.68" data-end="994.02">little bit later in fact we notice that</span> <span data-start="994.02" data-end="997.59">the crash is just increased we had a lot</span> <span data-start="997.59" data-end="1000.77">of crashes and in fact it wasn't the</span> <span data-start="1000.77" data-end="1002.42">browser itself that was buggy it was the</span> <span data-start="1002.42" data-end="1003.92">drivers that were Birdie</span> <span data-start="1003.92" data-end="1006.14">so the crash the crashes were mostly</span> <span data-start="1006.14" data-end="1008.51">happening on Windows and for example Mac</span> <span data-start="1008.51" data-end="1011.78">has very few few grush crashes because</span> <span data-start="1011.78" data-end="1014.93">of farlis type of divert for less types</span> <span data-start="1014.93" data-end="1019.07">of graphic cards and less bugs so we</span> <span data-start="1019.07" data-end="1020.93">decided last year to solve the crashes</span> <span data-start="1020.93" data-end="1025.339">by having the GPU in the graphic drivers</span> <span data-start="1025.339" data-end="1027.31">load in a different process so the</span> <span data-start="1027.31" data-end="1030.829">process crash the browser detected crash</span> <span data-start="1030.829" data-end="1033.44">it's restarted and then it works without</span> <span data-start="1033.44" data-end="1036.05">using the GPU for this part so you don't</span> <span data-start="1036.05" data-end="1038.48">have all the speed improvement of the</span> </p>
<p><span data-start="1038.48" data-end="1040.22">GPU but you don't have the crashes</span> <span data-start="1040.22" data-end="1042.35">either so that's a way we had to</span> <span data-start="1042.35" data-end="1047.63">mitigate the bugs in graphic drivers so</span> <span data-start="1047.63" data-end="1049.04">the compositor is the first part that</span> <span data-start="1049.04" data-end="1053.18">went to the GPU at the beginning of last</span> <span data-start="1053.18" data-end="1057.65">year another part is a painting so the</span> <span data-start="1057.65" data-end="1059.63">painting is to take a texture and to</span> <span data-start="1059.63" data-end="1061.64">apply it to the surface it's cool or</span> <span data-start="1061.64" data-end="1063.98">rasterization and we want to do the same</span> <span data-start="1063.98" data-end="1066.169">off-roading li2 GPU</span> <span data-start="1066.169" data-end="1068.989">and this is a project called WebRunner</span> <span data-start="1068.989" data-end="1071.379">it's not yet finished it's in progress</span> <span data-start="1071.379" data-end="1074.629">this is ultimate goal I don't know when</span> <span data-start="1074.629" data-end="1076.34">it will be finished because if you asks</span> <span data-start="1076.34" data-end="1078.619">management they say very soon and if you</span> <span data-start="1078.619" data-end="1081.019">ask the developers I say oh in several</span> <span data-start="1081.019" data-end="1081.379">years</span> <span data-start="1081.379" data-end="1085.499">so it's some somewhere in between</span> <span data-start="1085.509" data-end="1090.08">meanwhile we decided that okay even if</span> <span data-start="1090.08" data-end="1091.639">we don't send it to the GPU</span> <span data-start="1091.639" data-end="1094.999">we can remove it from the main thread so</span> <span data-start="1094.999" data-end="1097.1">we have what we call off main straight</span> <span data-start="1097.1" data-end="1098.57">painting just what's right for the</span> <span data-start="1098.57" data-end="1100.429">painting and this has been done in</span> </p>
<p><span data-start="1100.429" data-end="1104.059">Firefox 58 which went out in January so</span> <span data-start="1104.059" data-end="1108.259">basically we create a set of instruction</span> <span data-start="1108.259" data-end="1110.84">the display list that is applied to</span> <span data-start="1110.84" data-end="1114.109">assign to the layers and then we send it</span> <span data-start="1114.109" data-end="1116.629">to another process that rasterize which</span> <span data-start="1116.629" data-end="1121.009">is actual painting operation and then</span> <span data-start="1121.009" data-end="1123.169">sent to the compositor that is in its</span> <span data-start="1123.169" data-end="1128.21">own process or on the GPU and that way</span> <span data-start="1128.21" data-end="1130.909">as soon as the rasterization is no more</span> <span data-start="1130.909" data-end="1133.249">on the main thread so that means that</span> <span data-start="1133.249" data-end="1135.409">you can trace the next displaylist and</span> <span data-start="1135.409" data-end="1137.359">so on so we remove the bottleneck it's</span> <span data-start="1137.359" data-end="1139.249">not as perfect as having everything on</span> <span data-start="1139.249" data-end="1141.679">the GPU we still sometimes lose frames</span> <span data-start="1141.679" data-end="1143.929">when it's gone a lot of changes but much</span> <span data-start="1143.929" data-end="1145.669">less of it's no more the rasterization</span> <span data-start="1145.669" data-end="1149.69">the problem so this landed in Firefox 58</span> <span data-start="1149.69" data-end="1151.58">and there is an improvement coming the</span> <span data-start="1151.58" data-end="1154.159">next version into it where in fact we</span> <span data-start="1154.159" data-end="1156.019">discover that this Palast we don't need</span> <span data-start="1156.019" data-end="1158.629">to recalculate it each time for simple</span> <span data-start="1158.629" data-end="1161.119">but it's not the most efficient so now</span> <span data-start="1161.119" data-end="1163.489">we have you ristic in place so that we</span> <span data-start="1163.489" data-end="1165.499">don't recalculate so this play list was</span> <span data-start="1165.499" data-end="1170.639">a who loved the display list each time</span> <span data-start="1170.649" data-end="1173.69">so until now we have mostly seen</span> <span data-start="1173.69" data-end="1177.789">replacement of pieces of the browser and</span> <span data-start="1177.789" data-end="1180.649">in fact if you want to have a browser</span> <span data-start="1180.649" data-end="1184.389">that is efficient that feel quick</span> <span data-start="1184.389" data-end="1187.549">responsive you need to consider it as a</span> <span data-start="1187.549" data-end="1190.22">system as a whole because yes you can</span> <span data-start="1190.22" data-end="1192.619">have a very efficient style engine but</span> <span data-start="1192.619" data-end="1196.099">maybe the bottleneck is somewhere ads so</span> <span data-start="1196.099" data-end="1198.71">we changed a way to do development</span> <span data-start="1198.71" data-end="1201.61">and to prioritize the development masya</span> <span data-start="1201.61" data-end="1204.5">by having the moto measure all the</span> <span data-start="1204.5" data-end="1207.14">things then we triage we prioritize and</span> <span data-start="1207.14" data-end="1210.62">weary measure and we applied this and we</span> <span data-start="1210.62" data-end="1213.02">still apply this to fight young so</span> <span data-start="1213.02" data-end="1216.86">freeze in the UI and there is a</span> <span data-start="1216.86" data-end="1219.799">collection of 30 blog post by Asian act</span> </p>
<p><span data-start="1219.799" data-end="1222.86">Garin that explain all the changes that</span> <span data-start="1222.86" data-end="1224.539">happen all over the place it's it's</span> <span data-start="1224.539" data-end="1228.23">going on a lot of details and she calls</span> <span data-start="1228.23" data-end="1230.809">her name death by a million cuts we</span> <span data-start="1230.809" data-end="1233.84">found bugs where we had to fix ten bugs</span> <span data-start="1233.84" data-end="1237.26">and suddenly we get back a lot of time</span> <span data-start="1237.26" data-end="1239.45">each of the bug individually in the</span> <span data-start="1239.45" data-end="1241.789">individual fix were just shaving one</span> <span data-start="1241.789" data-end="1243.23">millisecond here there but no</span> <span data-start="1243.23" data-end="1244.94">significant difference but the ten</span> <span data-start="1244.94" data-end="1247.029">together we're leaving a lot of</span> <span data-start="1247.029" data-end="1250.669">differences so one of the things that we</span> <span data-start="1250.669" data-end="1252.2">change is a way we were doing is</span> <span data-start="1252.2" data-end="1254.35">crawling it's it's not specific to</span> <span data-start="1254.35" data-end="1256.789">Firefox at all and it has been pioneered</span> <span data-start="1256.789" data-end="1259.46">by Apple and it's called checkerboarding</span> <span data-start="1259.46" data-end="1263.149">you when you scroll on your screen with</span> <span data-start="1263.149" data-end="1267.049">a mouse with the finger you never want</span> <span data-start="1267.049" data-end="1270.08">to scroll to stop but sometimes it goes</span> <span data-start="1270.08" data-end="1272.33">too quick and you don't have the time to</span> <span data-start="1272.33" data-end="1274.279">calculate what to present to the screen</span> <span data-start="1274.279" data-end="1276.23">so you present a default value and</span> <span data-start="1276.23" data-end="1279.529">people instead of being confused scroll</span> <span data-start="1279.529" data-end="1283.039">less quickly the data appear the images</span> <span data-start="1283.039" data-end="1285.38">appear and initially it was a chick</span> <span data-start="1285.38" data-end="1286.09">abort</span> <span data-start="1286.09" data-end="1288.83">that's why it's called Chicka bowling so</span> <span data-start="1288.83" data-end="1292.149">the the X overall speed is not better</span> <span data-start="1292.149" data-end="1296.169">but the feeling is completely different</span> <span data-start="1296.169" data-end="1299.059">and those are big things that we have</span> <span data-start="1299.059" data-end="1301.96">changes what we call IPC inter-process</span> <span data-start="1301.96" data-end="1304.279">communication so it's known for a long</span> <span data-start="1304.279" data-end="1306.95">time that when you communicate for</span> <span data-start="1306.95" data-end="1309.47">example with a disc it takes a lot of</span> <span data-start="1309.47" data-end="1311.12">time and you don't want to do this on</span> <span data-start="1311.12" data-end="1314.929">the hub on the main thread it's the same</span> <span data-start="1314.929" data-end="1317.21">when you communicate with another</span> <span data-start="1317.21" data-end="1319.669">process especially if it's synchronous</span> <span data-start="1319.669" data-end="1322.46">communication you don't want to do this</span> <span data-start="1322.46" data-end="1325.159">on the main thread so we fight</span> <span data-start="1325.159" data-end="1327.049">synchronous communication and you want</span> <span data-start="1327.049" data-end="1328.639">it to have as many as synchronous</span> <span data-start="1328.639" data-end="1330.38">communication at all and this is where</span> <span data-start="1330.38" data-end="1332.15">we did a lot of merger and so on</span> <span data-start="1332.15" data-end="1334.19">there was for example two people working</span> <span data-start="1334.19" data-end="1337.73">for six months on the cookies because</span> <span data-start="1337.73" data-end="1341.69">cookies were needed a lot of synchronous</span> <span data-start="1341.69" data-end="1343.37">communication they rewrote completely</span> <span data-start="1343.37" data-end="1346.13">the cookie mechanism in Firefox and in</span> <span data-start="1346.13" data-end="1350.89">fact it was 25% of our block blocking on</span> <span data-start="1350.89" data-end="1353.9">inter process communication and on big</span> <span data-start="1353.9" data-end="1356.87">website when it was fixed like Facebook</span> <span data-start="1356.87" data-end="1360.14">is making several written write several</span> <span data-start="1360.14" data-end="1363.17">times per second to the cookie store in</span> <span data-start="1363.17" data-end="1367.22">this website like Twitter or Facebook we</span> <span data-start="1367.22" data-end="1370.1">were able to win in the order of the</span> <span data-start="1370.1" data-end="1373.82">second in the time we need to display</span> <span data-start="1373.82" data-end="1376.46">the page so as other offenders like</span> <span data-start="1376.46" data-end="1379.01">plugins but plugins are gone today</span> <span data-start="1379.01" data-end="1382.28">other traditional extension on Firefox</span> <span data-start="1382.28" data-end="1384.17">on Zul extension also we're on offender</span> <span data-start="1384.17" data-end="1389.03">so we had to define to decide to stop</span> <span data-start="1389.03" data-end="1395.12">having that there are plenty of other</span> <span data-start="1395.12" data-end="1397.13">things that we have done for example we</span> <span data-start="1397.13" data-end="1400.13">have changed some algorithm just till</span> <span data-start="1400.13" data-end="1403.34">efficient but they were already</span> <span data-start="1403.34" data-end="1405.68">efficient but in fact sometimes they</span> <span data-start="1405.68" data-end="1408.26">were not making usage good use of the</span> <span data-start="1408.26" data-end="1411.2">cache so we keep an algorithm with the</span> <span data-start="1411.2" data-end="1413.99">same complexity but that works better</span> <span data-start="1413.99" data-end="1416.3">with a cache for example and suddenly</span> <span data-start="1416.3" data-end="1418.85">you have an improvement of your</span> <span data-start="1418.85" data-end="1423.08">performance on complex pages that with</span> <span data-start="1423.08" data-end="1424.96">the same complexity of the algorithm</span> <span data-start="1424.96" data-end="1427.61">also the garbage collection so the part</span> <span data-start="1427.61" data-end="1430.73">that take back the memory has been</span> <span data-start="1430.73" data-end="1432.41">changed instead of having to do a</span> <span data-start="1432.41" data-end="1436.28">complete sweep or we can now do an</span> <span data-start="1436.28" data-end="1438.74">incremental sweep so we take a bit of</span> <span data-start="1438.74" data-end="1440.96">the memory we stop because we have only</span> <span data-start="1440.96" data-end="1443.15">a few milliseconds and then we continue</span> <span data-start="1443.15" data-end="1445.28">later so that means that the memory grow</span> <span data-start="1445.28" data-end="1447.68">a little bit but when the browser is</span> <span data-start="1447.68" data-end="1450.95">idle it go back to normal at the same</span> <span data-start="1450.95" data-end="1452.69">time we notice that memory that is used</span> <span data-start="1452.69" data-end="1456.41">on towards the end very quickly and so</span> <span data-start="1456.41" data-end="1459.41">on is the ones that usually is released</span> <span data-start="1459.41" data-end="1461.51">very quickly and what you have are done</span> </p>
<p><span data-start="1461.51" data-end="1464.39">I don't know two hours before usually</span> <span data-start="1464.39" data-end="1465.95">you will keep it until you</span> <span data-start="1465.95" data-end="1468.86">the browser so we also have as changes</span> <span data-start="1468.86" data-end="1472.279">these kind of things in the last thing</span> <span data-start="1472.279" data-end="1474.59">is we try to remove old timers in the</span> <span data-start="1474.59" data-end="1479.139">interface timers are really really bad</span> <span data-start="1479.139" data-end="1483.32">at first time first look it looks very</span> <span data-start="1483.32" data-end="1485.36">nice because you delays execution later</span> <span data-start="1485.36" data-end="1487.519">but in fact you don't control when the</span> <span data-start="1487.519" data-end="1489.74">execution will happen and when the timer</span> <span data-start="1489.74" data-end="1491.929">will fire not only it will find the main</span> <span data-start="1491.929" data-end="1494.63">thread but maybe it's a moment that is</span> <span data-start="1494.63" data-end="1496.61">important for something else you have no</span> <span data-start="1496.61" data-end="1498.799">control so in fact the web platform in</span> <span data-start="1498.799" data-end="1501.169">this can be used also on website we have</span> <span data-start="1501.169" data-end="1502.909">now request either callbacks let's say</span> <span data-start="1502.909" data-end="1506.51">fire this or do this when the main</span> <span data-start="1506.51" data-end="1510.83">stride is free we also did things like</span> <span data-start="1510.83" data-end="1514.309">throttling background tabs so if it is</span> <span data-start="1514.309" data-end="1516.11">in the back it's less important but of</span> <span data-start="1516.11" data-end="1517.61">course if there are music playing in the</span> <span data-start="1517.61" data-end="1519.86">back you don't want your musics to stop</span> <span data-start="1519.86" data-end="1521.899">so we are very very defensive here and</span> <span data-start="1521.899" data-end="1526.94">we process with experimentation and</span> <span data-start="1526.94" data-end="1530.47">finally we redesign our user interface</span> <span data-start="1530.47" data-end="1533.149">so the feeling of the user interface is</span> <span data-start="1533.149" data-end="1536.299">something really important so the look</span> <span data-start="1536.299" data-end="1539.179">has to look modern and it doesn't change</span> <span data-start="1539.179" data-end="1541.1">the speed it change the perception of</span> <span data-start="1541.1" data-end="1545.24">the speed one thing we change is every</span> <span data-start="1545.24" data-end="1547.61">animation now is happening on the GPU is</span> <span data-start="1547.61" data-end="1550.37">happening through CSS we had in the</span> <span data-start="1550.37" data-end="1552.44">previous interface still animation down</span> <span data-start="1552.44" data-end="1555.019">in JavaScript and they were causing a</span> <span data-start="1555.019" data-end="1557.809">good deal of the yup so that's that's</span> <span data-start="1557.809" data-end="1561.919">really important that animation not in</span> </p>
<p><span data-start="1561.919" data-end="1565.399">JavaScript on the main thread we change</span> <span data-start="1565.399" data-end="1566.51">a bit the structure of the user</span> <span data-start="1566.51" data-end="1569.24">interface so it's quicker for the user</span> <span data-start="1569.24" data-end="1571.76">to find elements it's not quicker and</span> <span data-start="1571.76" data-end="1574.49">speed proper but it's quicker for the</span> <span data-start="1574.49" data-end="1577.639">user so with all these things together</span> <span data-start="1577.639" data-end="1582.23">we have now a new engine and it looks</span> <span data-start="1582.23" data-end="1585.98">still a user agent still a nice robot</span> <span data-start="1585.98" data-end="1592.13">but it looks much more modern and it's</span> <span data-start="1592.13" data-end="1595.279">not finished in fact quantum was</span> <span data-start="1595.279" data-end="1597.5">released in November but already is a 2</span> <span data-start="1597.5" data-end="1599.86">next version of the browser had more</span> <span data-start="1599.86" data-end="1602.12">improvements or web render is coming</span> <span data-start="1602.12" data-end="1605.51">soon at some point we have other ideas</span> <span data-start="1605.51" data-end="1607.79">to improve things and in general</span> <span data-start="1607.79" data-end="1610.46">browsers are still evolving it's it's</span> <span data-start="1610.46" data-end="1613.04">not the end it's it's a new beginning</span> <span data-start="1613.04" data-end="1614.93">because it's the first time we have now</span> <span data-start="1614.93" data-end="1616.82">this power of having a massive</span> <span data-start="1616.82" data-end="1620.36">parallelism on a browser so I want to</span> <span data-start="1620.36" data-end="1621.53">thank you too</span> <span data-start="1621.53" data-end="1625.16">here also you can help by installing</span> <span data-start="1625.16" data-end="1627.32">firefox nightly by reporting problem</span> <span data-start="1627.32" data-end="1629.39">especially when your application or your</span> <span data-start="1629.39" data-end="1631.4">website is much slower and firefox and</span> <span data-start="1631.4" data-end="1633.38">in lhasa browser this interests us</span> <span data-start="1633.38" data-end="1635.21">because it's difficult to have real-life</span> <span data-start="1635.21" data-end="1638.45">data each time we do a commit there are</span> <span data-start="1638.45" data-end="1641.03">two thousand hours of tests going on on</span> <span data-start="1641.03" data-end="1644.09">a term of computers but it's test it's</span> <span data-start="1644.09" data-end="1646.46">not real life things so if you file</span> <span data-start="1646.46" data-end="1650.48">about say you can give help by</span> <span data-start="1650.48" data-end="1652.52">reproducing it engineer will be very</span> <span data-start="1652.52" data-end="1657.02">happy spread the word we want as many</span> <span data-start="1657.02" data-end="1658.94">people to use as many browser as</span> <span data-start="1658.94" data-end="1661.49">possible firefox if possible to because</span> <span data-start="1661.49" data-end="1663.56">competition is good that's a way we</span> <span data-start="1663.56" data-end="1665.99">improve speed and firefox nightly</span> <span data-start="1665.99" data-end="1668.42">twitter account is where to stay info</span> <span data-start="1668.42" data-end="1669.51">thank you</span> </p>
</section>