<section>
<p><span data-start="9.2" data-end="15.299">I'm Matthew I work at Yammer a web</span> <span data-start="15.299" data-end="17.31">developer I've been working a lot of</span> <span data-start="17.31" data-end="19.89">different areas of the web stack I guess</span> <span data-start="19.89" data-end="22.92">for kind of a long time and my home has</span> <span data-start="22.92" data-end="25.8">always been JavaScript so it's really</span> <span data-start="25.8" data-end="28.68">exciting to be able to use finally</span> <span data-start="28.68" data-end="30.119">actually be able to use real JavaScript</span> <span data-start="30.119" data-end="32.94">on the server and do full stack</span> <span data-start="32.94" data-end="35.489">development we use a lot of JavaScript</span> <span data-start="35.489" data-end="38.309">at Yammer in a number of different</span> <span data-start="38.309" data-end="41.55">environments our desktop app is</span> </p>
<p><span data-start="41.55" data-end="45.27">JavaScript of course all the web</span> <span data-start="45.27" data-end="47.61">browsers for our web client we use</span> <span data-start="47.61" data-end="50.25">JavaScript in an embedded server-side</span> <span data-start="50.25" data-end="52.44">environment called the Ruby racer which</span> <span data-start="52.44" data-end="56.37">embeds a v8 process in in Ruby and of</span> <span data-start="56.37" data-end="58.559">course we've got a fairly new node</span> <span data-start="58.559" data-end="60.629">service that handles all of our file</span> <span data-start="60.629" data-end="62.64">uploads so I'm going to try to talk a</span> <span data-start="62.64" data-end="65.189">little bit about that it's a pretty</span> <span data-start="65.189" data-end="67.14">short time so I'm going to try to keep</span> <span data-start="67.14" data-end="68.64">it very high level and just kind of</span> <span data-start="68.64" data-end="71.34">power through it so the first lesson</span> <span data-start="71.34" data-end="72.75">this is all stuff that I wish I had</span> <span data-start="72.75" data-end="74.82">known sort of going into the process</span> <span data-start="74.82" data-end="77.31">sort of lessons learned and the first</span> <span data-start="77.31" data-end="79.759">sort of most important thing is is</span> <span data-start="79.759" data-end="81.78">organizing your code and thinking a</span> <span data-start="81.78" data-end="84.99">little bit beforehand as you're building</span> <span data-start="84.99" data-end="88.5">and part of this is sort of the good</span> <span data-start="88.5" data-end="90.659">problem that we have in JavaScript and</span> <span data-start="90.659" data-end="92.46">even more specifically with node that</span> <span data-start="92.46" data-end="94.77">it's really really easy to build</span> <span data-start="94.77" data-end="97.35">something that's immediately useful it's</span> <span data-start="97.35" data-end="98.7">very easy to step out a prototype that</span> <span data-start="98.7" data-end="101.64">does most of what you want almost kind</span> <span data-start="101.64" data-end="104.009">of too easy because as the</span> <span data-start="104.009" data-end="107.13">specifications grow and change ppl makes</span> <span data-start="107.13" data-end="110.31">what seemed to be very small changes to</span> <span data-start="110.31" data-end="112.38">the code to the specification what</span> <span data-start="112.38" data-end="113.49">you're what you're actually supposed to</span> <span data-start="113.49" data-end="117.06">be doing and ends up having a big impact</span> <span data-start="117.06" data-end="119.25">on the rest of the code base so it</span> <span data-start="119.25" data-end="122.579">rapidly can devolve into the old school</span> <span data-start="122.579" data-end="125.549">sort of PHP hairball code especially</span> <span data-start="125.549" data-end="129.08">because of be asynchronous the callbacks</span> <span data-start="129.08" data-end="131.52">some of us who've been using javascript</span> <span data-start="131.52" data-end="132.569">for a very very long</span> <span data-start="132.569" data-end="134.489">time on the front end are probably</span> <span data-start="134.489" data-end="136.049">pretty comfortable maybe a little too</span> <span data-start="136.049" data-end="139.23">comfortable with the the inside out</span> <span data-start="139.23" data-end="142.23">programming of using callbacks and</span> <span data-start="142.23" data-end="145.439">events but trying to keep things a</span> <span data-start="145.439" data-end="147.15">little more clear because it becomes</span> <span data-start="147.15" data-end="149.459">really really important if you want to</span> <span data-start="149.459" data-end="152.4">be able to modify your code and make bug</span> <span data-start="152.4" data-end="156.329">fixes the other small problem is how to</span> <span data-start="156.329" data-end="158.969">manage third party dependencies in your</span> <span data-start="158.969" data-end="160.5">code base where to put them how to</span> <span data-start="160.5" data-end="165.239">organize the code right so with that</span> <span data-start="165.239" data-end="168.87">said the other fairly significant</span> <span data-start="168.87" data-end="171.54">problem is dependencies the node</span> <span data-start="171.54" data-end="176">ecosystem is still really really new so</span> <span data-start="176" data-end="178.889">so finding the appropriate library to</span> <span data-start="178.889" data-end="181.26">use making sure that it does all of what</span> <span data-start="181.26" data-end="183.12">you want or most of what you want on how</span> <span data-start="183.12" data-end="186.03">to deal with that twenty percent that</span> <span data-start="186.03" data-end="188.879">doesn't do that isn't what you want</span> <span data-start="188.879" data-end="193.829">becomes a bit of a problem so when so</span> <span data-start="193.829" data-end="195.269">the service that we're running is</span> <span data-start="195.269" data-end="196.949">something that I started building it's</span> <span data-start="196.949" data-end="198.93">based on it on some code that I started</span> <span data-start="198.93" data-end="203.79">writing very very early and NPM was very</span> <span data-start="203.79" data-end="205.349">very much not there at the time it's</span> <span data-start="205.349" data-end="208.859">it's the way in p.m. works now is</span> <span data-start="208.859" data-end="210.75">probably what we would have wanted</span> <span data-start="210.75" data-end="212.43">installing the dependencies locally</span> <span data-start="212.43" data-end="215.159">makes a application deployment a lot</span> <span data-start="215.159" data-end="218.04">easier but at the time npm using NPM</span> <span data-start="218.04" data-end="219.659">really was an option for us it wasn't</span> <span data-start="219.659" data-end="221.939">something we could explain to our ops</span> <span data-start="221.939" data-end="225.389">people that we needed and ask them to</span> <span data-start="225.389" data-end="227.959">use it the third-party modules that we</span> <span data-start="227.959" data-end="231.03">needed to use we're also not quite there</span> <span data-start="231.03" data-end="233.34">and some of that is bugginess because</span> <span data-start="233.34" data-end="235.139">they're very very new and some of that</span> <span data-start="235.139" data-end="236.699">is because we're all very very focused</span> <span data-start="236.699" data-end="238.079">here i think as javascript people on</span> <span data-start="238.079" data-end="239.669">getting our jobs done and building cool</span> <span data-start="239.669" data-end="241.68">stuff so everyone is building these</span> <span data-start="241.68" data-end="244.019">modules with the intent of using it for</span> <span data-start="244.019" data-end="245.969">whether there's whatever their specific</span> <span data-start="245.969" data-end="252">purpose is so adapting that to something</span> <span data-start="252" data-end="253.979">more general purpose or to your to your</span> <span data-start="253.979" data-end="255.84">needs becomes a little bit more</span> <span data-start="255.84" data-end="258.269">difficult so what we're doing right now</span> <span data-start="258.269" data-end="259.829">we just kind of sidestep the whole thing</span> <span data-start="259.829" data-end="262.919">we have slurped all of the dependencies</span> <span data-start="262.919" data-end="264.9">into our code base we're making the</span> <span data-start="264.9" data-end="266.52">modifications in place</span> <span data-start="266.52" data-end="269.19">pushing patches back upstream this is</span> <span data-start="269.19" data-end="271.47">obviously not optimal we don't like copy</span> <span data-start="271.47" data-end="274.08">paste modify in our own code base and so</span> <span data-start="274.08" data-end="275.55">doing that with libraries is probably</span> <span data-start="275.55" data-end="277.71">not the right decision either that's</span> <span data-start="277.71" data-end="280.349">something that we we hope we can fix and</span> <span data-start="280.349" data-end="282.3">now that NPM installs the modules</span> <span data-start="282.3" data-end="284.31">locally it's a lot nicer story</span> <span data-start="284.31" data-end="286.919">deployment becomes a lot easier you're</span> <span data-start="286.919" data-end="288.75">not relying on this global like thing</span> <span data-start="288.75" data-end="290.819">out in the out in the the language</span> <span data-start="290.819" data-end="293.36">somewhere the language library somewhere</span> <span data-start="293.36" data-end="297.03">right so this is probably them yes so</span> <span data-start="297.03" data-end="297.99">sorry if you're offended by strong</span> <span data-start="297.99" data-end="301.259">language but this is a really important</span> <span data-start="301.259" data-end="304.069">lesson and it applies not just</span> <span data-start="304.069" data-end="309.09">operationally deploying all of the</span> <span data-start="309.09" data-end="311.58">things like this talk bar being spilled</span> <span data-start="311.58" data-end="313.68">and things not working just assuming</span> <span data-start="313.68" data-end="315.389">that things are going to go wrong is in</span> <span data-start="315.389" data-end="317.49">general a good idea but it also applies</span> <span data-start="317.49" data-end="318.93">more specifically to the asynchronous</span> <span data-start="318.93" data-end="321.509">programming model right so you do a call</span> <span data-start="321.509" data-end="324.33">back the interpreter goes along on a tap</span> <span data-start="324.33" data-end="326.43">anyway and in theory something is good</span> <span data-start="326.43" data-end="328.62">is going to happen and you'll be back in</span> <span data-start="328.62" data-end="331.94">the area of code that you care about</span> <span data-start="331.94" data-end="336.08">sometimes things obviously go wrong and</span> <span data-start="336.08" data-end="338.639">figuring out how to handle this in this</span> <span data-start="338.639" data-end="341.37">asynchronous process that's juggling all</span> <span data-start="341.37" data-end="343.59">of these different requests at once can</span> <span data-start="343.59" data-end="346.909">get kind of complicated and hairy so</span> <span data-start="346.909" data-end="349.199">this is a pretty common pattern I think</span> <span data-start="349.199" data-end="350.52">on the UI side and it seems to work</span> <span data-start="350.52" data-end="351.93">pretty well on the server as well where</span> <span data-start="351.93" data-end="354.659">you assume air condition you basically</span> <span data-start="354.659" data-end="357.81">throw an error or call function that is</span> <span data-start="357.81" data-end="359.58">an error handler wrap it in a set time</span> <span data-start="359.58" data-end="362.88">out that you will later on cancel if</span> <span data-start="362.88" data-end="366.18">things turn out ok so just assume it's</span> <span data-start="366.18" data-end="368.039">going to be bad and if it comes back and</span> <span data-start="368.039" data-end="369.63">everything's fine if your unit of work</span> <span data-start="369.63" data-end="372.06">successfully completes you cancel the</span> <span data-start="372.06" data-end="374.789">air that's pretty common pattern on the</span> </p>
<p><span data-start="374.789" data-end="376.949">UI side that doesn't scale well when the</span> <span data-start="376.949" data-end="378.81">app becomes more more complicated so we</span> <span data-start="378.81" data-end="380.49">ended up with something like an</span> <span data-start="380.49" data-end="383.009">in-flight registry where each step in</span> <span data-start="383.009" data-end="387.36">the process is given an ID we basically</span> <span data-start="387.36" data-end="390.75">have big object literal with named keys</span> <span data-start="390.75" data-end="393.21">in it for all the various steps being</span> <span data-start="393.21" data-end="394.44">processed by all the different</span> <span data-start="394.44" data-end="395.849">associated with all the different</span> <span data-start="395.849" data-end="400.05">requests a unit of work goes</span> <span data-start="400.05" data-end="401.4">off and a lot of times of course it's</span> <span data-start="401.4" data-end="402.93">something related to I oh it's something</span> <span data-start="402.93" data-end="405.18">asynchronous with a call back we make an</span> <span data-start="405.18" data-end="408.659">entry with the basically it's a time</span> <span data-start="408.659" data-end="411.72">stamp saying when this is when it when</span> <span data-start="411.72" data-end="413.669">this should be done and we have a</span> <span data-start="413.669" data-end="415.349">process watcher that looks that pokes</span> <span data-start="415.349" data-end="417.21">through this list every couple of</span> <span data-start="417.21" data-end="419.43">seconds to see basically what's overdue</span> <span data-start="419.43" data-end="421.889">and if something's overdue then we</span> <span data-start="421.889" data-end="423.599">perform whatever the default error</span> <span data-start="423.599" data-end="426.06">handling condition is error handling</span> <span data-start="426.06" data-end="430.56">code is so that in combination with the</span> <span data-start="430.56" data-end="432.12">uncaught exception means your process</span> <span data-start="432.12" data-end="434.009">generally stays up and running it's</span> <span data-start="434.009" data-end="435.539">really really important to log all of</span> <span data-start="435.539" data-end="438.06">the errors in detail so that you know</span> <span data-start="438.06" data-end="440.639">exactly why these unexpected things are</span> <span data-start="440.639" data-end="442.68">happening but even when they're with</span> <span data-start="442.68" data-end="445.08">this approach even if they're unexpected</span> <span data-start="445.08" data-end="449.52">errors the request or your control flow</span> <span data-start="449.52" data-end="451.77">knows that this thing is should be in</span> <span data-start="451.77" data-end="453.36">flight and should be coming back at some</span> <span data-start="453.36" data-end="455.509">point and if something goes badly wrong</span> <span data-start="455.509" data-end="458.009">eventually your process your in-flight</span> <span data-start="458.009" data-end="460.02">watcher is going to notice and tell that</span> <span data-start="460.02" data-end="462.84">request you know ship some meaningful</span> <span data-start="462.84" data-end="465.27">requests back to the browser telling</span> <span data-start="465.27" data-end="470.37">what to do so that leads right into the</span> <span data-start="470.37" data-end="474.36">next bit which is visibility into your</span> <span data-start="474.36" data-end="479.4">app because the code what's that okay</span> <span data-start="479.4" data-end="481.77">thanks because the code base is pretty</span> <span data-start="481.77" data-end="485.25">complicated our node app is doing a lot</span> <span data-start="485.25" data-end="488.699">of different stuff at once streaming</span> <span data-start="488.699" data-end="490.199">stuff to the file system shipping stuff</span> <span data-start="490.199" data-end="492.21">off to Amazon thumbnailing it's doing</span> <span data-start="492.21" data-end="494.46">all of this stuff at once so knowing</span> <span data-start="494.46" data-end="495.75">when there's some sort of a problem</span> <span data-start="495.75" data-end="497.669">which piece of the process went wrong is</span> <span data-start="497.669" data-end="500.43">really really important so measure</span> <span data-start="500.43" data-end="502.409">everything and build it in from the very</span> <span data-start="502.409" data-end="505.409">very beginning it's way easier to start</span> <span data-start="505.409" data-end="507.06">with something small that has a bunch of</span> <span data-start="507.06" data-end="508.8">metrics built into it then go in and</span> <span data-start="508.8" data-end="510.75">retrofit your complicated code base with</span> <span data-start="510.75" data-end="512.55">all the appropriate metrics measure of</span> <span data-start="512.55" data-end="514.709">hitting log the out of everything</span> <span data-start="514.709" data-end="516.63">so that you know what's happening and</span> </p>
<p><span data-start="516.63" data-end="520.38">I'd also like to point out here we're</span> <span data-start="520.38" data-end="522.839">now using this metrics library which is</span> <span data-start="522.839" data-end="526.529">a node.js port of coda Hales Scala</span> <span data-start="526.529" data-end="529.55">metrics library that Mike I be here</span> <span data-start="529.55" data-end="533.579">wrote so definitely check that out see</span> <span data-start="533.579" data-end="534.03">what you think</span> <span data-start="534.03" data-end="538.35">give us give us patches please this is</span> <span data-start="538.35" data-end="541.14">the last bit and I would actually say</span> <span data-start="541.14" data-end="543">that this might be the most important</span> <span data-start="543" data-end="550.38">piece of all and that's because note is</span> <span data-start="550.38" data-end="552.66">still very very new and so things still</span> <span data-start="552.66" data-end="557.04">kind of go wrong a lot and if you rope</span> <span data-start="557.04" data-end="558.24">in your ops people from the very</span> <span data-start="558.24" data-end="560.01">beginning and work with them there's a</span> <span data-start="560.01" data-end="562.2">lot more goodwill and they're a lot more</span> <span data-start="562.2" data-end="564.42">patient with your bleeding edge node</span> <span data-start="564.42" data-end="567.59">service if you talk to them first and</span> <span data-start="567.59" data-end="570">make sure that you're sort of being a</span> <span data-start="570" data-end="572.07">good citizen so at Yammer we've got a</span> <span data-start="572.07" data-end="574.41">bunch of other services written in Java</span> <span data-start="574.41" data-end="578.25">and Scala and knowing upfront sort of</span> <span data-start="578.25" data-end="580.2">what is expected of an HTTP service at</span> </p>
<p><span data-start="580.2" data-end="581.85">Yammer knowing knowing the things that</span> <span data-start="581.85" data-end="583.7">we should do so the deployment story</span> <span data-start="583.7" data-end="588.72">restarts metrics reporting all of these</span> <span data-start="588.72" data-end="590.67">things know knowing what we should be</span> <span data-start="590.67" data-end="592.94">doing is really really important so</span> <span data-start="592.94" data-end="594.99">talking to these guys up front and</span> <span data-start="594.99" data-end="596.43">knowing what's expected knowing what</span> <span data-start="596.43" data-end="599.25">would make their lives easier means that</span> <span data-start="599.25" data-end="601.41">there's a lot less bitterness and angst</span> <span data-start="601.41" data-end="603.09">when your service wakes them up at two</span> <span data-start="603.09" data-end="605.16">in the morning right they're the guys</span> <span data-start="605.16" data-end="608.79">who have to deal with that so yes I</span> <span data-start="608.79" data-end="611.19">think that said I'm MDE on twitter if</span> <span data-start="611.19" data-end="613.05">you are interested in this javascript</span> <span data-start="613.05" data-end="615.24">stuff that we're doing a Yammer I can</span> <span data-start="615.24" data-end="616.68">point you to the other devs at Yammer</span> <span data-start="616.68" data-end="620.28">who are dealing with whatever different</span> <span data-start="620.28" data-end="622.62">technologies we also have a developer</span> <span data-start="622.62" data-end="626.4">center that Michael Rogers has put</span> <span data-start="626.4" data-end="628.62">together he's been working for us for a</span> <span data-start="628.62" data-end="630.57">couple of months and really kicking ass</span> <span data-start="630.57" data-end="631.77">we're really really thrilled to have him</span> <span data-start="631.77" data-end="634.74">so check out the developer center I</span> <span data-start="634.74" data-end="636.51">guess that's really it unless there are</span> <span data-start="636.51" data-end="639.57">questions how big is our no deployment</span> <span data-start="639.57" data-end="644.16">um right now we have a very small</span> <span data-start="644.16" data-end="647.49">cluster it's three servers I do not have</span> <span data-start="647.49" data-end="649.74">statistics on the number of uploads</span> <span data-start="649.74" data-end="652.02">process per day or anything yet we're</span> <span data-start="652.02" data-end="653.25">measuring it I just don't know what it</span> <span data-start="653.25" data-end="655.36">is</span> <span data-start="655.37" data-end="659.97">that's an interesting question okay yeah</span> <span data-start="659.97" data-end="662.19">the question was how do we sell ops on</span> <span data-start="662.19" data-end="664.83">deploying something so new there are a</span> <span data-start="664.83" data-end="666.3">couple of different good reasons to</span> <span data-start="666.3" data-end="668.64">deploy this particular thing as a node</span> <span data-start="668.64" data-end="671.37">service some of it was the dynamics of</span> <span data-start="671.37" data-end="672.75">the different teams working on it at the</span> <span data-start="672.75" data-end="674.82">time this was sort of under the umbrella</span> <span data-start="674.82" data-end="676.92">of the platform team which was very very</span> <span data-start="676.92" data-end="679.11">javascript heavy I think the Ops guys</span> <span data-start="679.11" data-end="681.36">also recognize the value of node that</span> <span data-start="681.36" data-end="683.64">it's an important thing in technology so</span> <span data-start="683.64" data-end="685.32">getting some operational expertise in</span> <span data-start="685.32" data-end="686.79">that is I think they understand that</span> <span data-start="686.79" data-end="690.06">that's important also the fact that the</span> <span data-start="690.06" data-end="691.26">particular thing that we were doing</span> <span data-start="691.26" data-end="695.07">which is streaming file uploads its note</span> <span data-start="695.07" data-end="697.41">is very very well suited to performing</span> <span data-start="697.41" data-end="699.39">that kind of work and I think they also</span> <span data-start="699.39" data-end="702.81">recognize the importance of node in the</span> </p>
<p><span data-start="702.81" data-end="704.82">JavaScript world and so doing</span> <span data-start="704.82" data-end="706.83">interesting things you know with</span> <span data-start="706.83" data-end="709.17">javascript in real life and production</span> <span data-start="709.17" data-end="711.33">is something that you should do if</span> <span data-start="711.33" data-end="713.1">you're interested in plugging into the</span> <span data-start="713.1" data-end="715.14">Jazz community it's I mean it is</span> <span data-start="715.14" data-end="719.64">political but it's also bad ass so you</span> <span data-start="719.64" data-end="725.79">know anything else okay so he's asking</span> <span data-start="725.79" data-end="728.28">about storing the data for the in-flight</span> <span data-start="728.28" data-end="730.11">registry and something like CouchDB</span> <span data-start="730.11" data-end="732.24">that's not particularly useful for us</span> <span data-start="732.24" data-end="734.01">because this is processing file uploads</span> <span data-start="734.01" data-end="737.52">and we're we're tracking basically about</span> <span data-start="737.52" data-end="739.95">pretty short ephemeral steps so it's</span> <span data-start="739.95" data-end="741.81">like how long this file should take to</span> <span data-start="741.81" data-end="743.52">be shipped off to Amazon and once that</span> <span data-start="743.52" data-end="745.29">uploads done it's done so just keeping</span> <span data-start="745.29" data-end="746.97">that in memory is a lot a lot more</span> <span data-start="746.97" data-end="751.68">efficient what's that it's not something</span> <span data-start="751.68" data-end="752.82">that would be appropriate for what we're</span> <span data-start="752.82" data-end="754.77">doing but if it's something long-lived</span> <span data-start="754.77" data-end="757.38">yeah that's mean that would seem</span> <span data-start="757.38" data-end="760.2">reasonable or if you need to communicate</span> <span data-start="760.2" data-end="762.84">between nodes in the server excuse me</span> <span data-start="762.84" data-end="765.12">server nodes in a cluster that might be</span> <span data-start="765.12" data-end="767.67">a nice suit we're actually using Redis</span> <span data-start="767.67" data-end="770.85">cluster to communicate between nodes in</span> <span data-start="770.85" data-end="772.44">the server so if you're interested more</span> <span data-start="772.44" data-end="774.57">in exactly what we're doing definitely</span> <span data-start="774.57" data-end="776.46">talk to me because I think I'm about to</span> <span data-start="776.46" data-end="780.329">get the cane here right so thanks</span> </p>
</section>