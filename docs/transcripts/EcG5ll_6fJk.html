<section>
<p><span data-start="0.11" data-end="8.73">[Music]</span> <span data-start="8.73" data-end="13.5">[Applause]</span> <span data-start="13.51" data-end="28.63">[Music]</span> <span data-start="28.64" data-end="30.72">good afternoon everyone</span> <span data-start="30.72" data-end="32.7">my name is Senne che and the software</span> <span data-start="32.7" data-end="35.19">engineer on the amp project and today</span> </p>
<p><span data-start="35.19" data-end="38.399">I'm going to share with you our secrets</span> <span data-start="38.399" data-end="42.149">for making web pages stuff and hopefully</span> <span data-start="42.149" data-end="44.37">you learn some of the best practices and</span> <span data-start="44.37" data-end="46.92">apply them in your own development</span> <span data-start="46.92" data-end="51.149">process but first let me show you what</span> <span data-start="51.149" data-end="54.18">problem we're trying to solve this is a</span> <span data-start="54.18" data-end="58.68">typical mobile page and I as a user want</span> <span data-start="58.68" data-end="60.809">to see this page I have just clicked on</span> <span data-start="60.809" data-end="63.539">a link to open this page and read the</span> <span data-start="63.539" data-end="66.869">content but I can't because there are</span> <span data-start="66.869" data-end="69.33">things that are preventing me from doing</span> <span data-start="69.33" data-end="74.82">so the first is that it's extremely slow</span> <span data-start="74.82" data-end="77.88">to load in fact does anyone here in the</span> <span data-start="77.88" data-end="80.22">audience know how long it takes the</span> <span data-start="80.22" data-end="86.45">average mobile page to load 15 seconds</span> <span data-start="86.45" data-end="89.909">15 seconds you know that after 3 seconds</span> <span data-start="89.909" data-end="93.57">half your users are gone after 10</span> <span data-start="93.57" data-end="97.229">seconds nobody's there 15 seconds is</span> <span data-start="97.229" data-end="104.34">horrible the average is 19 seconds so</span> <span data-start="104.34" data-end="107.369">after I finally loaded my page I have</span> <span data-start="107.369" data-end="110.909">this flash of unstyled content which is</span> <span data-start="110.909" data-end="113.43">very jarring and could possibly give you</span> <span data-start="113.43" data-end="118.02">a Pepsi and after I takes forever to</span> <span data-start="118.02" data-end="119.759">load I have a flash of unstyled content</span> </p>
<p><span data-start="119.759" data-end="122.67">I start reading the page in 20 seconds</span> <span data-start="122.67" data-end="124.59">later when it's just that the best part</span> <span data-start="124.59" data-end="127.35">and I want to see what happens this ad</span> <span data-start="127.35" data-end="131.34">loads out of nowhere and fix my content</span> <span data-start="131.34" data-end="132.39">around and I lose my</span> <span data-start="132.39" data-end="133.86">place and I don't know where I am</span> <span data-start="133.86" data-end="135.69">anymore and I really want to know what</span> <span data-start="135.69" data-end="142.05">happens next so then I try to look for</span> <span data-start="142.05" data-end="144.93">where I was but now my browser is kind</span> <span data-start="144.93" data-end="147.78">of frozen or it's janky and I can't find</span> <span data-start="147.78" data-end="151.86">where I left off this is a horrible</span> <span data-start="151.86" data-end="155.37">horrible experience we have all been</span> <span data-start="155.37" data-end="158.64">here before but why should you as</span> <span data-start="158.64" data-end="161.73">developers care about this you have a</span> <span data-start="161.73" data-end="163.35">million things you could be doing with</span> <span data-start="163.35" data-end="166.47">your time why is it important to fix</span> <span data-start="166.47" data-end="169.83">these issues well my answer is that it's</span> <span data-start="169.83" data-end="172.38">important if you want to keep your users</span> <span data-start="172.38" data-end="176.459">and your revenue today I'm going to take</span> <span data-start="176.459" data-end="178.95">you under the hood and show you what's</span> <span data-start="178.95" data-end="180.72">going on that's causing all these issues</span> </p>
<p><span data-start="180.72" data-end="183.18">I'm going to show you the 10 sets that</span> <span data-start="183.18" data-end="185.459">we take with amp to address these issues</span> <span data-start="185.459" data-end="187.68">to make the web experience much better</span> <span data-start="187.68" data-end="190.08">and hopefully you'll be able to apply</span> <span data-start="190.08" data-end="192.75">what we do in your own development</span> <span data-start="192.75" data-end="196.11">process to make your pages better in</span> <span data-start="196.11" data-end="200.549">faster so first let's look at the first</span> <span data-start="200.549" data-end="202.709">problem which is that it's very slow to</span> <span data-start="202.709" data-end="205.11">load and what's happening here is that</span> <span data-start="205.11" data-end="207.9">there are things that are blocking the</span> <span data-start="207.9" data-end="211.35">render and these things happen to be</span> <span data-start="211.35" data-end="213.269">files that you have to download before</span> <span data-start="213.269" data-end="215.7">you could see anything on your page they</span> <span data-start="215.7" data-end="218.31">could be the assess files they could be</span> </p>
<p><span data-start="218.31" data-end="221.459">JavaScript files and they have to</span> <span data-start="221.459" data-end="222.84">download and it takes a really long time</span> <span data-start="222.84" data-end="228">and to solve this we decided that we</span> <span data-start="228" data-end="231.69">need all scripts to be asynchronous so</span> <span data-start="231.69" data-end="234.36">that you can see the HTML on your page</span> <span data-start="234.36" data-end="236.37">you can have the page load and the</span> <span data-start="236.37" data-end="238.38">script will load in the background and</span> <span data-start="238.38" data-end="240.87">they don't have to block the render of</span> <span data-start="240.87" data-end="245.579">your page the next thing is that we only</span> <span data-start="245.579" data-end="247.769">want to download JavaScript that you</span> <span data-start="247.769" data-end="250.2">need on your page so here for example is</span> <span data-start="250.2" data-end="253.35">a carousel not every page will have a</span> <span data-start="253.35" data-end="256.049">carousel so not every page should</span> <span data-start="256.049" data-end="259.829">download the JavaScript of a carousel so</span> <span data-start="259.829" data-end="263.039">we break the page up into components and</span> <span data-start="263.039" data-end="265.5">we tell the browser specifically what</span> </p>
<p><span data-start="265.5" data-end="266.47">JavaScript we</span> <span data-start="266.47" data-end="268.09">want to download so that you only</span> <span data-start="268.09" data-end="272.95">download what you need for your page the</span> <span data-start="272.95" data-end="276.34">next thing is that we inline CSS so</span> <span data-start="276.34" data-end="278.53">external stylesheets tend to be very</span> <span data-start="278.53" data-end="281.44">large and they take a very long time to</span> <span data-start="281.44" data-end="284.05">load so in lining it means that you</span> <span data-start="284.05" data-end="285.85">don't have to download them separately</span> <span data-start="285.85" data-end="289.3">and it's going to be a lot faster this</span> <span data-start="289.3" data-end="291.82">is like taking a carry-on luggage with</span> <span data-start="291.82" data-end="293.86">you when you fly it's going to be a lot</span> <span data-start="293.86" data-end="296.83">faster than if you check in your baggage</span> <span data-start="296.83" data-end="298.35">and end up being one of these people</span> <span data-start="298.35" data-end="301.12">waiting at the carousel nobody wants to</span> <span data-start="301.12" data-end="303.66">be here because it takes forever so</span> <span data-start="303.66" data-end="306.01">check in your don't check in your</span> <span data-start="306.01" data-end="307.84">luggage carry it on with you inline your</span> </p>
<p><span data-start="307.84" data-end="311.59">CSS now when you fly and you take a</span> <span data-start="311.59" data-end="314.71">carry-on suitcase with you you have to</span> <span data-start="314.71" data-end="316.93">limit how many things you bring right</span> <span data-start="316.93" data-end="320.44">because you don't have room for your</span> <span data-start="320.44" data-end="322.06">entire house in your carry-on luggage</span> <span data-start="322.06" data-end="325.81">and we decided that we're going to limit</span> <span data-start="325.81" data-end="330.22">CSS by 60 kilobytes and 50 kilobytes is</span> <span data-start="330.22" data-end="332.919">just like the space in your carry-on</span> <span data-start="332.919" data-end="336.1">luggage it's just enough for all the</span> <span data-start="336.1" data-end="337.6">things that you need but you're not</span> <span data-start="337.6" data-end="339.43">going to bring a bunch of junk that you</span> <span data-start="339.43" data-end="345.13">don't need the next thing so also the 50</span> <span data-start="345.13" data-end="347.02">kilobytes what it forces you to do is</span> <span data-start="347.02" data-end="349.12">clean up CSS that you don't longer need</span> <span data-start="349.12" data-end="352.21">now around wintertime a lot of us have</span> <span data-start="352.21" data-end="355.33">these promotions for for Christmas or</span> <span data-start="355.33" data-end="357.46">for the holidays for certain sales and</span> <span data-start="357.46" data-end="361.39">we have CSS for it and then we get rid</span> <span data-start="361.39" data-end="363.85">of the we don't show it anymore because</span> <span data-start="363.85" data-end="366.18">you know in January Christmas is over</span> <span data-start="366.18" data-end="369.63">but someone forgot to clean up the CSS</span> <span data-start="369.63" data-end="372.84">it's still there even if your users</span> <span data-start="372.84" data-end="376.21">don't see it but they're paying for it</span> <span data-start="376.21" data-end="378.91">with their time because it takes longer</span> <span data-start="378.91" data-end="381.16">to download and their wallets because</span> <span data-start="381.16" data-end="385.96">this takes up data so limiting CSS to 50</span> <span data-start="385.96" data-end="387.49">kilobytes means that you're going to</span> <span data-start="387.49" data-end="389.53">have to clean up these things and it's</span> <span data-start="389.53" data-end="391.15">going to give your users a much better</span> <span data-start="391.15" data-end="394.9">experience the next thing I want to talk</span> <span data-start="394.9" data-end="397.33">about is third-party JavaScript and</span> <span data-start="397.33" data-end="398.66">mainly</span> <span data-start="398.66" data-end="403.72">in relation to ad so ad have not all</span> <span data-start="403.72" data-end="407.15">kept up with the time and a lot of them</span> <span data-start="407.15" data-end="409.34">think that they need third party</span> </p>
<p><span data-start="409.34" data-end="412.54">JavaScript for their execution and</span> <span data-start="412.54" data-end="414.86">because ads are important and they make</span> <span data-start="414.86" data-end="417.61">money we have to allow them to exist and</span> <span data-start="417.61" data-end="420.68">so they use third party JavaScript but</span> <span data-start="420.68" data-end="423.41">we we have to tell them they need to be</span> <span data-start="423.41" data-end="425.84">in sandbox iframes because third party</span> <span data-start="425.84" data-end="429.32">JavaScript does horrible things first</span> <span data-start="429.32" data-end="433.25">they write think script so again you</span> <span data-start="433.25" data-end="434.75">have this issue where you have to wait</span> <span data-start="434.75" data-end="436.85">for these scripts to load before you</span> <span data-start="436.85" data-end="439.22">could see anything on your page the next</span> <span data-start="439.22" data-end="441.35">thing is that they document dot write</span> <span data-start="441.35" data-end="445.28">more things script so you have a lot</span> <span data-start="445.28" data-end="446.69">more Singh script that you have to wait</span> <span data-start="446.69" data-end="449.57">for and it all adds up and the third</span> <span data-start="449.57" data-end="451">thing that they do is style</span> <span data-start="451" data-end="452.21">recalculations</span> <span data-start="452.21" data-end="456.35">which is very heavy on the CPU because</span> <span data-start="456.35" data-end="459.58">they have to scan your entire page and</span> <span data-start="459.58" data-end="462.23">it also might be wrong because if you</span> <span data-start="462.23" data-end="465.05">name a CSS class the same thing an ad</span> <span data-start="465.05" data-end="467.3">could potentially change the style of</span> <span data-start="467.3" data-end="469.1">something on your page such as your logo</span> <span data-start="469.1" data-end="472.54">and you don't want that so by limiting</span> <span data-start="472.54" data-end="476.03">third parties to these sandbox iframes</span> <span data-start="476.03" data-end="478.28">they're still going to do these bad</span> <span data-start="478.28" data-end="480.35">things but they're not going to affect</span> <span data-start="480.35" data-end="481.73">the rest of the page they're not going</span> <span data-start="481.73" data-end="484.79">to affect the load and they have their</span> <span data-start="484.79" data-end="487.76">little box where they can play and also</span> <span data-start="487.76" data-end="490.22">doing salary calculations are going it's</span> <span data-start="490.22" data-end="492.47">going to be a lot cheaper because it's</span> <span data-start="492.47" data-end="494.33">only going to scan the content of the</span> <span data-start="494.33" data-end="497.45">iframe rather than your entire page this</span> <span data-start="497.45" data-end="500.66">is like allowing your toddlers to play</span> <span data-start="500.66" data-end="502.52">with paint and you know that they're</span> <span data-start="502.52" data-end="504.92">going to make a mess you just want to</span> <span data-start="504.92" data-end="507.02">keep that must away from other parts of</span> <span data-start="507.02" data-end="508.9">your help</span> <span data-start="508.9" data-end="511.58">the next thing we do is resource</span> <span data-start="511.58" data-end="515.96">prioritization so a typical mobile page</span> <span data-start="515.96" data-end="520.669">is a lot longer than then your viewport</span> <span data-start="520.669" data-end="524.35">then your first viewport of a phone and</span> <span data-start="524.35" data-end="528.71">sometimes we don't actually download the</span> <span data-start="528.71" data-end="531.71">entire page when a user taps on it but</span> <span data-start="531.71" data-end="532.5">the</span> <span data-start="532.5" data-end="534.21">our perceive the load to be</span> <span data-start="534.21" data-end="536.94">instantaneous because we load the</span> <span data-start="536.94" data-end="540.18">content in the first viewport before we</span> <span data-start="540.18" data-end="544.32">load the rest of the page and this makes</span> <span data-start="544.32" data-end="546.11">the perception of the load</span> <span data-start="546.11" data-end="548.01">instantaneously even if we didn't have</span> <span data-start="548.01" data-end="553.02">the time to download everything and we</span> <span data-start="553.02" data-end="555.45">also do something called pre connect so</span> <span data-start="555.45" data-end="558.42">for example here's a YouTube video and</span> <span data-start="558.42" data-end="560.76">to lo the contents of a YouTube video</span> <span data-start="560.76" data-end="563.04">there are a lot of things going on but</span> <span data-start="563.04" data-end="565.26">one of them is we have to connect to the</span> <span data-start="565.26" data-end="566.61">source right we have to connect to</span> </p>
<p><span data-start="566.61" data-end="570.21">YouTube and that takes up time so by</span> <span data-start="570.21" data-end="572.07">connecting ahead of time as we know that</span> <span data-start="572.07" data-end="574.68">there's a YouTube video or an image or</span> <span data-start="574.68" data-end="577.56">for example with Twitter to load the you</span> <span data-start="577.56" data-end="579.33">know the content you have to connect to</span> <span data-start="579.33" data-end="581.13">one server to load images you have to</span> <span data-start="581.13" data-end="583.2">connect to another server by doing these</span> <span data-start="583.2" data-end="585.63">connections ahead of time when it comes</span> <span data-start="585.63" data-end="588.87">time to load the content it's going to</span> <span data-start="588.87" data-end="594.15">load much faster so now we've gotten rid</span> <span data-start="594.15" data-end="597.45">of this slow loading problem but we're</span> <span data-start="597.45" data-end="600.51">not done because we have this flash of</span> <span data-start="600.51" data-end="603">unstyled content and we don't want this</span> <span data-start="603" data-end="605.7">and what's happening here is that the</span> <span data-start="605.7" data-end="608.82">page is loading but then the styles are</span> <span data-start="608.82" data-end="610.68">being applied after the page has loaded</span> <span data-start="610.68" data-end="613.29">and to solve this problem we use an</span> <span data-start="613.29" data-end="617.07">invisibility trick and we set the</span> <span data-start="617.07" data-end="620.22">opacity of the body to zero so it exists</span> <span data-start="620.22" data-end="623.55">but it's invisible to the user and then</span> <span data-start="623.55" data-end="626.49">the styles are applied and eventually</span> <span data-start="626.49" data-end="629.58">the JavaScript will load and unhide the</span> <span data-start="629.58" data-end="632.49">page so to the user it's perceived as</span> <span data-start="632.49" data-end="637.29">being loaded like this first but what</span> <span data-start="637.29" data-end="640.2">happens if there is no JavaScript well</span> <span data-start="640.2" data-end="643.05">we have this no script to unhide the</span> <span data-start="643.05" data-end="645.75">body if there's nothing there to unhide</span> <span data-start="645.75" data-end="650.18">the body and then finally what if</span> </p>
<p><span data-start="650.18" data-end="653.52">JavaScript servers go down which can</span> <span data-start="653.52" data-end="655.56">happen everyone's in a couple of years</span> <span data-start="655.56" data-end="660.39">right and to address this issue we do a</span> <span data-start="660.39" data-end="664.41">CSS timeout animation timeout so</span> <span data-start="664.41" data-end="666.93">for some reason the page thinks that</span> <span data-start="666.93" data-end="668.19">there is a JavaScript that the server</span> <span data-start="668.19" data-end="671.61">times out then we will have a timeout</span> <span data-start="671.61" data-end="675.48">that will unhide the body if the</span> </p>
<p><span data-start="675.48" data-end="678.44">JavaScript never arrives</span> <span data-start="678.44" data-end="681.389">now what I just described to you it's</span> <span data-start="681.389" data-end="683.97">what we currently do but there is a bit</span> <span data-start="683.97" data-end="685.86">of a time delay and we're currently</span> <span data-start="685.86" data-end="688.319">working on doing server-side rendering</span> <span data-start="688.319" data-end="692.16">so that there will be zero time delay so</span> <span data-start="692.16" data-end="694.98">now we reload fast we got rid of the</span> <span data-start="694.98" data-end="697.86">flash of unstyled content but we're not</span> <span data-start="697.86" data-end="700.949">done because 20 seconds into reading</span> <span data-start="700.949" data-end="703.11">this ad loads out of nowhere and shifts</span> <span data-start="703.11" data-end="705.209">the content all around and nobody likes</span> <span data-start="705.209" data-end="708.87">it and what's happening here is just</span> <span data-start="708.87" data-end="710.97">like I talked about earlier is that I'd</span> <span data-start="710.97" data-end="714.509">use these third parties Java scripts and</span> <span data-start="714.509" data-end="716.1">they're really slow they take forever to</span> <span data-start="716.1" data-end="721.949">load we can't force all the ads to be</span> <span data-start="721.949" data-end="723.87">implemented in a way that they're going</span> <span data-start="723.87" data-end="726.36">to load fast right we can't force them</span> <span data-start="726.36" data-end="728.339">to do that but we have to allow them to</span> <span data-start="728.339" data-end="731.49">play so to solve this problem where we</span> <span data-start="731.49" data-end="733.98">let them exist but don't punish our</span> <span data-start="733.98" data-end="737.67">users we put these placeholders because</span> <span data-start="737.67" data-end="739.8">we know that there's going to be an ADD</span> <span data-start="739.8" data-end="743.25">and we have static resource sizing so we</span> <span data-start="743.25" data-end="746.99">know the size of the ad and so the user</span> <span data-start="746.99" data-end="750">can read the contents of the page and</span> <span data-start="750" data-end="752.61">then it's up to the ad to load on time</span> <span data-start="752.61" data-end="755.88">and eventually the ad will load and it</span> <span data-start="755.88" data-end="758.97">won't shift the content so the user can</span> <span data-start="758.97" data-end="760.949">continue reading and have a pleasant</span> <span data-start="760.949" data-end="766.38">experience and we've solved this content</span> <span data-start="766.38" data-end="769.11">shifting issue but we're still not done</span> <span data-start="769.11" data-end="772.529">because we need to address this frozen</span> <span data-start="772.529" data-end="774.66">janky problem that's happening and</span> <span data-start="774.66" data-end="778.35">what's going on here is that the CPU is</span> <span data-start="778.35" data-end="783.54">overworked and overloaded and to address</span> <span data-start="783.54" data-end="786.029">this we do a few things first is that</span> <span data-start="786.029" data-end="788.25">style recalculations are really</span> <span data-start="788.25" data-end="791.459">expensive so we want to minimize style</span> <span data-start="791.459" data-end="792.48">recalculations</span> <span data-start="792.48" data-end="796.019">and we do so by caching the coordinates</span> <span data-start="796.019" data-end="797.43">so we know where all the things</span> <span data-start="797.43" data-end="799.83">our and then we know when things resize</span> <span data-start="799.83" data-end="802.56">and that's the only time that we're</span> <span data-start="802.56" data-end="805.52">going to recalculate the style</span> <span data-start="805.52" data-end="809.04">also we batch the dome access so for</span> <span data-start="809.04" data-end="813.57">example I have this code sample where we</span> <span data-start="813.57" data-end="815.94">measure something and then we set the</span> <span data-start="815.94" data-end="818.52">height we change the zone and then we</span> <span data-start="818.52" data-end="820.529">measure something again and then we</span> <span data-start="820.529" data-end="822.089">change the zone by setting the width and</span> <span data-start="822.089" data-end="824.339">then we measure something again and this</span> <span data-start="824.339" data-end="827.22">is a very reasonable chunk of code but</span> <span data-start="827.22" data-end="830.22">what's happening here is that the style</span> <span data-start="830.22" data-end="832.77">is being recalculated every time you</span> <span data-start="832.77" data-end="834.66">measure something because the dome has</span> <span data-start="834.66" data-end="835.47">changed</span> <span data-start="835.47" data-end="838.23">so by batching the dome access we can</span> <span data-start="838.23" data-end="841.74">schedule a read for the first animation</span> <span data-start="841.74" data-end="843.87">frame and then we can schedule a write</span> <span data-start="843.87" data-end="847.95">for the next animation frame so that you</span> <span data-start="847.95" data-end="850.29">only recalculate the style one time in</span> <span data-start="850.29" data-end="852.63">this example and this is going to be a</span> <span data-start="852.63" data-end="856.77">lot less expensive for the CPU so we</span> <span data-start="856.77" data-end="859.23">have a max of one style recalculation</span> <span data-start="859.23" data-end="861.39">for spring and this is the main thing</span> <span data-start="861.39" data-end="863.49">that makes amp pages fast when you</span> <span data-start="863.49" data-end="865.56">interact with them this is really the</span> <span data-start="865.56" data-end="867.36">only thing you can afford if you want to</span> <span data-start="867.36" data-end="870.42">get to 60 frames per second and we only</span> <span data-start="870.42" data-end="873.839">do two style recalculations for a page</span> <span data-start="873.839" data-end="875.7">load which is very low compared to other</span> <span data-start="875.7" data-end="881.91">pages the next thing is that we want to</span> <span data-start="881.91" data-end="885.029">do GPU optimizable animations only in</span> <span data-start="885.029" data-end="889.08">our in our amp components so animations</span> <span data-start="889.08" data-end="894.06">are very expensive for this CPU and we</span> <span data-start="894.06" data-end="898.65">want the CPU to the handover the work to</span> <span data-start="898.65" data-end="900.36">delegate the work over to the GPU</span> <span data-start="900.36" data-end="903.48">because the GPU can do animations really</span> <span data-start="903.48" data-end="908.73">quickly and really cheaply and so in our</span> <span data-start="908.73" data-end="911.79">amp components we only allow animations</span> <span data-start="911.79" data-end="914.459">that the GPU can perform in this case</span> <span data-start="914.459" data-end="918.42">it's transform and opacity so if you</span> <span data-start="918.42" data-end="921.48">wanted to animate the width the GPU is</span> <span data-start="921.48" data-end="924.06">not going to know how to do it and it's</span> <span data-start="924.06" data-end="926.07">going to say CPU you go ahead and do</span> <span data-start="926.07" data-end="929.04">this so we don't allow width or height</span> <span data-start="929.04" data-end="929.939">animation</span> <span data-start="929.939" data-end="932.159">but we do allow transform and opacity</span> <span data-start="932.159" data-end="935.039">because the GPU knows how to do this and</span> <span data-start="935.039" data-end="938.579">it can do it very cheaply so now we've</span> <span data-start="938.579" data-end="941.549">gotten rid of the frozenness and janky</span> <span data-start="941.549" data-end="945.029">nice but I want to take a moment so</span> <span data-start="945.029" data-end="947.099">everything I talked about now any</span> <span data-start="947.099" data-end="950.159">developer can do you can apply in all of</span> <span data-start="950.159" data-end="954.659">your development processes but because</span> <span data-start="954.659" data-end="957.869">we're talking about amp amp also uses a</span> <span data-start="957.869" data-end="959.579">cache so if you wanted to build a system</span> <span data-start="959.579" data-end="961.709">it's a little bit more complicated but</span> <span data-start="961.709" data-end="965.22">you can optimize with cache and what we</span> <span data-start="965.22" data-end="969.779">do is first of all the cache we have</span> <span data-start="969.779" data-end="972.929">servers that are located in lots of</span> <span data-start="972.929" data-end="974.729">places all over the world so they're</span> <span data-start="974.729" data-end="977.939">physically located next to you and that</span> <span data-start="977.939" data-end="979.769">means that delivery of the content is</span> <span data-start="979.769" data-end="981.269">going to be a lot faster when these</span> <span data-start="981.269" data-end="983.249">servers are located next to and these</span> <span data-start="983.249" data-end="985.139">servers they could be Google servers or</span> <span data-start="985.139" data-end="986.819">they could be CloudFlare servers it</span> <span data-start="986.819" data-end="989.759">doesn't matter but that's going to give</span> <span data-start="989.759" data-end="993.359">you that real boost of speed is to have</span> <span data-start="993.359" data-end="995.459">this cache and some of the optimizations</span> <span data-start="995.459" data-end="998.519">that we do on the cache is the first is</span> <span data-start="998.519" data-end="1001.669">efficient pre-rendering the browser is</span> <span data-start="1001.669" data-end="1004.429">used to have this thing called a rel</span> <span data-start="1004.429" data-end="1007.249">equals pre-render where you could tell</span> <span data-start="1007.249" data-end="1009.139">their browser you could have a link on</span> <span data-start="1009.139" data-end="1010.399">your page and you could tell the browser</span> <span data-start="1010.399" data-end="1015.439">hey download pre-render this link so the</span> <span data-start="1015.439" data-end="1017.299">browser would download all the contents</span> <span data-start="1017.299" data-end="1020.899">of the page and and then when the user</span> <span data-start="1020.899" data-end="1022.849">would click on the link the page would</span> <span data-start="1022.849" data-end="1025.759">load instantaneously but the problem</span> <span data-start="1025.759" data-end="1028.039">with this was that it downloads the</span> <span data-start="1028.039" data-end="1031.159">entire contents of the page all of the</span> <span data-start="1031.159" data-end="1033.73">images all of the ads all of the</span> <span data-start="1033.73" data-end="1036.169">analytics so the third party JavaScript</span> <span data-start="1036.169" data-end="1038.539">and it would R execute arbitrary</span> </p>
<p><span data-start="1038.539" data-end="1040.579">JavaScript in the background and that's</span> <span data-start="1040.579" data-end="1045.11">very heavy for the CPU so instead what</span> <span data-start="1045.11" data-end="1049.629">we did is we pre render only the first</span> <span data-start="1049.629" data-end="1052.97">viewport and we don't execute any</span> <span data-start="1052.97" data-end="1055.399">third-party JavaScript so none of the</span> <span data-start="1055.399" data-end="1058.519">analytics and all that stuff and what</span> <span data-start="1058.519" data-end="1060.379">this does is it makes pre-rendering</span> <span data-start="1060.379" data-end="1064.12">extremely cheap and non expensive</span> <span data-start="1064.12" data-end="1066.92">the next thing we do is resource</span> <span data-start="1066.92" data-end="1068.9">compression and by resource I mean all</span> <span data-start="1068.9" data-end="1071.42">the things all the files that the users</span> <span data-start="1071.42" data-end="1073.72">are going to download on to their page</span> <span data-start="1073.72" data-end="1076.94">and some of these files are JavaScript</span> <span data-start="1076.94" data-end="1080.32">files and so we use a closure compiler</span> <span data-start="1080.32" data-end="1084.02">to compress our code and here's a chunk</span> <span data-start="1084.02" data-end="1085.58">of code on the list and if you run it</span> <span data-start="1085.58" data-end="1087.44">through the closure compiler it's going</span> <span data-start="1087.44" data-end="1089.87">to compress it to the chunk on the right</span> <span data-start="1089.87" data-end="1093.68">and on top of that oh it also does tree</span> <span data-start="1093.68" data-end="1096.26">shaking so it gets rid of dead code and</span> <span data-start="1096.26" data-end="1097.82">methods that aren't being used and so on</span> <span data-start="1097.82" data-end="1102.32">and we have our own optimizations that</span> <span data-start="1102.32" data-end="1104.66">we do on top of the closure compiler so</span> <span data-start="1104.66" data-end="1106.94">we get rid of developer codes such as</span> <span data-start="1106.94" data-end="1109.31">blogs that you only use for development</span> <span data-start="1109.31" data-end="1111.59">but your users they shouldn't have to</span> <span data-start="1111.59" data-end="1113.72">download those lungs because they're not</span> <span data-start="1113.72" data-end="1115.85">going to be useful so we get rid of</span> <span data-start="1115.85" data-end="1120.38">those as well on our main page on the</span> </p>
<p><span data-start="1120.38" data-end="1122.96">HTML we use a compression algorithm</span> <span data-start="1122.96" data-end="1125.9">called brought Lee and that saved us 8%</span> <span data-start="1125.9" data-end="1128.36">over gzip which is another compression</span> <span data-start="1128.36" data-end="1131.63">algorithm and then finally I want to</span> <span data-start="1131.63" data-end="1133.85">talk about images because images make up</span> <span data-start="1133.85" data-end="1137.42">64 percent of the bytes of an average</span> <span data-start="1137.42" data-end="1140.3">mobile page that's huge so if you can</span> <span data-start="1140.3" data-end="1143.54">effect images you can have a huge impact</span> <span data-start="1143.54" data-end="1147.98">on the size of the page so we compress</span> <span data-start="1147.98" data-end="1150.32">images the first thing that we do is we</span> <span data-start="1150.32" data-end="1152.87">remove invisible data this is metadata</span> <span data-start="1152.87" data-end="1154.79">that your users don't see such as</span> <span data-start="1154.79" data-end="1159.53">geolocation and so on and we also we</span> <span data-start="1159.53" data-end="1161.54">reduce the quality of the image and we</span> <span data-start="1161.54" data-end="1164.69">try to have one color sample for every</span> <span data-start="1164.69" data-end="1166.94">four pixels and this reduce the image</span> <span data-start="1166.94" data-end="1170.99">size by 40 bytes on top of that in for</span> <span data-start="1170.99" data-end="1173.2">browsers that support WebP II which is</span> <span data-start="1173.2" data-end="1177.16">another image format such as JPEG we</span> <span data-start="1177.16" data-end="1179.72">convert the images to WebP II and that</span> <span data-start="1179.72" data-end="1182.96">reduces the images further and then for</span> </p>
<p><span data-start="1182.96" data-end="1184.67">Chrome users that have data saver</span> <span data-start="1184.67" data-end="1187.22">enabled or places in the world where</span> <span data-start="1187.22" data-end="1190.46">data is extremely slow we lower the</span> <span data-start="1190.46" data-end="1193.79">quality of the images even further to</span> <span data-start="1193.79" data-end="1195.86">save more bytes so now when we apply</span> <span data-start="1195.86" data-end="1197.07">these</span> <span data-start="1197.07" data-end="1200.34">three things on an image let's look at</span> <span data-start="1200.34" data-end="1203.009">the before and after so before we have</span> <span data-start="1203.009" data-end="1206.669">two hundred and forty thousand bytes for</span> <span data-start="1206.669" data-end="1209.779">the left image and the right image has</span> <span data-start="1209.779" data-end="1213.21">25 thousand bytes that's about a 90%</span> <span data-start="1213.21" data-end="1216.269">reduction in bytes and keep in mind</span> <span data-start="1216.269" data-end="1220.559">images make up 65% of your page so</span> <span data-start="1220.559" data-end="1224.61">that's pretty big and you might look at</span> <span data-start="1224.61" data-end="1226.08">it and say you know what I don't like</span> <span data-start="1226.08" data-end="1229.2">the image on the right it's not as good</span> </p>
<p><span data-start="1229.2" data-end="1232.11">I could tell the difference but I want</span> <span data-start="1232.11" data-end="1234.33">to tell you that actually I switched</span> <span data-start="1234.33" data-end="1237.509">them so the image on the right is the</span> <span data-start="1237.509" data-end="1239.82">before the image on the left is actually</span> <span data-start="1239.82" data-end="1246.69">the after so now to summarize everything</span> <span data-start="1246.69" data-end="1249">if you haven't paid attention or if you</span> <span data-start="1249" data-end="1253.23">just walked in to make webpages faster</span> <span data-start="1253.23" data-end="1256.32">we want to unblock the render by making</span> <span data-start="1256.32" data-end="1257.94">sure that scripts are asynchronous so</span> <span data-start="1257.94" data-end="1259.74">you don't have to wait for them you want</span> <span data-start="1259.74" data-end="1262.019">to bring your CSS with you you want to</span> <span data-start="1262.019" data-end="1264.269">inline it and you want to limit it to 50</span> <span data-start="1264.269" data-end="1267.48">kilobytes and third javascript is</span> <span data-start="1267.48" data-end="1270.12">third-party javascript is okay but you</span> <span data-start="1270.12" data-end="1271.44">want to put them in iframes</span> <span data-start="1271.44" data-end="1272.73">so they don't affect the rest of your</span> <span data-start="1272.73" data-end="1274.59">page and you want to prioritize your</span> <span data-start="1274.59" data-end="1276.419">resources you want to load the things</span> <span data-start="1276.419" data-end="1280.11">that the user is going to see first also</span> <span data-start="1280.11" data-end="1283.23">we use opacity magic to make sure that</span> <span data-start="1283.23" data-end="1284.639">this doesn't happen and we're going to</span> <span data-start="1284.639" data-end="1287.07">do server-side rendering in the future</span> <span data-start="1287.07" data-end="1290.7">so that there isn't even a tiny bit of a</span> <span data-start="1290.7" data-end="1294.24">delay and you want to stop shipping by</span> <span data-start="1294.24" data-end="1297.899">having placeholders and static resource</span> <span data-start="1297.899" data-end="1300.029">sizing so that your users don't suffer</span> <span data-start="1300.029" data-end="1302.7">from this atrocity that I'd usually</span> <span data-start="1302.7" data-end="1306.899">commit and then you want to unfreeze</span> <span data-start="1306.899" data-end="1310.86">your page by giving your CPU space to</span> <span data-start="1310.86" data-end="1313.049">breathe so less cell recalculation and</span> <span data-start="1313.049" data-end="1317.07">let the GPU do the animations and then</span> <span data-start="1317.07" data-end="1320.49">if you can do cache optimizations and do</span> <span data-start="1320.49" data-end="1322.409">cheap pre-rendering and compress your</span> <span data-start="1322.409" data-end="1326.129">page so let's see how we're doing 19</span> <span data-start="1326.129" data-end="1328.019">seconds for the average mobile page to</span> <span data-start="1328.019" data-end="1330.509">load and less than one second</span> <span data-start="1330.509" data-end="1334.499">for Ambon search and what does this mean</span> <span data-start="1334.499" data-end="1338.609">well it translates to 10x less data we</span> <span data-start="1338.609" data-end="1341.909">have higher CTR publishers are saying</span> <span data-start="1341.909" data-end="1343.979">higher CTR and higher ad viewer ability</span> <span data-start="1343.979" data-end="1347.729">and today there are about 2 billion amp</span> <span data-start="1347.729" data-end="1351.959">documents from about 900,000 different</span> <span data-start="1351.959" data-end="1357.059">domains so hopefully if you apply some</span> <span data-start="1357.059" data-end="1359.07">of these things you can see similar</span> <span data-start="1359.07" data-end="1362.399">benefits as well and if you don't want</span> <span data-start="1362.399" data-end="1363.869">to do all of that work you're welcome to</span> <span data-start="1363.869" data-end="1367.109">use em now I know this is Jay's cons and</span> <span data-start="1367.109" data-end="1370.139">you all love JavaScript so you might not</span> <span data-start="1370.139" data-end="1372.719">want to use em because it doesn't</span> <span data-start="1372.719" data-end="1374.879">involve writing a lot of JavaScript so</span> </p>
<p><span data-start="1374.879" data-end="1376.799">I'm here to tell you that you're welcome</span> <span data-start="1376.799" data-end="1379.739">to write progressive web app and use em</span> <span data-start="1379.739" data-end="1381.569">for content delivery and that way you</span> <span data-start="1381.569" data-end="1383.789">can write lots of fancy JavaScript and</span> <span data-start="1383.789" data-end="1385.829">if you're passionate about what we do</span> <span data-start="1385.829" data-end="1387.839">and you want to help out amp is an open</span> <span data-start="1387.839" data-end="1389.309">source project and we welcome</span> <span data-start="1389.309" data-end="1390.809">contributors there you're welcome</span> <span data-start="1390.809" data-end="1393.899">to work on the project with us and</span> <span data-start="1393.899" data-end="1397.379">create m components to learn more about</span> <span data-start="1397.379" data-end="1400.079">the m project please go to EMTALA org</span> <span data-start="1400.079" data-end="1402.449">visit our youtube page if you want to</span> <span data-start="1402.449" data-end="1405.239">contribute bitly slash health amp and</span> <span data-start="1405.239" data-end="1407.489">right after this we will be at the am</span> <span data-start="1407.489" data-end="1409.039">booth if you'd like to meet our team</span> <span data-start="1409.039" data-end="1410.84">thank you</span> <span data-start="1410.84" data-end="1412.37">[Applause]</span> <span data-start="1412.37" data-end="1413.74">[Music]</span> </p>
</section>