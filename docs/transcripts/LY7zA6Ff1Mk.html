<section>
<p><span data-start="7.88" data-end="12.139">so yes I'm going to be taking all of</span> <span data-start="12.139" data-end="14.639">taking over all of your browser's for</span> <span data-start="14.639" data-end="17.64">fun because I can a little bit about</span> <span data-start="17.64" data-end="20.52">myself i'm james i like doing stupid</span> <span data-start="20.52" data-end="23.55">things with ruby and javascript and i</span> <span data-start="23.55" data-end="25.65">wrote a bunch of open source stuff that</span> <span data-start="25.65" data-end="27.84">you might have heard of and most</span> <span data-start="27.84" data-end="29.46">important thing about this talk is that</span> <span data-start="29.46" data-end="32.279">there is audience participation as you</span> <span data-start="32.279" data-end="34.62">as i'm sure you'll have seen me tweeting</span> <span data-start="34.62" data-end="39.079">for maybe weeks and if you have a</span> <span data-start="39.079" data-end="42">macintosh computer that's one of the</span> <span data-start="42" data-end="45.059">ones that's got this all apple but and</span> <span data-start="45.059" data-end="47.64">firefox a recent firefox so six or seven</span> <span data-start="47.64" data-end="52.079">i need you to open it and go to this URL</span> <span data-start="52.079" data-end="54.48">and then don't do anything then click on</span> <span data-start="54.48" data-end="55.71">anything thanks line into anything you</span> <span data-start="55.71" data-end="57.66">just have to open that URL and the</span> <span data-start="57.66" data-end="59.76">reason why it will become clear shortly</span> <span data-start="59.76" data-end="65.519">and keep your volume off for now so some</span> <span data-start="65.519" data-end="68.64">backstory why am I doing this this is a</span> <span data-start="68.64" data-end="71.58">band called The Flaming Lips this is</span> <span data-start="71.58" data-end="76.14">something sorry</span> <span data-start="76.15" data-end="83.16">never got that okay turn your sound off</span> <span data-start="83.17" data-end="87.38">thank you awesome so yes this band</span> <span data-start="87.38" data-end="88.82">called flaming lips they're mostly</span> <span data-start="88.82" data-end="91.7">famous these days fulfilling stadiums</span> <span data-start="91.7" data-end="94.7">with balloons and confetti and lots of</span> <span data-start="94.7" data-end="97.82">weird noise and but back in the 90s they</span> <span data-start="97.82" data-end="100.58">released this album called zai rica as</span> </p>
<p><span data-start="100.58" data-end="103.04">Erica came on four discs that you were</span> <span data-start="103.04" data-end="104.69">supposed to play at the same time</span> <span data-start="104.69" data-end="106.85">they're assuming that people had four</span> <span data-start="106.85" data-end="110.36">stereos lying around and the idea was</span> <span data-start="110.36" data-end="111.979">that like a this gave the user some</span> <span data-start="111.979" data-end="114.26">control over listener rather some</span> <span data-start="114.26" data-end="116.119">control over the sound but also took</span> <span data-start="116.119" data-end="117.95">advantage of the fact that CD players</span> <span data-start="117.95" data-end="120.47">aren't perfect their clocks all track at</span> <span data-start="120.47" data-end="122.66">different speeds and they don't track</span> <span data-start="122.66" data-end="124.34">constantly like the same CD player</span> <span data-start="124.34" data-end="127.28">doesn't maintain constant time very well</span> <span data-start="127.28" data-end="130.25">so all the samples on these discs we're</span> <span data-start="130.25" data-end="131.99">kind of getting an out of sync with each</span> <span data-start="131.99" data-end="133.55">other and you'd get interesting effect</span> <span data-start="133.55" data-end="135.17">and like the gaps between tracks would</span> <span data-start="135.17" data-end="137.48">be different on each machine and so</span> <span data-start="137.48" data-end="139.4">they're kind of using multiple outputs</span> <span data-start="139.4" data-end="142.489">to do something interesting this is been</span> <span data-start="142.489" data-end="144.38">called Boredoms from Japan they're a</span> <span data-start="144.38" data-end="146.75">noise rock band they're extremely noisy</span> <span data-start="146.75" data-end="149.959">and they have a7 neck attire they have</span> <span data-start="149.959" data-end="152.66">this array of things that I don't know</span> <span data-start="152.66" data-end="154.16">what they're called that this dude beats</span> <span data-start="154.16" data-end="158.269">with sticks in this picture there's at</span> <span data-start="158.269" data-end="162.739">least one two three four well it's</span> <span data-start="162.739" data-end="166.91">actually 77 drum kits this is a show</span> <span data-start="166.91" data-end="169.01">that put on on 7th of july two thousand</span> <span data-start="169.01" data-end="171.83">seven in brooklyn they got 77 drummers</span> <span data-start="171.83" data-end="173.3">from a bunch of alternative rock bands</span> <span data-start="173.3" data-end="175.97">and played a bunch of their material and</span> <span data-start="175.97" data-end="179.51">it was this crazy mix of kind of like</span> <span data-start="179.51" data-end="182.63">just chaos and then when they all</span> <span data-start="182.63" data-end="184.459">actually stopped deliberately drumming</span> <span data-start="184.459" data-end="186.23">together it's just this tremendous is</span> <span data-start="186.23" data-end="188.75">that this giant robot marching to turn</span> <span data-start="188.75" data-end="190.79">has incredible I've only seen them with</span> <span data-start="190.79" data-end="192.86">seven drummers but that was staggering</span> <span data-start="192.86" data-end="194.6">so I assumed this was just I'm surprised</span> <span data-start="194.6" data-end="197.07">the earth than blow up</span> <span data-start="197.07" data-end="199.96">skip forward a few years I'm seeing a</span> <span data-start="199.96" data-end="202.21">hack day in san francisco and i'm kind</span> <span data-start="202.21" data-end="203.29">of tired of glowing together web</span> <span data-start="203.29" data-end="204.88">services and i want to make some music</span> <span data-start="204.88" data-end="208.99">so I you know I'm kind of looking around</span> <span data-start="208.99" data-end="210.82">for people who know how to do synth</span> <span data-start="210.82" data-end="212.17">stuff because I know nothing about it</span> <span data-start="212.17" data-end="215.17">and I'm not getting anywhere with that</span> <span data-start="215.17" data-end="217.69">and then I think hey there's a bunch of</span> <span data-start="217.69" data-end="219.4">other computers here what if we could</span> <span data-start="219.4" data-end="222.64">make them all make music and so I put</span> <span data-start="222.64" data-end="224.11">together this really simple little synth</span> <span data-start="224.11" data-end="227.08">and it was monophonic it had really</span> <span data-start="227.08" data-end="229.51">basic controls can do very much but we</span> <span data-start="229.51" data-end="230.98">got a room full of computers to play</span> <span data-start="230.98" data-end="232.48">happy birthday to one of the organizers</span> <span data-start="232.48" data-end="238.74">and it sounded just about recognizable</span> <span data-start="238.74" data-end="242.5">but yeah it worked so I want to go away</span> <span data-start="242.5" data-end="243.58">and do something more sophisticated</span> <span data-start="243.58" data-end="245.83">something where you know you could</span> <span data-start="245.83" data-end="248.5">record stuff play loops play chords do</span> <span data-start="248.5" data-end="251.5">effects and that's what I want to show</span> <span data-start="251.5" data-end="255.1">off today I had to confess when I</span> <span data-start="255.1" data-end="256.42">proposed this talk I didn't know what it</span> <span data-start="256.42" data-end="258.07">was going to turn into I just wanted to</span> <span data-start="258.07" data-end="260.71">get hundreds of laptops together and am</span> <span data-start="260.71" data-end="262.99">but I've learned something by building</span> <span data-start="262.99" data-end="264.34">this I hope you guys will get something</span> <span data-start="264.34" data-end="266.98">out of it too so that is where this</span> <span data-start="266.98" data-end="268.96">project came from and so I'm going to</span> <span data-start="268.96" data-end="274.36">try to do a demo and if if this works</span> </p>
<p><span data-start="274.36" data-end="275.95">I'll be tremendously surprised because</span> <span data-start="275.95" data-end="278.35">it has a very high chance of not working</span> <span data-start="278.35" data-end="286.28">at all so let's just take those down</span> <span data-start="286.29" data-end="288.67">yeah if you guys could like refresh your</span> <span data-start="288.67" data-end="290.02">browser's Ashley because it's probably</span> <span data-start="290.02" data-end="293.519">up ready</span> <span data-start="293.529" data-end="299.73">yeah oh well</span> <span data-start="299.74" data-end="305.889">we'll refreshed okay okay so i am just</span> <span data-start="305.889" data-end="308.41">going to try and get a couple people to</span> <span data-start="308.41" data-end="318.46">play this one sample forgot a couple</span> <span data-start="318.46" data-end="323.29">people playing laughs</span> <span data-start="323.3" data-end="345.36">yeah key turn your sound up now</span> <span data-start="345.37" data-end="355.279">if they start buzzing just refresh</span> </p>
<p><span data-start="355.289" data-end="365.03">Oh</span> <span data-start="365.04" data-end="370.51">I feel connected</span> <span data-start="370.52" data-end="371.99">I'm not sure this is thinking of</span> <span data-start="371.99" data-end="385.56">terribly ye</span> <span data-start="385.57" data-end="395.21">alright so a few of them a kind of</span> <span data-start="395.21" data-end="397.73">synced up so you can do those stuff like</span> <span data-start="397.73" data-end="408.47">bringing more samples no it's gonna pick</span> <span data-start="408.47" data-end="410.09">that up okay so it turns out it sounds</span> <span data-start="410.09" data-end="414.5">terrible but nevermind I'm thanks</span> <span data-start="414.5" data-end="423.5">everybody for helping out of that this</span> <span data-start="423.5" data-end="424.46">is what happens when you don't have</span> <span data-start="424.46" data-end="425.84">hundreds of machines at home to test</span> <span data-start="425.84" data-end="432.62">with anyway ok sound off so yeah aside</span> <span data-start="432.62" data-end="435.29">from it being at an incredible failure I</span> <span data-start="435.29" data-end="436.76">have learned a few things while building</span> <span data-start="436.76" data-end="439.73">this so the first of which is how do you</span> <span data-start="439.73" data-end="442.55">generate sound in a browser this is</span> <span data-start="442.55" data-end="444.32">stuff that spinning Firefox for a while</span> <span data-start="444.32" data-end="446.69">it's just coming in to WebKit and chrome</span> <span data-start="446.69" data-end="449.27">and you can program out programmatically</span> <span data-start="449.27" data-end="451.94">generate sound so how do we do that well</span> <span data-start="451.94" data-end="454.37">sound is just waves right and it's</span> <span data-start="454.37" data-end="455.9">represented in the exact same way</span> <span data-start="455.9" data-end="457.7">digitally you just have to produce big</span> <span data-start="457.7" data-end="459.11">strings of numbers and write them to</span> <span data-start="459.11" data-end="461.03">something so this is a really basic</span> <span data-start="461.03" data-end="463.3">sound wave this would produce just a</span> <span data-start="463.3" data-end="469.45">constant</span> <span data-start="469.46" data-end="474.02">yeah all right Kyle so this produces a</span> <span data-start="474.02" data-end="476.479">constant pitch constant volume just pure</span> <span data-start="476.479" data-end="481.099">a single note with no effects no no</span> <span data-start="481.099" data-end="483.34">change in volume no nothing and</span> <span data-start="483.34" data-end="485.449">synthesizers work by taking these waves</span> <span data-start="485.449" data-end="488.36">and modifying them and you just with</span> <span data-start="488.36" data-end="489.68">some really basic modifications you can</span> <span data-start="489.68" data-end="491.479">make some really interesting sounds so</span> <span data-start="491.479" data-end="495.289">one thing you can do is use a low</span> <span data-start="495.289" data-end="497.66">frequency wave to change the volume this</span> <span data-start="497.66" data-end="499.13">is called amplitude modulation and it</span> <span data-start="499.13" data-end="501.16">makes the volume oscillate up and down</span> <span data-start="501.16" data-end="504.259">if you want to replicate kind of more</span> <span data-start="504.259" data-end="507.199">realistic organic instruments so the way</span> <span data-start="507.199" data-end="509.75">the luck if you hit a piano key or you</span> <span data-start="509.75" data-end="511.55">strum a guitar the note will trail off</span> <span data-start="511.55" data-end="514.01">over time so we modeled that is that you</span> <span data-start="514.01" data-end="516.95">play what's called adsr envelope so the</span> <span data-start="516.95" data-end="519.979">sound where you have a tack time which</span> <span data-start="519.979" data-end="521.539">is how long it takes to ramp up to full</span> <span data-start="521.539" data-end="523.909">volume if it decay time which is how</span> <span data-start="523.909" data-end="526.13">long it takes to trail off to their</span> <span data-start="526.13" data-end="528.02">sustain level and the sustained level</span> <span data-start="528.02" data-end="529.61">says how loud it is while you're holding</span> <span data-start="529.61" data-end="531.17">the key down and then there's a decay</span> <span data-start="531.17" data-end="533.3">time that says how long it takes to</span> <span data-start="533.3" data-end="536.089">trail off to silence and just using that</span> <span data-start="536.089" data-end="538.75">you can do some quite interesting things</span> <span data-start="538.75" data-end="541.94">so how now we know how to model sound</span> <span data-start="541.94" data-end="544.42">how do we make browsers spit stuff out</span> <span data-start="544.42" data-end="548.3">so Firefox has this audio object which</span> <span data-start="548.3" data-end="550.16">you make a new one of those and you say</span> </p>
<p><span data-start="550.16" data-end="553.81">I want two channels left and right and a</span> <span data-start="553.81" data-end="558.14">40 44 kilohertz sample rate which is a</span> <span data-start="558.14" data-end="560.329">standard sample rate used in digital</span> <span data-start="560.329" data-end="561.86">audio which means that you have to</span> <span data-start="561.86" data-end="564.97">generate 44,000 data points per second</span> <span data-start="564.97" data-end="566.81">for the sound waves that you're</span> <span data-start="566.81" data-end="569.24">generating and then you just make us</span> <span data-start="569.24" data-end="571.01">that interval loop there like every 10</span> <span data-start="571.01" data-end="573.35">milliseconds say it takes the current</span> <span data-start="573.35" data-end="576.74">time and you get your sound generation</span> <span data-start="576.74" data-end="578.36">stuff to give you a time slice which is</span> <span data-start="578.36" data-end="581.149">just a big array of floats which is just</span> <span data-start="581.149" data-end="584.24">a little you know slice of the wave</span> <span data-start="584.24" data-end="585.62">function for that interval of time and</span> <span data-start="585.62" data-end="588.589">then use the mosrite audio function and</span> <span data-start="588.589" data-end="592.54">that actually writes it to the speakers</span> <span data-start="592.54" data-end="596.839">so within your your your models for</span> <span data-start="596.839" data-end="598.279">generating sound this is basically what</span> <span data-start="598.279" data-end="600.17">what sine waves is doing is it models</span> <span data-start="600.17" data-end="601.5">things using</span> <span data-start="601.5" data-end="603.66">subjects and you cannot unload for a</span> <span data-start="603.66" data-end="604.98">time slice and what that's going to do</span> <span data-start="604.98" data-end="606.81">is it's going to take the current time</span> <span data-start="606.81" data-end="608.85">and the interval you want to generate</span> <span data-start="608.85" data-end="610.65">and the sample rate figure out how many</span> <span data-start="610.65" data-end="612.12">samples you need and then just build up</span> <span data-start="612.12" data-end="615.81">an array and by just going over every</span> <span data-start="615.81" data-end="617.61">little time point in that interval and</span> <span data-start="617.61" data-end="618.96">calculating the value of the way for</span> <span data-start="618.96" data-end="620.67">that point that's a big array and just</span> <span data-start="620.67" data-end="623.25">returned it and then to figure out the</span> <span data-start="623.25" data-end="624.87">value of a note at any particular time</span> <span data-start="624.87" data-end="627.27">there's a bunch of mass that I'm not</span> <span data-start="627.27" data-end="629.76">going to dwell too much on and also I</span> <span data-start="629.76" data-end="631.95">feel like after and judgment talk I</span> <span data-start="631.95" data-end="633.06">should reduce the size of this</span> <span data-start="633.06" data-end="635.88">tremendously there's a bunch of math</span> <span data-start="635.88" data-end="637.05">just to calculate what the values the</span> <span data-start="637.05" data-end="640.74">wave is at that time but we have a</span> <span data-start="640.74" data-end="644.84">problem right and imagine that you</span> <span data-start="644.84" data-end="647.88">assigned a sequential ID to every little</span> <span data-start="647.88" data-end="648.93">bit of data that you're right to an</span> <span data-start="648.93" data-end="652.56">audio stream what you want is a just</span> <span data-start="652.56" data-end="656.22">continuous uninterruptedly IDs going</span> <span data-start="656.22" data-end="658.89">through with no no sections repeated no</span> <span data-start="658.89" data-end="661.74">bits skipped but as we know JavaScript</span> <span data-start="661.74" data-end="663.33">timers are tremendously accurate if you</span> <span data-start="663.33" data-end="664.89">can you can say that you want to loop to</span> <span data-start="664.89" data-end="666.39">fire every 10 milliseconds but it will</span> <span data-start="666.39" data-end="668.52">never actually do exactly that right</span> <span data-start="668.52" data-end="669.63">sometimes there'll be a bit late</span> <span data-start="669.63" data-end="672.57">sometimes a bit be a bit early and the</span> <span data-start="672.57" data-end="675.65">code that we had her head here that's</span> <span data-start="675.65" data-end="677.97">just getting the current time to figure</span> <span data-start="677.97" data-end="679.5">out what the kind of starting index of</span> <span data-start="679.5" data-end="682.41">your your slices so what that's going to</span> <span data-start="682.41" data-end="684.42">do in practice is it like we might write</span> <span data-start="684.42" data-end="686.19">a couple of loops have just you know</span> <span data-start="686.19" data-end="687.99">uninterruptedly the first one we do</span> <span data-start="687.99" data-end="689.97">naught to nine and then we do 10 to 19</span> <span data-start="689.97" data-end="691.53">and that's fine but then the third</span> <span data-start="691.53" data-end="693.66">iteration starts a bit early so we</span> <span data-start="693.66" data-end="696.3">repeat a bit of the last one and what</span> <span data-start="696.3" data-end="697.73">that ends up doing to the sound is this</span> <span data-start="697.73" data-end="700.26">which sounds really really horrible if</span> <span data-start="700.26" data-end="702.18">you and if you implement your sound like</span> <span data-start="702.18" data-end="704.37">that you'll get kind of an overlay of</span> <span data-start="704.37" data-end="706.14">white noise on top of on top of the</span> <span data-start="706.14" data-end="708.39">sound so what you did to fix that is you</span> <span data-start="708.39" data-end="711.6">just maintain your encounter right each</span> <span data-start="711.6" data-end="713.13">iteration of your loop you increment the</span> <span data-start="713.13" data-end="715.2">counter of how the big your interval is</span> <span data-start="715.2" data-end="717.99">it needs that at the current time but</span> <span data-start="717.99" data-end="718.98">then you've got another problem right</span> <span data-start="718.98" data-end="720.089">because you basically introduced your</span> <span data-start="720.089" data-end="721.64">own idea of what time is which is</span> <span data-start="721.64" data-end="723.81">potentially going to differ and drift</span> <span data-start="723.81" data-end="726.03">from real time as you go on so that</span> <span data-start="726.03" data-end="727.95">means that anything you timestamp in a</span> <span data-start="727.95" data-end="730.14">synthesizer like when user input happens</span> <span data-start="730.14" data-end="731.76">what the duration of a note</span> <span data-start="731.76" data-end="734.58">is what frequency is all that stuff you</span> <span data-start="734.58" data-end="736.5">have to base it on your counter not on</span> <span data-start="736.5" data-end="738.18">the built-in date object because they</span> <span data-start="738.18" data-end="740.61">will differ and you know the the</span> <span data-start="740.61" data-end="742.47">playback loops won't quite join up</span> <span data-start="742.47" data-end="746.94">probably so that we can model sound we</span> <span data-start="746.94" data-end="749.01">need a way of doing user input and it</span> <span data-start="749.01" data-end="751.11">turns out this if you are if you've</span> <span data-start="751.11" data-end="752.49">already got away that you're modeling</span> <span data-start="752.49" data-end="754.2">sound waves this is pretty easy right</span> <span data-start="754.2" data-end="755.6">you just figure out a way of mapping</span> <span data-start="755.6" data-end="758.31">keyboard input two frequencies which you</span> <span data-start="758.31" data-end="760.38">can pick whatever you like for sine</span> <span data-start="760.38" data-end="763.02">waves I'm just saying like like pick a</span> <span data-start="763.02" data-end="766.11">key like a major and just take all the</span> <span data-start="766.11" data-end="767.16">notes in that key and just match them</span> <span data-start="767.16" data-end="769.7">sequentially onto the onto the keyboard</span> <span data-start="769.7" data-end="771.99">so when a key is struck you go what</span> <span data-start="771.99" data-end="774.42">what's the frequency of that key you may</span> <span data-start="774.42" data-end="777.03">can you know with that frequency and you</span> <span data-start="777.03" data-end="778.56">time stamp it with the current time so</span> <span data-start="778.56" data-end="780.75">every note has one of those envelopes</span> <span data-start="780.75" data-end="783.15">that showed a second ago that decides</span> <span data-start="783.15" data-end="785.88">how its volume varies over time how it</span> <span data-start="785.88" data-end="788.25">picks up our trails off and so you need</span> <span data-start="788.25" data-end="789.96">to you need to tell it when it was</span> <span data-start="789.96" data-end="791.76">pressed and when the key was lifted so</span> <span data-start="791.76" data-end="793.56">that it knows what that envelope looks</span> <span data-start="793.56" data-end="797.04">like and when you pick a key up all you</span> <span data-start="797.04" data-end="800.01">do is you look up the note that that key</span> <span data-start="800.01" data-end="802.62">code last generated and time stamp it</span> <span data-start="802.62" data-end="804.78">with a key up time and then it the</span> <span data-start="804.78" data-end="807.99">volume RL off a recording works in much</span> <span data-start="807.99" data-end="810.84">the same way so instead of storing all</span> <span data-start="810.84" data-end="813.78">the audio data that we generate which is</span> <span data-start="813.78" data-end="815.67">huge volumes of numbers which would be</span> <span data-start="815.67" data-end="818.49">expensive to transmit in store all you</span> <span data-start="818.49" data-end="819.96">do is you record the user input because</span> <span data-start="819.96" data-end="821.49">you can completely reconstruct the sound</span> <span data-start="821.49" data-end="824.37">from the user input so in this case</span> <span data-start="824.37" data-end="826.08">instead of making you notes all you do</span> <span data-start="826.08" data-end="828.03">is you just like record some events</span> <span data-start="828.03" data-end="830.7">right you say at this time this key was</span> <span data-start="830.7" data-end="832.8">pressed with this frequency on this</span> <span data-start="832.8" data-end="835.95">channel and the same for Kia and what</span> <span data-start="835.95" data-end="839.07">that gets you is just some information</span> <span data-start="839.07" data-end="840.6">that says how long the recording was</span> <span data-start="840.6" data-end="843.51">which means how you know if it lasts</span> <span data-start="843.51" data-end="845.22">eight seconds that means you like every</span> <span data-start="845.22" data-end="847.92">eight seconds you restart the lip and a</span> <span data-start="847.92" data-end="849.12">list of events that says like which</span> <span data-start="849.12" data-end="850.59">which keys were pressed at what times</span> <span data-start="850.59" data-end="853.53">and what frequencies those map T so then</span> <span data-start="853.53" data-end="855.03">for playback all you have to do is like</span> <span data-start="855.03" data-end="856.62">in your timer loop every time you hit a</span> <span data-start="856.62" data-end="858.21">multiple of the recording generate</span> <span data-start="858.21" data-end="860.49">duration you just schedule a bunch of</span> <span data-start="860.49" data-end="862.209">these events 22</span> <span data-start="862.209" data-end="865.92">play the notes in the right sequence so</span> <span data-start="865.92" data-end="868.179">now we can play stuff on our own</span> <span data-start="868.179" data-end="869.74">machines but how do we get that to other</span> <span data-start="869.74" data-end="873.04">people right so the setup that I'm using</span> <span data-start="873.04" data-end="876.149">is I'm running node on the server with</span> <span data-start="876.149" data-end="879.759">express for handling web requests so</span> <span data-start="879.759" data-end="883.179">that deals with the you know saving and</span> <span data-start="883.179" data-end="884.35">retrieving the Jason for these</span> <span data-start="884.35" data-end="886.389">performances it deals with serving you</span> <span data-start="886.389" data-end="889.059">the pages that you can see and i'm using</span> <span data-start="889.059" data-end="890.709">faithful pub/sub and that's all backed</span> <span data-start="890.709" data-end="895.329">up with a reduced database and you have</span> <span data-start="895.329" data-end="897.91">a really simple JSON representation for</span> <span data-start="897.91" data-end="899.499">performances so performance is just an</span> <span data-start="899.499" data-end="902.41">array of channels each channel has a ton</span> <span data-start="902.41" data-end="903.819">of settings all those little sliders</span> <span data-start="903.819" data-end="905.129">that you could see those all represent</span> <span data-start="905.129" data-end="907.119">parameters that can change how the sound</span> <span data-start="907.119" data-end="909.339">works so a channel is just an object</span> <span data-start="909.339" data-end="911.139">that has all those settings in it and it</span> <span data-start="911.139" data-end="913.869">optionally will have what the settings</span> <span data-start="913.869" data-end="915.459">touching the keyboard are and whether</span> <span data-start="915.459" data-end="916.929">there's a recording on that channel so</span> <span data-start="916.929" data-end="919.569">you can live it so all the browser is</span> <span data-start="919.569" data-end="921.459">doing is it's taking that sending it to</span> <span data-start="921.459" data-end="924.999">server service rubs it in Reader's so if</span> <span data-start="924.999" data-end="927.339">if all your domain objects have a to</span> </p>
<p><span data-start="927.339" data-end="928.869">Jason method you can just really easily</span> <span data-start="928.869" data-end="933.069">use xhr to save and retrieve these</span> <span data-start="933.069" data-end="935.29">things and you can use phaser pub/sub</span> <span data-start="935.29" data-end="938.019">channels to to get updates so every time</span> <span data-start="938.019" data-end="940.209">that you change a little setting that</span> <span data-start="940.209" data-end="941.47">saved it to the server and then the</span> <span data-start="941.47" data-end="942.819">stove is going to use Faye to push it</span> <span data-start="942.819" data-end="945.959">and to all the people who are listening</span> <span data-start="945.959" data-end="950.319">so this brings me to the kind of main</span> <span data-start="950.319" data-end="952.029">thing that I learned which you've</span> <span data-start="952.029" data-end="955.99">already seen a demonstration of timed</span> <span data-start="955.99" data-end="964.749">kind of hard to get right yeah it's just</span> <span data-start="964.749" data-end="966.639">nasty right as you can see like sinking</span> <span data-start="966.639" data-end="968.559">clocks is just hard that didn't work</span> <span data-start="968.559" data-end="972.759">very well it works I've seen it work</span> <span data-start="972.759" data-end="975.429">okay on smaller scales as smaller groups</span> <span data-start="975.429" data-end="977.47">and I have no to get some quite good</span> <span data-start="977.47" data-end="979.089">numbers out of my clocks but it doesn't</span> <span data-start="979.089" data-end="983.889">always translate into good music and if</span> <span data-start="983.889" data-end="985.149">you've always over the top for me so</span> <span data-start="985.149" data-end="986.949">invoke Stephen Hawking for this this is</span> <span data-start="986.949" data-end="988.749">a problem that cutting-edge science has</span> <span data-start="988.749" data-end="990.819">right now there are people disputing the</span> <span data-start="990.819" data-end="992.98">fuss than light neutrinos because they</span> <span data-start="992.98" data-end="993.26">think</span> <span data-start="993.26" data-end="995.74">the guy's got their clocks thanks wrong</span> <span data-start="995.74" data-end="997.85">so how are we going to sing the clots</span> <span data-start="997.85" data-end="999.59">well it turns out there's an established</span> <span data-start="999.59" data-end="1000.97">way of doing this in UNIX it's called</span> <span data-start="1000.97" data-end="1004.12">ntp the network Time Protocol and that</span> <span data-start="1004.12" data-end="1007.18">uses timestamps that have a 2 to the</span> <span data-start="1007.18" data-end="1011.62">minus 32 second resolution which I don't</span> <span data-start="1011.62" data-end="1014.38">know how useful that is in practice it</span> <span data-start="1014.38" data-end="1016.03">turns out that's 10 orders of magnitude</span> <span data-start="1016.03" data-end="1019.51">smaller than the the lifetime of the top</span> <span data-start="1019.51" data-end="1021.25">quark which is so unstable that it</span> <span data-start="1021.25" data-end="1022.42">wasn't observed until nineteen</span> <span data-start="1022.42" data-end="1024.85">ninety-five in a custom-built particle</span> <span data-start="1024.85" data-end="1027.07">accelerator so I don't know how useful</span> <span data-start="1027.07" data-end="1029.41">that is but it's a lot more useful than</span> <span data-start="1029.41" data-end="1031.06">what we have in JavaScript land which is</span> <span data-start="1031.06" data-end="1034.86">just milliseconds which are I mean even</span> <span data-start="1034.86" data-end="1037.03">even that you know the millisecond</span> <span data-start="1037.03" data-end="1038.44">counts that you get are just you know</span> <span data-start="1038.44" data-end="1040.15">inaccurate you see this with timers and</span> <span data-start="1040.15" data-end="1042.459">you can't he doesn't even go down two</span> <span data-start="1042.459" data-end="1046.089">microseconds or anything but it turns</span> <span data-start="1046.089" data-end="1047.98">out like for some cases that's that's</span> <span data-start="1047.98" data-end="1051.91">good enough right the the kind of the</span> <span data-start="1051.91" data-end="1054.04">lesson that I took from from Zurich is</span> <span data-start="1054.04" data-end="1056.2">that stuff doesn't have to be perfect it</span> <span data-start="1056.2" data-end="1058.24">just has to be interesting and whether</span> <span data-start="1058.24" data-end="1061.3">it is interesting is a function of you</span> <span data-start="1061.3" data-end="1062.92">know you can't go to outside the Ranger</span> <span data-start="1062.92" data-end="1064.3">it just sounds like noise but it also</span> <span data-start="1064.3" data-end="1067.3">doesn't have to be perfect so we can use</span> <span data-start="1067.3" data-end="1070.3">this and this is basically what ntp does</span> <span data-start="1070.3" data-end="1072.82">and you have a client and the client</span> <span data-start="1072.82" data-end="1074.74">goes i want to sing my my clock with a</span> <span data-start="1074.74" data-end="1077.59">with an upstream server so what it does</span> <span data-start="1077.59" data-end="1079.6">is it creates a message and it puts a</span> <span data-start="1079.6" data-end="1081.19">timestamp teaser on that message that's</span> <span data-start="1081.19" data-end="1083.23">when the client sent them at the the</span> <span data-start="1083.23" data-end="1085.18">message to the server and when the</span> <span data-start="1085.18" data-end="1086.86">server receives it puts his own time</span> <span data-start="1086.86" data-end="1089.83">stamp on at t1 to say i got i got this</span> <span data-start="1089.83" data-end="1091.69">message at this time that's going to be</span> <span data-start="1091.69" data-end="1093.43">in a different time frame to what the</span> <span data-start="1093.43" data-end="1094.84">clients using because their clocks are</span> <span data-start="1094.84" data-end="1097.33">synchronized yet and then the server's</span> <span data-start="1097.33" data-end="1098.29">going to hang onto it for a certain</span> <span data-start="1098.29" data-end="1099.97">amount of time there's processing there</span> <span data-start="1099.97" data-end="1101.95">needs to be done that it's not sent back</span> <span data-start="1101.95" data-end="1104.32">immediately so puts another time stamp</span> <span data-start="1104.32" data-end="1105.64">on it to say when it's sent it back to</span> <span data-start="1105.64" data-end="1108.01">the client and that's t2 and then when</span> <span data-start="1108.01" data-end="1109.33">the client eventually receives the</span> <span data-start="1109.33" data-end="1111.34">message back it puts a final time stamp</span> <span data-start="1111.34" data-end="1114.22">on it t three now if you didn't have a</span> <span data-start="1114.22" data-end="1118.75">network latency to take care about the</span> <span data-start="1118.75" data-end="1120.49">difference between the two clocks would</span> <span data-start="1120.49" data-end="1122.89">just be t1 minus t0 right the client</span> <span data-start="1122.89" data-end="1124.35">says the server I think it's this time</span> <span data-start="1124.35" data-end="1125.91">the server goes is actually this time</span> <span data-start="1125.91" data-end="1128.309">and you just send that straight back but</span> <span data-start="1128.309" data-end="1129.6">we have networks and they have latency</span> <span data-start="1129.6" data-end="1132.69">and that can be you know hundreds of</span> <span data-start="1132.69" data-end="1135.03">milliseconds seconds depending on you</span> <span data-start="1135.03" data-end="1139.2">know where these these things are so how</span> <span data-start="1139.2" data-end="1140.61">we actually calculate the offset is that</span> <span data-start="1140.61" data-end="1141.96">we know the total elapsed time on the</span> <span data-start="1141.96" data-end="1144.84">client side that's t3 minus t0 and we</span> <span data-start="1144.84" data-end="1146.16">know how much time the server took</span> <span data-start="1146.16" data-end="1148.169">holding on to the message at t2 minus t1</span> <span data-start="1148.169" data-end="1151.47">and assuming those clocks run at about</span> <span data-start="1151.47" data-end="1154.23">the same rate over a short time span you</span> <span data-start="1154.23" data-end="1156">can just subtract those two to get the</span> <span data-start="1156" data-end="1158.429">the network round-trip time so you</span> <span data-start="1158.429" data-end="1160.409">calculate that you have it and you take</span> <span data-start="1160.409" data-end="1163.65">it and you subtract it from the</span> <span data-start="1163.65" data-end="1166.02">difference between t1 minus 20 and that</span> <span data-start="1166.02" data-end="1169.5">tells the client and what the what the</span> <span data-start="1169.5" data-end="1173.46">difference between the clock says so we</span> <span data-start="1173.46" data-end="1174.99">can use phase pub/sub channels to this</span> <span data-start="1174.99" data-end="1176.309">right we can get browsers to send</span> <span data-start="1176.309" data-end="1179.22">messages to each other so the client</span> <span data-start="1179.22" data-end="1180.9">could publish a message to the time</span> <span data-start="1180.9" data-end="1184.23">channel with its t0 whatever it thinks</span> <span data-start="1184.23" data-end="1186.059">the current time is and then the server</span> <span data-start="1186.059" data-end="1189.09">could can listen on that channel and</span> <span data-start="1189.09" data-end="1190.71">process it which we'll see in a second</span> <span data-start="1190.71" data-end="1192.75">and the client will also have to</span> <span data-start="1192.75" data-end="1195.059">subscribe to a channel where it can pick</span> <span data-start="1195.059" data-end="1197.01">up the responses from the server so</span> <span data-start="1197.01" data-end="1199.289">clicks a unique ID and it listens on a</span> <span data-start="1199.289" data-end="1201.299">channel that contains that unique ID so</span> <span data-start="1201.299" data-end="1202.44">when it gets a message back from the</span> <span data-start="1202.44" data-end="1204.419">server it can look at the timestamps on</span> <span data-start="1204.419" data-end="1206.34">that message and do the kind of ntp</span> <span data-start="1206.34" data-end="1208.26">algorithm stuff to figure out what how</span> <span data-start="1208.26" data-end="1210.71">much it should adjust its own clock by</span> <span data-start="1210.71" data-end="1212.76">so on the server side the server's</span> <span data-start="1212.76" data-end="1214.169">subscribe to the time channel so it's</span> <span data-start="1214.169" data-end="1215.37">going to receive those messages that</span> <span data-start="1215.37" data-end="1217.83">clients publishing and and it's just</span> <span data-start="1217.83" data-end="1219.03">going to go okay well I'm going to</span> <span data-start="1219.03" data-end="1221.1">return you the t0 that you gave me and</span> </p>
<p><span data-start="1221.1" data-end="1223.799">I'm going to attach my own t1 and t2 of</span> <span data-start="1223.799" data-end="1228.09">whatever those are so it's pretty simple</span> <span data-start="1228.09" data-end="1232.62">but it basically relies on on on your</span> <span data-start="1232.62" data-end="1235.89">network being reasonably responsive if</span> <span data-start="1235.89" data-end="1238.11">you have highlighted see if you have</span> <span data-start="1238.11" data-end="1240.99">noisy latency if you have asymmetric up</span> <span data-start="1240.99" data-end="1242.52">and download speeds between these two</span> <span data-start="1242.52" data-end="1245.13">people that throws the algorithm off</span> <span data-start="1245.13" data-end="1246.539">right it just gets stuff wrong as soon</span> <span data-start="1246.539" data-end="1248.97">as you have noise when it tries to</span> <span data-start="1248.97" data-end="1250.32">figure out what the round-trip time is</span> <span data-start="1250.32" data-end="1251.82">it's going to take half of the total</span> <span data-start="1251.82" data-end="1254.669">time and if there's a symmetric up and</span> <span data-start="1254.669" data-end="1255.059">download</span> <span data-start="1255.059" data-end="1256.62">these that's not gonna be a right thing</span> <span data-start="1256.62" data-end="1259.679">and the greater latency that you have in</span> <span data-start="1259.679" data-end="1261.659">your network the higher that margin of</span> <span data-start="1261.659" data-end="1263.549">error gets and you just get out of sync</span> <span data-start="1263.549" data-end="1266.49">by 100 milliseconds seconds in some</span> <span data-start="1266.49" data-end="1271.049">cases so we're kind of thinking that we</span> <span data-start="1271.049" data-end="1272.309">have a model like this right web</span> <span data-start="1272.309" data-end="1273.84">browsers can send messages to each other</span> <span data-start="1273.84" data-end="1275.1">and they're kind of communicating</span> <span data-start="1275.1" data-end="1277.559">directly but that isn't really what's</span> <span data-start="1277.559" data-end="1279.509">happening they actually going virus</span> <span data-start="1279.509" data-end="1281.1">server right when you use any pub/sub</span> <span data-start="1281.1" data-end="1282.929">service the browser standing message to</span> <span data-start="1282.929" data-end="1283.95">a server and the show is going to</span> <span data-start="1283.95" data-end="1287.669">forward it on somewhere else so that's</span> <span data-start="1287.669" data-end="1289.619">already kind of you know latency that we</span> <span data-start="1289.619" data-end="1290.879">haven't thought of giving our mental</span> <span data-start="1290.879" data-end="1292.769">model of how this works but it's even</span> <span data-start="1292.769" data-end="1294.119">worse than that because these machines</span> <span data-start="1294.119" data-end="1295.35">are probably going to be on a Wi-Fi</span> <span data-start="1295.35" data-end="1297.45">network depending on what your Wi-Fi</span> <span data-start="1297.45" data-end="1300.119">hardware is like that can introduce huge</span> <span data-start="1300.119" data-end="1301.259">amounts of noise to your network</span> <span data-start="1301.259" data-end="1303.08">connection I tried this out at home</span> <span data-start="1303.08" data-end="1306.059">using Wi-Fi and putting an ethernet</span> <span data-start="1306.059" data-end="1308.73">cable to my router and the amount of</span> <span data-start="1308.73" data-end="1311.539">latency the Wi-Fi introduces is horrible</span> <span data-start="1311.539" data-end="1314.19">so that's more noise and every one of</span> <span data-start="1314.19" data-end="1318.119">these lengths introduces introduces more</span> <span data-start="1318.119" data-end="1321.48">latency it introduces variability and</span> <span data-start="1321.48" data-end="1322.86">that all adds up in a really horrible</span> <span data-start="1322.86" data-end="1325.049">way so to make this thing kind of</span> <span data-start="1325.049" data-end="1329.549">unusable so we can t have a system like</span> <span data-start="1329.549" data-end="1331.799">this where we have one master which is</span> <span data-start="1331.799" data-end="1333.6">the browser being used by the performer</span> <span data-start="1333.6" data-end="1338.22">and we have a bunch of listeners so all</span> <span data-start="1338.22" data-end="1340.139">you guys in the audience the guys at the</span> <span data-start="1340.139" data-end="1341.97">bottom and my machine is machine at the</span> <span data-start="1341.97" data-end="1344.159">top and you you're all asking me for the</span> <span data-start="1344.159" data-end="1345.6">current time so you can sync your clocks</span> <span data-start="1345.6" data-end="1349.08">what if instead we use the model like</span> <span data-start="1349.08" data-end="1350.909">this right we've run a clock on the</span> <span data-start="1350.909" data-end="1352.86">server the server can sync with the</span> <span data-start="1352.86" data-end="1355.499">master and then all the clients will</span> <span data-start="1355.499" data-end="1357.24">sync with that clock on the server so</span> <span data-start="1357.24" data-end="1359.879">that kind of made a it removes some work</span> <span data-start="1359.879" data-end="1362.429">from from the master machine because</span> <span data-start="1362.429" data-end="1363.6">it's not having to deal with all these</span> <span data-start="1363.6" data-end="1367.08">incoming messages which is helpful</span> <span data-start="1367.08" data-end="1369.36">because any extra work that the</span> <span data-start="1369.36" data-end="1370.35">browser's trying to do while it's</span> <span data-start="1370.35" data-end="1373.11">generating audio is just interference</span> <span data-start="1373.11" data-end="1374.82">right if you update the UI if there's</span> <span data-start="1374.82" data-end="1378.059">expensive computations going on and it</span> <span data-start="1378.059" data-end="1380.999">gives it less less bandwidth to deal</span> <span data-start="1380.999" data-end="1382.659">with making audio</span> <span data-start="1382.659" data-end="1384.909">it makes the sound choppy and that's why</span> <span data-start="1384.909" data-end="1387.099">in that interface for example there</span> <span data-start="1387.099" data-end="1390.159">isn't like I want to have am like a</span> <span data-start="1390.159" data-end="1391.869">progress bar that would track how faster</span> <span data-start="1391.869" data-end="1393.82">if through a recording air like if I</span> <span data-start="1393.82" data-end="1396.009">record on one channel and then I want to</span> <span data-start="1396.009" data-end="1397.269">record something over the top of it I</span> <span data-start="1397.269" data-end="1398.59">want to make sure I'm in time so I want</span> <span data-start="1398.59" data-end="1400.269">to see how far along we are just adding</span> <span data-start="1400.269" data-end="1402.099">that made it completely unusable all</span> <span data-start="1402.099" data-end="1404.769">those little updates of the Dom made the</span> <span data-start="1404.769" data-end="1407.109">sound really choppy and this hottie is</span> <span data-start="1407.109" data-end="1409.84">and so if you introduce this the browser</span> <span data-start="1409.84" data-end="1412.649">does less work and it also means that</span> <span data-start="1412.649" data-end="1417.609">the the there's less there's less</span> <span data-start="1417.609" data-end="1419.289">network distance basically between the</span> <span data-start="1419.289" data-end="1420.369">clients and the thing they're trying to</span> <span data-start="1420.369" data-end="1421.96">sync with and the important thing in</span> <span data-start="1421.96" data-end="1423.82">this kind of situation is not that</span> <span data-start="1423.82" data-end="1425.169">you're all synced up with the performer</span> <span data-start="1425.169" data-end="1426.759">but you're synched up with each other</span> <span data-start="1426.759" data-end="1428.979">because that's what is producing the</span> <span data-start="1428.979" data-end="1431.979">sound and it turns out if you go to this</span> <span data-start="1431.979" data-end="1433.359">model depending on your network I've</span> <span data-start="1433.359" data-end="1436.72">seen tenfold improvements in in Sinking</span> <span data-start="1436.72" data-end="1439.45">like I've got and like hundreds of</span> <span data-start="1439.45" data-end="1441.369">clocks on my machine synced within a</span> <span data-start="1441.369" data-end="1443.289">millisecond using a pub sub server on</span> <span data-start="1443.289" data-end="1446.619">the other side of the planet but it</span> <span data-start="1446.619" data-end="1448.509">turns out that this can also introduce</span> <span data-start="1448.509" data-end="1450.58">instabilities right you can get jumps</span> <span data-start="1450.58" data-end="1452.32">when the server if the server gets</span> <span data-start="1452.32" data-end="1454.869">behind the performers computer it can</span> <span data-start="1454.869" data-end="1456.7">kind of jump forward it can jump back</span> <span data-start="1456.7" data-end="1459.039">and it turns out that this particular</span> <span data-start="1459.039" data-end="1461.169">model is just really bad for producing</span> <span data-start="1461.169" data-end="1464.109">music you get like even if the numbers</span> <span data-start="1464.109" data-end="1465.34">look really good out of your clocks the</span> <span data-start="1465.34" data-end="1466.899">sound that comes out of your speakers is</span> <span data-start="1466.899" data-end="1473.229">just noise so that about wraps it up</span> <span data-start="1473.229" data-end="1476.2">you've got a synthesizer or beer one</span> <span data-start="1476.2" data-end="1478.119">that didn't work terribly well its top</span> <span data-start="1478.119" data-end="1479.889">to bottom JavaScript client-side and</span> <span data-start="1479.889" data-end="1481.69">server-side and to sort of find a level</span> <span data-start="1481.69" data-end="1483.82">of easter egg this funky little logo</span> <span data-start="1483.82" data-end="1486.549">that I made for it is also JavaScript</span> <span data-start="1486.549" data-end="1488.2">it's just written using the canvas</span> <span data-start="1488.2" data-end="1491.139">element and a bit of math so thank you</span> <span data-start="1491.139" data-end="1500.96">all for listening</span> <span data-start="1500.97" data-end="1507.34">can have questions hey everybody's just</span> <span data-start="1507.34" data-end="1520.4">baffled okay</span> <span data-start="1520.41" data-end="1522.31">first of all I didn't think it was a</span> <span data-start="1522.31" data-end="1523.84">failure i thought i was totally cool the</span> <span data-start="1523.84" data-end="1526.48">demo yes yes here was really good you</span> <span data-start="1526.48" data-end="1527.95">should whatever he is going on are you</span> <span data-start="1527.95" data-end="1529.81">hearing a mix i was hearing pockets of</span> <span data-start="1529.81" data-end="1532.42">of good and then pockets of just oh god</span> </p>
<p><span data-start="1532.42" data-end="1534.25">I really no I thought I was cool it was</span> <span data-start="1534.25" data-end="1535.96">cool at all so cool when two people</span> <span data-start="1535.96" data-end="1537.31">playing different things like that would</span> <span data-start="1537.31" data-end="1539.59">change how would you do bud vet sorry</span> <span data-start="1539.59" data-end="1542.23">how do you do bug that um how would you</span> <span data-start="1542.23" data-end="1544.45">mean if you if it's not you what it was</span> <span data-start="1544.45" data-end="1546.13">like I've been trying to figure this out</span> <span data-start="1546.13" data-end="1548.02">like whether it's possible for a client</span> <span data-start="1548.02" data-end="1549.25">to tell that it's doing a bad job</span> <span data-start="1549.25" data-end="1551.41">because all it has to go on is whether</span> <span data-start="1551.41" data-end="1553.21">it's clogged to some type properly right</span> <span data-start="1553.21" data-end="1555.13">you could do some stuff like detect that</span> <span data-start="1555.13" data-end="1556.63">you hadn't received any messages for a</span> <span data-start="1556.63" data-end="1559.06">while and maybe tell her to shut up if</span> <span data-start="1559.06" data-end="1562.27">that hadn't happened but it's it's it's</span> <span data-start="1562.27" data-end="1564.94">kind of tricky to get clients to shut up</span> <span data-start="1564.94" data-end="1566.85">if they're not behaving properly and</span> <span data-start="1566.85" data-end="1574.89">yeah I did welcome</span> </p>
</section>