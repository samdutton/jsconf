<section>
<p><span data-start="8.09" data-end="11.7">welcome and Jason brief is a sort of</span> <span data-start="11.7" data-end="14.219">strange confluences of people whose name</span> <span data-start="14.219" data-end="17.19">starts with k andar Chris I think there</span> <span data-start="17.19" data-end="19.26">are three of us it's really weird but</span> <span data-start="19.26" data-end="21.09">there's Chris's eyes and Chris Walker</span> <span data-start="21.09" data-end="23.91">and me which makes the mailing list a</span> <span data-start="23.91" data-end="25.59">bit confusing but that which brings me</span> <span data-start="25.59" data-end="28.609">to the point commonjs is a mailing list</span> <span data-start="28.609" data-end="32.899">and a wiki and our Charter is to develop</span> <span data-start="32.899" data-end="36.11">specifications for JavaScript ad hoc</span> <span data-start="36.11" data-end="41.37">from from the grassroots for contexts on</span> <span data-start="41.37" data-end="43.01">the browser and outside of the browser</span> <span data-start="43.01" data-end="46.5">and beyond we started about two years</span> <span data-start="46.5" data-end="48.84">ago by Kevin Dan goor with a blog post</span> <span data-start="48.84" data-end="52.41">and there are first our first thing that</span> <span data-start="52.41" data-end="54.03">we did was we constructed a module spec</span> <span data-start="54.03" data-end="57.6">which was probably most noted because</span> <span data-start="57.6" data-end="59.67">node implemented it pretty quickly on</span> <span data-start="59.67" data-end="62.879">and it's certainly the the widest</span> <span data-start="62.879" data-end="64.32">deployment of it it's but not the only</span> <span data-start="64.32" data-end="67.68">there's also Narwhal gypsy whole bunch</span> <span data-start="67.68" data-end="69.33">of server-side embeddings also in the</span> <span data-start="69.33" data-end="73.369">browser for by a few so the perp the</span> <span data-start="73.369" data-end="76.68">purpose for the group originally last</span> <span data-start="76.68" data-end="78.03">year has been really quiet for common</span> <span data-start="78.03" data-end="80.509">j/s the group was originally started</span> <span data-start="80.509" data-end="82.35">because there were a whole bunch of</span> <span data-start="82.35" data-end="84.84">server-side JavaScript frameworks that</span> <span data-start="84.84" data-end="87.869">we're not really taking off and the</span> </p>
<p><span data-start="87.869" data-end="90.329">Kevin's theory at the time was that the</span> <span data-start="90.329" data-end="91.619">reason they weren't taking off was</span> <span data-start="91.619" data-end="93.03">because it was kind of pointless to</span> <span data-start="93.03" data-end="94.59">write JavaScript for any single one of</span> <span data-start="94.59" data-end="98.329">these sort of somewhat cramped platforms</span> <span data-start="98.329" data-end="100.47">because he really couldn't you could</span> <span data-start="100.47" data-end="102.03">there was no escape route you couldn't</span> <span data-start="102.03" data-end="104.25">go to a better system if you could if</span> <span data-start="104.25" data-end="106.29">you found one there was no degree of</span> <span data-start="106.29" data-end="108.149">interoperability they were just you just</span> <span data-start="108.149" data-end="109.619">have to rewrite it every time you move</span> <span data-start="109.619" data-end="112.14">to a new platform so he started the</span> <span data-start="112.14" data-end="115.02">group to work on some of the basic</span> <span data-start="115.02" data-end="116.04">standards that we would need for</span> <span data-start="116.04" data-end="118.34">server-side in systems programming</span> <span data-start="118.34" data-end="121.56">things like a module has a basis for</span> <span data-start="121.56" data-end="125.369">everything packaging binary data file</span> <span data-start="125.369" data-end="129.39">systems and IO within the so we worked</span> <span data-start="129.39" data-end="130.86">pretty hard the first year to get</span> <span data-start="130.86" data-end="133.74">file systems and binary and stuff like</span> <span data-start="133.74" data-end="136.62">that worked out but we were going to go</span> <span data-start="136.62" data-end="139.26">in the wrong direction and node sort of</span> <span data-start="139.26" data-end="141.18">proved doubt that that we really need to</span> <span data-start="141.18" data-end="143.22">look into a synchronous file systems in</span> <span data-start="143.22" data-end="145.65">i/o before we start writing and actually</span> <span data-start="145.65" data-end="147.42">get some asynchronous implementations in</span> </p>
<p><span data-start="147.42" data-end="149.25">JavaScript before we start standardizing</span> <span data-start="149.25" data-end="153.3">them and was it was an easy trap to fall</span> <span data-start="153.3" data-end="156.48">into because i was there are so many</span> <span data-start="156.48" data-end="158.459">well vetted synchronous file system API</span> <span data-start="158.459" data-end="161.85">is on the server we figure is pretty</span> <span data-start="161.85" data-end="163.92">pretty well researched prior art and so</span> <span data-start="163.92" data-end="165.209">we just took those and found the best</span> <span data-start="165.209" data-end="166.44">things of them and tried to make the</span> <span data-start="166.44" data-end="168.93">very best synchronous file system API</span> <span data-start="168.93" data-end="170.73">there could up that there could ever be</span> <span data-start="170.73" data-end="173.82">and put it in JavaScript and I think</span> <span data-start="173.82" data-end="175.29">that a lot of that work is still useful</span> <span data-start="175.29" data-end="178.05">at this point but I'll get to that about</span> <span data-start="178.05" data-end="180.69">promises and the second half of the</span> <span data-start="180.69" data-end="185.19">presentation but yeah so the actual</span> <span data-start="185.19" data-end="186.959">problem turned out to be that there</span> <span data-start="186.959" data-end="188.76">weren't any JavaScript server-side</span> <span data-start="188.76" data-end="190.59">implementations that were interesting</span> <span data-start="190.59" data-end="192.3">enough to use that could differentiate</span> <span data-start="192.3" data-end="194.94">themselves from from Java from other</span> <span data-start="194.94" data-end="197.13">programming languages and implementation</span> <span data-start="197.13" data-end="200.1">languages on the server side and the</span> <span data-start="200.1" data-end="204.48">last year has really proven that out so</span> <span data-start="204.48" data-end="206.79">what makes a good spec what are the</span> <span data-start="206.79" data-end="208.44">things that common Jason come in here</span> <span data-start="208.44" data-end="209.7">should be talking about and</span> <span data-start="209.7" data-end="212.37">standardizing as a pretty pretty common</span> <span data-start="212.37" data-end="214.769">question we get there there's for the</span> <span data-start="214.769" data-end="218.16">last year we've really stepped back and</span> <span data-start="218.16" data-end="219.81">let let things happen in the foreground</span> <span data-start="219.81" data-end="221.94">which is just focused on some very core</span> <span data-start="221.94" data-end="226.62">some very core proposals but but the</span> </p>
<p><span data-start="226.62" data-end="228.239">Charter is very much the same we still</span> <span data-start="228.239" data-end="229.799">need to get out there and have specs for</span> <span data-start="229.799" data-end="231.42">the whole spectrum of things so that</span> <span data-start="231.42" data-end="233.07">there can be there so that they're still</span> <span data-start="233.07" data-end="234.75">can be an escape route and a degree of</span> <span data-start="234.75" data-end="236.85">interoperability to the to the sense</span> <span data-start="236.85" data-end="237.93">that it makes sense for there to be</span> <span data-start="237.93" data-end="240.87">interoperability like if you have a</span> <span data-start="240.87" data-end="244.2">package of code that has absolutely no</span> <span data-start="244.2" data-end="247.2">dependence on Io it makes sense for</span> <span data-start="247.2" data-end="249.72">there to be like a markdown package that</span> <span data-start="249.72" data-end="251.19">just works in the browser and works in</span> <span data-start="251.19" data-end="252.72">the works in the client and no</span> <span data-start="252.72" data-end="256.35">difference so that yeah so working it in</span> <span data-start="256.35" data-end="258.26">that way so what makes a good a good</span> <span data-start="258.26" data-end="261.079">specification is a</span> <span data-start="261.079" data-end="262.699">and it has to there have there has to be</span> <span data-start="262.699" data-end="263.87">compelling reasons to write a spec</span> <span data-start="263.87" data-end="266">because it's ten times harder to write a</span> <span data-start="266" data-end="267.5">spec and get a whole bunch of people to</span> <span data-start="267.5" data-end="270.02">agree on agree on it and it's not nearly</span> <span data-start="270.02" data-end="273.5">as fun as hacking arguing with people is</span> <span data-start="273.5" data-end="277.52">a real real pain so it really has to be</span> <span data-start="277.52" data-end="279.349">worthwhile and what makes it my suspect</span> <span data-start="279.349" data-end="281.36">worthwhile is if it builds a new</span> <span data-start="281.36" data-end="283.31">ecosystem where a whole bunch of code</span> <span data-start="283.31" data-end="285.37">can be written to be interoperable</span> <span data-start="285.37" data-end="288.409">modules was a very obvious place for</span> <span data-start="288.409" data-end="293.539">that basic asynchronous i/o by basic</span> <span data-start="293.539" data-end="295.159">asynchronous programming constructs are</span> <span data-start="295.159" data-end="297.5">another big one that that area hasn't</span> <span data-start="297.5" data-end="299.509">settled so the so what makes a bad</span> <span data-start="299.509" data-end="301.4">specification is specifying something</span> <span data-start="301.4" data-end="303.44">that people don't agree on in the first</span> <span data-start="303.44" data-end="304.43">place and there's a lot of room for</span> <span data-start="304.43" data-end="308.99">experimentation so modules are sort of</span> <span data-start="308.99" data-end="310.909">done ish and then we're moving on to</span> <span data-start="310.909" data-end="313.789">packages packages are the next big thing</span> <span data-start="313.789" data-end="317">that makes sense for common gs4 first</span> <span data-start="317" data-end="319.789">sink for building new ecosystems of</span> <span data-start="319.789" data-end="321.949">stuff so we have a stopgap proposal for</span> <span data-start="321.949" data-end="325.669">packages called one point o this</span> <span data-start="325.669" data-end="327.139">proposal doesn't really define any</span> <span data-start="327.139" data-end="328.759">behavioral requirements it's sort of</span> <span data-start="328.759" data-end="330.83">like I don't know if you've ever been in</span> </p>
<p><span data-start="330.83" data-end="332.36">America we have the Liberty Bell it's</span> <span data-start="332.36" data-end="333.979">this gigantic Bell that had a crack in</span> <span data-start="333.979" data-end="335.69">it really early on and just kept on</span> <span data-start="335.69" data-end="338.33">getting worse every winter and they</span> <span data-start="338.33" data-end="340.279">drilled little hole a little hole at the</span> <span data-start="340.279" data-end="341.719">end of the crack to relieve the pressure</span> <span data-start="341.719" data-end="343.9">so that the crack wouldn't grow any more</span> <span data-start="343.9" data-end="346.37">packages one point O is sort of like</span> <span data-start="346.37" data-end="347.81">that and less about actually</span> <span data-start="347.81" data-end="348.86">guaranteeing any degree of</span> <span data-start="348.86" data-end="351.349">interoperability with packages in the</span> <span data-start="351.349" data-end="353.089">skywriter talk upstairs they talked</span> <span data-start="353.089" data-end="355.099">about just being able to give a common</span> </p>
<p><span data-start="355.099" data-end="358.279">J's package and use it on the use it on</span> <span data-start="358.279" data-end="360.409">the browser and the fact of the matter</span> <span data-start="360.409" data-end="362.06">is that at the moment there are packages</span> <span data-start="362.06" data-end="364.4">for Narwhal there are packages for NPM</span> <span data-start="364.4" data-end="367.759">and their packages for for jet pack and</span> <span data-start="367.759" data-end="369.83">bet on sky writer and none of them are</span> <span data-start="369.83" data-end="371.979">actually interoperable but they do have</span> <span data-start="371.979" data-end="375.589">the packages one point o in common which</span> <span data-start="375.589" data-end="377.87">prevents them from diverging too much</span> <span data-start="377.87" data-end="380.629">away from eventually of being able to</span> <span data-start="380.629" data-end="382.129">specify their dependencies in a</span> <span data-start="382.129" data-end="385.449">meaningful way the packages spec just</span> <span data-start="385.449" data-end="388.389">reserves a bunch of names for things for</span> <span data-start="388.389" data-end="391.159">metadata about packages so that</span> <span data-start="391.159" data-end="393.03">eventually we can have an eco</span> <span data-start="393.03" data-end="394.56">them that can analyze that data and use</span> <span data-start="394.56" data-end="396.68">it for installers and stuff like that</span> <span data-start="396.68" data-end="399.51">but Michael Rogers has been been pushing</span> <span data-start="399.51" data-end="402.66">for for the last year on new packaging</span> <span data-start="402.66" data-end="405.84">spec and there are three major proposals</span> <span data-start="405.84" data-end="409.62">for extending packages for handling</span> <span data-start="409.62" data-end="411.87">dependencies one of them is approached</span> <span data-start="411.87" data-end="414.89">by NPM the four node by Isaac shooter</span> <span data-start="414.89" data-end="419.49">there's another I wrote 12 years ago for</span> <span data-start="419.49" data-end="421.61">a narwhal called tusk and it had a</span> <span data-start="421.61" data-end="426.39">repository format as well and then there</span> <span data-start="426.39" data-end="428.67">which is based off of this concept of</span> <span data-start="428.67" data-end="431.07">overlays and then there's a third method</span> <span data-start="431.07" data-end="432.93">but it's being presently promoted by</span> <span data-start="432.93" data-end="435.15">chris's ID and as embodied and</span> <span data-start="435.15" data-end="436.47">implemented through this node package</span> <span data-start="436.47" data-end="441.21">called nodules so there are three major</span> <span data-start="441.21" data-end="444.56">approaches there's overlays mappings and</span> <span data-start="444.56" data-end="447.54">linking by version through a registry</span> <span data-start="447.54" data-end="449.97">and none of them are really perfect and</span> <span data-start="449.97" data-end="451.95">we still have a lot of a lot of room to</span> <span data-start="451.95" data-end="455.16">experiment with these things let me</span> <span data-start="455.16" data-end="457.38">describe some of the problems and</span> <span data-start="457.38" data-end="458.76">benefits of each of these those</span> <span data-start="458.76" data-end="462.21">approaches the the overlay approach is</span> <span data-start="462.21" data-end="465.21">similar to Ruby that's what we used in</span> <span data-start="465.21" data-end="468.84">narwhal and tusk and the the way it</span> <span data-start="468.84" data-end="471.72">works is that it that the package</span> <span data-start="471.72" data-end="473.43">manager is responsible for installing</span> <span data-start="473.43" data-end="474.96">your packages and predictable locations</span> <span data-start="474.96" data-end="477.69">and then Narwhal discovers all of those</span> <span data-start="477.69" data-end="479.82">package locations upon initialization</span> <span data-start="479.82" data-end="481.56">which takes an unreasonable amount of</span> <span data-start="481.56" data-end="485.04">time in rhino anyway and the way it</span> <span data-start="485.04" data-end="487.59">works is that it it goes into your main</span> <span data-start="487.59" data-end="489.36">package directory and then does a</span> <span data-start="489.36" data-end="492.69">breadth-first search of the packages</span> <span data-start="492.69" data-end="494.37">directories of each package that is</span> <span data-start="494.37" data-end="496.41">contained in that package transitively</span> <span data-start="496.41" data-end="498.81">it discovers all of those packages and</span> <span data-start="498.81" data-end="501.45">then looks at its dependency mapping and</span> <span data-start="501.45" data-end="504.12">does a topological sort which linearize</span> <span data-start="504.12" data-end="505.56">is all of the packages out and</span> <span data-start="505.56" data-end="508.35">constructs a require paths array so that</span> <span data-start="508.35" data-end="510.36">it knows so that are well knows where to</span> <span data-start="510.36" data-end="512.25">search which directories to search for</span> <span data-start="512.25" data-end="514.41">each of the each of the modules in all</span> <span data-start="514.41" data-end="515.97">of the packages the problem with this</span> <span data-start="515.97" data-end="518.16">approach is that it conflates the module</span> <span data-start="518.16" data-end="520.35">name spaces of all of the installed</span> <span data-start="520.35" data-end="522.72">packages than one of the advantages of</span> <span data-start="522.72" data-end="524.7">the approach is that it really makes it</span> <span data-start="524.7" data-end="525.88">easy to enjoy</span> <span data-start="525.88" data-end="528.46">act engine specific code anywhere along</span> <span data-start="528.46" data-end="530.95">the way and it also makes a really great</span> <span data-start="530.95" data-end="532.84">composition mechanism if you have</span> <span data-start="532.84" data-end="535.66">something like Django apps in JavaScript</span> <span data-start="535.66" data-end="539.41">where you can have a media a media</span> <span data-start="539.41" data-end="541.42">directory tree that can be searched for</span> <span data-start="541.42" data-end="542.92">the most relevant stuff and you can</span> <span data-start="542.92" data-end="544.24">stack it on top of each other and</span> <span data-start="544.24" data-end="546.76">override lesser versions of that</span> <span data-start="546.76" data-end="548.83">information that's the narwhal approach</span> <span data-start="548.83" data-end="554.71">and it's 1 and n p.m. is the second one</span> <span data-start="554.71" data-end="559.18">really and the way it works is that it</span> <span data-start="559.18" data-end="561.34">creates symbolic links in a common</span> <span data-start="561.34" data-end="562.84">directory so the difference in approach</span> <span data-start="562.84" data-end="565.12">is that node does nothing at run time to</span> <span data-start="565.12" data-end="566.86">discover anything about packages there's</span> <span data-start="566.86" data-end="568.24">only a single directory that contains</span> <span data-start="568.24" data-end="573.4">the entire module tree or a small number</span> <span data-start="573.4" data-end="576.61">of them in a fixed require paths and the</span> <span data-start="576.61" data-end="578.56">way the way it works is that the package</span> <span data-start="578.56" data-end="581.79">manager is responsible for telling the</span> <span data-start="581.79" data-end="585.07">entire system the names of every package</span> <span data-start="585.07" data-end="586.93">and how to find them by using symbolic</span> <span data-start="586.93" data-end="591.76">links so and and then thunk modules that</span> <span data-start="591.76" data-end="595.39">alter the require paths as as you call</span> <span data-start="595.39" data-end="597.97">through require which is a major</span> <span data-start="597.97" data-end="600.09">disadvantage of the approaches that</span> <span data-start="600.09" data-end="602.71">require behaves differently when called</span> <span data-start="602.71" data-end="606.64">in different terms of the event loop so</span> <span data-start="606.64" data-end="607.9">you really can't use that approach</span> <span data-start="607.9" data-end="609.88">reliably when you have multiple versions</span> <span data-start="609.88" data-end="614.95">of a particular package and ND recalling</span> <span data-start="614.95" data-end="617.83">require at funny times which has largely</span> <span data-start="617.83" data-end="619">not been a problem for the node</span> <span data-start="619" data-end="636.18">community yet I'm sorry</span> <span data-start="636.19" data-end="640.4">so Michael points out that that because</span> <span data-start="640.4" data-end="642.71">requires synchronous during the context</span> <span data-start="642.71" data-end="644.54">of the require call your required odds</span> <span data-start="644.54" data-end="650.27">will be consistent I'll think about that</span> <span data-start="650.27" data-end="654.02">a little bit more you just have to be</span> <span data-start="654.02" data-end="655.82">very careful about anything where state</span> <span data-start="655.82" data-end="658.34">is captured in your stack because it</span> <span data-start="658.34" data-end="663.14">tends to vary from from turn to turn the</span> <span data-start="663.14" data-end="665.57">other so the other disadvantage of this</span> <span data-start="665.57" data-end="667.58">approach is that whenever you install a</span> <span data-start="667.58" data-end="671.75">package well it establishes a race for</span> <span data-start="671.75" data-end="674.21">naming packages there's a gold rush for</span> <span data-start="674.21" data-end="676.1">the good names going on in the node</span> <span data-start="676.1" data-end="679.73">community right now and ever and the</span> <span data-start="679.73" data-end="681.92">collective consensus of everybody who's</span> <span data-start="681.92" data-end="684.62">chosen a name is reserving names in your</span> <span data-start="684.62" data-end="687.2">in every packages in every programs</span> <span data-start="687.2" data-end="689.59">namespace effectively which makes for</span> <span data-start="689.59" data-end="692.96">unpredictable unpredictable composition</span> <span data-start="692.96" data-end="697.25">problems down the road possibly I really</span> <span data-start="697.25" data-end="699.35">like the idea of having sovereignty at</span> <span data-start="699.35" data-end="702.47">various layers of of naming conventions</span> <span data-start="702.47" data-end="703.88">so that people in different roles have</span> <span data-start="703.88" data-end="705.92">the ability to give names to things in</span> <span data-start="705.92" data-end="708.05">their own scope so they have absolute</span> <span data-start="708.05" data-end="711.38">control and one of the at I think of it</span> <span data-start="711.38" data-end="714.92">as the the in a particular module your</span> <span data-start="714.92" data-end="716.66">local scope should be sovereign to you</span> <span data-start="716.66" data-end="719.09">you should not be you should not be</span> <span data-start="719.09" data-end="720.65">subject to other people giving you other</span> <span data-start="720.65" data-end="723.83">global variables in from from other</span> <span data-start="723.83" data-end="725.57">modules you should have absolute control</span> <span data-start="725.57" data-end="728.3">over the local variables in your scope</span> <span data-start="728.3" data-end="730.94">similarly at the package layer where</span> <span data-start="730.94" data-end="733.61">people are composing pieces of larger</span> <span data-start="733.61" data-end="736.19">chunks of codes that have been produced</span> <span data-start="736.19" data-end="739.94">by different developers you want to have</span> <span data-start="739.94" data-end="742.1">sovereignty of earlier module namespace</span> <span data-start="742.1" data-end="745.31">and ultimately you want to defer all of</span> <span data-start="745.31" data-end="746.81">the responsible are all of the</span> <span data-start="746.81" data-end="749.78">responsibility to for for naming things</span> <span data-start="749.78" data-end="753.89">to IA na or just to urls in general so</span> <span data-start="753.89" data-end="756.17">that you don't have to mediate conflicts</span> <span data-start="756.17" data-end="759.2">and naming by talking to people who have</span> <span data-start="759.2" data-end="761.99">authority you talk to get your domain</span> <span data-start="761.99" data-end="764.41">and put it up it's at there's</span> <span data-start="764.41" data-end="766.75">conflict but in any case so those are</span> <span data-start="766.75" data-end="768.19">the major three approaches and we're</span> <span data-start="768.19" data-end="769.959">still continuing experimentation with</span> <span data-start="769.959" data-end="773.97">them I imagine at this point that what</span> <span data-start="773.97" data-end="777.37">while it may seem like designed by</span> <span data-start="777.37" data-end="780.009">committee sort of end result where you</span> <span data-start="780.009" data-end="781.81">have little bits and pieces of each of</span> <span data-start="781.81" data-end="783.1">these approaches I think each of them</span> <span data-start="783.1" data-end="785.259">has their own merits and demerits and</span> <span data-start="785.259" data-end="788.29">disadvantages so down the road I imagine</span> <span data-start="788.29" data-end="792.16">that that the the packaging approach</span> <span data-start="792.16" data-end="793.81">that we ultimately use will be a hybrid</span> <span data-start="793.81" data-end="796.99">of these approaches where easy is simple</span> <span data-start="796.99" data-end="802.079">and the long out problems are solvable</span> <span data-start="802.079" data-end="804.639">so that's packages we also talked about</span> <span data-start="804.639" data-end="808.209">binary in the first year we talked about</span> <span data-start="808.209" data-end="810.31">binary in the context of making binary</span> <span data-start="810.31" data-end="812.019">data types that resemble the rain string</span> <span data-start="812.019" data-end="814.089">so that we could use to narrow City to</span> <span data-start="814.089" data-end="816.009">our advantage and also because there are</span> <span data-start="816.009" data-end="819.25">good security properties of strings you</span> <span data-start="819.25" data-end="820.689">can give a string to somebody and</span> <span data-start="820.689" data-end="823.87">they're guaranteed immutable by both the</span> <span data-start="823.87" data-end="828.069">consumer and producer so we have that</span> <span data-start="828.069" data-end="829.87">layer of abstraction for Strings and</span> <span data-start="829.87" data-end="831.509">also it also was made to come</span> <span data-start="831.509" data-end="833.86">accommodate older versions of browsers</span> <span data-start="833.86" data-end="835.959">the idea was that people not browsers</span> <span data-start="835.959" data-end="837.639">but older JavaScript engines the idea</span> <span data-start="837.639" data-end="839.829">was that it could be implemented in pure</span> </p>
<p><span data-start="839.829" data-end="842.38">JavaScript without involving the</span> <span data-start="842.38" data-end="844.899">embedding which made it slightly of</span> <span data-start="844.899" data-end="850.54">compromise with fast forward a year node</span> <span data-start="850.54" data-end="852.399">has given us a buffer type so I went and</span> <span data-start="852.399" data-end="854.199">took that and codified it and made some</span> <span data-start="854.199" data-end="856.3">made some changes and revised the design</span> <span data-start="856.3" data-end="859.389">and that's the binary F specification so</span> <span data-start="859.389" data-end="862.24">node as essentially a command GS</span> <span data-start="862.24" data-end="864.67">compliant buffer by virtue of being the</span> <span data-start="864.67" data-end="868.449">inspiration of the spec and and and</span> <span data-start="868.449" data-end="871.059">everybody else has one now now too now</span> <span data-start="871.059" data-end="873.79">the neat thing about the the binary</span> <span data-start="873.79" data-end="876.959">specs is that we have this more abstract</span> <span data-start="876.959" data-end="880.449">byte string and byte array specification</span> <span data-start="880.449" data-end="882.04">binary be and we have the buffer</span> <span data-start="882.04" data-end="884.889">specification the more abstract one is</span> <span data-start="884.889" data-end="887.559">easily implementable even including</span> <span data-start="887.559" data-end="889.3">possibly campeon right semantics in</span> <span data-start="889.3" data-end="891.37">terms of the lower level buffer the</span> <span data-start="891.37" data-end="894.85">problem with buffer is there are a lot</span> <span data-start="894.85" data-end="896.11">of problems with buffer if you ever</span> <span data-start="896.11" data-end="897.31">introduced</span> <span data-start="897.31" data-end="899.38">if you if you ever tried to use node in</span> <span data-start="899.38" data-end="901.3">a secure way there's a buffers are</span> <span data-start="901.3" data-end="904.05">they're never there never blanked out on</span> <span data-start="904.05" data-end="906.1">initialization for because that would be</span> <span data-start="906.1" data-end="908.02">a performance cost that note doesn't</span> <span data-start="908.02" data-end="910.99">want to make but that means that if you</span> <span data-start="910.99" data-end="913.06">have multiple distressful distrusting</span> <span data-start="913.06" data-end="914.62">parties running in the same process</span> <span data-start="914.62" data-end="916.48">through javascript which is a dream that</span> <span data-start="916.48" data-end="919.99">is reliable I zabal through akma script</span> <span data-start="919.99" data-end="923.8">five and harmony forward you won't be</span> <span data-start="923.8" data-end="925.63">able to use buffers in those contexts</span> <span data-start="925.63" data-end="928.529">because the there would be potential of</span> <span data-start="928.529" data-end="931.72">binary garbage data linking into those</span> <span data-start="931.72" data-end="935.2">contexts so that's binary but I really</span> <span data-start="935.2" data-end="938.04">want to talk to you about promises today</span> <span data-start="938.04" data-end="941.44">there's a there's a specification for</span> <span data-start="941.44" data-end="943.27">problem bro there is a specification for</span> <span data-start="943.27" data-end="945.04">promises long predating the entire</span> <span data-start="945.04" data-end="948.37">common jsf effort by a fellow Tyler</span> <span data-start="948.37" data-end="952.32">closed for a project called refs end and</span> <span data-start="952.32" data-end="957.07">the queue API as he called it and I we</span> <span data-start="957.07" data-end="960.97">carry forward is this really highly</span> <span data-start="960.97" data-end="963.16">highly researched very carefully</span> <span data-start="963.16" data-end="965.86">thought-out API for composing a</span> <span data-start="965.86" data-end="968.5">synchronous asynchronous programs in</span> <span data-start="968.5" data-end="971.97">reliable ways in the face of hazards</span> <span data-start="971.97" data-end="974.83">distrust and all sorts of other all</span> <span data-start="974.83" data-end="976.57">sorts of other other things so it's a</span> <span data-start="976.57" data-end="978.339">really really robust way of dealing with</span> <span data-start="978.339" data-end="981.79">asynchrony 80 so let me let me let me</span> <span data-start="981.79" data-end="984.7">show you what oh I was going to talk</span> <span data-start="984.7" data-end="987.12">about said exports don't have to do that</span> <span data-start="987.12" data-end="990.76">or the module constructor or yeah we can</span> <span data-start="990.76" data-end="994.57">come back to that this is a promise so</span> <span data-start="994.57" data-end="996.64">the way whata promises is the</span> <span data-start="996.64" data-end="998.68">unidirectional communication channel</span> <span data-start="998.68" data-end="1001.65">between a producer and a consumer</span> <span data-start="1001.65" data-end="1003.66">possibly many producers possibly many</span> <span data-start="1003.66" data-end="1007.29">consumers the way it works is that you</span> <span data-start="1007.29" data-end="1010.11">construct vehic you defer a deferred a</span> <span data-start="1010.11" data-end="1012.9">deferred is an object that contains a</span> <span data-start="1012.9" data-end="1015.42">resolver and a promise and they are</span> <span data-start="1015.42" data-end="1018.63">separate for a reason the idea is that</span> <span data-start="1018.63" data-end="1021.18">you can give your promise is a</span> <span data-start="1021.18" data-end="1021.94">capability</span> <span data-start="1021.94" data-end="1024.89">to resolve the difference and the</span> <span data-start="1024.89" data-end="1027.74">promises is it gives you the capability</span> <span data-start="1027.74" data-end="1031.28">to observe that deference so you can</span> <span data-start="1031.28" data-end="1032.449">give these two different people and they</span> <span data-start="1032.449" data-end="1033.699">don't even have to like each other and</span> <span data-start="1033.699" data-end="1036.14">and they're guaranteed to not be able to</span> <span data-start="1036.14" data-end="1037.79">not be able to communicate in any other</span> <span data-start="1037.79" data-end="1041.329">way then then the two objects that</span> <span data-start="1041.329" data-end="1044.39">you've given and this leads to all sorts</span> <span data-start="1044.39" data-end="1046.16">of interesting fun patterns like you can</span> <span data-start="1046.16" data-end="1047.929">give the resolver to a bunch of people</span> <span data-start="1047.929" data-end="1049.88">in the first the the first person to</span> <span data-start="1049.88" data-end="1051.83">resolve it wins the race to resolve the</span> <span data-start="1051.83" data-end="1055.549">thing and at all sorts of other patterns</span> <span data-start="1055.549" data-end="1059.63">so more about deferred in this box in</span> <span data-start="1059.63" data-end="1062.54">the middle I've disposed represents the</span> <span data-start="1062.54" data-end="1066.01">two-state nature of a promise it has a</span> <span data-start="1066.01" data-end="1068.87">before resolution state and a post</span> <span data-start="1068.87" data-end="1071.69">resolution state before a resolution it</span> <span data-start="1071.69" data-end="1074.299">its contents are a list of people who</span> <span data-start="1074.299" data-end="1075.799">are interested in the value of the</span> <span data-start="1075.799" data-end="1079.19">resolution and those by people I mean</span> <span data-start="1079.19" data-end="1084.62">other promises so and then after the</span> <span data-start="1084.62" data-end="1086.299">promise has been resolved it has a value</span> <span data-start="1086.299" data-end="1088.549">and that value gets sent to all of the</span> <span data-start="1088.549" data-end="1090.5">promises that are interested in that</span> <span data-start="1090.5" data-end="1096.799">value and the promise in the resolver</span> <span data-start="1096.799" data-end="1099.35">and these circles with the arrows on the</span> <span data-start="1099.35" data-end="1101.45">inside are a sort of representation of a</span> <span data-start="1101.45" data-end="1103.85">closure the idea is that if you have a</span> <span data-start="1103.85" data-end="1106.28">reference coming out of the edge of a</span> <span data-start="1106.28" data-end="1107.57">circle that's something that's a</span> <span data-start="1107.57" data-end="1109.22">property of an object and an arrow</span> <span data-start="1109.22" data-end="1111.799">coming from the inside is a property</span> <span data-start="1111.799" data-end="1114.41">that is enclosed by the object that by</span> <span data-start="1114.41" data-end="1116.24">the idea is that if you give an object</span> <span data-start="1116.24" data-end="1118.73">to somebody else they have access to all</span> <span data-start="1118.73" data-end="1120.08">of the capabilities that are on the</span> <span data-start="1120.08" data-end="1121.669">surface of that object but not</span> <span data-start="1121.669" data-end="1125.24">necessarily that they have to object all</span> <span data-start="1125.24" data-end="1126.77">of the references inside of it so you</span> <span data-start="1126.77" data-end="1131.549">can protect access to those things</span> <span data-start="1131.559" data-end="1136.87">so here's a simple defer this is a this</span> <span data-start="1136.87" data-end="1140.159">is an abstraction on the set timeout and</span> <span data-start="1140.159" data-end="1142.69">it's really really simple the idea is</span> <span data-start="1142.69" data-end="1145.57">you construct a deferred you call set</span> <span data-start="1145.57" data-end="1147.639">timeout the callback is going to be the</span> <span data-start="1147.639" data-end="1150.159">resolver and then you pass the time out</span> <span data-start="1150.159" data-end="1151.33">as the second argument and then you</span> <span data-start="1151.33" data-end="1153.399">return the promise so you've got the two</span> <span data-start="1153.399" data-end="1156.639">parts the resolve is the resolver and</span> <span data-start="1156.639" data-end="1159.73">the promise is a promise the what</span> <span data-start="1159.73" data-end="1161.409">happens with resolve is it takes one</span> <span data-start="1161.409" data-end="1163.6">argument in this case it's going to</span> <span data-start="1163.6" data-end="1165.1">resolve to the value of</span> <span data-start="1165.1" data-end="1167.289">because set timeout is going to send</span> <span data-start="1167.289" data-end="1169.419">done divine to it as its as its first</span> <span data-start="1169.419" data-end="1173.619">argument so what this does is it returns</span> <span data-start="1173.619" data-end="1174.999">a promise that will resolve after</span> <span data-start="1174.999" data-end="1178.84">whatever time you provide and the way</span> <span data-start="1178.84" data-end="1180.549">you observe the resolution of that</span> <span data-start="1180.549" data-end="1183.22">promise is using a cute when he taught</span> <span data-start="1183.22" data-end="1186.009">when was originally in the e programming</span> <span data-start="1186.009" data-end="1190.659">language it was a clause it was more</span> <span data-start="1190.659" data-end="1194.289">like a try-catch than a try-catch as an</span> <span data-start="1194.289" data-end="1197.08">expression instead of just like instead</span> <span data-start="1197.08" data-end="1198.82">of a function call but in JavaScript we</span> <span data-start="1198.82" data-end="1202.749">can use a function call to do this it</span> <span data-start="1202.749" data-end="1205.45">has it has a try claws and a catch</span> <span data-start="1205.45" data-end="1207.639">clause effectively the way this works is</span> <span data-start="1207.639" data-end="1211.33">that you pass a promise in or value as</span> <span data-start="1211.33" data-end="1215.309">the as the argument to when and if it's</span> <span data-start="1215.309" data-end="1219.999">if it's a if you give it a it treats it</span> <span data-start="1219.999" data-end="1223.72">as a resolved promise so it will it will</span> <span data-start="1223.72" data-end="1226.389">proceed almost immediately but not in</span> <span data-start="1226.389" data-end="1228.399">the same turn if you give it a pure</span> <span data-start="1228.399" data-end="1230.44">value which means that you can pass into</span> <span data-start="1230.44" data-end="1232.84">when you can get just get a value from</span> <span data-start="1232.84" data-end="1235.179">somebody else's API regardless of</span> <span data-start="1235.179" data-end="1236.499">whether that API is returning you</span> <span data-start="1236.499" data-end="1238.389">promises or values which makes for a</span> <span data-start="1238.389" data-end="1241.899">really really clean level of abstraction</span> <span data-start="1241.899" data-end="1244.98">where you can build a promise based API</span> <span data-start="1244.98" data-end="1248.95">in terms of any API at all and the code</span> <span data-start="1248.95" data-end="1254.519">is identical and the the first the first</span> <span data-start="1254.519" data-end="1257.799">operand you get is a call back this is</span> <span data-start="1257.799" data-end="1258.82">the call back that's going to be</span> <span data-start="1258.82" data-end="1259.929">attached and it will</span> <span data-start="1259.929" data-end="1261.73">deserve the resolution of the promise</span> <span data-start="1261.73" data-end="1265.36">and it receives the fully resolved value</span> <span data-start="1265.36" data-end="1269.86">is its argument from there you have the</span> <span data-start="1269.86" data-end="1273.399">ability to return a new value so</span> <span data-start="1273.399" data-end="1275.47">supposing that you were trying to to do</span> <span data-start="1275.47" data-end="1278.619">a computation of some kind that depends</span> <span data-start="1278.619" data-end="1280.84">on data from that there must be acquired</span> <span data-start="1280.84" data-end="1282.97">asynchronously from somewhere you use a</span> <span data-start="1282.97" data-end="1285.82">when block to observe the resolution of</span> <span data-start="1285.82" data-end="1287.919">that promise perform your computation</span> <span data-start="1287.919" data-end="1290.019">with that given value and then return</span> <span data-start="1290.019" data-end="1294.49">that value to to whoever to whoever is</span> <span data-start="1294.49" data-end="1296.619">asking to whoever who you are beholden</span> <span data-start="1296.619" data-end="1298.809">to so if you're creating an asynchronous</span> </p>
<p><span data-start="1298.809" data-end="1302.169">API all you have to do is use it in if</span> <span data-start="1302.169" data-end="1304.09">you are both producing and consuming an</span> <span data-start="1304.09" data-end="1305.559">asynchronous API you never have to use</span> <span data-start="1305.559" data-end="1308.529">defer you just use Q dot when which will</span> <span data-start="1308.529" data-end="1313.419">be most of the time and so you're</span> <span data-start="1313.419" data-end="1315.82">consuming a and you're producing be the</span> <span data-start="1315.82" data-end="1317.259">capital B is what you return to your</span> <span data-start="1317.259" data-end="1319.749">consumer and that will be resolved with</span> <span data-start="1319.749" data-end="1322.059">whatever you return from the from the</span> <span data-start="1322.059" data-end="1330.159">inner block and the neat thing about</span> <span data-start="1330.159" data-end="1332.889">promises is that they accurately model</span> <span data-start="1332.889" data-end="1335.97">both returning from a function and</span> <span data-start="1335.97" data-end="1339.369">throwing exceptions from a function and</span> <span data-start="1339.369" data-end="1341.11">they do it in a single similar way to</span> <span data-start="1341.11" data-end="1343.6">the way try-catch works in that you</span> <span data-start="1343.6" data-end="1345.22">don't have to pay attention to the</span> <span data-start="1345.22" data-end="1346.96">exception unless you are interested in</span> <span data-start="1346.96" data-end="1350.74">the exception because if you do not</span> <span data-start="1350.74" data-end="1354.22">provide a way to observe the rejection</span> <span data-start="1354.22" data-end="1355.96">that rejection will be forwarded from</span> <span data-start="1355.96" data-end="1358.6">your consumer from your producer to your</span> <span data-start="1358.6" data-end="1362.049">consumer the way you do it was a</span> <span data-start="1362.049" data-end="1363.789">constructive rejection it's just another</span> <span data-start="1363.789" data-end="1366.34">promise q dot reject returns a promise</span> <span data-start="1366.34" data-end="1369.369">that that embodies the knowledge that</span> <span data-start="1369.369" data-end="1371.259">this promise has been rejected and you</span> <span data-start="1371.259" data-end="1374.919">provide as as its as its argument any</span> <span data-start="1374.919" data-end="1378.399">object you want strings are good that</span> <span data-start="1378.399" data-end="1381.279">that tell you why the promise is being</span> <span data-start="1381.279" data-end="1382.899">rejected sometimes it's interesting to</span> <span data-start="1382.899" data-end="1384.49">provide additional metadata like my</span> <span data-start="1384.49" data-end="1387.81">stack traces</span> <span data-start="1387.82" data-end="1390.92">this is how you do error recovery with</span> <span data-start="1390.92" data-end="1393.86">promises the qn receives as its second</span> <span data-start="1393.86" data-end="1396.98">argument and airbag and it's not quite</span> <span data-start="1396.98" data-end="1398.72">it's not quite an error back because</span> <span data-start="1398.72" data-end="1401.65">it's it's responsible for either</span> <span data-start="1401.65" data-end="1405.53">continuing to resolve the promise or to</span> <span data-start="1405.53" data-end="1407.42">reject the promise so the value returned</span> <span data-start="1407.42" data-end="1410.15">from the air back is going to be either</span> <span data-start="1410.15" data-end="1411.98">your resolution or your continued</span> <span data-start="1411.98" data-end="1414.11">rejection now you have an opportunity if</span> <span data-start="1414.11" data-end="1415.73">you're rejecting it to construct a new</span> <span data-start="1415.73" data-end="1420.98">rejection with more information or or to</span> <span data-start="1420.98" data-end="1422.57">just use cute or reject and pass the</span> <span data-start="1422.57" data-end="1425.77">reason through or provide a new value</span> <span data-start="1425.77" data-end="1430.34">and if you omit the air back your the</span> <span data-start="1430.34" data-end="1432.62">rejection reason from your producer will</span> <span data-start="1432.62" data-end="1435.77">be forwarded to your consumer similarly</span> <span data-start="1435.77" data-end="1438.47">if you omit the the call back the first</span> <span data-start="1438.47" data-end="1441.08">argument the value that you've resolved</span> <span data-start="1441.08" data-end="1443.96">to will be forwarded to your consumer so</span> <span data-start="1443.96" data-end="1445.97">you can also use Q dot when to just</span> <span data-start="1445.97" data-end="1450.17">attach air backs and not and to not</span> <span data-start="1450.17" data-end="1455.63">attach callbacks this is how you use Q</span> <span data-start="1455.63" data-end="1457.37">dot when in a calm count to do a</span> <span data-start="1457.37" data-end="1459.46">compound computation suppose you're</span> <span data-start="1459.46" data-end="1462.77">you're waiting for two different four to</span> <span data-start="1462.77" data-end="1464.24">two different promises to resolve and</span> <span data-start="1464.24" data-end="1466.61">these promises are potentially being</span> <span data-start="1466.61" data-end="1470.21">resolved in parallel before before you</span> <span data-start="1470.21" data-end="1472.07">call Q dot when you acquire promises for</span> <span data-start="1472.07" data-end="1474.02">a and B so they're they're both off</span> <span data-start="1474.02" data-end="1476.179">doing their job and then you use Q dot</span> <span data-start="1476.179" data-end="1478.55">when nested to join those promises and</span> <span data-start="1478.55" data-end="1480.2">then provide a computation based off of</span> <span data-start="1480.2" data-end="1481.67">those two values so suppose you're going</span> <span data-start="1481.67" data-end="1484.37">to a database and also making an HTTP</span> <span data-start="1484.37" data-end="1487.01">request you can use this to get your</span> <span data-start="1487.01" data-end="1490.73">database response in a and your HTTP</span> <span data-start="1490.73" data-end="1492.5">response and be that performs some</span> <span data-start="1492.5" data-end="1495.35">computation generate a new value or</span> <span data-start="1495.35" data-end="1497.75">another promise the way the reason this</span> <span data-start="1497.75" data-end="1500.21">works is that Q dot when in your</span> <span data-start="1500.21" data-end="1501.83">callback all your air back you can</span> <span data-start="1501.83" data-end="1504.29">return another promise to further defer</span> <span data-start="1504.29" data-end="1506.78">so if you which is a pretty common</span> <span data-start="1506.78" data-end="1508.22">pattern you're you're in your callback</span> <span data-start="1508.22" data-end="1511.64">you're like oh I made progress but I'm</span> <span data-start="1511.64" data-end="1515.98">not done yet you can you can then return</span> <span data-start="1515.98" data-end="1518.679">promise to continue waiting and this is</span> <span data-start="1518.679" data-end="1524.83">super super elegant some more</span> <span data-start="1524.83" data-end="1526.69">complicated composition problems can be</span> <span data-start="1526.69" data-end="1529.45">solved using our friend from computer</span> <span data-start="1529.45" data-end="1533.47">science reduce I'm sorry these things</span> <span data-start="1533.47" data-end="1535">can be really easily wrapped but I want</span> <span data-start="1535" data-end="1537.52">to show you the guts because guts are</span> <span data-start="1537.52" data-end="1541.48">cool in this particular case i'm using</span> <span data-start="1541.48" data-end="1543.7">the reduce function who doesn't know how</span> <span data-start="1543.7" data-end="1547.57">the reduce function works the reduce</span> <span data-start="1547.57" data-end="1549.6">function works by taking an array of</span> <span data-start="1549.6" data-end="1553.419">values and it tries to aggregate them to</span> <span data-start="1553.419" data-end="1555.46">a single value using some function so</span> <span data-start="1555.46" data-end="1558.309">the the trivial example of reduction is</span> <span data-start="1558.309" data-end="1561.58">a sum so suppose it's important</span> <span data-start="1561.58" data-end="1562.84">regardless of the order in which you</span> <span data-start="1562.84" data-end="1566.71">resolve the you you can you combine the</span> <span data-start="1566.71" data-end="1568.66">values in an array to construct it some</span> <span data-start="1568.66" data-end="1571.84">it will always be the same Valte which</span> <span data-start="1571.84" data-end="1573.79">isn't actually important but bear with</span> <span data-start="1573.79" data-end="1576.429">me so if you take any two values from</span> <span data-start="1576.429" data-end="1578.2">that and construct the sum you can take</span> <span data-start="1578.2" data-end="1579.91">that out and then put the the sum in the</span> <span data-start="1579.91" data-end="1581.41">array and eventually you'll be rude</span> <span data-start="1581.41" data-end="1583.24">reduced down to a single value and</span> <span data-start="1583.24" data-end="1585.429">that's what reduce returns reduce</span> <span data-start="1585.429" data-end="1587.29">accepts as its arguments well if</span> <span data-start="1587.29" data-end="1590.1">receives an array it except and a a</span> <span data-start="1590.1" data-end="1593.53">function that takes the the so far</span> <span data-start="1593.53" data-end="1596.41">accumulated value and also the value of</span> <span data-start="1596.41" data-end="1597.91">interest at the point and then you</span> <span data-start="1597.91" data-end="1600.25">return the new accumulated value it</span> <span data-start="1600.25" data-end="1602.08">receives is an optional last argument a</span> <span data-start="1602.08" data-end="1605.41">basis for the recursion although it is</span> <span data-start="1605.41" data-end="1607.929">performed iteratively in the engine so</span> <span data-start="1607.929" data-end="1609.88">the way this reduction method works is</span> <span data-start="1609.88" data-end="1612.82">it's a supposing that you have an array</span> <span data-start="1612.82" data-end="1616.299">of mixed values and promises what you</span> <span data-start="1616.299" data-end="1618.91">can do is use this reduce method to wait</span> <span data-start="1618.91" data-end="1620.98">for all of those promises to be resolved</span> <span data-start="1620.98" data-end="1623.86">and then perform a computation on the on</span> <span data-start="1623.86" data-end="1625.96">the aggregate values in this case it's a</span> <span data-start="1625.96" data-end="1628">sum and the interesting thing about a</span> <span data-start="1628" data-end="1631.33">reduce is it's strictly left to right so</span> <span data-start="1631.33" data-end="1633.01">the way progress is going to be made by</span> <span data-start="1633.01" data-end="1636.4">this particular pattern is all of</span> <span data-start="1636.4" data-end="1637.929">supposing that there's a random</span> <span data-start="1637.929" data-end="1640">distribution of resolutions and time as</span> <span data-start="1640" data-end="1641.81">as you go through</span> <span data-start="1641.81" data-end="1645.26">the game loop in turns you're going to</span> <span data-start="1645.26" data-end="1646.67">get resolutions at different times and</span> <span data-start="1646.67" data-end="1649.73">then whenever the the first two are</span> <span data-start="1649.73" data-end="1651.71">resolved you're going to aggregate them</span> <span data-start="1651.71" data-end="1654.41">and then when they're the third whenever</span> <span data-start="1654.41" data-end="1655.64">the third is resolved you're going to</span> <span data-start="1655.64" data-end="1657.77">aggregate it the fourth is already</span> <span data-start="1657.77" data-end="1661.13">resolved but we wait until we have the</span> <span data-start="1661.13" data-end="1664.19">accumulation of a and B and C 2 to</span> <span data-start="1664.19" data-end="1667.46">accumulate them and the neat thing about</span> <span data-start="1667.46" data-end="1670.13">promises is you can create various</span> <span data-start="1670.13" data-end="1671.93">reducers for different scenarios you can</span> <span data-start="1671.93" data-end="1673.97">create a left-to-right resolver you can</span> <span data-start="1673.97" data-end="1675.89">/ left a right reducer you can do a</span> <span data-start="1675.89" data-end="1677.51">right-to-left reducer you can do an</span> <span data-start="1677.51" data-end="1679.64">opportunist to producer which reduces</span> <span data-start="1679.64" data-end="1681.44">whenever values become depending on what</span> <span data-start="1681.44" data-end="1683.39">the math is you can you can reduce out</span> <span data-start="1683.39" data-end="1690.95">of order this is an M we're all really</span> <span data-start="1690.95" data-end="1692.45">super familiar with procedural</span> <span data-start="1692.45" data-end="1694.67">programming using continue and break and</span> <span data-start="1694.67" data-end="1697.7">stuff like that so it's a using promises</span> <span data-start="1697.7" data-end="1699.19">you do have to get a little clever with</span> <span data-start="1699.19" data-end="1701.42">solving problems of how to do that kind</span> <span data-start="1701.42" data-end="1706.7">of thing this is a solution for a break</span> <span data-start="1706.7" data-end="1708.83">or a short circuiting reduction so the</span> <span data-start="1708.83" data-end="1712.28">trick is that you want to continue you</span> <span data-start="1712.28" data-end="1713.3">only want to continue making</span> <span data-start="1713.3" data-end="1715.31">computations like searching the file</span> <span data-start="1715.31" data-end="1717.2">system for for directories which was the</span> <span data-start="1717.2" data-end="1720.05">case where this came up for me up to the</span> <span data-start="1720.05" data-end="1721.58">point where you find the thing of</span> <span data-start="1721.58" data-end="1723.08">interest and then you want to cut off</span> <span data-start="1723.08" data-end="1725.63">the computation in this case the way the</span> <span data-start="1725.63" data-end="1727.91">way to do this is to construct a chain</span> <span data-start="1727.91" data-end="1732.38">of callbacks using reduce and the way</span> <span data-start="1732.38" data-end="1735.2">the way this one works is I'm using the</span> <span data-start="1735.2" data-end="1737.96">generic or a method to create an array</span> <span data-start="1737.96" data-end="1740.21">of functions that perform some</span> <span data-start="1740.21" data-end="1741.83">computation which in this case is just</span> <span data-start="1741.83" data-end="1743.54">returning a letter of the alphabet and</span> <span data-start="1743.54" data-end="1746.96">then I reduce from right to left and the</span> <span data-start="1746.96" data-end="1750.35">reason for this is that I'm taking the</span> <span data-start="1750.35" data-end="1752.63">rightmost function and making that the</span> <span data-start="1752.63" data-end="1756.8">otherwise claws of a choice so in</span> <span data-start="1756.8" data-end="1758.54">aggregate I'm creating essentially a</span> <span data-start="1758.54" data-end="1761.09">linked list enclosures for functions to</span> <span data-start="1761.09" data-end="1763.52">call next and then the function that</span> <span data-start="1763.52" data-end="1765.44">comes out at the end is the first</span> <span data-start="1765.44" data-end="1769.309">function I want to call so as if you</span> <span data-start="1769.309" data-end="1772.669">if you follow this the otherwise call</span> <span data-start="1772.669" data-end="1774.379">the basis for this is going to be</span> <span data-start="1774.379" data-end="1776.21">rejection so if nothing if nothing</span> <span data-start="1776.21" data-end="1778.94">returns a valuable value I'm going to</span> <span data-start="1778.94" data-end="1782.059">get a rejection and for each of the each</span> <span data-start="1782.059" data-end="1784.279">of the each of the components I'm going</span> <span data-start="1784.279" data-end="1787.37">to get a letter of the alphabet and if</span> <span data-start="1787.37" data-end="1788.33">the letter of the alphabet is</span> <span data-start="1788.33" data-end="1789.83">uninteresting to me i'm going to call</span> <span data-start="1789.83" data-end="1791.629">the otherwise function that was the</span> <span data-start="1791.629" data-end="1794.09">accumulated the accumulated value and</span> <span data-start="1794.09" data-end="1797.809">reduce and this this models the the</span> <span data-start="1797.809" data-end="1802.22">order of execution this is how you do</span> <span data-start="1802.22" data-end="1806.269">error recovery this is um I had this</span> <span data-start="1806.269" data-end="1808.149">working at one point in our wall on node</span> <span data-start="1808.149" data-end="1810.35">normal one note is not really going</span> <span data-start="1810.35" data-end="1812.509">forward I'm in the process of</span> <span data-start="1812.509" data-end="1814.58">translating all of that work into NPM</span> <span data-start="1814.58" data-end="1816.409">packages like qu till which is done and</span> <span data-start="1816.409" data-end="1818.899">qhttp which is sort of half done so I</span> <span data-start="1818.899" data-end="1821.389">think that's one actually works the way</span> <span data-start="1821.389" data-end="1824.299">this is an HTTP read retry loop so we're</span> <span data-start="1824.299" data-end="1826.58">going to try to make a request several</span> <span data-start="1826.58" data-end="1829.22">times there's going to be a constant</span> <span data-start="1829.22" data-end="1832.22">time out between tries and you're going</span> <span data-start="1832.22" data-end="1833.72">to type try and certain number of times</span> <span data-start="1833.72" data-end="1841.159">before giving up and the you can also</span> <span data-start="1841.159" data-end="1842.84">you can also model exponential back-off</span> <span data-start="1842.84" data-end="1844.49">with this with without too much</span> <span data-start="1844.49" data-end="1846.32">difficulty at all so the way this is</span> <span data-start="1846.32" data-end="1848.33">working is I'm first going to call HTTP</span> <span data-start="1848.33" data-end="1850.85">read on the URL this is going to issue</span> <span data-start="1850.85" data-end="1853.879">an HTTP request and return a promise for</span> <span data-start="1853.879" data-end="1856.22">the body of the response which may be</span> <span data-start="1856.22" data-end="1860.029">rejected if it's not a 200 status and</span> <span data-start="1860.029" data-end="1861.86">then I use Q dot when to wait for that</span> <span data-start="1861.86" data-end="1864.23">content and I return it if it's good if</span> <span data-start="1864.23" data-end="1868.429">there's an error I and there are no more</span> <span data-start="1868.429" data-end="1871.129">times left I reject but if there are</span> <span data-start="1871.129" data-end="1873.049">more times i'm going to further defer</span> <span data-start="1873.049" data-end="1876.35">using my old delay thing from up top to</span> <span data-start="1876.35" data-end="1879.499">wait the timeout and i'm not going to do</span> <span data-start="1879.499" data-end="1882.619">another HTTP read retry with 11 fewer</span> <span data-start="1882.619" data-end="1885.139">times and this looks recursive button an</span> <span data-start="1885.139" data-end="1887.539">event loop you actually get a new stack</span> <span data-start="1887.539" data-end="1889.159">each time you're on the body of a Q dot</span> <span data-start="1889.159" data-end="1890.6">when let me tell you about some of the</span> <span data-start="1890.6" data-end="1892.789">promises of Q dot win it I mean</span> <span data-start="1892.789" data-end="1895.129">invariants no promises pardon I want to</span> <span data-start="1895.129" data-end="1895.52">load</span> <span data-start="1895.52" data-end="1898.4">my vocabulary too much q dot when</span> <span data-start="1898.4" data-end="1900.77">guarantees that the inner callbacks are</span> <span data-start="1900.77" data-end="1902.33">going to be called in a future turn of</span> <span data-start="1902.33" data-end="1903.8">the event loop this is to prevent</span> <span data-start="1903.8" data-end="1908.57">confusion logical confusion with in it</span> <span data-start="1908.57" data-end="1910.52">permits you to do in one turn of the</span> <span data-start="1910.52" data-end="1912.35">event loop to set up a whole bunch of</span> <span data-start="1912.35" data-end="1914.17">things to happen in the future and</span> <span data-start="1914.17" data-end="1916.49">guarantees that all of you all of the</span> <span data-start="1916.49" data-end="1918.65">values in your lexical scope are going</span> <span data-start="1918.65" data-end="1920.48">to be preserved for the duration of your</span> <span data-start="1920.48" data-end="1922.31">turn you are in complete control of your</span> <span data-start="1922.31" data-end="1924.98">of your values it also guarantees that</span> <span data-start="1924.98" data-end="1927.89">the Q dot wind function guarantees that</span> <span data-start="1927.89" data-end="1929.9">your callback in Arabic are only ever</span> <span data-start="1929.9" data-end="1931.52">going to be called once and only one of</span> <span data-start="1931.52" data-end="1933.2">them will be called so this is really</span> <span data-start="1933.2" data-end="1936.14">resilient against many many hazards and</span> <span data-start="1936.14" data-end="1941.75">malice even this is how you implement an</span> </p>
<p><span data-start="1941.75" data-end="1945.53">HTTP request via xhr using promises I</span> <span data-start="1945.53" data-end="1948.65">think everybody's done xhr is this</span> <span data-start="1948.65" data-end="1953.48">pointed directly at we construct a</span> <span data-start="1953.48" data-end="1957.32">response response deferral we</span> <span data-start="1957.32" data-end="1960.47">constructed a row HTTP request we open</span> <span data-start="1960.47" data-end="1961.28">it we set up the onreadystatechange</span> <span data-start="1961.28" data-end="1964.82">andler and we resolved with the response</span> <span data-start="1964.82" data-end="1966.5">text if it works we resolve with the</span> <span data-start="1966.5" data-end="1970.61">rejection if it does not and we return</span> <span data-start="1970.61" data-end="1972.26">the promise for the value and initiate</span> </p>
<p><span data-start="1972.26" data-end="1973.91">HTTP request there's a little thing in</span> <span data-start="1973.91" data-end="1976.37">here with the timeout equals set in and</span> <span data-start="1976.37" data-end="1978.89">set timeout that that it that adds the</span> <span data-start="1978.89" data-end="1982.52">set timeout semantics and it I think</span> <span data-start="1982.52" data-end="1983.99">that one line really expresses the</span> <span data-start="1983.99" data-end="1986.48">awesomeness of this API in one line I</span> <span data-start="1986.48" data-end="1990.47">have implemented timeouts and because</span> <span data-start="1990.47" data-end="1992.51">the promises guarantee that the first</span> <span data-start="1992.51" data-end="1995.27">person to resolve the promise wins if</span> <span data-start="1995.27" data-end="1997.82">it's rejected its rejected even if the</span> </p>
<p><span data-start="1997.82" data-end="2000.43">HTTP avenge a request eventually manages</span> <span data-start="2000.43" data-end="2002.98">to give you some data the timeouts out</span> <span data-start="2002.98" data-end="2005.32">your your your promise we'll never be</span> <span data-start="2005.32" data-end="2012.61">modified again this is a this is a</span> <span data-start="2012.61" data-end="2014.2">demonstration of how promises can be</span> <span data-start="2014.2" data-end="2018.37">used as currency so it even why that</span> <span data-start="2018.37" data-end="2020.77">money has really freed up us freed us up</span> <span data-start="2020.77" data-end="2023.08">from the barter of things promises have</span> <span data-start="2023.08" data-end="2023.52">the</span> <span data-start="2023.52" data-end="2030.56">to free us up from bartering reclose ok</span> <span data-start="2030.56" data-end="2033.03">so our burning promises so if you have</span> <span data-start="2033.03" data-end="2035.13">symmetric api's where responses and</span> <span data-start="2035.13" data-end="2037.71">requests have a certain degree of</span> <span data-start="2037.71" data-end="2039.06">symmetry these things can be passed</span> <span data-start="2039.06" data-end="2041.34">around really easily so this is what</span> <span data-start="2041.34" data-end="2044.13">happens here is that if you're issuing</span> <span data-start="2044.13" data-end="2048.48">via the request API a request and the</span> <span data-start="2048.48" data-end="2050.19">request is a promise and it returns a</span> <span data-start="2050.19" data-end="2052.8">promise and this is completely</span> <span data-start="2052.8" data-end="2055.14">asynchronous but looks very very</span> <span data-start="2055.14" data-end="2060.3">synchronous I'm going to just skip this</span> <span data-start="2060.3" data-end="2062.25">this is an hd2 PQ and promises there's a</span> <span data-start="2062.25" data-end="2064.35">really cool promise implementation I</span> <span data-start="2064.35" data-end="2067.11">mean there's a right really cool promise</span> <span data-start="2067.11" data-end="2069.72">trick you can do where you can create a</span> <span data-start="2069.72" data-end="2071.94">queue of promises and you can actually</span> <span data-start="2071.94" data-end="2073.409">pop things off of the queue before</span> <span data-start="2073.409" data-end="2075.33">they're resolved and it just construct</span> <span data-start="2075.33" data-end="2079.11">this it's really cool look into it this</span> <span data-start="2079.11" data-end="2080.669">is the implementation it works in</span> <span data-start="2080.669" data-end="2083.49">browsers it works in node works on</span> </p>
<p><span data-start="2083.49" data-end="2087.09">Narwhal it's really small there's no</span> <span data-start="2087.09" data-end="2089.28">reason not to use it it really</span> <span data-start="2089.28" data-end="2091.14">simplifies complicated asynchronous code</span> <span data-start="2091.14" data-end="2092.58">both on the server and the client I</span> <span data-start="2092.58" data-end="2096.87">really encourage its use you can get it</span> <span data-start="2096.87" data-end="2100.44">on github with my alliterative name and</span> <span data-start="2100.44" data-end="2103.17">cue as the project name you can also NPM</span> <span data-start="2103.17" data-end="2107.85">install q it's there then I was going to</span> <span data-start="2107.85" data-end="2109.32">show you some stuff from a utility</span> <span data-start="2109.32" data-end="2110.88">library i created a qu till it's in</span> <span data-start="2110.88" data-end="2113.04">progress this does shallow resolution of</span> <span data-start="2113.04" data-end="2115.32">an array so it gets its implies you</span> <span data-start="2115.32" data-end="2116.64">don't have to do use reduce you can just</span> <span data-start="2116.64" data-end="2118.71">use the shallow resolver to take an</span> <span data-start="2118.71" data-end="2120.27">array of promises and get a promise for</span> <span data-start="2120.27" data-end="2123.15">an array instead and this can do a deep</span> <span data-start="2123.15" data-end="2125.67">resolution which you have a whole tree</span> <span data-start="2125.67" data-end="2127.46">of objects that may include promises and</span> <span data-start="2127.46" data-end="2130.56">shameless plug since May I've been</span> <span data-start="2130.56" data-end="2132.57">making a map of middle-earth it's like</span> </p>
<p><span data-start="2132.57" data-end="2135.84">Google Maps it's really cool and because</span> <span data-start="2135.84" data-end="2137.79">it wasn't awesome enough I also did in</span> <span data-start="2137.79" data-end="2147.08">elvish and have a good day</span> </p>
</section>