<section>
<p><span data-start="31.869" data-end="36.129">so um I'll be talking about the</span> <span data-start="36.129" data-end="39.61">techniques browser or other engines are</span> <span data-start="39.61" data-end="41.65">using to compile JavaScript to get the</span> <span data-start="41.65" data-end="43.51">kind of impressive performance that</span> <span data-start="43.51" data-end="47.67">we've been getting in the past few years</span> <span data-start="47.67" data-end="50.89">the original title of my talk suggested</span> <span data-start="50.89" data-end="54.3">that I would also be giving practical</span> <span data-start="54.3" data-end="56.129">information about how to write</span> <span data-start="56.129" data-end="58.239">high-performance JavaScript there will</span> <span data-start="58.239" data-end="60.69">be less of that in it because actually</span> <span data-start="60.69" data-end="62.8">the engines are so clever about</span> <span data-start="62.8" data-end="64.72">optimizing that it's hard to break them</span> <span data-start="64.72" data-end="66.67">you have to actively try to break their</span> <span data-start="66.67" data-end="68.65">optimizations so if you're not doing</span> <span data-start="68.65" data-end="71.11">anything stupid you will get usually</span> <span data-start="71.11" data-end="75.85">fast code yeah so Brendan introduced me</span> <span data-start="75.85" data-end="78.28">so you may know me from my book I also</span> <span data-start="78.28" data-end="80.35">wrote a library code mirror which was</span> <span data-start="80.35" data-end="82.56">mentioned in the ACE talk before and</span> <span data-start="82.56" data-end="87.1">last year's J's 1k I wrote the winning</span> <span data-start="87.1" data-end="94.49">platform game demo thank you</span> <span data-start="94.5" data-end="97.81">so first I want to give some perspective</span> <span data-start="97.81" data-end="99.579">about what happens with browser</span> <span data-start="99.579" data-end="103.149">performance in the past say 15 years so</span> <span data-start="103.149" data-end="104.92">here we have the dark ages there was</span> </p>
<p><span data-start="104.92" data-end="106.539">Netscape 4 and there was Internet</span> <span data-start="106.539" data-end="108.88">Explorer 6 and thanks for our 6 is on</span> <span data-start="108.88" data-end="110.499">the benchmarks I said too it actually a</span> <span data-start="110.499" data-end="113.77">little slower than let's get four of us</span> <span data-start="113.77" data-end="115.45">of course it's supported a lot more</span> <span data-start="115.45" data-end="120.85">javascript these are by the way well</span> <span data-start="120.85" data-end="123.039">roughly BAE did the numbers I'm giving</span> <span data-start="123.039" data-end="125.499">here are completely vague and weird and</span> <span data-start="125.499" data-end="127.389">you shouldn't take them too seriously</span> <span data-start="127.389" data-end="129.31">they're based on SunSpider but I</span> <span data-start="129.31" data-end="130.899">couldn't get SunSpider to run in these</span> <span data-start="130.899" data-end="134.53">two browsers at all so I did I ran some</span> <span data-start="134.53" data-end="136">of the benchmarks that did run and then</span> <span data-start="136" data-end="139.209">interpolate it to a score to be able to</span> <span data-start="139.209" data-end="143.47">put these in my graph um wait so then</span> <span data-start="143.47" data-end="146.77">there's things getting better in the</span> <span data-start="146.77" data-end="149.55">middle zero Sh</span> </p>
<p><span data-start="149.55" data-end="151.93">Ajax happens and people started to</span> <span data-start="151.93" data-end="155.64">actually use JavaScript for more than</span> <span data-start="155.64" data-end="159.1">window open and document writes people</span> <span data-start="159.1" data-end="162.01">started to write big complicated systems</span> <span data-start="162.01" data-end="164.46">in JavaScript and this JavaScript</span> <span data-start="164.46" data-end="170.73">Foreman's became something serious and</span> <span data-start="170.73" data-end="172.95">browsers continue to push the envelope</span> <span data-start="172.95" data-end="176.39">Safari and chrome were very impressive</span> <span data-start="176.39" data-end="180.21">here the the green bar is Safari orange</span> <span data-start="180.21" data-end="182.16">is Firefox well maybe you can read this</span> <span data-start="182.16" data-end="185.4">you can probably read them then we have</span> <span data-start="185.4" data-end="187.29">this tiny little bar for Chrome there</span> <span data-start="187.29" data-end="189.69">and then in the last few years you see</span> <span data-start="189.69" data-end="194.76">all browsers stabilizing on tiny little</span> <span data-start="194.76" data-end="197.28">bars compared to what we historically</span> <span data-start="197.28" data-end="202.11">had part of this is that no one wants to</span> <span data-start="202.11" data-end="205.05">be left behind on this since SunSpider</span> <span data-start="205.05" data-end="208.02">benchmark scores are they all micro</span> <span data-start="208.02" data-end="209.97">optimized for SunSpider and this is</span> <span data-start="209.97" data-end="212.88">should not be taken too seriously but</span> <span data-start="212.88" data-end="215.34">yeah things definitely got faster I got</span> <span data-start="215.34" data-end="218.88">a lot faster if you compare to 2001</span> <span data-start="218.88" data-end="225">that's 100 time improvement so of course</span> <span data-start="225" data-end="227.04">this is like diminishing returns you</span> <span data-start="227.04" data-end="229.56">won't be expecting this kind of speed</span> <span data-start="229.56" data-end="231.18">ups in the next few years all will be</span> <span data-start="231.18" data-end="236.64">faster than C in two years but there are</span> <span data-start="236.64" data-end="238.59">still some things happening and probably</span> <span data-start="238.59" data-end="240.93">will see another speed-up of two or</span> <span data-start="240.93" data-end="244.2">three times I come from is that I'm not</span> <span data-start="244.2" data-end="248.82">writing JavaScript engines so how do</span> <span data-start="248.82" data-end="252.45">people do this this is also pretty much</span> <span data-start="252.45" data-end="256.23">the outline of my talk there are four</span> <span data-start="256.23" data-end="260.79">main things most browsers are compiling</span> <span data-start="260.79" data-end="262.23">to machine code we're all modern</span> <span data-start="262.23" data-end="263.73">browsers are compiling to machine count</span> <span data-start="263.73" data-end="267.18">one way or another there are some</span> <span data-start="267.18" data-end="268.77">improvements in how values are</span> <span data-start="268.77" data-end="272.43">represented a very big thing is caching</span> <span data-start="272.43" data-end="275.82">access to properties so that you can</span> <span data-start="275.82" data-end="277.53">actually look up object properties</span> <span data-start="277.53" data-end="279.57">without hashing stuff and looking</span> <span data-start="279.57" data-end="282.02">through big tables and things like that</span> <span data-start="282.02" data-end="284.24">garbage collection has been improved</span> <span data-start="284.24" data-end="287.55">tremendously especially in the past few</span> <span data-start="287.55" data-end="290.1">years and of course people are gaming</span> <span data-start="290.1" data-end="292.83">benchmarks for all they can like there</span> <span data-start="292.83" data-end="295.74">was this this scandal with IE 9 doing</span> <span data-start="295.74" data-end="297.88">dead couch</span> <span data-start="297.88" data-end="301.84">but no one knows what exactly happen</span> <span data-start="301.84" data-end="303.31">because it's close source but it seems</span> <span data-start="303.31" data-end="306.13">that it only noticed that something was</span> <span data-start="306.13" data-end="308.76">dead code if it was SunSpider</span> <span data-start="308.76" data-end="311.26">and maybe they've improved maybe they've</span> <span data-start="311.26" data-end="313.24">changed I don't really know watch what's</span> <span data-start="313.24" data-end="316.449">going on there but also brushes are</span> <span data-start="316.449" data-end="319.18">caching the result of method cosine</span> <span data-start="319.18" data-end="322.389">because SunSpider calls cosine a lot but</span> <span data-start="322.389" data-end="324.639">caching that doesn't make any sense in</span> <span data-start="324.639" data-end="325.9">the general case so they're actually</span> <span data-start="325.9" data-end="328.51">probably doing it this service to normal</span> <span data-start="328.51" data-end="330.91">scripts to optimize SunSpider there's</span> <span data-start="330.91" data-end="334.169">some weird things going on first thing</span> <span data-start="334.169" data-end="338.83">compilation now the old way the very</span> <span data-start="338.83" data-end="340.66">simple way to run a JavaScript program</span> <span data-start="340.66" data-end="343.389">is you parse it you build up like a big</span> <span data-start="343.389" data-end="345.9">syntax tree and then you run over that's</span> <span data-start="345.9" data-end="352.85">interpreting the the tree you have</span> <span data-start="352.86" data-end="355.51">that's something you can implement in a</span> <span data-start="355.51" data-end="357.85">few days it's probably what Brendan did</span> <span data-start="357.85" data-end="365.35">back in 1995 but so what you have to do</span> <span data-start="365.35" data-end="367.99">is for example you resolve variables at</span> <span data-start="367.99" data-end="369.97">runtime so you you're you're looking up</span> <span data-start="369.97" data-end="372.88">things in in scopes that you are holding</span> <span data-start="372.88" data-end="374.47">in memory somehow which have the actual</span> <span data-start="374.47" data-end="377.53">variable names and it's it's necessarily</span> <span data-start="377.53" data-end="380.229">terribly slow so no one does that</span> <span data-start="380.229" data-end="382.66">anymore next step up is you compiled to</span> <span data-start="382.66" data-end="384.13">bytecode this is usually a pretty</span> <span data-start="384.13" data-end="387.91">high-level form of code it's relatively</span> <span data-start="387.91" data-end="390.9">easy and fast to compile to it's small</span> <span data-start="390.9" data-end="393.37">and you get a lot of benefits of</span> <span data-start="393.37" data-end="395.02">compilation for examples variables are</span> <span data-start="395.02" data-end="397.57">results at compile time and during</span> <span data-start="397.57" data-end="399.28">runtime you're just referring to for</span> <span data-start="399.28" data-end="401.11">example a stack location and not to a</span> <span data-start="401.11" data-end="404.08">name that has to be looked at of course</span> <span data-start="404.08" data-end="406.03">you're still running it through an</span> <span data-start="406.03" data-end="408.37">interpreter so here's an example there's</span> <span data-start="408.37" data-end="410.229">a trivial function that adds one to its</span> <span data-start="410.229" data-end="411.789">second arguments then multiplies it by</span> <span data-start="411.789" data-end="414.36">its first arguments if we take a</span> <span data-start="414.36" data-end="416.91">non-existing stack based virtual machine</span> <span data-start="416.91" data-end="419.53">the the bytecode could look like this</span> <span data-start="419.53" data-end="421.57">you push one onto the stack you adds the</span> <span data-start="421.57" data-end="423.28">two top numbers of the stack combine</span> <span data-start="423.28" data-end="425.77">them into one and replace them by that</span> <span data-start="425.77" data-end="428.11">number you multiply what's a top of the</span> <span data-start="428.11" data-end="430.99">stack now and you jump out of function</span> <span data-start="430.99" data-end="433.72">so you notice that this is like you</span> <span data-start="433.72" data-end="435.88">reduce a lot of complexity by the</span> <span data-start="435.88" data-end="438.43">compilation process and well it's not</span> <span data-start="438.43" data-end="440.11">hard to imagine that interpretation of</span> <span data-start="440.11" data-end="441.43">this will be much faster than</span> <span data-start="441.43" data-end="444.99">interpretation of the raw ast3</span> <span data-start="444.99" data-end="449.08">next step is machine code because then</span> <span data-start="449.08" data-end="450.759">you don't have any runtime</span> <span data-start="450.759" data-end="452.5">interpretation at all anymore you're</span> <span data-start="452.5" data-end="456.009">just letting the Machine run your code</span> <span data-start="456.009" data-end="458.41">there's there's different approaches I</span> <span data-start="458.41" data-end="460.41">think VI it compiles everything it gets</span> <span data-start="460.41" data-end="463.78">down to machine code right away it's</span> <span data-start="463.78" data-end="465.31">possible to compile on the mount like</span> <span data-start="465.31" data-end="467.83">live your functions in the raw form and</span> <span data-start="467.83" data-end="469.599">when they're actually called compile</span> <span data-start="469.599" data-end="471.43">them what Firefox does is very</span> <span data-start="471.43" data-end="473.259">interesting it's it's compiled to</span> <span data-start="473.259" data-end="476.289">bytecode it interprets that but detects</span> <span data-start="476.289" data-end="478.93">hot loops loops that are run to a lot</span> <span data-start="478.93" data-end="481.33">and then starts compiling those with</span> <span data-start="481.33" data-end="483.31">contextual information about the types</span> <span data-start="483.31" data-end="486.099">of things that are being used there so</span> <span data-start="486.099" data-end="489.009">it can compile to tighter machine code</span> <span data-start="489.009" data-end="490.21">than if you're compiling from the</span> <span data-start="490.21" data-end="493.78">general case but it's a very complicated</span> <span data-start="493.78" data-end="496.27">complicated technique like they try to</span> <span data-start="496.27" data-end="498.909">get a whole loop to compile and then</span> <span data-start="498.909" data-end="500.47">from then on the whole loop can run</span> <span data-start="500.47" data-end="505.469">without entering bytecode at all anymore</span> <span data-start="505.469" data-end="508.479">now the reason why JavaScript can be</span> <span data-start="508.479" data-end="510.58">compiled efficiently at all in contrast</span> <span data-start="510.58" data-end="514.029">to for example Python is that it is in</span> <span data-start="514.029" data-end="516.969">the ends largely statically scoped if we</span> <span data-start="516.969" data-end="518.32">have this card example there are three</span> <span data-start="518.32" data-end="521.14">variables the compiler can see exactly</span> <span data-start="521.14" data-end="524.32">where these variables live acts as a</span> <span data-start="524.32" data-end="526.44">global y&z are arguments to the function</span> <span data-start="526.44" data-end="529.39">it can decide at compile time where it's</span> <span data-start="529.39" data-end="531.459">going to store them in a register on the</span> <span data-start="531.459" data-end="533.5">stack or on some global memory that the</span> <span data-start="533.5" data-end="535.029">global will probably end up in global</span> <span data-start="535.029" data-end="538.12">memory and then at runtime it just has</span> <span data-start="538.12" data-end="540.85">to access that there's some hairiness</span> <span data-start="540.85" data-end="542.89">with the fact that the global object is</span> <span data-start="542.89" data-end="544.899">also an object so you can first one will</span> <span data-start="544.899" data-end="546.67">delete properties from it and it has to</span> <span data-start="546.67" data-end="548.19">check when it's accessing those</span> <span data-start="548.19" data-end="550.39">variables whether they have been deleted</span> <span data-start="550.39" data-end="551.95">but because there's only one global</span> <span data-start="551.95" data-end="553.72">object it knows the object where it will</span> <span data-start="553.72" data-end="555.88">be looking at those variables and it can</span> <span data-start="555.88" data-end="559.81">optimize it pretty well except of course</span> <span data-start="559.81" data-end="564.55">if you do with this became a completely</span> <span data-start="564.55" data-end="569.31">dynamic scope when looking up X&Y</span> <span data-start="569.31" data-end="572.08">it knows that they might be the function</span> <span data-start="572.08" data-end="574.39">parameters but before getting their</span> <span data-start="574.39" data-end="577.3">value it always has to go through this</span> <span data-start="577.3" data-end="581.38">object scope and so it's it's variable</span> <span data-start="581.38" data-end="583.029">reference in the program within this</span> <span data-start="583.029" data-end="585.73">scope it's going to take a big hit but</span> <span data-start="585.73" data-end="588.49">the nice thing is that the compiler can</span> <span data-start="588.49" data-end="590.17">see statically that there is a width</span> <span data-start="590.17" data-end="592.329">there and when there is no width it</span> <span data-start="592.329" data-end="593.92">doesn't have to deal with the whole</span> <span data-start="593.92" data-end="595.93">construct at all so as long as you don't</span> <span data-start="595.93" data-end="601.12">use it you don't pay for it mm then</span> <span data-start="601.12" data-end="603.1">there's of course the other construct</span> <span data-start="603.1" data-end="606.329">that we would like to talk about evil</span> <span data-start="606.329" data-end="609.73">that also because it can introduce new</span> <span data-start="609.73" data-end="612.16">variables into the the scope it</span> <span data-start="612.16" data-end="614.05">complicates scope handling the scope has</span> <span data-start="614.05" data-end="616.3">to be more dynamic Russia actually much</span> <span data-start="616.3" data-end="618.07">faster about handling FL than about</span> <span data-start="618.07" data-end="620.649">handling with probably because evil is</span> <span data-start="620.649" data-end="623.5">used in SunSpider and with is not so</span> <span data-start="623.5" data-end="628.209">there is a motivation for this so then</span> <span data-start="628.209" data-end="630.339">here we have some beautiful moral</span> <span data-start="630.339" data-end="633.04">judgments now the first thing with I</span> <span data-start="633.04" data-end="634.93">actually it's usually turtle to</span> <span data-start="634.93" data-end="636.52">transform your code to an equivalent</span> <span data-start="636.52" data-end="638.709">form that doesn't use with and is no</span> <span data-start="638.709" data-end="642.82">more complicated in it so the only place</span> </p>
<p><span data-start="642.82" data-end="646.69">I use with is in J's 1k demos then</span> <span data-start="646.69" data-end="651.339">evolve actually if all does something</span> <span data-start="651.339" data-end="655.63">that's very useful and you can do</span> <span data-start="655.63" data-end="658.36">dynamic code loading you can do for</span> <span data-start="658.36" data-end="659.829">example compiling your templates to</span> <span data-start="659.829" data-end="661.149">actual scripts and having them be</span> <span data-start="661.149" data-end="663.07">blazing fast you can do metaprogramming</span> <span data-start="663.07" data-end="667.06">of some kind we need Evo and the good</span> <span data-start="667.06" data-end="668.92">news is that there are two kinds of</span> <span data-start="668.92" data-end="671.709">evolve I mentioned before that the</span> <span data-start="671.709" data-end="673.3">compiler can statically see whether your</span> <span data-start="673.3" data-end="675.73">scope is is completely static or not</span> <span data-start="675.73" data-end="678.31">that means only when eval looks like</span> <span data-start="678.31" data-end="680.649">there the red thing at the top here when</span> <span data-start="680.649" data-end="682.899">it's a direct call to the word evolve</span> <span data-start="682.899" data-end="686.8">then it's a local lexical eval which is</span> <span data-start="686.8" data-end="688.839">evaluated in the scope of the function</span> <span data-start="688.839" data-end="692.35">that calls it any other forms like these</span> <span data-start="692.35" data-end="697.06">weird things below here are indirect</span> <span data-start="697.06" data-end="698.35">indirect</span> <span data-start="698.35" data-end="701.17">the compiler can well if it had to</span> <span data-start="701.17" data-end="702.88">statically determine whether something</span> <span data-start="702.88" data-end="705.01">is going to evaluate to the eval</span> <span data-start="705.01" data-end="707.8">function its halting problem so if it</span> <span data-start="707.8" data-end="710.05">cannot so what it does then this is</span> <span data-start="710.05" data-end="712.54">actually not mandated by ACMA script</span> <span data-start="712.54" data-end="714.46">tree but I think ACMA scripts 5 does</span> <span data-start="714.46" data-end="717.94">mandated you get global evolve if you</span> <span data-start="717.94" data-end="720.31">treat evolve like a value you get a</span> <span data-start="720.31" data-end="722.47">function which does a global evolve and</span> <span data-start="722.47" data-end="726.31">globally fall is much nicer than lexical</span> <span data-start="726.31" data-end="728.17">avoid doesn't screw up your compilation</span> <span data-start="728.17" data-end="730.03">it's easier to think about because it</span> <span data-start="730.03" data-end="731.86">won't override variables in your local</span> <span data-start="731.86" data-end="733.75">scope well you're still of course</span> <span data-start="733.75" data-end="735.4">trusting the code that you're evaluating</span> <span data-start="735.4" data-end="740.32">but usually this is what you want when</span> <span data-start="740.32" data-end="741.46">you want evolve</span> <span data-start="741.46" data-end="743.95">the line at the bottom is nicest you</span> <span data-start="743.95" data-end="745.03">just give it a new name</span> <span data-start="745.03" data-end="746.74">and from then on you can use that name</span> <span data-start="746.74" data-end="753.04">to eval things in a more safe way next</span> <span data-start="753.04" data-end="755.68">thing is failure presentation so in a</span> <span data-start="755.68" data-end="758.14">dynamic language each value that is</span> <span data-start="758.14" data-end="760.72">being passed around has to also tell its</span> <span data-start="760.72" data-end="764.38">type somehow because the code doesn't</span> <span data-start="764.38" data-end="766.18">know what type it's going to get them it</span> <span data-start="766.18" data-end="767.92">has to inspect this type to know for</span> <span data-start="767.92" data-end="769.66">example when the plus operator is</span> <span data-start="769.66" data-end="771.28">applies what it should do whether it's</span> <span data-start="771.28" data-end="773.61">concatenating strings or adding numbers</span> <span data-start="773.61" data-end="776.47">the obvious way to do this is to put</span> <span data-start="776.47" data-end="778.66">everything on the heap at a type stag</span> <span data-start="778.66" data-end="780.49">words at the front of the value and then</span> <span data-start="780.49" data-end="783.01">the actual value itself so you can just</span> <span data-start="783.01" data-end="786.19">inspect them problem with this is that</span> <span data-start="786.19" data-end="789.16">you're usually making lots of numbers</span> <span data-start="789.16" data-end="791.23">for example in your programs mostly</span> <span data-start="791.23" data-end="793.81">numbers when you do plus you create a</span> <span data-start="793.81" data-end="795.82">new number and when you're looping</span> <span data-start="795.82" data-end="798.31">through when you have a loop index</span> <span data-start="798.31" data-end="799.96">you're creating thousands of numbers</span> <span data-start="799.96" data-end="802.6">typically allocating those on the heap</span> <span data-start="802.6" data-end="809.56">is utterly unacceptable and so what you</span> <span data-start="809.56" data-end="812.32">can do is now that every pointer you</span> <span data-start="812.32" data-end="814.51">allocate every pointer that is used by</span> <span data-start="814.51" data-end="816.04">the runtime is allocated by the runtime</span> <span data-start="816.04" data-end="818.17">and it can it's probably just want to</span> <span data-start="818.17" data-end="821.04">align those pointers like make sure that</span> <span data-start="821.04" data-end="823.99">they refer to multiples of four or eight</span> <span data-start="823.99" data-end="825.85">depending on whether you're on the 32 or</span> <span data-start="825.85" data-end="828.99">64-bit architecture because accessing</span> <span data-start="828.99" data-end="831.55">memory words is much much faster when</span> <span data-start="831.55" data-end="832.12">these words</span> <span data-start="832.12" data-end="834.97">lines anyway so that means the last two</span> <span data-start="834.97" data-end="838.06">or three bits of your pointers will be</span> <span data-start="838.06" data-end="840.79">zero and you can use that to distinguish</span> <span data-start="840.79" data-end="842.38">between pointers values which have the</span> <span data-start="842.38" data-end="845.26">type Tec in the pointed to structure and</span> <span data-start="845.26" data-end="849.58">other values in this case we're going to</span> <span data-start="849.58" data-end="852.279">represent an integer engines tend to</span> <span data-start="852.279" data-end="854.26">take care to represent numbers as</span> <span data-start="854.26" data-end="855.97">integers as long as they can</span> </p>
<p><span data-start="855.97" data-end="857.589">JavaScript numbers are specified to be</span> <span data-start="857.589" data-end="860.35">floats 64-bit floating-point numbers but</span> <span data-start="860.35" data-end="862.839">as long as they are integers smaller</span> <span data-start="862.839" data-end="866.5">than well in this case 32 bits they can</span> <span data-start="866.5" data-end="868.72">be represented as integers or two-bit as</span> <span data-start="868.72" data-end="870.49">long as you detect overflow and switch</span> <span data-start="870.49" data-end="876.13">to a float at the proper point so what</span> <span data-start="876.13" data-end="878.17">happens here is that you see these bits</span> <span data-start="878.17" data-end="880.48">at the bottom the top bit is set to 1 to</span> <span data-start="880.48" data-end="882.22">indicate if it's an integer and then the</span> <span data-start="882.22" data-end="885.79">rest of the word is the 32 31 bits that</span> <span data-start="885.79" data-end="888.01">are remaining is the representation of</span> <span data-start="888.01" data-end="889.87">the actual numbers shifted to the left</span> <span data-start="889.87" data-end="891.79">by one bit</span> <span data-start="891.79" data-end="894.82">it makes arithmetic a bit more involved</span> <span data-start="894.82" data-end="897.4">but it means you won't have to melech to</span> <span data-start="897.4" data-end="898.44">create a new number</span> <span data-start="898.44" data-end="901.3">what Firefox and possibly other engines</span> <span data-start="901.3" data-end="902.77">is currently doing is representing</span> <span data-start="902.77" data-end="906.85">everything with 64 bits which has a nice</span> <span data-start="906.85" data-end="908.95">property that you won't have to box your</span> <span data-start="908.95" data-end="910.87">floating point numbers heater so those</span> <span data-start="910.87" data-end="913.08">are also really fast and really direct</span> <span data-start="913.08" data-end="915.16">the trick is of course that the floating</span> <span data-start="915.16" data-end="917.95">point number is 64 bits so how do you</span> <span data-start="917.95" data-end="921.459">use where do you put the the type stack</span> <span data-start="921.459" data-end="922.81">if you're already using every single</span> <span data-start="922.81" data-end="925.44">bits for your floating point number</span> <span data-start="925.44" data-end="928.27">the floating the OEE</span> </p>
<p><span data-start="928.27" data-end="929.8">I'd have forgot the number the the</span> <span data-start="929.8" data-end="932.02">standard floating point spec which all</span> <span data-start="932.02" data-end="933.73">modern architectures are using for their</span> <span data-start="933.73" data-end="937.72">machine flows defines not a number of</span> <span data-start="937.72" data-end="940.57">values and actually it defines lots of</span> <span data-start="940.57" data-end="945.22">those like the last anything that starts</span> <span data-start="945.22" data-end="949.69">with 7ff for ffff and has not all zeros</span> <span data-start="949.69" data-end="951.25">after that because all zeros are used</span> <span data-start="951.25" data-end="955.12">for infinity and minus infinity is not a</span> <span data-start="955.12" data-end="957.33">number value there was some region III</span> <span data-start="957.33" data-end="960.01">won't claim to completely understand</span> <span data-start="960.01" data-end="962.47">this floating point specification but</span> <span data-start="962.47" data-end="964.6">there was a reason for this the it's</span> <span data-start="964.6" data-end="965.98">sometimes apparently nice</span> <span data-start="965.98" data-end="967.66">to have lots of different not a number</span> <span data-start="967.66" data-end="970.39">of values javascript only needs one did</span> <span data-start="970.39" data-end="974.65">the average crip standard just says that</span> <span data-start="974.65" data-end="976.96">every not a number is an equal to every</span> <span data-start="976.96" data-end="980.02">other not a number value so that leaves</span> <span data-start="980.02" data-end="982.26">all these other values for representing</span> <span data-start="982.26" data-end="986.8">in this case we put the type tag is that</span> <span data-start="986.8" data-end="988.99">the if you look at the yellow box the</span> <span data-start="988.99" data-end="991.27">one there would be the type tag and then</span> <span data-start="991.27" data-end="993.82">you can just put the integer if you need</span> <span data-start="993.82" data-end="995.17">it certitude bit integer and the</span> <span data-start="995.17" data-end="997.6">remaining 32 bits at the end if you want</span> <span data-start="997.6" data-end="999.43">bigger integers you can even use more</span> <span data-start="999.43" data-end="1004.35">bits and then if you use a two type tag</span> <span data-start="1004.35" data-end="1006.78">and you put the pointer in the rest of</span> <span data-start="1006.78" data-end="1011.43">the value you don't need to box flows</span> <span data-start="1011.43" data-end="1015.45">anymore and you have a really convenient</span> <span data-start="1015.45" data-end="1017.37">uniform representation where the type</span> <span data-start="1017.37" data-end="1020.82">tag is always present in the word itself</span> <span data-start="1020.82" data-end="1024.03">without changing pointers I'm told that</span> <span data-start="1024.03" data-end="1025.86">this is a great win for Firefox that</span> <span data-start="1025.86" data-end="1031.11">they sped things up with this trick then</span> <span data-start="1031.11" data-end="1034.08">we proceeded to garbage collection so</span> <span data-start="1034.08" data-end="1036.48">here I have a schematic picture of a</span> <span data-start="1036.48" data-end="1039.3">heap you can see that the the the grey</span> <span data-start="1039.3" data-end="1040.98">rectangle there is supposed to represent</span> <span data-start="1040.98" data-end="1043.64">the program that the route pointers of</span> <span data-start="1043.64" data-end="1045.51">things that the program is actually</span> <span data-start="1045.51" data-end="1050.79">holding onto so I challenge you to tell</span> <span data-start="1050.79" data-end="1052.56">me which of these blue dots are no</span> <span data-start="1052.56" data-end="1054.09">longer reachable from blue route</span> <span data-start="1054.09" data-end="1058.41">pointers here that's not really a</span> <span data-start="1058.41" data-end="1061.41">problem um and actually we can see that</span> <span data-start="1061.41" data-end="1063.48">there's like one circle that has no</span> <span data-start="1063.48" data-end="1065.1">errors at all there because we can just</span> <span data-start="1065.1" data-end="1066.57">look at the circle and there are no</span> <span data-start="1066.57" data-end="1069.75">arrows around it the runtime has to</span> <span data-start="1069.75" data-end="1071.46">actually look at every single one of</span> <span data-start="1071.46" data-end="1073.98">these blue dots and make sure that</span> <span data-start="1073.98" data-end="1075.69">there's not a pointer in them pointing</span> <span data-start="1075.69" data-end="1077.19">at this thing it doesn't have like a</span> <span data-start="1077.19" data-end="1080.27">nice high-level overview of this it's</span> <span data-start="1080.27" data-end="1083.46">it's difficult to see which which memory</span> <span data-start="1083.46" data-end="1085.08">objects are life and which memory</span> <span data-start="1085.08" data-end="1086.67">objects are no longer reachable and can</span> <span data-start="1086.67" data-end="1089.88">this be collected the usual way to do</span> <span data-start="1089.88" data-end="1092.01">this it's called mark-sweep you start at</span> <span data-start="1092.01" data-end="1096.21">the roots and you just traverse pointers</span> <span data-start="1096.21" data-end="1098.19">and every time you come across an object</span> <span data-start="1098.19" data-end="1099.09">you</span> <span data-start="1099.09" data-end="1101.46">market with a bit somewhere if you come</span> <span data-start="1101.46" data-end="1102.96">across an object that's already marked</span> <span data-start="1102.96" data-end="1104.85">you stop otherwise you go through all</span> <span data-start="1104.85" data-end="1106.98">its children in the same way and then at</span> <span data-start="1106.98" data-end="1108.99">the end everything that's not been</span> <span data-start="1108.99" data-end="1112.53">reached is that because you've proven</span> <span data-start="1112.53" data-end="1114.69">that you can't reach it this thing is</span> <span data-start="1114.69" data-end="1118.17">that while you're approving this you</span> <span data-start="1118.17" data-end="1121.38">can't allow anyone to change anything</span> <span data-start="1121.38" data-end="1123.18">because it might introduce a new error</span> <span data-start="1123.18" data-end="1125.64">which will hook your whole analysis so</span> <span data-start="1125.64" data-end="1127.53">typically you are stopping the world</span> <span data-start="1127.53" data-end="1130.95">during this collection and it's the root</span> <span data-start="1130.95" data-end="1132.84">of the infamous garbage collection</span> <span data-start="1132.84" data-end="1135.96">process in JavaScript interpreter while</span> <span data-start="1135.96" data-end="1137.91">it's going through its whole memory or</span> <span data-start="1137.91" data-end="1140.4">at least all the live memory it doesn't</span> <span data-start="1140.4" data-end="1142.71">let the scripts run it doesn't let</span> <span data-start="1142.71" data-end="1145.86">anything happen so that's bad there's</span> <span data-start="1145.86" data-end="1148.95">some improvement of techniques which do</span> <span data-start="1148.95" data-end="1152.16">this incrementally and which detect</span> <span data-start="1152.16" data-end="1154.76">whether something changes and retrace</span> <span data-start="1154.76" data-end="1158.52">some parts later that helps another</span> <span data-start="1158.52" data-end="1161.16">thing that helps is making your heap</span> <span data-start="1161.16" data-end="1166.91">smaller some browsers use to represents</span> <span data-start="1166.91" data-end="1169.44">to have one heap for all the JavaScript</span> <span data-start="1169.44" data-end="1170.76">burning and all the taps that they had</span> <span data-start="1170.76" data-end="1173.19">opened the taps and iframes and it's</span> <span data-start="1173.19" data-end="1175.86">actually a very natural thing to split</span> <span data-start="1175.86" data-end="1179.24">that's per per domain probably because</span> </p>
<p><span data-start="1179.24" data-end="1181.77">JavaScript sprout programs are allowed</span> <span data-start="1181.77" data-end="1185.16">to access things running on the same</span> <span data-start="1185.16" data-end="1187.05">domain so there can be pointers between</span> <span data-start="1187.05" data-end="1189.63">deaths but something on a different</span> <span data-start="1189.63" data-end="1192.15">domain is almost completely isolated</span> <span data-start="1192.15" data-end="1194.28">from from other programs running on</span> <span data-start="1194.28" data-end="1195.9">other domains so you can just give them</span> <span data-start="1195.9" data-end="1198.3">their own heat that makes the problem</span> <span data-start="1198.3" data-end="1200.61">smaller and this makes it much faster to</span> <span data-start="1200.61" data-end="1203.49">to to do a collection of course if you</span> <span data-start="1203.49" data-end="1208.88">have giants for example an html5 game</span> <span data-start="1208.88" data-end="1212.58">which is creating billions of objects in</span> <span data-start="1212.58" data-end="1214.92">its own tab then this doesn't save you</span> <span data-start="1214.92" data-end="1216.87">because you still have a huge heap to</span> <span data-start="1216.87" data-end="1222.72">trash another very successful trick is</span> <span data-start="1222.72" data-end="1227.37">generational garbage collection that</span> <span data-start="1227.37" data-end="1229.86">means you split the heap into two or</span> <span data-start="1229.86" data-end="1232.23">more generations we demonstrated with</span> <span data-start="1232.23" data-end="1232.71">two here</span> <span data-start="1232.71" data-end="1236.309">because it's quite simple new objects go</span> <span data-start="1236.309" data-end="1240.21">into the young generation then when you</span> <span data-start="1240.21" data-end="1242.429">collect you just collect a young</span> <span data-start="1242.429" data-end="1246.75">generation you promote those objects</span> <span data-start="1246.75" data-end="1249">sometimes directly sometimes after a few</span> <span data-start="1249" data-end="1250.86">collections after they've reach a</span> <span data-start="1250.86" data-end="1252.779">certain age you promote them to the old</span> <span data-start="1252.779" data-end="1255.299">generation and at some point the old</span> <span data-start="1255.299" data-end="1257.07">generation gets full so you will have to</span> <span data-start="1257.07" data-end="1259.559">do a more expensive collection on the</span> <span data-start="1259.559" data-end="1262.529">old generation the problem with this is</span> <span data-start="1262.529" data-end="1264.45">that to prove that something in the</span> <span data-start="1264.45" data-end="1266.48">young generation is dead is unreachable</span> <span data-start="1266.48" data-end="1269.61">you have to be sure that no object in</span> <span data-start="1269.61" data-end="1271.47">the old generation is pointing to it so</span> <span data-start="1271.47" data-end="1273.059">you have to somehow keep track of all</span> <span data-start="1273.059" data-end="1274.679">the pointers going from the old</span> <span data-start="1274.679" data-end="1278.669">generation to the new generation which</span> <span data-start="1278.669" data-end="1281.76">is which requires some kind of code</span> <span data-start="1281.76" data-end="1284.13">around every right you do or a memory</span> <span data-start="1284.13" data-end="1286.289">barrier on the pages that holds the old</span> <span data-start="1286.289" data-end="1290.13">generations this is tricky but it still</span> <span data-start="1290.13" data-end="1293.34">worth it Firefox is planning to move to</span> <span data-start="1293.34" data-end="1295.559">generational GCV I'd had it from the</span> <span data-start="1295.559" data-end="1301.83">start and it's it's a huge win so here's</span> <span data-start="1301.83" data-end="1307.83">some bad pun come saying is is from the</span> </p>
<p><span data-start="1307.83" data-end="1310.549">Lisp world word that means allocating</span> <span data-start="1310.549" data-end="1312.6">allocating things on the heap and off</span> <span data-start="1312.6" data-end="1314.94">lisps you could only create lists on the</span> <span data-start="1314.94" data-end="1317.1">heap and lists list cells are called</span> <span data-start="1317.1" data-end="1319.83">constants so in the garbage collection</span> <span data-start="1319.83" data-end="1321.659">terminology cons is the word for</span> <span data-start="1321.659" data-end="1323.76">allocating and but to make something</span> <span data-start="1323.76" data-end="1326.61">fast to have your inner loop not cause</span> <span data-start="1326.61" data-end="1329.22">GC pauses you should be very careful</span> <span data-start="1329.22" data-end="1331.86">about allocating objects in a race and</span> <span data-start="1331.86" data-end="1333.539">anything that's going to end up on the</span> <span data-start="1333.539" data-end="1336.179">heap they often place to use horrible</span> <span data-start="1336.179" data-end="1338.58">dirty tricks like reusing objects and</span> <span data-start="1338.58" data-end="1340.1">setting their properties again or</span> <span data-start="1340.1" data-end="1342.539">setting Global's instead of returning an</span> <span data-start="1342.539" data-end="1345.72">object with several fields one thing to</span> <span data-start="1345.72" data-end="1348.24">be aware of is that local functions are</span> <span data-start="1348.24" data-end="1350.19">objects which are created every time you</span> <span data-start="1350.19" data-end="1352.649">call their like inner functions are</span> <span data-start="1352.649" data-end="1354.029">created every time you call their outer</span> <span data-start="1354.029" data-end="1359.13">function because they're mutable objects</span> <span data-start="1359.13" data-end="1360.809">in JavaScript so they have to be their</span> <span data-start="1360.809" data-end="1363.029">own objects</span> <span data-start="1363.029" data-end="1364.559">so you have to be careful if you're</span> <span data-start="1364.559" data-end="1366.539">calling something a lot don't put in our</span> <span data-start="1366.539" data-end="1368.22">functions in it even if they don't close</span> <span data-start="1368.22" data-end="1370.47">over anything in the outer function they</span> <span data-start="1370.47" data-end="1372.86">will still be stack allocated there are</span> <span data-start="1372.86" data-end="1374.909">possibilities to optimize that but I</span> <span data-start="1374.909" data-end="1377.059">don't think any engine does it's in my</span> <span data-start="1377.059" data-end="1382.279">benchmarks the functions that we're</span> <span data-start="1382.279" data-end="1384.99">using inner functions we're much much</span> <span data-start="1384.99" data-end="1386.46">lower to call than the function that</span> <span data-start="1386.46" data-end="1392.37">were free of inner functions so this is</span> <span data-start="1392.37" data-end="1395.99">possibly the most important thing</span> <span data-start="1395.99" data-end="1400.299">explaining the current JavaScript speed</span> <span data-start="1400.309" data-end="1403.019">properties I said before that scopes are</span> <span data-start="1403.019" data-end="1405.179">starting in JavaScript this is great</span> <span data-start="1405.179" data-end="1407.039">properties of objects are in no way</span> <span data-start="1407.039" data-end="1411.179">static you can dereference anything it</span> <span data-start="1411.179" data-end="1413.22">sits there they're prototypes to deal</span> <span data-start="1413.22" data-end="1415.379">with it's extremely hard to predict what</span> <span data-start="1415.379" data-end="1419.22">an object property dereference is going</span> <span data-start="1419.22" data-end="1424.649">to give you so what people are doing</span> <span data-start="1424.649" data-end="1427.019">what everyone is doing is inline caching</span> <span data-start="1427.019" data-end="1429.6">you can imagine that in the compiled</span> <span data-start="1429.6" data-end="1432.269">code there's like a little space next to</span> <span data-start="1432.269" data-end="1436.429">each property lookup and when it happens</span> <span data-start="1436.429" data-end="1439.889">the code writes well it's it's going to</span> <span data-start="1439.889" data-end="1442.889">look the property open an object somehow</span> <span data-start="1442.889" data-end="1445.289">and it's going to find the offset into</span> <span data-start="1445.289" data-end="1449.1">the object redish property lists at that</span> <span data-start="1449.1" data-end="1451.019">point it stores that the kind of the</span> <span data-start="1451.019" data-end="1452.879">object and the offset of the property in</span> <span data-start="1452.879" data-end="1455.279">this inline cache and the next time it</span> <span data-start="1455.279" data-end="1457.289">hits that point it checks first whether</span> <span data-start="1457.289" data-end="1459.389">it has a valid cache for this this</span> <span data-start="1459.389" data-end="1463.129">lookup if it does it can be very fast</span> <span data-start="1463.129" data-end="1464.96">effects usually there's not just</span> <span data-start="1464.96" data-end="1466.919">actually in all engines there's not just</span> <span data-start="1466.919" data-end="1468.6">one cache they use what's called</span> <span data-start="1468.6" data-end="1470.909">polymorphic inline caches today they</span> <span data-start="1470.909" data-end="1475.679">have a list of hits so that's even if</span> <span data-start="1475.679" data-end="1477.539">you have a few kinds of objects coming</span> <span data-start="1477.539" data-end="1480.11">through there it'll still be</span> <span data-start="1480.11" data-end="1483.899">successfully cached most of the time the</span> <span data-start="1483.899" data-end="1486.36">problem is that there are no classes in</span> </p>
<p><span data-start="1486.36" data-end="1489.36">JavaScript so how do you see whether new</span> <span data-start="1489.36" data-end="1491.22">objects you get has the same shape as</span> <span data-start="1491.22" data-end="1495.11">the object you got the last time around</span> <span data-start="1495.12" data-end="1499.89">what people do is synthesize classes</span> <span data-start="1499.89" data-end="1502.59">called hidden classes if you know the</span> <span data-start="1502.59" data-end="1505.82">prototype of an object and the set of</span> <span data-start="1505.82" data-end="1508.65">properties that it has just actually all</span> <span data-start="1508.65" data-end="1510.33">you need to know if there are arranged</span> <span data-start="1510.33" data-end="1511.88">in the same order</span> <span data-start="1511.88" data-end="1515.19">usually inline caches actually only</span> <span data-start="1515.19" data-end="1519.18">depend on like the linear order in which</span> <span data-start="1519.18" data-end="1522">the properties were assigned to the</span> <span data-start="1522" data-end="1523.68">object because it's much easier to do</span> <span data-start="1523.68" data-end="1526.17">what what happens is that such a hidden</span> <span data-start="1526.17" data-end="1530.1">class has a list of successor classes so</span> <span data-start="1530.1" data-end="1533.22">in this case we start with I should have</span> <span data-start="1533.22" data-end="1534.51">capitalized that because it's a</span> <span data-start="1534.51" data-end="1538.38">constructor but in this case I you get a</span> <span data-start="1538.38" data-end="1540.09">hidden class for this this function</span> <span data-start="1540.09" data-end="1542.79">because it this specifies a prototype</span> <span data-start="1542.79" data-end="1548.04">for four new objects and does it it will</span> <span data-start="1548.04" data-end="1552.12">be its own class when you have an object</span> <span data-start="1552.12" data-end="1553.44">of this class so when you call new</span> <span data-start="1553.44" data-end="1555.36">points it creates an empty objects of</span> <span data-start="1555.36" data-end="1557.85">this class and you assigned to its X it</span> <span data-start="1557.85" data-end="1559.83">looks up in this hidden class in the</span> <span data-start="1559.83" data-end="1561.27">list of successor classes whether</span> <span data-start="1561.27" data-end="1563.91">there's one that's created by assigning</span> </p>
<p><span data-start="1563.91" data-end="1566.61">X if it is then it takes that Clause if</span> <span data-start="1566.61" data-end="1568.26">not it creates a new class and adds it</span> <span data-start="1568.26" data-end="1570.99">to the list and the same for y so after</span> <span data-start="1570.99" data-end="1574.08">this you will have uniform objects after</span> <span data-start="1574.08" data-end="1576.66">running this constructor which have</span> <span data-start="1576.66" data-end="1579.69">prototype of points and x and y</span> <span data-start="1579.69" data-end="1584.58">properties and this this class is all</span> <span data-start="1584.58" data-end="1586.61">you need to know for caching because</span> <span data-start="1586.61" data-end="1588.99">yeah if you get another object of this</span> <span data-start="1588.99" data-end="1591">type you already know where you're going</span> <span data-start="1591" data-end="1595.95">to find X and we're going to find y this</span> <span data-start="1595.95" data-end="1600.21">is not completely solid it is possible</span> <span data-start="1600.21" data-end="1602.309">to break this I did some benchmarks in</span> <span data-start="1602.309" data-end="1604.98">this this is the results one noticeable</span> <span data-start="1604.98" data-end="1607.7">thing was that both Firefox for an IE 9</span> <span data-start="1607.7" data-end="1611.4">don't seem to catch lookup meshes so if</span> <span data-start="1611.4" data-end="1612.72">you're looking up a property that</span> <span data-start="1612.72" data-end="1618.21">doesn't exist it's pretty slow probably</span> <span data-start="1618.21" data-end="1619.679">because some people consider this a</span> <span data-start="1619.679" data-end="1622.2">programmer error depends on what you're</span> <span data-start="1622.2" data-end="1624.3">doing I've always happily looked for</span> <span data-start="1624.3" data-end="1625.92">properties that don't exist in objects</span> <span data-start="1625.92" data-end="1628.23">but maybe I should stop doing that</span> <span data-start="1628.23" data-end="1631.36">because you pay a small performance</span> <span data-start="1631.36" data-end="1634.12">penalty there's deep prototypes change</span> <span data-start="1634.12" data-end="1636.07">which are not handled that well the</span> </p>
<p><span data-start="1636.07" data-end="1639.85">Firefox actually deleted property from</span> <span data-start="1639.85" data-end="1643.21">an object that's pretty hard to get back</span> <span data-start="1643.21" data-end="1644.95">to some valid class then again because</span> <span data-start="1644.95" data-end="1646.48">you can delete any property sure they</span> <span data-start="1646.48" data-end="1649.03">have to be a lot more clever than just</span> <span data-start="1649.03" data-end="1650.83">dealing with edit properties both</span> <span data-start="1650.83" data-end="1652.93">Firefox and opera didn't deal that well</span> <span data-start="1652.93" data-end="1656.62">with it and then I tried just generating</span> <span data-start="1656.62" data-end="1659.76">more and more variants and at about ten</span> <span data-start="1659.76" data-end="1662.71">most caches seem to break down if you</span> <span data-start="1662.71" data-end="1664.33">have ten variants of an object's running</span> <span data-start="1664.33" data-end="1666.19">through your loop that's actually</span> <span data-start="1666.19" data-end="1670.21">already pretty rare you yeah you don't</span> <span data-start="1670.21" data-end="1672.49">usually do that or was striking when</span> <span data-start="1672.49" data-end="1674.65">doing this that was almost impossible to</span> <span data-start="1674.65" data-end="1677.8">break the v8 caching I don't know what</span> <span data-start="1677.8" data-end="1679.03">they're doing maybe I should tweet</span> <span data-start="1679.03" data-end="1680.38">through the code somehow because it's</span> <span data-start="1680.38" data-end="1687.13">apparently very clever next as a small</span> <span data-start="1687.13" data-end="1690.07">note at the end there's type inference I</span> <span data-start="1690.07" data-end="1691.81">don't think this is being done on a very</span> <span data-start="1691.81" data-end="1694.63">large scale yet but people are talking</span> <span data-start="1694.63" data-end="1696.28">about it and it's very promising and it</span> <span data-start="1696.28" data-end="1700.51">will probably be the next big gain for</span> <span data-start="1700.51" data-end="1704.73">for JavaScript performance traced</span> <span data-start="1704.73" data-end="1707.8">compilation already takes it's a bit</span> <span data-start="1707.8" data-end="1709.63">into account but it's completely runtime</span> <span data-start="1709.63" data-end="1711.88">dynamic there's actually also a lot of</span> <span data-start="1711.88" data-end="1714.85">static information about types that you</span> <span data-start="1714.85" data-end="1716.53">can glean from from a JavaScript program</span> <span data-start="1716.53" data-end="1719.44">here's a trivial example if we take the</span> </p>
<p><span data-start="1719.44" data-end="1722.26">I variable is being mutated in two</span> <span data-start="1722.26" data-end="1724.33">points because it's a local variable we</span> <span data-start="1724.33" data-end="1726.22">can prove that these are the only two</span> <span data-start="1726.22" data-end="1728.89">points that are mutated mutating it and</span> <span data-start="1728.89" data-end="1732.04">they both set it to a number starts at</span> <span data-start="1732.04" data-end="1733.81">zero and then this increment it's in the</span> <span data-start="1733.81" data-end="1735.55">increment operation leaves it a number</span> <span data-start="1735.55" data-end="1739.39">so given that we know that I will always</span> <span data-start="1739.39" data-end="1743.68">be of type number so it means you can</span> <span data-start="1743.68" data-end="1746.59">for example optimize this this</span> <span data-start="1746.59" data-end="1748.39">comparison less than you could even</span> <span data-start="1748.39" data-end="1754.36">optimize the array look up the code that</span> <span data-start="1754.36" data-end="1756.49">the output yeah the code that the</span> <span data-start="1756.49" data-end="1759.31">compiler outputs can be a little smarter</span> <span data-start="1759.31" data-end="1761.38">because it knows that I is</span> <span data-start="1761.38" data-end="1764.98">of type number there were optional type</span> <span data-start="1764.98" data-end="1768.16">annotations being talked about in what</span> <span data-start="1768.16" data-end="1770.47">was supposed to become a confused for</span> </p>
<p><span data-start="1770.47" data-end="1771.88">I'm actually kind of sad that those</span> <span data-start="1771.88" data-end="1775.48">vanished because they would they would</span> <span data-start="1775.48" data-end="1777.4">help compilers a lot even if other</span> <span data-start="1777.4" data-end="1780.46">compilers choose to ignore them and well</span> <span data-start="1780.46" data-end="1782.29">you don't have to use them if you don't</span> <span data-start="1782.29" data-end="1784.54">want them but I think they would be a</span> <span data-start="1784.54" data-end="1788.11">great addition of course there are other</span> <span data-start="1788.11" data-end="1789.61">cases if you have Global's then the</span> <span data-start="1789.61" data-end="1791.44">whole program can change your type and</span> <span data-start="1791.44" data-end="1793.99">it's very hard to prove that they are</span> <span data-start="1793.99" data-end="1795.91">going to be of a certain type same with</span> <span data-start="1795.91" data-end="1797.95">properties with objects being passed</span> <span data-start="1797.95" data-end="1800.89">around everywhere function return values</span> <span data-start="1800.89" data-end="1804.85">you need whole program analysis to to</span> <span data-start="1804.85" data-end="1807.31">get any kind of reliable information on</span> <span data-start="1807.31" data-end="1811.48">these kind of values that's exactly what</span> <span data-start="1811.48" data-end="1813.76">what Brian Hackett at Mozilla is</span> <span data-start="1813.76" data-end="1819.01">currently doing and it sounds like it's</span> <span data-start="1819.01" data-end="1820.66">it's going in the right direction and</span> <span data-start="1820.66" data-end="1822.7">it's very promising I don't know how far</span> <span data-start="1822.7" data-end="1825.52">other browser vendors are are with this</span> <span data-start="1825.52" data-end="1828.79">but yeah it's probably going to work to</span> <span data-start="1828.79" data-end="1831.64">a certain point what he talked about was</span> <span data-start="1831.64" data-end="1834.82">that you have to dynamically update</span> <span data-start="1834.82" data-end="1836.98">sometimes and recompile some code if</span> <span data-start="1836.98" data-end="1838.99">your assumptions about types are broken</span> <span data-start="1838.99" data-end="1841.09">like anyone can do an eval which changes</span> <span data-start="1841.09" data-end="1843.46">the type of global and then well you</span> <span data-start="1843.46" data-end="1845.47">have to go back and recompile some code</span> <span data-start="1845.47" data-end="1848.38">so it's it's very involved but it helps</span> <span data-start="1848.38" data-end="1854.25">it speeds things up more that was all</span> </p>
<p><span data-start="1854.25" data-end="1857.26">I'd be happy to take questions if anyone</span> <span data-start="1857.26" data-end="1870.27">has one no questions thank you</span> <span data-start="1870.28" data-end="1873.02">you know there are planes for us we</span> </p>
</section>