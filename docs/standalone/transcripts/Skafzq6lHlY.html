<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Skafzq6lHlY</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/Skafzq6lHlY?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="11.39" data-end="16.55">hi how is everybody I'm glad everybody</span> <span data-start="16.55" data-end="21.29">knows Netflix so I'm to Bobby imamura</span> <span data-start="21.29" data-end="23.119">senior software engineer from netflix</span> <span data-start="23.119" data-end="26.39">today I'm gonna share our journey how we</span> <span data-start="26.39" data-end="28.97">migrated from you I data API Mona less</span> <span data-start="28.97" data-end="32">to well isolated microservice in nodejs</span> <span data-start="32" data-end="37.4">darker cantina so why did we have a UI</span> <span data-start="37.4" data-end="39.73">data API model is from the first place</span> <span data-start="39.73" data-end="42.89">to understand that let me start by show</span> <span data-start="42.89" data-end="44.84">some business background about our</span> <span data-start="44.84" data-end="47.449">company you probably already knew we are</span> <span data-start="47.449" data-end="49.55">video streaming company what you might</span> <span data-start="49.55" data-end="51.649">not know is we have over 80 million</span> <span data-start="51.649" data-end="54.32">subscribers worldwide we stream our</span> <span data-start="54.32" data-end="58.19">content more than 125 million hours per</span> <span data-start="58.19" data-end="61.16">day so that stuns a lot of traffic to</span> <span data-start="61.16" data-end="64.94">manage now user can view our content</span> <span data-start="64.94" data-end="66.79">from hundreds of different color device</span> <span data-start="66.79" data-end="69.59">each device has its own performance</span> <span data-start="69.59" data-end="72.83">characteristic and form factor so we</span> <span data-start="72.83" data-end="75.05">need very different kind of data to</span> <span data-start="75.05" data-end="78.74">render each you I screen now the</span> <span data-start="78.74" data-end="81.92">question is how do we fetch the internal</span> <span data-start="81.92" data-end="87.92">paula deta to render it GUI in the past</span> <span data-start="87.92" data-end="92.329">we built a java data API server that</span> <span data-start="92.329" data-end="94.7">will have exposed all the internal power</span> <span data-start="94.7" data-end="97.25">service and we will have all different</span> <span data-start="97.25" data-end="100.52">kind of rest endpoint here so our your</span> <span data-start="100.52" data-end="103.159">client can make multiple requests to</span> <span data-start="103.159" data-end="105.86">this comment java api similar to fetch</span> <span data-start="105.86" data-end="109.159">the internal holiday dough but there's a</span> <span data-start="109.159" data-end="111.649">problem here most of us are you our</span> <span data-start="111.649" data-end="113.479">developer here we all know orchestrate</span> <span data-start="113.479" data-end="116.96">multiple rest api request is cuba's am</span> <span data-start="116.96" data-end="118.85">and not performing from the client</span> <span data-start="118.85" data-end="122.36">device so we improve our Comment our API</span> <span data-start="122.36" data-end="124.399">server you will take the responsibility</span> <span data-start="124.399" data-end="128.33">to orchestrate and fail the request to</span> <span data-start="128.33" data-end="133.16">our internal potter service now our</span> <span data-start="133.16" data-end="135.56">client device has full control of the</span> <span data-start="135.56" data-end="138.26">request response cycle we can just make</span> <span data-start="138.26" data-end="140.269">a word request to fudge the internal</span> <span data-start="140.269" data-end="143.33">pallador back that's awesome</span> <span data-start="143.33" data-end="152.63">oh oops did I skip so however the data</span> <span data-start="152.63" data-end="157.1">returned is in generic format it's a</span> <span data-start="157.1" data-end="159.92">one-size-fits-all device so that music</span> <span data-start="159.92" data-end="162.83">means every device will fetch data that</span> <span data-start="162.83" data-end="164.96">has some puddle and belong to render its</span> <span data-start="164.96" data-end="167.93">screen you also need to pass it that's</span> <span data-start="167.93" data-end="177.23">not very efficient so we decide to let</span> <span data-start="177.23" data-end="179.3">our UI developer to write new idea</span> <span data-start="179.3" data-end="182.11">endpoints crib inside this Java server</span> <span data-start="182.11" data-end="184.64">so inside this you are data endpoints</span> <span data-start="184.64" data-end="187.7">crib that we can write business logic to</span> <span data-start="187.7" data-end="189.8">transform the internal pollinator to the</span> <span data-start="189.8" data-end="193.61">format that fits individual device now</span> </p>
<p><span data-start="193.61" data-end="195.89">UI developer has full control of the</span> <span data-start="195.89" data-end="198.13">data returned back to the client and</span> <span data-start="198.13" data-end="201.08">also all your developer doesn't like to</span> <span data-start="201.08" data-end="203.84">write type the language like Java so we</span> <span data-start="203.84" data-end="206.18">let them right groovy script for this</span> <span data-start="206.18" data-end="208.1">endpoints cliff and we can upload the</span> <span data-start="208.1" data-end="209.93">Google script to a host of java 7 wrong</span> <span data-start="209.93" data-end="215.269">time and compile there now the benefit</span> <span data-start="215.269" data-end="218.959">of having this architecture is we get a</span> <span data-start="218.959" data-end="221.45">service infrastructure oh you are</span> <span data-start="221.45" data-end="223.55">developer that I have to write a server</span> <span data-start="223.55" data-end="225.92">or managing the server wrong time in</span> <span data-start="225.92" data-end="230.18">production and we have good operational</span> <span data-start="230.18" data-end="232.04">insight already building without Java</span> <span data-start="232.04" data-end="234.83">server so UI developer has good</span> <span data-start="234.83" data-end="236.93">visibility into the data endpoint script</span> <span data-start="236.93" data-end="241.58">d right and we have a dedicated packin</span> <span data-start="241.58" data-end="243.68">team they were managing the server</span> <span data-start="243.68" data-end="246.53">dependency for example conquered or</span> <span data-start="246.53" data-end="251.87">groovy version and all our i-team has a</span> <span data-start="251.87" data-end="255.08">consistent development workflow they</span> <span data-start="255.08" data-end="256.85">have the same script to upload their</span> <span data-start="256.85" data-end="259.669">goofy square and we have an atomic</span> <span data-start="259.669" data-end="262.25">deployment workflow because all the data</span> <span data-start="262.25" data-end="264.38">in points crib are deployed together</span> <span data-start="264.38" data-end="268.3">with just our server so it's awesome</span> <span data-start="268.3" data-end="271.669">however over the time we realize there's</span> <span data-start="271.669" data-end="274.09">a problem with this architecture our</span> <span data-start="274.09" data-end="277.56">developer workflow is inefficient</span> <span data-start="277.56" data-end="280.39">during implementation cycle we need to</span> <span data-start="280.39" data-end="281.95">constantly contact switch between</span> </p>
<p><span data-start="281.95" data-end="286.92">JavaScript and groovy script and also</span> <span data-start="286.92" data-end="290.59">when we do in code iteration we need to</span> <span data-start="290.59" data-end="292.78">upload the groovy script to a hosted</span> <span data-start="292.78" data-end="295.81">testing environment each upload takes</span> <span data-start="295.81" data-end="298.21">two to three minutes or maybe you are</span> <span data-start="298.21" data-end="301.27">longer we have 200 you I developers</span> <span data-start="301.27" data-end="304.09">every one of them does this 20 to 30</span> <span data-start="304.09" data-end="306.73">times a day this workflow really slows</span> <span data-start="306.73" data-end="309.33">down our developer and add low pressure</span> <span data-start="309.33" data-end="314.56">to our testing server an even worse we</span> <span data-start="314.56" data-end="317.41">have very limited visibility into the</span> <span data-start="317.41" data-end="319.54">testing server environment the only way</span> <span data-start="319.54" data-end="321.49">to see anything is the traditional</span> <span data-start="321.49" data-end="324.61">printing annotation so you can see our</span> <span data-start="324.61" data-end="328.96">developers in here now and also it's</span> <span data-start="328.96" data-end="330.88">very difficult to reproduce a production</span> <span data-start="330.88" data-end="332.59">problem inside the local machine to</span> <span data-start="332.59" data-end="334.6">debug because we don't have a server</span> <span data-start="334.6" data-end="339.61">setup from the first place and even</span> <span data-start="339.61" data-end="341.56">worse we figure out that we have</span> <span data-start="341.56" data-end="344.44">long-term issue here the problem is</span> <span data-start="344.44" data-end="348.55">inside data endpoint square we have 1000</span> <span data-start="348.55" data-end="351.97">10 points crib and hundreds of update</span> <span data-start="351.97" data-end="354.91">every day all this crap are running</span> <span data-start="354.91" data-end="357.4">inside the Java server without isolation</span> <span data-start="357.4" data-end="360.58">a bug inside one set of data endpoints</span> <span data-start="360.58" data-end="362.95">crib could bring down entire you are</span> <span data-start="362.95" data-end="369.16">data API fleet now if one set of data if</span> <span data-start="369.16" data-end="371.65">you ask web is taking too much cpu or</span> <span data-start="371.65" data-end="374.23">memory you will stop all the other you</span> <span data-start="374.23" data-end="377.38">are data API web so we can scale them</span> <span data-start="377.38" data-end="382.21">independently and also it's difficult to</span> <span data-start="382.21" data-end="384.58">identify which data import script is</span> <span data-start="384.58" data-end="386.8">taking that much resource because all</span> <span data-start="386.8" data-end="388.75">the operational metrics is combined as</span> <span data-start="388.75" data-end="393.31">even worse now it's also complex to</span> <span data-start="393.31" data-end="395.83">offer research platform we need to load</span> <span data-start="395.83" data-end="398.38">it runs on the API into memory compile</span> <span data-start="398.38" data-end="400.69">and warm them before we can start to</span> <span data-start="400.69" data-end="403.87">serve production traffic so the server</span> <span data-start="403.87" data-end="406.72">style time takes 15 minutes we can't</span> <span data-start="406.72" data-end="409.3">scale our server fast enough to handle</span> <span data-start="409.3" data-end="410.24">the large trafficking</span> <span data-start="410.24" data-end="413.06">crees you feel the eternity when you try</span> <span data-start="413.06" data-end="417.71">to start up your server and also we have</span> <span data-start="417.71" data-end="419.599">hundreds of different kind of scrip they</span> <span data-start="419.599" data-end="422.09">are all loaded inside the memory now</span> <span data-start="422.09" data-end="425.36">even the largest amazon instance can run</span> <span data-start="425.36" data-end="429.53">such server and at this point you can</span> <span data-start="429.53" data-end="432.41">see all you advice need to make requests</span> <span data-start="432.41" data-end="434.389">through this java data API server to</span> <span data-start="434.389" data-end="436.91">fetch internal parody de so this server</span> <span data-start="436.91" data-end="440.69">is a mano less and also it's critical if</span> <span data-start="440.69" data-end="443.84">this server goes down the UI give us can</span> <span data-start="443.84" data-end="446.09">search any data which means you can</span> <span data-start="446.09" data-end="450.62">watch your video that's a bummer so it's</span> <span data-start="450.62" data-end="453.349">important that we make this you are data</span> </p>
<p><span data-start="453.349" data-end="458.96">API server resilient and performing now</span> <span data-start="458.96" data-end="460.639">at this point we know the pro and cons</span> <span data-start="460.639" data-end="465.74">of our monolithic data API server we</span> <span data-start="465.74" data-end="468.11">want to decouple our UI data endpoint</span> <span data-start="468.11" data-end="470.24">scrip from this monolithic a server and</span> <span data-start="470.24" data-end="473.539">make a resilient we clock feedback from</span> <span data-start="473.539" data-end="476.09">our different UI team and to see what's</span> <span data-start="476.09" data-end="478.639">their ideal next generation you I did if</span> <span data-start="478.639" data-end="481.49">you have loved one our developer want to</span> <span data-start="481.49" data-end="484.009">continue have the benefit as we had in</span> <span data-start="484.009" data-end="486.919">the old architecture however they want</span> <span data-start="486.919" data-end="491.15">to fix the issue that you have let's see</span> <span data-start="491.15" data-end="493.4">what's our developers ideal development</span> <span data-start="493.4" data-end="498.08">workflow we want to continue</span> <span data-start="498.08" data-end="500.69">half-civilized infrastructure our UI</span> <span data-start="500.69" data-end="502.729">developer doesn't want to implement</span> <span data-start="502.729" data-end="505.639">server or configure the server we want</span> <span data-start="505.639" data-end="507.83">to continue have easy environment setup</span> <span data-start="507.83" data-end="511.639">on the top of that we don't want to</span> <span data-start="511.639" data-end="515">contact switch anymore and we wanted to</span> <span data-start="515" data-end="517.12">have our code reflecting to the server</span> <span data-start="517.12" data-end="519.68">instantaneously because we are impatient</span> <span data-start="519.68" data-end="521.24">we just want to relo and have things</span> <span data-start="521.24" data-end="525.68">happen and we want to run a local server</span> <span data-start="525.68" data-end="529.82">so we can attach a debug onto it we want</span> <span data-start="529.82" data-end="532.279">to reproduce a production code inside</span> <span data-start="532.279" data-end="534.41">developed local machine precisely to</span> <span data-start="534.41" data-end="538.579">debug problem now let's see what our</span> <span data-start="538.579" data-end="542.63">production go we like the operational</span> <span data-start="542.63" data-end="543.95">visibility into our you</span> <span data-start="543.95" data-end="547.73">api server and our java server has</span> <span data-start="547.73" data-end="550.01">already integrate with our netflix</span> <span data-start="550.01" data-end="553.01">existing infrastructure for example or</span> <span data-start="553.01" data-end="555.46">personal dashboard a loading system</span> <span data-start="555.46" data-end="557.99">discovered crime so that's a nice</span> <span data-start="557.99" data-end="559.61">feature we want to continue have that</span> <span data-start="559.61" data-end="563.15">and we want to have countable deployment</span> <span data-start="563.15" data-end="567.14">workflow so what's on top of it is we</span> <span data-start="567.14" data-end="570.77">want to get wrong time isolation and we</span> <span data-start="570.77" data-end="572.87">want to scale different kind of data API</span> <span data-start="572.87" data-end="576.8">service independently for example our TV</span> <span data-start="576.8" data-end="579.35">you are team has long tail device some</span> <span data-start="579.35" data-end="581.18">old version of data if your service</span> <span data-start="581.18" data-end="583.82">monthly just need one server to handle</span> <span data-start="583.82" data-end="586.46">the traffic however the latest version</span> <span data-start="586.46" data-end="590.24">might need a lot of machines so how do</span> <span data-start="590.24" data-end="594.41">we achieve all these goals here's our</span> <span data-start="594.41" data-end="597.92">solution run no geoserver inside docker</span> <span data-start="597.92" data-end="601.97">container javascript is a language or UI</span> <span data-start="601.97" data-end="604.37">developer a familiar with so normal</span> <span data-start="604.37" data-end="606.32">context switch between JavaScript and</span> <span data-start="606.32" data-end="609.56">groovy script and using dunkle continued</span> <span data-start="609.56" data-end="613.16">we got process isolation to reproduce a</span> <span data-start="613.16" data-end="615.65">version of server become easy just</span> <span data-start="615.65" data-end="617.3">viewed a version of server code as a</span> <span data-start="617.3" data-end="620.66">docker image and deploy anywhere now</span> <span data-start="620.66" data-end="625.7">also style of time become fast now at</span> <span data-start="625.7" data-end="627.71">this point we got an empty darker</span> <span data-start="627.71" data-end="630.47">container how do we build our new server</span> <span data-start="630.47" data-end="633.26">has the same feature parity as we had in</span> <span data-start="633.26" data-end="635.63">our Java server we know we wanted to</span> <span data-start="635.63" data-end="637.67">have operational visibility an</span> <span data-start="637.67" data-end="639.65">integration with existing there for the</span> <span data-start="639.65" data-end="643.19">netflix infrastructure however all UI</span> <span data-start="643.19" data-end="644.78">developer wants to have civil</span> <span data-start="644.78" data-end="647.36">infrastructure they are great fry and</span> <span data-start="647.36" data-end="649.55">developer but they might not have</span> <span data-start="649.55" data-end="651.38">specific knowledge about building a</span> <span data-start="651.38" data-end="654.77">server we obviously don't want to put</span> <span data-start="654.77" data-end="656.66">the burden to have them write a node.js</span> <span data-start="656.66" data-end="660.8">server startup code like this to fill in</span> <span data-start="660.8" data-end="663.11">the gap here we decided to view the</span> <span data-start="663.11" data-end="666.26">common know Gia's platform so we will</span> <span data-start="666.26" data-end="668.78">write comment suicide the code in this</span> <span data-start="668.78" data-end="671.44">problem for example server startup</span> <span data-start="671.44" data-end="674.48">location error handling matrix</span> <span data-start="674.48" data-end="678.49">population and this load balancing</span> <span data-start="678.49" data-end="681.05">so all your developer can focus on</span> <span data-start="681.05" data-end="682.94">implementing business logic without</span> <span data-start="682.94" data-end="687.08">worry about silverside concern now let's</span> <span data-start="687.08" data-end="690.14">see how we view this nodejs platform we</span> <span data-start="690.14" data-end="692.03">use verse 5 framework to build our own</span> </p>
<p><span data-start="692.03" data-end="695.09">OTA server response already building</span> <span data-start="695.09" data-end="698.12">with operational matrix so it has good</span> <span data-start="698.12" data-end="701.15">debug ability we have been used</span> <span data-start="701.15" data-end="703.63">ratifying our website for a couple years</span> <span data-start="703.63" data-end="708.13">so it's well tested in production and</span> <span data-start="708.13" data-end="711.26">also it's one of the fastest no Jerry</span> <span data-start="711.26" data-end="716.81">server it's lightweight its specific</span> <span data-start="716.81" data-end="719.39">phobia dressed API service so we only</span> <span data-start="719.39" data-end="723.62">need a minimum set of dependency now</span> <span data-start="723.62" data-end="725.45">let's see how will allow you our</span> <span data-start="725.45" data-end="728.54">developer to create server out we use</span> <span data-start="728.54" data-end="730.82">red fire in raw module to let our</span> <span data-start="730.82" data-end="732.49">developer to create some around</span> <span data-start="732.49" data-end="736.64">declaratively in JSON format this way</span> <span data-start="736.64" data-end="738.53">our UI developer doesn't have to know</span> <span data-start="738.53" data-end="741.08">response pacifica a p.i and you make</span> <span data-start="741.08" data-end="744.71">rotation easy and also this role</span> <span data-start="744.71" data-end="746.57">configuration file become a single place</span> <span data-start="746.57" data-end="749.21">where we can find out what kind of API</span> <span data-start="749.21" data-end="752.39">is inside our no GL server it can</span> <span data-start="752.39" data-end="757.1">prevent real collision this is an</span> <span data-start="757.1" data-end="760.67">example of the role configuration you</span> <span data-start="760.67" data-end="763.82">can see search is the route past get is</span> <span data-start="763.82" data-end="766.49">the raw method the value of source is</span> <span data-start="766.49" data-end="770.24">the entry point square now what is the</span> <span data-start="770.24" data-end="773.54">entry point square by yourself this is a</span> <span data-start="773.54" data-end="776.48">pseudocode for our search service we</span> <span data-start="776.48" data-end="778.31">will write business logic to fetch</span> <span data-start="778.31" data-end="781.27">search data and transform the data to</span> <span data-start="781.27" data-end="784.1">individual device format in this</span> <span data-start="784.1" data-end="786.95">middleware function now what's important</span> <span data-start="786.95" data-end="789.35">here is we will export this middleware</span> <span data-start="789.35" data-end="791.12">function here in the entry point scrip</span> <span data-start="791.12" data-end="793.88">this is the contract between the usual</span> <span data-start="793.88" data-end="798.23">encode and plop the platform now I just</span> <span data-start="798.23" data-end="799.91">mentioned something called connect style</span> <span data-start="799.91" data-end="803.09">middleware function what is that in no</span> <span data-start="803.09" data-end="805.76">geoserver we use a middleware function</span> <span data-start="805.76" data-end="808.34">or an array of middleware function to</span> <span data-start="808.34" data-end="810.68">handle a request</span> <span data-start="810.68" data-end="813.05">the middle function will take input of</span> <span data-start="813.05" data-end="815.33">request response after and next call</span> <span data-start="815.33" data-end="818.24">back in the end of the function we will</span> <span data-start="818.24" data-end="820.43">invoke the next call back to change to</span> <span data-start="820.43" data-end="823.97">the next request handler now in most of</span> <span data-start="823.97" data-end="825.589">the case we will have very complicated</span> <span data-start="825.589" data-end="827.72">business logic so we will export an</span> <span data-start="827.72" data-end="829.52">array of middleware function in the</span> <span data-start="829.52" data-end="832.37">entry points clip the platform going to</span> <span data-start="832.37" data-end="834.11">take this middle functional ray a</span> <span data-start="834.11" data-end="837.649">injecting to ratify server by doing so</span> <span data-start="837.649" data-end="839.81">our UI developer can focus on</span> <span data-start="839.81" data-end="841.459">implementing business logic and the</span> <span data-start="841.459" data-end="843.41">platform will take care of server-side</span> <span data-start="843.41" data-end="848.779">bootstrap code now how does our platform</span> <span data-start="848.779" data-end="853.1">publish matrix we use verse by audio</span> <span data-start="853.1" data-end="855.14">longer plugging to publish matrix into</span> <span data-start="855.14" data-end="858.86">server log this whole bunch of texts are</span> <span data-start="858.86" data-end="861.29">requests log so what's important here is</span> <span data-start="861.29" data-end="863.39">you can see in a bottom of the screen</span> <span data-start="863.39" data-end="865.79">that read texts a unique request ID and</span> <span data-start="865.79" data-end="868.55">we also publish request header so these</span> <span data-start="868.55" data-end="871.339">are information we can use for debug and</span> <span data-start="871.339" data-end="874.16">most importantly will measure request</span> <span data-start="874.16" data-end="876.44">latency for each middleware handler now</span> <span data-start="876.44" data-end="879.08">we can easily find out where our server</span> <span data-start="879.08" data-end="882.23">is spending time at this actually is a</span> <span data-start="882.23" data-end="883.7">production of class has performance</span> <span data-start="883.7" data-end="886.97">issue I can easily find out the rest I</span> <span data-start="886.97" data-end="888.65">walk around handle is the one take the</span> <span data-start="888.65" data-end="891.41">longest time so I can be very targeted</span> <span data-start="891.41" data-end="895.97">to keep up my performance issue here we</span> <span data-start="895.97" data-end="900.26">also want our server to be resilient so</span> <span data-start="900.26" data-end="901.94">the platform will handle common system</span> <span data-start="901.94" data-end="905.36">level error for example if our upstream</span> <span data-start="905.36" data-end="907.79">server is doing a deployment we might</span> <span data-start="907.79" data-end="911.9">get a network error so the platform will</span> <span data-start="911.9" data-end="913.279">retry our network error using</span> <span data-start="913.279" data-end="917">exponential back-off algorithm we also</span> <span data-start="917" data-end="920.3">use res file requests expiry plugging to</span> <span data-start="920.3" data-end="922.4">time our requests when the clients no</span> <span data-start="922.4" data-end="925.7">longer interesting while request expiry</span> <span data-start="925.7" data-end="928.85">is important it can improve the server</span> <span data-start="928.85" data-end="934.31">performance now in some case our service</span> <span data-start="934.31" data-end="936.62">can get d dust the event queue will be</span> <span data-start="936.62" data-end="938.51">filled in with a lot of requests that</span> <span data-start="938.51" data-end="941.029">nobody is carrying about so using the</span> <span data-start="941.029" data-end="942.709">request expiry flogging we can quickly</span> <span data-start="942.709" data-end="944.12">discard those</span> <span data-start="944.12" data-end="946.339">active event and starting to serve</span> <span data-start="946.339" data-end="949.88">active request a young another scenario</span> </p>
<p><span data-start="949.88" data-end="953.06">I'll upstream server can have long</span> <span data-start="953.06" data-end="955.55">latency when a data come back to our</span> <span data-start="955.55" data-end="957.71">note a server the client has already</span> <span data-start="957.71" data-end="960.08">turned out so we don't want to waste</span> <span data-start="960.08" data-end="963.11">extra CPU cycle to parse and render the</span> <span data-start="963.11" data-end="966.23">data and send it back to the client so</span> <span data-start="966.23" data-end="968.39">the platform works also kill the middle</span> <span data-start="968.39" data-end="973.7">we're here now we can easily stand up</span> <span data-start="973.7" data-end="976.88">the data API service using on top of the</span> <span data-start="976.88" data-end="980.81">node.js platform the next step is we</span> <span data-start="980.81" data-end="982.79">want to be the tooling to make it easy</span> <span data-start="982.79" data-end="984.65">for our UI developer to set their</span> <span data-start="984.65" data-end="986.51">environment I have a consistent</span> <span data-start="986.51" data-end="991.52">development workflow we have introduced</span> <span data-start="991.52" data-end="993.98">darker into this workflow it's a new</span> <span data-start="993.98" data-end="996.29">technology that can add learning curve</span> <span data-start="996.29" data-end="999.589">and most of our developer are used mac</span> <span data-start="999.589" data-end="1002.589">or windows as their development Shing so</span> <span data-start="1002.589" data-end="1005.02">they need the VirtualBox to run local</span> <span data-start="1005.02" data-end="1008.23">docker container that can add network</span> <span data-start="1008.23" data-end="1011.5">complexity so if all this our developer</span> <span data-start="1011.5" data-end="1013.45">wants to manually install into their</span> <span data-start="1013.45" data-end="1016.27">local dev box that can take a day or two</span> <span data-start="1016.27" data-end="1020.2">this is a too painful that's why we</span> <span data-start="1020.2" data-end="1022.24">decided to build tooling to streamline</span> <span data-start="1022.24" data-end="1025.089">our developers workflow the tooling will</span> <span data-start="1025.089" data-end="1027.699">encapsulate darker complexity and make</span> <span data-start="1027.699" data-end="1030.76">it easy to install build deploy a docker</span> <span data-start="1030.76" data-end="1034.26">container now this is a common workflow</span> <span data-start="1034.26" data-end="1037.179">for mac OS users starting to work with</span> <span data-start="1037.179" data-end="1039.819">our newest aqua container platform we</span> <span data-start="1039.819" data-end="1043.51">only need is full step first is set up</span> <span data-start="1043.51" data-end="1046.24">it's obvious we install the darker</span> </p>
<p><span data-start="1046.24" data-end="1049.45">VirtualBox node npn another related</span> <span data-start="1049.45" data-end="1053.5">software into developing local box he</span> <span data-start="1053.5" data-end="1056.11">will set up the darker server to work</span> <span data-start="1056.11" data-end="1060.4">with internal dhaka registry next up we</span> <span data-start="1060.4" data-end="1063.07">will generate a simple call repo using</span> <span data-start="1063.07" data-end="1066.19">human generator now even you develop on</span> <span data-start="1066.19" data-end="1068.38">board they can quickly start off with</span> <span data-start="1068.38" data-end="1071.05">their endpoint script just by changing a</span> <span data-start="1071.05" data-end="1074.38">working sample and a lot of time after</span> <span data-start="1074.38" data-end="1076.929">we build our code it might take a long</span> <span data-start="1076.929" data-end="1077.77">time for us</span> <span data-start="1077.77" data-end="1080.62">the cic d pipeline to push the code to</span> <span data-start="1080.62" data-end="1082.78">test our products are men so in this</span> <span data-start="1082.78" data-end="1085.21">initialization step our tooling will</span> <span data-start="1085.21" data-end="1088.27">create a cic d pipeline for our</span> <span data-start="1088.27" data-end="1092.29">developer now well we're ready to test</span> <span data-start="1092.29" data-end="1095.74">we can build a local image the tooling</span> <span data-start="1095.74" data-end="1098.2">will handle nesting of darker image you</span> <span data-start="1098.2" data-end="1100.42">will pull the node.js platform image</span> <span data-start="1100.42" data-end="1102.97">from internal dhaka registry and build a</span> <span data-start="1102.97" data-end="1107.08">data API server image on top of it the</span> <span data-start="1107.08" data-end="1109.39">final step is to employ a continued</span> <span data-start="1109.39" data-end="1112.75">locally a tooling will start an ode to</span> <span data-start="1112.75" data-end="1114.58">node.js server running inside the docker</span> <span data-start="1114.58" data-end="1117.46">container and create by man between the</span> <span data-start="1117.46" data-end="1120.36">host a pre-poll into the darker Cantina</span> <span data-start="1120.36" data-end="1123.57">now I just said something about by month</span> <span data-start="1123.57" data-end="1127.09">what is it it's a filesystem mounting</span> <span data-start="1127.09" data-end="1129.64">between hosts file system and the log</span> <span data-start="1129.64" data-end="1133.68">taco container why do we need it</span> <span data-start="1133.68" data-end="1136.57">remember our developer wants to have</span> <span data-start="1136.57" data-end="1138.85">fast code iteration they want to have</span> <span data-start="1138.85" data-end="1140.68">their code reflecting side the server</span> <span data-start="1140.68" data-end="1143.92">instantaneously however a docker image</span> <span data-start="1143.92" data-end="1147.13">is immutable we don't want to review a</span> <span data-start="1147.13" data-end="1148.9">new image every time when people change</span> <span data-start="1148.9" data-end="1153.48">code so using this by mom we can achieve</span> <span data-start="1153.48" data-end="1157.84">the code change instantaneously the</span> <span data-start="1157.84" data-end="1160.62">tooling will watch the file system and</span> <span data-start="1160.62" data-end="1163.21">the change can be reflecting side the</span> <span data-start="1163.21" data-end="1164.83">docker container and server is restarted</span> <span data-start="1164.83" data-end="1168.31">now a change can be reflect in a couple</span> <span data-start="1168.31" data-end="1170.17">second in compared to previously a</span> <span data-start="1170.17" data-end="1174.49">couple minutes and remember we need to</span> <span data-start="1174.49" data-end="1176.74">support hundreds of different device a</span> </p>
<p><span data-start="1176.74" data-end="1179.47">UI developer needs to test from</span> <span data-start="1179.47" data-end="1182.91">different device to their local data API</span> <span data-start="1182.91" data-end="1185.26">so it's complicated to set up the</span> <span data-start="1185.26" data-end="1187.24">network for their local development</span> <span data-start="1187.24" data-end="1190.69">lemon and the tooling take care of that</span> <span data-start="1190.69" data-end="1193.45">it will make our local data API server</span> <span data-start="1193.45" data-end="1195.7">discoverable by a common routing gateway</span> <span data-start="1195.7" data-end="1199.69">now our developer can test their local</span> <span data-start="1199.69" data-end="1201.58">data API from any device with an</span> <span data-start="1201.58" data-end="1205.96">internet</span> <span data-start="1205.97" data-end="1208.13">now how do we get a better debugging</span> <span data-start="1208.13" data-end="1210.86">method now since we have a local server</span> <span data-start="1210.86" data-end="1212.93">running the tooling world set up port</span> <span data-start="1212.93" data-end="1215.27">forwarding on VirtualBox a gyro the</span> <span data-start="1215.27" data-end="1218.42">remote debugging now developer can</span> <span data-start="1218.42" data-end="1219.95">choose their favorite debugger to</span> <span data-start="1219.95" data-end="1222.74">install no inspector and use our</span> <span data-start="1222.74" data-end="1225.59">favorite chrome dev tool to debug server</span> <span data-start="1225.59" data-end="1228.44">side issue as well our developer no</span> <span data-start="1228.44" data-end="1230.09">longer needs to write console the log</span> <span data-start="1230.09" data-end="1232.04">over the place inside their code and</span> <span data-start="1232.04" data-end="1238.07">stirring a testing server now we have a</span> <span data-start="1238.07" data-end="1239.84">very efficient developer workflow now</span> <span data-start="1239.84" data-end="1243.13">how do we solve our production problem</span> <span data-start="1243.13" data-end="1246.41">remember we have we need to achieve</span> <span data-start="1246.41" data-end="1248.99">long-term isolation and skill different</span> <span data-start="1248.99" data-end="1253.35">kind of data API service independently</span> <span data-start="1253.36" data-end="1256.58">in the old architecture or our you are</span> <span data-start="1256.58" data-end="1258.65">data API service is running inside the</span> <span data-start="1258.65" data-end="1262.16">same java more no less we want to</span> <span data-start="1262.16" data-end="1264.52">decouple them out from the Java server</span> <span data-start="1264.52" data-end="1268.7">each logical set of data endpoint script</span> <span data-start="1268.7" data-end="1271.9">is running inside at all no Jade server</span> <span data-start="1271.9" data-end="1274.52">by doing so we can scale them</span> <span data-start="1274.52" data-end="1277.13">independently and monitor their</span> <span data-start="1277.13" data-end="1280.09">operational matrix separately and also</span> <span data-start="1280.09" data-end="1282.17">because the Iranians are different</span> <span data-start="1282.17" data-end="1284.57">node.js server a bug inside one set of</span> <span data-start="1284.57" data-end="1286.61">data API service wouldn't affect the</span> <span data-start="1286.61" data-end="1290.21">other when a client make a request to</span> <span data-start="1290.21" data-end="1292.76">the no geoserver the node.js server will</span> <span data-start="1292.76" data-end="1294.71">make another request to a remote service</span> <span data-start="1294.71" data-end="1296.93">layer which has all the internal prodded</span> <span data-start="1296.93" data-end="1303.08">atta exposed there this June we have</span> <span data-start="1303.08" data-end="1305.12">viewed a search service using this new</span> <span data-start="1305.12" data-end="1307.25">architecture and integrating to our</span> <span data-start="1307.25" data-end="1310.28">website we are ready to test it in</span> <span data-start="1310.28" data-end="1313.67">production when the production coming to</span> <span data-start="1313.67" data-end="1316.1">mind our developers immediate reaction</span> <span data-start="1316.1" data-end="1319.97">is what happen if I'm on call how do I</span> <span data-start="1319.97" data-end="1323.65">debug a production issue that's critical</span> <span data-start="1323.65" data-end="1326.66">we don't want our UI developer to worry</span> <span data-start="1326.66" data-end="1330.02">about production matrix the platform has</span> <span data-start="1330.02" data-end="1333.04">already build original matrix in mind</span> <span data-start="1333.04" data-end="1335.84">the notary server has integral with</span> </p>
<p><span data-start="1335.84" data-end="1338.53">Netflix or personal dashboard atlas</span> <span data-start="1338.53" data-end="1340.9">ulta lewis is a tool will aggregate</span> <span data-start="1340.9" data-end="1342.51">different kind of operational metrics</span> <span data-start="1342.51" data-end="1346.45">into you I dashboard and it's also an</span> <span data-start="1346.45" data-end="1349.54">open source now when I know dear server</span> <span data-start="1349.54" data-end="1351.94">make requests will publish variety</span> <span data-start="1351.94" data-end="1355.75">matrix into outlets for example will</span> <span data-start="1355.75" data-end="1358.66">publish request-response count so we</span> <span data-start="1358.66" data-end="1361.03">will know the historical obvious of our</span> <span data-start="1361.03" data-end="1363.58">server we can make inform the decision</span> <span data-start="1363.58" data-end="1366.01">if we want to scale our server up or</span> <span data-start="1366.01" data-end="1370.09">down we also aggregate the request</span> <span data-start="1370.09" data-end="1372.82">latency and request q-dubs so we know</span> <span data-start="1372.82" data-end="1376.48">our server performance and we measure</span> <span data-start="1376.48" data-end="1379.45">server figlio count and time i'll count</span> <span data-start="1379.45" data-end="1381.55">and we can set threshold on the error</span> <span data-start="1381.55" data-end="1386.1">rate so we can alert our developer and</span> <span data-start="1386.1" data-end="1389.86">we have silver restyle count if our</span> <span data-start="1389.86" data-end="1392.44">server continuously restarting that's an</span> <span data-start="1392.44" data-end="1394.36">indication of severe problem inside the</span> <span data-start="1394.36" data-end="1399.37">data endpoints cliff we also publish a</span> <span data-start="1399.37" data-end="1401.8">flawed system level metrics for example</span> <span data-start="1401.8" data-end="1405.4">cpu or heap use it so we can be alerted</span> <span data-start="1405.4" data-end="1407.59">if there's performance or memory leak</span> <span data-start="1407.59" data-end="1412.69">going on in production in some time imma</span> <span data-start="1412.69" data-end="1415.29">get a 500 error for a particular request</span> <span data-start="1415.29" data-end="1419.74">so I want to see the error log I however</span> <span data-start="1419.74" data-end="1422.05">we don't want our I developer to take</span> <span data-start="1422.05" data-end="1423.55">the trouble to log into production</span> <span data-start="1423.55" data-end="1427.3">server until the server log and also we</span> <span data-start="1427.3" data-end="1428.74">have hundreds of different colored</span> <span data-start="1428.74" data-end="1431.62">server we wouldn't know which requests</span> <span data-start="1431.62" data-end="1434.26">were coming to which server so we view</span> <span data-start="1434.26" data-end="1437.2">the tooling to aggregate a server into</span> <span data-start="1437.2" data-end="1440.47">ink we allocate the server log into a UI</span> <span data-start="1440.47" data-end="1444.25">tool now our UI developer can call it a</span> <span data-start="1444.25" data-end="1449.51">server log through this UI to real time</span> <span data-start="1449.52" data-end="1451.66">at this point we have good visibility</span> <span data-start="1451.66" data-end="1455.02">into a node.js server is that enough to</span> <span data-start="1455.02" data-end="1458.95">debug a production issue actually it's</span> <span data-start="1458.95" data-end="1462.97">not we have a distributed system the</span> <span data-start="1462.97" data-end="1464.98">first step to this debug a production</span> <span data-start="1464.98" data-end="1468.1">issue is identify which stuck in the</span> <span data-start="1468.1" data-end="1471.2">requests segment has problem we</span> <span data-start="1471.2" data-end="1473.659">has come in you will come to a routing</span> <span data-start="1473.659" data-end="1476.24">gateway the Gateway wore out the request</span> <span data-start="1476.24" data-end="1479.269">to our no Jo server then no geoserver</span> <span data-start="1479.269" data-end="1481.6">make requests to a remote service layer</span> <span data-start="1481.6" data-end="1484.779">finally we fetch the internal holiday de</span> <span data-start="1484.779" data-end="1487.309">wouldn't be great if we have operational</span> <span data-start="1487.309" data-end="1489.38">metrics for each individual request</span> <span data-start="1489.38" data-end="1493.25">segment so we build distributed request</span> <span data-start="1493.25" data-end="1495.919">treating tool to measure request latency</span> <span data-start="1495.919" data-end="1498.5">and status for each individual local</span> <span data-start="1498.5" data-end="1502.179">segment now we have good visibility into</span> <span data-start="1502.179" data-end="1508.82">entire Netflix API ecosystem at this</span> <span data-start="1508.82" data-end="1511.279">point we have all the tooling available</span> <span data-start="1511.279" data-end="1514.01">for us to debug now we are ready to test</span> <span data-start="1514.01" data-end="1517.13">in production with full scale however</span> <span data-start="1517.13" data-end="1519.789">any new architecture could cause</span> <span data-start="1519.789" data-end="1523.22">unexpected issue we have over 80 million</span> <span data-start="1523.22" data-end="1525.74">subscribers we don't want to test a new</span> <span data-start="1525.74" data-end="1529.059">architecture while in impacting our</span> <span data-start="1529.059" data-end="1532.429">subscribers to experience so we decide</span> <span data-start="1532.429" data-end="1535.7">to run shallow traffic what is the</span> <span data-start="1535.7" data-end="1538.309">shuttle traffic here when a device make</span> <span data-start="1538.309" data-end="1541.039">a request to our routing gateway it will</span> <span data-start="1541.039" data-end="1543.32">duplicate the request when go to the</span> <span data-start="1543.32" data-end="1546.769">mono list data API server the other go</span> <span data-start="1546.769" data-end="1548.87">to the new notice taco container</span> <span data-start="1548.87" data-end="1552.139">platform now only the monolithic data</span> </p>
<p><span data-start="1552.139" data-end="1554.6">API server will return the data back to</span> <span data-start="1554.6" data-end="1557.21">our client the note G of stalker</span> <span data-start="1557.21" data-end="1559.19">container platform will only return the</span> <span data-start="1559.19" data-end="1561.559">data back to the routing gateway and the</span> <span data-start="1561.559" data-end="1564.47">data is dropped there this way we can</span> <span data-start="1564.47" data-end="1567.529">test our new architecture without impact</span> <span data-start="1567.529" data-end="1572.269">customers experience at this point we</span> <span data-start="1572.269" data-end="1574.25">have slayed our data API more or less</span> <span data-start="1574.25" data-end="1576.38">and make it each data API service</span> <span data-start="1576.38" data-end="1578.48">running inside it's all know Tiesto</span> </p>
<p><span data-start="1578.48" data-end="1581.899">Cantina in production we have achieved</span> <span data-start="1581.899" data-end="1584.99">long time isolation we can scale a</span> <span data-start="1584.99" data-end="1586.49">different calendar if you have service</span> <span data-start="1586.49" data-end="1588.74">in apparently we have reached</span> <span data-start="1588.74" data-end="1591.049">operational insight into our notice</span> <span data-start="1591.049" data-end="1595.01">server during development we have much</span> <span data-start="1595.01" data-end="1598.429">efficient developer workflow we can</span> <span data-start="1598.429" data-end="1600.679">reproduce a production problem in</span> <span data-start="1600.679" data-end="1602.809">developers local machine precisely to</span> <span data-start="1602.809" data-end="1604.79">debug issue</span> <span data-start="1604.79" data-end="1607.34">this architecture improvement has made</span> <span data-start="1607.34" data-end="1609.34">big impact to our business and</span> <span data-start="1609.34" data-end="1614.72">developers workflow thank you for coming</span> <span data-start="1614.72" data-end="1616.79">to my talk if you are interested in</span> <span data-start="1616.79" data-end="1618.74">working in node.js or darker Cantina</span> <span data-start="1618.74" data-end="1621.08">feel free to reach out to me after the</span> <span data-start="1621.08" data-end="1624.44">talk and our company is hiring if you</span> <span data-start="1624.44" data-end="1626.84">are interested please what look for our</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
