<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mth0XRQ93rM</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/Mth0XRQ93rM?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0" data-end="2.19">if everyone can hear me and if not use</span> <span data-start="2.19" data-end="5.759">your imagination so yeah my name is dave</span> <span data-start="5.759" data-end="9.269">stevens i am here from zappos hence the</span> <span data-start="9.269" data-end="12.99">oversized logo behind me there and I</span> <span data-start="12.99" data-end="15.33">just wanted to talk to you about using</span> <span data-start="15.33" data-end="19.64">happy plugins to version your API and</span> <span data-start="19.64" data-end="21.779">try not have this fall off my ear while</span> <span data-start="21.779" data-end="25.08">I do so quick thing on me because I'm</span> <span data-start="25.08" data-end="28.189">not famous as you may have noticed</span> <span data-start="28.189" data-end="31.47">started using node back in 2010 going to</span> <span data-start="31.47" data-end="32.7">hold this down here because ice flying</span> <span data-start="32.7" data-end="40.469">all around me ok cool and first use</span> <span data-start="40.469" data-end="42.42">happy at the end of last year on a</span> <span data-start="42.42" data-end="44.6">personal recommendation of a friend and</span> <span data-start="44.6" data-end="46.95">we actually managed to get something</span> <span data-start="46.95" data-end="49.71">into customer-facing production at the</span> <span data-start="49.71" data-end="51.57">end of last year and then a/b test for</span> <span data-start="51.57" data-end="54.03">6pm calm the mobile views which is our</span> <span data-start="54.03" data-end="56.61">sister site and we have happy eight in</span> <span data-start="56.61" data-end="59.64">production today on internal analytics</span> </p>
<p><span data-start="59.64" data-end="62.73">API not quite Black Friday at Walmart</span> <span data-start="62.73" data-end="66.45">foot we're doing our best so quick</span> <span data-start="66.45" data-end="67.83">project setup for what I'm going to go</span> <span data-start="67.83" data-end="70.86">through I'll keep this brief I wrote up</span> <span data-start="70.86" data-end="72.75">a big long post about how I like to</span> <span data-start="72.75" data-end="76.47">organize happy plugins that bit ly URL</span> <span data-start="76.47" data-end="78.36">will take you there if you would like to</span> <span data-start="78.36" data-end="80.54">know why I've structured it in this way</span> <span data-start="80.54" data-end="84.42">but we've got this one controller which</span> <span data-start="84.42" data-end="85.53">is going to give us information about</span> <span data-start="85.53" data-end="89.97">our API the info controller and our main</span> <span data-start="89.97" data-end="92.759">application just uses glue because i</span> <span data-start="92.759" data-end="96.509">like the compose functionality that got</span> <span data-start="96.509" data-end="100.86">removed in version 8 to set up a server</span> <span data-start="100.86" data-end="103.549">and run out and 49 thousands pulling in</span> <span data-start="103.549" data-end="110.82">the info module is a plug-in that plugin</span> <span data-start="110.82" data-end="113.7">looks like this very simple it captures</span> <span data-start="113.7" data-end="118.469">the root of / version and has a handler</span> <span data-start="118.469" data-end="121.92">there which we'll look at next and it</span> <span data-start="121.92" data-end="124.439">just replies back with the name of the</span> </p>
<p><span data-start="124.439" data-end="127.77">API the example API and a version number</span> <span data-start="127.77" data-end="130.95">which is one in this instance okay so</span> <span data-start="130.95" data-end="133.19">once that's running</span> <span data-start="133.19" data-end="137.51">this co request will return back this</span> <span data-start="137.51" data-end="140.33">JSON response which is very exciting I</span> <span data-start="140.33" data-end="142.25">know you're all dying for me to push</span> <span data-start="142.25" data-end="144.44">this live but unfortunately it's just an</span> <span data-start="144.44" data-end="147.86">example but now we've got to the point</span> <span data-start="147.86" data-end="149.84">where everyone was so excited by it we</span> <span data-start="149.84" data-end="151.76">want to go on to version 2 and improve</span> <span data-start="151.76" data-end="153.08">it because it you know didn't do too</span> <span data-start="153.08" data-end="154.94">much and we're going to introduce some</span> <span data-start="154.94" data-end="156.86">breaking changes but we're going to be</span> <span data-start="156.86" data-end="158.87">good net citizens we're not going to</span> <span data-start="158.87" data-end="161.51">break the previous calls for anyone that</span> <span data-start="161.51" data-end="163.78">is relying on it and we're going to</span> <span data-start="163.78" data-end="168.47">version our API so before in the modules</span> <span data-start="168.47" data-end="171.8">section we just had an index j s and</span> <span data-start="171.8" data-end="173.6">then this version handler which itself</span> <span data-start="173.6" data-end="178.55">at an index j s we're now going to break</span> <span data-start="178.55" data-end="180.47">this down into version 1 and version 2</span> <span data-start="180.47" data-end="185.24">of our api first thing we're going to do</span> <span data-start="185.24" data-end="186.44">we're going to take the current version</span> <span data-start="186.44" data-end="188.36">handler and we're going to move that to</span> <span data-start="188.36" data-end="191.14">version 1 the idea here being that</span> <span data-start="191.14" data-end="193.7">version 1 is the one that was already</span> <span data-start="193.7" data-end="196.28">there so this will then become your</span> <span data-start="196.28" data-end="198.14">default as well so anyone that doesn't</span> <span data-start="198.14" data-end="201.47">update their code will later receive</span> <span data-start="201.47" data-end="205.04">this and achieving that just by moving</span> <span data-start="205.04" data-end="208.489">it into that folder version 2 gets</span> <span data-start="208.489" data-end="211.7">really fancy almost as big of a</span> <span data-start="211.7" data-end="214.91">announcement is happy version 8 today is</span> <span data-start="214.91" data-end="217.459">that we now give you a status code and</span> <span data-start="217.459" data-end="219.83">we we have our breaking change instead</span> <span data-start="219.83" data-end="221.92">of the name in the version being</span> <span data-start="221.92" data-end="225.11">directly ahead in in the response object</span> <span data-start="225.11" data-end="227.44">we now have this application detail</span> <span data-start="227.44" data-end="231.8">object so then when we move over to our</span> <span data-start="231.8" data-end="234.95">version handler this is where we're</span> <span data-start="234.95" data-end="238.01">going to start looking at the versioning</span> <span data-start="238.01" data-end="242.239">okay so what we first of all do is we</span> <span data-start="242.239" data-end="245.9">check to see whether an api version</span> <span data-start="245.9" data-end="248.18">parameter has been certain in the route</span> <span data-start="248.18" data-end="251.42">and we do a quick test to make sure that</span> <span data-start="251.42" data-end="254.59">it just matches the v and then a number</span> <span data-start="254.59" data-end="257.359">format with a regular expression just</span> <span data-start="257.359" data-end="259.13">for security purposes never trust</span> <span data-start="259.13" data-end="262.43">anything the user puts in and then we</span> <span data-start="262.43" data-end="264.21">require</span> <span data-start="264.21" data-end="268.38">the local folder that matches that</span> <span data-start="268.38" data-end="272.039">version number here and we passed</span> <span data-start="272.039" data-end="275.61">through the request and the reply below</span> <span data-start="275.61" data-end="277.62">that we have our default full back as I</span> <span data-start="277.62" data-end="280.68">mentioned before which says if no</span> <span data-start="280.68" data-end="283.53">version is specified give them version 1</span> <span data-start="283.53" data-end="286.009">because that's what they'll be expecting</span> <span data-start="286.009" data-end="291">the info plugin we now have a slight</span> <span data-start="291" data-end="292.44">change we've added in another route</span> <span data-start="292.44" data-end="296.509">which has the API version specified and</span> <span data-start="296.509" data-end="298.889">that's the only change that we do there</span> <span data-start="298.889" data-end="301.05">we leave versions still pointing to this</span> <span data-start="301.05" data-end="306.27">dispersion handler that we just saw so</span> <span data-start="306.27" data-end="311.759">once we have this set up like so testing</span> <span data-start="311.759" data-end="316.59">on this URL parameter if we curl as we</span> <span data-start="316.59" data-end="318.21">did before we get the same response so</span> <span data-start="318.21" data-end="319.65">we're not breaking anything for anybody</span> <span data-start="319.65" data-end="324.539">else but if we put in v1 as our API</span> <span data-start="324.539" data-end="327.3">version parameter again we get the same</span> <span data-start="327.3" data-end="329.159">response because the default is version</span> <span data-start="329.159" data-end="331.62">1 but then we change it to version two</span> <span data-start="331.62" data-end="334.5">and now our responses from the the other</span> <span data-start="334.5" data-end="338.25">handler when I was looking in subversion</span> <span data-start="338.25" data-end="340.409">a pis there's a really good article by</span> </p>
<p><span data-start="340.409" data-end="344.55">Troy hunt feel familiar with them on the</span> <span data-start="344.55" data-end="346.65">three wrong ways because no matter which</span> <span data-start="346.65" data-end="348.3">one you choose and you say i'm going to</span> <span data-start="348.3" data-end="350.219">version my api this way somebody has a</span> <span data-start="350.219" data-end="353.849">complaint about it so if you've done a</span> <span data-start="353.849" data-end="355.32">bit ly URL so you can look up that</span> <span data-start="355.32" data-end="357.15">article if you're interested he</span> <span data-start="357.15" data-end="358.8">describes the the three different ways</span> <span data-start="358.8" data-end="361.32">that he likes to version api's the first</span> <span data-start="361.32" data-end="363.36">we've already covered but then they</span> <span data-start="363.36" data-end="364.77">should actually say custom request</span> <span data-start="364.77" data-end="367.38">header but everything's about customer</span> <span data-start="367.38" data-end="369.63">where I work so apparently i just typed</span> <span data-start="369.63" data-end="373.469">customer when i was making this so we're</span> <span data-start="373.469" data-end="375.84">going to add in the ability to handle a</span> <span data-start="375.84" data-end="378">custom request header that we've</span> <span data-start="378" data-end="381.199">specified API dash version as a way to</span> <span data-start="381.199" data-end="384.419">specify which versions the API we want</span> <span data-start="384.419" data-end="387.539">the requests come to be handled with and</span> <span data-start="387.539" data-end="390.18">that gets at this happens here and the</span> <span data-start="390.18" data-end="392.37">second piece where again we test to make</span> <span data-start="392.37" data-end="394.62">sure that it's nothing malicious coming</span> <span data-start="394.62" data-end="396.449">in and then again we</span> </p>
<p><span data-start="396.449" data-end="401.099">I require from the folder that matches</span> <span data-start="401.099" data-end="405.36">the version that's passed in so here we</span> <span data-start="405.36" data-end="407.969">are a curl to test it because doing</span> <span data-start="407.969" data-end="409.379">things old-school is the way I like to</span> <span data-start="409.379" data-end="413.43">do everything and we get that that</span> <span data-start="413.43" data-end="416.009">version one back if we pass in version 2</span> <span data-start="416.009" data-end="418.969">than the responses from the second</span> <span data-start="418.969" data-end="421.699">iteration that we came up with for a</span> <span data-start="421.699" data-end="425.039">fancy handler but you'll notice that the</span> <span data-start="425.039" data-end="430.339">URL in both of those stays the same then</span> <span data-start="430.339" data-end="434.36">the third method he suggests is the</span> <span data-start="434.36" data-end="437.279">specifying accept error with the</span> <span data-start="437.279" data-end="440.27">application and then the vendor in there</span> <span data-start="440.27" data-end="444.18">which we can again test on in a similar</span> <span data-start="444.18" data-end="447.539">manner and then require based on the</span> <span data-start="447.539" data-end="451.379">value that gets passed in so again this</span> <span data-start="451.379" data-end="453.27">is what it may look like for the example</span> </p>
<p><span data-start="453.27" data-end="456.12">API company name I don't have a start-up</span> <span data-start="456.12" data-end="457.559">you might have noticed I'm other than</span> <span data-start="457.559" data-end="462.419">naming things this is an example of that</span> <span data-start="462.419" data-end="464.36">as much as it is an example of the API</span> <span data-start="464.36" data-end="468.18">so you pass in v1 and you get the first</span> <span data-start="468.18" data-end="471.21">response and you pass in v2 and you get</span> <span data-start="471.21" data-end="476.069">the second response if you can imagine</span> <span data-start="476.069" data-end="479.819">here we've got this set up that I showed</span> <span data-start="479.819" data-end="482.49">earlier where we just have these folders</span> <span data-start="482.49" data-end="484.68">based in different places this is a very</span> <span data-start="484.68" data-end="486.449">small application so that works out</span> <span data-start="486.449" data-end="488.699">quite well if you can imagine in a</span> <span data-start="488.699" data-end="490.649">larger application or in a large company</span> <span data-start="490.649" data-end="491.759">where you have different teams doing</span> <span data-start="491.759" data-end="494.039">different things each folder could</span> <span data-start="494.039" data-end="497.49">actually be its own mpm module on a</span> <span data-start="497.49" data-end="500.37">private repo or even the public one if</span> <span data-start="500.37" data-end="503.31">that works for you devil-may-care and</span> <span data-start="503.31" data-end="505.469">all that which could then have its own</span> <span data-start="505.469" data-end="507.659">repository so everyone could work</span> <span data-start="507.659" data-end="509.479">independently and then you can just say</span> <span data-start="509.479" data-end="512.01">okay in this folder I want to pull in</span> <span data-start="512.01" data-end="516.539">this version of that controller in this</span> <span data-start="516.539" data-end="520.199">folder I want to pull in the next so</span> <span data-start="520.199" data-end="521.909">finally go we'll be back through to the</span> <span data-start="521.909" data-end="525.06">ends these are the various ways you can</span> <span data-start="525.06" data-end="526.67">contact me if you</span> <span data-start="526.67" data-end="530.69">are so inclined trying to put out as</span> <span data-start="530.69" data-end="534.77">much as we've learned unhappy on medium</span> <span data-start="534.77" data-end="536.42">at the moment so if you follow twitter</span> <span data-start="536.42" data-end="539.06">you'll see those and then also at the</span> <span data-start="539.06" data-end="541.55">bottom there is a repository with the</span> <span data-start="541.55" data-end="543.2">example application for you to try out</span> <span data-start="543.2" data-end="544.73">for yourself if you want to play around</span> <span data-start="544.73" data-end="547.34">with it also the slides from today if</span> <span data-start="547.34" data-end="549.37">you were just blown away by those and</span> <span data-start="549.37" data-end="553.55">finally the concept of doing that</span> <span data-start="553.55" data-end="555.47">testing on the three different ways you</span> <span data-start="555.47" data-end="559.13">conversion your API I was a very hungry</span> <span data-start="559.13" data-end="560.93">at lunch so I turned that into a plug-in</span> <span data-start="560.93" data-end="562.55">itself so as soon as I've come up with a</span> <span data-start="562.55" data-end="564.14">cool name for it which as I said I</span> <span data-start="564.14" data-end="566.57">struggle with I'll publish that and show</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
