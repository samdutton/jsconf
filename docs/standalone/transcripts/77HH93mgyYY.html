<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>77HH93mgyYY</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/77HH93mgyYY?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="17.37" data-end="20.55">hello everybody my name is Michael</span> <span data-start="20.55" data-end="22.5">Boland I'm here to talk to you about the</span> <span data-start="22.5" data-end="25.62">the width keyword the most evil thing</span> <span data-start="25.62" data-end="27.03">that we've ever seen in JavaScript</span> <span data-start="27.03" data-end="29.16">according to some people I'm also the</span> <span data-start="29.16" data-end="30.66">author of closure the definitive guide</span> <span data-start="30.66" data-end="32.37">so I'm going to commission a you some</span> <span data-start="32.37" data-end="33.57">actually some actually some of the good</span> <span data-start="33.57" data-end="34.83">parts about with some of the interesting</span> <span data-start="34.83" data-end="37.5">problems that you can solve with it and</span> <span data-start="37.5" data-end="39.51">also show you a little bit of closure as</span> <span data-start="39.51" data-end="42.989">part of that so first let's just look at</span> <span data-start="42.989" data-end="44.22">remember what people are saying about</span> <span data-start="44.22" data-end="46.65">with so you know some of our most</span> <span data-start="46.65" data-end="49.23">popular JavaScript books they're</span> <span data-start="49.23" data-end="51.42">basically saying don't even look at this</span> <span data-start="51.42" data-end="54.39">thing just this is the keyword it's</span> <span data-start="54.39" data-end="55.8">going to sell your program down and</span> <span data-start="55.8" data-end="57.33">you're going to have errors if you use</span> <span data-start="57.33" data-end="59.22">it like let's move on to the next</span> <span data-start="59.22" data-end="62.519">section usually when you see someone</span> <span data-start="62.519" data-end="65.09">give an example of what with is used for</span> <span data-start="65.09" data-end="68.55">its it trivializes it considerably it</span> <span data-start="68.55" data-end="70.68">basically says oh you're probably a lazy</span> <span data-start="70.68" data-end="73.32">programmer and if you want to add a lot</span> <span data-start="73.32" data-end="75.18">of properties to an object you're using</span> <span data-start="75.18" data-end="77.55">with you put the object properties to</span> <span data-start="77.55" data-end="79.02">inside there you do all these things</span> <span data-start="79.02" data-end="81.27">inside the block whereas you could also</span> <span data-start="81.27" data-end="82.65">just do what I show on the bottom of</span> <span data-start="82.65" data-end="84.39">this slide or just create a temporary</span> <span data-start="84.39" data-end="86.43">variable and then do the assignments</span> <span data-start="86.43" data-end="88.05">that way so basically the argument is</span> <span data-start="88.05" data-end="91.47">that you really never need with with is</span> <span data-start="91.47" data-end="92.82">actually doing a lot more it adds</span> <span data-start="92.82" data-end="95.43">another object to the scope change for</span> <span data-start="95.43" data-end="97.08">when you're resolving variables this</span> <span data-start="97.08" data-end="98.04">actually lets you do a lot more</span> <span data-start="98.04" data-end="100.56">interesting things then this little</span> <span data-start="100.56" data-end="102">example that is what you usually see</span> <span data-start="102" data-end="106.11">about with gives it credit for so let me</span> <span data-start="106.11" data-end="108.12">show you a problem that we had my last</span> <span data-start="108.12" data-end="110.34">job that we can actually only seem to be</span> <span data-start="110.34" data-end="113.91">able to solve using with so this is</span> <span data-start="113.91" data-end="116.13">actually snippet of code from from big</span> </p>
<p><span data-start="116.13" data-end="119.91">Matt Bing Maps version 63 so you know so</span> <span data-start="119.91" data-end="121.68">Bing Maps just like Google Maps or other</span> <span data-start="121.68" data-end="124.71">other other libraries something that you</span> <span data-start="124.71" data-end="126.06">would include in your application you</span> <span data-start="126.06" data-end="128.459">put a script tag or load it and then</span> <span data-start="128.459" data-end="131.47">you're actually giving that third party</span> <span data-start="131.47" data-end="137.629">the ability sorry oh thank you you're</span> <span data-start="137.629" data-end="139.069">giving that that library you know</span> <span data-start="139.069" data-end="141.379">ability to act access code in your</span> <span data-start="141.379" data-end="143.03">webpage and you're basically trusting</span> <span data-start="143.03" data-end="145.97">them to behave appropriately does anyone</span> <span data-start="145.97" data-end="148.22">actually see what's going on in this</span> <span data-start="148.22" data-end="157.069">code that could be a problem I like the</span> <span data-start="157.069" data-end="158.81">idea but in the sentiment in the energy</span> <span data-start="158.81" data-end="161.959">but no so so what's actually happening</span> <span data-start="161.959" data-end="165.17">is that if you look carefully this this</span> <span data-start="165.17" data-end="167.84">snippet of code is declaring two new</span> <span data-start="167.84" data-end="170.48">variables and Global's global scope the</span> <span data-start="170.48" data-end="172.88">eye and the Len for short for length</span> <span data-start="172.88" data-end="176.63">variables because the presumably heard</span> <span data-start="176.63" data-end="177.89">wrote this made the mistake of thinking</span> <span data-start="177.89" data-end="180.019">that javascript has blocked scope and</span> <span data-start="180.019" data-end="181.64">that they were defining a variable in a</span> <span data-start="181.64" data-end="182.599">block and it wasn't going to bother</span> <span data-start="182.599" data-end="184.91">anybody but obviously you shall know</span> <span data-start="184.91" data-end="186.95">better and knowing that javascript uses</span> <span data-start="186.95" data-end="188.989">function scope and this actually leaks</span> <span data-start="188.989" data-end="192.98">these variables into the global scope so</span> <span data-start="192.98" data-end="194.9">but why so here's an example so why</span> <span data-start="194.9" data-end="197.239">would this be a problem who cares like</span> <span data-start="197.239" data-end="198.95">what with the global definition of I is</span> <span data-start="198.95" data-end="200.299">and length like whatever you're going to</span> <span data-start="200.299" data-end="201.829">use it you're probably going to reassign</span> <span data-start="201.829" data-end="203.269">it and that sort of thing and you'd</span> <span data-start="203.269" data-end="205.31">override whatever this Bing Maps code</span> <span data-start="205.31" data-end="209.569">did well as it turns out we were using</span> <span data-start="209.569" data-end="213.019">the closure compiler to minify our code</span> <span data-start="213.019" data-end="214.91">and what happened was the closure</span> <span data-start="214.91" data-end="216.38">compiler decided to save some bites</span> <span data-start="216.38" data-end="217.85">instead of using four bytes for the word</span> <span data-start="217.85" data-end="219.5">true it was going to assign it to the</span> <span data-start="219.5" data-end="222.23">variable I and assigned so assigned true</span> <span data-start="222.23" data-end="223.73">to I and everywhere in our code where we</span> <span data-start="223.73" data-end="225.079">were going to reference the literal true</span> <span data-start="225.079" data-end="229.22">we now reference this variable I so that</span> <span data-start="229.22" data-end="231.44">means that once our application was</span> <span data-start="231.44" data-end="233.299">running along and then after we loaded</span> </p>
<p><span data-start="233.299" data-end="235.609">Bing Maps suddenly places where we were</span> <span data-start="235.609" data-end="237.079">looking for true we were getting the</span> <span data-start="237.079" data-end="240.23">number three this was extremely hard to</span> <span data-start="240.23" data-end="243.049">figure out where this was coming from we</span> <span data-start="243.049" data-end="244.489">certainly didn't know it was being maps</span> <span data-start="244.489" data-end="246.2">at first but then eventually we tracked</span> <span data-start="246.2" data-end="249.62">it down and so this is this leads to</span> <span data-start="249.62" data-end="251.26">kind of the basic problem of how do you</span> <span data-start="251.26" data-end="254.599">load code from another website and</span> <span data-start="254.599" data-end="257.03">protect your own code to make sure that</span> <span data-start="257.03" data-end="258.919">variables don't leak out of scope and</span> <span data-start="258.919" data-end="261.59">that sort of thing so most people would</span> <span data-start="261.59" data-end="263.63">say oh that's simple like all I need to</span> <span data-start="263.63" data-end="264.38">do</span> <span data-start="264.38" data-end="266.18">is load my code inside what a lot of</span> <span data-start="266.18" data-end="267.8">people refer to is immediate function so</span> <span data-start="267.8" data-end="269.96">a function that execute immediately</span> <span data-start="269.96" data-end="272.03">basically giving all of your code a</span> <span data-start="272.03" data-end="274.19">fresh scope protecting it from all the</span> <span data-start="274.19" data-end="277.67">code on load from another page so</span> <span data-start="277.67" data-end="279.2">normally that that is definitely</span> <span data-start="279.2" data-end="281.3">sufficient absolutely the right way to</span> <span data-start="281.3" data-end="284.87">go the problem is is now what happens if</span> <span data-start="284.87" data-end="286.58">you have a lot of code and you so much</span> <span data-start="286.58" data-end="288.8">code that you need to break it up into</span> <span data-start="288.8" data-end="290.75">modules so by modules I mean you have</span> <span data-start="290.75" data-end="292.52">you take all of your code you go a bit</span> <span data-start="292.52" data-end="294.5">into one file and then you actually</span> <span data-start="294.5" data-end="296.72">carve it up into bits that can be loaded</span> <span data-start="296.72" data-end="298.76">dynamically so for example an</span> <span data-start="298.76" data-end="300.26">application like Gmail where you might</span> <span data-start="300.26" data-end="302.57">have some core use some core libraries</span> <span data-start="302.57" data-end="304.49">like say string and array utilities</span> <span data-start="304.49" data-end="306.23">that's a that's one cluster of</span> </p>
<p><span data-start="306.23" data-end="307.49">JavaScript that you want to load</span> <span data-start="307.49" data-end="309.26">initially and then depending on what the</span> <span data-start="309.26" data-end="311.39">user does you might want to dynamically</span> <span data-start="311.39" data-end="314.6">load other other JavaScript tags so if</span> <span data-start="314.6" data-end="315.77">they go to the inbox you might want to</span> <span data-start="315.77" data-end="317">load logic that's specific to that</span> <span data-start="317" data-end="319.46">they'll go to settings load logic that's</span> <span data-start="319.46" data-end="322.97">specific to that in that way you</span> <span data-start="322.97" data-end="325.28">basically can improve the startup time</span> <span data-start="325.28" data-end="326.39">of your application you're not</span> <span data-start="326.39" data-end="328.22">penalizing the user for pulling down a</span> <span data-start="328.22" data-end="329.69">bunch of code for things that they don't</span> <span data-start="329.69" data-end="332.81">use so so this is this is a popular</span> <span data-start="332.81" data-end="334.7">technique fairly popular technique to</span> <span data-start="334.7" data-end="337.52">improve speed but the problem is is that</span> <span data-start="337.52" data-end="339.53">if you think back to to this if you</span> <span data-start="339.53" data-end="344.12">loaded every file every module inside of</span> <span data-start="344.12" data-end="345.83">its own immediate function then you have</span> <span data-start="345.83" data-end="348.95">this problem where code loaded in this</span> <span data-start="348.95" data-end="350.9">module can't talk to code loaded in this</span> <span data-start="350.9" data-end="352.99">module they don't share a scope anymore</span> <span data-start="352.99" data-end="355.31">so the problem is that you want your</span> <span data-start="355.31" data-end="356.78">modules to share scope but you don't</span> <span data-start="356.78" data-end="361.91">want to share scope with Microsoft so so</span> <span data-start="361.91" data-end="363.4">what are you to do what are your options</span> <span data-start="363.4" data-end="367.25">so there's there's a few ways right now</span> <span data-start="367.25" data-end="371.15">that people load modules so one is you</span> <span data-start="371.15" data-end="373.4">load each module via its own script tag</span> <span data-start="373.4" data-end="375.44">you just do in a pen child every time</span> <span data-start="375.44" data-end="376.88">you want to load another another clump</span> <span data-start="376.88" data-end="378.98">of JavaScript you just you just add it</span> <span data-start="378.98" data-end="381.11">one of the nice things about this</span> <span data-start="381.11" data-end="383.42">approach is that you can load your code</span> <span data-start="383.42" data-end="385.22">from a CDN the content delivery network</span> <span data-start="385.22" data-end="387.38">so this is popular because for your your</span> <span data-start="387.38" data-end="389.03">static resources if you send them off to</span> <span data-start="389.03" data-end="392.03">aqua or someone like that you know they</span> <span data-start="392.03" data-end="393.979">have they have data centers around the</span> <span data-start="393.979" data-end="395.9">world people your app should be able to</span> <span data-start="395.9" data-end="397.76">load a lot faster</span> <span data-start="397.76" data-end="399.02">so this is a pretty common way that</span> <span data-start="399.02" data-end="401.69">people though JavaScript but the problem</span> <span data-start="401.69" data-end="403.88">is that any code that you load in this</span> <span data-start="403.88" data-end="406.4">way it's going to all operate in the</span> <span data-start="406.4" data-end="407.72">global scope so now we're going to have</span> <span data-start="407.72" data-end="410.02">to come back to our problem where</span> </p>
<p><span data-start="410.02" data-end="411.71">JavaScript that we load from bing maps</span> <span data-start="411.71" data-end="413.93">could theoretically interfere with our</span> <span data-start="413.93" data-end="418.37">code a second technique is also if the</span> <span data-start="418.37" data-end="420.2">code is on the same domain you could</span> <span data-start="420.2" data-end="422.72">make an xhr fetch the code as a string</span> <span data-start="422.72" data-end="427.4">and then just eval this actually this</span> <span data-start="427.4" data-end="429.29">you can't even do in an immediate</span> <span data-start="429.29" data-end="432.29">function because when you call eval it's</span> <span data-start="432.29" data-end="434.69">either going to work in the the function</span> <span data-start="434.69" data-end="436.22">scope and which are calling it or in the</span> <span data-start="436.22" data-end="438.65">global scope either case it's not going</span> <span data-start="438.65" data-end="441.35">to work at this module scope that that</span> <span data-start="441.35" data-end="443.03">that we don't actually have yet but is</span> <span data-start="443.03" data-end="446.63">the type of thing that we want also just</span> <span data-start="446.63" data-end="449.33">as a as a minor in a problem with this</span> <span data-start="449.33" data-end="451.61">also the the JavaScript has to be on the</span> <span data-start="451.61" data-end="455.21">same domain so probably not usable with</span> <span data-start="455.21" data-end="457.04">the content delivery network and also it</span> <span data-start="457.04" data-end="459.02">can't be parsed as as it's downloaded so</span> <span data-start="459.02" data-end="461.75">it's not as fast to say when you loaded</span> <span data-start="461.75" data-end="464.39">something via via script tag and the</span> <span data-start="464.39" data-end="465.68">third option which is a little bit</span> <span data-start="465.68" data-end="468.98">better is to load the JavaScript in an</span> <span data-start="468.98" data-end="471.08">iframe and so if you load all the</span> </p>
<p><span data-start="471.08" data-end="472.61">JavaScript that you care about that you</span> <span data-start="472.61" data-end="474.92">want to be specific to your modules you</span> <span data-start="474.92" data-end="476.48">can create an iframe you could basically</span> <span data-start="476.48" data-end="479.69">create a new environment where all only</span> <span data-start="479.69" data-end="481.37">your javascript is loaded and it can</span> <span data-start="481.37" data-end="482.77">talk to each other and it's effectively</span> <span data-start="482.77" data-end="485">sandbox from from the other libraries</span> <span data-start="485" data-end="487.67">that you load in the top-level frame the</span> <span data-start="487.67" data-end="489.23">drawback to this is that it's just kind</span> <span data-start="489.23" data-end="491.3">of complicated and that when you do</span> <span data-start="491.3" data-end="493.76">things like load javascript in an iframe</span> <span data-start="493.76" data-end="495.32">when you refer to the document you're</span> <span data-start="495.32" data-end="497.12">referring it to that iframe and you're</span> <span data-start="497.12" data-end="498.62">not referring it into the page where</span> <span data-start="498.62" data-end="501.05">your application it most likely lives so</span> <span data-start="501.05" data-end="502.13">you have you so you can do something</span> <span data-start="502.13" data-end="504.2">like jiggering to keep the to make sure</span> <span data-start="504.2" data-end="505.49">that you use the right variable in the</span> <span data-start="505.49" data-end="507.53">right spot but it's pain and it could</span> <span data-start="507.53" data-end="510.8">also be error prone so of these three</span> <span data-start="510.8" data-end="512.68">solutions none of them are really</span> <span data-start="512.68" data-end="516.919">satisfying they all have drawbacks so</span> <span data-start="516.919" data-end="519.11">there fortunately there is a workaround</span> <span data-start="519.11" data-end="521.419">and we have and it involves using the</span> <span data-start="521.419" data-end="526.34">hated with keyword so this is a way this</span> <span data-start="526.34" data-end="528.02">technique works is that it's similar to</span> <span data-start="528.02" data-end="530.54">the immediate function but you wrap so</span> <span data-start="530.54" data-end="531.32">you wrap your code</span> <span data-start="531.32" data-end="533.09">in a function and what you do is</span> <span data-start="533.09" data-end="536.21">initially you create a scope so this</span> <span data-start="536.21" data-end="538.22">variable this is an object literal and</span> <span data-start="538.22" data-end="539.84">this is going to function basically as</span> <span data-start="539.84" data-end="542.27">the scope that we want to share between</span> <span data-start="542.27" data-end="547.04">all modules as as they are loaded and we</span> <span data-start="547.04" data-end="549.2">wrap our code in an immediate function</span> <span data-start="549.2" data-end="550.7">and inside that immediate function the</span> <span data-start="550.7" data-end="552.17">first thing the top-level thing is a</span> <span data-start="552.17" data-end="555.92">with block and it takes the the module</span> <span data-start="555.92" data-end="558.89">scope as an argument basically just so</span> <span data-start="558.89" data-end="561.02">that we can alias it to a short of local</span> <span data-start="561.02" data-end="562.76">variable so that in the page it's</span> <span data-start="562.76" data-end="566.42">something you know unusual or unlikely</span> <span data-start="566.42" data-end="568.73">to Clyde but inside our function we can</span> <span data-start="568.73" data-end="571.31">use a short name like a so we pass it in</span> <span data-start="571.31" data-end="574.04">and then we just do with that scope and</span> <span data-start="574.04" data-end="576.23">then we when we do assignments top-level</span> <span data-start="576.23" data-end="578.15">assignments like VAR i equals true</span> <span data-start="578.15" data-end="581.24">instead of doing VAR y equals true we do</span> <span data-start="581.24" data-end="583.67">at least the top-level assignments in</span> <span data-start="583.67" data-end="585.8">the cellular module code we assign them</span> <span data-start="585.8" data-end="588.14">directly on the on the object that we</span> <span data-start="588.14" data-end="590.42">are passing to with so you notice that</span> <span data-start="590.42" data-end="593.66">here the assignment is on is on a so</span> <span data-start="593.66" data-end="596.51">it's directly on the object the scope</span> <span data-start="596.51" data-end="598.64">object that we've passed in however once</span> <span data-start="598.64" data-end="600.8">you do that all your uses of that</span> <span data-start="600.8" data-end="603.05">variable don't need to be prefixed with</span> <span data-start="603.05" data-end="605.18">a anymore if you had to prefix it with a</span> <span data-start="605.18" data-end="607.31">everywhere this would be extremely</span> <span data-start="607.31" data-end="608.75">tedious but you actually don't have to</span> <span data-start="608.75" data-end="610.64">because what's happening is that when</span> <span data-start="610.64" data-end="613.97">this alert statement executes eyes goes</span> <span data-start="613.97" data-end="615.71">up the scope chain to get resolved and</span> <span data-start="615.71" data-end="617.51">it actually gets resolved on the object</span> <span data-start="617.51" data-end="619.49">that was passed passed to width which is</span> <span data-start="619.49" data-end="623.06">a or this module scope variable that we</span> <span data-start="623.06" data-end="626.15">created and so basically every other</span> <span data-start="626.15" data-end="628.7">every module that you load which you now</span> <span data-start="628.7" data-end="630.38">you can do via a script tag you have</span> <span data-start="630.38" data-end="631.88">basically this you have the exact same</span> <span data-start="631.88" data-end="634.25">thing as this except this declaration at</span> <span data-start="634.25" data-end="635.87">the top because this is going to be a</span> <span data-start="635.87" data-end="638.75">global that actually is shared and then</span> <span data-start="638.75" data-end="641.06">every every module we'll just call its</span> <span data-start="641.06" data-end="644.42">function and take and take module scope</span> <span data-start="644.42" data-end="649.85">and and pass it in so the one problem</span> <span data-start="649.85" data-end="652.55">that you might notice is that or your</span> <span data-start="652.55" data-end="654.08">complaint might be I don't really want</span> <span data-start="654.08" data-end="656.45">to write my code like this and I agree</span> <span data-start="656.45" data-end="657.77">that you shouldn't want shouldn't write</span> <span data-start="657.77" data-end="658.97">your code like that it'd be very tedious</span> <span data-start="658.97" data-end="662.69">it wouldn't be portable across different</span> <span data-start="662.69" data-end="665.19">different use cases and so fortunately</span> <span data-start="665.19" data-end="668.43">you don't have to so there's two</span> <span data-start="668.43" data-end="670.98">transformations that you need to do to</span> <span data-start="670.98" data-end="673.08">your code and i'll show you how to do</span> <span data-start="673.08" data-end="675.51">them with the closure compiler so</span> <span data-start="675.51" data-end="677.13">basically the two things that happen are</span> <span data-start="677.13" data-end="679.71">is that your function statements so</span> <span data-start="679.71" data-end="683">function f this style has to get</span> <span data-start="683" data-end="686.31">redefined into the function expression</span> <span data-start="686.31" data-end="688.35">style so this is the style that's you</span> <span data-start="688.35" data-end="691.11">know espoused in JavaScript of good</span> <span data-start="691.11" data-end="695.79">parts and other places but so some of</span> <span data-start="695.79" data-end="697.17">you may know that there actually is a</span> <span data-start="697.17" data-end="698.97">behavioral difference when you do this</span> <span data-start="698.97" data-end="701.64">type of trance transformation that has</span> <span data-start="701.64" data-end="703.56">to do only if you use function hoisting</span> <span data-start="703.56" data-end="706.74">and my experience that's usually not an</span> <span data-start="706.74" data-end="708.12">issue it's a feature of the language</span> <span data-start="708.12" data-end="711.03">that very few people use so this</span> <span data-start="711.03" data-end="712.92">transformation is basically fairly safe</span> <span data-start="712.92" data-end="714.27">and straightforward so this is the first</span> <span data-start="714.27" data-end="716.33">transformation that you have to do</span> <span data-start="716.33" data-end="718.44">basically different the function from</span> <span data-start="718.44" data-end="720.12">getting coy stood outside the with block</span> <span data-start="720.12" data-end="722.55">and the second transformation this one's</span> <span data-start="722.55" data-end="725.61">a little a little stranger so this this</span> <span data-start="725.61" data-end="727.41">part you need to make sure that all the</span> <span data-start="727.41" data-end="729.09">assignments are done on what it what</span> <span data-start="729.09" data-end="731.73">this shared scope variable is going to</span> <span data-start="731.73" data-end="734.82">be across your modules so so if you have</span> <span data-start="734.82" data-end="736.65">assignments so normally your code if</span> <span data-start="736.65" data-end="738.84">we're just VAR x and then y equals Z</span> <span data-start="738.84" data-end="741.51">equals 5 or and or another VAR</span> <span data-start="741.51" data-end="743.28">declaration where you're defining it in</span> <span data-start="743.28" data-end="745.23">terms of itself basically on the right</span> <span data-start="745.23" data-end="747.87">side normally if you just said VAR x you</span> <span data-start="747.87" data-end="749.64">wouldn't have to do an explicit</span> <span data-start="749.64" data-end="751.2">assignment on the right but in to use</span> <span data-start="751.2" data-end="752.58">this technique you need to assign it to</span> <span data-start="752.58" data-end="755.25">because if this global scope</span> <span data-start="755.25" data-end="757.95">object a doesn't have a slot or a</span> <span data-start="757.95" data-end="760.53">property so to speak for X then when you</span> <span data-start="760.53" data-end="761.82">read it it's actually going to go</span> <span data-start="761.82" data-end="764.19">outside the with block so so basically</span> <span data-start="764.19" data-end="765.84">that's why all the initial all the</span> <span data-start="765.84" data-end="768.12">initializations are all the variables</span> <span data-start="768.12" data-end="770.52">top level variables in your module that</span> <span data-start="770.52" data-end="771.99">you're going to use have to be defined</span> <span data-start="771.99" data-end="775.05">or have some definition on the global</span> <span data-start="775.05" data-end="777.51">scope object so you can see here these</span> <span data-start="777.51" data-end="778.77">are the basic types of transformations</span> <span data-start="778.77" data-end="782.91">that you need to do is our chain our pre</span> <span data-start="782.91" data-end="784.68">fix things with whatever your you know</span> <span data-start="784.68" data-end="785.79">local variable that you're going to pass</span> <span data-start="785.79" data-end="787.92">to with is going to be so we can see we</span> <span data-start="787.92" data-end="792.6">assign X don't defined and we also find</span> <span data-start="792.6" data-end="794.91">eight like W to find that on a</span> <span data-start="794.91" data-end="796.89">find in terms of itself and now these</span> <span data-start="796.89" data-end="799.71">things will behave the same if if a is</span> <span data-start="799.71" data-end="804.03">passed in so again this would be very</span> <span data-start="804.03" data-end="806.34">tedious if you were expected to do all</span> <span data-start="806.34" data-end="808.98">this by hand fortunately this is where</span> <span data-start="808.98" data-end="812.28">the closure compiler comes in so if</span> <span data-start="812.28" data-end="813.27">you're not familiar with the closure</span> <span data-start="813.27" data-end="816.62">compiler is a whole whole whole program</span> <span data-start="816.62" data-end="819.24">optimizing compiler from google that</span> <span data-start="819.24" data-end="821.55">means it reads in the all of the code of</span> <span data-start="821.55" data-end="823.62">your program of your JavaScript and</span> <span data-start="823.62" data-end="825.06">compiles it all together at once so it</span> <span data-start="825.06" data-end="827.94">can do you know a whole program analysis</span> <span data-start="827.94" data-end="829.44">so it could find for a function it could</span> <span data-start="829.44" data-end="831.36">find all the call sites and that sort of</span> <span data-start="831.36" data-end="833.61">thing which is what part of what makes</span> <span data-start="833.61" data-end="837.09">this this technique possible so there's</span> <span data-start="837.09" data-end="840.18">there's two compiler passes that that</span> <span data-start="840.18" data-end="841.8">you need to run so basically these to</span> <span data-start="841.8" data-end="844.08">compile our passes take care of these</span> <span data-start="844.08" data-end="845.91">two transformations that need to be done</span> <span data-start="845.91" data-end="847.8">so you write your JavaScript as you</span> <span data-start="847.8" data-end="849.9">always normally would but this is just</span> <span data-start="849.9" data-end="851.61">an extra setting that you can enable</span> <span data-start="851.61" data-end="855.27">when you compile your JavaScript so this</span> <span data-start="855.27" data-end="857.61">this these passes have not been up</span> <span data-start="857.61" data-end="859.11">straight up streamed into the closure</span> <span data-start="859.11" data-end="861.81">compiler yet but that's that's in the</span> <span data-start="861.81" data-end="864.78">process I've built a build tool for</span> <span data-start="864.78" data-end="867">closure called plover and that's open</span> <span data-start="867" data-end="869.25">source its prevail on google code and it</span> <span data-start="869.25" data-end="871.56">has all the logic for these compiler</span> <span data-start="871.56" data-end="872.85">passes it's actually not that difficult</span> <span data-start="872.85" data-end="876.09">if someone wanted to port it to to</span> <span data-start="876.09" data-end="879.72">another another compiler perhaps most</span> <span data-start="879.72" data-end="881.67">interestingly most people are afraid is</span> <span data-start="881.67" data-end="883.23">that does this really work or is this</span> <span data-start="883.23" data-end="886.02">just some sort of toy exercise and</span> </p>
<p><span data-start="886.02" data-end="888.06">JavaScript transformations I can show</span> <span data-start="888.06" data-end="890.52">you assure you that it is not so I was</span> <span data-start="890.52" data-end="894.63">formerly at yext and it's a well and</span> <span data-start="894.63" data-end="897.84">there we built using a web applications</span> <span data-start="897.84" data-end="899.13">over a hundred thousand lines of code</span> <span data-start="899.13" data-end="902.49">had to run on ie6 and up we actually</span> <span data-start="902.49" data-end="904.92">carved our code up into 25 modules to</span> <span data-start="904.92" data-end="907.23">reduce the initial load size and let</span> <span data-start="907.23" data-end="908.49">people pick from the pieces that they</span> <span data-start="908.49" data-end="909.72">needed to and when using the application</span> <span data-start="909.72" data-end="912.57">to dynamically load modules and and</span> <span data-start="912.57" data-end="914.31">there were we did not witness any</span> <span data-start="914.31" data-end="916.86">problems using this technique so it is</span> <span data-start="916.86" data-end="918.99">definitely much more than a toy and has</span> <span data-start="918.99" data-end="922.53">been used at scale the one other</span> <span data-start="922.53" data-end="924.3">outstanding question is just that of</span> <span data-start="924.3" data-end="925.98">speed since most attractors from with</span> <span data-start="925.98" data-end="928.01">often claim that</span> <span data-start="928.01" data-end="929.96">it's going to adversely affect your your</span> <span data-start="929.96" data-end="932.72">runtime performance so I have not done</span> <span data-start="932.72" data-end="935.6">any sort of benchmarking yet however we</span> <span data-start="935.6" data-end="937.94">did not observe any any problems when</span> <span data-start="937.94" data-end="947.26">when running it yeah</span> </p>
<p><span data-start="947.27" data-end="953.06">I</span> <span data-start="953.07" data-end="957.48">Oh</span> <span data-start="957.49" data-end="959.13">hi</span> <span data-start="959.13" data-end="962.55">yeah I mean so so that's it so you said</span> <span data-start="962.55" data-end="971.96">100 times slower in a tight loop</span> <span data-start="971.97" data-end="975.97">okay yeah so I mean so that's and and</span> <span data-start="975.97" data-end="977.529">part of that problem though I would say</span> <span data-start="977.529" data-end="979.5">is that you know there's there's what</span> <span data-start="979.5" data-end="981.73">javascript interpreters do today and</span> <span data-start="981.73" data-end="983.11">then there's what we want them to be</span> <span data-start="983.11" data-end="985.269">able to do obviously recently things</span> <span data-start="985.269" data-end="987.43">like the eight we've seen interpreters</span> <span data-start="987.43" data-end="989.74">get a lot faster so I'm not really</span> <span data-start="989.74" data-end="991.06">certain if there's actually a</span> <span data-start="991.06" data-end="993.85">fundamental limit in with or really just</span> <span data-start="993.85" data-end="995.92">that people have not looked at</span> <span data-start="995.92" data-end="998.32">optimizing it very much yet obviously it</span> <span data-start="998.32" data-end="1000.6">somewhat outcast in yes or is out are</span> <span data-start="1000.6" data-end="1003.86">outlawed by es5 script strict so</span> <span data-start="1003.86" data-end="1006.45">obviously that that makes it less</span> <span data-start="1006.45" data-end="1022.09">popular to work on yeah</span> <span data-start="1022.1" data-end="1026.059">yeah well I yeah so this technique is a</span> <span data-start="1026.059" data-end="1027.319">little different because it's using with</span> <span data-start="1027.319" data-end="1029.63">at the very top as opposed to very deep</span> <span data-start="1029.63" data-end="1032.419">in the AST so i'm not sure that many</span> <span data-start="1032.419" data-end="1033.829">people have been using it or looking at</span> <span data-start="1033.829" data-end="1036.11">it this way before but i could be wrong</span> <span data-start="1036.11" data-end="1045.9">about that</span> <span data-start="1045.91" data-end="1049.85">yeah well it's definitely worth</span> <span data-start="1049.85" data-end="1052.19">measuring to be to be certain but you</span> <span data-start="1052.19" data-end="1053.9">know telling other people it's still in</span> </p>
<p><span data-start="1053.9" data-end="1055.76">JavaScript and compared to say Dom</span> <span data-start="1055.76" data-end="1057.5">accesses or that sort of thing still</span> <span data-start="1057.5" data-end="1059.36">actually may be very cheap it's hard to</span> <span data-start="1059.36" data-end="1061.19">say without without actually testing it</span> <span data-start="1061.19" data-end="1066.38">out one is certain we differentiate</span> <span data-start="1066.38" data-end="1068.31">automated system</span> <span data-start="1068.31" data-end="1071.45">four bears over like the property</span> <span data-start="1071.45" data-end="1073.68">share pothole</span> <span data-start="1073.68" data-end="1075.72">these are way different</span> <span data-start="1075.72" data-end="1078.09">kind of like module context variables</span> <span data-start="1078.09" data-end="1080.46">and then strip these local like a bear</span> <span data-start="1080.46" data-end="1082.26">like hey I don't needs to be in the box</span> <span data-start="1082.26" data-end="1085.02">oh yeah yeah so I guess I don't really</span> <span data-start="1085.02" data-end="1086.37">demonstrate it here but the question was</span> <span data-start="1086.37" data-end="1088.799">you know our is this transformation done</span> <span data-start="1088.799" data-end="1090.33">for all very ductile erations or only</span> <span data-start="1090.33" data-end="1092.07">ones at the top level and so the answer</span> <span data-start="1092.07" data-end="1093.179">is that it's only done for ones at the</span> <span data-start="1093.179" data-end="1095.85">top level so inside a function scope you</span> <span data-start="1095.85" data-end="1099.63">don't need to do it in your life so you</span> <span data-start="1099.63" data-end="1103.289">got like 25 across your entire entire</span> <span data-start="1103.289" data-end="1105.9">occasion each one is it some closure you</span> <span data-start="1105.9" data-end="1107.73">don't need like opportunity you want a</span> <span data-start="1107.73" data-end="1109.99">very local</span> <span data-start="1109.99" data-end="1113.36">looked like all their options like can</span> <span data-start="1113.36" data-end="1116.6">you have my closure level variable right</span> <span data-start="1116.6" data-end="1119.41">in addition to module level barriers</span> <span data-start="1119.41" data-end="1122.18">yeah I think you can do that I don't</span> <span data-start="1122.18" data-end="1123.8">believe the way that the passes are</span> <span data-start="1123.8" data-end="1125.93">written right now do that because I</span> <span data-start="1125.93" data-end="1127.82">don't think they take what's called</span> <span data-start="1127.82" data-end="1130.19">cross code motion into account basically</span> <span data-start="1130.19" data-end="1132.38">code make it move co gets move to the</span> <span data-start="1132.38" data-end="1134.71">least common ancestor of where it's used</span> <span data-start="1134.71" data-end="1136.88">but i think that is definitely possible</span> <span data-start="1136.88" data-end="1138.41">that's true that would reduce the number</span> <span data-start="1138.41" data-end="1140.69">of aliases that you'd have to create</span> <span data-start="1140.69" data-end="1146.53">yeah it was good question though see</span> <span data-start="1146.53" data-end="1148.4">anyway there are any other questions</span> <span data-start="1148.4" data-end="1156.02">well I'm feeling questions okay so so</span> <span data-start="1156.02" data-end="1158.93">this is just to sum up this was actually</span> <span data-start="1158.93" data-end="1162.2">done by my colleague EXT American he he</span> <span data-start="1162.2" data-end="1164.21">basically we got stung by this this Bing</span> </p>
<p><span data-start="1164.21" data-end="1166.01">Maps problem and he tracked it down how</span> <span data-start="1166.01" data-end="1169.01">I mysteriously became three and it</span> <span data-start="1169.01" data-end="1170.3">turned out that this was so this</span> <span data-start="1170.3" data-end="1171.89">protected us from arbitrary third-party</span> <span data-start="1171.89" data-end="1173.57">modules but also we discovered that</span> <span data-start="1173.57" data-end="1175.1">there are certain web proxies that also</span> <span data-start="1175.1" data-end="1177.26">seemed to inject JavaScript into our</span> <span data-start="1177.26" data-end="1179.81">page we weren't really sure why that was</span> <span data-start="1179.81" data-end="1182.21">happening but this also protect adds</span> <span data-start="1182.21" data-end="1184.34">level of protection around that sort of</span> <span data-start="1184.34" data-end="1187.49">thing so I realized that because of all</span> <span data-start="1187.49" data-end="1188.33">the things that have been written about</span> <span data-start="1188.33" data-end="1190.76">within the past like it's it may be hard</span> <span data-start="1190.76" data-end="1192.59">to accept that this is actually a really</span> <span data-start="1192.59" data-end="1194.72">good solution to this type of problem</span> <span data-start="1194.72" data-end="1196.76">but I certainly encourage you to take a</span> <span data-start="1196.76" data-end="1199.82">look and I think that you know if we if</span> <span data-start="1199.82" data-end="1202.07">this becomes a more popular technique</span> <span data-start="1202.07" data-end="1205.1">than things can be optimized things that</span> <span data-start="1205.1" data-end="1206.54">are slow today or not not necessarily</span> <span data-start="1206.54" data-end="1207.92">going to be the things that are slow</span> <span data-start="1207.92" data-end="1211.49">tomorrow so I encourage you to take a</span> <span data-start="1211.49" data-end="1214.37">look at the code and contact me if you</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
