<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VqHkzbHEUd0</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/VqHkzbHEUd0?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="10.01" data-end="18.01">how is everybody i got in at 6am and</span> <span data-start="18.01" data-end="20.33">then I still came here and I'm talking</span> <span data-start="20.33" data-end="22.52">to you and that was the best you can do</span> <span data-start="22.52" data-end="28.94">how is everybody there you go so I've</span> <span data-start="28.94" data-end="31.039">seen Jed present before he's pretty</span> <span data-start="31.039" data-end="35.12">slick right so instead of actually doing</span> <span data-start="35.12" data-end="37.61">anything with keynote I draw my sights</span> <span data-start="37.61" data-end="40.04">on my iPad because that way I don't have</span> <span data-start="40.04" data-end="42.08">to compete with dead because he would</span> <span data-start="42.08" data-end="46.76">win so yeah this is I talked to a lot of</span> <span data-start="46.76" data-end="49.059">people I write a lot of node code and</span> <span data-start="49.059" data-end="51.14">one of the things that seems to be a</span> <span data-start="51.14" data-end="53.21">reoccurring problem for people is that</span> <span data-start="53.21" data-end="55.01">we're exploring this whole new paradigm</span> <span data-start="55.01" data-end="57.62">with server-side JavaScript any in</span> <span data-start="57.62" data-end="60.53">particular node I think really when we</span> <span data-start="60.53" data-end="62.059">talk about server-side JavaScript at the</span> <span data-start="62.059" data-end="64.58">moment most people think of node and the</span> <span data-start="64.58" data-end="68.03">event loop has a really specific set of</span> <span data-start="68.03" data-end="72.26">problems that people aren't used to we</span> <span data-start="72.26" data-end="74.33">program a particular way from the from</span> <span data-start="74.33" data-end="78.14">the browser but it's not exactly the</span> <span data-start="78.14" data-end="81.37">same so I thought I'd write this this is</span> <span data-start="81.37" data-end="84.95">how do we how do we really stop writing</span> <span data-start="84.95" data-end="87.71">code that just looks like ass and how do</span> <span data-start="87.71" data-end="90.2">we do something with that so there's a</span> <span data-start="90.2" data-end="92.06">warning i'm going to use a lot of</span> <span data-start="92.06" data-end="94.79">metaphors so i don't know i have some i</span> <span data-start="94.79" data-end="96.86">probably have a total of twenty lines of</span> <span data-start="96.86" data-end="99.83">code in this whole presentation but</span> <span data-start="99.83" data-end="101.51">there's going to be some extremely bad</span> <span data-start="101.51" data-end="104">metaphor so be warned but what i really</span> <span data-start="104" data-end="107.09">want to do is explain how this works</span> <span data-start="107.09" data-end="110.33">rather than dazzle you with code Tim did</span> <span data-start="110.33" data-end="114.5">an amazing job yesterday of explaining</span> <span data-start="114.5" data-end="117.68">this stuff anything his slide deck is is</span> <span data-start="117.68" data-end="119.78">great reference material go and read his</span> <span data-start="119.78" data-end="125.81">code go and sit and digest it I'm a</span> <span data-start="125.81" data-end="129.86">little bit less smarten Tim right I sit</span> </p>
<p><span data-start="129.86" data-end="131.629">I sit with ryan and i kind of i watch</span> <span data-start="131.629" data-end="134.269">these guys that I'm like ah so instead</span> <span data-start="134.269" data-end="136.819">of trying to do it that way for me I try</span> <span data-start="136.819" data-end="138.499">and tell myself a story I try and figure</span> <span data-start="138.499" data-end="140.689">out what's the simplest way that in my</span> <span data-start="140.689" data-end="140.97">head</span> <span data-start="140.97" data-end="142.32">I can understand how this stuff works</span> <span data-start="142.32" data-end="145.83">and the thing that we really need to</span> <span data-start="145.83" data-end="147.39">understand is this event loop thing</span> <span data-start="147.39" data-end="149.64">right and everybody has talked about it</span> <span data-start="149.64" data-end="151.38">this week everybody's been going on on</span> <span data-start="151.38" data-end="153.63">and on about the event loop but I have</span> <span data-start="153.63" data-end="157.2">this theory I believe that people really</span> <span data-start="157.2" data-end="160.71">get event-driven programming so I cook</span> <span data-start="160.71" data-end="163.89">hands up people that cook right hands up</span> <span data-start="163.89" data-end="165.03">people that can cook more than just</span> <span data-start="165.03" data-end="168.63">ramen noodles hello your geeks I have to</span> <span data-start="168.63" data-end="171.78">ask that right so if you really cook if</span> <span data-start="171.78" data-end="173.88">you actually you know have a kitchen and</span> <span data-start="173.88" data-end="175.17">you have chefs knives and all of this</span> <span data-start="175.17" data-end="176.88">stuff you know that people intuitively</span> <span data-start="176.88" data-end="180.18">get event-driven right you sit in your</span> <span data-start="180.18" data-end="181.86">cooking and your chopping something and</span> <span data-start="181.86" data-end="185.19">a pot starts boiling over you know you</span> <span data-start="185.19" data-end="187.29">know finish chopping you stop and you</span> <span data-start="187.29" data-end="189.6">deal with the pot and you turn the heat</span> <span data-start="189.6" data-end="192.3">down and and you know you're used to</span> <span data-start="192.3" data-end="196.32">that that idea that simultaneous things</span> <span data-start="196.32" data-end="199.47">happen and we can deal with that and yet</span> <span data-start="199.47" data-end="202.709">where did this fallacy come from that</span> <span data-start="202.709" data-end="205.92">our programmers can't think you know in</span> <span data-start="205.92" data-end="208.8">multiple multiple things they can only</span> <span data-start="208.8" data-end="211.8">think in the single you know you do this</span> <span data-start="211.8" data-end="213.33">then you do this then you do this then</span> <span data-start="213.33" data-end="215.489">you do this then you do this in our</span> <span data-start="215.489" data-end="217.56">everyday lives we're constantly</span> <span data-start="217.56" data-end="219.69">interrupted with things and we deal with</span> <span data-start="219.69" data-end="221.73">them and then we carry on and we do</span> <span data-start="221.73" data-end="224.28">something else this is this is just a</span> <span data-start="224.28" data-end="226.23">normal human behavior and it's something</span> <span data-start="226.23" data-end="229.08">you intuitively get so how do we get to</span> <span data-start="229.08" data-end="232.2">a place where we're trying to write code</span> <span data-start="232.2" data-end="233.959">and we don't understand what we're doing</span> <span data-start="233.959" data-end="237.45">so here's his made second increasingly</span> <span data-start="237.45" data-end="241.16">bad metaphor and the event loop postman</span> <span data-start="241.16" data-end="244.47">right this is kind of silly but this is</span> <span data-start="244.47" data-end="246.69">the event loop postman he's a happy</span> <span data-start="246.69" data-end="249.45">postman he's delivering lattice and his</span> <span data-start="249.45" data-end="251.97">letters are the event stack so he's got</span> <span data-start="251.97" data-end="254.489">his stack of letters he takes a letter</span> <span data-start="254.489" data-end="256.769">one at a time and he walks to the house</span> <span data-start="256.769" data-end="262.169">right his route the sort of red squiggly</span> <span data-start="262.169" data-end="265.47">lines or the callbacks I've got a letter</span> <span data-start="265.47" data-end="267.99">and I walked through my callback did he</span> <span data-start="267.99" data-end="271.8">do and I deliver the thing and that's</span> <span data-start="271.8" data-end="273.52">the end of the call back and I'm done</span> </p>
<p><span data-start="273.52" data-end="275.139">I then go and get the next letter when I</span> <span data-start="275.139" data-end="277.96">walk and deliver it you know obviously</span> <span data-start="277.96" data-end="279.52">he's not a very good post when he can</span> <span data-start="279.52" data-end="281.44">only carry one thing at a time but you</span> <span data-start="281.44" data-end="283.78">know Arian I did explain they were a bad</span> <span data-start="283.78" data-end="288.25">metaphors right so this is this is you</span> <span data-start="288.25" data-end="292.09">know this really interesting thing that</span> <span data-start="292.09" data-end="295.36">we're using but the problem is for a</span> <span data-start="295.36" data-end="298.99">poor postman I'm a real bastard and I</span> <span data-start="298.99" data-end="301.659">have a gate so the postman walks up and</span> <span data-start="301.659" data-end="302.83">he's like great i'm going to dealer the</span> <span data-start="302.83" data-end="305.5">letter oh there's a gate and he walks</span> <span data-start="305.5" data-end="309.699">around and it's like oh there's gate and</span> <span data-start="309.699" data-end="312.94">he walked around ki guess oh there's a</span> <span data-start="312.94" data-end="317.199">gate so our postman is stuck in this</span> <span data-start="317.199" data-end="319.27">situation where the only thing that he</span> <span data-start="319.27" data-end="321.849">knows how to do is deliver his event and</span> <span data-start="321.849" data-end="325.09">he's trying to do that but the gates not</span> <span data-start="325.09" data-end="327.699">open and you say well okay to vent</span> <span data-start="327.699" data-end="330.43">driven what if we have something that's</span> <span data-start="330.43" data-end="332.02">going to open that gate and it's waiting</span> <span data-start="332.02" data-end="334.21">on the stack it's it's another event and</span> <span data-start="334.21" data-end="337.06">we're okay because it's gonna fix it for</span> <span data-start="337.06" data-end="338.83">the postman well the problem is is the</span> <span data-start="338.83" data-end="340.479">postman's never going to deliver the</span> <span data-start="340.479" data-end="343.09">letter that opens the gate because he's</span> <span data-start="343.09" data-end="345.969">stuck trying to deliver the data that</span> <span data-start="345.969" data-end="351.46">requires the gate to be over ow so this</span> <span data-start="351.46" data-end="354.009">is this is what's really weird and</span> <span data-start="354.009" data-end="356.68">interesting about the event loop and I</span> <span data-start="356.68" data-end="357.969">think this is one of the things that I</span> <span data-start="357.969" data-end="363.06">really wanted to communicate is that</span> <span data-start="363.06" data-end="366.099">things only happen one at a time you</span> <span data-start="366.099" data-end="368.68">have to finish a call back before you</span> <span data-start="368.68" data-end="370.96">can actually continue and start getting</span> <span data-start="370.96" data-end="372.819">events i'm going to show some code in a</span> <span data-start="372.819" data-end="375.909">minute but the this is a really</span> <span data-start="375.909" data-end="378.279">interesting problem about how do we how</span> <span data-start="378.279" data-end="381.069">do we this do these things notice</span> <span data-start="381.069" data-end="383.169">incredibly fast it's incredibly scalable</span> <span data-start="383.169" data-end="385.3">you can have thousands of connections at</span> <span data-start="385.3" data-end="388.3">once but all of that relies on having an</span> <span data-start="388.3" data-end="390.789">event loop that's working all of that</span> <span data-start="390.789" data-end="393.46">relies on the fact that that each of the</span> <span data-start="393.46" data-end="396.219">events happen very fast and then they go</span> <span data-start="396.219" data-end="400.18">away so we can take away things we can</span> <span data-start="400.18" data-end="403.839">use not go to the file system there's a</span> <span data-start="403.839" data-end="405.969">separate process it's non blocking you</span> <span data-start="405.969" data-end="406.81">get the call back</span> <span data-start="406.81" data-end="407.88">so you don't have to deal with that</span> <span data-start="407.88" data-end="410.47">great you know if you want to read from</span> <span data-start="410.47" data-end="412.27">a database if you want to do something</span> <span data-start="412.27" data-end="414.58">over the network all of these things are</span> <span data-start="414.58" data-end="416.11">non blocking you you don't have to deal</span> <span data-start="416.11" data-end="418.06">with that but you can still block your</span> <span data-start="418.06" data-end="420.34">own event stack and until you really</span> <span data-start="420.34" data-end="422.53">understand the fact that you have to</span> <span data-start="422.53" data-end="426.76">finish execution then you're going to be</span> <span data-start="426.76" data-end="431.56">in trouble so this is a piece of code</span> <span data-start="431.56" data-end="433.87">that will tie up the node event loop</span> <span data-start="433.87" data-end="435.97">forever and it's and it's really simply</span> <span data-start="435.97" data-end="437.77">obvious how it works but what we're</span> <span data-start="437.77" data-end="439.21">going to do is we're going to include</span> <span data-start="439.21" data-end="440.919">the event emitter so we've included</span> <span data-start="440.919" data-end="444.4">nodes event system we've created a new</span> <span data-start="444.4" data-end="447.94">event emitter I've created a simple</span> <span data-start="447.94" data-end="451.99">variable die and then we have a function</span> <span data-start="451.99" data-end="458.7">so we want to omit on the die event</span> <span data-start="458.7" data-end="461.83">we're just going to set data true right</span> <span data-start="461.83" data-end="463.78">and we're going to set a time out and</span> <span data-start="463.78" data-end="467.43">the timeout emits that event so after</span> <span data-start="467.43" data-end="470.82">100 milliseconds not very long really</span> <span data-start="470.82" data-end="473.26">we're going to omit the event die and</span> <span data-start="473.26" data-end="475.36">then we have a while loop so while not</span> <span data-start="475.36" data-end="478.69">equals die loop and then finally console</span> <span data-start="478.69" data-end="483.039">dot log done if you run this code node</span> <span data-start="483.039" data-end="486.3">will just run until the stack crashes</span> <span data-start="486.3" data-end="490.81">because it sits there and set timeout in</span> <span data-start="490.81" data-end="492.97">order to fire that event will never</span> <span data-start="492.97" data-end="495.85">happen because it's stuck in a loop it's</span> <span data-start="495.85" data-end="498.94">it's and more than that so this is this</span> <span data-start="498.94" data-end="501.639">is fits on a side really well but if you</span> <span data-start="501.639" data-end="504.46">start having other things the that our</span> <span data-start="504.46" data-end="507.25">event driven and you're expecting those</span> <span data-start="507.25" data-end="510.46">events the fire that would you know make</span> <span data-start="510.46" data-end="513.209">this loop quit they will never fire</span> <span data-start="513.209" data-end="516.219">because the loops busy doing stuff the</span> <span data-start="516.219" data-end="518.8">postman's walking down his path and he's</span> <span data-start="518.8" data-end="520.51">walking down his path and he's walking</span> <span data-start="520.51" data-end="522.849">down his path and your event is never</span> <span data-start="522.849" data-end="524.169">going to fire until he's finished</span> <span data-start="524.169" data-end="526.36">walking down this path and that's a</span> <span data-start="526.36" data-end="529">really significant piece of information</span> <span data-start="529" data-end="532.36">because if you write code that box</span> <span data-start="532.36" data-end="534.25">yourself nobody else is going to help</span> <span data-start="534.25" data-end="535.56">you now</span> <span data-start="535.56" data-end="537.779">this is kind of facetious right nobody's</span> <span data-start="537.779" data-end="539.52">really going to you know having like big</span> <span data-start="539.52" data-end="541.89">while loops encode that rely on events</span> <span data-start="541.89" data-end="543.93">to fix them is kind of it's a strange</span> <span data-start="543.93" data-end="546">use case but it's completely possible</span> <span data-start="546" data-end="548.16">for you to write extremely long running</span> <span data-start="548.16" data-end="551.34">code that maybe won't block your event</span> <span data-start="551.34" data-end="553.14">loop forever but it will block your</span> <span data-start="553.14" data-end="556.44">event loop for long enough that it will</span> <span data-start="556.44" data-end="559.47">cause you some pain and one thing I</span> <span data-start="559.47" data-end="561.06">would mention is that things like so</span> <span data-start="561.06" data-end="564.39">things like TCP connections when you get</span> <span data-start="564.39" data-end="566.46">a new TCP connection to node that's a</span> <span data-start="566.46" data-end="568.43">separate process is handled by the</span> <span data-start="568.43" data-end="571.29">colonel the colonel will stack up the</span> </p>
<p><span data-start="571.29" data-end="573.75">TCP requests so no it's not going to</span> <span data-start="573.75" data-end="575.4">randomly drop them because you've been</span> <span data-start="575.4" data-end="578.15">busy you know for 100 milliseconds or a</span> <span data-start="578.15" data-end="580.41">thousand or whatever it's going to stack</span> <span data-start="580.41" data-end="581.73">up in the kernel and you can still</span> <span data-start="581.73" data-end="584.07">accept them but if you tie yourself up</span> <span data-start="584.07" data-end="588.56">that's a problem unicorn break yeah</span> <span data-start="588.56" data-end="591.27">unicorns crack rainbows it's on my</span> <span data-start="591.27" data-end="594.05">t-shirt must be true I just wanted to</span> <span data-start="594.05" data-end="596.94">inject we haven't had any intercont in</span> <span data-start="596.94" data-end="599.49">the conference or hardly any so it's not</span> <span data-start="599.49" data-end="604.58">jazz comp velasquez unicorns no waiver</span> <span data-start="604.58" data-end="613.38">fais pas yeah so how what we doing with</span> <span data-start="613.38" data-end="615.42">this stuff what we actually building</span> <span data-start="615.42" data-end="617.16">with node and what the patterns that we</span> <span data-start="617.16" data-end="619.2">can sort of use by really knowing how</span> <span data-start="619.2" data-end="620.88">the event loop works what are the things</span> <span data-start="620.88" data-end="623.07">that we can do to make this useful and</span> <span data-start="623.07" data-end="625.47">to not write things that hurt us so the</span> <span data-start="625.47" data-end="627.42">the kind of cases the common cases that</span> <span data-start="627.42" data-end="630.3">people have web servers come command</span> <span data-start="630.3" data-end="632.91">line stuff and then maybe peer-to-peer</span> <span data-start="632.91" data-end="636.78">so like these are the kind of cases it's</span> <span data-start="636.78" data-end="639.51">actually web servers I personally have</span> <span data-start="639.51" data-end="641.58">written a DNS server it's not great it's</span> <span data-start="641.58" data-end="642.99">going to get better hopefully in the</span> <span data-start="642.99" data-end="645.15">future but we have a dns server written</span> <span data-start="645.15" data-end="647.22">a note it's kind of scary and wrong</span> <span data-start="647.22" data-end="650.15">really too bright dns and javascript but</span> <span data-start="650.15" data-end="652.65">scary and wrong things are kind of hot</span> <span data-start="652.65" data-end="658.62">aren't they no so you know it's any sort</span> <span data-start="658.62" data-end="661.709">of server that has you know some kind of</span> <span data-start="661.709" data-end="665.85">client response model and these for me I</span> <span data-start="665.85" data-end="667.98">like the three more or less than three</span> <span data-start="667.98" data-end="668.27">kind</span> <span data-start="668.27" data-end="673.52">of actual writing so the the CLI pipes</span> <span data-start="673.52" data-end="676.22">this is this is really simple this is a</span> <span data-start="676.22" data-end="677.81">use case that we can more or less throw</span> <span data-start="677.81" data-end="679.58">away because if you're writing stuff for</span> <span data-start="679.58" data-end="682.19">the command line it's pipe n pipe out</span> <span data-start="682.19" data-end="684.26">right you have something that's standard</span> <span data-start="684.26" data-end="686.63">ieee standard in and then stand it out</span> <span data-start="686.63" data-end="687.8">it doesn't have to be asynchronous</span> <span data-start="687.8" data-end="690.05">because the command line is never going</span> <span data-start="690.05" data-end="692.45">to treat it asynchronously anyway so who</span> <span data-start="692.45" data-end="694.58">cares this is not a case that I really</span> <span data-start="694.58" data-end="696.44">care about it's not it's not interesting</span> <span data-start="696.44" data-end="699.92">you won't get tied up writing node code</span> <span data-start="699.92" data-end="702.91">you won't get confused writing code for</span> <span data-start="702.91" data-end="705.53">the command line stuff because it's just</span> <span data-start="705.53" data-end="708.53">in and then straight at the cases where</span> <span data-start="708.53" data-end="710.63">it's more interesting at these ones so</span> <span data-start="710.63" data-end="713.81">if you look at this stuff essentially we</span> <span data-start="713.81" data-end="715.79">have two cases we have things with</span> <span data-start="715.79" data-end="719.06">streams such as TCP you know and there's</span> <span data-start="719.06" data-end="721.06">lots of things but things like PTP</span> <span data-start="721.06" data-end="725.18">anything were it's not discreet</span> <span data-start="725.18" data-end="726.53">connections and then we have this</span> <span data-start="726.53" data-end="728.93">discreet stuff so I receive an HTTP</span> <span data-start="728.93" data-end="731.18">request and they send it responds I</span> <span data-start="731.18" data-end="733.82">receive a UDP request I send a response</span> <span data-start="733.82" data-end="737">right and the fact that these things go</span> <span data-start="737" data-end="740.6">over HTTP over TCP as a protocol doesn't</span> <span data-start="740.6" data-end="742.55">really matter what the server is doing</span> <span data-start="742.55" data-end="744.53">is the street requests and this is</span> <span data-start="744.53" data-end="746.6">actually our biggest use case so I have</span> <span data-start="746.6" data-end="748.64">a request and they give a response its</span> <span data-start="748.64" data-end="751.34">request driven you know our server</span> <span data-start="751.34" data-end="753.23">receive something and it's expected to</span> <span data-start="753.23" data-end="754.85">give something back so how do we</span> <span data-start="754.85" data-end="758.06">architect that in a way that that work</span> <span data-start="758.06" data-end="761.18">so his some code hands up people that</span> <span data-start="761.18" data-end="763.82">have used this code or run it yeah this</span> <span data-start="763.82" data-end="765.11">is the code from the front of the</span> <span data-start="765.11" data-end="769.46">node.js page so what I can't it like six</span> <span data-start="769.46" data-end="772.88">hands six people have run node really</span> <span data-start="772.88" data-end="774.14">come on hands up people that have really</span> <span data-start="774.14" data-end="776.48">done this thank you right so you've all</span> <span data-start="776.48" data-end="778.67">run this code so this is this is sort of</span> <span data-start="778.67" data-end="781.46">the one on one example and what we</span> <span data-start="781.46" data-end="783.32">actually doing with it well we're</span> <span data-start="783.32" data-end="785.72">getting a request and we fire a callback</span> <span data-start="785.72" data-end="788.81">and that callback is an anonymous</span> <span data-start="788.81" data-end="791.81">function right it were just you know</span> <span data-start="791.81" data-end="794.96">doing a really simple example but the</span> <span data-start="794.96" data-end="797.66">problem is that people start to do this</span> <span data-start="797.66" data-end="799.31">and you know judge right i call this</span> <span data-start="799.31" data-end="799.82">pyramid</span> <span data-start="799.82" data-end="801.74">but it basically it looks like that and</span> </p>
<p><span data-start="801.74" data-end="803.09">I think actually Tim probably coined</span> <span data-start="803.09" data-end="806.81">that yeah you know but you end up you</span> <span data-start="806.81" data-end="807.8">have like all of these anonymous</span> <span data-start="807.8" data-end="810.32">callbacks that nest together and you end</span> <span data-start="810.32" data-end="812.39">up with this giant pyramid of code that</span> <span data-start="812.39" data-end="814.31">just sticks out at a weird angle and</span> <span data-start="814.31" data-end="817.85">it's really ugly it really there</span> <span data-start="817.85" data-end="819.77">and it and it's hard to maintain you</span> <span data-start="819.77" data-end="822.44">can't read it and you know you create</span> <span data-start="822.44" data-end="823.82">all kinds of race conditions in your</span> <span data-start="823.82" data-end="827.39">like why does my brain hurt so my</span> <span data-start="827.39" data-end="830.27">suggestion to you is that if you have</span> <span data-start="830.27" data-end="832.58">this model this is a pattern this is a</span> <span data-start="832.58" data-end="836.27">really simple pattern have a server the</span> <span data-start="836.27" data-end="838.04">server has a prototype this is a pattern</span> <span data-start="838.04" data-end="840.71">that Ryan users for HTTP it's a pattern</span> <span data-start="840.71" data-end="842.72">that Tim users for connect lots of</span> <span data-start="842.72" data-end="846.11">people use it but inside that have a</span> <span data-start="846.11" data-end="848.9">request object have an object that just</span> <span data-start="848.9" data-end="851.18">has a new requests and just make these</span> <span data-start="851.18" data-end="853.16">all into factory methods so we have a</span> <span data-start="853.16" data-end="855.2">server so this could be HTTP I've used</span> <span data-start="855.2" data-end="858.56">capital uppercase server because it's a</span> <span data-start="858.56" data-end="861.17">class crate server its factory method</span> <span data-start="861.17" data-end="863.84">gives us a new server and then we pass</span> <span data-start="863.84" data-end="867.7">to that a callback server crate request</span> <span data-start="867.7" data-end="870.2">and then we give it the request</span> <span data-start="870.2" data-end="872.66">restaurant so we create a new request</span> <span data-start="872.66" data-end="874.64">whenever there's a connection and we</span> <span data-start="874.64" data-end="876.35">encapsulate everything in that request</span> <span data-start="876.35" data-end="878.6">object but here's what's different it's</span> <span data-start="878.6" data-end="881.03">not an anonymous call back it's a</span> <span data-start="881.03" data-end="884">specific named object that lives within</span> <span data-start="884" data-end="885.98">our server but it lives within the</span> <span data-start="885.98" data-end="888.32">instance of that specific server but</span> <span data-start="888.32" data-end="889.97">more than that is because we've nested</span> <span data-start="889.97" data-end="892.31">it this way is we can decorate all of</span> <span data-start="892.31" data-end="894.02">the functions into one beautiful</span> <span data-start="894.02" data-end="896.21">encapsulated object and then you can</span> <span data-start="896.21" data-end="897.98">start to map them in you and all of that</span> <span data-start="897.98" data-end="899.84">everything belongs in its right place</span> <span data-start="899.84" data-end="902.48">all of the requests associated with a</span> <span data-start="902.48" data-end="905.18">specific server belong to that server</span> <span data-start="905.18" data-end="907.55">but it means that you can create six of</span> <span data-start="907.55" data-end="910.55">those servers and everything sharing its</span> <span data-start="910.55" data-end="913.13">methods really nicely and it's easy to</span> <span data-start="913.13" data-end="914.27">understand so then you can draw a</span> <span data-start="914.27" data-end="916.19">diagram like this so for the DNS server</span> <span data-start="916.19" data-end="918.5">this is more or less what it does take</span> <span data-start="918.5" data-end="920.9">to request it passes the request it</span> <span data-start="920.9" data-end="923.62">iterates through resolve and then it</span> <span data-start="923.62" data-end="926.45">responds and this is the point is once</span> <span data-start="926.45" data-end="928.61">you can start naming what you're doing</span> <span data-start="928.61" data-end="929.87">instead of having all of these crazy</span> <span data-start="929.87" data-end="931.7">anonymous call backs you can actually</span> <span data-start="931.7" data-end="932.4">start</span> <span data-start="932.4" data-end="934.38">a really simple diagram does anybody can</span> <span data-start="934.38" data-end="936.3">anybody not does anybody look at that</span> <span data-start="936.3" data-end="938.16">and not have a good guess of what the</span> </p>
<p><span data-start="938.16" data-end="943.11">DNS server does know so this is really</span> <span data-start="943.11" data-end="945.36">simple and easy to understand but if you</span> <span data-start="945.36" data-end="946.92">don't name your functions if you just</span> <span data-start="946.92" data-end="948.63">have all this anonymous stuff that's</span> <span data-start="948.63" data-end="950.61">layering on top of each other it gets</span> <span data-start="950.61" data-end="952.89">really hard to do and all of these are</span> <span data-start="952.89" data-end="954.75">just call backs all of these are we emit</span> <span data-start="954.75" data-end="957.99">an event and I just attach them back to</span> <span data-start="957.99" data-end="960.83">back it's really easy to understand um</span> <span data-start="960.83" data-end="965.4">so the second case is streams and helmet</span> <span data-start="965.4" data-end="967.02">down for time where I think I'm going</span> <span data-start="967.02" data-end="970.71">really fast whoops so the second case is</span> <span data-start="970.71" data-end="974.64">streams and this is a slightly different</span> <span data-start="974.64" data-end="977.07">case so you have a socket of some kind</span> <span data-start="977.07" data-end="981.84">so probably TCP and you know you have</span> <span data-start="981.84" data-end="984.66">events that come off the socket so its</span> <span data-start="984.66" data-end="986.82">socket driven it's doing stuff you know</span> <span data-start="986.82" data-end="990.57">here's some data or you get external</span> <span data-start="990.57" data-end="991.86">events which you then push up through</span> <span data-start="991.86" data-end="994.08">the socket what's easy about this this</span> <span data-start="994.08" data-end="997.83">is this is a similar but but different</span> <span data-start="997.83" data-end="999.8">problem there's nothing to encapsulate</span> <span data-start="999.8" data-end="1003.08">the socket owns itself and everything</span> <span data-start="1003.08" data-end="1006.08">that are event-driven outside the socket</span> <span data-start="1006.08" data-end="1008.45">maybe it's a filehandle you know it can</span> <span data-start="1008.45" data-end="1010.13">call the socket but you don't actually</span> <span data-start="1010.13" data-end="1011.78">need to encapsulate anything there's no</span> <span data-start="1011.78" data-end="1015.58">state it's not like it's it's not like</span> <span data-start="1015.58" data-end="1018.11">where's my side it's not like this</span> <span data-start="1018.11" data-end="1021.41">you're not having to run on that one</span> <span data-start="1021.41" data-end="1023.36">you're not having to encapsulate these</span> <span data-start="1023.36" data-end="1025.64">requests and save them you're simply</span> <span data-start="1025.64" data-end="1029.57">responding to events as they come so it</span> <span data-start="1029.57" data-end="1031.37">turns out that there's only one real</span> <span data-start="1031.37" data-end="1033.41">case where people are getting horribly</span> <span data-start="1033.41" data-end="1036.709">tied up and that's the case of dealing</span> <span data-start="1036.709" data-end="1038.36">with these and it's actually the most</span> <span data-start="1038.36" data-end="1040.04">popular case right I mean hands up</span> <span data-start="1040.04" data-end="1041.87">people that are planning to write paid</span> <span data-start="1041.87" data-end="1043.67">to piss drinking servers with mode right</span> <span data-start="1043.67" data-end="1046.85">now that guy yawn and Tim three people</span> <span data-start="1046.85" data-end="1049.4">so it's you know the most common use</span> <span data-start="1049.4" data-end="1051.65">case that people have is some kind of</span> <span data-start="1051.65" data-end="1053.99">request response and that's the one that</span> <span data-start="1053.99" data-end="1055.49">we need to focus on so I think that this</span> <span data-start="1055.49" data-end="1058.01">is actually an easy problem so</span> <span data-start="1058.01" data-end="1059.42">apparently I went incredibly first and</span> <span data-start="1059.42" data-end="1061.94">did it in 20 minutes but my summer is</span> <span data-start="1061.94" data-end="1064.34">this so don't talked about iteration</span> <span data-start="1064.34" data-end="1065.65">which I look that up on</span> <span data-start="1065.65" data-end="1068.41">kapiti i think you made that up wait</span> <span data-start="1068.41" data-end="1070.86">wait don't where do you find that from</span> <span data-start="1070.86" data-end="1074.53">he made out he did make it up something</span> <span data-start="1074.53" data-end="1075.64">if somebody else you'd gone create a</span> </p>
<p><span data-start="1075.64" data-end="1078.55">Wikipedia article for a now but don't</span> <span data-start="1078.55" data-end="1080.29">block the event loop this is this is</span> <span data-start="1080.29" data-end="1081.76">really critical if you block the event</span> <span data-start="1081.76" data-end="1084.97">loop everything will fail and until you</span> <span data-start="1084.97" data-end="1087.13">you know understand the fact that all of</span> <span data-start="1087.13" data-end="1088.99">all of the event loop has to finish</span> <span data-start="1088.99" data-end="1091.9">executing what it's executing that's</span> <span data-start="1091.9" data-end="1093.91">that's really critical and the next</span> <span data-start="1093.91" data-end="1096.64">thing is encapsulate so stay save the</span> <span data-start="1096.64" data-end="1099.07">the data that you want in a closure so</span> <span data-start="1099.07" data-end="1103.96">encapsulate all of that stuff down and</span> <span data-start="1103.96" data-end="1107.22">use name functions so start creating</span> <span data-start="1107.22" data-end="1109.87">request objects within your server</span> <span data-start="1109.87" data-end="1112.03">objects and decorate them decorate all</span> <span data-start="1112.03" data-end="1116.23">of them with with the kinds of state</span> <span data-start="1116.23" data-end="1117.64">that you want and why this is really</span> <span data-start="1117.64" data-end="1120.25">interesting for me is if you start to</span> <span data-start="1120.25" data-end="1122.5">think about not blocking the the event</span> <span data-start="1122.5" data-end="1124.15">loop if you start to think about the</span> <span data-start="1124.15" data-end="1125.83">fact that we have shared memory if you</span> <span data-start="1125.83" data-end="1129.16">can trace and draw the the outline of</span> <span data-start="1129.16" data-end="1130.9">your call backs then you can start to</span> <span data-start="1130.9" data-end="1133.12">remove pieces of memory that you no</span> <span data-start="1133.12" data-end="1135.13">longer need you can say I don't actually</span> <span data-start="1135.13" data-end="1137.11">need this part of the state at this part</span> <span data-start="1137.11" data-end="1139">of the request process I can throw it</span> <span data-start="1139" data-end="1140.65">away and now I can handle more</span> <span data-start="1140.65" data-end="1142.66">connections because my server has more</span> <span data-start="1142.66" data-end="1144.07">memory available and I can start</span> <span data-start="1144.07" data-end="1146.5">clearing that stuff off and having it</span> <span data-start="1146.5" data-end="1148.12">garbage collected and I don't have to</span> <span data-start="1148.12" data-end="1151.03">wait for the entire for the entire</span> <span data-start="1151.03" data-end="1155.14">closure to be closed so use name</span> <span data-start="1155.14" data-end="1156.97">functions and use factories factories</span> <span data-start="1156.97" data-end="1159.58">are great and then document your flow</span> <span data-start="1159.58" data-end="1161.29">callbacks this is something I've not</span> <span data-start="1161.29" data-end="1165.07">seen anybody do right we sort of we're</span> <span data-start="1165.07" data-end="1167.02">building all of these servers where's</span> <span data-start="1167.02" data-end="1169.06">the documentation where do people draw</span> <span data-start="1169.06" data-end="1171.25">this cause this and then this calls this</span> <span data-start="1171.25" data-end="1172.6">and then this cause this this is</span> <span data-start="1172.6" data-end="1174.01">something as a community we're not doing</span> <span data-start="1174.01" data-end="1177.43">and it's it's really hard to follow Ryan</span> <span data-start="1177.43" data-end="1179.11">was talking about how do we debunk the</span> <span data-start="1179.11" data-end="1181.93">stack you know and one of the problems</span> <span data-start="1181.93" data-end="1183.7">of you have is that we lose context</span> <span data-start="1183.7" data-end="1186.73">right well it's easy to know context if</span> <span data-start="1186.73" data-end="1189.64">you've explicitly written it down but if</span> <span data-start="1189.64" data-end="1191.08">you if you're calling everything through</span> <span data-start="1191.08" data-end="1193">anonymous functions it's really hard to</span> <span data-start="1193" data-end="1194.44">write down what's calling what which</span> <span data-start="1194.44" data-end="1196.54">comes back to using name functions so</span> <span data-start="1196.54" data-end="1198.67">that was really quick i guess i'm going</span> <span data-start="1198.67" data-end="1199.1">to take</span> <span data-start="1199.1" data-end="1203.6">lessons hopefully it was useful to</span> <span data-start="1203.6" data-end="1211.01">people questions Brian where was i five</span> <span data-start="1211.01" data-end="1216.71">this morning swing dancing so to some</span> <span data-start="1216.71" data-end="1219.59">weird music edgy that place played yeah</span> <span data-start="1219.59" data-end="1224.57">any questions about JavaScript all my</span> <span data-start="1224.57" data-end="1227.84">social life i guess that's fine too they</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
