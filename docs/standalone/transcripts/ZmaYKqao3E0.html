<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ZmaYKqao3E0</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/ZmaYKqao3E0?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0" data-end="2.61">again hi my name is Andy I'm going to</span> <span data-start="2.61" data-end="5.609">talk to you about happy plugins so this</span> <span data-start="5.609" data-end="9.54">is me by the way I'm not related to the</span> <span data-start="9.54" data-end="11.4">royal family even though I am British</span> <span data-start="11.4" data-end="15.21">look at the name spellings different Who</span> <span data-start="15.21" data-end="17.609">am I I'm an engineer are and i work for</span> <span data-start="17.609" data-end="21.119">open table in the UK if you don't know</span> <span data-start="21.119" data-end="23.43">it in table our businesses restaurant</span> <span data-start="23.43" data-end="27.48">reservations our stack is mainly c-sharp</span> <span data-start="27.48" data-end="30.599">a node with Java a little bit of like go</span> <span data-start="30.599" data-end="32.399">and Ruby and closure and all that stuff</span> <span data-start="32.399" data-end="36.6">thrown in so a real mixed bag we've been</span> <span data-start="36.6" data-end="39.18">using happy for about what in our team</span> <span data-start="39.18" data-end="40.41">we've been using happy for about 12</span> <span data-start="40.41" data-end="43.05">months now I first heard about happy a</span> <span data-start="43.05" data-end="46.649">node user group meetup and then I was</span> <span data-start="46.649" data-end="49.2">given the opportunity to rewrite a an</span> <span data-start="49.2" data-end="53.879">awful dotnet legacy system and I was</span> <span data-start="53.879" data-end="56.309">like great let's use happy and we've</span> <span data-start="56.309" data-end="58.89">been using it ever since so we've got</span> <span data-start="58.89" data-end="64.17">but maybe a dozen api's now of varying</span> <span data-start="64.17" data-end="67.26">sizes and complexities usually it's all</span> <span data-start="67.26" data-end="69.81">internal api's there are a couple of</span> <span data-start="69.81" data-end="73.2">internal tools which internal websites</span> <span data-start="73.2" data-end="77.46">but our main business is AP is our stack</span> <span data-start="77.46" data-end="80.78">is happy running on ubuntu with a</span> </p>
<p><span data-start="80.78" data-end="83.25">MongoDB back-end and some Redis thrown</span> <span data-start="83.25" data-end="88.5">in there for good measure so as we've</span> <span data-start="88.5" data-end="90.9">learned happy and as we've learned as</span> <span data-start="90.9" data-end="93.869">we've grown our kind of happy stack we</span> <span data-start="93.869" data-end="96.75">start to coalesce shared code using the</span> <span data-start="96.75" data-end="101.31">plugins interface so I'm not going to</span> <span data-start="101.31" data-end="103.38">stand here and read you the docs because</span> <span data-start="103.38" data-end="106.29">that we really dull but they're going to</span> <span data-start="106.29" data-end="108.479">have a look what I'm going to do is just</span> <span data-start="108.479" data-end="110.88">show you some of the really simple stuff</span> <span data-start="110.88" data-end="112.5">that we've done that makes our lives</span> <span data-start="112.5" data-end="117.53">easier so the first plug-in I wrote was</span> <span data-start="117.53" data-end="120.509">pretty simple all it does is you point</span> <span data-start="120.509" data-end="123.39">at a directory it walks the directory</span> <span data-start="123.39" data-end="125.52">and says is there something in there</span> <span data-start="125.52" data-end="127.649">that looks like a routes file if so call</span> <span data-start="127.649" data-end="130.47">severed uproot on it basically was to</span> <span data-start="130.47" data-end="132.48">get rid of the boilerplate of calling</span> <span data-start="132.48" data-end="135.26">server da trute everywhere</span> <span data-start="135.26" data-end="138.81">the of the the main part parts of this</span> <span data-start="138.81" data-end="139.98">plug-in you've probably seen this</span> <span data-start="139.98" data-end="143.19">already a couple of times today but the</span> <span data-start="143.19" data-end="144.81">register function which takes the server</span> <span data-start="144.81" data-end="148.74">options and next call back so the key</span> <span data-start="148.74" data-end="150.69">bit there is the server so that server</span> <span data-start="150.69" data-end="153">object is exactly the same server object</span> <span data-start="153" data-end="155.37">that you get when you do new happy dot</span> <span data-start="155.37" data-end="157.29">server which means anything that you're</span> <span data-start="157.29" data-end="160.14">doing in your application code you can</span> <span data-start="160.14" data-end="162.6">wrap it in a plug-in and that's really</span> <span data-start="162.6" data-end="165.18">really powerful frankly it beats the</span> <span data-start="165.18" data-end="168.51">hell out of a pues so yeah the</span> <span data-start="168.51" data-end="170.28">registration code for registering a</span> <span data-start="170.28" data-end="172.92">plug-in you call server register you</span> <span data-start="172.92" data-end="174.93">give it a list of plugins each plug-in</span> <span data-start="174.93" data-end="179.82">has its own little options object and</span> <span data-start="179.82" data-end="181.53">then at the end you get a nice callback</span> <span data-start="181.53" data-end="183.84">that says if everything is good start</span> <span data-start="183.84" data-end="189.15">the server yeah so another one of the</span> <span data-start="189.15" data-end="191.52">plugins that we wrote was for versioning</span> <span data-start="191.52" data-end="193.26">now everybody you talk to has a</span> <span data-start="193.26" data-end="195.38">different attitude on versioning</span> <span data-start="195.38" data-end="198.03">internally opentable we have a</span> <span data-start="198.03" data-end="200.82">convention of using URL version which i</span> <span data-start="200.82" data-end="204">think is a bit icky but I wanted to</span> <span data-start="204" data-end="206.94">support head of versioning as well so</span> <span data-start="206.94" data-end="209.28">you create the little plugin that can</span> <span data-start="209.28" data-end="212.31">monkey with the request and say well if</span> <span data-start="212.31" data-end="215.269">it's if it looks like a URL versioned</span> </p>
<p><span data-start="215.269" data-end="219.87">URL then grab the version out of it and</span> <span data-start="219.87" data-end="225.39">you set the request prerequisite with</span> <span data-start="225.39" data-end="229.709">the with the data with the version this</span> <span data-start="229.709" data-end="233.76">code uses the on pre handler extension</span> <span data-start="233.76" data-end="237.68">point which is the interesting bit the</span> <span data-start="237.68" data-end="239.79">extension point there are six of them</span> <span data-start="239.79" data-end="244.019">which cover the request lifecycle so</span> <span data-start="244.019" data-end="246.39">you've got on request is the first and</span> <span data-start="246.39" data-end="250.11">then on pre auth on post off on pre</span> <span data-start="250.11" data-end="253.2">handler on post handler and on pre</span> <span data-start="253.2" data-end="256.049">response so basically anything you want</span> <span data-start="256.049" data-end="258.299">to do during the recycle the life cycle</span> <span data-start="258.299" data-end="260.58">of the request you can hook into one of</span> <span data-start="260.58" data-end="263.76">these extension points and boom you've</span> <span data-start="263.76" data-end="266.48">got the request</span> <span data-start="266.49" data-end="272.43">if you're if you're not covering things</span> <span data-start="272.43" data-end="274.71">that happen in the life cycle there are</span> <span data-start="274.71" data-end="276.96">the server events as well so you've got</span> <span data-start="276.96" data-end="281.789">the error log so any time server log is</span> <span data-start="281.789" data-end="285.06">called far as an event any time server</span> <span data-start="285.06" data-end="288.36">the arrow is called far as an event and</span> <span data-start="288.36" data-end="290.4">you've got the other interesting ones</span> <span data-start="290.4" data-end="292.759">you've got requests obviously and tail</span> <span data-start="292.759" data-end="295.949">so if you don't know about tail it's</span> <span data-start="295.949" data-end="299.43">basically when the request is just about</span> <span data-start="299.43" data-end="302.46">done and the response has been sent then</span> <span data-start="302.46" data-end="306.27">the tail event is fired so that's kind</span> <span data-start="306.27" data-end="309.27">of the the last event in the life cycle</span> <span data-start="309.27" data-end="316.6">on laptops gone to sleep come on oh</span> <span data-start="316.61" data-end="320.639">right good smashing yeah sorry so tail</span> <span data-start="320.639" data-end="323.55">is the last event in the life cycle and</span> <span data-start="323.55" data-end="326.87">it's stuff like this that makes happy</span> <span data-start="326.87" data-end="329.909">really lend itself to the kind of the</span> <span data-start="329.909" data-end="332.4">node way that fred was talking about it</span> <span data-start="332.4" data-end="334.11">yesterday you have small modules which</span> <span data-start="334.11" data-end="338.82">do small things and it means that you</span> <span data-start="338.82" data-end="341.849">get the composability because you've got</span> <span data-start="341.849" data-end="344.94">a fully so you've got a full server</span> <span data-start="344.94" data-end="347.4">object here which means anything you</span> <span data-start="347.4" data-end="349.74">want to do you can do there's no there's</span> <span data-start="349.74" data-end="351.84">no monkeying about you have to do got it</span> <span data-start="351.84" data-end="357.659">all up front another classic example</span> <span data-start="357.659" data-end="360.74">we've got so we use naji us for alerting</span> <span data-start="360.74" data-end="364.169">and we have a convention of using a</span> <span data-start="364.169" data-end="368.069">service status endpoint so for our team</span> <span data-start="368.069" data-end="372.949">what we do is we have a monitor which</span> <span data-start="372.949" data-end="376.289">has a path on it so it says right I'm</span> <span data-start="376.289" data-end="380.43">going to hit / food / bar / 1 and time</span> <span data-start="380.43" data-end="382.919">the request so it does a server that</span> <span data-start="382.919" data-end="385.56">inject times it and then you wrap the</span> <span data-start="385.56" data-end="387.69">response so you can you can really</span> <span data-start="387.69" data-end="389.819">easily just pop it just makes setting up</span> <span data-start="389.819" data-end="392.699">the Minaj eos monitors a case of</span> <span data-start="392.699" data-end="395.969">configuration so that's the response you</span> <span data-start="395.969" data-end="398.76">get out of it you get the response code</span> <span data-start="398.76" data-end="399.99">the time it took</span> <span data-start="399.99" data-end="402.99">off at hit and status the status is</span> <span data-start="402.99" data-end="404.97">either okay or failed and you just point</span> <span data-start="404.97" data-end="409.25">nagi us at that and away you go and it's</span> <span data-start="409.25" data-end="413.61">the server don't inject is only part of</span> <span data-start="413.61" data-end="417">it but most of the stuff i'm showing</span> <span data-start="417" data-end="422.25">here is kind of boilerplate extensions i</span> <span data-start="422.25" data-end="424.76">mean we have similar stuff for</span> <span data-start="424.76" data-end="428.46">initializing database doing feature</span> <span data-start="428.46" data-end="434.76">toggling doing health and heartbeat and</span> <span data-start="434.76" data-end="437.4">all that sort of thing and you can take</span> <span data-start="437.4" data-end="439.02">this to the logical conclusion as well</span> <span data-start="439.02" data-end="440.91">which is that everything in your</span> <span data-start="440.91" data-end="443.97">application can be a plug-in we saw it</span> <span data-start="443.97" data-end="447.96">earlier with John where your application</span> <span data-start="447.96" data-end="449.52">code is wrapped in a plug-in which means</span> <span data-start="449.52" data-end="451.47">it's got a standard interface to the</span> <span data-start="451.47" data-end="453.84">rest of the world if you want a really</span> <span data-start="453.84" data-end="455.34">good example of this I would recommend</span> <span data-start="455.34" data-end="458.04">you go and look at the code for mpms new</span> <span data-start="458.04" data-end="460.35">website because it's awesome and</span> </p>
<p><span data-start="460.35" data-end="461.94">I've been geeking out about it for a</span> <span data-start="461.94" data-end="467.55">while now so conclusion plugins are</span> <span data-start="467.55" data-end="468.93">awesome if you're not wrapping your</span> <span data-start="468.93" data-end="470.85">stuff in plugins and you're making more</span> <span data-start="470.85" data-end="472.95">work for yourself in the future because</span> <span data-start="472.95" data-end="474.63">you have to write the glue code over and</span> <span data-start="474.63" data-end="477.3">over again whereas if you if you're</span> <span data-start="477.3" data-end="480.71">using plugins then it's a standard</span> <span data-start="480.71" data-end="482.64">interface to the rest of the your</span> <span data-start="482.64" data-end="485.06">application or the rest of the world I</span> <span data-start="485.06" data-end="487.62">hope this has been the</span> <span data-start="487.62" data-end="489.06">interesting I realized I was in the</span> <span data-start="489.06" data-end="490.77">after lunch spot so hopefully</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
