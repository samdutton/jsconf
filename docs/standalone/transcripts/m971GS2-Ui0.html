<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>m971GS2-Ui0</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/m971GS2-Ui0?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0" data-end="1.74">um today we're going to be talking about</span> <span data-start="1.74" data-end="4.17">a project I've been working on for about</span> <span data-start="4.17" data-end="7.919">six months in my free time it's been an</span> <span data-start="7.919" data-end="9.36">especially difficult project for me</span> <span data-start="9.36" data-end="11.13">because I don't have a computer science</span> <span data-start="11.13" data-end="13.889">background and it's kind of important</span> <span data-start="13.889" data-end="16.859">for this project because the goal is to</span> <span data-start="16.859" data-end="20.84">make updating filtered lists logarithmic</span> <span data-start="20.84" data-end="23.91">which could have the potential to</span> <span data-start="23.91" data-end="25.619">significantly speed up your applications</span> <span data-start="25.619" data-end="27.42">depending on how often you're filtering</span> <span data-start="27.42" data-end="32.46">lists right this is to do MBC I'm sure</span> <span data-start="32.46" data-end="36.66">lunch you recognize it so you know it's</span> <span data-start="36.66" data-end="38.39">the simplest app you could possibly</span> <span data-start="38.39" data-end="42.93">build right so we claim we're going to</span> <span data-start="42.93" data-end="45.059">make this app well not this app but</span> <span data-start="45.059" data-end="47.219">we're going to make the most commonly</span> <span data-start="47.219" data-end="49.739">used utility in this app and the most</span> <span data-start="49.739" data-end="51.629">commonly implemented feature across a</span> <span data-start="51.629" data-end="54.329">wide range of apps something that's so</span> <span data-start="54.329" data-end="57.469">common it's even in the to do MVC app</span> <span data-start="57.469" data-end="59.76">we're going to make it go from scaling</span> <span data-start="59.76" data-end="64.14">like this which is linear to something</span> <span data-start="64.14" data-end="66.689">like this which is logarithmic it's very</span> <span data-start="66.689" data-end="69.689">exciting stuff so here's how we're going</span> <span data-start="69.689" data-end="72.65">to do it first we're going to examine a</span> <span data-start="72.65" data-end="76.08">eight naive filter by feature</span> <span data-start="76.08" data-end="78.15">implementation we're just going to do it</span> <span data-start="78.15" data-end="79.56">as stupidly as we can we're not going to</span> <span data-start="79.56" data-end="82.02">rely on any tools we're not even write a</span> <span data-start="82.02" data-end="84.21">code but we're just going to do it and</span> <span data-start="84.21" data-end="86.52">it like as if we were just writing in</span> <span data-start="86.52" data-end="88.34">jquery and we didn't know any better</span> <span data-start="88.34" data-end="91.079">we're going to improve the performance</span> <span data-start="91.079" data-end="93.99">of this implementation using a small</span> <span data-start="93.99" data-end="96.119">diffing algorithm and then we're going</span> <span data-start="96.119" data-end="97.439">to kind of try and gauge how that's</span> <span data-start="97.439" data-end="100.86">going to scale over you know time and</span> <span data-start="100.86" data-end="103.229">then we're also going to take a tour of</span> <span data-start="103.229" data-end="106.409">our logarithmic filter algorithm that</span> </p>
<p><span data-start="106.409" data-end="109.079">I've been working on for six months at</span> <span data-start="109.079" data-end="110.7">the very end hopefully we'll have time</span> <span data-start="110.7" data-end="114.119">to actually demo our implementation so</span> <span data-start="114.119" data-end="117.54">that's cool let's get started so in</span> <span data-start="117.54" data-end="122.399">order to help visualize how the arrays</span> <span data-start="122.399" data-end="125.88">are being filtered and how memory is</span> <span data-start="125.88" data-end="128.099">being moved around and whatnot came up</span> <span data-start="128.099" data-end="130.08">with this kind of like template the goal</span> <span data-start="130.08" data-end="133.61">of the template is to kind of give us a</span> <span data-start="133.61" data-end="137.4">an understanding of where we're spending</span> <span data-start="137.4" data-end="142.11">the most time and how how it's changing</span> <span data-start="142.11" data-end="144.66">as we go from the original update of a</span> <span data-start="144.66" data-end="146.7">filtered list to the update of our Dom</span> <span data-start="146.7" data-end="149.76">so on the left here see we have this</span> <span data-start="149.76" data-end="152.57">kind of like objects land section</span> <span data-start="152.57" data-end="155.459">operations that occur here cost one unit</span> <span data-start="155.459" data-end="158.79">of time on the right you'll see there</span> </p>
<p><span data-start="158.79" data-end="161.19">Dom land operations that occur there</span> <span data-start="161.19" data-end="163.77">cost 10 units of time it's mostly</span> <span data-start="163.77" data-end="165.33">arbitrary it's just chosen for the sake</span> <span data-start="165.33" data-end="169.11">of argument inside of object land you'll</span> <span data-start="169.11" data-end="172.41">notice we have kind of two columns there</span> <span data-start="172.41" data-end="175.35">one of them is our to-do list this would</span> <span data-start="175.35" data-end="177.209">be like you're just raw list of all of</span> <span data-start="177.209" data-end="179.63">the to do's and that map like to do MVC</span> <span data-start="179.63" data-end="182.43">this is the unfiltered list of to do's</span> <span data-start="182.43" data-end="184.59">and then the second column being</span> <span data-start="184.59" data-end="186.81">completed this is our filtered list of</span> <span data-start="186.81" data-end="189.93">completed to juice so only to do is ever</span> <span data-start="189.93" data-end="191.4">completed we'll wind up the missus and</span> <span data-start="191.4" data-end="195.3">finally on the far right in dom land</span> <span data-start="195.3" data-end="197.04">there's a node list and this is what</span> <span data-start="197.04" data-end="200.299">would be in the browser representing the</span> <span data-start="200.299" data-end="205.14">the completed version of the to-do list</span> <span data-start="205.14" data-end="209.25">right yes cool most importantly in the</span> <span data-start="209.25" data-end="210.57">bottom right you'll notice there's this</span> <span data-start="210.57" data-end="213.86">little cost counter so as we start to</span> <span data-start="213.86" data-end="216.269">conduct operations on these lists and</span> <span data-start="216.269" data-end="218.01">this Dom we're going to kind of keep</span> <span data-start="218.01" data-end="219.959">track of what it's costing us in order</span> <span data-start="219.959" data-end="225.26">to do so cool so um let's get started oh</span> <span data-start="225.26" data-end="228.06">also one quick note what we're going to</span> <span data-start="228.06" data-end="231.06">start from this point right we're going</span> <span data-start="231.06" data-end="232.98">to start with an existing list of to</span> <span data-start="232.98" data-end="234.269">do's we're assuming we already have it</span> <span data-start="234.269" data-end="235.32">like a member you don't have to go do</span> <span data-start="235.32" data-end="238.44">some async requests and build it and</span> <span data-start="238.44" data-end="240.54">then we're also going to start with its</span> <span data-start="240.54" data-end="242.31">filter counterpart the completed list</span> <span data-start="242.31" data-end="244.56">right so we already know that these two</span> <span data-start="244.56" data-end="246">items are will be filtered out of the</span> <span data-start="246" data-end="248.549">main to do this list and then we're also</span> <span data-start="248.549" data-end="249.87">going to start with our rendered Dom</span> <span data-start="249.87" data-end="251.28">elements already the reason we're doing</span> <span data-start="251.28" data-end="253.739">it like this is because everything that</span> <span data-start="253.739" data-end="256.049">happened before this can't be optimized</span> <span data-start="256.049" data-end="259.68">it just is what it is and I just hope</span> <span data-start="259.68" data-end="264.85">that you all trust me on that</span> <span data-start="264.86" data-end="268.44">let's see so we're going to update this</span> <span data-start="268.44" data-end="271.5">list on the left to do's by adding the</span> <span data-start="271.5" data-end="273.87">new item to it called run so now we have</span> <span data-start="273.87" data-end="277.98">hop skip and jump and run escape is the</span> <span data-start="277.98" data-end="282.27">only one that's not completed by adding</span> <span data-start="282.27" data-end="284.76">this run element or item to the to-do</span> <span data-start="284.76" data-end="287.28">list we really have to refill tur</span> <span data-start="287.28" data-end="291.33">completed right so what will first have</span> <span data-start="291.33" data-end="293.25">to do is ask are all the elements in</span> <span data-start="293.25" data-end="296.61">completed and then afterwards we can</span> <span data-start="296.61" data-end="299.37">start filtering through the unfiltered</span> <span data-start="299.37" data-end="301.17">to-do list so look something like this</span> <span data-start="301.17" data-end="304.23">first we'll hip hop hop is completed so</span> <span data-start="304.23" data-end="305.78">we'll copy it over to the completed list</span> <span data-start="305.78" data-end="308.58">skip is not completed so it will not be</span> <span data-start="308.58" data-end="313.47">copied over jump is run is notice the</span> <span data-start="313.47" data-end="315.54">cost is going up every time we have that</span> <span data-start="315.54" data-end="317.4">little red circle touch one of these</span> <span data-start="317.4" data-end="321.9">elements in the list so now we have our</span> <span data-start="321.9" data-end="324.54">completed two dues list everything's</span> <span data-start="324.54" data-end="326.25">been filtered and this is you know we're</span> <span data-start="326.25" data-end="327.93">halfway there to getting what we wanted</span> <span data-start="327.93" data-end="330.39">you just got to get it into the Dom but</span> <span data-start="330.39" data-end="331.68">we already have a couple items in the</span> </p>
<p><span data-start="331.68" data-end="335.69">Dom so we're gonna have to empty it and</span> <span data-start="335.69" data-end="337.83">that's kind of expensive we just notice</span> <span data-start="337.83" data-end="339.15">on the bottom right there we like</span> <span data-start="339.15" data-end="341.07">increased 20 units because there's two</span> <span data-start="341.07" data-end="342.84">items in there we remove those two items</span> <span data-start="342.84" data-end="346.41">it's 10 units per operations or up to 20</span> <span data-start="346.41" data-end="347.85">units just for that one little thing</span> <span data-start="347.85" data-end="350.04">it's kind of expensive but hey we're</span> <span data-start="350.04" data-end="352.11">just you know building a filtered list</span> <span data-start="352.11" data-end="353.13">we don't really care about performance</span> <span data-start="353.13" data-end="356.79">right now so now we can start rebuilding</span> <span data-start="356.79" data-end="359.61">that Dom list so represents the</span> <span data-start="359.61" data-end="361.5">completed list so we'll start iterating</span> <span data-start="361.5" data-end="365.49">that and then as we do we'll add those</span> <span data-start="365.49" data-end="371.76">elements to the node list all together</span> <span data-start="371.76" data-end="374.73">over the course of this entire updating</span> <span data-start="374.73" data-end="376.83">of the filtered list I'm sorry of the</span> <span data-start="376.83" data-end="379.41">to-do list and rendering the filtered</span> <span data-start="379.41" data-end="383.61">variation we somehow got up to 55 units</span> <span data-start="383.61" data-end="386.43">of cost so this is our baseline all we</span> <span data-start="386.43" data-end="387.72">have to do is really improve upon that</span> <span data-start="387.72" data-end="390.3">and I notice some wasteful stuff while</span> <span data-start="390.3" data-end="392.19">we are doing that I think we can</span> <span data-start="392.19" data-end="394.25">probably pretty easily drop it down some</span> <span data-start="394.25" data-end="397.889">so the first thing that I noticed</span> <span data-start="397.889" data-end="399.09">that when we were refill Turing the</span> <span data-start="399.09" data-end="402.599">completed list after the to do's like</span> <span data-start="402.599" data-end="405.18">the run to do was added we unnecessarily</span> <span data-start="405.18" data-end="409.55">removed these two items hop and jump</span> <span data-start="409.55" data-end="411.36">because we were kind of starting over</span> <span data-start="411.36" data-end="414.06">from scratch right and that was really</span> <span data-start="414.06" data-end="416.52">necessary because we had to go back to</span> <span data-start="416.52" data-end="418.919">the original to-do list and reevaluate</span> <span data-start="418.919" data-end="420.599">each of those and then put them right</span> <span data-start="420.599" data-end="422.37">back where they were so there was no</span> <span data-start="422.37" data-end="425.389">real change from the time that they were</span> <span data-start="425.389" data-end="428.999">first there when we started updating the</span> <span data-start="428.999" data-end="432.15">filth the to-do list and after we've</span> <span data-start="432.15" data-end="434.099">updated the to-do list so really all</span> <span data-start="434.099" data-end="436.02">that changed in the end was that we're</span> <span data-start="436.02" data-end="438.59">going to add a run element to the end of</span> <span data-start="438.59" data-end="441.419">the completed list but in doing that it</span> <span data-start="441.419" data-end="444.33">costs us three units which you know</span> <span data-start="444.33" data-end="447.36">maybe not too bad but yeah it's</span> <span data-start="447.36" data-end="449.849">something the next thing we noticed is</span> <span data-start="449.849" data-end="453.27">that when we were rebuilding the node</span> <span data-start="453.27" data-end="455.37">list and we're updating the node list to</span> <span data-start="455.37" data-end="459.029">represent our new completed list we had</span> <span data-start="459.029" data-end="461.909">to like I said invest 20 units just to</span> <span data-start="461.909" data-end="464.849">empty the thing out and start over that</span> <span data-start="464.849" data-end="466.289">was really expensive but then also</span> <span data-start="466.289" data-end="468.629">putting the items back in was really</span> <span data-start="468.629" data-end="472.469">expensive 20 units per and again these</span> <span data-start="472.469" data-end="475.649">elements didn't change we took them out</span> <span data-start="475.649" data-end="477">we put them back in and they're exactly</span> <span data-start="477" data-end="478.74">the same after so it was kind of like</span> <span data-start="478.74" data-end="481.669">unnecessary if we had touch them at all</span> <span data-start="481.669" data-end="484.77">everything would have just been fine but</span> <span data-start="484.77" data-end="487.83">we did and so it costs us if you were to</span> <span data-start="487.83" data-end="490.649">kind of break down what we thought was</span> <span data-start="490.649" data-end="492.689">necessary and not necessary what you'll</span> <span data-start="492.689" data-end="494.669">find is that 12 of the units were</span> <span data-start="494.669" data-end="497.279">absolutely necessary and 43 of those</span> <span data-start="497.279" data-end="499.169">units we just invested were completely</span> <span data-start="499.169" data-end="501.599">unnecessary that's very very very</span> <span data-start="501.599" data-end="507.21">inefficient so we we know of a way to</span> <span data-start="507.21" data-end="509.149">improve upon this right we've seen</span> <span data-start="509.149" data-end="511.77">diffing algorithms and to speed things</span> <span data-start="511.77" data-end="514.919">up by by moving some of the computation</span> <span data-start="514.919" data-end="517.919">over into object land instead right this</span> <span data-start="517.919" data-end="519.12">is the kind of thing we want we just</span> <span data-start="519.12" data-end="520.68">want to know what changed and then once</span> <span data-start="520.68" data-end="522.479">we know what changed then we can just</span> <span data-start="522.479" data-end="524.159">update the dumb as efficiently as</span> <span data-start="524.159" data-end="527.699">possible so let's give it a run right so</span> <span data-start="527.699" data-end="528.569">we're going to go back to the beginning</span> <span data-start="528.569" data-end="530.279">we're going to update the to-do list</span> <span data-start="530.279" data-end="531.27">right</span> <span data-start="531.27" data-end="535.02">add that run item in doing that we're</span> <span data-start="535.02" data-end="537.39">going to filter the to do's all right we</span> <span data-start="537.39" data-end="539.67">got to update that filtered list but</span> <span data-start="539.67" data-end="541.53">this time instead of just like dumping</span> <span data-start="541.53" data-end="543.21">the completed list and starting from</span> <span data-start="543.21" data-end="544.29">scratch we're going to save a reference</span> <span data-start="544.29" data-end="546.18">to the completed list or i call it</span> <span data-start="546.18" data-end="548.07">previous completed i ran out of space</span> <span data-start="548.07" data-end="551.16">there then we could kind of discard the</span> <span data-start="551.16" data-end="553.92">completed list and start rebuilding or</span> <span data-start="553.92" data-end="556.56">refill turing from the to-do list all</span> <span data-start="556.56" data-end="558.21">right so we'll hit hop again hop is</span> <span data-start="558.21" data-end="562.88">included skip is not jump is run is</span> <span data-start="562.88" data-end="565.56">excellent so now we have our new</span> <span data-start="565.56" data-end="567.66">completed list we have a reference or</span> <span data-start="567.66" data-end="570.66">old completed list now we can actually</span> <span data-start="570.66" data-end="574.11">start doing some dipping and hopefully</span> <span data-start="574.11" data-end="578.82">update the Dom much faster or in total</span> <span data-start="578.82" data-end="581.31">spend less units accomplishing the same</span> <span data-start="581.31" data-end="583.23">test right so that's let's begin with</span> <span data-start="583.23" data-end="585.72">the diff really simple we're just going</span> <span data-start="585.72" data-end="588.12">to traverse the lists together</span> <span data-start="588.12" data-end="590.82">simultaneously we're going to visit each</span> <span data-start="590.82" data-end="593.1">of the note of the items so first we're</span> <span data-start="593.1" data-end="594.39">going to visit the first I've been</span> <span data-start="594.39" data-end="595.65">completed in the first item in the</span> <span data-start="595.65" data-end="596.61">previous completed and we're going to</span> <span data-start="596.61" data-end="597.84">compare them see if they're the same</span> <span data-start="597.84" data-end="600.39">they're the same cool we can keep on</span> <span data-start="600.39" data-end="602.93">going jump and jump again the same</span> <span data-start="602.93" data-end="606.12">nothing needs to be done here this where</span> <span data-start="606.12" data-end="608.4">we get to run run is new and in their</span> <span data-start="608.4" data-end="610.02">previous completed list we did not have</span> <span data-start="610.02" data-end="612.57">that so this is you know a change that</span> <span data-start="612.57" data-end="615">we have to actually apply so we're going</span> <span data-start="615" data-end="618.06">to patch the Dom the node list with this</span> <span data-start="618.06" data-end="621.36">change so just to get there we were up</span> <span data-start="621.36" data-end="623.64">like eight units not bad but we haven't</span> <span data-start="623.64" data-end="624.9">done anything in dom land so we're doing</span> <span data-start="624.9" data-end="627.39">pretty good let's update the dom with</span> <span data-start="627.39" data-end="629.91">the new item the run item which the diff</span> <span data-start="629.91" data-end="632.82">informed us we need to move over 10</span> <span data-start="632.82" data-end="634.2">units we knew we're gonna have to do</span> <span data-start="634.2" data-end="636.63">that no big deal and here we are we've</span> <span data-start="636.63" data-end="639.45">accomplished the same thing and we're at</span> <span data-start="639.45" data-end="642.87">18 units which is a huge improvement</span> <span data-start="642.87" data-end="645.69">over what we previously did we could see</span> <span data-start="645.69" data-end="650.04">here now what we see is that we only had</span> <span data-start="650.04" data-end="652.83">about six units of wasted effort right</span> <span data-start="652.83" data-end="655.17">because 12 was what we absolutely needed</span> <span data-start="655.17" data-end="659.16">to move the to update the to-do list and</span> <span data-start="659.16" data-end="661.89">then to move that node into a filtered</span> <span data-start="661.89" data-end="665.43">list and then to move that filtered item</span> <span data-start="665.43" data-end="669.98">into our Dom nodes are yes our noblest</span> <span data-start="669.98" data-end="672.81">so the question though is did our</span> <span data-start="672.81" data-end="674.4">solution that we just implements scale</span> <span data-start="674.4" data-end="677.43">right can we can we rely on this being</span> <span data-start="677.43" data-end="680.07">like ultra fast and performance even</span> <span data-start="680.07" data-end="682.44">when were you know doing hundreds of</span> <span data-start="682.44" data-end="683.64">thousands of items if that were the case</span> <span data-start="683.64" data-end="685.38">of our browsers couldn't handle that</span> <span data-start="685.38" data-end="687.09">kind of stuff so we're going to scale</span> <span data-start="687.09" data-end="690.87">the example up entirely instead of three</span> <span data-start="690.87" data-end="693.24">initial items will have 30 initial items</span> <span data-start="693.24" data-end="695.37">and instead of one of those items not</span> <span data-start="695.37" data-end="697.05">being complete there will be 10 of those</span> <span data-start="697.05" data-end="698.94">items that aren't complete similarly</span> <span data-start="698.94" data-end="700.47">instead of doing one update we're going</span> <span data-start="700.47" data-end="704.46">to do ten updates right so if we go</span> <span data-start="704.46" data-end="706.65">through this and I don't diagram it all</span> <span data-start="706.65" data-end="709.17">out for you I just do some little math</span> <span data-start="709.17" data-end="712.32">on a notepad here and we come to this</span> <span data-start="712.32" data-end="715.2">conclusion find out that if we were</span> <span data-start="715.2" data-end="719.67">doing that many items we are wasting 600</span> <span data-start="719.67" data-end="722.37">units of work not really accomplishing</span> <span data-start="722.37" data-end="723.87">anything the only really important</span> <span data-start="723.87" data-end="726.78">things that actually mattered that word</span> <span data-start="726.78" data-end="728.94">that like could not go without were</span> <span data-start="728.94" data-end="731.76">these 120 operations so it's like super</span> <span data-start="731.76" data-end="734.55">inefficient and there's room for</span> <span data-start="734.55" data-end="736.71">improvement there right so we can keep</span> <span data-start="736.71" data-end="740.73">on going ideally we would do something</span> <span data-start="740.73" data-end="743.7">else let's take a look at what I ideal</span> <span data-start="743.7" data-end="745.83">approach would look like so now we're</span> <span data-start="745.83" data-end="746.85">going to go through this whole process</span> <span data-start="746.85" data-end="749.49">again we're going to implode the run</span> <span data-start="749.49" data-end="753.87">item to the dues list something is going</span> <span data-start="753.87" data-end="755.88">to happen we don't know what but it's</span> <span data-start="755.88" data-end="757.41">going to be probably more efficient we</span> <span data-start="757.41" data-end="758.9">want it to be more efficient anyway and</span> <span data-start="758.9" data-end="761.61">we're somehow going to get be able to</span> <span data-start="761.61" data-end="763.14">tell that hey we should move this one</span> <span data-start="763.14" data-end="765.96">item in to-do list or into the completed</span> <span data-start="765.96" data-end="767.94">list cool and that would only cost us</span> <span data-start="767.94" data-end="769.41">one unit that would be great if we can</span> <span data-start="769.41" data-end="772.29">figure that out really quickly then we</span> <span data-start="772.29" data-end="773.88">want to do it again basically right we</span> <span data-start="773.88" data-end="775.53">want to in some way shape or form figure</span> <span data-start="775.53" data-end="778.41">out how we can update the node list and</span> </p>
<p><span data-start="778.41" data-end="780.72">Dom land without a whole lot of overhead</span> <span data-start="780.72" data-end="784.92">and and get our fantastic result and</span> <span data-start="784.92" data-end="786.81">that would only cost of 12 units like we</span> <span data-start="786.81" data-end="787.98">can't really make it any faster than</span> <span data-start="787.98" data-end="790.23">that right we just copied the exact item</span> <span data-start="790.23" data-end="794.31">over but it's not really like that</span> <span data-start="794.31" data-end="796.71">simple right we can't just copy that one</span> <span data-start="796.71" data-end="797.61">item over and</span> <span data-start="797.61" data-end="800.73">say it was that easy because it's really</span> <span data-start="800.73" data-end="804.899">not trivial the run item was added to</span> <span data-start="804.899" data-end="807.99">the to do list here but we don't really</span> <span data-start="807.99" data-end="809.7">know at what index we should put it in</span> <span data-start="809.7" data-end="811.589">the completed list you know we can do</span> <span data-start="811.589" data-end="813.18">some work to figure it out but then</span> <span data-start="813.18" data-end="815.16">again we're just doing more work right</span> <span data-start="815.16" data-end="817.2">like there's not we're not gaining</span> <span data-start="817.2" data-end="818.459">anything we're just changing the style</span> <span data-start="818.459" data-end="820.86">of work maybe instead of refill turing</span> <span data-start="820.86" data-end="823.11">the list we're just going to iterate and</span> <span data-start="823.11" data-end="824.67">search through the completed list and</span> <span data-start="824.67" data-end="826.32">find an insertion point that's not</span> <span data-start="826.32" data-end="827.82">saving us anything with stuff to do that</span> <span data-start="827.82" data-end="831.089">work and if it seems like you know maybe</span> </p>
<p><span data-start="831.089" data-end="833.1">I'm overcomplicating it try really</span> <span data-start="833.1" data-end="835.5">quickly to figure out where this item</span> <span data-start="835.5" data-end="838.5">belongs in its filter variation it's not</span> <span data-start="838.5" data-end="840.269">super obvious I mean you can figure it</span> <span data-start="840.269" data-end="841.17">out but it's going to take you a couple</span> <span data-start="841.17" data-end="843.06">seconds and have to write a program to</span> <span data-start="843.06" data-end="846.12">do the same amount of work it's also</span> <span data-start="846.12" data-end="850.459">going to be inefficient right okay so</span> <span data-start="850.459" data-end="853.16">this is where I decide to get clever</span> <span data-start="853.16" data-end="855.39">where you have to think outside of the</span> <span data-start="855.39" data-end="860.279">array brackets and or box after many</span> <span data-start="860.279" data-end="862.709">failed attempts and a bunch of help for</span> <span data-start="862.709" data-end="865.26">my co-workers I learned that no matter</span> <span data-start="865.26" data-end="868.41">how I try to work with these arrays I'm</span> <span data-start="868.41" data-end="870.75">not going to be able to update them</span> <span data-start="870.75" data-end="874.82">quickly or efficiently but if we look at</span> <span data-start="874.82" data-end="878.04">red black binary trees they offer a</span> <span data-start="878.04" data-end="879.51">couple properties that we can maybe take</span> <span data-start="879.51" data-end="882.329">advantage of and i'm not sure if any of</span> <span data-start="882.329" data-end="884.42">you guys are aware of how these work or</span> <span data-start="884.42" data-end="887.64">remember how they work for me i had to</span> <span data-start="887.64" data-end="889.05">learn them so they're fresh on my mind</span> <span data-start="889.05" data-end="890.87">but i'll give you a quick run-through on</span> <span data-start="890.87" data-end="894.75">how they how they work so first we add</span> <span data-start="894.75" data-end="896.94">like the first item in our to-do list</span> <span data-start="896.94" data-end="898.709">into the tree and this becomes a root</span> <span data-start="898.709" data-end="903.839">node next we try to add the next item</span> <span data-start="903.839" data-end="905.399">the next item would be skip it had an</span> <span data-start="905.399" data-end="909">index of one so we'll compare this new</span> <span data-start="909" data-end="911.1">item we're putting into the tree against</span> <span data-start="911.1" data-end="913.649">the root node and you see here that skip</span> <span data-start="913.649" data-end="915.54">has a value of one because that's its</span> <span data-start="915.54" data-end="918.36">index in the to do list and then hop has</span> <span data-start="918.36" data-end="921.39">an index of zero so one vs 0 we need to</span> <span data-start="921.39" data-end="923.82">put skip to the right of hop so that's</span> <span data-start="923.82" data-end="926.79">what the tree does that's</span> <span data-start="926.79" data-end="930.36">tastic now what happens is we want to</span> <span data-start="930.36" data-end="932.31">put in a third item right and so jump</span> <span data-start="932.31" data-end="935.01">tries to go in it's cotton and X 2 hops</span> <span data-start="935.01" data-end="937.08">got the index of zero we compare them</span> <span data-start="937.08" data-end="939.45">and then the cool thing above tree is</span> <span data-start="939.45" data-end="941.61">that it basically does the same exact</span> <span data-start="941.61" data-end="944.46">operation but on in the next node and</span> <span data-start="944.46" data-end="945.99">the next node in the next node until it</span> <span data-start="945.99" data-end="947.82">runs out of places to search to compare</span> <span data-start="947.82" data-end="949.68">nodes and it just assumes this is where</span> </p>
<p><span data-start="949.68" data-end="952.41">I belong right because I used logic and</span> <span data-start="952.41" data-end="954.66">reasoning to get here so jump compares</span> <span data-start="954.66" data-end="956.79">itself with skip and it says I've got to</span> <span data-start="956.79" data-end="960.81">go to the right of that fantastic so one</span> <span data-start="960.81" data-end="963.12">of the beauties of binary trees is that</span> <span data-start="963.12" data-end="964.92">they drastically reduce the cost of</span> <span data-start="964.92" data-end="967.44">operations on them like insert and</span> <span data-start="967.44" data-end="971.31">remove or find because you don't have to</span> <span data-start="971.31" data-end="973.89">visit every item in the tree right so we</span> <span data-start="973.89" data-end="977.91">can kind of just like split the size of</span> <span data-start="977.91" data-end="979.95">the data set like in half every time we</span> <span data-start="979.95" data-end="982.29">kind of try to find that information</span> <span data-start="982.29" data-end="984.54">which is super helpful but in order for</span> <span data-start="984.54" data-end="986.88">that to happen the red black tree has to</span> <span data-start="986.88" data-end="989.94">balance itself right it right now this</span> <span data-start="989.94" data-end="995.31">is like a 3 3 tier or tree or like that</span> <span data-start="995.31" data-end="998.22">has a depth of 3 nodes and so I would</span> <span data-start="998.22" data-end="1000.74">have to compare myself against two nodes</span> <span data-start="1000.74" data-end="1001.88">to get to the third one but if we</span> <span data-start="1001.88" data-end="1005.24">rebalance rotate you know now the depth</span> <span data-start="1005.24" data-end="1007.22">is much more shallow and in order to</span> <span data-start="1007.22" data-end="1008.72">find the note i can find it in one</span> <span data-start="1008.72" data-end="1011.03">operation instead of two right this is</span> <span data-start="1011.03" data-end="1012.26">constantly happening as you're adding</span> <span data-start="1012.26" data-end="1015.08">elements to the tree it's just it's it's</span> <span data-start="1015.08" data-end="1016.76">a very efficient and it's a really</span> <span data-start="1016.76" data-end="1019.34">clever design so then the question</span> <span data-start="1019.34" data-end="1021.71">becomes how do we use these red black</span> <span data-start="1021.71" data-end="1024.5">trees Lloyd black binary trees to filter</span> <span data-start="1024.5" data-end="1026">arrays because that's kind of not what</span> <span data-start="1026" data-end="1030.8">they're designed to do initially so</span> <span data-start="1030.8" data-end="1032.3">we'll take a look at our model again</span> <span data-start="1032.3" data-end="1035.6">this is um this is the algorithm right</span> <span data-start="1035.6" data-end="1037.88">the results of the algorithm and it</span> <span data-start="1037.88" data-end="1039.5">comes in a couple different parts and</span> <span data-start="1039.5" data-end="1041.63">they're really intricate little bits and</span> <span data-start="1041.63" data-end="1043.55">pieces I hope you guys can see it but</span> </p>
<p><span data-start="1043.55" data-end="1044.63">I'm going to go walk through it like</span> <span data-start="1044.63" data-end="1046.25">step by step and kind of show you all</span> <span data-start="1046.25" data-end="1050.29">the different little moving parts so</span> <span data-start="1050.29" data-end="1052.52">this would look like when it's done</span> <span data-start="1052.52" data-end="1054.65">right look on the Left we see we've got</span> <span data-start="1054.65" data-end="1057.14">the to do list it's already got the run</span> <span data-start="1057.14" data-end="1059.18">item in it</span> <span data-start="1059.18" data-end="1060.77">we've got this thing called the</span> <span data-start="1060.77" data-end="1063.29">predicate tree it's in the center area</span> <span data-start="1063.29" data-end="1066.11">below that is a pleated tree and on the</span> <span data-start="1066.11" data-end="1067.07">right is the node list that we're</span> <span data-start="1067.07" data-end="1068.24">familiar with so all we really did was</span> <span data-start="1068.24" data-end="1070.79">take out this filtered array that was in</span> <span data-start="1070.79" data-end="1072.74">the center and we replace it with these</span> <span data-start="1072.74" data-end="1075.58">two trees okay so let's look at the</span> <span data-start="1075.58" data-end="1078.56">predicate tree the predicate tree has</span> <span data-start="1078.56" data-end="1081.56">two primary roles for every item in the</span> <span data-start="1081.56" data-end="1083.78">to do's list there's going to be a node</span> <span data-start="1083.78" data-end="1085.61">in the predicate tree so it like</span> <span data-start="1085.61" data-end="1087.92">maintains a one-to-one relationship</span> <span data-start="1087.92" data-end="1090.34">obviously they're structured differently</span> <span data-start="1090.34" data-end="1093.59">to do this list has like indexes and</span> <span data-start="1093.59" data-end="1095.03">they're all one after another and then</span> <span data-start="1095.03" data-end="1096.47">this tree has this kind of strange</span> <span data-start="1096.47" data-end="1100.43">pyramid shape and has no indexes blood</span> <span data-start="1100.43" data-end="1101.87">but that's his job the predicate tree</span> <span data-start="1101.87" data-end="1103.94">just make sure that it has all the same</span> <span data-start="1103.94" data-end="1106.16">items that's to do the tree to do this</span> <span data-start="1106.16" data-end="1109.67">list has also if you were to be more</span> <span data-start="1109.67" data-end="1110.75">generic we would just call that the</span> <span data-start="1110.75" data-end="1113.27">source list because this can be applied</span> <span data-start="1113.27" data-end="1115.76">to any any less obviously the next thing</span> <span data-start="1115.76" data-end="1118.07">that it's meant to do is match the order</span> <span data-start="1118.07" data-end="1121.16">of the to-do list so if items are moved</span> <span data-start="1121.16" data-end="1123.02">around or added to the beginning or Matt</span> <span data-start="1123.02" data-end="1125.12">at the end it's it's going to match that</span> <span data-start="1125.12" data-end="1126.89">to like it has to say one hundred</span> <span data-start="1126.89" data-end="1129.65">percent in sync with the bolt they order</span> <span data-start="1129.65" data-end="1135.12">the number of items so on and so forth</span> <span data-start="1135.13" data-end="1141.17">perfect the predicate functions nodes so</span> <span data-start="1141.17" data-end="1145.19">the squares in sorry not the pretty the</span> <span data-start="1145.19" data-end="1146.99">predicate tree the nodes in the</span> <span data-start="1146.99" data-end="1149.81">predicate tree hold on to something</span> <span data-start="1149.81" data-end="1151.79">called the predicate result the word</span> <span data-start="1151.79" data-end="1152.99">predicate I don't know if everybody</span> <span data-start="1152.99" data-end="1155.6">knows what that means it's probably find</span> <span data-start="1155.6" data-end="1157.13">it like lodash documentation or</span> <span data-start="1157.13" data-end="1158.96">underscore documentation it's the</span> <span data-start="1158.96" data-end="1160.91">function that you use to compare against</span> <span data-start="1160.91" data-end="1164.51">each item so if you said to do is that</span> <span data-start="1164.51" data-end="1168.44">filter function if completed return true</span> <span data-start="1168.44" data-end="1170.18">and everything that returns true is</span> <span data-start="1170.18" data-end="1171.74">going to be in your filtered list at</span> <span data-start="1171.74" data-end="1173.15">that function that you pass to the</span> <span data-start="1173.15" data-end="1174.59">filter method that was your predicate</span> <span data-start="1174.59" data-end="1177.47">function it's used to determine if the</span> <span data-start="1177.47" data-end="1181.58">item should or should not be included so</span> <span data-start="1181.58" data-end="1183.26">the predicate tree has the</span> <span data-start="1183.26" data-end="1184.91">responsibility of holding on to the</span> <span data-start="1184.91" data-end="1188.96">result of that function but it also can</span> <span data-start="1188.96" data-end="1190.45">be made to</span> <span data-start="1190.45" data-end="1194.8">bind to its source item right so if my</span> <span data-start="1194.8" data-end="1196.87">source item changes so for instance if</span> <span data-start="1196.87" data-end="1200.77">hop got renames to hopping that</span> <span data-start="1200.77" data-end="1203.44">predicate function can rerun and make a</span> <span data-start="1203.44" data-end="1205.81">decision about how to proceed so that's</span> <span data-start="1205.81" data-end="1208.66">kind of a neat thing to do cool keep</span> <span data-start="1208.66" data-end="1211.65">going I think that's right the second a</span> <span data-start="1211.65" data-end="1214.36">tree and our algorithm here is the</span> <span data-start="1214.36" data-end="1217.39">completed tree it looks a lot like the</span> <span data-start="1217.39" data-end="1219.19">predicate tree except it's missing some</span> <span data-start="1219.19" data-end="1224.02">some nodes the print the completed tree</span> <span data-start="1224.02" data-end="1226.54">contains only nodes a Soviet associated</span> <span data-start="1226.54" data-end="1229.72">with items that were filtered from the</span> <span data-start="1229.72" data-end="1231.88">to do's in this case right so this is</span> <span data-start="1231.88" data-end="1234.7">this tree only has items that we want in</span> <span data-start="1234.7" data-end="1238.87">our filtered result set okay simple it's</span> <span data-start="1238.87" data-end="1241.81">just our filtered list but it has like</span> <span data-start="1241.81" data-end="1243.67">this kind of one nuance it has</span> <span data-start="1243.67" data-end="1247.48">references to its sister nodes in the</span> <span data-start="1247.48" data-end="1250.69">predicate tree right so you see these</span> <span data-start="1250.69" data-end="1252.46">little asterisks that I have in each</span> <span data-start="1252.46" data-end="1254.47">node that's just meant to represent that</span> <span data-start="1254.47" data-end="1257.31">any one of these nodes can very easily</span> <span data-start="1257.31" data-end="1261.78">get access to that predicate tree and</span> <span data-start="1261.78" data-end="1263.76">potentially traverse it if it wanted to</span> </p>
<p><span data-start="1263.76" data-end="1269.8">I'll call those sister nodes so the</span> <span data-start="1269.8" data-end="1271.84">nodes of both trees have a couple things</span> <span data-start="1271.84" data-end="1274.57">in common they're not 100% unique</span> <span data-start="1274.57" data-end="1277.18">between the two of them each one of them</span> <span data-start="1277.18" data-end="1280.96">each one of the trees is nodes maintains</span> <span data-start="1280.96" data-end="1284.89">a left count a right count and a gap</span> <span data-start="1284.89" data-end="1287.05">count and what that means is if you look</span> <span data-start="1287.05" data-end="1290.95">at the skip item kind of the right of</span> <span data-start="1290.95" data-end="1292.6">the false you've got this colon you've</span> <span data-start="1292.6" data-end="1296.79">got one pipe zero pipe too so the one</span> <span data-start="1296.79" data-end="1299.14">implies that there's one item to the</span> <span data-start="1299.14" data-end="1301.66">left of it 0 implies that there is no</span> <span data-start="1301.66" data-end="1305.38">gap to the left of it so like if you</span> <span data-start="1305.38" data-end="1306.79">were to create an array where you put an</span> <span data-start="1306.79" data-end="1308.65">item at zero index and then you put an</span> <span data-start="1308.65" data-end="1310.96">item at the third index you just created</span> <span data-start="1310.96" data-end="1312.94">a gap in between those two right so</span> <span data-start="1312.94" data-end="1316.18">using a left count and a left gap count</span> <span data-start="1316.18" data-end="1319.6">we can calculate what the index of that</span> <span data-start="1319.6" data-end="1321.76">node is right so with a left count of</span> <span data-start="1321.76" data-end="1323.27">one and</span> <span data-start="1323.27" data-end="1325.7">no gap we can easily assume that this</span> <span data-start="1325.7" data-end="1328.97">node is that the first index but the</span> <span data-start="1328.97" data-end="1330.05">important thing there is that we didn't</span> <span data-start="1330.05" data-end="1332.03">have to like store that information we</span> <span data-start="1332.03" data-end="1335.38">can calculate it on demand at any time</span> <span data-start="1335.38" data-end="1338.15">another thing that each node has is a</span> <span data-start="1338.15" data-end="1341.03">reference to its left child so for</span> <span data-start="1341.03" data-end="1344.09">instance skip has a reference to hop you</span> <span data-start="1344.09" data-end="1345.59">can see that pen through the lines there</span> <span data-start="1345.59" data-end="1348.32">and then it has a reference to its right</span> <span data-start="1348.32" data-end="1351.2">child assuming it has one similar on the</span> <span data-start="1351.2" data-end="1354.89">right skip has a reference to jump and</span> <span data-start="1354.89" data-end="1358.97">then also its able to implement a linked</span> <span data-start="1358.97" data-end="1364.54">list a doubly linked list so this hop</span> </p>
<p><span data-start="1364.54" data-end="1366.44">I'm sorry I don't actually have an</span> <span data-start="1366.44" data-end="1368.54">example here but essentially if you had</span> <span data-start="1368.54" data-end="1371.18">two leaves that had split apart right</span> <span data-start="1371.18" data-end="1372.74">and then they'd come back together and</span> <span data-start="1372.74" data-end="1375.56">the furthest rightmost node in this leaf</span> <span data-start="1375.56" data-end="1378.08">and the furthest leftmost node in this</span> <span data-start="1378.08" data-end="1381.05">leaf they're not actually sharing a</span> <span data-start="1381.05" data-end="1385.43">child or a parent directly but we can</span> <span data-start="1385.43" data-end="1387.95">still relate the two using a linked list</span> <span data-start="1387.95" data-end="1391.46">which is just fun and then the other</span> <span data-start="1391.46" data-end="1393.95">most important thing is that each one of</span> <span data-start="1393.95" data-end="1396.08">the nodes in both lists I'm sorry both</span> <span data-start="1396.08" data-end="1399.77">trees has a reference to its parent this</span> <span data-start="1399.77" data-end="1404.33">is super critical because waffle expect</span> <span data-start="1404.33" data-end="1409.34">later let's continue actually I think</span> <span data-start="1409.34" data-end="1411.35">that's everything cool that's all I</span> <span data-start="1411.35" data-end="1414.95">prerequisite algorithm teachings so</span> <span data-start="1414.95" data-end="1417.47">let's just review real quickly the</span> <span data-start="1417.47" data-end="1422">predicate tree has the predicate result</span> <span data-start="1422" data-end="1423.62">the true or false should this or should</span> <span data-start="1423.62" data-end="1426.02">this not be included in the resulting</span> <span data-start="1426.02" data-end="1428.87">filtered list and then the completed</span> <span data-start="1428.87" data-end="1432.35">tree has a reference to nodes sister</span> <span data-start="1432.35" data-end="1436.25">nodes in the predicate tree and every</span> <span data-start="1436.25" data-end="1438.95">one of the nodes within its own tree has</span> <span data-start="1438.95" data-end="1442.28">as a way of linking to other nodes in</span> <span data-start="1442.28" data-end="1444.38">the tree friends and siblings children</span> <span data-start="1444.38" data-end="1449.91">and parents cool</span> <span data-start="1449.91" data-end="1453.46">so I think we're ready to to actually</span> <span data-start="1453.46" data-end="1458.23">model the solution so we're going to</span> <span data-start="1458.23" data-end="1459.55">start with the same place where we</span> <span data-start="1459.55" data-end="1461.89">started before with the filtered list to</span> <span data-start="1461.89" data-end="1463.96">do's is just got the three elements in</span> <span data-start="1463.96" data-end="1466.84">it hop skip and jump and then we're</span> <span data-start="1466.84" data-end="1469.78">going to modify that right but in this</span> <span data-start="1469.78" data-end="1471.4">case we actually have a little bit more</span> <span data-start="1471.4" data-end="1473.02">infrastructure built around it the</span> <span data-start="1473.02" data-end="1475.69">predicate tree already has those three</span> <span data-start="1475.69" data-end="1477.72">nodes associated with the to do's items</span> <span data-start="1477.72" data-end="1481.21">hop skip and jump and also has metadata</span> <span data-start="1481.21" data-end="1483.88">about them with regards to their indexes</span> <span data-start="1483.88" data-end="1485.29">or their left counts and their gap</span> <span data-start="1485.29" data-end="1487.39">counts and then it also has already</span> <span data-start="1487.39" data-end="1490.39">solved for the predicate result so we</span> <span data-start="1490.39" data-end="1493.45">know true false and true yes it's um yes</span> <span data-start="1493.45" data-end="1495.4">hop is completed skip is not completed</span> <span data-start="1495.4" data-end="1498.79">jump is completed and then finally not</span> <span data-start="1498.79" data-end="1501.58">finally actually our completed tree has</span> <span data-start="1501.58" data-end="1505.3">references to the relevant nodes in</span> <span data-start="1505.3" data-end="1507.64">order to filter the news list right so</span> <span data-start="1507.64" data-end="1509.83">we have the hop node we have the jump</span> <span data-start="1509.83" data-end="1511.75">node they have their left and right</span> <span data-start="1511.75" data-end="1513.34">counts and their gaps and then they also</span> <span data-start="1513.34" data-end="1515.5">have their references to their sister</span> <span data-start="1515.5" data-end="1520.69">nodes in the predicate treat let's do</span> <span data-start="1520.69" data-end="1524.5">the update and see what happens we</span> <span data-start="1524.5" data-end="1526.99">insert the run item into the to-do list</span> <span data-start="1526.99" data-end="1528.63">just like we've been doing all along</span> <span data-start="1528.63" data-end="1532.45">when this happens the predicate tree</span> <span data-start="1532.45" data-end="1535.78">finds out and starts to insert the run</span> <span data-start="1535.78" data-end="1538.66">item into the tree now the run item</span> <span data-start="1538.66" data-end="1541.75">currently inside of the to-do list has</span> <span data-start="1541.75" data-end="1545.98">an index of 3 the skip item in the</span> <span data-start="1545.98" data-end="1548.71">predicate tree has an index of one we</span> <span data-start="1548.71" data-end="1550.09">were able to calculate that based on</span> <span data-start="1550.09" data-end="1551.98">this left count and it's gap count we're</span> <span data-start="1551.98" data-end="1554.2">going to compare those indexes and we're</span> <span data-start="1554.2" data-end="1556.69">going to say okay run has an index of 3</span> <span data-start="1556.69" data-end="1558.43">we have an index 1 we need to traverse</span> <span data-start="1558.43" data-end="1561.73">downward to the right so run is now</span> <span data-start="1561.73" data-end="1567.13">compared against the jump node because</span> <span data-start="1567.13" data-end="1569.32">we have a reference to our parent the</span> <span data-start="1569.32" data-end="1573.28">jump node can calculate my parents has a</span> <span data-start="1573.28" data-end="1576.4">left count of one my parent represents</span> <span data-start="1576.4" data-end="1578.92">one node in space and I'm the node after</span> <span data-start="1578.92" data-end="1581.17">it so I must be</span> <span data-start="1581.17" data-end="1583.24">in the number two index position right</span> <span data-start="1583.24" data-end="1587.35">so the run being in the third index jump</span> <span data-start="1587.35" data-end="1589.21">being in the second index we can</span> <span data-start="1589.21" data-end="1591.43">continue to insert to the right and</span> <span data-start="1591.43" data-end="1595.18">that's what happens the run item in the</span> <span data-start="1595.18" data-end="1599.02">to-do list wind up being a run node in</span> <span data-start="1599.02" data-end="1601.78">the predicate tree and you can see that</span> <span data-start="1601.78" data-end="1603.34">we got the predicate result here this is</span> <span data-start="1603.34" data-end="1604.87">going to be a true thing we do want this</span> <span data-start="1604.87" data-end="1607.69">in the filtered list our left count or</span> <span data-start="1607.69" data-end="1609.46">right counts and our gaap count or zero</span> <span data-start="1609.46" data-end="1612.25">because it's very lonely down there in</span> <span data-start="1612.25" data-end="1614.68">the bottom corner of that tree but</span> <span data-start="1614.68" data-end="1617.53">that's okay so now that the predicate</span> <span data-start="1617.53" data-end="1619.27">tree has been updated the completed tree</span> <span data-start="1619.27" data-end="1621.01">is going to catch wind of it and it's</span> <span data-start="1621.01" data-end="1624.13">going to say well I probably need to put</span> <span data-start="1624.13" data-end="1625.78">this in my tree let's see what the</span> <span data-start="1625.78" data-end="1627.82">predicate result was the predicate</span> <span data-start="1627.82" data-end="1632.83">result here was true and so we take the</span> <span data-start="1632.83" data-end="1636.76">index of the run node in predicate tree</span> <span data-start="1636.76" data-end="1639.55">which we've calculated as three and we</span> <span data-start="1639.55" data-end="1641.83">compare it against the calculated index</span> <span data-start="1641.83" data-end="1646.42">of the jump node in the completed tree</span> <span data-start="1646.42" data-end="1652.3">and we have three verses too but this is</span> <span data-start="1652.3" data-end="1655.84">actually a little more clever than it</span> <span data-start="1655.84" data-end="1657.88">looks because we have the reference to</span> <span data-start="1657.88" data-end="1659.44">the sister node and the predicate tree</span> <span data-start="1659.44" data-end="1664.05">right so we were using not the index of</span> <span data-start="1664.05" data-end="1667.75">jump in the completed tree for using the</span> <span data-start="1667.75" data-end="1669.75">index of jump in the predicate tree</span> <span data-start="1669.75" data-end="1672.67">while we're traversing the completed</span> <span data-start="1672.67" data-end="1675.58">tree so it's like where we're going to</span> <span data-start="1675.58" data-end="1678.07">make the operations on the completed</span> <span data-start="1678.07" data-end="1680.5">tree but the logic that we're using to</span> <span data-start="1680.5" data-end="1684.31">base our operate are our actions is</span> <span data-start="1684.31" data-end="1686.08">actually coming from the predicate tree</span> <span data-start="1686.08" data-end="1687.79">we're making decisions about how we're</span> <span data-start="1687.79" data-end="1688.9">going to interact with the completed</span> <span data-start="1688.9" data-end="1693.1">tree based on things outside of the</span> <span data-start="1693.1" data-end="1694.42">scope of the complete the tree which is</span> <span data-start="1694.42" data-end="1697.84">kind of cool so let's try this one more</span> <span data-start="1697.84" data-end="1699.72">time I'll make sure I get this across</span> <span data-start="1699.72" data-end="1706.03">the jump node in the completed tree has</span> <span data-start="1706.03" data-end="1708.61">a reference to the sister element in the</span> <span data-start="1708.61" data-end="1711.01">predicate tree that's the one whose</span> <span data-start="1711.01" data-end="1713.83">index we really care about right so we</span> <span data-start="1713.83" data-end="1715">want to put run in</span> <span data-start="1715" data-end="1717.37">the completed tree relative to where it</span> <span data-start="1717.37" data-end="1719.74">belongs in the two dudes list we can't</span> <span data-start="1719.74" data-end="1721.12">put it before jump we can't put it</span> <span data-start="1721.12" data-end="1723.31">before skip or we can put it before hop</span> <span data-start="1723.31" data-end="1726.94">so when we compare the run node to the</span> <span data-start="1726.94" data-end="1728.74">jump node in the completed tree the jump</span> <span data-start="1728.74" data-end="1730.09">node currently thinks it's in the first</span> <span data-start="1730.09" data-end="1731.86">position but we know better it's</span> <span data-start="1731.86" data-end="1734.17">actually in the second position so</span> <span data-start="1734.17" data-end="1735.37">that's why we've referred to the</span> <span data-start="1735.37" data-end="1736.72">predicate tree and that's why the</span> <span data-start="1736.72" data-end="1738.34">predicate trees sole responsibility is</span> <span data-start="1738.34" data-end="1741.88">to maintain at the same order as it's</span> <span data-start="1741.88" data-end="1743.53">useless and you may ask like that seems</span> <span data-start="1743.53" data-end="1746.05">unnecessary like why would you just</span> <span data-start="1746.05" data-end="1748.84">duplicate all this data you know we we</span> <span data-start="1748.84" data-end="1751.39">already know that jump is the second</span> <span data-start="1751.39" data-end="1754.29">item in the to-do list except when</span> <span data-start="1754.29" data-end="1756.51">except you don't actually know that and</span> <span data-start="1756.51" data-end="1759.4">the best way to solve for it is actually</span> <span data-start="1759.4" data-end="1761.14">industry where we can just kind of keep</span> <span data-start="1761.14" data-end="1764.74">crawling up the binary tree and</span> <span data-start="1764.74" data-end="1766.9">recalculating all these left counts and</span> <span data-start="1766.9" data-end="1769.51">gap counts it's much faster than like</span> <span data-start="1769.51" data-end="1771.7">starting on one end iterating towards</span> <span data-start="1771.7" data-end="1775.87">your item you know finding the item and</span> <span data-start="1775.87" data-end="1778.54">saying oh we kept track of our index and</span> <span data-start="1778.54" data-end="1782.41">that's called an index of all right so</span> <span data-start="1782.41" data-end="1784.24">we can put our run node into the</span> <span data-start="1784.24" data-end="1788.35">completed tree that's exciting and then</span> <span data-start="1788.35" data-end="1790.45">knowing that the run node was added into</span> <span data-start="1790.45" data-end="1792.52">the completed tree at the second index</span> <span data-start="1792.52" data-end="1794.89">we can very efficiently say hey add one</span> </p>
<p><span data-start="1794.89" data-end="1799.02">Dom node to the node list and Dom land</span> <span data-start="1799.02" data-end="1804.74">so let's take a look at it</span> <span data-start="1804.75" data-end="1813.37">now I've got a dash mirror let's do this</span> <span data-start="1813.38" data-end="1816.89">excellent okay cool you guys can see</span> <span data-start="1816.89" data-end="1821.63">this I'll start this over so this is an</span> <span data-start="1821.63" data-end="1824.87">example of a source list on the far left</span> <span data-start="1824.87" data-end="1826.85">it's made up of a couple of items with</span> <span data-start="1826.85" data-end="1828.62">some random numbers generated and then</span> <span data-start="1828.62" data-end="1831.71">on the right or from there on every one</span> <span data-start="1831.71" data-end="1833.9">of these is a filtered variation of this</span> <span data-start="1833.9" data-end="1836.81">source list so the first one is all even</span> <span data-start="1836.81" data-end="1839.24">items from the source list that can jizz</span> <span data-start="1839.24" data-end="1841.58">all items from the source list the third</span> <span data-start="1841.58" data-end="1844.4">is all items less than 50 from the</span> <span data-start="1844.4" data-end="1845.99">source list and then the fourth is all</span> <span data-start="1845.99" data-end="1848.21">items greater than 50 from the sources</span> <span data-start="1848.21" data-end="1849.74">so if we remember our original example</span> <span data-start="1849.74" data-end="1851.39">in order to solve for this we'd have to</span> <span data-start="1851.39" data-end="1853.46">call filter for x which means we'd have</span> <span data-start="1853.46" data-end="1856.25">to iterate source for x which means we'd</span> <span data-start="1856.25" data-end="1858.08">have to go do some pretty clunky Dom</span> <span data-start="1858.08" data-end="1861.56">manipulation four times for every change</span> <span data-start="1861.56" data-end="1864.2">that happens to the source so if I were</span> <span data-start="1864.2" data-end="1867.11">to do this we would notice an item was</span> <span data-start="1867.11" data-end="1869.69">added calculate calculate even calculate</span> <span data-start="1869.69" data-end="1871.91">calculate odd so on and so forth but</span> <span data-start="1871.91" data-end="1874.76">because of the binary trees it's really</span> <span data-start="1874.76" data-end="1876.35">super efficient like we said earlier</span> <span data-start="1876.35" data-end="1878.27">logarithmic so I can do something like</span> <span data-start="1878.27" data-end="1884.39">this and we notice no lag at all that</span> <span data-start="1884.39" data-end="1885.89">was really fast right and I can keep</span> <span data-start="1885.89" data-end="1887.57">doing this watch the dots count at the</span> <span data-start="1887.57" data-end="1889.76">top which is going to go and go and go</span> <span data-start="1889.76" data-end="1891.65">and we can type them have my repaint</span> <span data-start="1891.65" data-end="1893.78">rate at the bottom it's doing pretty</span> <span data-start="1893.78" data-end="1896.36">good now we will see to drop off just</span> <span data-start="1896.36" data-end="1899.09">because the cost of the repaints is you</span> <span data-start="1899.09" data-end="1900.47">know going to get greater and greater as</span> <span data-start="1900.47" data-end="1904.55">more dom nodes are added but we know for</span> <span data-start="1904.55" data-end="1907.67">sure that on the JavaScript side we are</span> <span data-start="1907.67" data-end="1910.94">we're not taking an exorbitant amount of</span> <span data-start="1910.94" data-end="1912.95">extra time to accomplish it fast also we</span> <span data-start="1912.95" data-end="1915.4">can randomize all the items in the list</span> <span data-start="1915.4" data-end="1918.17">just jam on that and this is filtering</span> <span data-start="1918.17" data-end="1919.64">over and over and over and over and over</span> <span data-start="1919.64" data-end="1921.32">again every single time we change a</span> <span data-start="1921.32" data-end="1923.6">number on the left list it's filtering</span> <span data-start="1923.6" data-end="1924.95">and that would typically be really</span> <span data-start="1924.95" data-end="1929.39">expensive but it's not anymore let's go</span> <span data-start="1929.39" data-end="1934.43">to react this is react sorting the same</span> <span data-start="1934.43" data-end="1937.07">kind of lists right we've got the source</span> <span data-start="1937.07" data-end="1939.17">list even odd less than 50 greater than</span> <span data-start="1939.17" data-end="1940.1">50 forget</span> <span data-start="1940.1" data-end="1943.94">how many nodes we have here yeah it's</span> <span data-start="1943.94" data-end="1947.09">100 notes oh cool so let's bounce this</span> <span data-start="1947.09" data-end="1952.309">up to a thousand nodes so let's curl you</span> <span data-start="1952.309" data-end="1955.01">so you can see react struggling through</span> <span data-start="1955.01" data-end="1957.26">this list and it's a it's changing every</span> <span data-start="1957.26" data-end="1958.669">one of the numbers and we can't really</span> <span data-start="1958.669" data-end="1960.74">see it outside the screen but they</span> <span data-start="1960.74" data-end="1963.38">filtered lists that are based on where</span> <span data-start="1963.38" data-end="1964.789">that are derived from that source list</span> <span data-start="1964.789" data-end="1967.49">are updating removing items from them</span> <span data-start="1967.49" data-end="1969.289">adding items back in removing atoms</span> <span data-start="1969.289" data-end="1972.08">adding items from the items and it's</span> <span data-start="1972.08" data-end="1975.35">it's using our native array filter in</span> <span data-start="1975.35" data-end="1977.63">order to accomplish that right it's in a</span> <span data-start="1977.63" data-end="1982.28">pretty good job here's can derive the</span> <span data-start="1982.28" data-end="1983.929">project that I've been working on doing</span> <span data-start="1983.929" data-end="1987.08">the exact same thing it's managing to do</span> <span data-start="1987.08" data-end="1989.75">it at 50 frames a second though which is</span> <span data-start="1989.75" data-end="1992.03">a whole lot cooler let's go back to camp</span> <span data-start="1992.03" data-end="1997.789">to react this is 30 frames a second this</span> <span data-start="1997.789" data-end="2000.46">is 50 frames a second here's what</span> <span data-start="2000.46" data-end="2003.34">happens when we take the Dom out of the</span> <span data-start="2003.34" data-end="2005.919">equation we're just going to not display</span> <span data-start="2005.919" data-end="2014.89">any of these items well Oh a little bit</span> <span data-start="2014.89" data-end="2021">here</span> <span data-start="2021.01" data-end="2028.54">why aren't they hiding out so I'm not</span> <span data-start="2028.54" data-end="2032.2">thinking</span> <span data-start="2032.21" data-end="2035.22">ok now the Dom nodes are actually being</span> <span data-start="2035.22" data-end="2036.84">influenced but they're not being</span> <span data-start="2036.84" data-end="2039.51">repainted on the screen so this is</span> <span data-start="2039.51" data-end="2041.49">happening really fast if you guys can</span> <span data-start="2041.49" data-end="2044.01">see it's like 120 frames a second and</span> <span data-start="2044.01" data-end="2046.71">something like that or 120 operations a</span> <span data-start="2046.71" data-end="2050.27">second reacts doing the exact same thing</span> <span data-start="2050.27" data-end="2052.77">unfortunately it's limited by how fast</span> <span data-start="2052.77" data-end="2055.05">dot filter can chug through those items</span> <span data-start="2055.05" data-end="2057.75">and it really can't go any faster even</span> <span data-start="2057.75" data-end="2059.54">though the render is like you know</span> <span data-start="2059.54" data-end="2062.429">really intelligent and can make a lot of</span> <span data-start="2062.429" data-end="2065.37">smart decisions the filtering is what's</span> <span data-start="2065.37" data-end="2067.5">going to slow it down it can't go any</span> <span data-start="2067.5" data-end="2069.179">faster it still has to go through a</span> <span data-start="2069.179" data-end="2070.77">thousand items four times every time</span> <span data-start="2070.77" data-end="2073.14">single time there's a change and then</span> <span data-start="2073.14" data-end="2075.659">having do that means that items are</span> <span data-start="2075.659" data-end="2077.28">going to added remove from the Dom so on</span> <span data-start="2077.28" data-end="2080.07">and so forth so this is this is the</span> <span data-start="2080.07" data-end="2081.03">project I've been working on for six</span> <span data-start="2081.03" data-end="2082.649">months that's all I have to present for</span> <span data-start="2082.649" data-end="2084.36">you you guys have questions I'd love to</span> <span data-start="2084.36" data-end="2086.7">hear them it's sometimes really excited</span> <span data-start="2086.7" data-end="2088.32">about hopefully I'm gonna be releasing</span> <span data-start="2088.32" data-end="2089.94">it to you if you want to take a look at</span> <span data-start="2089.94" data-end="2096.27">it it's in a repo called can derive the</span> <span data-start="2096.27" data-end="2097.53">reason it's built on top of kin is</span> <span data-start="2097.53" data-end="2099.89">because we want to be able to observe</span> <span data-start="2099.89" data-end="2102.72">lists and maps and then also the</span> <span data-start="2102.72" data-end="2104.31">objective for the can drive project is</span> <span data-start="2104.31" data-end="2107.34">not specifically just to filter list the</span> <span data-start="2107.34" data-end="2109.29">goal is to make it super efficient to</span> <span data-start="2109.29" data-end="2111.33">update all sorts of data transform so</span> </p>
<p><span data-start="2111.33" data-end="2116.31">Maps group by and even sorting which is</span> <span data-start="2116.31" data-end="2118.2">a whole other conversation but anyway</span> <span data-start="2118.2" data-end="2119.22">thanks a lot guys I appreciate you</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
