<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BONVAOgovHM</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/BONVAOgovHM?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="7.28" data-end="9.29">[Applause]</span> <span data-start="9.29" data-end="11.849">I'm really excited to be kicking us off</span> <span data-start="11.849" data-end="14.219">today and I'm very excited because I'll</span> <span data-start="14.219" data-end="16.619">be talking about tamagotchis and es6</span> <span data-start="16.619" data-end="20.34">generators so quick recap I'm Jen I'm a</span> <span data-start="20.34" data-end="22.38">front-end architect at a company called</span> <span data-start="22.38" data-end="24.869">the wing we are based out of the United</span> <span data-start="24.869" data-end="26.91">States and we build co-working spaces</span> <span data-start="26.91" data-end="29.699">that are women first if you want to</span> <span data-start="29.699" data-end="32.13">reach me the best place is twitter my</span> <span data-start="32.13" data-end="35.7">handle is girl code girl with a u and at</span> <span data-start="35.7" data-end="37.5">the end I'm definitely gonna post these</span> <span data-start="37.5" data-end="39.6">slides so if you miss something do not</span> <span data-start="39.6" data-end="42.239">worry the slides are gonna be posted ok</span> <span data-start="42.239" data-end="47.889">how many of you had a tamagotchi</span> <span data-start="47.899" data-end="52.17">ok a good number of you so if you aren't</span> <span data-start="52.17" data-end="54.3">familiar with what a Tomahawk is it was</span> <span data-start="54.3" data-end="56.94">a really popular digital pet in the</span> <span data-start="56.94" data-end="59.879">1990s it was a handheld device like this</span> <span data-start="59.879" data-end="63.149">and the game was that a Tamagotchi would</span> <span data-start="63.149" data-end="65.97">appear on the screen in a shell it would</span> <span data-start="65.97" data-end="68.64">break out of its egg and then you were</span> <span data-start="68.64" data-end="70.74">responsible for raising the Tamagotchi</span> <span data-start="70.74" data-end="72.78">to adulthood so it would go from a baby</span> <span data-start="72.78" data-end="75.63">like this to a teenager to an adult and</span> <span data-start="75.63" data-end="77.67">then when it became an adult you didn't</span> <span data-start="77.67" data-end="79.5">know what type of Tamagotchi you were</span> <span data-start="79.5" data-end="81.479">gonna get so that was like the fun</span> <span data-start="81.479" data-end="84.33">surprise of it now I had a Tamagotchi</span> <span data-start="84.33" data-end="86.4">growing up in fact they were even banned</span> <span data-start="86.4" data-end="88.56">from my school because they made a</span> <span data-start="88.56" data-end="90.09">beeping sound when they need something</span> <span data-start="90.09" data-end="93">from you and unfortunately that meant a</span> <span data-start="93" data-end="94.59">lot of my Tamagotchis didn't make it</span> <span data-start="94.59" data-end="99">rest in peace but I really really love</span> <span data-start="99" data-end="101.159">this game growing up and I decided I</span> <span data-start="101.159" data-end="103.38">want to make a web based version of it</span> <span data-start="103.38" data-end="107.04">so my web-based version includes an SVG</span> <span data-start="107.04" data-end="110.1">shell for the game the controls are</span> <span data-start="110.1" data-end="112.619">actually made out of divs and then the</span> <span data-start="112.619" data-end="115.64">screen is made out of the canvas element</span> <span data-start="115.64" data-end="117.659">now if you've never worked with the</span> <span data-start="117.659" data-end="119.939">canvas element it's really easy to work</span> <span data-start="119.939" data-end="122.7">with you're going to query the Dom for</span> <span data-start="122.7" data-end="125.13">the canvas element and then to draw on</span> <span data-start="125.13" data-end="126.93">the canvas you're going to request the</span> <span data-start="126.93" data-end="129">type of context that you want so in this</span> <span data-start="129" data-end="132.36">case we want to D not 3d and then you're</span> <span data-start="132.36" data-end="132.79">gonna</span> <span data-start="132.79" data-end="136.689">an image to draw and some XY coordinates</span> <span data-start="136.689" data-end="137.89">that I'm really not going to get into</span> <span data-start="137.89" data-end="138.97">right now because they don't matter as</span> <span data-start="138.97" data-end="142.15">much and you're gonna do draw image that</span> <span data-start="142.15" data-end="143.5">image to the screen so you can see that</span> <span data-start="143.5" data-end="146.97">my Tamagotchi is drawn to the screen and</span> <span data-start="146.97" data-end="150.22">then for the animations in the game I</span> <span data-start="150.22" data-end="153.549">decided I want to use a sprite sheet so</span> <span data-start="153.549" data-end="155.739">below is the sprite to bounce the</span> </p>
<p><span data-start="155.739" data-end="157.9">Tamagotchi so if you go one two three</span> <span data-start="157.9" data-end="161.739">I'll go up so if I need to animate this</span> <span data-start="161.739" data-end="165.01">I need to draw it at zero and then 200</span> <span data-start="165.01" data-end="168.04">and then 400 pixels so that's going to</span> <span data-start="168.04" data-end="170.019">bounce the Tamagotchi up and then I</span> <span data-start="170.019" data-end="171.609">would do those coordinates the opposite</span> <span data-start="171.609" data-end="175.12">way to go down now you'll also notice</span> <span data-start="175.12" data-end="177.97">that I'm using context clear between the</span> <span data-start="177.97" data-end="179.98">drawings and that is to avoid this</span> <span data-start="179.98" data-end="183.579">situation so if you don't clear between</span> <span data-start="183.579" data-end="185.59">your drawings they just draw right on</span> <span data-start="185.59" data-end="187.629">top of each other so you always draw and</span> <span data-start="187.629" data-end="190.51">then clear and so the way this code is</span> <span data-start="190.51" data-end="193.81">written this this isn't going to work so</span> </p>
<p><span data-start="193.81" data-end="196.389">I'm pressing one of the controls and as</span> <span data-start="196.389" data-end="198.97">you see the Tamagotchi is just one of</span> <span data-start="198.97" data-end="201.16">the frames being drawn and that's</span> <span data-start="201.16" data-end="202.87">because we're drawing and clearing the</span> <span data-start="202.87" data-end="206.079">contact so quickly that you only see the</span> <span data-start="206.079" data-end="208.12">last frame being drawn you're not gonna</span> <span data-start="208.12" data-end="210.579">see the other ones so what I actually</span> <span data-start="210.579" data-end="213.76">need to do with this animation is that I</span> <span data-start="213.76" data-end="217.449">need to delay it so the original game</span> <span data-start="217.449" data-end="219.669">has this really old school like choppy</span> <span data-start="219.669" data-end="222.549">animation so that's what I want to do I</span> <span data-start="222.549" data-end="225.34">want to delay it like that and I can use</span> <span data-start="225.34" data-end="228.31">set timeout to do this and this works so</span> <span data-start="228.31" data-end="230.47">now you can see the Tamagotchi is</span> <span data-start="230.47" data-end="232.299">bouncing up and down I'm going from</span> <span data-start="232.299" data-end="234.579">frame 1 2 3 and then back for a full</span> <span data-start="234.579" data-end="238.09">bounce but you know this has actually</span> <span data-start="238.09" data-end="241">created a problem for me because now all</span> <span data-start="241" data-end="245.65">of my animations are async so you know</span> <span data-start="245.65" data-end="247.629">how do I know when an animation has</span> <span data-start="247.629" data-end="249.699">completed how do I know when I can</span> <span data-start="249.699" data-end="251.59">safely kick off another animation</span> <span data-start="251.59" data-end="254.5">without overwriting the previous one the</span> <span data-start="254.5" data-end="256.09">truth is I don't I'd have to sort of</span> <span data-start="256.09" data-end="258.28">measure and keep track of how long these</span> <span data-start="258.28" data-end="260.709">animations take and that's just not</span> <span data-start="260.709" data-end="263.229">sustainable for a game that is full of</span> <span data-start="263.229" data-end="264.44">animations</span> <span data-start="264.44" data-end="267.95">what I want is to resolve an animation</span> <span data-start="267.95" data-end="271.1">and then handle another animation and</span> <span data-start="271.1" data-end="273.71">this sounds a lot like a promise</span> <span data-start="273.71" data-end="277.16">now promises represent eventual values</span> <span data-start="277.16" data-end="280.16">so I can animate inside of a promise</span> <span data-start="280.16" data-end="283.1">resolve it and because it's a venable I</span> <span data-start="283.1" data-end="287.87">can then kick off another animation so</span> <span data-start="287.87" data-end="289.73">for the first version of this game</span> <span data-start="289.73" data-end="291.32">that's exactly what I did</span> </p>
<p><span data-start="291.32" data-end="294.56">I used promises for every animation I</span> <span data-start="294.56" data-end="297.31">made a general purpose animate function</span> <span data-start="297.31" data-end="300.14">that takes in a draw function and the</span> <span data-start="300.14" data-end="302.96">milliseconds for the delay so animate</span> <span data-start="302.96" data-end="305.96">always returns a new promise and inside</span> <span data-start="305.96" data-end="308.9">of that promise an inner function runs</span> <span data-start="308.9" data-end="311.51">the draw function and we delegate</span> <span data-start="311.51" data-end="313.28">resolving the promise to the draw</span> <span data-start="313.28" data-end="316.04">function so if the draw resolves the</span> <span data-start="316.04" data-end="318.34">promise and returns true we're done</span> <span data-start="318.34" data-end="321.62">otherwise set timeout is called with the</span> <span data-start="321.62" data-end="324.32">inner function and another loop of this</span> <span data-start="324.32" data-end="328.37">occurs so here we're going to use the</span> <span data-start="328.37" data-end="330.56">animate function to create a bounce up</span> <span data-start="330.56" data-end="333.32">animation we're gonna pass a function</span> <span data-start="333.32" data-end="335.12">that draws the correct frame it's gonna</span> <span data-start="335.12" data-end="337.34">clear the context it's gonna increment</span> <span data-start="337.34" data-end="339.86">the current frame and when the current</span> <span data-start="339.86" data-end="341.81">frame is greater than the frame count</span> <span data-start="341.81" data-end="344.419">the promise is resolved and we return</span> <span data-start="344.419" data-end="347.24">true now this would stop the function</span> <span data-start="347.24" data-end="349.16">from setting another loop via set</span> <span data-start="349.16" data-end="352.88">timeout so now we can create a simple</span> <span data-start="352.88" data-end="355.19">bounce function using our bounce up</span> <span data-start="355.19" data-end="357.8">animation and it bounced down animation</span> <span data-start="357.8" data-end="360.32">using the same animate function and as</span> <span data-start="360.32" data-end="362.89">you can see our Tamagotchi is bouncing</span> <span data-start="362.89" data-end="365.93">now with those animations out of the way</span> <span data-start="365.93" data-end="368.21">what we need to work on is creating the</span> <span data-start="368.21" data-end="371.24">main game loop so when you're not</span> <span data-start="371.24" data-end="373.91">interacting with the Tamagotchi it goes</span> <span data-start="373.91" data-end="375.83">through a loop it sort of bounces up and</span> <span data-start="375.83" data-end="377.81">down moves a bit this way moves it that</span> <span data-start="377.81" data-end="379.669">bit that way it bounces up and down and</span> <span data-start="379.669" data-end="382.28">this is what it's doing when it's idling</span> <span data-start="382.28" data-end="384.07">when you're not doing anything with it</span> <span data-start="384.07" data-end="387.05">so to setup that we're going to create a</span> <span data-start="387.05" data-end="389">loop function and we're going to call</span> <span data-start="389" data-end="391.22">the idle animation and when that</span> <span data-start="391.22" data-end="393.2">completes we're gonna call the loop</span> <span data-start="393.2" data-end="394.55">function again</span> <span data-start="394.55" data-end="398.09">and I thought this is great totally fine</span> <span data-start="398.09" data-end="401.56">except I actually created more problems</span> <span data-start="401.56" data-end="406.52">so the first issue that I noticed is</span> <span data-start="406.52" data-end="410.659">what I refer to as Venable hell so once</span> <span data-start="410.659" data-end="413.599">upon a time we used to use async calls</span> <span data-start="413.599" data-end="416.479">on the front end with callbacks and this</span> <span data-start="416.479" data-end="419.24">created the dreaded triangle of doom aka</span> <span data-start="419.24" data-end="422.449">callback hell but one of the issues I</span> <span data-start="422.449" data-end="424.699">noticed when creating this game was that</span> <span data-start="424.699" data-end="426.979">promises actually don't alleviate</span> <span data-start="426.979" data-end="430.789">callback hell you're still in hell it's</span> <span data-start="430.789" data-end="434.33">just a different looking hell so you</span> <span data-start="434.33" data-end="435.979">know the left side is a more realistic</span> <span data-start="435.979" data-end="438.44">version of how these animations might</span> <span data-start="438.44" data-end="441.349">work I mean might need to pass in some</span> <span data-start="441.349" data-end="443.509">information to functions or check</span> <span data-start="443.509" data-end="446.36">information to make a decision and this</span> <span data-start="446.36" data-end="448.19">gets just as unwieldy and as</span> <span data-start="448.19" data-end="450.77">unmanageable as callback hell you know</span> <span data-start="450.77" data-end="452.719">this doesn't resolve that issue for me</span> <span data-start="452.719" data-end="455.479">and you know I actually really love</span> <span data-start="455.479" data-end="457.009">promises I think they're really great</span> <span data-start="457.009" data-end="458.99">but when you're using them for very</span> <span data-start="458.99" data-end="461.78">large-scale async work the ease of</span> <span data-start="461.78" data-end="467.21">promises really tends to break down so</span> <span data-start="467.21" data-end="469.52">you know the point of the tamagotchi is</span> <span data-start="469.52" data-end="471.469">that the user can interact with it and</span> <span data-start="471.469" data-end="473.87">this is where we come up with our second</span> <span data-start="473.87" data-end="475.52">issue that I found because Venable hell</span> <span data-start="475.52" data-end="477.05">is one thing this is a completely</span> <span data-start="477.05" data-end="479.69">different thing now it's it's looping</span> <span data-start="479.69" data-end="482.09">it's idling I need to interrupt that at</span> <span data-start="482.09" data-end="483.979">some point because you're gonna have to</span> <span data-start="483.979" data-end="486.02">feed the Tamagotchi at some point or</span> <span data-start="486.02" data-end="487.58">play with the Tamagotchi to up its</span> <span data-start="487.58" data-end="489.68">happiness the whole game is actually</span> <span data-start="489.68" data-end="491.389">about you interacting with the</span> </p>
<p><span data-start="491.389" data-end="494.33">Tamagotchi so what I need to do is I</span> <span data-start="494.33" data-end="496.699">need to suspend the idle animation in</span> <span data-start="496.699" data-end="500.24">favor of a user-generated event so if</span> <span data-start="500.24" data-end="501.409">you want to feed the Tamagotchi I gotta</span> <span data-start="501.409" data-end="503.449">stop idle and then you can feed the</span> <span data-start="503.449" data-end="504.05">Tamagotchi</span> <span data-start="504.05" data-end="506.84">so here I've added an array to hold</span> <span data-start="506.84" data-end="509.84">pending events the loop function is</span> <span data-start="509.84" data-end="511.58">going to check if there are any pending</span> <span data-start="511.58" data-end="514.37">events and if there are the handle event</span> <span data-start="514.37" data-end="516.349">function is run and the loop is</span> <span data-start="516.349" data-end="519.589">terminated so handle event is going to</span> <span data-start="519.589" data-end="521.479">take the first event off the queue and</span> <span data-start="521.479" data-end="523.49">it's going to run it and when it's</span> <span data-start="523.49" data-end="524.99">complete we're gonna restart the loop</span> <span data-start="524.99" data-end="526.94">and if there's another event in the</span> <span data-start="526.94" data-end="527.31">queue</span> <span data-start="527.31" data-end="529.249">handle event will get called again</span> <span data-start="529.249" data-end="531.389">otherwise we're gonna continue the loop</span> <span data-start="531.389" data-end="535.139">until the next event and unfortunately</span> <span data-start="535.139" data-end="537.12">the problem that I found was that this</span> <span data-start="537.12" data-end="540.48">just doesn't work so I'm requesting to</span> <span data-start="540.48" data-end="541.56">feed the Tamagotchi</span> <span data-start="541.56" data-end="543.87">but the feed animation is actually</span> <span data-start="543.87" data-end="546.05">delayed until the idle animation</span> <span data-start="546.05" data-end="549.269">completes so this can be upwards of</span> <span data-start="549.269" data-end="551.699">seven to eight seconds and this is not</span> <span data-start="551.699" data-end="554.16">going to work what I actually need to do</span> <span data-start="554.16" data-end="556.829">is cancel the promise that runs the idle</span> <span data-start="556.829" data-end="559.68">animation except you can't cancel</span> <span data-start="559.68" data-end="564.259">promises promises are unbreakable vows</span> <span data-start="564.259" data-end="567.18">you can throw errors and promises and</span> <span data-start="567.18" data-end="569.639">you can catch those errors but you can't</span> <span data-start="569.639" data-end="572.67">actually cancel a promise all the</span> <span data-start="572.67" data-end="575.249">attached then functions are going to</span> <span data-start="575.249" data-end="579.509">fire what I want actually is to pause an</span> <span data-start="579.509" data-end="582.3">animation and then yield to an event and</span> <span data-start="582.3" data-end="585.6">this sounds a lot like a generator so</span> <span data-start="585.6" data-end="587.699">generators are amazing because their</span> <span data-start="587.699" data-end="590.879">code that can be paused all of the code</span> <span data-start="590.879" data-end="592.829">that you write is run to completion</span> <span data-start="592.829" data-end="596.309">except for generators all the code that</span> <span data-start="596.309" data-end="598.079">you write usually once it starts it just</span> <span data-start="598.079" data-end="600.48">goes from top down to the bottom even if</span> <span data-start="600.48" data-end="602.879">you're doing async work it's thrown on</span> <span data-start="602.879" data-end="604.98">to the event loop and it's going to come</span> <span data-start="604.98" data-end="607.529">back around you can't cancel it or pause</span> <span data-start="607.529" data-end="608.04">it</span> <span data-start="608.04" data-end="611.79">but with generators you can do both so</span> <span data-start="611.79" data-end="615.449">let's take a look at them this is a</span> <span data-start="615.449" data-end="617.759">generator and I know it's a generator</span> <span data-start="617.759" data-end="620.04">because of the asterisk next to the</span> <span data-start="620.04" data-end="623.16">function keyword so that turns a</span> <span data-start="623.16" data-end="626.129">function into a function generator now</span> <span data-start="626.129" data-end="627.839">inside the function you're going to</span> <span data-start="627.839" data-end="629.91">notice a special keyword called yield</span> <span data-start="629.91" data-end="633.149">and yield means pause in the generator</span> <span data-start="633.149" data-end="636.75">world to use the generator you're going</span> <span data-start="636.75" data-end="638.759">to call it and that's going to return to</span> <span data-start="638.759" data-end="641.85">you the generator object and on that</span> <span data-start="641.85" data-end="645.12">object is a method called next and when</span> <span data-start="645.12" data-end="646.86">you call next you're gonna get back an</span> <span data-start="646.86" data-end="649.769">object with two keys on it value and</span> <span data-start="649.769" data-end="653.279">done if there is a value to the right of</span> <span data-start="653.279" data-end="655.62">the yield statement it's going to return</span> <span data-start="655.62" data-end="658.559">that as the value done is going to tell</span> <span data-start="658.559" data-end="660.1">you whether the generator is</span> <span data-start="660.1" data-end="662.259">or not and in this case it's not because</span> <span data-start="662.259" data-end="666.279">there are more lines to run okay so</span> <span data-start="666.279" data-end="668.35">we're gonna call next again see now</span> <span data-start="668.35" data-end="670.54">we're not actually yielding a number you</span> <span data-start="670.54" data-end="672.699">don't have to yield a value if you don't</span> <span data-start="672.699" data-end="675.459">want to yield just means pause generally</span> <span data-start="675.459" data-end="678.04">so in this case the value is</span> <span data-start="678.04" data-end="680.949">and again we're not done yet so done is</span> <span data-start="680.949" data-end="683.05">false we call again</span> <span data-start="683.05" data-end="684.91">now we're yielding back three so the</span> <span data-start="684.91" data-end="687.279">value is three but done is still not</span> <span data-start="687.279" data-end="690.13">false because we've paused at yield</span> <span data-start="690.13" data-end="693.61">three so once we call next again now the</span> <span data-start="693.61" data-end="695.56">generator is gonna say yes we're</span> <span data-start="695.56" data-end="697.42">actually done so we didn't yield a value</span> <span data-start="697.42" data-end="701.47">and now done is actually true now you</span> <span data-start="701.47" data-end="704.079">can also pass values into a generator</span> <span data-start="704.079" data-end="708.279">and this seems a little bit weird at</span> <span data-start="708.279" data-end="710.139">first because you'll notice that the</span> <span data-start="710.139" data-end="711.97">first time we call next we're not</span> <span data-start="711.97" data-end="714.49">passing in a value we're actually doing</span> <span data-start="714.49" data-end="717.069">it in the second call now the reason</span> <span data-start="717.069" data-end="719.5">that this happens is that inside of this</span> <span data-start="719.5" data-end="721.93">generator function once it hits the</span> <span data-start="721.93" data-end="725.11">yield statement it pauses and that</span> <span data-start="725.11" data-end="727.93">includes assigning things to variables</span> <span data-start="727.93" data-end="731.47">so Const num equals hasn't actually been</span> <span data-start="731.47" data-end="734.5">called yet it actually yields it pauses</span> <span data-start="734.5" data-end="737.079">before you actually assign the variable</span> <span data-start="737.079" data-end="741.04">now when I call next again if I provide</span> <span data-start="741.04" data-end="744.04">a value to it it's gonna take the place</span> <span data-start="744.04" data-end="748.18">of the previous yield so now continum</span> <span data-start="748.18" data-end="751.089">equals that yield is replaced with a2</span> <span data-start="751.089" data-end="753.639">and now we've assigned the variable and</span> <span data-start="753.639" data-end="757.36">then we also run yield 2 plus num it</span> <span data-start="757.36" data-end="760.449">pauses there and gives us back the value</span> <span data-start="760.449" data-end="764.949">for after that yield 4 plus num and now</span> <span data-start="764.949" data-end="768.61">we're getting back the value 6 then we</span> <span data-start="768.61" data-end="771.29">call next and we're done</span> <span data-start="771.29" data-end="773.43">one of my favorite things about</span> <span data-start="773.43" data-end="774.959">generators is that you can create</span> <span data-start="774.959" data-end="779.309">infinite generators so here to avoid</span> <span data-start="779.309" data-end="781.35">having to call next and the next again</span> <span data-start="781.35" data-end="783.569">and passing the two we can just straight</span> <span data-start="783.569" data-end="787.17">up pass in as an argument for the number</span> <span data-start="787.17" data-end="789.449">two so right away when we're calling the</span> <span data-start="789.449" data-end="791.54">generator we can pass something in and</span> <span data-start="791.54" data-end="794.009">you'll notice that inside of this we</span> <span data-start="794.009" data-end="796.92">have a while loop now normally doing</span> <span data-start="796.92" data-end="800.49">while true is going to run continuously</span> <span data-start="800.49" data-end="802.589">and crash our browser I know because</span> </p>
<p><span data-start="802.589" data-end="804.86">I've made that mistake more than once</span> <span data-start="804.86" data-end="808.199">and but in this case actually that's not</span> <span data-start="808.199" data-end="809.04">going to happen</span> <span data-start="809.04" data-end="810.6">so this is really interesting the</span> <span data-start="810.6" data-end="812.459">generator is actually going to pause the</span> <span data-start="812.459" data-end="815.249">while loop and it's not going to run</span> <span data-start="815.249" data-end="817.55">continuously and crash our browser and</span> <span data-start="817.55" data-end="820.439">every time that this gets called next on</span> <span data-start="820.439" data-end="820.8">it</span> <span data-start="820.8" data-end="823.8">we're running the while loop again so it</span> <span data-start="823.8" data-end="825.689">pauses it and when we call next is going</span> <span data-start="825.689" data-end="827.97">to resume and because while is true it's</span> <span data-start="827.97" data-end="831.949">going to give us back the number now I</span> <span data-start="831.949" data-end="835.139">can just keep calling next on this for</span> <span data-start="835.139" data-end="838.29">as long as I want there we go</span> <span data-start="838.29" data-end="841.709">it's just gonna keep generating numbers</span> <span data-start="841.709" data-end="844.29">for me it's never going to stop until I</span> <span data-start="844.29" data-end="847.35">explicitly tell it to stop but you can</span> <span data-start="847.35" data-end="849.179">create infinite generators that always</span> <span data-start="849.179" data-end="853.439">gave you something back now you can also</span> <span data-start="853.439" data-end="855.749">call a generator from inside of another</span> <span data-start="855.749" data-end="857.939">generator to do that you're gonna need</span> <span data-start="857.939" data-end="863.399">the yield star expression to illustrate</span> <span data-start="863.399" data-end="865.709">that I have a function a generator</span> <span data-start="865.709" data-end="867.72">function called outer and a generator</span> <span data-start="867.72" data-end="870.179">function called inner and you'll notice</span> <span data-start="870.179" data-end="872.879">that outer is calling inner with the</span> <span data-start="872.879" data-end="876.6">yield star expression in front of it so</span> <span data-start="876.6" data-end="878.759">same as before I'm going to call the</span> <span data-start="878.759" data-end="882.72">generator to get the generator object</span> <span data-start="882.73" data-end="885.4">then I'm gonna call dot next on that</span> <span data-start="885.4" data-end="888.28">generator and the first time this you</span> <span data-start="888.28" data-end="890.17">know totally makes sense what we expect</span> <span data-start="890.17" data-end="893.2">to happen happens we're yielding one so</span> <span data-start="893.2" data-end="894.97">we're getting back the value one and of</span> <span data-start="894.97" data-end="897.36">course we're not done yet</span> <span data-start="897.36" data-end="900.4">but when I call next again you're gonna</span> <span data-start="900.4" data-end="903.16">notice that we're not yielding back a</span> <span data-start="903.16" data-end="905.35">function what we're actually doing is</span> <span data-start="905.35" data-end="907.24">we're going inside of the inter</span> <span data-start="907.24" data-end="910.6">generator so yield star is a delegate</span> <span data-start="910.6" data-end="913.33">and that means when it encounters a</span> <span data-start="913.33" data-end="915.73">yield star with a generator next to it</span> <span data-start="915.73" data-end="917.59">it's actually going to start calling dot</span> <span data-start="917.59" data-end="920.98">next as if that generator was part of</span> <span data-start="920.98" data-end="922">the outer generator</span> <span data-start="922" data-end="924.55">so now when I call dot next I'm actually</span> <span data-start="924.55" data-end="927.58">getting yield a value a from the inner</span> <span data-start="927.58" data-end="930.22">generator and this is going to continue</span> <span data-start="930.22" data-end="932.8">until the inner generator is complete</span> <span data-start="932.8" data-end="935.8">and then it's gonna go back to the outer</span> <span data-start="935.8" data-end="938.41">generator so it's a seamless calling of</span> <span data-start="938.41" data-end="939.97">dot next even though you're putting</span> <span data-start="939.97" data-end="943.44">together two different generators now</span> <span data-start="943.44" data-end="945.67">the other thing that's really cool and</span> <span data-start="945.67" data-end="946.99">the thing that I really wanted out of</span> <span data-start="946.99" data-end="948.91">the generators is that you can cancel</span> <span data-start="948.91" data-end="952.2">them and you can do this one of two ways</span> <span data-start="952.2" data-end="957.19">so the first is that you can call from</span> <span data-start="957.19" data-end="963.91">the outside denied that's right sorry</span> </p>
<p><span data-start="963.91" data-end="965.43">I'm having a hard time with the clicker</span> <span data-start="965.43" data-end="969.91">so here again we have a while loop so it</span> <span data-start="969.91" data-end="972.13">should say while true and it should run</span> <span data-start="972.13" data-end="974.47">for forever but I'm actually going to</span> <span data-start="974.47" data-end="976.63">cancel the generator from inside of the</span> <span data-start="976.63" data-end="979.54">generator and I'm gonna do that with the</span> <span data-start="979.54" data-end="982.15">return statement here so the first time</span> <span data-start="982.15" data-end="984.58">I call next we get what we expect but as</span> <span data-start="984.58" data-end="986.5">soon as it hits a return statement in a</span> <span data-start="986.5" data-end="988.42">generator it's gonna cancel it and</span> <span data-start="988.42" data-end="990.1">you'll notice that it just goes straight</span> <span data-start="990.1" data-end="992.86">to done true and of course we're not</span> <span data-start="992.86" data-end="996.82">yielding a value same thing when we call</span> <span data-start="996.82" data-end="998.71">dot next we've cancelled this generator</span> <span data-start="998.71" data-end="1001.38">so there's no way for it to keep running</span> <span data-start="1001.38" data-end="1004.49">anymore this is actually done completely</span> <span data-start="1004.49" data-end="1008.16">now the second way to cancel a generator</span> <span data-start="1008.16" data-end="1010.47">is from outside of that generator again</span> <span data-start="1010.47" data-end="1012.9">a while loop this should run for forever</span> <span data-start="1012.9" data-end="1016.019">but as soon as I call generator dot</span> <span data-start="1016.019" data-end="1018.779">turn on it it's going to cancel it so</span> <span data-start="1018.779" data-end="1020.759">you can see again that done is now true</span> <span data-start="1020.759" data-end="1023.67">and this is really interesting that you</span> <span data-start="1023.67" data-end="1026.76">can cancel a generator from inside or</span> <span data-start="1026.76" data-end="1029.1">from outside of the generator because</span> <span data-start="1029.1" data-end="1031.89">resuming the generator occurs on the</span> <span data-start="1031.89" data-end="1035.309">outside of the generator only so</span> <span data-start="1035.309" data-end="1037.939">generators are paused via yield and</span> <span data-start="1037.939" data-end="1041.399">restarted via next but a generator</span> <span data-start="1041.399" data-end="1044.819">cannot call next on itself if I never</span> <span data-start="1044.819" data-end="1047.459">call next on this generator it will</span> <span data-start="1047.459" data-end="1050.46">never yield to and this is something I</span> <span data-start="1050.46" data-end="1052.59">really struggled with when I started to</span> <span data-start="1052.59" data-end="1054.84">convert my game from promises to</span> <span data-start="1054.84" data-end="1057.75">generators because I wanted to know who</span> <span data-start="1057.75" data-end="1061.279">runs the generator if control happens</span> <span data-start="1061.279" data-end="1064.14">outside of the generator something has</span> <span data-start="1064.14" data-end="1066.899">to be telling it to resume itself who's</span> <span data-start="1066.899" data-end="1070.409">pulling the strings and that tie learned</span> <span data-start="1070.409" data-end="1071.929">about co-routines</span> <span data-start="1071.929" data-end="1074.7">core genes are really cool I'm a big fan</span> <span data-start="1074.7" data-end="1077.25">of them they are a general control</span> <span data-start="1077.25" data-end="1079.649">structure whereby control flow is</span> <span data-start="1079.649" data-end="1081.84">cooperatively passed between two</span> <span data-start="1081.84" data-end="1084.659">different routines and this doesn't make</span> <span data-start="1084.659" data-end="1087.33">a lot of sense but it will soon because</span> <span data-start="1087.33" data-end="1091.11">the generator can't resume itself you</span> <span data-start="1091.11" data-end="1093.57">need a cooperative partner to help out</span> <span data-start="1093.57" data-end="1095.76">so something has to take control away</span> <span data-start="1095.76" data-end="1098.1">from the generator but then also hand it</span> <span data-start="1098.1" data-end="1099.72">back to the generator to run its own</span> <span data-start="1099.72" data-end="1104.52">code so this function is a basic example</span> <span data-start="1104.52" data-end="1107.07">of a Co routine so it's gonna take in a</span> <span data-start="1107.07" data-end="1108.899">generator and it's going to call it</span> <span data-start="1108.899" data-end="1111.5">which returns the generator object and</span> <span data-start="1111.5" data-end="1114.69">then the inner function next response</span> <span data-start="1114.69" data-end="1117.72">calls the generators next method so this</span> <span data-start="1117.72" data-end="1119.159">is going to actually start up the</span> <span data-start="1119.159" data-end="1121.11">generator which will run until it</span> <span data-start="1121.11" data-end="1124.049">encounters a yield statement at that</span> <span data-start="1124.049" data-end="1126.149">time the generator is going to return an</span> <span data-start="1126.149" data-end="1128.19">object with the value key and the done</span> <span data-start="1128.19" data-end="1130.679">key and next response is going to</span> <span data-start="1130.679" data-end="1132.87">evaluate whether the generator is done</span> <span data-start="1132.87" data-end="1135.929">or not and if it's not it's gonna call</span> <span data-start="1135.929" data-end="1137.37">itself with the value from the</span> <span data-start="1137.37" data-end="1139.529">generators response and the loop is</span> <span data-start="1139.529" data-end="1141.87">going to continue until the generator is</span> <span data-start="1141.87" data-end="1144.13">done so</span> <span data-start="1144.13" data-end="1145.78">the co-routine is the cooperative</span> <span data-start="1145.78" data-end="1148.21">partner to the generator the curb</span> <span data-start="1148.21" data-end="1150.309">routine function passes control to the</span> <span data-start="1150.309" data-end="1152.799">generator and when the generator pauses</span> <span data-start="1152.799" data-end="1155.65">control goes back to the co routine and</span> <span data-start="1155.65" data-end="1158.14">these two functions cooperatively pass</span> <span data-start="1158.14" data-end="1165.309">control until completion so now I can</span> <span data-start="1165.309" data-end="1167.74">rewrite the bounce up animation as a</span> <span data-start="1167.74" data-end="1170.89">generator and use a KO routine to</span> <span data-start="1170.89" data-end="1173.44">actually run it but this code actually</span> <span data-start="1173.44" data-end="1175.33">suffers from the same problem I had in</span> <span data-start="1175.33" data-end="1177.46">the beginning so it's just gonna go too</span> <span data-start="1177.46" data-end="1181.99">fast there we go so you can see it's</span> <span data-start="1181.99" data-end="1183.61">doing what it did in the beginning which</span> <span data-start="1183.61" data-end="1186.159">is just it writes too fast and that's</span> <span data-start="1186.159" data-end="1187.96">because generators aren't really gonna</span> <span data-start="1187.96" data-end="1191.23">resolve my issues with set timeout and</span> <span data-start="1191.23" data-end="1193.87">promises I actually still need them to</span> <span data-start="1193.87" data-end="1197.95">be able to handle delays but generators</span> <span data-start="1197.95" data-end="1199.27">don't really care if you're using</span> <span data-start="1199.27" data-end="1202.21">promises so it's not gonna wait for each</span> <span data-start="1202.21" data-end="1205.09">promise to resolve and then resume</span> <span data-start="1205.09" data-end="1208.87">itself it can't resume itself but a</span> <span data-start="1208.87" data-end="1213.13">cooperative partner could so I can amend</span> <span data-start="1213.13" data-end="1215.53">the KO routine to handle async requests</span> <span data-start="1215.53" data-end="1218.26">instead of calling next response we're</span> <span data-start="1218.26" data-end="1220.27">gonna call it a handle async function</span> <span data-start="1220.27" data-end="1222.61">we're gonna pass it the value of the</span> <span data-start="1222.61" data-end="1224.44">generators response which is a promise</span> <span data-start="1224.44" data-end="1227.62">and now we can actually prevent the</span> <span data-start="1227.62" data-end="1229.659">generator from resuming until the</span> <span data-start="1229.659" data-end="1231.88">promise is resolved and when it's</span> <span data-start="1231.88" data-end="1234.039">resolved we're gonna call next response</span> <span data-start="1234.039" data-end="1237.49">which will resume the generator so with</span> <span data-start="1237.49" data-end="1239.799">our amended KO routine these functions</span> <span data-start="1239.799" data-end="1242.74">are now equivalent previously we change</span> <span data-start="1242.74" data-end="1244.929">promises together for the animation now</span> <span data-start="1244.929" data-end="1247.48">we can yield promises and our</span> <span data-start="1247.48" data-end="1249.46">cooperative partner the KO routine is</span> <span data-start="1249.46" data-end="1251.35">going to handle resuming the generator</span> <span data-start="1251.35" data-end="1254.77">when the promise is resolved now you can</span> <span data-start="1254.77" data-end="1256.75">do more than yield promises with</span> <span data-start="1256.75" data-end="1258.789">co-routines you can yield all sorts of</span> <span data-start="1258.789" data-end="1260.77">async things including callback</span> <span data-start="1260.77" data-end="1263.02">functions you can also yield generators</span> <span data-start="1263.02" data-end="1264.97">themselves and there's a really great</span> <span data-start="1264.97" data-end="1267.01">library called ko if you want to play</span> <span data-start="1267.01" data-end="1270.07">around with this it's highly recommended</span> </p>
<p><span data-start="1270.07" data-end="1274.03">Kuro jeans are very powerful and the</span> <span data-start="1274.03" data-end="1275.98">reason that they're so powerful is that</span> <span data-start="1275.98" data-end="1277.03">they allow you to think</span> <span data-start="1277.03" data-end="1280.18">sequentially about async code so because</span> <span data-start="1280.18" data-end="1281.8">the co-routine is your cooperative</span> <span data-start="1281.8" data-end="1284.08">partner in handling the messy business</span> <span data-start="1284.08" data-end="1287.05">of chaining promises together you can</span> <span data-start="1287.05" data-end="1288.31">write your code as if it ran</span> <span data-start="1288.31" data-end="1291.37">sequentially so for the second version</span> <span data-start="1291.37" data-end="1293.26">of this game I rewrote all of the</span> <span data-start="1293.26" data-end="1295.51">animations with promises and generators</span> <span data-start="1295.51" data-end="1297.79">so what you're seeing here is the same</span> <span data-start="1297.79" data-end="1300.28">idle animation but with generators and</span> <span data-start="1300.28" data-end="1303.34">promises and it's run by a KO routine</span> <span data-start="1303.34" data-end="1305.92">and I had two goals with the rewrite I</span> <span data-start="1305.92" data-end="1308.05">wanted to be able to pause animations</span> <span data-start="1308.05" data-end="1310.09">and I want to take advantage of thinking</span> <span data-start="1310.09" data-end="1313.96">sequentially about async code so to do</span> <span data-start="1313.96" data-end="1315.58">that I started with rewriting the</span> <span data-start="1315.58" data-end="1318.07">function that delays the animation so</span> <span data-start="1318.07" data-end="1320.05">this is our async function and it</span> <span data-start="1320.05" data-end="1322">doesn't need to hold the animation</span> <span data-start="1322" data-end="1324.31">itself it just needs to delay with a</span> <span data-start="1324.31" data-end="1326.58">promise that's its sole responsibility</span> <span data-start="1326.58" data-end="1329.26">so when this function is called it</span> <span data-start="1329.26" data-end="1331.51">returns a new promise that resolves when</span> <span data-start="1331.51" data-end="1336.61">the timeout is complete I also broke out</span> <span data-start="1336.61" data-end="1338.14">the context clearing into its own</span> <span data-start="1338.14" data-end="1340.96">function and the drawing of the image</span> <span data-start="1340.96" data-end="1346.78">into its own function so now we can</span> <span data-start="1346.78" data-end="1348.58">combine these new functions to replace</span> <span data-start="1348.58" data-end="1350.62">the previous animation function and</span> <span data-start="1350.62" data-end="1352.84">we're gonna do so inside of a generator</span> <span data-start="1352.84" data-end="1355.21">so we'll clear whatever was previously</span> <span data-start="1355.21" data-end="1357.13">on the canvas then we're gonna draw the</span> <span data-start="1357.13" data-end="1359.26">new frame and these get to occur</span> <span data-start="1359.26" data-end="1361.33">synchronously there's no problem with</span> <span data-start="1361.33" data-end="1363.31">these needing to be a sync they can</span> <span data-start="1363.31" data-end="1365.62">recur synchronously but what we is a</span> <span data-start="1365.62" data-end="1367.54">think about this is the delay so we're</span> <span data-start="1367.54" data-end="1369.61">gonna yield the delay that's the</span> <span data-start="1369.61" data-end="1372.07">asynchronous part and then we're gonna</span> <span data-start="1372.07" data-end="1374.47">pass off handing it to our co-routines</span> <span data-start="1374.47" data-end="1376.84">so our ko routine will be handling the</span> <span data-start="1376.84" data-end="1379.09">asynchronous part of this but this feels</span> <span data-start="1379.09" data-end="1383.4">very synchronous</span> <span data-start="1383.41" data-end="1385.99">and now I can redraw the dislike</span> <span data-start="1385.99" data-end="1389.59">animation so this is an animation that</span> <span data-start="1389.59" data-end="1391.72">has two frames so you can see this gets</span> <span data-start="1391.72" data-end="1393.46">a lot cleaner than the code that I had</span> <span data-start="1393.46" data-end="1396.13">previously and then here is our</span> </p>
<p><span data-start="1396.13" data-end="1397.929">Tamagotchi saying like nope I don't like</span> <span data-start="1397.929" data-end="1400.45">whatever's going on I'm running out of</span> <span data-start="1400.45" data-end="1402.73">time but very quickly we're gonna</span> <span data-start="1402.73" data-end="1405.58">rewrite the main game bloop so we're</span> <span data-start="1405.58" data-end="1407.08">gonna take advantage of canceling the</span> <span data-start="1407.08" data-end="1409.809">generator our loop generator function</span> <span data-start="1409.809" data-end="1411.94">will be run by a KO routine so we can</span> <span data-start="1411.94" data-end="1413.53">rely on that to handle the asynchronous</span> <span data-start="1413.53" data-end="1415.809">stuff we're going to create a variable</span> <span data-start="1415.809" data-end="1417.94">to save a status of the generator is it</span> <span data-start="1417.94" data-end="1419.95">done or not and we're gonna preset the</span> <span data-start="1419.95" data-end="1423.64">animation to idle we'll use a while loop</span> <span data-start="1423.64" data-end="1426.309">to create a never-ending generator and</span> <span data-start="1426.309" data-end="1428.38">this way the game loop can continue for</span> <span data-start="1428.38" data-end="1430.9">forever if we have a pending user event</span> <span data-start="1430.9" data-end="1432.73">we're going to delegate to the event</span> <span data-start="1432.73" data-end="1435.1">using yield star and whatever the event</span> <span data-start="1435.1" data-end="1437.88">yields will be passed to the co-routine</span> <span data-start="1437.88" data-end="1440.74">otherwise a second while loop will</span> <span data-start="1440.74" data-end="1443.32">handle running the animation so as long</span> <span data-start="1443.32" data-end="1445.24">as the animation is not complete and</span> <span data-start="1445.24" data-end="1447.37">there are no pending events this loop</span> <span data-start="1447.37" data-end="1449.409">will yield to the generators values to</span> <span data-start="1449.409" data-end="1451.659">the KO routine to handle and these are</span> <span data-start="1451.659" data-end="1453.61">promises so the KO routine is going to</span> <span data-start="1453.61" data-end="1456.82">handle the chaining but if the animation</span> <span data-start="1456.82" data-end="1459.52">is done or there's a pending user event</span> <span data-start="1459.52" data-end="1462.01">the loop is going to terminate stopping</span> <span data-start="1462.01" data-end="1463.9">the animation generator from running</span> <span data-start="1463.9" data-end="1465.94">again and we're going to reassign the</span> <span data-start="1465.94" data-end="1467.77">animation to an idle generator so it</span> <span data-start="1467.77" data-end="1469.57">starts from the beginning and we're</span> <span data-start="1469.57" data-end="1472.21">gonna reset done to false so on the next</span> <span data-start="1472.21" data-end="1474.46">iteration of this loop pending will be</span> <span data-start="1474.46" data-end="1476.169">true and we'll handle the user event</span> <span data-start="1476.169" data-end="1481.48">instead so this is the generator for the</span> <span data-start="1481.48" data-end="1483.64">feed action it's going to evaluate if</span> <span data-start="1483.64" data-end="1486.07">the Tamagotchi is hungry or not if it's</span> <span data-start="1486.07" data-end="1487.96">not it's going to delegate future next</span> <span data-start="1487.96" data-end="1489.94">calls to the dislike generator which</span> <span data-start="1489.94" data-end="1492.64">will run the dislike animation otherwise</span> <span data-start="1492.64" data-end="1494.289">we're gonna decrease the hunger count</span> <span data-start="1494.289" data-end="1496.72">and use the yield star we delegate to</span> <span data-start="1496.72" data-end="1498.25">the eat generator that runs the</span> <span data-start="1498.25" data-end="1500.62">animation okay so now we need to see</span> <span data-start="1500.62" data-end="1502.48">everything together so we're idling</span> <span data-start="1502.48" data-end="1504.46">riding we're gonna feed the Tamagotchi</span> <span data-start="1504.46" data-end="1506.89">give it a good burger and you can see it</span> <span data-start="1506.89" data-end="1508.6">canceled the idle animation straight</span> <span data-start="1508.6" data-end="1510.4">away and you got to see the time I got</span> <span data-start="1510.4" data-end="1512.53">you eating right away then it goes back</span> <span data-start="1512.53" data-end="1514.929">to idling and then we're going to feed</span> <span data-start="1514.929" data-end="1515.73">it again</span> <span data-start="1515.73" data-end="1517.45">and this time we're gonna give it some</span> <span data-start="1517.45" data-end="1520.419">candy great immediately cancels the idle</span> <span data-start="1520.419" data-end="1523.149">animation and runs the candy animation</span> <span data-start="1523.149" data-end="1527.049">feeding it candy one more time we're</span> <span data-start="1527.049" data-end="1528.279">gonna try and feed it one more time and</span> <span data-start="1528.279" data-end="1530.529">it's not happy it does not want a food</span> <span data-start="1530.529" data-end="1534.009">so you can see this now works and that</span> <span data-start="1534.009" data-end="1535.99">is all I have for you the code is at</span> <span data-start="1535.99" data-end="1537.669">this github if you want to check out the</span> <span data-start="1537.669" data-end="1539.59">code itself I'm still in the process of</span> <span data-start="1539.59" data-end="1542.679">writing the Tim Tamagotchi but you can</span> <span data-start="1542.679" data-end="1544.84">check out what's there already and come</span> <span data-start="1544.84" data-end="1545.919">see me at the break if you would like</span> <span data-start="1545.919" data-end="1548.049">some stickers I have some use react and</span> <span data-start="1548.049" data-end="1550.419">wing stickers that are react focused if</span> <span data-start="1550.419" data-end="1553.5">you use react and thank you</span> <span data-start="1553.5" data-end="1556.81">[Applause]</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
