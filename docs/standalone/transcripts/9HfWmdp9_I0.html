<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>9HfWmdp9_I0</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/9HfWmdp9_I0?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="18.61" data-end="21.17">so I'm Peter and I'm going to talk to</span> <span data-start="21.17" data-end="22.87">you about a recompiling JavaScript</span> <span data-start="22.87" data-end="26.48">without restarting it I'm a Dutch</span> <span data-start="26.48" data-end="29.45">JavaScript developer I you might have</span> <span data-start="29.45" data-end="31.82">heard me from JS 1k I organize that and</span> <span data-start="31.82" data-end="34.31">I build a variety of tools JavaScript</span> <span data-start="34.31" data-end="36.41">related tools I work for a company</span> <span data-start="36.41" data-end="38.48">called surf Lee they do remote desktop</span> <span data-start="38.48" data-end="40.22">in your browser but that's not what I'm</span> <span data-start="40.22" data-end="43.37">going to talk about today so first we</span> <span data-start="43.37" data-end="47.84">start with a demo and so we're going to</span> <span data-start="47.84" data-end="52.22">start with reloading oh dear Lord no so</span> <span data-start="52.22" data-end="54.08">we're going to start with Riaan abling</span> <span data-start="54.08" data-end="64.14">endings</span> <span data-start="64.15" data-end="69.98">it's really exciting I know it's like</span> <span data-start="69.99" data-end="72.63">and there we go I hope there we go all</span> <span data-start="72.63" data-end="76.32">right so on the right inside you see a</span> <span data-start="76.32" data-end="78.54">small animation basically right the</span> <span data-start="78.54" data-end="81.299">point is that it turns and it moves and</span> <span data-start="81.299" data-end="83.22">whenever I edit anything even like</span> <span data-start="83.22" data-end="85.68">adding a space it's going to restart</span> <span data-start="85.68" data-end="88.67">this code there's a loop down here</span> <span data-start="88.67" data-end="91.289">sorry's not intended i seems i forgot</span> <span data-start="91.289" data-end="93.539">that if i change it it will it will</span> <span data-start="93.539" data-end="95.34">reload the code and will restart from</span> <span data-start="95.34" data-end="98.549">scratch so now let's look at how that</span> <span data-start="98.549" data-end="103.289">will look if you recompile it apparently</span> <span data-start="103.289" data-end="109.979">took crashes Wow all right so it doesn't</span> <span data-start="109.979" data-end="128.63">cool um okay sure no problem</span> <span data-start="128.64" data-end="132.61">so let's open it comes all try bigger</span> <span data-start="132.61" data-end="136.239">and bigger and all right so it's going</span> <span data-start="136.239" data-end="138.22">to repeat repeating and whenever it's</span> <span data-start="138.22" data-end="140.59">going to start it's going to do foo I'm</span> <span data-start="140.59" data-end="142.03">sorry I had a visual thing and it's</span> <span data-start="142.03" data-end="145.48">apparently not working so whenever I</span> <span data-start="145.48" data-end="148.239">want to change it now it's not going to</span> <span data-start="148.239" data-end="150.19">print foo and if it would fool it would</span> <span data-start="150.19" data-end="151.72">print food and the program what if we</span> <span data-start="151.72" data-end="153.58">started as you can see in the console</span> <span data-start="153.58" data-end="156.849">it's a well printing out the new stuff I</span> <span data-start="156.849" data-end="159.37">can do pretty much anything even like</span> <span data-start="159.37" data-end="164.95">closures but that's let's just quit</span> <span data-start="164.95" data-end="171.7">twice something quickly such a pity oh</span> <span data-start="171.7" data-end="176.44">well okay so no fancy demo there let's</span> <span data-start="176.44" data-end="178.72">continue with the slide basically what</span> <span data-start="178.72" data-end="180.61">it is is it's compiling JavaScript on</span> <span data-start="180.61" data-end="183.22">the fly while maintaining access to</span> <span data-start="183.22" data-end="185.68">closures which is something that's not</span> <span data-start="185.68" data-end="188.769">that trivial to do obviously no restart</span> <span data-start="188.769" data-end="190.569">of the application is required so if</span> <span data-start="190.569" data-end="192.76">you're like building a game then you</span> <span data-start="192.76" data-end="194.68">wouldn't have to go through your Start</span> <span data-start="194.68" data-end="196.9">menus and whatever to see your change up</span> <span data-start="196.9" data-end="199.72">and running immediately it's the library</span> <span data-start="199.72" data-end="202.03">of this is a lazy evaluation so it's</span> <span data-start="202.03" data-end="203.68">compiling once and it's only going to</span> <span data-start="203.68" data-end="205.829">really compile when you change it and</span> <span data-start="205.829" data-end="208.569">it's a generic approach meaning that it</span> <span data-start="208.569" data-end="209.41">will work with pretty much any</span> </p>
<p><span data-start="209.41" data-end="211.12">JavaScript there are obviously some</span> <span data-start="211.12" data-end="213.569">limitations but i'll cover those later</span> <span data-start="213.569" data-end="216.549">so when I talk about compiling in</span> <span data-start="216.549" data-end="218.44">JavaScript what do I mean when you have</span> <span data-start="218.44" data-end="220.03">a function you're actually compiling</span> <span data-start="220.03" data-end="222.16">JavaScript because you're preparing code</span> <span data-start="222.16" data-end="223.87">to be ran so when you're creating a</span> <span data-start="223.87" data-end="225.76">function to be invoked later you're</span> <span data-start="225.76" data-end="227.2">actually compiling javascript so that's</span> <span data-start="227.2" data-end="229.269">what I mean when I say compiling in</span> <span data-start="229.269" data-end="233.17">JavaScript all right so I'm going to do</span> <span data-start="233.17" data-end="235">this live coding thing it's gonna be</span> <span data-start="235" data-end="237.519">awesome I'm sure just like the previous</span> <span data-start="237.519" data-end="242.55">demos so this</span> <span data-start="242.55" data-end="245.86">this one so we have a simple set</span> <span data-start="245.86" data-end="248.319">interval and it's printing hello JS calm</span> <span data-start="248.319" data-end="251.08">and add a forgotten five on the</span> <span data-start="251.08" data-end="257.06">millisecond and so that's what it does</span> <span data-start="257.07" data-end="259.72">now in the first step because i'm going</span> <span data-start="259.72" data-end="261.16">to recompile those functions is I'm</span> <span data-start="261.16" data-end="265.12">going to wrap those functions so i'm</span> <span data-start="265.12" data-end="266.139">going to create a new function called</span> <span data-start="266.139" data-end="273.01">well you know and it's going to return</span> <span data-start="273.01" data-end="277.479">that function and I just sliced out so</span> <span data-start="277.479" data-end="280">this is the same as I had before you</span> <span data-start="280" data-end="293.059">know what I should probably</span> <span data-start="293.069" data-end="299.51">so this is the original code that were I</span> <span data-start="299.52" data-end="302.5">press a button</span> </p>
<p><span data-start="302.5" data-end="306.43">I shouldn't be pressing buttons okay so</span> <span data-start="306.43" data-end="308.98">whatever um so this is the first step</span> <span data-start="308.98" data-end="312.43">and of course it still works still does</span> <span data-start="312.43" data-end="314.26">the same thing except I sliced out the</span> <span data-start="314.26" data-end="316.35">way that the function is being passed on</span> <span data-start="316.35" data-end="319.48">so the next step would be to actually</span> <span data-start="319.48" data-end="321.34">compile the function and how do we</span> <span data-start="321.34" data-end="322.71">compile function in JavaScript</span> <span data-start="322.71" data-end="328.21">dynamically evil evil is evil so let's</span> <span data-start="328.21" data-end="330.43">just use the semantically more</span> <span data-start="330.43" data-end="333.25">appropriate way to do it through</span> <span data-start="333.25" data-end="341.8">function so we're going to do like that</span> <span data-start="341.8" data-end="344.26">and that should return the same function</span> <span data-start="344.26" data-end="347.43">that we had before so let's try it out</span> <span data-start="347.43" data-end="351.04">still working all right okay so let's</span> <span data-start="351.04" data-end="356.919">abstract is a bit I putting it in a</span> <span data-start="356.919" data-end="358.75">global variable so that we can access it</span> <span data-start="358.75" data-end="365.2">later so this is still the same things</span> <span data-start="365.2" data-end="367.51">before just a bit of abstraction and</span> <span data-start="367.51" data-end="373.69">still works all right so let's make this</span> <span data-start="373.69" data-end="378.4">into a function ID parameter a subpoena</span> <span data-start="378.4" data-end="381.4">passed on 0 because it's still the first</span> <span data-start="381.4" data-end="387.28">function in disarray still works now are</span> <span data-start="387.28" data-end="388.66">we able to recompile at this point</span> <span data-start="388.66" data-end="391.03">because basically all we'd have to do is</span> <span data-start="391.03" data-end="393.04">change this right because this is being</span> <span data-start="393.04" data-end="397.24">evaluated and executed so let's just see</span> <span data-start="397.24" data-end="400.14">if that works</span> <span data-start="400.15" data-end="402.07">since we have a global we can accept</span> <span data-start="402.07" data-end="411.16">access it Oh capital it doesn't work off</span> <span data-start="411.16" data-end="413.05">why does it doesn't why is it not</span> <span data-start="413.05" data-end="416.77">working this function get function is</span> <span data-start="416.77" data-end="424.45">only being invoked once it's not being</span> <span data-start="424.45" data-end="426.1">repetitively being invoked so when I</span> <span data-start="426.1" data-end="428.41">change this this isn't being picked up</span> <span data-start="428.41" data-end="434.13">so I need to do is I need to return a</span> <span data-start="434.13" data-end="441.49">function that does a recompilation so</span> <span data-start="441.49" data-end="444.64">now we can see that is recompiling but</span> <span data-start="444.64" data-end="448.57">not executing so in order to fix that we</span> <span data-start="448.57" data-end="450.34">can recompile we compile and we</span> <span data-start="450.34" data-end="451.81">immediately invoke all right that's what</span> <span data-start="451.81" data-end="454.27">these these are going to do so now we</span> <span data-start="454.27" data-end="455.8">can see it as compiling and printing</span> <span data-start="455.8" data-end="459.88">alright so now is it going to work if i</span> <span data-start="459.88" data-end="464.23">try to recompile yes so this is</span> <span data-start="464.23" data-end="466.18">recompilation as its most basic</span> <span data-start="466.18" data-end="469.33">primitive form you're changing a runtime</span> <span data-start="469.33" data-end="472.54">you know without actually restoring the</span> <span data-start="472.54" data-end="476.5">code not at sea we need to properly in</span> <span data-start="476.5" data-end="477.97">focus because if we're going to do</span> <span data-start="477.97" data-end="481.57">arguments then this is not going to work</span> <span data-start="481.57" data-end="484.27">in fact what are other things that might</span> <span data-start="484.27" data-end="486.55">go wrong here I mean if you're looking</span> <span data-start="486.55" data-end="488.56">at recompilation in this approach what</span> <span data-start="488.56" data-end="489.97">kind of code if we're looking for</span> <span data-start="489.97" data-end="491.92">generic support what kind of code might</span> <span data-start="491.92" data-end="498.31">not work anybody all right good thing I</span> <span data-start="498.31" data-end="501.43">put a few up so function arguments are</span> <span data-start="501.43" data-end="503.53">not going to work because they're simply</span> <span data-start="503.53" data-end="505.78">being ignored right now closures aren't</span> <span data-start="505.78" data-end="507.01">going to work because you don't have</span> <span data-start="507.01" data-end="509.35">access to it and that's probably like</span> <span data-start="509.35" data-end="510.93">the prime thing in this whole approach</span> <span data-start="510.93" data-end="513.37">function declarations don't return a</span> <span data-start="513.37" data-end="516.7">value so if you would wrap those or</span> <span data-start="516.7" data-end="519.19">replace those then that would be pretty</span> <span data-start="519.19" data-end="521.29">much dead code named function</span> <span data-start="521.29" data-end="522.85">expressions are a special case because</span> <span data-start="522.85" data-end="525.43">the name of the names function</span> <span data-start="525.43" data-end="528.91">expression is it's handled in a slightly</span> <span data-start="528.91" data-end="530.74">different way and of course there's</span> <span data-start="530.74" data-end="531.88">performance because if you're going to</span> <span data-start="531.88" data-end="533.59">repetitively</span> <span data-start="533.59" data-end="535.63">to evil code it's going to hurt your</span> <span data-start="535.63" data-end="538.6">performance so let's try to fix those</span> <span data-start="538.6" data-end="542.65">cases first four arguments so arguments</span> <span data-start="542.65" data-end="544.84">is quite simple we're going to change</span> <span data-start="544.84" data-end="549.69">this structure into a set of objects I</span> <span data-start="549.69" data-end="557.44">shouldn't be typing objects</span> <span data-start="557.45" data-end="561.27">alright so it's going to be arks and</span> <span data-start="561.27" data-end="562.92">then function accepts multiple</span> <span data-start="562.92" data-end="564.66">parameters and only the last one is</span> <span data-start="564.66" data-end="569.33">supposed to be body so let's do args and</span> <span data-start="569.33" data-end="571.98">change this with body let's just still</span> <span data-start="571.98" data-end="573.18">work and still do the same thing as</span> <span data-start="573.18" data-end="575.64">before note that we're just passing on 1</span> <span data-start="575.64" data-end="579.42">arcs as a string that we were going to</span> <span data-start="579.42" data-end="582.12">fix it later now it's still working</span> <span data-start="582.12" data-end="586.68">hello Jess calm so arguments let's say</span> <span data-start="586.68" data-end="590.55">we take a new demo I of course prepared</span> <span data-start="590.55" data-end="596.46">a few of those so let's try to use this</span> <span data-start="596.46" data-end="598.89">example this is it of course still a</span> <span data-start="598.89" data-end="602.49">simple example and it's going to</span> <span data-start="602.49" data-end="606.57">repetitively print ad or call a log</span> <span data-start="606.57" data-end="609.51">function which is an alias which has one</span> <span data-start="609.51" data-end="611.97">argument text so if we're going to</span> <span data-start="611.97" data-end="613.41">replace that the same way as we did</span> <span data-start="613.41" data-end="617.87">before we need to slice out the body</span> <span data-start="617.87" data-end="621.39">copy that into our data structure as</span> <span data-start="621.39" data-end="623.94">before we're going to add a text</span> <span data-start="623.94" data-end="630.66">parameter then we have get function 0</span> <span data-start="630.66" data-end="632.1">because it's the first function that is</span> <span data-start="632.1" data-end="634.44">going to exist in this data array and</span> <span data-start="634.44" data-end="638.22">then the second object has no arguments</span> </p>
<p><span data-start="638.22" data-end="647.1">I mean function and so they did i do</span> <span data-start="647.1" data-end="651.7">everything on</span> <span data-start="651.71" data-end="655.11">alright so now we have basically to get</span> <span data-start="655.11" data-end="659.75">function calls and ergo going to return</span> <span data-start="659.75" data-end="662.34">well the functions are generated through</span> <span data-start="662.34" data-end="664.65">whatever is in disarray so let's see if</span> <span data-start="664.65" data-end="672.15">this works it doesn't work and why</span> <span data-start="672.15" data-end="678.3">doesn't it work anyway to see that look</span> <span data-start="678.3" data-end="681.27">at these two characters what's missing</span> <span data-start="681.27" data-end="685.23">here the actual arguments so remember</span> <span data-start="685.23" data-end="686.67">that this function is a function is</span> <span data-start="686.67" data-end="688.8">being returned and being invoked where</span> <span data-start="688.8" data-end="690.06">the original function would have been</span> <span data-start="690.06" data-end="692.13">invoked all right so if you look at the</span> <span data-start="692.13" data-end="694.68">original code I've replaced this</span> <span data-start="694.68" data-end="698.19">function basically with this function</span> <span data-start="698.19" data-end="700.44">and so that's being invoked and in order</span> <span data-start="700.44" data-end="702.57">to pass on the arguments as originally</span> <span data-start="702.57" data-end="705.27">intended I need to change this piece of</span> <span data-start="705.27" data-end="710.39">multi snippet to the standard apply</span> <span data-start="710.39" data-end="713.15">context and then</span> <span data-start="713.15" data-end="718.7">array.prototype.slice.call arguments 0</span> <span data-start="718.7" data-end="721.83">or whatever way you want to do this so</span> <span data-start="721.83" data-end="723.84">in a nutshell this now is going to</span> <span data-start="723.84" data-end="726.81">invoke this generated function as if it</span> <span data-start="726.81" data-end="729.57">was invoked originally same context same</span> <span data-start="729.57" data-end="731.37">arguments as far as a running code is</span> <span data-start="731.37" data-end="734.79">concerned nothing changes and now it</span> <span data-start="734.79" data-end="738.78">should work Go Go okay so now we can</span> <span data-start="738.78" data-end="743.52">still update this so we have data 0 is</span> <span data-start="743.52" data-end="747.81">this text or this body and let's try to</span> <span data-start="747.81" data-end="750.03">change that I say just depending some</span> <span data-start="750.03" data-end="759.929">kind of argument</span> <span data-start="759.939" data-end="767.619">and it's failing because oh no wait it's</span> <span data-start="767.619" data-end="770.889">in quotes oh because I'm not quoting it</span> <span data-start="770.889" data-end="776.319">huh ya know all right now I know why dis</span> <span data-start="776.319" data-end="778.509">isn't working so I change the data</span> <span data-start="778.509" data-end="781.929">structure and now it so I've changed a</span> <span data-start="781.929" data-end="785.079">runtime from hello text and just</span> <span data-start="785.079" data-end="786.97">appended II Foo without restarting the</span> <span data-start="786.97" data-end="791.379">application so arguments are preserved</span> <span data-start="791.379" data-end="793.629">and we can mess with that alright so</span> <span data-start="793.629" data-end="796.929">that's one step so then if we have had</span> <span data-start="796.929" data-end="799.899">arguments the next step would be</span> <span data-start="799.899" data-end="803.259">closures alright so we have we fix for</span> <span data-start="803.259" data-end="804.789">function arguments let's look at the</span> <span data-start="804.789" data-end="808.299">closures closures is going to be dis</span> <span data-start="808.299" data-end="819.65">snippet of example let's put it up here</span> <span data-start="819.66" data-end="823.8">so we are going to have a function</span> <span data-start="823.8" data-end="825.93">that's going to repeat whatever is being</span> <span data-start="825.93" data-end="830.85">passed on so this function will be</span> <span data-start="830.85" data-end="832.92">called below and then set interval will</span> <span data-start="832.92" data-end="835.5">repetitively log out whatever is being</span> <span data-start="835.5" data-end="838.23">passed on so note that text in here is a</span> <span data-start="838.23" data-end="840.9">closure over the text that's being</span> <span data-start="840.9" data-end="843.72">passed on so if I just going to replace</span> <span data-start="843.72" data-end="846.3">it as I did before which I don't think i</span> <span data-start="846.3" data-end="847.47">need to replace the first one because</span> <span data-start="847.47" data-end="850.29">it's still locked text so that's remains</span> <span data-start="850.29" data-end="854.28">the same except for the function let me</span> <span data-start="854.28" data-end="856.44">for the argument because that's now in</span> <span data-start="856.44" data-end="860.91">the second function which is the whole</span> <span data-start="860.91" data-end="862.56">so this is like the second function now</span> <span data-start="862.56" data-end="876.02">it's going to wrap this get function</span> <span data-start="876.03" data-end="881.83">alright so now let's see if this works</span> <span data-start="881.84" data-end="885.3">nope because text isn't isn't defined</span> <span data-start="885.3" data-end="887.94">and the reason it's not defined does</span> <span data-start="887.94" data-end="890.22">anybody can anybody figure it out like</span> <span data-start="890.22" data-end="893.28">right now why text would not be defined</span> <span data-start="893.28" data-end="901.71">there okay so yeah its function I heard</span> <span data-start="901.71" data-end="903.75">somebody say it over there function is</span> <span data-start="903.75" data-end="906.57">actually a indirect evil all right so it</span> <span data-start="906.57" data-end="908.43">only has access to the global scope if</span> <span data-start="908.43" data-end="910.98">you look at direct evil and indirectly</span> <span data-start="910.98" data-end="912.57">availed the main difference at least in</span> <span data-start="912.57" data-end="915.24">this context is that direct evil will</span> <span data-start="915.24" data-end="917.48">have access to the lexical scopes and</span> <span data-start="917.48" data-end="919.79">because we're using function over here</span> <span data-start="919.79" data-end="924.06">it's not working so let's change this to</span> <span data-start="924.06" data-end="927.6">evil so we're going to change evil we</span> <span data-start="927.6" data-end="931.64">need to add the function boilerplate now</span> <span data-start="931.64" data-end="940.17">arguments body closing parts and the</span> <span data-start="940.17" data-end="945.15">rest remains the same sorry all right so</span> <span data-start="945.15" data-end="947.64">let's see if this works now it still</span> <span data-start="947.64" data-end="956.61">doesn't work what did we forget so evil</span> <span data-start="956.61" data-end="959.19">is lexical scope so even though we're</span> <span data-start="959.19" data-end="962.16">doing direct evil right now it's not</span> <span data-start="962.16" data-end="964.65">going to be able to access text because</span> <span data-start="964.65" data-end="967.59">text doesn't exist in this function it</span> <span data-start="967.59" data-end="968.85">doesn't exist in this function and</span> <span data-start="968.85" data-end="970.98">doesn't exist in global scope so that's</span> <span data-start="970.98" data-end="973.26">why at this point it's still throwing a</span> <span data-start="973.26" data-end="976.83">failure so in order to solve this we're</span> <span data-start="976.83" data-end="980.19">going to do something like this let me</span> <span data-start="980.19" data-end="982.17">just give me a second</span> <span data-start="982.17" data-end="984.93">well let's do it in order so we're going</span> <span data-start="984.93" data-end="991.5">to add a compiler let me just do this on</span> <span data-start="991.5" data-end="1006.48">anyone</span> <span data-start="1006.49" data-end="1009.04">okay the rest pretty much remains to be</span> <span data-start="1009.04" data-end="1013.66">the same thing here and leistes and then</span> <span data-start="1013.66" data-end="1015.7">whenever they get function we pass on</span> <span data-start="1015.7" data-end="1022.69">this compiler as an argument and this</span> <span data-start="1022.69" data-end="1025.449">requires now a argument because I mean</span> <span data-start="1025.449" data-end="1029.62">this Cole is this you know the best song</span> <span data-start="1029.62" data-end="1031.929">so rather than evil we're going to use</span> <span data-start="1031.929" data-end="1034.48">this compiler to compile stuff and in</span> <span data-start="1034.48" data-end="1036.16">global scope we just pass on evil</span> <span data-start="1036.16" data-end="1038.98">because we don't care about direct or</span> <span data-start="1038.98" data-end="1042.13">indirect from global okay so is it going</span> <span data-start="1042.13" data-end="1045.189">to work now I certainly hope so all</span> <span data-start="1045.189" data-end="1047.14">right okay so at least it's working now</span> <span data-start="1047.14" data-end="1048.61">so let's see if we can actually change</span> <span data-start="1048.61" data-end="1051.73">the closure because this text over here</span> <span data-start="1051.73" data-end="1053.77">is a closure remember that this function</span> <span data-start="1053.77" data-end="1055.78">doesn't have a closure a text argument</span> <span data-start="1055.78" data-end="1061">so let's just try to change it not</span> <span data-start="1061" data-end="1063.76">remove it change it and see if we can</span> <span data-start="1063.76" data-end="1072.54">mess with it so body equals dot</span> <span data-start="1072.55" data-end="1079.06">and it works so we're able to we're able</span> <span data-start="1079.06" data-end="1081.82">to recompile code now even though there</span> <span data-start="1081.82" data-end="1084.16">were closures in there so it maintained</span> <span data-start="1084.16" data-end="1088.54">access to those scopes so we fixed</span> <span data-start="1088.54" data-end="1092.38">closures now the next part is function</span> <span data-start="1092.38" data-end="1094.09">declarations of function declarations</span> <span data-start="1094.09" data-end="1097.63">require a preprocessor step so if we</span> <span data-start="1097.63" data-end="1101.5">have like a function foo then what we</span> <span data-start="1101.5" data-end="1103.36">actually need to do is rewrite this too</span> </p>
<p><span data-start="1103.36" data-end="1105.4">VAR foo is function they're equivalent</span> <span data-start="1105.4" data-end="1107.17">and the only other thing you need to</span> <span data-start="1107.17" data-end="1108.52">take into account is that you need to</span> <span data-start="1108.52" data-end="1111.79">move this line to the top of the scope</span> <span data-start="1111.79" data-end="1113.35">because that's basically what javascript</span> <span data-start="1113.35" data-end="1116.26">does as well so jobs will hoist those</span> <span data-start="1116.26" data-end="1118.06">function declarations and you can just</span> <span data-start="1118.06" data-end="1120.25">use any kind of parser to rewrite this</span> <span data-start="1120.25" data-end="1122.41">this part and make it equivalent in</span> <span data-start="1122.41" data-end="1125.14">terms of JavaScript semantics so that's</span> <span data-start="1125.14" data-end="1127.45">the for me at least that's a very simple</span> <span data-start="1127.45" data-end="1129.13">trivial way of getting rid of the</span> <span data-start="1129.13" data-end="1132.28">function declaration problem use a</span> <span data-start="1132.28" data-end="1135.52">parser for named function expressions</span> <span data-start="1135.52" data-end="1138.87">it's slightly more complex so you'd have</span> <span data-start="1138.87" data-end="1154.33">sorry so you'd have like this case</span> <span data-start="1154.34" data-end="1156.049">actually it's not set into it so the</span> <span data-start="1156.049" data-end="1158.299">right way of doing the you know the</span> <span data-start="1158.299" data-end="1160.4">paint loops with with timers if you were</span> <span data-start="1160.4" data-end="1163.58">going to use timers anyways would not be</span> <span data-start="1163.58" data-end="1166.07">set interval but set set timeout and you</span> <span data-start="1166.07" data-end="1170.48">do like and of course this would be like</span> <span data-start="1170.48" data-end="1172.669">the you know computer depending on</span> <span data-start="1172.669" data-end="1174.62">whatever okay it doesn't matter so this</span> <span data-start="1174.62" data-end="1180.83">is how you would do your paint loop and</span> <span data-start="1180.83" data-end="1184.039">then the problem with this approach in</span> <span data-start="1184.039" data-end="1186.409">terms of recompiling is that you don't</span> <span data-start="1186.409" data-end="1188.48">get to change repeat any more so that</span> <span data-start="1188.48" data-end="1191.21">value of repeat is is just being</span> <span data-start="1191.21" data-end="1192.77">executed over be just being assigned</span> <span data-start="1192.77" data-end="1196.25">once on top of that of course name names</span> <span data-start="1196.25" data-end="1198.049">of names function expressions have more</span> <span data-start="1198.049" data-end="1200.69">weird semantics but that's the main the</span> <span data-start="1200.69" data-end="1203.45">main point the main problem here so what</span> <span data-start="1203.45" data-end="1205.429">we do here is we're going to rewrite the</span> <span data-start="1205.429" data-end="1207.89">name function expression as well and so</span> <span data-start="1207.89" data-end="1220.529">rather than this we're going to do a</span> <span data-start="1220.539" data-end="1222.32">actually we're going to rattle in the</span> <span data-start="1222.32" data-end="1225.19">function so</span> <span data-start="1225.2" data-end="1227.83">so we're going to do this and then this</span> <span data-start="1227.83" data-end="1233.779">would be the actual code and then we're</span> <span data-start="1233.779" data-end="1238.429">going to return this function so we're</span> <span data-start="1238.429" data-end="1240.98">going to basically rewrite rewrite this</span> <span data-start="1240.98" data-end="1243.86">and that way we get rid of the named</span> <span data-start="1243.86" data-end="1245.539">function expression while maintaining</span> <span data-start="1245.539" data-end="1247.7">the runtime semantics of a name function</span> <span data-start="1247.7" data-end="1250.279">expression and this way we can actually</span> <span data-start="1250.279" data-end="1252.62">use our recompilation stuff so let's</span> <span data-start="1252.62" data-end="1255.529">quickly try this just to prove that it</span> <span data-start="1255.529" data-end="1263.179">does work sorry so we'd have this and</span> <span data-start="1263.179" data-end="1278.68">then we're going to wrap this body again</span> <span data-start="1278.69" data-end="1280.91">there are no arguments to this function</span> <span data-start="1280.91" data-end="1282.35">and the name we don't need anymore</span> <span data-start="1282.35" data-end="1283.82">because that's going to be abstracted</span> <span data-start="1283.82" data-end="1289.22">away in our rewrite right I should have</span> <span data-start="1289.22" data-end="1306.01">written it first all right</span> <span data-start="1306.02" data-end="1308.27">so this is a rewritten part of the set</span> <span data-start="1308.27" data-end="1310.82">timeout and now I need a rabbit I can</span> <span data-start="1310.82" data-end="1312.38">still maintain the first part i guess</span> <span data-start="1312.38" data-end="1317.96">and then use get function 0 this is</span> <span data-start="1317.96" data-end="1320.98">still the first first function up here I</span> <span data-start="1320.98" data-end="1324.02">think this is good and then we're going</span> <span data-start="1324.02" data-end="1326.66">to wrap the new function as well of</span> <span data-start="1326.66" data-end="1329.78">course and so it's going to be good</span> <span data-start="1329.78" data-end="1334.58">function one of course we need to pass</span> <span data-start="1334.58" data-end="1345.359">on a compiler</span> <span data-start="1345.369" data-end="1349.149">and of course the compiler here as well</span> <span data-start="1349.149" data-end="1353.84">and I no arguments I think this will</span> <span data-start="1353.84" data-end="1362.6">work I hope anyways let's see if it</span> <span data-start="1362.6" data-end="1368.24">works doesn't work does it need to be</span> <span data-start="1368.24" data-end="1376.769">invoked a measly now</span> <span data-start="1376.779" data-end="1379.22">all right well I guess you're just going</span> <span data-start="1379.22" data-end="1381.32">to have to assume or take my word for it</span> <span data-start="1381.32" data-end="1383.84">that works I don't think I'm going to be</span> <span data-start="1383.84" data-end="1385.429">able to solve that any like right now</span> <span data-start="1385.429" data-end="1388.22">anyways that the solution does work</span> <span data-start="1388.22" data-end="1389.299">because the semantics should be</span> <span data-start="1389.299" data-end="1392.96">equivalent alright so we've solved the</span> <span data-start="1392.96" data-end="1397.33">name function expressions and then for</span> <span data-start="1397.33" data-end="1400.279">ya for performance we can actually</span> <span data-start="1400.279" data-end="1406.999">extend a postpone it so let me refer so</span> <span data-start="1406.999" data-end="1408.379">that we had it well it was before I</span> <span data-start="1408.379" data-end="1412.159">think this was working yeah okay so and</span> <span data-start="1412.159" data-end="1417.74">we can change that to this yeah so what</span> <span data-start="1417.74" data-end="1422.57">we do is instead of compiling it every</span> <span data-start="1422.57" data-end="1425.869">time in this step basically we cash the</span> <span data-start="1425.869" data-end="1427.539">function that's being that's being</span> <span data-start="1427.539" data-end="1431.539">invoked and then we check whether it's</span> <span data-start="1431.539" data-end="1433.22">up to date so we're going to add a</span> <span data-start="1433.22" data-end="1435.85">closure or actually to closures I guess</span> <span data-start="1435.85" data-end="1439.509">that's the function and Nesta version</span> <span data-start="1439.509" data-end="1449.48">we're going to do a version check</span> <span data-start="1449.49" data-end="1455.64">no not evil to our local version and</span> <span data-start="1455.64" data-end="1457.2">then we're going to check whether</span> <span data-start="1457.2" data-end="1458.64">function exists is all for like the</span> <span data-start="1458.64" data-end="1461.46">first time and if it doesn't or if</span> <span data-start="1461.46" data-end="1464.37">either of the cases isn't true whatever</span> <span data-start="1464.37" data-end="1470.01">then we're going to compile it catch the</span> <span data-start="1470.01" data-end="1473.16">function let's see we need to move this</span> <span data-start="1473.16" data-end="1488.34">away sorry update the version I think</span> <span data-start="1488.34" data-end="1492.42">this is fine and then apply return funk</span> <span data-start="1492.42" data-end="1505.31">apply now only to do is update d sorry</span> </p>
<p><span data-start="1505.32" data-end="1507.36">I'm gonna end yeah that's correct so</span> <span data-start="1507.36" data-end="1511.47">sorry and I need to add the version to</span> <span data-start="1511.47" data-end="1521.9">the data object which can be just like a</span> <span data-start="1521.91" data-end="1524.13">alright so now it's only going to update</span> <span data-start="1524.13" data-end="1527.34">the compilation and we can sort of prove</span> <span data-start="1527.34" data-end="1533.16">that I suppose by just by checking in</span> <span data-start="1533.16" data-end="1535.68">here and so this this step should only</span> <span data-start="1535.68" data-end="1537.63">be invoked now so the actual calling of</span> <span data-start="1537.63" data-end="1540.93">eval should only be cold now when the</span> <span data-start="1540.93" data-end="1545.58">code has changed I'm not sure what does</span> <span data-start="1545.58" data-end="1548.37">twice right now but whatever but as you</span> <span data-start="1548.37" data-end="1551.24">can see it doesn't compile now and so</span> <span data-start="1551.24" data-end="1553.53">what we can do now is we can change the</span> <span data-start="1553.53" data-end="1555.24">body of the code and it doesn't</span> <span data-start="1555.24" data-end="1557.37">recompile because it doesn't see a new</span> <span data-start="1557.37" data-end="1564.3">version so as soon as we do dad and it</span> <span data-start="1564.3" data-end="1566.31">can be anything I mean it can be foo if</span> <span data-start="1566.31" data-end="1567.72">it doesn't really matter just doesn't</span> <span data-start="1567.72" data-end="1569.94">need to be the same as before and now</span> <span data-start="1569.94" data-end="1571.98">you can see recompile and it actually</span> <span data-start="1571.98" data-end="1574.56">recompile so it's the sort of lazy</span> <span data-start="1574.56" data-end="1578.94">evaluation and still you know rii</span> <span data-start="1578.94" data-end="1583.32">compiling ok so that was the last part</span> <span data-start="1583.32" data-end="1587.43">of the the main issues I just lied for</span> <span data-start="1587.43" data-end="1590.16">this also so direct the first is direct</span> <span data-start="1590.16" data-end="1592.92">in evil the trick the main trick to this</span> <span data-start="1592.92" data-end="1595.35">approach is basically a indirect direct</span> <span data-start="1595.35" data-end="1599.21">evil all right you're cashing a function</span> <span data-start="1599.21" data-end="1601.62">well that's what we're doing in this in</span> <span data-start="1601.62" data-end="1606.39">this moment in this part right we are</span> <span data-start="1606.39" data-end="1609.6">creating a function on any scope of our</span> <span data-start="1609.6" data-end="1612.12">new functions and that makes the dollar</span> <span data-start="1612.12" data-end="1615.21">sign compiler variable available on any</span> <span data-start="1615.21" data-end="1617.82">scope and that's why we can do the get</span> <span data-start="1617.82" data-end="1620.91">function compiler here which basically</span> <span data-start="1620.91" data-end="1623.73">just returns this function and because</span> <span data-start="1623.73" data-end="1626.55">this is a direct evil at that point it's</span> <span data-start="1626.55" data-end="1627.75">going to have access to all the</span> <span data-start="1627.75" data-end="1629.19">variables and that's why I closures are</span> <span data-start="1629.19" data-end="1631.56">working there's actually one problem</span> <span data-start="1631.56" data-end="1633.45">with this snippet of code can anybody</span> <span data-start="1633.45" data-end="1637.83">see what what's what's going to happen</span> <span data-start="1637.83" data-end="1641.26">at runtime at some point</span> </p>
<p><span data-start="1641.27" data-end="1645.38">I doubt Douglas Gophers going to use</span> <span data-start="1645.38" data-end="1648.86">this at all all right so what happens if</span> <span data-start="1648.86" data-end="1657.46">we do if we compile this and we do s</span> <span data-start="1657.46" data-end="1663.17">that's what's going to do it's going to</span> <span data-start="1663.17" data-end="1664.97">see that variable because it has access</span> <span data-start="1664.97" data-end="1666.92">to the closures and because we're adding</span> <span data-start="1666.92" data-end="1668.69">a new function it's actually kind of</span> <span data-start="1668.69" data-end="1670.85">adding a new scope and if we declare</span> <span data-start="1670.85" data-end="1672.23">variables in that scope they're going to</span> <span data-start="1672.23" data-end="1675.1">show up in this recompiling step so</span> <span data-start="1675.1" data-end="1677.63">changing the version we can now see that</span> <span data-start="1677.63" data-end="1679.67">has actually printing out the vlog so</span> <span data-start="1679.67" data-end="1681.2">we're polluting the scope of course</span> <span data-start="1681.2" data-end="1682.64">we're also gluttonous cope with a</span> <span data-start="1682.64" data-end="1684.98">compiler function but it's a something</span> <span data-start="1684.98" data-end="1686.72">that I can't fix for this one you can</span> <span data-start="1686.72" data-end="1689.06">fix it by simply removing his argument</span> <span data-start="1689.06" data-end="1690.47">and saying art I mean you're already</span> <span data-start="1690.47" data-end="1693.8">using evil right so might as well these</span> <span data-start="1693.8" data-end="1698.72">arguments all right so now it works and</span> <span data-start="1698.72" data-end="1701.51">if we change it to that it's going to</span> <span data-start="1701.51" data-end="1704.03">cry because as is no longer available of</span> <span data-start="1704.03" data-end="1705.65">course we can still print out say</span> <span data-start="1705.65" data-end="1708.71">compiler but that's again you know used</span> <span data-start="1708.71" data-end="1710.8">like Greek letters or something I know</span> <span data-start="1710.8" data-end="1714.89">as this is  and I was just</span> <span data-start="1714.89" data-end="1716.75">going to print out that that a compiler</span> <span data-start="1716.75" data-end="1719.12">function but this is the so medicine</span> <span data-start="1719.12" data-end="1721.55">main trick create a function that has a</span> <span data-start="1721.55" data-end="1723.8">direct evil and maintains access to the</span> <span data-start="1723.8" data-end="1730.69">local scopes yeah</span> <span data-start="1730.7" data-end="1737.34">so basically recap it's a approach that</span> <span data-start="1737.34" data-end="1739.86">works generically it works for pretty</span> <span data-start="1739.86" data-end="1742.23">much any kind of code you can recompile</span> <span data-start="1742.23" data-end="1744">you can change it on the fly if you seen</span> </p>
<p><span data-start="1744" data-end="1746.37">Brett Victor's talk inventing on</span> <span data-start="1746.37" data-end="1748.289">principle he does is like you know at</span> <span data-start="1748.289" data-end="1750.45">some point he does a this loop and he</span> <span data-start="1750.45" data-end="1752.399">changed it and he changes the number of</span> <span data-start="1752.399" data-end="1754.919">iterations to I don't know whatever to</span> <span data-start="1754.919" data-end="1756.389">change the number of leaves in the tree</span> <span data-start="1756.389" data-end="1757.919">and first time I saw that I was like</span> <span data-start="1757.919" data-end="1760.2">it's not possible you can't do that and</span> <span data-start="1760.2" data-end="1762.12">then later I had to disprove myself of</span> <span data-start="1762.12" data-end="1765.149">course because it's possible it's just</span> <span data-start="1765.149" data-end="1769.62">you know it takes magic bit of magic so</span> <span data-start="1769.62" data-end="1772.169">on every scope you inject a new function</span> <span data-start="1772.169" data-end="1774.389">compiler function which has a direct</span> <span data-start="1774.389" data-end="1777.21">evil and by which you have direct access</span> <span data-start="1777.21" data-end="1779.19">to all the Scopes which maintains access</span> <span data-start="1779.19" data-end="1781.679">to closures and know that makes it work</span> <span data-start="1781.679" data-end="1783.87">and inside that you have some rewriting</span> <span data-start="1783.87" data-end="1785.519">magic for like function declarations and</span> <span data-start="1785.519" data-end="1787.59">other nasty things that might screw this</span> <span data-start="1787.59" data-end="1794.639">up so some open issues the bigs the</span> <span data-start="1794.639" data-end="1796.049">biggest problem here is inserting new</span> <span data-start="1796.049" data-end="1797.82">functions because you're mapping</span> <span data-start="1797.82" data-end="1800.549">function is one on one right and I have</span> <span data-start="1800.549" data-end="1804.33">the library where I did it you know I</span> <span data-start="1804.33" data-end="1806.009">abstracted everything away so you can</span> <span data-start="1806.009" data-end="1807.929">just as you can sort as you can see in</span> <span data-start="1807.929" data-end="1810.899">the Recon powder demo that doesn't</span> <span data-start="1810.899" data-end="1814.44">really work you can you know you can</span> <span data-start="1814.44" data-end="1816.21">type here and it will replace all the</span> <span data-start="1816.21" data-end="1817.559">codes but it's going to assume that</span> <span data-start="1817.559" data-end="1819.45">these functions are going to be a</span> <span data-start="1819.45" data-end="1821.49">certain order so if you add a new</span> <span data-start="1821.49" data-end="1825.12">function you know injected some how it's</span> <span data-start="1825.12" data-end="1827.97">going to trip up simply because it's</span> <span data-start="1827.97" data-end="1830.639">going to run to put this body actually</span> <span data-start="1830.639" data-end="1833.639">no this body into this body and so</span> <span data-start="1833.639" data-end="1836.009">that's it's something that I don't think</span> <span data-start="1836.009" data-end="1837.809">it's very easy to solve I've try to you</span> <span data-start="1837.809" data-end="1839.279">know I've tried to do a diff the</span> <span data-start="1839.279" data-end="1841.139">different help will be only so far</span> <span data-start="1841.139" data-end="1843.57">because there might be changes that are</span> <span data-start="1843.57" data-end="1846.75">spread on multiple parts in the code and</span> <span data-start="1846.75" data-end="1848.009">in that case you don't know which</span> <span data-start="1848.009" data-end="1850.71">functions to replace so that's like the</span> <span data-start="1850.71" data-end="1852.929">biggest problem with this approach but</span> <span data-start="1852.929" data-end="1854.07">as long as you're not as certain any new</span> <span data-start="1854.07" data-end="1855.86">functions everything's going to be fine</span> <span data-start="1855.86" data-end="1858.33">the minor issue is of course the</span> <span data-start="1858.33" data-end="1860.48">variable clashes that I explained before</span> <span data-start="1860.48" data-end="1862.95">and it's actually very hard to explain</span> <span data-start="1862.95" data-end="1864.3">people's don't see</span> <span data-start="1864.3" data-end="1868.38">to get that you can't really go ahead</span> <span data-start="1868.38" data-end="1870.87">and change the global code right I mean</span> <span data-start="1870.87" data-end="1873.53">if there's no way that if I would a</span> <span data-start="1873.53" data-end="1876.27">runtime at least if I will do this for</span> <span data-start="1876.27" data-end="1880.98">flu is bar and run and run time I would</span> <span data-start="1880.98" data-end="1883.26">recompile this and to say it is like gee</span> <span data-start="1883.26" data-end="1885.75">it won't be picked up because it's only</span> <span data-start="1885.75" data-end="1893.11">picked up by code that's really valuable</span> <span data-start="1893.12" data-end="1895.55">backs that are going to be reevaluated</span> <span data-start="1895.55" data-end="1899.28">actually re invoked at some point any</span> <span data-start="1899.28" data-end="1901.02">other code which includes any global</span> <span data-start="1901.02" data-end="1903.27">code it's it's not going to work or at</span> <span data-start="1903.27" data-end="1904.8">least it's not going to be useful it's</span> <span data-start="1904.8" data-end="1905.67">going to work but it's not gonna do</span> <span data-start="1905.67" data-end="1908.97">anything so it that seems to be hard to</span> <span data-start="1908.97" data-end="1912.18">get across unfortunately so the code is</span> <span data-start="1912.18" data-end="1915.36">going to be available on github as usual</span> </p>
<p><span data-start="1915.36" data-end="1919.5">I will push it later if github allows me</span> <span data-start="1919.5" data-end="1922.17">to and otherwise I'll you know slides</span> <span data-start="1922.17" data-end="1925.95">will be in there as well and yeah so are</span> <span data-start="1925.95" data-end="1928.28">there any questions I have like zero</span> <span data-start="1928.28" data-end="1931.91">minutes left so that should be fine okay</span> <span data-start="1931.91" data-end="1950.549">otherwise I'll be out there and ya thang</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
