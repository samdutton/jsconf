<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>_5X2aB_mNp4</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/_5X2aB_mNp4?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0.03" data-end="5.609">- sound yeah okay yeah thanks so much</span> <span data-start="5.609" data-end="7.639">for having me</span> <span data-start="7.639" data-end="10.8">just to get a slight feel how many of</span> <span data-start="10.8" data-end="12.75">you have ever done any metaprogramming</span> <span data-start="12.75" data-end="18.24">show me a hand so it's sort of a trick</span> <span data-start="18.24" data-end="20.52">question because I'm I'm pretty sure if</span> <span data-start="20.52" data-end="22.68">you've ever programmed in JavaScript</span> <span data-start="22.68" data-end="25.859">you've done some meta programming just</span> <span data-start="25.859" data-end="29.46">don't know it I'm Eric I'm an</span> <span data-start="29.46" data-end="31.949">independent consultant and JavaScript</span> <span data-start="31.949" data-end="35.489">trainer from Oslo and I spent most of my</span> <span data-start="35.489" data-end="37.649">days either building things in</span> <span data-start="37.649" data-end="40.86">JavaScript or teaching JavaScript and</span> <span data-start="40.86" data-end="44.76">the react stack and for a while now I've</span> <span data-start="44.76" data-end="47.69">been pretty hung up on meta programming</span> <span data-start="47.69" data-end="51.449">and when I think about meta programming</span> </p>
<p><span data-start="51.449" data-end="55.11">I think about these guys Wizards doing</span> <span data-start="55.11" data-end="58.59">wizard II things because at first at</span> <span data-start="58.59" data-end="61.01">least it feels a lot of it feels</span> <span data-start="61.01" data-end="63.29">indistinguishable from magic</span> <span data-start="63.29" data-end="68.04">but what is meta programming so I try to</span> <span data-start="68.04" data-end="71.76">ask Wikipedia and ditka pedia says that</span> <span data-start="71.76" data-end="74.22">meta programming is the ability to treat</span> <span data-start="74.22" data-end="78.63">programs as data and the ability to read</span> <span data-start="78.63" data-end="81.96">generate analyze or transform other</span> <span data-start="81.96" data-end="84.18">programs and even modify itself while</span> <span data-start="84.18" data-end="87.659">running so I think I'll go with that</span> <span data-start="87.659" data-end="91.71">and there's two main branches of meta</span> <span data-start="91.71" data-end="96.17">programming one of them is macros and</span> <span data-start="96.17" data-end="100.32">macros enables you to create your own</span> <span data-start="100.32" data-end="104.63">syntax so here's an example where we use</span> <span data-start="104.63" data-end="107.46">sweet J's which is a macro system for</span> </p>
<p><span data-start="107.46" data-end="110.159">JavaScript to create some custom syntax</span> <span data-start="110.159" data-end="113.759">so I'll make my own syntax here and I</span> <span data-start="113.759" data-end="116.6">can use that syntax in my code and</span> <span data-start="116.6" data-end="119.46">before that code actually runs it gets</span> <span data-start="119.46" data-end="121.64">compiled to whatever that syntax means</span> <span data-start="121.64" data-end="127.02">and you can also make your own operators</span> <span data-start="127.02" data-end="129.509">so let's say that I'm really tired of</span> <span data-start="129.509" data-end="132.45">saying dot then I don't like writing dot</span> <span data-start="132.45" data-end="133.29">then</span> <span data-start="133.29" data-end="135.54">chaining promises so I'm making my own</span> <span data-start="135.54" data-end="139.95">operator for that so now I can use that</span> <span data-start="139.95" data-end="143.069">operator in my code and before that code</span> <span data-start="143.069" data-end="145.29">actually runs its compiled down to</span> <span data-start="145.29" data-end="149.959">actual promise chaining so you can use</span> <span data-start="149.959" data-end="153.209">macros then to sort of extend your</span> <span data-start="153.209" data-end="155.04">language create your own dream language</span> <span data-start="155.04" data-end="157.68">and all of this stuff happens during</span> <span data-start="157.68" data-end="161.849">compile time or possibly and something</span> <span data-start="161.849" data-end="164.489">called macro expansion time at least it</span> <span data-start="164.489" data-end="168.389">happens before your code runs and that</span> <span data-start="168.389" data-end="172.579">second branch is reflection and</span> <span data-start="172.579" data-end="175.98">reflection has some sub branches where</span> <span data-start="175.98" data-end="178.53">one of them is introspection meaning</span> <span data-start="178.53" data-end="181.709">that you can the code connects inspect</span> <span data-start="181.709" data-end="183.079">itself during runtime</span> <span data-start="183.079" data-end="186.12">you have self modification meaning that</span> <span data-start="186.12" data-end="188.31">you can change your code during runtime</span> <span data-start="188.31" data-end="191.34">and then you have this thing called</span> <span data-start="191.34" data-end="193.98">inner session meaning that the code can</span> <span data-start="193.98" data-end="198.239">intercept and intervene with itself so a</span> <span data-start="198.239" data-end="200.37">simple example of introspection would be</span> <span data-start="200.37" data-end="202.44">let's say we have an object with some</span> <span data-start="202.44" data-end="206.099">properties here and I use object keys to</span> <span data-start="206.099" data-end="207.989">check which properties exist on this</span> <span data-start="207.989" data-end="211.379">object and it gives me a result back so</span> <span data-start="211.379" data-end="214.62">this is some of the one of the simplest</span> <span data-start="214.62" data-end="218.43">examples of introspection and then you</span> <span data-start="218.43" data-end="220.889">have self modification let's say that I</span> <span data-start="220.889" data-end="224.669">have a function I have a grumpy some</span> <span data-start="224.669" data-end="228.06">function that usually returns the sum of</span> <span data-start="228.06" data-end="233.579">a and B but if you ever pass an A that's</span> <span data-start="233.579" data-end="235.29">larger than five it'll just rewrite</span> <span data-start="235.29" data-end="238.919">itself to just return zero so if I pass</span> <span data-start="238.919" data-end="241.229">one plus one that's two if I pass ten</span> <span data-start="241.229" data-end="243.15">plus one that's eleven but then it just</span> <span data-start="243.15" data-end="247.379">starts returning zero so we've actually</span> <span data-start="247.379" data-end="249.439">changed the functionality here during</span> <span data-start="249.439" data-end="251.729">the runtime while our code is running</span> <span data-start="251.729" data-end="257.439">and then we have inner session</span> <span data-start="257.449" data-end="259.799">intercession is something that you can</span> <span data-start="259.799" data-end="263.669">do in JavaScript already sort of by</span> <span data-start="263.669" data-end="266.64">using object defined property</span> <span data-start="266.64" data-end="269.71">so let's say we have a hero here and he</span> <span data-start="269.71" data-end="272.35">has a health property but we also want</span> <span data-start="272.35" data-end="275.5">to have a status field that is somehow</span> <span data-start="275.5" data-end="278.74">based on his health so we'll define a</span> <span data-start="278.74" data-end="282.55">new property status and we'll define a</span> <span data-start="282.55" data-end="285.01">getter for that saying that if his</span> <span data-start="285.01" data-end="288.01">health is larger than 50 he is fit like</span> <span data-start="288.01" data-end="291.04">a champ otherwise he's badly hurt so</span> <span data-start="291.04" data-end="293.71">here we have a property which functions</span> <span data-start="293.71" data-end="298.33">based on the runtime conditions but this</span> <span data-start="298.33" data-end="301.51">sort of of intercession in JavaScript is</span> <span data-start="301.51" data-end="306.31">pretty limited so all of this reflection</span> <span data-start="306.31" data-end="308.92">stuff happens during runtime while our</span> <span data-start="308.92" data-end="312.13">code is running and that brings us over</span> <span data-start="312.13" data-end="315.1">to it's a very natural question now is</span> <span data-start="315.1" data-end="318.31">why is all of this useful why do we need</span> <span data-start="318.31" data-end="323.46">this so I went and asked Wikipedia again</span> <span data-start="323.46" data-end="327.01">and Wikipedia's answer is in some cases</span> <span data-start="327.01" data-end="329.35">this allows programmers to minimize the</span> <span data-start="329.35" data-end="332.23">number of lines of code to express a</span> <span data-start="332.23" data-end="333.82">solution and thus reducing the</span> <span data-start="333.82" data-end="339.46">development time I think I think I'd</span> <span data-start="339.46" data-end="341.53">rather say that the reason why this is</span> <span data-start="341.53" data-end="345.04">very useful is because we want as much</span> <span data-start="345.04" data-end="347.77">expressivity as possible to model our</span> <span data-start="347.77" data-end="352.06">problems and what we want is these</span> <span data-start="352.06" data-end="354.01">elegant and developer friendly</span> <span data-start="354.01" data-end="360.1">interfaces and this brings me to an</span> <span data-start="360.1" data-end="364.06">interface that I'm pretty sure that a</span> <span data-start="364.06" data-end="366.96">lot of you are familiar with which is</span> <span data-start="366.96" data-end="373.42">proxies in the form of proxies on the</span> <span data-start="373.42" data-end="378.37">web so a proxy is usually a server</span> <span data-start="378.37" data-end="381.19">placed in front of one or more servers</span> <span data-start="381.19" data-end="384.39">and this is to abstract the way</span> <span data-start="384.39" data-end="387.4">complexity and to provide a single</span> <span data-start="387.4" data-end="391.03">interface for the consumer so this</span> <span data-start="391.03" data-end="395.12">enables you to actually intercept any</span> <span data-start="395.12" data-end="399.94">any interaction with the interface and</span> <span data-start="399.94" data-end="404.33">the use cases might be load balancing it</span> <span data-start="404.33" data-end="406.82">might be delegating based on where the</span> <span data-start="406.82" data-end="410.389">resources are and so on but the main</span> <span data-start="410.389" data-end="412.22">thing is that you're providing a single</span> <span data-start="412.22" data-end="414.32">unified interface for the consumer</span> <span data-start="414.32" data-end="417.1">hiding all these implementation details</span> <span data-start="417.1" data-end="419.96">and we can apply this concept more</span> <span data-start="419.96" data-end="422.53">generally it doesn't have to be servers</span> <span data-start="422.53" data-end="427.19">so we could instead place a proxy in</span> <span data-start="427.19" data-end="430.4">front of a set of objects we can</span> <span data-start="430.4" data-end="432.62">intercept any type of access to these</span> <span data-start="432.62" data-end="435.26">objects and provide an abstraction to</span> <span data-start="435.26" data-end="440.03">hide implementation details and this is</span> <span data-start="440.03" data-end="442.34">what is made possible with proxies that</span> <span data-start="442.34" data-end="449.02">was introduced in es6 and what this</span> <span data-start="449.02" data-end="451.97">enables is a much more powerful form of</span> <span data-start="451.97" data-end="454.85">intercession among other things in</span> </p>
<p><span data-start="454.85" data-end="460.07">JavaScript and generally this means that</span> <span data-start="460.07" data-end="464.3">we are now able to intercept and define</span> <span data-start="464.3" data-end="466.94">custom behavior for fundamental</span> <span data-start="466.94" data-end="469.4">operations on objects so that means</span> <span data-start="469.4" data-end="473.289">properly lookup assignment enumeration</span> <span data-start="473.289" data-end="477.32">even function invocation and so on and</span> <span data-start="477.32" data-end="480.59">this is a very interesting feature for</span> <span data-start="480.59" data-end="482.9">another reason as well because this is</span> <span data-start="482.9" data-end="487.34">one of the few features that essentially</span> <span data-start="487.34" data-end="490.61">requires engine support unlike most of</span> <span data-start="490.61" data-end="493.76">use six which is syntax sugar that can</span> <span data-start="493.76" data-end="496.639">be transpiled using Babel for example</span> <span data-start="496.639" data-end="501.31">this isn't actually viable with proxies</span> <span data-start="501.31" data-end="505.28">but thankfully the support has become</span> <span data-start="505.28" data-end="509.83">pretty good except ie</span> <span data-start="509.83" data-end="518.779">which hopefully yeah doesn't stop you</span> <span data-start="518.789" data-end="523.149">so the proxy in JavaScript has its own</span> <span data-start="523.149" data-end="526.42">constructor and the constructor takes a</span> <span data-start="526.42" data-end="530.339">target object and a handler object and</span> <span data-start="530.339" data-end="533.68">this target object can be any type of</span> <span data-start="533.68" data-end="535.66">object it can be a plane object it can</span> <span data-start="535.66" data-end="538.6">be an array it can be a function because</span> <span data-start="538.6" data-end="540.639">functions are objects in JavaScript</span> <span data-start="540.639" data-end="544.18">it can even be another proxy so you can</span> <span data-start="544.18" data-end="547.99">proxy a proxy another important thing</span> <span data-start="547.99" data-end="550.18">about proxies is that they're completely</span> <span data-start="550.18" data-end="552.97">transparent so if I say that I'm</span> <span data-start="552.97" data-end="554.529">creating a proxy here with a plain</span> <span data-start="554.529" data-end="558.939">object as the target if I check type of</span> <span data-start="558.939" data-end="561.67">of this proxy it'll give me object so</span> <span data-start="561.67" data-end="564.629">there's no such thing as a proxy type</span> <span data-start="564.629" data-end="569.5">it's entirely transparent and then</span> <span data-start="569.5" data-end="572.68">there's the handler object and this is</span> <span data-start="572.68" data-end="575.62">where we define so-called traps for all</span> <span data-start="575.62" data-end="577.329">of these operations that you can do on</span> <span data-start="577.329" data-end="580.75">objects and here's an example with a</span> <span data-start="580.75" data-end="583.839">getter trap where we say that if you</span> <span data-start="583.839" data-end="586.75">ever try to get a property from this</span> <span data-start="586.75" data-end="592.899">object we'll just return 37 so we can</span> <span data-start="592.899" data-end="594.79">create a new proxy using that Handler</span> <span data-start="594.79" data-end="598.389">and if I try to access a from this</span> <span data-start="598.389" data-end="600.339">object or B from this object it'll just</span> <span data-start="600.339" data-end="604.18">keep returning 37 and for any available</span> <span data-start="604.18" data-end="606.73">fundamental operation there is a</span> <span data-start="606.73" data-end="609.189">corresponding trap so you have a getter</span> <span data-start="609.189" data-end="613.209">trap you have a setter has apply and so</span> <span data-start="613.209" data-end="616.93">on and you also have this accompanying</span> <span data-start="616.93" data-end="621.91">new api called the reflect api which can</span> <span data-start="621.91" data-end="624.04">be used to perform all of these</span> <span data-start="624.04" data-end="628.839">operations on objects and an example of</span> <span data-start="628.839" data-end="630.85">this is let's say we have an object here</span> <span data-start="630.85" data-end="634.66">with a property we can use reflect get</span> <span data-start="634.66" data-end="636.279">to say that we want to get the health</span> <span data-start="636.279" data-end="641.439">property from this hero object so in the</span> <span data-start="641.439" data-end="644.23">same way that there is a trap for every</span> <span data-start="644.23" data-end="647.37">operation there is</span> <span data-start="647.37" data-end="651.029">a corresponding method in the reflect</span> </p>
<p><span data-start="651.029" data-end="654.779">API so if we do a complete one-to-one</span> <span data-start="654.779" data-end="658.589">mapping here you'll get a proxy that is</span> <span data-start="658.589" data-end="661.08">just a pure relay it doesn't do anything</span> <span data-start="661.08" data-end="664.05">it'll behave the object will behave just</span> <span data-start="664.05" data-end="666.87">as it would have if you didn't wrap it</span> <span data-start="666.87" data-end="670.29">in a proxy so the nice thing now is that</span> <span data-start="670.29" data-end="672.6">as I said you can have overload a lot of</span> <span data-start="672.6" data-end="674.4">these fundamental operations like the</span> <span data-start="674.4" data-end="676.529">dot operator the equals and the function</span> <span data-start="676.529" data-end="681.9">call and one example of this is let's</span> <span data-start="681.9" data-end="683.94">say we wanted to add some</span> <span data-start="683.94" data-end="686.7">instrumentation to our code so we'll</span> <span data-start="686.7" data-end="688.14">create a function that's called log</span> <span data-start="688.14" data-end="690.18">access to properties it takes an object</span> <span data-start="690.18" data-end="694.56">and we return a proxy with that object</span> <span data-start="694.56" data-end="698.13">as the target object and then we pass it</span> <span data-start="698.13" data-end="700.95">a handler object with a getter trap</span> <span data-start="700.95" data-end="703.29">saying that ok if you ever try to get</span> <span data-start="703.29" data-end="704.97">something from this object I'll log out</span> <span data-start="704.97" data-end="707.31">whatever you try to get and then I'll</span> <span data-start="707.31" data-end="710.15">return a result of actually getting that</span> <span data-start="710.15" data-end="712.74">and we can also add a setter trap saying</span> <span data-start="712.74" data-end="714.57">that if you try to set something will</span> <span data-start="714.57" data-end="718.44">log out whatever you try to set and then</span> <span data-start="718.44" data-end="722.01">we'll set that on the object and the</span> <span data-start="722.01" data-end="724.32">nice thing here is that the object that</span> <span data-start="724.32" data-end="726.209">is being wrapped in a proxy doesn't know</span> <span data-start="726.209" data-end="728.49">about it and the proxy doesn't have to</span> <span data-start="728.49" data-end="730.5">know anything about the object it's</span> <span data-start="730.5" data-end="735.839">wrapping so it's completely decoupled so</span> <span data-start="735.839" data-end="738">if you use this now we can create an</span> <span data-start="738" data-end="742.98">object a bit like here we can create an</span> <span data-start="742.98" data-end="746.04">object with some properties and then we</span> <span data-start="746.04" data-end="749.25">can create a proxy using this function</span> <span data-start="749.25" data-end="752.97">log access to properties so whenever I</span> <span data-start="752.97" data-end="755.67">try to access a property here now it'll</span> <span data-start="755.67" data-end="757.62">log out the access and if I try to</span> <span data-start="757.62" data-end="760.08">change something it'll log out whatever</span> <span data-start="760.08" data-end="766.23">you changed and we can also use proxies</span> <span data-start="766.23" data-end="770.9">to make observable objects pretty easily</span> <span data-start="770.9" data-end="773.52">so let's say we create us as a function</span> <span data-start="773.52" data-end="775.8">called observable which takes an object</span> <span data-start="775.8" data-end="778.8">that you want to observe and then it</span> <span data-start="778.8" data-end="780.66">takes an unchanged function</span> <span data-start="780.66" data-end="783.65">we'll call whenever something changes</span> <span data-start="783.65" data-end="787.26">we'll return a new proxy put the object</span> <span data-start="787.26" data-end="789.36">in the target putting a handler which</span> <span data-start="789.36" data-end="791.82">has a set trap so whenever you try to</span> <span data-start="791.82" data-end="794.19">set something on this object will</span> <span data-start="794.19" data-end="796.23">actually set it and then afterwards</span> <span data-start="796.23" data-end="798">we'll call the unchanged method with</span> <span data-start="798" data-end="802.47">whatever you updated so if you want to</span> <span data-start="802.47" data-end="806.01">use this this isn't actually as useful</span> <span data-start="806.01" data-end="809">as true observables because we have to</span> <span data-start="809" data-end="813.03">overwrite the original object but now we</span> <span data-start="813.03" data-end="815.28">can create an object here that is</span> <span data-start="815.28" data-end="818.4">observable so if I ever change if I</span> <span data-start="818.4" data-end="820.26">change the name here it'll log out name</span> <span data-start="820.26" data-end="821.88">change to Frank if I change the age</span> <span data-start="821.88" data-end="827.07">it'll log out the age change to 40 so</span> <span data-start="827.07" data-end="830.04">all of this is nice but it's not really</span> <span data-start="830.04" data-end="833.97">something that would revolutionize how</span> <span data-start="833.97" data-end="837.69">you write code in JavaScript so I tried</span> <span data-start="837.69" data-end="839.52">to I try to think about I didn't really</span> <span data-start="839.52" data-end="840.75">want to do this talk before I had</span> <span data-start="840.75" data-end="844.98">something useful to do do you use</span> <span data-start="844.98" data-end="849.18">proxies for so for the last year I've</span> <span data-start="849.18" data-end="850.86">been working on a client project with a</span> <span data-start="850.86" data-end="853.8">lot of people where we have a large</span> <span data-start="853.8" data-end="855.18">amount of real-time data</span> <span data-start="855.18" data-end="859.83">think something like firebase and we</span> <span data-start="859.83" data-end="861.48">have a lot of data that looks like this</span> <span data-start="861.48" data-end="865.25">let's say we have we have a collection</span> <span data-start="865.25" data-end="869.85">we have a collection of stories and</span> <span data-start="869.85" data-end="872.73">every story has an ID it has a title it</span> <span data-start="872.73" data-end="875.16">has an author it has a list of people</span> <span data-start="875.16" data-end="877.53">that have liked this story that have</span> <span data-start="877.53" data-end="879.9">read this story and so on and what you</span> <span data-start="879.9" data-end="882.72">can see here is that it's just</span> <span data-start="882.72" data-end="889.59">references and we can also imagine that</span> <span data-start="889.59" data-end="892.4">we have another list here of people and</span> <span data-start="892.4" data-end="896.28">these people have authored books they</span> <span data-start="896.28" data-end="901.88">have read books they have liked books so</span> <span data-start="901.88" data-end="904.14">what we see here is that these</span> <span data-start="904.14" data-end="905.7">references are actually pointing to</span> <span data-start="905.7" data-end="908.94">different objects so the person one here</span> <span data-start="908.94" data-end="911.89">is pointing to person one in our</span> <span data-start="911.89" data-end="914.8">in our people collection and story one</span> <span data-start="914.8" data-end="919.12">here is are all pointing to the first</span> <span data-start="919.12" data-end="923.52">story so what we really have here is</span> <span data-start="923.52" data-end="927.49">it's sort of a graph so if we just</span> <span data-start="927.49" data-end="929.89">consolidate this into an object we have</span> <span data-start="929.89" data-end="931.75">a collection of stories and we have a</span> <span data-start="931.75" data-end="934.02">collection of people and they're all</span> <span data-start="934.02" data-end="939.01">connected together in different ways so</span> <span data-start="939.01" data-end="941.41">what does it look like if you want to</span> <span data-start="941.41" data-end="943.45">traverse this thing let's say you want</span> <span data-start="943.45" data-end="945.85">you need to traverse this thing very</span> <span data-start="945.85" data-end="949.45">deeply so we can start out then let's</span> <span data-start="949.45" data-end="952">say we want to find we want to find the</span> <span data-start="952" data-end="955.78">name of the first person that liked the</span> <span data-start="955.78" data-end="958.81">first story so we'll go into the graph</span> <span data-start="958.81" data-end="961.63">we'll pull out the first story we'll</span> <span data-start="961.63" data-end="964.3">pull out the array of references but to</span> <span data-start="964.3" data-end="966.61">people who have liked it we'll have to</span> <span data-start="966.61" data-end="969.73">map it so that we can actually map it</span> <span data-start="969.73" data-end="974.74">over to the actual objects and then</span> <span data-start="974.74" data-end="977.56">you'll have to choose the first element</span> <span data-start="977.56" data-end="979.3">of that and then we can pull out the</span> <span data-start="979.3" data-end="983.47">name or if you want to find the title of</span> <span data-start="983.47" data-end="986.08">the first like story by the author this</span> <span data-start="986.08" data-end="989.05">is getting pretty deep now we'll have to</span> <span data-start="989.05" data-end="991.39">get the right collection based on this</span> <span data-start="991.39" data-end="994.83">reference we'll have to find the correct</span> <span data-start="994.83" data-end="998.32">author and then we can pull out the</span> <span data-start="998.32" data-end="1003.03">title from there this gets really</span> <span data-start="1003.03" data-end="1008.27">tedious it would be so much better if we</span> <span data-start="1008.27" data-end="1011.4">could just access this like it was a</span> <span data-start="1011.4" data-end="1014.55">plain object so that we can go into the</span> <span data-start="1014.55" data-end="1018.39">first story we can go into the like by</span> <span data-start="1018.39" data-end="1021.99">list and then just assume that that's</span> <span data-start="1021.99" data-end="1024.53">the actual object not just a reference</span> <span data-start="1024.53" data-end="1028.58">and the same thing with the title here</span> <span data-start="1028.58" data-end="1031.92">so this is really this would be a much</span> <span data-start="1031.92" data-end="1033.72">better interface to interact with this</span> <span data-start="1033.72" data-end="1037.74">graph so what we really want our data to</span> <span data-start="1037.74" data-end="1041.4">look like is something like this because</span> <span data-start="1041.4" data-end="1044.67">what we have is just a reference here we</span> <span data-start="1044.67" data-end="1046.049">are</span> <span data-start="1046.049" data-end="1049.789">we're in story one and it has an author</span> <span data-start="1049.789" data-end="1052.259">but what we really want is that author</span> <span data-start="1052.259" data-end="1055.44">to be that object and again that has a</span> <span data-start="1055.44" data-end="1057.779">list of stories that the author has</span> <span data-start="1057.779" data-end="1061.83">liked and we would just rather have that</span> <span data-start="1061.83" data-end="1066.389">be the actual story and so on</span> <span data-start="1066.389" data-end="1069.09">and this goes on infinitely right</span> <span data-start="1069.09" data-end="1073.559">because this is circular so we need some</span> <span data-start="1073.559" data-end="1077.099">kind of way of transforming this object</span> <span data-start="1077.099" data-end="1079.379">that contains only references to an</span> <span data-start="1079.379" data-end="1083.849">actually populated object here so let's</span> <span data-start="1083.849" data-end="1085.589">imagine that we could create an</span> <span data-start="1085.589" data-end="1089.149">interface a function called populate</span> <span data-start="1089.149" data-end="1093.839">which would take the graph as an</span> <span data-start="1093.839" data-end="1096.33">argument and then the node you wanted to</span> <span data-start="1096.33" data-end="1099.539">populate so as an example we we would</span> <span data-start="1099.539" data-end="1102.869">want to have a populated version of the</span> <span data-start="1102.869" data-end="1107.94">first story in our list but how could we</span> <span data-start="1107.94" data-end="1110.219">ever implement this so the naive</span> <span data-start="1110.219" data-end="1114.659">approach would be that okay I'll just</span> <span data-start="1114.659" data-end="1116.429">use something like object a sign and</span> <span data-start="1116.429" data-end="1119.009">just I don't know just keep filling this</span> <span data-start="1119.009" data-end="1121.889">in recursively and until something just</span> <span data-start="1121.889" data-end="1123.629">blows up right because it's infinite</span> <span data-start="1123.629" data-end="1126.419">it's not possible it's just not possible</span> <span data-start="1126.419" data-end="1130.589">to to do this in something that needs to</span> <span data-start="1130.589" data-end="1135.839">evaluate upfront but this is a really</span> <span data-start="1135.839" data-end="1140.379">nice use case for proxies</span> <span data-start="1140.389" data-end="1143.639">so with proxies you can actually make</span> <span data-start="1143.639" data-end="1147.869">this work because even if it seems like</span> <span data-start="1147.869" data-end="1151.169">we have to do this upfront really really</span> <span data-start="1151.169" data-end="1155.94">don't have to because with proxies just</span> <span data-start="1155.94" data-end="1160.589">like with proxy web servers we could</span> <span data-start="1160.589" data-end="1163.409">just say that okay I'm in story zero and</span> </p>
<p><span data-start="1163.409" data-end="1166.379">I access the author but instead of</span> <span data-start="1166.379" data-end="1168.21">actually returning the reference we</span> <span data-start="1168.21" data-end="1171.239">could just redirect you to that actual</span> <span data-start="1171.239" data-end="1174.839">object in the people collection and if</span> <span data-start="1174.839" data-end="1178.859">you then access the story there we would</span> <span data-start="1178.859" data-end="1179.07">just</span> <span data-start="1179.07" data-end="1185.46">we direct you back so now using proxies</span> <span data-start="1185.46" data-end="1189.57">we can actually have this nice interface</span> <span data-start="1189.57" data-end="1192.59">by pretending that this is an infinitely</span> <span data-start="1192.59" data-end="1196.95">nested object except it's just too flat</span> <span data-start="1196.95" data-end="1201.059">lists in JSON and I'm wanted to show</span> <span data-start="1201.059" data-end="1202.799">some code examples for how to do this</span> <span data-start="1202.799" data-end="1205.049">but they just did not fit in to the</span> <span data-start="1205.049" data-end="1208.139">slides in any a reasonable way so if</span> <span data-start="1208.139" data-end="1210.47">anyone wants to take a look there's a</span> <span data-start="1210.47" data-end="1216.029">open-source version of this and now I</span> <span data-start="1216.029" data-end="1221.61">felt really excited because for the</span> <span data-start="1221.61" data-end="1225.12">first time I felt that I had some proper</span> <span data-start="1225.12" data-end="1226.86">use case for proxies because this was</span> <span data-start="1226.86" data-end="1228.539">something that you couldn't do without</span> <span data-start="1228.539" data-end="1231.539">proxies so I started to think about</span> <span data-start="1231.539" data-end="1234.559">other things that I could use this for</span> <span data-start="1234.559" data-end="1238.11">and thing I got a really good idea</span> <span data-start="1238.11" data-end="1241.649">because we all have a beef with</span> </p>
<p><span data-start="1241.649" data-end="1248.279">JavaScript right  it's not a</span> <span data-start="1248.279" data-end="1250.62">function and cannot read properties</span> <span data-start="1250.62" data-end="1253.259">something something of  and and</span> <span data-start="1253.259" data-end="1256.259">yes I know about typescript and flow but</span> <span data-start="1256.259" data-end="1261.57">there's no fun in that so with this as a</span> <span data-start="1261.57" data-end="1266.22">starting point I figured all right I'm</span> <span data-start="1266.22" data-end="1268.44">done with  not being a function</span> <span data-start="1268.44" data-end="1273.44">so first up I want to redefine</span> <span data-start="1273.44" data-end="1277.11">so this is my own  and it's</span> <span data-start="1277.11" data-end="1279.149">actually going to be a function the</span> <span data-start="1279.149" data-end="1282.59">target object is a function just the</span> <span data-start="1282.59" data-end="1285.72">empty function and I'll declare that</span> <span data-start="1285.72" data-end="1289.679">this is gonna have a getter trap so</span> <span data-start="1289.679" data-end="1291.45">whenever I try to get something from</span> <span data-start="1291.45" data-end="1295.74">notice that there's one kind</span> <span data-start="1295.74" data-end="1298.799">of Lee key thing here is that functions</span> <span data-start="1298.799" data-end="1301.889">need to have names so I had to kind of</span> <span data-start="1301.889" data-end="1303.75">shim the name in here so that if you</span> <span data-start="1303.75" data-end="1307.049">ever access name this doesn't you can't</span> <span data-start="1307.049" data-end="1309.779">change any further on that but I'll just</span> <span data-start="1309.779" data-end="1312.21">return  again so if you try to</span> <span data-start="1312.21" data-end="1312.93">access something</span> <span data-start="1312.93" data-end="1315.71">and then just get another  and</span> <span data-start="1315.71" data-end="1318.57">if you ever tried to call  as a</span> <span data-start="1318.57" data-end="1320.04">function I'll just return</span> <span data-start="1320.04" data-end="1325.08">again so now I figured we just need to</span> <span data-start="1325.08" data-end="1329.88">make some seat belts for JavaScript so</span> <span data-start="1329.88" data-end="1332.73">we have a function here that takes an</span> <span data-start="1332.73" data-end="1336.75">object and it returns a proxy of that</span> <span data-start="1336.75" data-end="1340.59">object and says that if you ever try to</span> <span data-start="1340.59" data-end="1343.35">get something from this object will</span> <span data-start="1343.35" data-end="1346.02">check does this property actually exist</span> <span data-start="1346.02" data-end="1350.55">if it does if it doesn't it's an object</span> <span data-start="1350.55" data-end="1353.39">will return another seat belt wrapped</span> <span data-start="1353.39" data-end="1357.24">version of that object so that you can</span> <span data-start="1357.24" data-end="1360.57">get this recursively but if that</span> <span data-start="1360.57" data-end="1362.46">property doesn't exist meaning that it's</span> <span data-start="1362.46" data-end="1364.77">or no we'll just return our</span> <span data-start="1364.77" data-end="1367.62">new  here and if it does exist</span> <span data-start="1367.62" data-end="1370.05">we'll return the property that you tried</span> <span data-start="1370.05" data-end="1376.59">to get so we can create a an object here</span> <span data-start="1376.59" data-end="1378.75">now using the seat belt function just a</span> <span data-start="1378.75" data-end="1380.43">plane object that has some properties</span> <span data-start="1380.43" data-end="1386.22">with some values seems to work fine I</span> <span data-start="1386.22" data-end="1390.03">can access foo I can access this nested</span> <span data-start="1390.03" data-end="1396.3">field I can access name and so on but I</span> <span data-start="1396.3" data-end="1399.63">can also do this now I can access</span> <span data-start="1399.63" data-end="1402.9">something that's not here and something</span> <span data-start="1402.9" data-end="1405.06">other that's not here that definitely</span> <span data-start="1405.06" data-end="1407.34">isn't a function call that as a function</span> <span data-start="1407.34" data-end="1410.79">and then pull out something else and you</span> <span data-start="1410.79" data-end="1413.16">know what function is not  it's</span> <span data-start="1413.16" data-end="1417.33">actually a function so now you can do</span> <span data-start="1417.33" data-end="1420.39">things like this so no more crashing</span> <span data-start="1420.39" data-end="1425.61">you've got seat belts but as I was I was</span> <span data-start="1425.61" data-end="1427.23">pretty pleased with myself this was I</span> <span data-start="1427.23" data-end="1431.649">don't know 4 a.m. some</span> <span data-start="1431.659" data-end="1435.929">but there's just one bump in the road</span> <span data-start="1435.929" data-end="1442.11">and that is I figured so this is nice</span> <span data-start="1442.11" data-end="1443.909">but I still have to use this seatbelt</span> <span data-start="1443.909" data-end="1445.529">thing I don't want to do that I want</span> <span data-start="1445.529" data-end="1448.139">this to be automatic so I tried to do</span> <span data-start="1448.139" data-end="1453.6">this I wanted to set the prototype as a</span> <span data-start="1453.6" data-end="1460.289">seatbelt object and it turns out that it</span> <span data-start="1460.289" data-end="1464.159">turns out that someone smart had figured</span> <span data-start="1464.159" data-end="1466.289">out that this is not good</span> <span data-start="1466.289" data-end="1471.48">and now this prototype object the bottom</span> <span data-start="1471.48" data-end="1473.85">level prototype is a so-called exotic</span> <span data-start="1473.85" data-end="1475.95">object so you cannot override the</span> <span data-start="1475.95" data-end="1478.889">prototype I even tried to look for any</span> <span data-start="1478.889" data-end="1481.59">version that implemented proxies but not</span> <span data-start="1481.59" data-end="1485.669">this exotic object and I even considered</span> <span data-start="1485.669" data-end="1488.58">compiling my own v8 for node and then</span> <span data-start="1488.58" data-end="1491.039">making this work but I figured I'm just</span> <span data-start="1491.039" data-end="1492.5">too far down the rabbit hole this is</span> <span data-start="1492.5" data-end="1496.379">ridiculous so I figured I'm taking it</span> <span data-start="1496.379" data-end="1502.639">too far but it would have been fun so</span> <span data-start="1502.639" data-end="1508.44">with this I was really sad about that</span> <span data-start="1508.44" data-end="1514.399">but in conclusion you can use proxies</span> <span data-start="1514.399" data-end="1516.99">for a lot of good things you can make</span> <span data-start="1516.99" data-end="1520.59">really powerful abstractions and you can</span> <span data-start="1520.59" data-end="1523.639">add a lot of functionality transparently</span> <span data-start="1523.639" data-end="1526.35">but the bad thing is that you can also</span> <span data-start="1526.35" data-end="1528.919">just mangle things completely and</span> <span data-start="1528.919" data-end="1531.799">introduce a lot of magic so that</span> </p>
<p><span data-start="1531.799" data-end="1534.149">JavaScript doesn't really behave like</span> <span data-start="1534.149" data-end="1539.07">JavaScript anymore but all in all I</span> <span data-start="1539.07" data-end="1541.47">think this is another great tool in your</span> <span data-start="1541.47" data-end="1544.039">toolbox to build your dream interfaces</span> <span data-start="1544.039" data-end="1547.649">so you should go ahead and figure out if</span> <span data-start="1547.649" data-end="1549.69">you have some kind of thing you want to</span> <span data-start="1549.69" data-end="1552.96">solve that just doesn't work in plain</span> <span data-start="1552.96" data-end="1555.24">JavaScript you should try to see if</span> <span data-start="1555.24" data-end="1558.47">proxies can help you with that and</span> <span data-start="1558.47" data-end="1561.5">that's it</span> <span data-start="1561.5" data-end="1568.96">[Applause]</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
