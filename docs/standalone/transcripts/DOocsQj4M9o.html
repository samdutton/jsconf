<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DOocsQj4M9o</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/DOocsQj4M9o?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="21.63" data-end="25.26">you</span> <span data-start="25.27" data-end="27.61">so I'm Richard this is Daniel and the</span> <span data-start="27.61" data-end="28.96">wig we took out the circuit breaker</span> <span data-start="28.96" data-end="31.33">pattern in JavaScript and it's the same</span> <span data-start="31.33" data-end="32.349">before we probably could have done a</span> <span data-start="32.349" data-end="33.7">better job of titling this because</span> <span data-start="33.7" data-end="35.35">unless you know what a circuit breaker</span> <span data-start="35.35" data-end="37.15">pattern is you it might not be obvious</span> <span data-start="37.15" data-end="39.46">but it's essentially a way to isolate</span> <span data-start="39.46" data-end="41.83">communication between web services in a</span> <span data-start="41.83" data-end="47.26">distributed system so go back a little</span> <span data-start="47.26" data-end="47.769">way</span> </p>
<p><span data-start="47.769" data-end="49.989">Yama's started as a pretty standard</span> <span data-start="49.989" data-end="53.62">rails app but as we start to scale our</span> <span data-start="53.62" data-end="55.21">project and add features we found that</span> <span data-start="55.21" data-end="57.909">we hit skating problems pretty soon so</span> <span data-start="57.909" data-end="59.049">he needs to rethink parts of our</span> <span data-start="59.049" data-end="62.17">architecture we started by extracting</span> <span data-start="62.17" data-end="63.94">messaging service called fede which we</span> <span data-start="63.94" data-end="66.61">built on the JVM so one of the first</span> <span data-start="66.61" data-end="68.89">game cross we hit was with our how he's</span> <span data-start="68.89" data-end="71.11">storing messages we actually got to over</span> <span data-start="71.11" data-end="73.42">a billion rows in Postgres in our</span> <span data-start="73.42" data-end="75.67">message table so we clearly need to</span> <span data-start="75.67" data-end="77.79">rethink how we did this and we</span> <span data-start="77.79" data-end="80.59">implemented fede but to represent a</span> <span data-start="80.59" data-end="82.93">scalable representation of conversations</span> <span data-start="82.93" data-end="85.6">using just the message IDs and then the</span> <span data-start="85.6" data-end="87.01">actual content of the messages was</span> <span data-start="87.01" data-end="90.579">stored in rails still so whilst that</span> <span data-start="90.579" data-end="92.829">didn't change things that much moving</span> <span data-start="92.829" data-end="94.63">this stuff out into a separate service</span> <span data-start="94.63" data-end="96.909">and a separate data store allow us to</span> <span data-start="96.909" data-end="98.35">dramatically reduce the load on our</span> <span data-start="98.35" data-end="100.03">rails app and also reduce the amount of</span> <span data-start="100.03" data-end="101.74">stuff we need to store in our Postgres</span> <span data-start="101.74" data-end="105.81">database so fitti worked really well and</span> <span data-start="105.81" data-end="109.39">as we have continued to scale our system</span> <span data-start="109.39" data-end="111.909">and add new features we've essentially</span> <span data-start="111.909" data-end="113.829">fought that same approach so we now have</span> <span data-start="113.829" data-end="117.34">over 20 services say things like farvel</span> <span data-start="117.34" data-end="119.92">which is our upload service mug shot</span> <span data-start="119.92" data-end="123.39">which resizes images paddy which is a</span> <span data-start="123.39" data-end="127.719">like collaborative editor thing and this</span> <span data-start="127.719" data-end="129.039">is provide us with quite a few benefits</span> <span data-start="129.039" data-end="131.53">so the most obvious one probably is</span> <span data-start="131.53" data-end="133.3">being able to horizontally scale each</span> <span data-start="133.3" data-end="135.4">service independently so we need to add</span> <span data-start="135.4" data-end="137.68">capacity for fede we can do that really</span> <span data-start="137.68" data-end="139.96">easily without increasing capacity over</span> <span data-start="139.96" data-end="142.48">the whole system it's also nice to</span> <span data-start="142.48" data-end="145.33">separate concerns so understanding what</span> <span data-start="145.33" data-end="147.64">each service does is much easier as it's</span> <span data-start="147.64" data-end="149.38">a separate code base then it would be if</span> <span data-start="149.38" data-end="152.319">it was part of the like one massive</span> <span data-start="152.319" data-end="155.35">repository and it's also much easier to</span> <span data-start="155.35" data-end="157.06">deploy these things so if we make a</span> <span data-start="157.06" data-end="158.69">change to mug shot we can</span> <span data-start="158.69" data-end="160.91">deploy that one service without having</span> <span data-start="160.91" data-end="162.5">to take the risk of deploying the entire</span> <span data-start="162.5" data-end="167.33">system and finally it also improves the</span> <span data-start="167.33" data-end="170.18">full torrents of Yama so if one service</span> <span data-start="170.18" data-end="172.34">goes down ideally at least it shouldn't</span> <span data-start="172.34" data-end="173.75">bring other things down with it it</span> <span data-start="173.75" data-end="176.06">should be separated whereas if you have</span> <span data-start="176.06" data-end="178.37">a single app then that's a single point</span> <span data-start="178.37" data-end="179.99">of failure and if that goes down then</span> <span data-start="179.99" data-end="181.79">there's not very much you can do by</span> <span data-start="181.79" data-end="183.53">separating things out into different</span> <span data-start="183.53" data-end="186.62">services it's allowed us to degrade</span> <span data-start="186.62" data-end="191.06">gracefully when things go wrong so this</span> <span data-start="191.06" data-end="192.89">is a little out of date actually but it</span> <span data-start="192.89" data-end="194">gives you a rough idea of what our</span> <span data-start="194" data-end="196.94">architecture looks like and it also show</span> <span data-start="196.94" data-end="198.11">you some of the problems with this so</span> <span data-start="198.11" data-end="201.74">whilst building things in a</span> <span data-start="201.74" data-end="203.36">service-oriented ways give us a lot</span> <span data-start="203.36" data-end="205.96">benefits it does it does definitely</span> <span data-start="205.96" data-end="208.16">increase the complexity of the system as</span> <span data-start="208.16" data-end="208.61">a whole</span> <span data-start="208.61" data-end="210.35">so each service is easier to understand</span> <span data-start="210.35" data-end="212.6">but that largely just pushes stuff out</span> <span data-start="212.6" data-end="216.77">into complications with how things</span> <span data-start="216.77" data-end="217.97">communicate with each other and how</span> <span data-start="217.97" data-end="220.48">those services are coordinated</span> <span data-start="220.48" data-end="223.16">maintaining API contracts is also much</span> <span data-start="223.16" data-end="224.989">more difficult because you might make a</span> <span data-start="224.989" data-end="227.27">change in one part of the system and it</span> <span data-start="227.27" data-end="231.32">will have very big profound problems in</span> <span data-start="231.32" data-end="232.25">other parts system that you weren't</span> <span data-start="232.25" data-end="236.06">aware would would be affected and this</span> <span data-start="236.06" data-end="237.98">also relates to debugging so when you</span> <span data-start="237.98" data-end="240.62">get a bug reports tracing those symptoms</span> <span data-start="240.62" data-end="242.27">back to the actual root cause is far</span> <span data-start="242.27" data-end="244.04">more difficult because instead of it</span> <span data-start="244.04" data-end="247.34">being due to a nicely isolated part of</span> <span data-start="247.34" data-end="249.38">the system is usually a result of lots</span> <span data-start="249.38" data-end="251.15">of things interacting together and</span> <span data-start="251.15" data-end="253.43">causing a problem and then finally</span> <span data-start="253.43" data-end="256.31">handling failing dependencies really</span> <span data-start="256.31" data-end="258.41">needs to be thought of upfront so the</span> <span data-start="258.41" data-end="259.88">fault tolerance I mentioned on the</span> <span data-start="259.88" data-end="261.68">previous slide doesn't really come for</span> <span data-start="261.68" data-end="263.06">free you've got to think about how to</span> <span data-start="263.06" data-end="266.03">handle the dependencies of each service</span> <span data-start="266.03" data-end="268.22">when they go down because if you don't</span> <span data-start="268.22" data-end="270.14">that will also bring your own service</span> <span data-start="270.14" data-end="272.06">down and they'll potentially cascade to</span> <span data-start="272.06" data-end="275.18">the rest of the system so to look at</span> <span data-start="275.18" data-end="276.26">this in a bit more detail we're going to</span> <span data-start="276.26" data-end="278.3">take a look at our completely service</span> <span data-start="278.3" data-end="280.4">which is our web service for providing</span> <span data-start="280.4" data-end="283.58">autocomplete results so if you pass the</span> <span data-start="283.58" data-end="286.31">name Bob it would turn all of the Bob's</span> <span data-start="286.31" data-end="289.09">in your network but on a large network</span> <span data-start="289.09" data-end="291.38">that could be hundreds of names and we</span> <span data-start="291.38" data-end="292.28">don't want a force I use</span> <span data-start="292.28" data-end="296.33">to search through that list so we use</span> <span data-start="296.33" data-end="297.92">another service called pranky which rec</span> <span data-start="297.92" data-end="300.95">which ranks things in relation to you so</span> <span data-start="300.95" data-end="305">completely uses this to sort its list</span> <span data-start="305" data-end="306.8">based on how likely you are to want to</span> <span data-start="306.8" data-end="308.54">come to that person and then passes back</span> <span data-start="308.54" data-end="310.669">the most ten or like ten or twenty most</span> <span data-start="310.669" data-end="314.66">relevant users but with this pattern if</span> </p>
<p><span data-start="314.66" data-end="317.24">Frankie goes down then if we don't think</span> <span data-start="317.24" data-end="318.56">about this at all and that's also going</span> <span data-start="318.56" data-end="321.29">to bring down completing if it fails</span> <span data-start="321.29" data-end="323.3">quickly with a 500 error we can at least</span> <span data-start="323.3" data-end="325.19">handle the error normally and continue</span> <span data-start="325.19" data-end="326.44">on</span> <span data-start="326.44" data-end="329.12">but if prank is just unavailable then</span> <span data-start="329.12" data-end="331.19">the request is lighters timeout which</span> <span data-start="331.19" data-end="332.21">means we'll have to wait for that to</span> <span data-start="332.21" data-end="333.41">complete before we can pass any</span> <span data-start="333.41" data-end="336.65">information back to the user and we also</span> <span data-start="336.65" data-end="338.12">need to do this every time so every time</span> <span data-start="338.12" data-end="339.89">complete it makes a request to Frankie</span> <span data-start="339.89" data-end="342.02">even if we know that's likely to timeout</span> <span data-start="342.02" data-end="344.12">we still need to make that call and wait</span> <span data-start="344.12" data-end="345.86">for it to fail before we can actually</span> <span data-start="345.86" data-end="349.16">continue and worse than that if anything</span> <span data-start="349.16" data-end="350.9">actually relies on completely then this</span> <span data-start="350.9" data-end="353.09">latency could cause failures which then</span> <span data-start="353.09" data-end="354.5">start to cascade through the rest of the</span> <span data-start="354.5" data-end="357.32">system so one way of dealing with this</span> <span data-start="357.32" data-end="359.57">is the circuit breaker pattern circuit</span> <span data-start="359.57" data-end="362.72">breaker pattern monsters requests being</span> <span data-start="362.72" data-end="364.58">made between services and records any</span> <span data-start="364.58" data-end="366.68">errors that are thrown and if enough</span> <span data-start="366.68" data-end="368.33">errors a throne to go over a specified</span> <span data-start="368.33" data-end="371.33">error threshold then the circuit breaker</span> <span data-start="371.33" data-end="373.37">is broken at that point or requests a</span> <span data-start="373.37" data-end="374.69">short-circuit didn't don't actually get</span> <span data-start="374.69" data-end="377.86">passed on to the service we then allow</span> <span data-start="377.86" data-end="380.66">periodic retries to test the current</span> <span data-start="380.66" data-end="382.729">health of the system so we don't want to</span> <span data-start="382.729" data-end="385.58">permanently disable a feature for</span> <span data-start="385.58" data-end="389.15">example so in our example the circuit</span> <span data-start="389.15" data-end="390.86">breaker was sit between completing and</span> <span data-start="390.86" data-end="393.53">pranking and as long as these requests</span> <span data-start="393.53" data-end="395.15">are successful they'll just get passed</span> <span data-start="395.15" data-end="398">through you as normal but if Frankie</span> <span data-start="398" data-end="401.479">goes down then it will let a few more</span> <span data-start="401.479" data-end="402.5">requests through but it will record</span> <span data-start="402.5" data-end="404">those as errors and once enough errors</span> <span data-start="404" data-end="406.25">have come through it will go over the</span> <span data-start="406.25" data-end="407.6">error threshold and it will open the</span> <span data-start="407.6" data-end="410.93">circuit breaker so at that point it will</span> <span data-start="410.93" data-end="413.45">short-circuit the requests and they</span> <span data-start="413.45" data-end="415.1">won't actually get passed on to Frankie</span> <span data-start="415.1" data-end="417.47">this allows completed to fail fast and</span> <span data-start="417.47" data-end="420.26">not wait for timeouts to occur and you</span> <span data-start="420.26" data-end="422.15">can actually then specify fallback which</span> <span data-start="422.15" data-end="423.289">will happen in that case</span> <span data-start="423.289" data-end="425.66">so in completely sense it will</span> <span data-start="425.66" data-end="428.729">just return the unsorted list of results</span> <span data-start="428.729" data-end="430.11">which obviously isn't as good as</span> <span data-start="430.11" data-end="432.389">returning more relevant results but at</span> <span data-start="432.389" data-end="434.19">least means that our application can</span> <span data-start="434.19" data-end="436.259">continue to function in some way when</span> <span data-start="436.259" data-end="438.139">there's a failure in part of our system</span> <span data-start="438.139" data-end="440.43">it'll just have some other benefits they</span> <span data-start="440.43" data-end="442.65">burst and they were handling in that you</span> <span data-start="442.65" data-end="444.6">can report when a circuit breaker is</span> <span data-start="444.6" data-end="446.37">opened and then logs out somewhere so</span> <span data-start="446.37" data-end="448.289">you can get idea of when your system is</span> <span data-start="448.289" data-end="450.87">facing problems and it also prevents you</span> <span data-start="450.87" data-end="452.34">from hammering the same service when</span> <span data-start="452.34" data-end="454.11">it's already down which will make it far</span> <span data-start="454.11" data-end="455.699">more difficult to recover when there is</span> <span data-start="455.699" data-end="459.06">a problem so we use hysterics on our</span> <span data-start="459.06" data-end="460.889">back-end services which is a Java</span> <span data-start="460.889" data-end="463.68">library built by Netflix there's a few</span> <span data-start="463.68" data-end="464.94">really good blog post about how its work</span> <span data-start="464.94" data-end="467.699">and the documentation is really great so</span> <span data-start="467.699" data-end="470.91">it's free easy to see what it's doing it</span> <span data-start="470.91" data-end="472.83">also has a sister project which provides</span> <span data-start="472.83" data-end="474.51">the real-time dashboards so this will</span> <span data-start="474.51" data-end="477.84">log when any circuit breakers are opened</span> <span data-start="477.84" data-end="479.76">and you can see that here and monitor</span> <span data-start="479.76" data-end="480.57">any problems you might have with your</span> <span data-start="480.57" data-end="484.56">application but we like client side</span> <span data-start="484.56" data-end="487.71">calls in our application in our example</span> <span data-start="487.71" data-end="490.44">sorry the completed services in yet ever</span> <span data-start="490.44" data-end="492.69">called from the browser and if</span> <span data-start="492.69" data-end="494.729">completely goes down then we're going to</span> <span data-start="494.729" data-end="495.66">face the same kind of problems that you</span> <span data-start="495.66" data-end="497.4">would did when Frankie went down we'll</span> <span data-start="497.4" data-end="499.68">have timeouts delaying user interaction</span> <span data-start="499.68" data-end="501.06">and we won't actually know that</span> <span data-start="501.06" data-end="502.59">completey has gone down potentially if</span> <span data-start="502.59" data-end="505.169">it's in a recoverable State so we really</span> <span data-start="505.169" data-end="506.88">need something to sit between browser</span> <span data-start="506.88" data-end="508.86">requests and completing to monitor</span> <span data-start="508.86" data-end="511.53">request going through recalls any errors</span> <span data-start="511.53" data-end="514.409">that happen and then deal with that case</span> <span data-start="514.409" data-end="517.2">when it does so we've essentially</span> <span data-start="517.2" data-end="519.15">implemented hysterics in the browser or</span> <span data-start="519.15" data-end="521.25">at least a simplified version of it and</span> <span data-start="521.25" data-end="523.95">release that github so Daniels going to</span> <span data-start="523.95" data-end="525.72">talk a bit more about the specifics of</span> <span data-start="525.72" data-end="529.89">that right so our implementation is</span> <span data-start="529.89" data-end="532.08">pretty similar to what hystrix is doing</span> <span data-start="532.08" data-end="534.75">in the Java side of things what we do is</span> <span data-start="534.75" data-end="537.089">we keep track of the results of every</span> <span data-start="537.089" data-end="539.19">command that gets executed through the</span> <span data-start="539.19" data-end="541.29">circuit breaker so we know the number of</span> <span data-start="541.29" data-end="544.709">successes failures timeouts and short</span> <span data-start="544.709" data-end="546.839">circuits which are commands that failed</span> <span data-start="546.839" data-end="550.35">because the circuit was open and we only</span> <span data-start="550.35" data-end="552.06">keep track of these results for a</span> <span data-start="552.06" data-end="554.31">certain amount of time which we call the</span> <span data-start="554.31" data-end="556.41">window which in our example is 10</span> <span data-start="556.41" data-end="559.26">seconds we divided the window into</span> <span data-start="559.26" data-end="561.6">buckets in this case into ten buckets so</span> <span data-start="561.6" data-end="564.66">we have each bucket containing one</span> <span data-start="564.66" data-end="569.01">second of command executions what</span> <span data-start="569.01" data-end="571.65">happens is that every second an old</span> <span data-start="571.65" data-end="574.8">bucket rolls off the window and the new</span> <span data-start="574.8" data-end="578.04">bucket rolls in so we're only keeping</span> <span data-start="578.04" data-end="579.9">track of the last 10 seconds of</span> <span data-start="579.9" data-end="583.89">executions the values in these buckets</span> <span data-start="583.89" data-end="586.89">determine if the circuit breaker is open</span> <span data-start="586.89" data-end="589.59">or closed so what we do is after every</span> <span data-start="589.59" data-end="592.08">command we calculate the percentage of</span> <span data-start="592.08" data-end="594.29">failed requests so we sum up the</span> <span data-start="594.29" data-end="596.79">failures and timeouts and divide it by</span> <span data-start="596.79" data-end="599.79">the total number of executions and that</span> <span data-start="599.79" data-end="601.77">gives us the error percentage if the</span> <span data-start="601.77" data-end="604.08">error percentage is under a certain</span> <span data-start="604.08" data-end="607.35">threshold which may be 50% so if the</span> <span data-start="607.35" data-end="611.31">error percentage is under 50% then we</span> <span data-start="611.31" data-end="613.5">let the circuit breaker closed and</span> <span data-start="613.5" data-end="616.71">commands execute normally but if the</span> <span data-start="616.71" data-end="618.75">error percentage is over the threshold</span> <span data-start="618.75" data-end="620.91">then the circuit breaker will open and</span> <span data-start="620.91" data-end="623.49">any commands that come after this one</span> <span data-start="623.49" data-end="628.08">will fail instantly but the service may</span> <span data-start="628.08" data-end="630.75">recover at some point so every once in a</span> <span data-start="630.75" data-end="633.75">while we have to check the status of the</span> <span data-start="633.75" data-end="637.23">service somehow what we do is after the</span> <span data-start="637.23" data-end="640.02">circuit breaker has opened we let we</span> <span data-start="640.02" data-end="643.11">wait for one full window so in our</span> <span data-start="643.11" data-end="645.57">example that was 10 seconds so we wait</span> <span data-start="645.57" data-end="648.3">for 10 seconds and then we let a single</span> <span data-start="648.3" data-end="651.27">command execute if the service is still</span> <span data-start="651.27" data-end="653.85">down and the command fails then the</span> <span data-start="653.85" data-end="656.67">circuit breaker will remain open but if</span> <span data-start="656.67" data-end="660.24">the service has recovered and the</span> <span data-start="660.24" data-end="663.51">command executed successfully then the</span> <span data-start="663.51" data-end="665.31">circuit breaker will become closed and</span> <span data-start="665.31" data-end="667.08">any commands that come after this one</span> <span data-start="667.08" data-end="671.97">will execute normally the API is really</span> <span data-start="671.97" data-end="672.6">straightforward</span> <span data-start="672.6" data-end="675.36">so you just instantiate a new circuit</span> <span data-start="675.36" data-end="677.58">breaker for your service here we have</span> <span data-start="677.58" data-end="680.67">completely breaker and we pass the</span> <span data-start="680.67" data-end="683.1">necessary configuration so here we're</span> <span data-start="683.1" data-end="685.44">saying that the length of the window is</span> <span data-start="685.44" data-end="688.41">10 seconds we're dividing that window</span> <span data-start="688.41" data-end="690.81">into 10 buckets we're also saying that</span> <span data-start="690.81" data-end="692.819">the timeout duration is 3</span> <span data-start="692.819" data-end="694.589">seconds which I'll explain in the next</span> <span data-start="694.589" data-end="697.439">slide we're also setting the error</span> <span data-start="697.439" data-end="700.199">threshold to 50% so when we calculate</span> <span data-start="700.199" data-end="702.6">the error percentage for a window if</span> <span data-start="702.6" data-end="704.579">it's over this threshold then the</span> <span data-start="704.579" data-end="707.1">circuit breaker will open and we're also</span> <span data-start="707.1" data-end="710.16">setting a volume threshold which is the</span> <span data-start="710.16" data-end="712.169">minimum number of commands that have to</span> <span data-start="712.169" data-end="714.299">execute before we start calculating</span> <span data-start="714.299" data-end="717.019">stats and why is this even necessary</span> <span data-start="717.019" data-end="720.419">well imagine if you instantiate a new</span> <span data-start="720.419" data-end="722.549">circuit breaker and the first command</span> <span data-start="722.549" data-end="725.22">that you execute happens to fail then</span> <span data-start="725.22" data-end="726.359">you would have a one hundred percent</span> <span data-start="726.359" data-end="729.029">error rate and the circuit breaker would</span> <span data-start="729.029" data-end="730.919">open immediately so you want to avoid</span> <span data-start="730.919" data-end="733.139">that situation and that's why we have</span> <span data-start="733.139" data-end="736.229">the volume threshold we wait for in this</span> <span data-start="736.229" data-end="738.299">example five commands to execute and</span> <span data-start="738.299" data-end="744.689">then we start calculating the stats so</span> <span data-start="744.689" data-end="747.029">now we have our circuit breaker and we</span> <span data-start="747.029" data-end="748.709">want to run commands through it a</span> <span data-start="748.709" data-end="750.839">command is just a function which</span> <span data-start="750.839" data-end="752.549">receives a success and a failure</span> <span data-start="752.549" data-end="755.999">callback and you can do whatever you</span> <span data-start="755.999" data-end="758.399">need to do inside that function and then</span> <span data-start="758.399" data-end="760.079">you just need to notify the circuit</span> <span data-start="760.079" data-end="762.509">breaker of the result so here we're</span> <span data-start="762.509" data-end="765.089">calling completely results which is</span> <span data-start="765.089" data-end="767.1">probably making an ajax request</span> <span data-start="767.1" data-end="769.409">if the request is successful we call the</span> <span data-start="769.409" data-end="771.359">success callback if it fails we call the</span> <span data-start="771.359" data-end="774.659">failure callback and this is where the</span> <span data-start="774.659" data-end="777.959">timeout comes into play if neither the</span> <span data-start="777.959" data-end="779.879">success nor the failure callbacks are</span> <span data-start="779.879" data-end="782.549">called after three seconds then we flag</span> <span data-start="782.549" data-end="786.299">this command as a timeout so we have our</span> <span data-start="786.299" data-end="788.249">command to run it through the circuit</span> <span data-start="788.249" data-end="790.259">breaker we just call breaker that run</span> <span data-start="790.259" data-end="793.47">and we pass the command we can also pass</span> <span data-start="793.47" data-end="795.389">an optional second parameter which is</span> <span data-start="795.389" data-end="797.97">the fallback which only gets executed if</span> <span data-start="797.97" data-end="800.609">the circuit breaker is open so if the</span> <span data-start="800.609" data-end="803.279">circuit has broken it keeps the command</span> <span data-start="803.279" data-end="805.199">execution and invokes the fallback</span> <span data-start="805.199" data-end="807.779">directly in the fallback you can call</span> <span data-start="807.779" data-end="810.449">some other service or maybe let the user</span> <span data-start="810.449" data-end="814.229">know that the system is in a Down State</span> <span data-start="814.229" data-end="817.709">and after the command has run we update</span> <span data-start="817.709" data-end="821.909">the statistics and set the state of the</span> <span data-start="821.909" data-end="824.069">circuit breaker to be open or closed and</span> <span data-start="824.069" data-end="828.5">that's it really it's pretty simple</span> <span data-start="828.5" data-end="833.31">all right so in summary circuit breakers</span> <span data-start="833.31" data-end="834.69">allow you to fail fast when there's a</span> <span data-start="834.69" data-end="836.91">problem and degrade gracefully to other</span> <span data-start="836.91" data-end="839.91">solutions they can prevent failures</span> <span data-start="839.91" data-end="841.26">cascading through your the rest of your</span> <span data-start="841.26" data-end="842.76">system so you isolate points of</span> <span data-start="842.76" data-end="845.82">communication to prevent problems going</span> <span data-start="845.82" data-end="848.07">through to other services and they let</span> <span data-start="848.07" data-end="849.96">you discover any problems early and</span> <span data-start="849.96" data-end="851.55">allow you to more easily recover when</span> <span data-start="851.55" data-end="855.06">they do happen and that's it so yeah</span> <span data-start="855.06" data-end="863.46">give any questions or that trip pretty</span> <span data-start="863.46" data-end="864.03">cool</span> <span data-start="864.03" data-end="866.28">sitting beside Brian here and he had a</span> <span data-start="866.28" data-end="869.16">question can you go back to that diagram</span> <span data-start="869.16" data-end="881.14">of services that you have on your slides</span> <span data-start="881.15" data-end="883.89">is nothing connected to Wario because</span> <span data-start="883.89" data-end="886.73">he's a jerk</span> <span data-start="886.74" data-end="889.83">what is why are you I think it's only</span> <span data-start="889.83" data-end="892.68">accessed by the browser right let's say</span> <span data-start="892.68" data-end="900.26">it doesn't appear never fails yeah</span> <span data-start="900.26" data-end="903.21">already exists in the browser sounds</span> <span data-start="903.21" data-end="903.89">about right</span> <span data-start="903.89" data-end="907.71">any other questions oh we're five</span> <span data-start="907.71" data-end="911.01">minutes late really no no we're breaking</span> <span data-start="911.01" data-end="912.66">until four I think so we got a shitload</span> <span data-start="912.66" data-end="914.7">of time I'm basically just eating time</span> <span data-start="914.7" data-end="921.33">right now cool all right thanks guys</span> <span data-start="921.33" data-end="932.41">we'll be back at 4:00</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
