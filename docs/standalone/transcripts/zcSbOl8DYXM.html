<!DOCTYPE html>

<!--
Copyright 2019 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="JSConf transcript">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>zcSbOl8DYXM</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/zcSbOl8DYXM?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="12.86" data-end="15.84">thank you very much yeah my name is</span> <span data-start="15.84" data-end="19.88">David Flynn I am from the United Kingdom</span> <span data-start="19.88" data-end="22.89">and I moved to Iceland one and a half</span> <span data-start="22.89" data-end="26.55">years ago to live here and as a typical</span> <span data-start="26.55" data-end="29.57">developer the first thing I did was</span> <span data-start="29.57" data-end="31.8">thought right I'm gonna have to try to</span> <span data-start="31.8" data-end="33.69">learn Icelandic how am I gonna do this</span> <span data-start="33.69" data-end="37.17">should I a spend lots of time studying</span> <span data-start="37.17" data-end="38.489">with books in a normal way that you</span> <span data-start="38.489" data-end="40.95">learn things well should I instead build</span> <span data-start="40.95" data-end="43.109">a website spend hundreds of hours on</span> <span data-start="43.109" data-end="45.09">that avoiding the problem and try and</span> <span data-start="45.09" data-end="46.199">build a website to help people learn</span> </p>
<p><span data-start="46.199" data-end="48.69">Icelandic so obviously I chose option B</span> <span data-start="48.69" data-end="50.789">so I'm going to talk to you about a</span> <span data-start="50.789" data-end="52.469">project that I've been working on in my</span> <span data-start="52.469" data-end="55.41">free time to do with helping people</span> <span data-start="55.41" data-end="58.14">learn Icelandic but really this is just</span> <span data-start="58.14" data-end="59.399">an example project because I want to</span> <span data-start="59.399" data-end="62.399">talk about using docker how how can we</span> <span data-start="62.399" data-end="64.41">use docker to help us with our</span> <span data-start="64.41" data-end="66.45">development workflow and then all the</span> <span data-start="66.45" data-end="68.16">way through to production so how many</span> <span data-start="68.16" data-end="71.19">people are using docker for production</span> <span data-start="71.19" data-end="73.26">work at the moment I have companies</span> <span data-start="73.26" data-end="74.579">where they're running their Production</span> <span data-start="74.579" data-end="76.65">apps okay lots of people and how many</span> <span data-start="76.65" data-end="78.96">people are using docker everyday in</span> <span data-start="78.96" data-end="82.56">development yeah a lot less and this is</span> <span data-start="82.56" data-end="83.939">this is kind of why I want to talk about</span> <span data-start="83.939" data-end="86.1">is there until now it's been really</span> <span data-start="86.1" data-end="88.95">difficult to use docker for development</span> <span data-start="88.95" data-end="90.78">there's been a lot of problems with how</span> <span data-start="90.78" data-end="93.119">many people have used boot to docker the</span> <span data-start="93.119" data-end="95.549">kind of old way and how many people</span> <span data-start="95.549" data-end="97.74">enjoyed the experience of using booted</span> <span data-start="97.74" data-end="100.829">docker yeah I was there we'll talk about</span> <span data-start="100.829" data-end="103.409">some of the problems with that and it's</span> <span data-start="103.409" data-end="105.27">good news basically everything is fixed</span> <span data-start="105.27" data-end="108.78">so just to give you a quick overview</span> <span data-start="108.78" data-end="110.189">with the application I'm going to talk</span> <span data-start="110.189" data-end="114.18">about it's just an example but it's very</span> <span data-start="114.18" data-end="116.159">kind of standard I've got a node.js</span> <span data-start="116.159" data-end="118.079">back-end that's going to serve our data</span> <span data-start="118.079" data-end="121.02">in JSON format and then we have a react</span> <span data-start="121.02" data-end="123.479">app that just renders that data on the</span> <span data-start="123.479" data-end="125.7">screen so hopefully something that</span> <span data-start="125.7" data-end="126.99">you'll be familiar with and something</span> <span data-start="126.99" data-end="128.94">that you can translate to whatever your</span> <span data-start="128.94" data-end="133.26">application looks like so what's changed</span> <span data-start="133.26" data-end="136.17">what makes now the now the right time to</span> <span data-start="136.17" data-end="139.11">use docker in development so basically</span> <span data-start="139.11" data-end="141">they've produced some new apps docker</span> <span data-start="141" data-end="143.94">for Mac and dock for Windows</span> <span data-start="143.94" data-end="147.72">and these these work differently to the</span> <span data-start="147.72" data-end="149.67">old one so the old version was using</span> <span data-start="149.67" data-end="152.4">virtual machines you had docker running</span> <span data-start="152.4" data-end="155.64">in a virtual machine and it meant that</span> <span data-start="155.64" data-end="157.41">you had to have some special IP</span> <span data-start="157.41" data-end="159.24">addresses to connect to it you had a few</span> <span data-start="159.24" data-end="160.5">quirks because it was running inside</span> </p>
<p><span data-start="160.5" data-end="164.1">VirtualBox so these new apps change</span> <span data-start="164.1" data-end="166.8">everything these are built on they run</span> <span data-start="166.8" data-end="168.6">on hypervisors they're not running</span> <span data-start="168.6" data-end="170.4">inside virtual machines using something</span> <span data-start="170.4" data-end="171.9">called hype kit which is an abstraction</span> <span data-start="171.9" data-end="173.72">layer to create cross-platform</span> <span data-start="173.72" data-end="175.65">hypervisors which is probably the most</span> <span data-start="175.65" data-end="178.07">crazy thing I've ever heard</span> <span data-start="178.07" data-end="181.05">the docker command is now available</span> <span data-start="181.05" data-end="182.7">system-wide so you don't have to have</span> <span data-start="182.7" data-end="184.41">this special docker terminal which is</span> <span data-start="184.41" data-end="186.84">the old way of doing it just you can run</span> <span data-start="186.84" data-end="188.4">docker as a program on the command line</span> <span data-start="188.4" data-end="190.7">from anywhere like a normal application</span> <span data-start="190.7" data-end="193.17">and the containers are all bound to</span> <span data-start="193.17" data-end="194.43">localhost you don't have this special</span> <span data-start="194.43" data-end="196.08">docker machine IP that you connect to</span> <span data-start="196.08" data-end="197.67">anymore you can just access your</span> <span data-start="197.67" data-end="199.71">containers very similar to if you just</span> <span data-start="199.71" data-end="201.66">ran your node application with node</span> <span data-start="201.66" data-end="202.86">you'll be able to access it from</span> <span data-start="202.86" data-end="205.2">localhost same now if you're running in</span> <span data-start="205.2" data-end="207.09">a docker container it's available from</span> <span data-start="207.09" data-end="208.73">localhost</span> <span data-start="208.73" data-end="210.66">the other thing that I'm going to fix</span> <span data-start="210.66" data-end="212.19">which is what really what sorry the</span> <span data-start="212.19" data-end="213.18">other thing that I'm going to talk about</span> <span data-start="213.18" data-end="215.82">that they fixed which really makes the</span> <span data-start="215.82" data-end="218.43">development story work is that before</span> <span data-start="218.43" data-end="220.14">there was a big problem with fire</span> </p>
<p><span data-start="220.14" data-end="221.79">Watchers like if you if your files</span> <span data-start="221.79" data-end="224.1">changed it it didn't get the</span> <span data-start="224.1" data-end="225.6">notification that that file had changed</span> <span data-start="225.6" data-end="227.07">that's like the file system event that</span> <span data-start="227.07" data-end="229.62">the father changed because the files</span> <span data-start="229.62" data-end="231.36">have been like copied into this virtual</span> <span data-start="231.36" data-end="233.31">machine but now they're using a</span> <span data-start="233.31" data-end="234.739">hypervisor they can use the real files</span> <span data-start="234.739" data-end="241.08">and everything worse expected so what do</span> <span data-start="241.08" data-end="242.81">we need to do to run our application</span> <span data-start="242.81" data-end="244.38">inside docker</span> <span data-start="244.38" data-end="246.209">so the first thing I'm going to do is</span> <span data-start="246.209" data-end="248.7">write a docker file who has written the</span> <span data-start="248.7" data-end="251.82">docker file before okay great so about</span> <span data-start="251.82" data-end="253.2">half people have written doc forum</span> <span data-start="253.2" data-end="255.66">before so I'm just going to go through</span> <span data-start="255.66" data-end="258.12">like how to write docker file for a node</span> <span data-start="258.12" data-end="261.12">no GS app and I'm gonna go through line</span> <span data-start="261.12" data-end="263.64">by line to explain specifically why I do</span> <span data-start="263.64" data-end="266.85">it in this particular way and hopefully</span> <span data-start="266.85" data-end="270.03">that will reveal a little bit about how</span> <span data-start="270.03" data-end="271.43">docker works</span> <span data-start="271.43" data-end="274.56">so all docker images are based on a</span> <span data-start="274.56" data-end="276.18">starting image so this is what this</span> <span data-start="276.18" data-end="277.34">first line is</span> <span data-start="277.34" data-end="282.21">node 6.4 it's you can specify the exact</span> <span data-start="282.21" data-end="283.5">version that you want which is nice that</span> <span data-start="283.5" data-end="285.3">gives us a nice repeatable builds and</span> <span data-start="285.3" data-end="288.33">that means that when a new version of</span> <span data-start="288.33" data-end="289.47">know comes along we're still going to be</span> <span data-start="289.47" data-end="291.24">targeting the same build so it's really</span> <span data-start="291.24" data-end="293.13">nice for Pete ability means that if we</span> <span data-start="293.13" data-end="294.63">try and build this in a year's time when</span> <span data-start="294.63" data-end="298.62">we're on node 67 then well it will</span> <span data-start="298.62" data-end="301.41">hopefully still work you also noticed</span> <span data-start="301.41" data-end="305.31">that it just says from note so normally</span> <span data-start="305.31" data-end="306.3">your docker images would have a</span> <span data-start="306.3" data-end="308.76">namespace so it'd be like for my images</span> <span data-start="308.76" data-end="312">it would be from David Blanton / talent</span> </p>
<p><span data-start="312" data-end="314.37">API these ones don't have a namespace</span> <span data-start="314.37" data-end="315.54">and that means that they're official</span> <span data-start="315.54" data-end="317.3">images these are images that have been</span> <span data-start="317.3" data-end="320.76">maintained by someone from the node</span> </p>
<p><span data-start="320.76" data-end="323.31">Foundation and they've been kind of</span> <span data-start="323.31" data-end="326.64">supplied as official images so it's nice</span> <span data-start="326.64" data-end="328.68">to have node configured by someone who</span> <span data-start="328.68" data-end="330.24">works at node and then you can just use</span> <span data-start="330.24" data-end="331.77">it and hopefully everything works as</span> <span data-start="331.77" data-end="336.03">expected this is how you set an</span> <span data-start="336.03" data-end="338.55">environment variable in a docker file</span> <span data-start="338.55" data-end="341.67">and here I'm just changing the NPM</span> <span data-start="341.67" data-end="343.44">config log level to warn because the</span> <span data-start="343.44" data-end="345.36">default is HTTP it will print out every</span> </p>
<p><span data-start="345.36" data-end="347.01">HTTP request that it makes which is</span> <span data-start="347.01" data-end="350.24">probably more information than you need</span> <span data-start="350.24" data-end="352.29">we're going to create a working</span> <span data-start="352.29" data-end="353.82">directory where we're going to keep our</span> <span data-start="353.82" data-end="356.55">code basically what docker is doing is</span> <span data-start="356.55" data-end="357.87">it's wrapping up your application with a</span> <span data-start="357.87" data-end="359.28">file system and that file system</span> <span data-start="359.28" data-end="361.44">contains all the dependencies that you</span> <span data-start="361.44" data-end="363.33">need to run whether it's a runtime</span> <span data-start="363.33" data-end="365.88">environment dependents use binaries</span> <span data-start="365.88" data-end="367.29">anything that's on the path that you</span> <span data-start="367.29" data-end="368.91">need so we need to say where we're</span> <span data-start="368.91" data-end="370.29">running from this so this is the working</span> <span data-start="370.29" data-end="374.31">directory this next line I'm not really</span> <span data-start="374.31" data-end="376.35">not really a hundred percent on this but</span> <span data-start="376.35" data-end="377.94">it's been working really well for me</span> <span data-start="377.94" data-end="379.86">basically if you're using NPM</span> <span data-start="379.86" data-end="382.05">shrink-wrap something I discovered is</span> <span data-start="382.05" data-end="384.15">that normally when you run NPM install</span> <span data-start="384.15" data-end="387.27">it would look at the package.json file</span> <span data-start="387.27" data-end="389.07">read the dependencies from that resolve</span> <span data-start="389.07" data-end="391.17">them based on their constraints you've</span> <span data-start="391.17" data-end="394.17">put in there unless you have a shrink</span> <span data-start="394.17" data-end="396.72">wrap file and then the shrink wrap file</span> <span data-start="396.72" data-end="398.16">contains the exact version the</span> <span data-start="398.16" data-end="399.69">resolution of all the sub dependencies</span> <span data-start="399.69" data-end="402.75">that it should install and I've</span> <span data-start="402.75" data-end="404.79">discovered although the NPM</span> <span data-start="404.79" data-end="406.38">documentation says it doesn't work is</span> <span data-start="406.38" data-end="408.84">that you can install from just a pack</span> <span data-start="408.84" data-end="410.82">from just an NPM shrink wrap file</span> <span data-start="410.82" data-end="413.91">so why would you want to do this why am</span> </p>
<p><span data-start="413.91" data-end="415.76">I not just installing front package.json</span> <span data-start="415.76" data-end="418.14">the problem with the package.json is</span> <span data-start="418.14" data-end="420.21">that it's become kind of a dumping</span> <span data-start="420.21" data-end="421.62">ground for everything else that we do at</span> <span data-start="421.62" data-end="423.21">node so you have scripts in there and</span> <span data-start="423.21" data-end="424.77">then lots of packages put their own</span> <span data-start="424.77" data-end="427.47">configuration in there so maybe you have</span> <span data-start="427.47" data-end="428.85">your babel configuration maybe it's in a</span> <span data-start="428.85" data-end="430.35">separate file maybe if you have some</span> <span data-start="430.35" data-end="433.17">test runner it's got some configuration</span> <span data-start="433.17" data-end="437.49">in there and the reason why that's</span> <span data-start="437.49" data-end="440.49">important is that basically we're going</span> <span data-start="440.49" data-end="443.61">to be when we build this any previous</span> <span data-start="443.61" data-end="445.67">layer that's unchanged will be cached so</span> <span data-start="445.67" data-end="449.46">if we for example managed to get down to</span> <span data-start="449.46" data-end="453.57">line 7 here which we should hopefully</span> <span data-start="453.57" data-end="456.54">always be able to do say ok say say that</span> <span data-start="456.54" data-end="459.41">our NPM shrink-wrap file hasn't changed</span> <span data-start="459.41" data-end="461.76">from the last time that we did a build</span> <span data-start="461.76" data-end="463.41">and that means it can just skip this</span> <span data-start="463.41" data-end="465.45">step it will reuse the cash from that</span> <span data-start="465.45" data-end="467.16">version and when it comes to something</span> <span data-start="467.16" data-end="469.41">like NPM install that saves a lot of</span> <span data-start="469.41" data-end="471.21">time we don't have to npm install again</span> <span data-start="471.21" data-end="473.07">even though we're creating container</span> <span data-start="473.07" data-end="474.9">from scratch so the containers are</span> <span data-start="474.9" data-end="476.94">mutable but we can use cache versions of</span> <span data-start="476.94" data-end="479.22">old containers providing that we're</span> <span data-start="479.22" data-end="482.36">convinced that they should be the same</span> <span data-start="482.36" data-end="484.32">so basically I was having problems with</span> <span data-start="484.32" data-end="485.58">like with a package to Jason you would</span> <span data-start="485.58" data-end="487.35">go to change a script and then that</span> <span data-start="487.35" data-end="488.58">would mean that you had to run npm</span> <span data-start="488.58" data-end="490.89">install again which seems like obviously</span> <span data-start="490.89" data-end="492.6">you know that you don't have to chain</span> <span data-start="492.6" data-end="494.73">run in p.m. install when you change the</span> <span data-start="494.73" data-end="496.8">script like that doesn't make sense but</span> <span data-start="496.8" data-end="498.48">because this is just looking at has the</span> <span data-start="498.48" data-end="500.43">file changed like if i copy a file into</span> <span data-start="500.43" data-end="504.45">the into the container and that files</span> <span data-start="504.45" data-end="506.7">changed and that invalidates the cache</span> <span data-start="506.7" data-end="509.52">for that level so this is why you'll see</span> <span data-start="509.52" data-end="510.87">this is a common pattern and people will</span> <span data-start="510.87" data-end="512.79">always copy in their package jason</span> <span data-start="512.79" data-end="514.56">higher up in the file before they</span> <span data-start="514.56" data-end="516.78">copying the rest of the files so we run</span> <span data-start="516.78" data-end="519.36">npm install and then we copy in the rest</span> <span data-start="519.36" data-end="522.84">of the application we're going to expose</span> <span data-start="522.84" data-end="525.78">a port that application runs on port</span> <span data-start="525.78" data-end="529.2">8000 and then we define a command how to</span> <span data-start="529.2" data-end="533.87">start up the application so this is a</span> <span data-start="533.87" data-end="536.43">complete docker file and this is a</span> <span data-start="536.43" data-end="538.53">docker file which would be able to run</span> <span data-start="538.53" data-end="540.66">our application here on this machine and</span> <span data-start="540.66" data-end="542.07">we could also use it to run in</span> <span data-start="542.07" data-end="543.21">production</span> <span data-start="543.21" data-end="546.27">so let's go ahead and let's go ahead and</span> <span data-start="546.27" data-end="549.71">build it at great personal risk okay</span> <span data-start="549.71" data-end="553.83">super simple to build a a docker file</span> <span data-start="553.83" data-end="556.95">gonna just run docker build this — T is</span> <span data-start="556.95" data-end="558.57">a tag I'm gonna tag this image so I can</span> <span data-start="558.57" data-end="560.82">find it again you don't have to tag them</span> <span data-start="560.82" data-end="563.13">but then you just get like a hash that</span> <span data-start="563.13" data-end="565.5">refers to this build so it's difficult</span> <span data-start="565.5" data-end="567.93">to find it again and then thought just</span> <span data-start="567.93" data-end="569.82">means where should I build from what's</span> <span data-start="569.82" data-end="571.2">the context of the build and that's just</span> <span data-start="571.2" data-end="575.37">the current directory so first thing it</span> <span data-start="575.37" data-end="578.01">does is like figures out what files do I</span> <span data-start="578.01" data-end="580.43">need to send to the to the build and</span> <span data-start="580.43" data-end="582.42">you'll see that it skipped all the way</span> <span data-start="582.42" data-end="585.33">to step 6 straightaway and that's</span> <span data-start="585.33" data-end="589.17">because I've ran this before and the NPM</span> <span data-start="589.17" data-end="590.76">shrink-wrap dot jason hasn't changed</span> <span data-start="590.76" data-end="592.47">there aren't any new dependencies so we</span> <span data-start="592.47" data-end="594.09">can just reuse the last dependencies so</span> <span data-start="594.09" data-end="597.27">this is really nice like we can build we</span> <span data-start="597.27" data-end="599.28">can build this image and even if they've</span> <span data-start="599.28" data-end="603">been changes to our application code we</span> <span data-start="603" data-end="604.86">don't need to reinstall anything we</span> <span data-start="604.86" data-end="606.21">don't need to download node again none</span> <span data-start="606.21" data-end="615.24">of these things have changed okay so</span> <span data-start="615.24" data-end="617.55">let's let's run the image let's try</span> <span data-start="617.55" data-end="619.02">let's try out our application that we've</span> <span data-start="619.02" data-end="620.85">made so how do we do that</span> <span data-start="620.85" data-end="624.81">docker run this — IT means that we're</span> <span data-start="624.81" data-end="627">going to basically attach this terminal</span> <span data-start="627" data-end="630.27">sessions here into the terminal session</span> <span data-start="630.27" data-end="632.19">that's inside the container and reason</span> <span data-start="632.19" data-end="633.48">you have to do that is otherwise you</span> <span data-start="633.48" data-end="635.46">can't kill it which is frustrating for</span> <span data-start="635.46" data-end="639.63">demos then this next document — piece is</span> <span data-start="639.63" data-end="642">we're going to take the port 8000 that's</span> <span data-start="642" data-end="643.98">inside the container and map it to port</span> <span data-start="643.98" data-end="647.37">8000 outside the container next document</span> <span data-start="647.37" data-end="649.77">is the tag that's the image that we just</span> <span data-start="649.77" data-end="655.05">built and then I'm going to override the</span> <span data-start="655.05" data-end="658.56">command so I have basically this last</span> <span data-start="658.56" data-end="660.39">argument I'm going to run my dev command</span> <span data-start="660.39" data-end="662.91">and that's going to run instead of</span> <span data-start="662.91" data-end="665.61">running it with NPM start that's just</span> <span data-start="665.61" data-end="667.68">going to run load one so that we can</span> <span data-start="667.68" data-end="671.03">watch for changes</span> <span data-start="671.04" data-end="673.26">so application starts up watching for</span> <span data-start="673.26" data-end="682.95">changes great the problem is when I save</span> <span data-start="682.95" data-end="685.56">the file you know the application isn't</span> <span data-start="685.56" data-end="688.86">reloaded and the reason for that is</span> <span data-start="688.86" data-end="690.54">because this copy operation is a</span> <span data-start="690.54" data-end="692.34">one-time thing we copied the files into</span> <span data-start="692.34" data-end="694.17">the container but now the container is</span> <span data-start="694.17" data-end="696.48">done it's immutable it's not going to</span> <span data-start="696.48" data-end="698.94">pick up the changes from outside so this</span> <span data-start="698.94" data-end="700.56">is no good for development I mean we</span> <span data-start="700.56" data-end="703.35">could just stop it rebuild the image but</span> <span data-start="703.35" data-end="706.23">this is a really rubbish experience for</span> <span data-start="706.23" data-end="715.66">development so how can we fix that</span> <span data-start="715.67" data-end="717.779">so try doing it slightly different way</span> <span data-start="717.779" data-end="719.249">so exactly the same commanders before</span> <span data-start="719.249" data-end="722.189">but now we have this — V flag and what</span> <span data-start="722.189" data-end="723.269">that's going to do is create a volume</span> <span data-start="723.269" data-end="725.43">we're going to take the current working</span> <span data-start="725.43" data-end="727.98">directory and we're going to map that as</span> <span data-start="727.98" data-end="730.319">a file mount onto this code directory</span> <span data-start="730.319" data-end="731.519">which is where we're storing our code</span> <span data-start="731.519" data-end="735.93">that was the the working directory here</span> <span data-start="735.93" data-end="739.589">from before and so this is just like</span> <span data-start="739.589" data-end="744.12">taking the files the outside just like</span> <span data-start="744.12" data-end="746.43">in your in your on your regular file</span> <span data-start="746.43" data-end="748.86">system and they're going to act as like</span> <span data-start="748.86" data-end="751.139">a network drive or a file file share if</span> <span data-start="751.139" data-end="753.36">you like inside the container so that</span> <span data-start="753.36" data-end="756.42">now it has the real files and again</span> <span data-start="756.42" data-end="758.009">we're going to run node one so it can</span> <span data-start="758.009" data-end="768.059">pick up file changes and now when I hit</span> <span data-start="768.059" data-end="776.129">save node one rebuilds the files and if</span> <span data-start="776.129" data-end="784.639">we you can see if we have the new</span> <span data-start="784.639" data-end="786.99">message that I just typed in there so</span> <span data-start="786.99" data-end="789.6">we've got live reload working so this is</span> <span data-start="789.6" data-end="790.92">kind of the steps that we want so we</span> <span data-start="790.92" data-end="792.959">have our application running inside node</span> <span data-start="792.959" data-end="794.819">inside the docker container sorry</span> <span data-start="794.819" data-end="797">running node inside the docker container</span> <span data-start="797" data-end="799.92">and the live reload is working we can</span> <span data-start="799.92" data-end="802.439">just continue our development as we</span> <span data-start="802.439" data-end="808.829">always happen however it's going to be a</span> <span data-start="808.829" data-end="811.319">bit of a pain to just always be typing</span> <span data-start="811.319" data-end="813.089">these extra commands like the past in</span> <span data-start="813.089" data-end="815.069">these flags how can we how can we do</span> <span data-start="815.069" data-end="820.29">this nicer so the next step is to write</span> <span data-start="820.29" data-end="823.139">a compose file this is a file that's</span> <span data-start="823.139" data-end="825.179">interpreted by docker compose which is a</span> <span data-start="825.179" data-end="828.029">a tool that docker provides to run</span> <span data-start="828.029" data-end="830.67">multiple containers and what does that</span> <span data-start="830.67" data-end="835.35">look like</span> <span data-start="835.36" data-end="838.869">so dr. Campos file again is quite simple</span> <span data-start="838.869" data-end="840.579">it starts with version 2 because they</span> <span data-start="840.579" data-end="841.929">added some extra features which weren't</span> <span data-start="841.929" data-end="844.029">back backwards compatible so you can opt</span> <span data-start="844.029" data-end="847.989">into the new version of the file we're</span> <span data-start="847.989" data-end="849.73">going to define some services and the</span> <span data-start="849.73" data-end="851.619">service is just anything that you want</span> <span data-start="851.619" data-end="853.929">docker to start a container for so in</span> <span data-start="853.929" data-end="854.949">this case we're going to define a</span> <span data-start="854.949" data-end="858.1">service called API and then basically</span> <span data-start="858.1" data-end="860.049">each of these commands reflects the</span> <span data-start="860.049" data-end="861.519">parameters that we had to pass the</span> <span data-start="861.519" data-end="863.799">docker to configure it correctly to run</span> <span data-start="863.799" data-end="866.199">for development so we're going to build</span> <span data-start="866.199" data-end="868.54">from the current working directory dot</span> <span data-start="868.54" data-end="870.67">we're going to override the start</span> <span data-start="870.67" data-end="874.149">command this just runs node 1 we're</span> <span data-start="874.149" data-end="876.009">going to map the ports so that it's</span> <span data-start="876.009" data-end="879.399">visible outside outside of the container</span> <span data-start="879.399" data-end="882.189">and then we're going to do the same</span> <span data-start="882.189" data-end="885.699">trick with the volumes now there's one</span> <span data-start="885.699" data-end="887.379">problem with what the volume that I did</span> <span data-start="887.379" data-end="893.679">before and the reason the reason for</span> <span data-start="893.679" data-end="897.489">that is that the node modules which you</span> <span data-start="897.489" data-end="899.829">might have installed on your Mac for</span> <span data-start="899.829" data-end="902.769">example or on Windows they may have</span> <span data-start="902.769" data-end="904.299">binary dependencies which are built for</span> <span data-start="904.299" data-end="906.279">that platform and if you just copy your</span> <span data-start="906.279" data-end="908.86">node modules into this Linux environment</span> <span data-start="908.86" data-end="910.239">they're not going to work they're not</span> <span data-start="910.239" data-end="913.36">compiled for the right architecture so</span> <span data-start="913.36" data-end="916.119">what we do here and this is the biggest</span> <span data-start="916.119" data-end="917.439">leap of faith that you'll have to take</span> <span data-start="917.439" data-end="920.949">for this talk is we're going to we have</span> <span data-start="920.949" data-end="925.449">two volumes and we have the one that we</span> <span data-start="925.449" data-end="926.679">just used so that's the current</span> <span data-start="926.679" data-end="929.319">directory outside on the host that's</span> <span data-start="929.319" data-end="930.279">going to get mapped to this code</span> <span data-start="930.279" data-end="932.649">directory but then we're going to create</span> <span data-start="932.649" data-end="934.749">another volume this is a named volume</span> <span data-start="934.749" data-end="938.049">this is like a quite a new feature in in</span> <span data-start="938.049" data-end="940.569">docker which I'm defined down here and</span> <span data-start="940.569" data-end="942.579">there's no extra configuration for that</span> <span data-start="942.579" data-end="943.899">which just means it's going to create a</span> <span data-start="943.899" data-end="946.48">regular file volume using the default</span> <span data-start="946.48" data-end="948.669">driver and then we're going to map that</span> <span data-start="948.669" data-end="954.16">to a directory inside our other mount so</span> <span data-start="954.16" data-end="956.41">you have the docker container which has</span> <span data-start="956.41" data-end="957.61">its own file system that's isolated</span> <span data-start="957.61" data-end="960.309">we're going to mount inside of that our</span> <span data-start="960.309" data-end="963.339">files from our host and then inside of</span> <span data-start="963.339" data-end="966.22">that we're going to stub out like a safe</span> <span data-start="966.22" data-end="968.529">space for it to install the node modules</span> <span data-start="968.529" data-end="969.48">for its own</span> <span data-start="969.48" data-end="973.51">platform and that means that when we run</span> <span data-start="973.51" data-end="975.25">npm install inside the container</span> <span data-start="975.25" data-end="977.29">these node what these node modules will</span> <span data-start="977.29" data-end="979.6">end up inside this volume and they won't</span> <span data-start="979.6" data-end="984.7">get leaked outside back to your host and</span> <span data-start="984.7" data-end="987.37">so that allows us to if you want you can</span> <span data-start="987.37" data-end="991.12">even install run npm install on the host</span> <span data-start="991.12" data-end="993.28">have the node modules for mac there</span> <span data-start="993.28" data-end="995.26">which is sometimes useful for running</span> <span data-start="995.26" data-end="997.69">things like es lint or like your dev</span> <span data-start="997.69" data-end="999.88">dependencies and then inside the</span> <span data-start="999.88" data-end="1002.16">container all have the same dependencies</span> <span data-start="1002.16" data-end="1004.65">but compiled for the linux environment</span> <span data-start="1004.65" data-end="1007.74">that it runs in so that's how you can</span> <span data-start="1007.74" data-end="1009.18">get that to work and that allows you to</span> <span data-start="1009.18" data-end="1013.14">kind of not be locked in to developer</span> <span data-start="1013.14" data-end="1014.94">sort of developing in docker sometimes</span> <span data-start="1014.94" data-end="1017.04">it's easier to have those actual node</span> <span data-start="1017.04" data-end="1018.27">modules if you need to debug something</span> <span data-start="1018.27" data-end="1021.21">or whatever it works equally well if</span> <span data-start="1021.21" data-end="1023.07">you're going to be kind of careful and</span> <span data-start="1023.07" data-end="1025.05">commit to this run err always running</span> <span data-start="1025.05" data-end="1027.42">inside docker you can there's no problem</span> <span data-start="1027.42" data-end="1028.8">with just having these files being on</span> <span data-start="1028.8" data-end="1030.84">your hard drive the problem is if you</span> <span data-start="1030.84" data-end="1033.45">then try and run npm that's not going to</span> <span data-start="1033.45" data-end="1034.35">work because there for the wrong</span> <span data-start="1034.35" data-end="1036.45">architecture you have the Linux files</span> <span data-start="1036.45" data-end="1038.28">which have kind of come back onto your</span> </p>
<p><span data-start="1038.28" data-end="1041.31">Mac as part of the file share so this is</span> <span data-start="1041.31" data-end="1042.69">the reason that I would recommend this</span> <span data-start="1042.69" data-end="1045.54">approach because you the errors that you</span> <span data-start="1045.54" data-end="1047.97">get a very strange when you have files</span> <span data-start="1047.97" data-end="1049.26">compiled the wrong architecture they're</span> <span data-start="1049.26" data-end="1051.93">not always obvious so this kind of gives</span> <span data-start="1051.93" data-end="1054.84">you the safety and allows you to switch</span> <span data-start="1054.84" data-end="1056.43">back and forth more easily if if you</span> <span data-start="1056.43" data-end="1062.31">want to do that so the only thing left</span> <span data-start="1062.31" data-end="1065.61">to do is to run an app and the way to do</span> <span data-start="1065.61" data-end="1069.39">that is using docker compose and we'll</span> <span data-start="1069.39" data-end="1071.73">just use the up command which says take</span> <span data-start="1071.73" data-end="1074.28">my docker compose file and start all the</span> <span data-start="1074.28" data-end="1078.27">services in it and of course it didn't</span> <span data-start="1078.27" data-end="1082.68">work because it's still running okay no</span> <span data-start="1082.68" data-end="1088.27">problem</span> <span data-start="1088.28" data-end="1094.13">all right so you see we have this</span> <span data-start="1094.13" data-end="1096.18">slightly different logging output and</span> <span data-start="1096.18" data-end="1098.01">it's just basically a pen it's just</span> <span data-start="1098.01" data-end="1099.99">prepending the name of the service and</span> <span data-start="1099.99" data-end="1102.48">then it has API one because there could</span> <span data-start="1102.48" data-end="1104.07">be multiple instance of instances of</span> <span data-start="1104.07" data-end="1106.52">this it's not so applicable for</span> <span data-start="1106.52" data-end="1108.51">development but obviously in production</span> <span data-start="1108.51" data-end="1109.86">you might want to run multiple copies of</span> <span data-start="1109.86" data-end="1111.78">a container and then low bounce across</span> <span data-start="1111.78" data-end="1126.34">them so now we have this working and</span> <span data-start="1126.35" data-end="1128.31">again we can connect to the container</span> <span data-start="1128.31" data-end="1129.54">from the outside and it gives us the</span> <span data-start="1129.54" data-end="1133.62">message from before so this is great you</span> <span data-start="1133.62" data-end="1135.24">can see there we had the lock output</span> <span data-start="1135.24" data-end="1140.25">from the HTTP request there as well this</span> <span data-start="1140.25" data-end="1140.58">is great</span> <span data-start="1140.58" data-end="1145.89">and night-light neatly wraps up all</span> <span data-start="1145.89" data-end="1147.33">those all those parameters that we had</span> <span data-start="1147.33" data-end="1149.01">to pass in there are other other options</span> <span data-start="1149.01" data-end="1150.48">as well obviously but I think these are</span> <span data-start="1150.48" data-end="1154.22">the most important ones for development</span> <span data-start="1154.22" data-end="1157.56">so how do you run a command that you</span> <span data-start="1157.56" data-end="1159.03">would typically have to run outside the</span> <span data-start="1159.03" data-end="1160.41">container like you want to install a new</span> <span data-start="1160.41" data-end="1164.46">dependency super easy dr. Campos comes</span> <span data-start="1164.46" data-end="1166.77">with the run command so if we were doing</span> </p>
<p><span data-start="1166.77" data-end="1169.8">NPM install cause before now we do</span> <span data-start="1169.8" data-end="1171.87">docker compose run the name of the</span> <span data-start="1171.87" data-end="1173.37">service that we want to run the command</span> <span data-start="1173.37" data-end="1176.04">in and then the command so what this</span> <span data-start="1176.04" data-end="1178.92">would do is it would fire up the</span> <span data-start="1178.92" data-end="1181.08">container it would run this command npm</span> <span data-start="1181.08" data-end="1183.15">install cause inside so this dependency</span> <span data-start="1183.15" data-end="1184.59">is going to end up inside that volume</span> <span data-start="1184.59" data-end="1186.99">that we defined this respects all the</span> <span data-start="1186.99" data-end="1188.1">settings you have in your docker compose</span> <span data-start="1188.1" data-end="1192.24">file and basically this is just a</span> <span data-start="1192.24" data-end="1193.65">straight-up replacement where you ran</span> <span data-start="1193.65" data-end="1196.14">npm install cause before now just do da</span> <span data-start="1196.14" data-end="1199.44">compose run api npm install' course and</span> <span data-start="1199.44" data-end="1201.39">if it's too much typing then you can</span> <span data-start="1201.39" data-end="1203.31">just make some aliases to make that a</span> <span data-start="1203.31" data-end="1205.68">bit shorter it's quite quite easy to get</span> <span data-start="1205.68" data-end="1209.68">used to</span> <span data-start="1209.69" data-end="1212.15">so the dr. Campos file is really nice</span> <span data-start="1212.15" data-end="1213.77">because there's not really any overhead</span> <span data-start="1213.77" data-end="1215.87">to creating extra services so one thing</span> </p>
<p><span data-start="1215.87" data-end="1218.09">I like to do is just define another</span> <span data-start="1218.09" data-end="1220.1">service that runs my tests so this just</span> <span data-start="1220.1" data-end="1221.54">creates another instance of the same</span> <span data-start="1221.54" data-end="1224.48">container here I'm just changing the</span> <span data-start="1224.48" data-end="1226.31">command so now I'm running my tests with</span> <span data-start="1226.31" data-end="1229.13">the watch flag the watch flag works it</span> <span data-start="1229.13" data-end="1230.6">will rerun my test because we're doing</span> <span data-start="1230.6" data-end="1232.28">the same trick with the volumes to just</span> <span data-start="1232.28" data-end="1234.92">mount the files inside and we don't even</span> <span data-start="1234.92" data-end="1236.18">have to install the dependencies twice</span> <span data-start="1236.18" data-end="1238.07">it's reusing the volume that has all the</span> <span data-start="1238.07" data-end="1240.86">node modules in and you can imagine</span> <span data-start="1240.86" data-end="1242.72">defining more services maybe you could</span> <span data-start="1242.72" data-end="1244.94">run your linter and all of these will</span> <span data-start="1244.94" data-end="1246.38">just show up in like a nice interleaved</span> <span data-start="1246.38" data-end="1249.56">output so you only have one command I</span> <span data-start="1249.56" data-end="1251.57">don't about you but before I did this I</span> <span data-start="1251.57" data-end="1252.83">used to have to open multiple terminals</span> <span data-start="1252.83" data-end="1254.69">like start up various things they had</span> <span data-start="1254.69" data-end="1255.92">watches because they're long-running</span> <span data-start="1255.92" data-end="1258.08">process is so now this allows you to</span> <span data-start="1258.08" data-end="1260.21">have them kind of all together and to</span> <span data-start="1260.21" data-end="1263.66">start them all up with just one one</span> <span data-start="1263.66" data-end="1269.03">script or composer there's one other</span> <span data-start="1269.03" data-end="1270.85">really nice feature worth mentioning for</span> <span data-start="1270.85" data-end="1276.47">the services and I don't use this on my</span> <span data-start="1276.47" data-end="1279.29">project but obviously lots of people do</span> <span data-start="1279.29" data-end="1281.56">use databases so it's worth mentioning</span> <span data-start="1281.56" data-end="1284.27">so here's an example of how how do we</span> <span data-start="1284.27" data-end="1287.54">connect to a Postgres database in</span> <span data-start="1287.54" data-end="1290.42">development so normally most people will</span> <span data-start="1290.42" data-end="1292.4">just install Postgres on the machine and</span> <span data-start="1292.4" data-end="1294.02">then get it configured correctly and</span> <span data-start="1294.02" data-end="1295.13">then maybe if you want to use it with</span> <span data-start="1295.13" data-end="1297.05">another another project you have to</span> <span data-start="1297.05" data-end="1299.57">reconfigure it and what this allows us</span> <span data-start="1299.57" data-end="1301.01">to do is we can run Postgres inside a</span> <span data-start="1301.01" data-end="1304.34">container which gives us an isolated</span> <span data-start="1304.34" data-end="1309.77">version of this database it's super easy</span> <span data-start="1309.77" data-end="1311.21">like it's way easier than installing</span> <span data-start="1311.21" data-end="1312.68">postcards we just put the name of it</span> <span data-start="1312.68" data-end="1314.96">here if I wanted to install my sequel I</span> <span data-start="1314.96" data-end="1317.21">just put my sequel Redis all of these</span> <span data-start="1317.21" data-end="1319.07">have official builds and they're all</span> <span data-start="1319.07" data-end="1321.41">configured out at the box so that's</span> <span data-start="1321.41" data-end="1324.98">super nice we can interact with this we</span> <span data-start="1324.98" data-end="1326.84">can configure this image or like any</span> <span data-start="1326.84" data-end="1328.28">additional configuration that we need</span> <span data-start="1328.28" data-end="1330.86">using environment variables and all of</span> <span data-start="1330.86" data-end="1332.27">them just list the kind of configuration</span> <span data-start="1332.27" data-end="1334.52">parameters gives you like a nice API</span> <span data-start="1334.52" data-end="1337.58">onto this image so here we're going to</span> <span data-start="1337.58" data-end="1341.36">define some username password and then</span> <span data-start="1341.36" data-end="1343.05">in order to persist</span> <span data-start="1343.05" data-end="1344.88">the data that's in the database we just</span> <span data-start="1344.88" data-end="1347.97">give it a volume and then this exposes</span> <span data-start="1347.97" data-end="1350.55">the port here you'll notice that says</span> <span data-start="1350.55" data-end="1352.5">exposed before we had ports and that</span> <span data-start="1352.5" data-end="1354.63">defined a port mapping and this time</span> <span data-start="1354.63" data-end="1356.07">we're saying expose a port but there's</span> <span data-start="1356.07" data-end="1359.13">no what is the port that 5 4 3 2 is</span> <span data-start="1359.13" data-end="1363.39">mapped to so this is where we come to</span> <span data-start="1363.39" data-end="1365.37">links so you see that the API has a</span> <span data-start="1365.37" data-end="1368.63">definition here links to the links to DB</span> <span data-start="1368.63" data-end="1370.83">what this means is that docker is going</span> <span data-start="1370.83" data-end="1372.63">to set up an internal network route</span> <span data-start="1372.63" data-end="1374.64">between the API service and the database</span> <span data-start="1374.64" data-end="1377.19">and the database is not publicly</span> <span data-start="1377.19" data-end="1379.14">accessible this doesn't have a port you</span> <span data-start="1379.14" data-end="1382.92">can connect to it from and that's why it</span> <span data-start="1382.92" data-end="1384.6">would be perfectly fine to have your</span> <span data-start="1384.6" data-end="1386.52">username password like this this is this</span> <span data-start="1386.52" data-end="1389.28">database is not accessible from anywhere</span> <span data-start="1389.28" data-end="1393.24">else on the host or beyond on the public</span> </p>
<p><span data-start="1393.24" data-end="1397.53">Internet how do you connect to it from</span> <span data-start="1397.53" data-end="1399.66">the API what it's going to do is it's</span> <span data-start="1399.66" data-end="1401.19">going to create an entry in the hosts</span> <span data-start="1401.19" data-end="1404.85">file of this container for DB and then</span> <span data-start="1404.85" data-end="1406.47">that's going to resolve to the database</span> <span data-start="1406.47" data-end="1409.53">so you can just do connect to server DB</span> <span data-start="1409.53" data-end="1412.02">and that will be filled in in the host</span> <span data-start="1412.02" data-end="1414.84">file with the link to wherever it's</span> <span data-start="1414.84" data-end="1417.11">decided to run this and on whatever port</span> <span data-start="1417.11" data-end="1419.73">I really like this and like if you're</span> <span data-start="1419.73" data-end="1423.54">using some abstraction over your say</span> <span data-start="1423.54" data-end="1424.98">your sequel IV fusions on like sequel</span> <span data-start="1424.98" data-end="1427.08">eyes or whatever and you want to try</span> <span data-start="1427.08" data-end="1428.88">swapping out your database for something</span> <span data-start="1428.88" data-end="1431.16">else or you want to just say like I what</span> <span data-start="1431.16" data-end="1433.17">would you be like if we ended memcache</span> <span data-start="1433.17" data-end="1435.42">or Redis or some other service like this</span> <span data-start="1435.42" data-end="1437.52">super easy to just create a new entry in</span> <span data-start="1437.52" data-end="1439.08">your services you can connect to it</span> <span data-start="1439.08" data-end="1441.57">really easily using the links and if you</span> <span data-start="1441.57" data-end="1443.31">don't like it just throw it away delete</span> <span data-start="1443.31" data-end="1445.2">it from your config and there's no no</span> <span data-start="1445.2" data-end="1450.12">damage done so this is really nice</span> <span data-start="1450.12" data-end="1454.58">but when we when we're running in</span> <span data-start="1454.58" data-end="1457.47">production we're not having to worry</span> <span data-start="1457.47" data-end="1458.88">about what ports things are running on</span> <span data-start="1458.88" data-end="1460.8">everything has a name and I really</span> <span data-start="1460.8" data-end="1462.45">wanted to find a way to solve this</span> <span data-start="1462.45" data-end="1464.49">problem of like I want to have all my</span> <span data-start="1464.49" data-end="1468.87">projects running on a local domain and</span> <span data-start="1468.87" data-end="1470.43">turn out to be real easy this is</span> <span data-start="1470.43" data-end="1471.87">actually like way easier than anything</span> <span data-start="1471.87" data-end="1473.94">else to do a docker this isn't to do a</span> <span data-start="1473.94" data-end="1475.89">docker but I just wanted to go through</span> <span data-start="1475.89" data-end="1476.97">this just then</span> <span data-start="1476.97" data-end="1478.44">straight how easy it is and I was really</span> <span data-start="1478.44" data-end="1481.38">surprised these instructions are for Mac</span> <span data-start="1481.38" data-end="1485.25">but I assume it's easy on Windows we're</span> <span data-start="1485.25" data-end="1486.87">going to use DNS mask so just brew</span> <span data-start="1486.87" data-end="1487.919">install DNS mask</span> <span data-start="1487.919" data-end="1490.95">we just need to config files the first</span> <span data-start="1490.95" data-end="1494.22">one is the DNS mask config file and that</span> <span data-start="1494.22" data-end="1498.299">says that we're going to resolve the</span> <span data-start="1498.299" data-end="1500.309">address anything that ends in the</span> <span data-start="1500.309" data-end="1503.22">top-level domain dev to one two seven</span> <span data-start="1503.22" data-end="1505.409">zero zero one to localhost that's where</span> <span data-start="1505.409" data-end="1507.75">our containers are bound to so this is</span> <span data-start="1507.75" data-end="1509.909">actually enough but at the moment that</span> <span data-start="1509.909" data-end="1511.71">means that DNS mask is intercepting</span> <span data-start="1511.71" data-end="1514.53">every DNS request so what we're going to</span> <span data-start="1514.53" data-end="1516.24">do is create another file that tells the</span> <span data-start="1516.24" data-end="1519.72">operating system only use this to</span> <span data-start="1519.72" data-end="1522.809">resolve requests that end in dev so this</span> <span data-start="1522.809" data-end="1526.14">is this bit here is OSX specific I</span> <span data-start="1526.14" data-end="1527.46">assume you can do this on Windows as</span> <span data-start="1527.46" data-end="1530.85">well we're basically just saying here if</span> <span data-start="1530.85" data-end="1535.02">the domain ends in dev then use the name</span> <span data-start="1535.02" data-end="1537.809">server one two seven zero zero one so</span> <span data-start="1537.809" data-end="1540.39">now when you use any other site when you</span> <span data-start="1540.39" data-end="1541.77">go on Facebook comm it's going to be</span> <span data-start="1541.77" data-end="1544.74">resolved using whatever DNS you had</span> <span data-start="1544.74" data-end="1547.44">before but if we go to a dev domain it's</span> <span data-start="1547.44" data-end="1552.45">going to be resolved to localhost so how</span> <span data-start="1552.45" data-end="1555.929">do we actually get those requests that</span> <span data-start="1555.929" data-end="1558.059">are coming with these names and get them</span> <span data-start="1558.059" data-end="1561.65">to the right containers so this again is</span> <span data-start="1561.65" data-end="1565.62">actually really not really easy there</span> <span data-start="1565.62" data-end="1567.78">are two images that I know that solve</span> <span data-start="1567.78" data-end="1569.039">this problem and they solve it in the</span> <span data-start="1569.039" data-end="1570.12">exact same way they're completely</span> <span data-start="1570.12" data-end="1573.36">interchangeable I used this one which is</span> <span data-start="1573.36" data-end="1575.159">based on high availability proxy because</span> </p>
<p><span data-start="1575.159" data-end="1577.02">I was already running it in development</span> <span data-start="1577.02" data-end="1578.76">and it was easy I just copied the</span> <span data-start="1578.76" data-end="1580.23">configure hand development works in</span> <span data-start="1580.23" data-end="1582.179">sorry in production works in development</span> <span data-start="1582.179" data-end="1584.549">as well but there's another one that's</span> <span data-start="1584.549" data-end="1586.98">based on nginx so if you're more</span> <span data-start="1586.98" data-end="1588.57">familiar with nginx then that might be</span> <span data-start="1588.57" data-end="1589.799">better you can just read the config</span> <span data-start="1589.799" data-end="1592.86">files understand what it does but we</span> <span data-start="1592.86" data-end="1594.15">basically just add another entry to our</span> <span data-start="1594.15" data-end="1597.84">services for the proxy we're going to</span> <span data-start="1597.84" data-end="1600.03">link it to all the services that we want</span> <span data-start="1600.03" data-end="1602.61">and then in each service we're going to</span> <span data-start="1602.61" data-end="1604.32">define just this virtual host</span> <span data-start="1604.32" data-end="1607.559">environment variable that says what what</span> <span data-start="1607.559" data-end="1608.909">request should I forward to this</span> <span data-start="1608.909" data-end="1611.84">container so basically if the</span> <span data-start="1611.84" data-end="1616.76">if the request looks like API teller dev</span> <span data-start="1616.76" data-end="1620.61">then this guy will forward it to it we</span> <span data-start="1620.61" data-end="1622.559">have some port mappings here</span> <span data-start="1622.559" data-end="1627.12">82 84 43 we can do use this to do a self</span> <span data-start="1627.12" data-end="1629.309">emanation if you want to test out that</span> <span data-start="1629.309" data-end="1631.74">your or your HTTP to set up correctly in</span> <span data-start="1631.74" data-end="1633.87">development very easy to just generate</span> <span data-start="1633.87" data-end="1636.72">some deficit if Achatz give it to this</span> <span data-start="1636.72" data-end="1638.7">proxy here and he'll do the SSL</span> <span data-start="1638.7" data-end="1641.49">termination for you fold it on to the</span> <span data-start="1641.49" data-end="1642.809">containers exactly like you probably</span> <span data-start="1642.809" data-end="1645.6">would do in production the only mystery</span> <span data-start="1645.6" data-end="1647.16">line here is maybe this bottom line</span> <span data-start="1647.16" data-end="1649.53">which you have a volume which is the</span> <span data-start="1649.53" data-end="1652.62">socket what's going on here and also</span> <span data-start="1652.62" data-end="1655.71">somehow the it's like from itself to</span> <span data-start="1655.71" data-end="1659.82">itself like what is happening here this</span> <span data-start="1659.82" data-end="1660.87">basically says that we're going to</span> <span data-start="1660.87" data-end="1663.87">connect the docker engine outside the</span> <span data-start="1663.87" data-end="1665.669">container to the doctor socket inside</span> <span data-start="1665.669" data-end="1667.5">the container and that's so that it can</span> <span data-start="1667.5" data-end="1670.2">watch for any changes in in the docker</span> <span data-start="1670.2" data-end="1672.21">containers containers been started and</span> <span data-start="1672.21" data-end="1675.36">stopped and that means that the these</span> <span data-start="1675.36" data-end="1677.61">both these images the high availability</span> <span data-start="1677.61" data-end="1680.22">one and the nginx one we reconfigure</span> <span data-start="1680.22" data-end="1682.11">themselves automatically when services</span> <span data-start="1682.11" data-end="1685.169">start and stop so that's really nice and</span> <span data-start="1685.169" data-end="1686.82">that's works exactly the same in</span> <span data-start="1686.82" data-end="1693.21">production like that as well there were</span> <span data-start="1693.21" data-end="1695.25">two changes that I had to make to my web</span> <span data-start="1695.25" data-end="1697.11">pack config to get this working with</span> <span data-start="1697.11" data-end="1700.11">this which is just worth pointing out so</span> <span data-start="1700.11" data-end="1701.28">that you don't get stuck on the same</span> <span data-start="1701.28" data-end="1705.15">thing the web pack dev server has like</span> <span data-start="1705.15" data-end="1706.74">this leaky like before it would have</span> <span data-start="1706.74" data-end="1709.02">said question mark localhost and then</span> <span data-start="1709.02" data-end="1711.45">the port that you're running on but now</span> <span data-start="1711.45" data-end="1712.559">we can just change that to our</span> <span data-start="1712.559" data-end="1714.54">development domain which for this image</span> <span data-start="1714.54" data-end="1718.049">is going to be Tala dev and the</span> <span data-start="1718.049" data-end="1719.73">development server doesn't bind to all</span> <span data-start="1719.73" data-end="1721.38">interfaces by default so we just need to</span> <span data-start="1721.38" data-end="1723.809">put host 0 0 0 0 so it's going to listen</span> <span data-start="1723.809" data-end="1728.22">on both our Wi-Fi and also the docker</span> </p>
<p><span data-start="1728.22" data-end="1737.39">Network so</span> <span data-start="1737.4" data-end="1740.41">here I have another another dr. Campos</span> <span data-start="1740.41" data-end="1742.99">file and I wanted to just point out a</span> <span data-start="1742.99" data-end="1744.61">couple more features which make it</span> <span data-start="1744.61" data-end="1749.52">really nice for development you can use</span> <span data-start="1749.52" data-end="1752.14">alternative dockerfile and development</span> <span data-start="1752.14" data-end="1754.299">why might you want to do that in the</span> <span data-start="1754.299" data-end="1756.82">case of a front-end app the situation</span> <span data-start="1756.82" data-end="1757.929">for running in development is normally</span> <span data-start="1757.929" data-end="1759.309">very different to running in production</span> <span data-start="1759.309" data-end="1761.41">so say you're running a typical web pack</span> <span data-start="1761.41" data-end="1762.49">build you're going to be running it one</span> <span data-start="1762.49" data-end="1763.299">live reloading</span> <span data-start="1763.299" data-end="1765.01">but in production you're going to</span> <span data-start="1765.01" data-end="1766.84">compile all the files down to static and</span> <span data-start="1766.84" data-end="1768.46">it's going to be served by something</span> <span data-start="1768.46" data-end="1770.74">completely different maybe just nginx or</span> <span data-start="1770.74" data-end="1771.88">you're going to put it on App Engine or</span> <span data-start="1771.88" data-end="1781.809">whatever I I've been thinking about this</span> <span data-start="1781.809" data-end="1783.52">like philosophically like a lot of the</span> <span data-start="1783.52" data-end="1785.5">ideas around docker is that it's the</span> <span data-start="1785.5" data-end="1787.36">same in development is in production</span> <span data-start="1787.36" data-end="1790.2">same all the way through your pipeline</span> <span data-start="1790.2" data-end="1792.429">but I don't think it makes any sense to</span> <span data-start="1792.429" data-end="1794.77">try and like force yourself to run the</span> <span data-start="1794.77" data-end="1796.48">same image I mean like you could do this</span> <span data-start="1796.48" data-end="1798.97">so you could create a node server that</span> <span data-start="1798.97" data-end="1800.35">serves your files statically in</span> <span data-start="1800.35" data-end="1802.21">production and then you have some if</span> <span data-start="1802.21" data-end="1803.74">development thing then run webpack</span> <span data-start="1803.74" data-end="1805.45">config but really you're just you're</span> <span data-start="1805.45" data-end="1806.5">just masking the problem you're not</span> <span data-start="1806.5" data-end="1807.91">really running the same code in</span> <span data-start="1807.91" data-end="1810.52">development in production so I prefer to</span> <span data-start="1810.52" data-end="1812.89">just have these separate configs and</span> <span data-start="1812.89" data-end="1816.9">then I have another entry down here</span> <span data-start="1816.9" data-end="1820.27">which takes my built files and copies</span> <span data-start="1820.27" data-end="1822.01">them into an image running nginx and</span> <span data-start="1822.01" data-end="1823">this is the same image that I'm running</span> <span data-start="1823" data-end="1824.98">in production this is just the built</span> </p>
<p><span data-start="1824.98" data-end="1826.63">JavaScript files with the hashes and</span> <span data-start="1826.63" data-end="1828.7">minification and everything just so I</span> <span data-start="1828.7" data-end="1833.08">can test out are there any problems if</span> <span data-start="1833.08" data-end="1835.03">you're developing as part of a team and</span> <span data-start="1835.03" data-end="1836.35">you're going to adopt this workflow one</span> <span data-start="1836.35" data-end="1838.66">super nice thing is that instead of</span> <span data-start="1838.66" data-end="1840.76">building the code locally you can just</span> <span data-start="1840.76" data-end="1842.98">pull down an image so how this normally</span> <span data-start="1842.98" data-end="1846.12">works is that you have a CI system</span> <span data-start="1846.12" data-end="1848.62">that's building your dot building images</span> <span data-start="1848.62" data-end="1850.51">and pushing them to a registry you can</span> <span data-start="1850.51" data-end="1852.48">tag these with maybe the branch name</span> <span data-start="1852.48" data-end="1854.86">latest maybe even the commit so that you</span> <span data-start="1854.86" data-end="1857.86">can find a specific one again and that</span> <span data-start="1857.86" data-end="1860.47">means so for example here I can just use</span> <span data-start="1860.47" data-end="1862.21">a pre-built image of the API I don't</span> <span data-start="1862.21" data-end="1863.32">have to have the code checked out for</span> <span data-start="1863.32" data-end="1865.87">the API it's really nice if you have</span> <span data-start="1865.87" data-end="1867.13">people working on different parts of the</span> <span data-start="1867.13" data-end="1867.82">stack</span> <span data-start="1867.82" data-end="1869.77">but then when I come to do a feature</span> <span data-start="1869.77" data-end="1871.39">which affects both the front end and the</span> <span data-start="1871.39" data-end="1873.94">back end I can just change this to point</span> <span data-start="1873.94" data-end="1877.15">to change this image to build maybe just</span> <span data-start="1877.15" data-end="1879.28">built pointer to build dot dot slash</span> <span data-start="1879.28" data-end="1881.05">wherever I've checked out my code and</span> <span data-start="1881.05" data-end="1883">then I can make my changes there so it's</span> <span data-start="1883" data-end="1884.52">really simple to switch between</span> <span data-start="1884.52" data-end="1887.56">pre-built images which means you don't</span> <span data-start="1887.56" data-end="1889.93">have to have anything installed to get</span> <span data-start="1889.93" data-end="1892.33">them running and then to switch back to</span> <span data-start="1892.33" data-end="1894.67">the regular development with the files</span> <span data-start="1894.67" data-end="1898.45">checked out and then the rest of this is</span> <span data-start="1898.45" data-end="1900.34">exactly the same just the proxy to</span> <span data-start="1900.34" data-end="1904.66">afford to these things so what's going</span> <span data-start="1904.66" data-end="1918.13">to happen I started up so you see we get</span> <span data-start="1918.13" data-end="1920.14">a whole load of output on the start</span> <span data-start="1920.14" data-end="1921.52">that's just all the containers starting</span> <span data-start="1921.52" data-end="1923.95">up together if you have some kind of</span> <span data-start="1923.95" data-end="1926.7">ordering thing you can define one</span> <span data-start="1926.7" data-end="1928.93">container depends on another so they</span> <span data-start="1928.93" data-end="1933.04">come up in the right order you see</span> <span data-start="1933.04" data-end="1936.1">everything has come up now we're Packers</span> <span data-start="1936.1" data-end="1944.05">said it's finished building its gonna</span> <span data-start="1944.05" data-end="1945.64">just try and save this because I left</span> <span data-start="1945.64" data-end="1947.29">the other one running so it's probably</span> <span data-start="1947.29" data-end="1954.94">not actually come up just to clarify</span> <span data-start="1954.94" data-end="1957.67">like the one I showed you first is like</span> <span data-start="1957.67" data-end="1959.83">if I'm working on API I'm normally like</span> <span data-start="1959.83" data-end="1961.66">developing using tests so I don't have</span> <span data-start="1961.66" data-end="1963.04">to run the front end but if you're</span> <span data-start="1963.04" data-end="1964.3">developing on the whole stack then I</span> <span data-start="1964.3" data-end="1965.95">have a different compose file which just</span> <span data-start="1965.95" data-end="1967.99">starts up the whole stack so depending</span> <span data-start="1967.99" data-end="1981.97">on how your workflow goes so</span> <span data-start="1981.98" data-end="1984.18">so it's not a local host anymore of</span> <span data-start="1984.18" data-end="1987.81">course should be able to connect to it</span> <span data-start="1987.81" data-end="1993.99">on API dr. dev which you can we should</span> <span data-start="1993.99" data-end="1996.69">have another service that's running web</span> <span data-start="1996.69" data-end="1999.12">pack dev server and that's service some</span> </p>
<p><span data-start="1999.12" data-end="2001.61">HTML and then if I show you that staging</span> <span data-start="2001.61" data-end="2006.62">one you can see that here this server</span> <span data-start="2006.62" data-end="2009.08">line says nginx so that's been served by</span> <span data-start="2009.08" data-end="2025.4">nginx and this is what this is what the</span> <span data-start="2025.4" data-end="2027.31">site looks like you can search for</span> <span data-start="2027.31" data-end="2029.66">Icelandic words it will show you how</span> <span data-start="2029.66" data-end="2031.19">these words change according to the</span> <span data-start="2031.19" data-end="2042.44">grammar you can can access the API not</span> <span data-start="2042.44" data-end="2046.37">with HTTPS that will return the JSON and</span> <span data-start="2046.37" data-end="2047.66">you see all of these have got nice names</span> <span data-start="2047.66" data-end="2050.84">oh sorry that's the real service let's</span> <span data-start="2050.84" data-end="2056.21">go to the development everything has a</span> <span data-start="2056.21" data-end="2056.96">nice name</span> <span data-start="2056.96" data-end="2058.36">everything is linked linked together</span> <span data-start="2058.36" data-end="2064.4">this guy's using an image to build and</span> <span data-start="2064.4" data-end="2066.32">histories Icelandic for horse so you</span> <span data-start="2066.32" data-end="2068.24">learned an Icelandic word as well there</span> <span data-start="2068.24" data-end="2076.13">we go if I could find my slides again I</span> <span data-start="2076.13" data-end="2078.79">would say that's the end of my talk the</span> <span data-start="2078.79" data-end="2081.05">slides are on slides comm slash david</span> <span data-start="2081.05" data-end="2082.61">glenn if you want to have a look at</span> <span data-start="2082.61" data-end="2084.08">those config files have a go at setting</span> <span data-start="2084.08" data-end="2086.45">up yourself the code for this project is</span> <span data-start="2086.45" data-end="2089.05">on github.com slash Taylor Eastern screw</span> <span data-start="2089.05" data-end="2091.61">maybe just goes to the slides first and</span> <span data-start="2091.61" data-end="2094.61">then you can find this link but if you</span> <span data-start="2094.61" data-end="2096.32">if you're using docker in development</span> <span data-start="2096.32" data-end="2098.18">and you have some improvements to this</span> <span data-start="2098.18" data-end="2099.71">workflow I'd love to hear about them so</span> <span data-start="2099.71" data-end="2103.78">come talk to me thanks very much</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
